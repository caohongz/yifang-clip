var QU=Object.defineProperty;var Dy=s=>{throw TypeError(s)};var tI=(s,t,e)=>t in s?QU(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var lf=(s,t,e)=>tI(s,typeof t!="symbol"?t+"":t,e),hf=(s,t,e)=>t.has(s)||Dy("Cannot "+e);var xt=(s,t,e)=>(hf(s,t,"read from private field"),e?e.call(s):t.get(s)),Hn=(s,t,e)=>t.has(s)?Dy("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),$n=(s,t,e,n)=>(hf(s,t,"write to private field"),n?n.call(s,e):t.set(s,e),e),Es=(s,t,e)=>(hf(s,t,"access private method"),e);import{m as Cc,q as eI,d as hi,s as ky,x as qr,y as iI,r as Tt,z as De,o as So,A as Nl,B as ls,C as rI,i as Wt,c as Ft,a as $,D as Er,t as li,b as lt,G as Pi,H as Uc,n as Il,I as uf,E as Zs,J as nI,g as St,f as le,w as he,F as $i,e as In,j as Ii,K as be,p as gp,L as sI,M as Qn,N as J0,h as aI,O as Oy}from"./index-BU4e3dt5.js";import{t as oI,J as F_,d as Ke,a as cf,c as lI,_ as ar,g as hI,y as Pl,b as uI}from"./_plugin-vue_export-helper-CEENE5B5.js";var Q0={};(function(s){var t=function(){var r=new Date,a=4,u=3,f=2,g=1,b=a,S={setLogLevel:function(A){A==this.debug?b=g:A==this.info?b=f:A==this.warn?b=u:(A==this.error,b=a)},debug:function(A,C){console.debug===void 0&&(console.debug=console.log),g>=b&&console.debug("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},log:function(A,C){this.debug(A.msg)},info:function(A,C){f>=b&&console.info("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},warn:function(A,C){u>=b&&console.warn("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},error:function(A,C){a>=b&&console.error("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)}};return S}();t.getDurationString=function(r,a){var u;function f(B,R){for(var M=""+B,N=M.split(".");N[0].length<R;)N[0]="0"+N[0];return N.join(".")}r<0?(u=!0,r=-r):u=!1;var g=a||1,b=r/g,S=Math.floor(b/3600);b-=S*3600;var A=Math.floor(b/60);b-=A*60;var C=b*1e3;return b=Math.floor(b),C-=b*1e3,C=Math.floor(C),(u?"-":"")+S+":"+f(A,2)+":"+f(b,2)+"."+f(C,3)},t.printRanges=function(r){var a=r.length;if(a>0){for(var u="",f=0;f<a;f++)f>0&&(u+=","),u+="["+t.getDurationString(r.start(f))+","+t.getDurationString(r.end(f))+"]";return u}else return"(empty)"},s.Log=t;var e=function(r){if(r instanceof ArrayBuffer)this.buffer=r,this.dataview=new DataView(r);else throw"Needs an array buffer";this.position=0};e.prototype.getPosition=function(){return this.position},e.prototype.getEndPosition=function(){return this.buffer.byteLength},e.prototype.getLength=function(){return this.buffer.byteLength},e.prototype.seek=function(r){var a=Math.max(0,Math.min(this.buffer.byteLength,r));return this.position=isNaN(a)||!isFinite(a)?0:a,!0},e.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},e.prototype.readAnyInt=function(r,a){var u=0;if(this.position+r<=this.buffer.byteLength){switch(r){case 1:a?u=this.dataview.getInt8(this.position):u=this.dataview.getUint8(this.position);break;case 2:a?u=this.dataview.getInt16(this.position):u=this.dataview.getUint16(this.position);break;case 3:if(a)throw"No method for reading signed 24 bits values";u=this.dataview.getUint8(this.position)<<16,u|=this.dataview.getUint8(this.position+1)<<8,u|=this.dataview.getUint8(this.position+2);break;case 4:a?u=this.dataview.getInt32(this.position):u=this.dataview.getUint32(this.position);break;case 8:if(a)throw"No method for reading signed 64 bits values";u=this.dataview.getUint32(this.position)<<32,u|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+r}return this.position+=r,u}else throw"Not enough bytes in buffer"},e.prototype.readUint8=function(){return this.readAnyInt(1,!1)},e.prototype.readUint16=function(){return this.readAnyInt(2,!1)},e.prototype.readUint24=function(){return this.readAnyInt(3,!1)},e.prototype.readUint32=function(){return this.readAnyInt(4,!1)},e.prototype.readUint64=function(){return this.readAnyInt(8,!1)},e.prototype.readString=function(r){if(this.position+r<=this.buffer.byteLength){for(var a="",u=0;u<r;u++)a+=String.fromCharCode(this.readUint8());return a}else throw"Not enough bytes in buffer"},e.prototype.readCString=function(){for(var r=[];;){var a=this.readUint8();if(a!==0)r.push(a);else break}return String.fromCharCode.apply(null,r)},e.prototype.readInt8=function(){return this.readAnyInt(1,!0)},e.prototype.readInt16=function(){return this.readAnyInt(2,!0)},e.prototype.readInt32=function(){return this.readAnyInt(4,!0)},e.prototype.readInt64=function(){return this.readAnyInt(8,!1)},e.prototype.readUint8Array=function(r){for(var a=new Uint8Array(r),u=0;u<r;u++)a[u]=this.readUint8();return a},e.prototype.readInt16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readInt16();return a},e.prototype.readUint16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readUint16();return a},e.prototype.readUint32Array=function(r){for(var a=new Uint32Array(r),u=0;u<r;u++)a[u]=this.readUint32();return a},e.prototype.readInt32Array=function(r){for(var a=new Int32Array(r),u=0;u<r;u++)a[u]=this.readInt32();return a},s.MP4BoxStream=e;var n=function(r,a,u){this._byteOffset=a||0,r instanceof ArrayBuffer?this.buffer=r:typeof r=="object"?(this.dataView=r,a&&(this._byteOffset+=a)):this.buffer=new ArrayBuffer(r||0),this.position=0,this.endianness=u??n.LITTLE_ENDIAN};n.prototype={},n.prototype.getPosition=function(){return this.position},n.prototype._realloc=function(r){if(this._dynamicSize){var a=this._byteOffset+this.position+r,u=this._buffer.byteLength;if(a<=u){a>this._byteLength&&(this._byteLength=a);return}for(u<1&&(u=1);a>u;)u*=2;var f=new ArrayBuffer(u),g=new Uint8Array(this._buffer),b=new Uint8Array(f,0,g.length);b.set(g),this.buffer=f,this._byteLength=a}},n.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var r=new ArrayBuffer(this._byteLength),a=new Uint8Array(r),u=new Uint8Array(this._buffer,0,a.length);a.set(u),this.buffer=r}},n.BIG_ENDIAN=!1,n.LITTLE_ENDIAN=!0,n.prototype._byteLength=0,Object.defineProperty(n.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(r){this._buffer=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(r){this._byteOffset=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"dataView",{get:function(){return this._dataView},set:function(r){this._byteOffset=r.byteOffset,this._buffer=r.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+r.byteLength}}),n.prototype.seek=function(r){var a=Math.max(0,Math.min(this.byteLength,r));this.position=isNaN(a)||!isFinite(a)?0:a},n.prototype.isEof=function(){return this.position>=this._byteLength},n.prototype.mapUint8Array=function(r){this._realloc(r*1);var a=new Uint8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.readInt32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Int32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Int16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt8Array=function(r){r=r??this.byteLength-this.position;var a=new Int8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readUint32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Uint32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Uint16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint8Array=function(r){r=r??this.byteLength-this.position;var a=new Uint8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readFloat64Array=function(r,a){r=r??this.byteLength-this.position/8;var u=new Float64Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readFloat32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Float32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt32=function(r){var a=this._dataView.getInt32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readInt16=function(r){var a=this._dataView.getInt16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readInt8=function(){var r=this._dataView.getInt8(this.position);return this.position+=1,r},n.prototype.readUint32=function(r){var a=this._dataView.getUint32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readUint16=function(r){var a=this._dataView.getUint16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readUint8=function(){var r=this._dataView.getUint8(this.position);return this.position+=1,r},n.prototype.readFloat32=function(r){var a=this._dataView.getFloat32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readFloat64=function(r){var a=this._dataView.getFloat64(this.position,r??this.endianness);return this.position+=8,a},n.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,n.memcpy=function(r,a,u,f,g){var b=new Uint8Array(r,a,g),S=new Uint8Array(u,f,g);b.set(S)},n.arrayToNative=function(r,a){return a==this.endianness?r:this.flipArrayEndianness(r)},n.nativeToEndian=function(r,a){return this.endianness==a?r:this.flipArrayEndianness(r)},n.flipArrayEndianness=function(r){for(var a=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),u=0;u<r.byteLength;u+=r.BYTES_PER_ELEMENT)for(var f=u+r.BYTES_PER_ELEMENT-1,g=u;f>g;f--,g++){var b=a[g];a[g]=a[f],a[f]=b}return r},n.prototype.failurePosition=0,String.fromCharCodeUint8=function(r){for(var a=[],u=0;u<r.length;u++)a[u]=r[u];return String.fromCharCode.apply(null,a)},n.prototype.readString=function(r,a){return a==null||a=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(r??this.byteLength-this.position)]):new TextDecoder(a).decode(this.mapUint8Array(r))},n.prototype.readCString=function(r){var a=this.byteLength-this.position,u=new Uint8Array(this._buffer,this._byteOffset+this.position),f=a;r!=null&&(f=Math.min(r,a));for(var g=0;g<f&&u[g]!==0;g++);var b=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(g)]);return r!=null?this.position+=f-g:g!=a&&(this.position+=1),b};var l=Math.pow(2,32);n.prototype.readInt64=function(){return this.readInt32()*l+this.readUint32()},n.prototype.readUint64=function(){return this.readUint32()*l+this.readUint32()},n.prototype.readInt64=function(){return this.readUint32()*l+this.readUint32()},n.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},s.DataStream=n,n.prototype.save=function(r){var a=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var u=window.URL.createObjectURL(a),f=document.createElement("a");document.body.appendChild(f),f.setAttribute("href",u),f.setAttribute("download",r),f.setAttribute("target","_self"),f.click(),window.URL.revokeObjectURL(u)}else throw"DataStream.save: Can't create object URL."},n.prototype._dynamicSize=!0,Object.defineProperty(n.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(r){r||this._trimAlloc(),this._dynamicSize=r}}),n.prototype.shift=function(r){var a=new ArrayBuffer(this._byteLength-r),u=new Uint8Array(a),f=new Uint8Array(this._buffer,r,u.length);u.set(f),this.buffer=a,this.position-=r},n.prototype.writeInt32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Int32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt32(r[u],a)},n.prototype.writeInt16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Int16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt16(r[u],a)},n.prototype.writeInt8Array=function(r){if(this._realloc(r.length*1),r instanceof Int8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt8Array(r.length);else for(var a=0;a<r.length;a++)this.writeInt8(r[a])},n.prototype.writeUint32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Uint32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint32(r[u],a)},n.prototype.writeUint16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Uint16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint16(r[u],a)},n.prototype.writeUint8Array=function(r){if(this._realloc(r.length*1),r instanceof Uint8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint8Array(r.length);else for(var a=0;a<r.length;a++)this.writeUint8(r[a])},n.prototype.writeFloat64Array=function(r,a){if(this._realloc(r.length*8),r instanceof Float64Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat64Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat64(r[u],a)},n.prototype.writeFloat32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Float32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat32(r[u],a)},n.prototype.writeInt32=function(r,a){this._realloc(4),this._dataView.setInt32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeInt16=function(r,a){this._realloc(2),this._dataView.setInt16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeInt8=function(r){this._realloc(1),this._dataView.setInt8(this.position,r),this.position+=1},n.prototype.writeUint32=function(r,a){this._realloc(4),this._dataView.setUint32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeUint16=function(r,a){this._realloc(2),this._dataView.setUint16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeUint8=function(r){this._realloc(1),this._dataView.setUint8(this.position,r),this.position+=1},n.prototype.writeFloat32=function(r,a){this._realloc(4),this._dataView.setFloat32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeFloat64=function(r,a){this._realloc(8),this._dataView.setFloat64(this.position,r,a??this.endianness),this.position+=8},n.prototype.writeUCS2String=function(r,a,u){u==null&&(u=r.length);for(var f=0;f<r.length&&f<u;f++)this.writeUint16(r.charCodeAt(f),a);for(;f<u;f++)this.writeUint16(0)},n.prototype.writeString=function(r,a,u){var f=0;if(a==null||a=="ASCII")if(u!=null){var g=Math.min(r.length,u);for(f=0;f<g;f++)this.writeUint8(r.charCodeAt(f));for(;f<u;f++)this.writeUint8(0)}else for(f=0;f<r.length;f++)this.writeUint8(r.charCodeAt(f));else this.writeUint8Array(new TextEncoder(a).encode(r.substring(0,u)))},n.prototype.writeCString=function(r,a){var u=0;if(a!=null){var f=Math.min(r.length,a);for(u=0;u<f;u++)this.writeUint8(r.charCodeAt(u));for(;u<a;u++)this.writeUint8(0)}else{for(u=0;u<r.length;u++)this.writeUint8(r.charCodeAt(u));this.writeUint8(0)}},n.prototype.writeStruct=function(r,a){for(var u=0;u<r.length;u+=2){var f=r[u+1];this.writeType(f,a[r[u]],a)}},n.prototype.writeType=function(r,a,u){var f;if(typeof r=="function")return r(this,a);if(typeof r=="object"&&!(r instanceof Array))return r.set(this,a,u);var g=null,b="ASCII",S=this.position;switch(typeof r=="string"&&/:/.test(r)&&(f=r.split(":"),r=f[0],g=parseInt(f[1])),typeof r=="string"&&/,/.test(r)&&(f=r.split(","),r=f[0],b=parseInt(f[1])),r){case"uint8":this.writeUint8(a);break;case"int8":this.writeInt8(a);break;case"uint16":this.writeUint16(a,this.endianness);break;case"int16":this.writeInt16(a,this.endianness);break;case"uint32":this.writeUint32(a,this.endianness);break;case"int32":this.writeInt32(a,this.endianness);break;case"float32":this.writeFloat32(a,this.endianness);break;case"float64":this.writeFloat64(a,this.endianness);break;case"uint16be":this.writeUint16(a,n.BIG_ENDIAN);break;case"int16be":this.writeInt16(a,n.BIG_ENDIAN);break;case"uint32be":this.writeUint32(a,n.BIG_ENDIAN);break;case"int32be":this.writeInt32(a,n.BIG_ENDIAN);break;case"float32be":this.writeFloat32(a,n.BIG_ENDIAN);break;case"float64be":this.writeFloat64(a,n.BIG_ENDIAN);break;case"uint16le":this.writeUint16(a,n.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(a,n.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(a,n.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(a,n.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(a,n.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(a,n.LITTLE_ENDIAN);break;case"cstring":this.writeCString(a,g);break;case"string":this.writeString(a,b,g);break;case"u16string":this.writeUCS2String(a,this.endianness,g);break;case"u16stringle":this.writeUCS2String(a,n.LITTLE_ENDIAN,g);break;case"u16stringbe":this.writeUCS2String(a,n.BIG_ENDIAN,g);break;default:if(r.length==3){for(var A=r[1],C=0;C<a.length;C++)this.writeType(A,a[C]);break}else{this.writeStruct(r,a);break}}g!=null&&(this.position=S,this._realloc(g),this.position=S+g)},n.prototype.writeUint64=function(r){var a=Math.floor(r/l);this.writeUint32(a),this.writeUint32(r&4294967295)},n.prototype.writeUint24=function(r){this.writeUint8((r&16711680)>>16),this.writeUint8((r&65280)>>8),this.writeUint8(r&255)},n.prototype.adjustUint32=function(r,a){var u=this.position;this.seek(r),this.writeUint32(a),this.seek(u)},n.prototype.mapInt32Array=function(r,a){this._realloc(r*4);var u=new Int32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapInt16Array=function(r,a){this._realloc(r*2);var u=new Int16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapInt8Array=function(r){this._realloc(r*1);var a=new Int8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.mapUint32Array=function(r,a){this._realloc(r*4);var u=new Uint32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapUint16Array=function(r,a){this._realloc(r*2);var u=new Uint16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapFloat64Array=function(r,a){this._realloc(r*8);var u=new Float64Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*8,u},n.prototype.mapFloat32Array=function(r,a){this._realloc(r*4);var u=new Float32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u};var h=function(r){this.buffers=[],this.bufferIndex=-1,r&&(this.insertBuffer(r),this.bufferIndex=0)};h.prototype=new n(new ArrayBuffer,0,n.BIG_ENDIAN),h.prototype.initialized=function(){var r;return this.bufferIndex>-1?!0:this.buffers.length>0?(r=this.buffers[0],r.fileStart===0?(this.buffer=r,this.bufferIndex=0,t.debug("MultiBufferStream","Stream ready for parsing"),!0):(t.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(t.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(r,a){t.debug("ArrayBuffer","Trying to create a new buffer of size: "+(r.byteLength+a.byteLength));var u=new Uint8Array(r.byteLength+a.byteLength);return u.set(new Uint8Array(r),0),u.set(new Uint8Array(a),r.byteLength),u.buffer},h.prototype.reduceBuffer=function(r,a,u){var f;return f=new Uint8Array(u),f.set(new Uint8Array(r,a,u)),f.buffer.fileStart=r.fileStart+a,f.buffer.usedBytes=0,f.buffer},h.prototype.insertBuffer=function(r){for(var a=!0,u=0;u<this.buffers.length;u++){var f=this.buffers[u];if(r.fileStart<=f.fileStart){if(r.fileStart===f.fileStart)if(r.byteLength>f.byteLength){this.buffers.splice(u,1),u--;continue}else t.warn("MultiBufferStream","Buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+") already appended, ignoring");else r.fileStart+r.byteLength<=f.fileStart||(r=this.reduceBuffer(r,0,f.fileStart-r.fileStart)),t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.splice(u,0,r),u===0&&(this.buffer=r);a=!1;break}else if(r.fileStart<f.fileStart+f.byteLength){var g=f.fileStart+f.byteLength-r.fileStart,b=r.byteLength-g;if(b>0)r=this.reduceBuffer(r,g,b);else{a=!1;break}}}a&&(t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.push(r),u===0&&(this.buffer=r))},h.prototype.logBufferLevel=function(r){var a,u,f,g,b=[],S,A="";for(f=0,g=0,a=0;a<this.buffers.length;a++)u=this.buffers[a],a===0?(S={},b.push(S),S.start=u.fileStart,S.end=u.fileStart+u.byteLength,A+="["+S.start+"-"):S.end===u.fileStart?S.end=u.fileStart+u.byteLength:(S={},S.start=u.fileStart,A+=b[b.length-1].end-1+"], ["+S.start+"-",S.end=u.fileStart+u.byteLength,b.push(S)),f+=u.usedBytes,g+=u.byteLength;b.length>0&&(A+=S.end-1+"]");var C=r?t.info:t.debug;this.buffers.length===0?C("MultiBufferStream","No more buffer in memory"):C("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+f+"/"+g+" bytes), continuous ranges: "+A)},h.prototype.cleanBuffers=function(){var r,a;for(r=0;r<this.buffers.length;r++)a=this.buffers[r],a.usedBytes===a.byteLength&&(t.debug("MultiBufferStream","Removing buffer #"+r),this.buffers.splice(r,1),r--)},h.prototype.mergeNextBuffer=function(){var r;if(this.bufferIndex+1<this.buffers.length)if(r=this.buffers[this.bufferIndex+1],r.fileStart===this.buffer.fileStart+this.buffer.byteLength){var a=this.buffer.byteLength,u=this.buffer.usedBytes,f=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,r),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=u,this.buffer.fileStart=f,t.debug("ISOFile","Concatenating buffer for box parsing (length: "+a+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},h.prototype.findPosition=function(r,a,u){var f,g=null,b=-1;for(r===!0?f=0:f=this.bufferIndex;f<this.buffers.length&&(g=this.buffers[f],g.fileStart<=a);){b=f,u&&(g.fileStart+g.byteLength<=a?g.usedBytes=g.byteLength:g.usedBytes=a-g.fileStart,this.logBufferLevel());f++}return b!==-1?(g=this.buffers[b],g.fileStart+g.byteLength>=a?(t.debug("MultiBufferStream","Found position in existing buffer #"+b),b):-1):-1},h.prototype.findEndContiguousBuf=function(r){var a,u,f,g=r!==void 0?r:this.bufferIndex;if(u=this.buffers[g],this.buffers.length>g+1)for(a=g+1;a<this.buffers.length&&(f=this.buffers[a],f.fileStart===u.fileStart+u.byteLength);a++)u=f;return u.fileStart+u.byteLength},h.prototype.getEndFilePositionAfter=function(r){var a=this.findPosition(!0,r,!1);return a!==-1?this.findEndContiguousBuf(a):r},h.prototype.addUsedBytes=function(r){this.buffer.usedBytes+=r,this.logBufferLevel()},h.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},h.prototype.seek=function(r,a,u){var f;return f=this.findPosition(a,r,u),f!==-1?(this.buffer=this.buffers[f],this.bufferIndex=f,this.position=r-this.buffer.fileStart,t.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(t.debug("MultiBufferStream","Position "+r+" not found in buffered data"),!1)},h.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},h.prototype.getLength=function(){return this.byteLength},h.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},s.MultiBufferStream=h;var d=function(){var r=3,a=4,u=5,f=6,g=[];g[r]="ES_Descriptor",g[a]="DecoderConfigDescriptor",g[u]="DecoderSpecificInfo",g[f]="SLConfigDescriptor",this.getDescriptorName=function(A){return g[A]};var b=this,S={};return this.parseOneDescriptor=function(A){var C=0,B,R,M;for(B=A.readUint8(),M=A.readUint8();M&128;)C=(M&127)<<7,M=A.readUint8();return C+=M&127,t.debug("MPEG4DescriptorParser","Found "+(g[B]||"Descriptor "+B)+", size "+C+" at position "+A.getPosition()),g[B]?R=new S[g[B]](C):R=new S.Descriptor(C),R.parse(A),R},S.Descriptor=function(A,C){this.tag=A,this.size=C,this.descs=[]},S.Descriptor.prototype.parse=function(A){this.data=A.readUint8Array(this.size)},S.Descriptor.prototype.findDescriptor=function(A){for(var C=0;C<this.descs.length;C++)if(this.descs[C].tag==A)return this.descs[C];return null},S.Descriptor.prototype.parseRemainingDescriptors=function(A){for(var C=A.position;A.position<C+this.size;){var B=b.parseOneDescriptor(A);this.descs.push(B)}},S.ES_Descriptor=function(A){S.Descriptor.call(this,r,A)},S.ES_Descriptor.prototype=new S.Descriptor,S.ES_Descriptor.prototype.parse=function(A){if(this.ES_ID=A.readUint16(),this.flags=A.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=A.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var C=A.readUint8();this.URL=A.readString(C),this.size-=C+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=A.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(A)},S.ES_Descriptor.prototype.getOTI=function(A){var C=this.findDescriptor(a);return C?C.oti:0},S.ES_Descriptor.prototype.getAudioConfig=function(A){var C=this.findDescriptor(a);if(!C)return null;var B=C.findDescriptor(u);if(B&&B.data){var R=(B.data[0]&248)>>3;return R===31&&B.data.length>=2&&(R=32+((B.data[0]&7)<<3)+((B.data[1]&224)>>5)),R}else return null},S.DecoderConfigDescriptor=function(A){S.Descriptor.call(this,a,A)},S.DecoderConfigDescriptor.prototype=new S.Descriptor,S.DecoderConfigDescriptor.prototype.parse=function(A){this.oti=A.readUint8(),this.streamType=A.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=A.readUint24(),this.maxBitrate=A.readUint32(),this.avgBitrate=A.readUint32(),this.size-=13,this.parseRemainingDescriptors(A)},S.DecoderSpecificInfo=function(A){S.Descriptor.call(this,u,A)},S.DecoderSpecificInfo.prototype=new S.Descriptor,S.SLConfigDescriptor=function(A){S.Descriptor.call(this,f,A)},S.SLConfigDescriptor.prototype=new S.Descriptor,this};s.MPEG4DescriptorParser=d;var o={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"],["grpl"],["j2kH"],["etyp",["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){o.FullBox.prototype=new o.Box,o.ContainerBox.prototype=new o.Box,o.SampleEntry.prototype=new o.Box,o.TrackGroupTypeBox.prototype=new o.FullBox,o.BASIC_BOXES.forEach(function(r){o.createBoxCtor(r)}),o.FULL_BOXES.forEach(function(r){o.createFullBoxCtor(r)}),o.CONTAINER_BOXES.forEach(function(r){o.createContainerBoxCtor(r[0],null,r[1])})},Box:function(r,a,u){this.type=r,this.size=a,this.uuid=u},FullBox:function(r,a,u){o.Box.call(this,r,a,u),this.flags=0,this.version=0},ContainerBox:function(r,a,u){o.Box.call(this,r,a,u),this.boxes=[]},SampleEntry:function(r,a,u,f){o.ContainerBox.call(this,r,a),this.hdr_size=u,this.start=f},SampleGroupEntry:function(r){this.grouping_type=r},TrackGroupTypeBox:function(r,a){o.FullBox.call(this,r,a)},createBoxCtor:function(r,a){o.boxCodes.push(r),o[r+"Box"]=function(u){o.Box.call(this,r,u)},o[r+"Box"].prototype=new o.Box,a&&(o[r+"Box"].prototype.parse=a)},createFullBoxCtor:function(r,a){o[r+"Box"]=function(u){o.FullBox.call(this,r,u)},o[r+"Box"].prototype=new o.FullBox,o[r+"Box"].prototype.parse=function(u){this.parseFullHeader(u),a&&a.call(this,u)}},addSubBoxArrays:function(r){if(r){this.subBoxNames=r;for(var a=r.length,u=0;u<a;u++)this[r[u]+"s"]=[]}},createContainerBoxCtor:function(r,a,u){o[r+"Box"]=function(f){o.ContainerBox.call(this,r,f),o.addSubBoxArrays.call(this,u)},o[r+"Box"].prototype=new o.ContainerBox,a&&(o[r+"Box"].prototype.parse=a)},createMediaSampleEntryCtor:function(r,a,u){o.sampleEntryCodes[r]=[],o[r+"SampleEntry"]=function(f,g){o.SampleEntry.call(this,f,g),o.addSubBoxArrays.call(this,u)},o[r+"SampleEntry"].prototype=new o.SampleEntry,a&&(o[r+"SampleEntry"].prototype.parse=a)},createSampleEntryCtor:function(r,a,u,f){o.sampleEntryCodes[r].push(a),o[a+"SampleEntry"]=function(g){o[r+"SampleEntry"].call(this,a,g),o.addSubBoxArrays.call(this,f)},o[a+"SampleEntry"].prototype=new o[r+"SampleEntry"],u&&(o[a+"SampleEntry"].prototype.parse=u)},createEncryptedSampleEntryCtor:function(r,a,u){o.createSampleEntryCtor.call(this,r,a,u,["sinf"])},createSampleGroupCtor:function(r,a){o[r+"SampleGroupEntry"]=function(u){o.SampleGroupEntry.call(this,r,u)},o[r+"SampleGroupEntry"].prototype=new o.SampleGroupEntry,a&&(o[r+"SampleGroupEntry"].prototype.parse=a)},createTrackGroupCtor:function(r,a){o[r+"TrackGroupTypeBox"]=function(u){o.TrackGroupTypeBox.call(this,r,u)},o[r+"TrackGroupTypeBox"].prototype=new o.TrackGroupTypeBox,a&&(o[r+"TrackGroupTypeBox"].prototype.parse=a)},createUUIDBox:function(r,a,u,f){o.UUIDs.push(r),o.UUIDBoxes[r]=function(g){a?o.FullBox.call(this,"uuid",g,r):u?o.ContainerBox.call(this,"uuid",g,r):o.Box.call(this,"uuid",g,r)},o.UUIDBoxes[r].prototype=a?new o.FullBox:u?new o.ContainerBox:new o.Box,f&&(a?o.UUIDBoxes[r].prototype.parse=function(g){this.parseFullHeader(g),f&&f.call(this,g)}:o.UUIDBoxes[r].prototype.parse=f)}};o.initialize(),o.TKHD_FLAG_ENABLED=1,o.TKHD_FLAG_IN_MOVIE=2,o.TKHD_FLAG_IN_PREVIEW=4,o.TFHD_FLAG_BASE_DATA_OFFSET=1,o.TFHD_FLAG_SAMPLE_DESC=2,o.TFHD_FLAG_SAMPLE_DUR=8,o.TFHD_FLAG_SAMPLE_SIZE=16,o.TFHD_FLAG_SAMPLE_FLAGS=32,o.TFHD_FLAG_DUR_EMPTY=65536,o.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,o.TRUN_FLAGS_DATA_OFFSET=1,o.TRUN_FLAGS_FIRST_FLAG=4,o.TRUN_FLAGS_DURATION=256,o.TRUN_FLAGS_SIZE=512,o.TRUN_FLAGS_FLAGS=1024,o.TRUN_FLAGS_CTS_OFFSET=2048,o.Box.prototype.add=function(r){return this.addBox(new o[r+"Box"])},o.Box.prototype.addBox=function(r){return this.boxes.push(r),this[r.type+"s"]?this[r.type+"s"].push(r):this[r.type]=r,r},o.Box.prototype.set=function(r,a){return this[r]=a,this},o.Box.prototype.addEntry=function(r,a){var u=a||"entries";return this[u]||(this[u]=[]),this[u].push(r),this},s.BoxParser=o,o.parseUUID=function(r){return o.parseHex16(r)},o.parseHex16=function(r){for(var a="",u=0;u<16;u++){var f=r.readUint8().toString(16);a+=f.length===1?"0"+f:f}return a},o.parseOneBox=function(r,a,u){var f,g=r.getPosition(),b=0,S,A;if(r.getEndPosition()-g<8)return t.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:o.ERR_NOT_ENOUGH_DATA};if(u&&u<8)return t.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:o.ERR_NOT_ENOUGH_DATA};var C=r.readUint32(),B=r.readString(4),R=B;if(t.debug("BoxParser","Found box of type '"+B+"' and size "+C+" at position "+g),b=8,B=="uuid"){if(r.getEndPosition()-r.getPosition()<16||u-b<16)return r.seek(g),t.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:o.ERR_NOT_ENOUGH_DATA};A=o.parseUUID(r),b+=16,R=A}if(C==1){if(r.getEndPosition()-r.getPosition()<8||u&&u-b<8)return r.seek(g),t.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+B+'" box'),{code:o.ERR_NOT_ENOUGH_DATA};C=r.readUint64(),b+=8}else if(C===0){if(u)C=u;else if(B!=="mdat")return t.error("BoxParser","Unlimited box size not supported for type: '"+B+"'"),f=new o.Box(B,C),{code:o.OK,box:f,size:f.size}}return C!==0&&C<b?(t.error("BoxParser","Box of type "+B+" has an invalid size "+C+" (too small to be a box)"),{code:o.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:b,start:g}):C!==0&&u&&C>u?(t.error("BoxParser","Box of type '"+B+"' has a size "+C+" greater than its container size "+u),{code:o.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:b,start:g}):C!==0&&g+C>r.getEndPosition()?(r.seek(g),t.info("BoxParser","Not enough data in stream to parse the entire '"+B+"' box"),{code:o.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:b,start:g}):a?{code:o.OK,type:B,size:C,hdr_size:b,start:g}:(o[B+"Box"]?f=new o[B+"Box"](C):B!=="uuid"?(t.warn("BoxParser","Unknown box type: '"+B+"'"),f=new o.Box(B,C),f.has_unparsed_data=!0):o.UUIDBoxes[A]?f=new o.UUIDBoxes[A](C):(t.warn("BoxParser","Unknown uuid type: '"+A+"'"),f=new o.Box(B,C),f.uuid=A,f.has_unparsed_data=!0),f.hdr_size=b,f.start=g,f.write===o.Box.prototype.write&&f.type!=="mdat"&&(t.info("BoxParser","'"+R+"' box writing not yet implemented, keeping unparsed data in memory for later write"),f.parseDataAndRewind(r)),f.parse(r),S=r.getPosition()-(f.start+f.size),S<0?(t.warn("BoxParser","Parsing of box '"+R+"' did not read the entire indicated box data size (missing "+-S+" bytes), seeking forward"),r.seek(f.start+f.size)):S>0&&(t.error("BoxParser","Parsing of box '"+R+"' read "+S+" more bytes than the indicated box data size, seeking backwards"),f.size!==0&&r.seek(f.start+f.size)),{code:o.OK,box:f,size:f.size})},o.Box.prototype.parse=function(r){this.type!="mdat"?this.data=r.readUint8Array(this.size-this.hdr_size):this.size===0?r.seek(r.getEndPosition()):r.seek(this.start+this.size)},o.Box.prototype.parseDataAndRewind=function(r){this.data=r.readUint8Array(this.size-this.hdr_size),r.position-=this.size-this.hdr_size},o.FullBox.prototype.parseDataAndRewind=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,r.position-=this.size-this.hdr_size},o.FullBox.prototype.parseFullHeader=function(r){this.version=r.readUint8(),this.flags=r.readUint24(),this.hdr_size+=4},o.FullBox.prototype.parse=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},o.ContainerBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===o.OK)if(u=a.box,this.boxes.push(u),this.subBoxNames&&this.subBoxNames.indexOf(u.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(u.type)]+"s"].push(u);else{var f=u.type!=="uuid"?u.type:u.uuid;this[f]?t.warn("Box of type "+f+" already stored in field of this type"):this[f]=u}else return},o.Box.prototype.parseLanguage=function(r){this.language=r.readUint16();var a=[];a[0]=this.language>>10&31,a[1]=this.language>>5&31,a[2]=this.language&31,this.languageString=String.fromCharCode(a[0]+96,a[1]+96,a[2]+96)},o.SAMPLE_ENTRY_TYPE_VISUAL="Visual",o.SAMPLE_ENTRY_TYPE_AUDIO="Audio",o.SAMPLE_ENTRY_TYPE_HINT="Hint",o.SAMPLE_ENTRY_TYPE_METADATA="Metadata",o.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",o.SAMPLE_ENTRY_TYPE_SYSTEM="System",o.SAMPLE_ENTRY_TYPE_TEXT="Text",o.SampleEntry.prototype.parseHeader=function(r){r.readUint8Array(6),this.data_reference_index=r.readUint16(),this.hdr_size+=8},o.SampleEntry.prototype.parse=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},o.SampleEntry.prototype.parseDataAndRewind=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,r.position-=this.size-this.hdr_size},o.SampleEntry.prototype.parseFooter=function(r){o.ContainerBox.prototype.parse.call(this,r)},o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_HINT),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SYSTEM),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_TEXT),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,function(r){var a;this.parseHeader(r),r.readUint16(),r.readUint16(),r.readUint32Array(3),this.width=r.readUint16(),this.height=r.readUint16(),this.horizresolution=r.readUint32(),this.vertresolution=r.readUint32(),r.readUint32(),this.frame_count=r.readUint16(),a=Math.min(31,r.readUint8()),this.compressorname=r.readString(a),a<31&&r.readString(31-a),this.depth=r.readUint16(),r.readUint16(),this.parseFooter(r)}),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,function(r){this.parseHeader(r),r.readUint32Array(2),this.channel_count=r.readUint16(),this.samplesize=r.readUint16(),r.readUint16(),r.readUint16(),this.samplerate=r.readUint32()/65536,this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_TEXT,"enct"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"encm"),o.createBoxCtor("a1lx",function(r){var a=r.readUint8()&1,u=((a&1)+1)*16;this.layer_size=[];for(var f=0;f<3;f++)u==16?this.layer_size[f]=r.readUint16():this.layer_size[f]=r.readUint32()}),o.createBoxCtor("a1op",function(r){this.op_index=r.readUint8()}),o.createFullBoxCtor("auxC",function(r){this.aux_type=r.readCString();var a=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=r.readUint8Array(a)}),o.createBoxCtor("av1C",function(r){var a=r.readUint8();if(a>>7&!1){t.error("av1C marker problem");return}if(this.version=a&127,this.version!==1){t.error("av1C version "+this.version+" not supported");return}if(a=r.readUint8(),this.seq_profile=a>>5&7,this.seq_level_idx_0=a&31,a=r.readUint8(),this.seq_tier_0=a>>7&1,this.high_bitdepth=a>>6&1,this.twelve_bit=a>>5&1,this.monochrome=a>>4&1,this.chroma_subsampling_x=a>>3&1,this.chroma_subsampling_y=a>>2&1,this.chroma_sample_position=a&3,a=r.readUint8(),this.reserved_1=a>>5&7,this.reserved_1!==0){t.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=a>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=a&15;else if(this.reserved_2=a&15,this.reserved_2!==0){t.error("av1C reserved_2 parsing problem");return}var u=this.size-this.hdr_size-4;this.configOBUs=r.readUint8Array(u)}),o.createBoxCtor("avcC",function(r){var a,u;for(this.configurationVersion=r.readUint8(),this.AVCProfileIndication=r.readUint8(),this.profile_compatibility=r.readUint8(),this.AVCLevelIndication=r.readUint8(),this.lengthSizeMinusOne=r.readUint8()&3,this.nb_SPS_nalus=r.readUint8()&31,u=this.size-this.hdr_size-6,this.SPS=[],a=0;a<this.nb_SPS_nalus;a++)this.SPS[a]={},this.SPS[a].length=r.readUint16(),this.SPS[a].nalu=r.readUint8Array(this.SPS[a].length),u-=2+this.SPS[a].length;for(this.nb_PPS_nalus=r.readUint8(),u--,this.PPS=[],a=0;a<this.nb_PPS_nalus;a++)this.PPS[a]={},this.PPS[a].length=r.readUint16(),this.PPS[a].nalu=r.readUint8Array(this.PPS[a].length),u-=2+this.PPS[a].length;u>0&&(this.ext=r.readUint8Array(u))}),o.createBoxCtor("btrt",function(r){this.bufferSizeDB=r.readUint32(),this.maxBitrate=r.readUint32(),this.avgBitrate=r.readUint32()}),o.createFullBoxCtor("ccst",function(r){var a=r.readUint8();this.all_ref_pics_intra=(a&128)==128,this.intra_pred_used=(a&64)==64,this.max_ref_per_pic=(a&63)>>2,r.readUint24()}),o.createBoxCtor("cdef",function(r){var a;for(this.channel_count=r.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],a=0;a<this.channel_count;a++)this.channel_indexes.push(r.readUint16()),this.channel_types.push(r.readUint16()),this.channel_associations.push(r.readUint16())}),o.createBoxCtor("clap",function(r){this.cleanApertureWidthN=r.readUint32(),this.cleanApertureWidthD=r.readUint32(),this.cleanApertureHeightN=r.readUint32(),this.cleanApertureHeightD=r.readUint32(),this.horizOffN=r.readUint32(),this.horizOffD=r.readUint32(),this.vertOffN=r.readUint32(),this.vertOffD=r.readUint32()}),o.createBoxCtor("clli",function(r){this.max_content_light_level=r.readUint16(),this.max_pic_average_light_level=r.readUint16()}),o.createFullBoxCtor("cmex",function(r){this.flags&1&&(this.pos_x=r.readInt32()),this.flags&2&&(this.pos_y=r.readInt32()),this.flags&4&&(this.pos_z=r.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=r.readInt32(),this.quat_y=r.readInt32(),this.quat_z=r.readInt32()):(this.quat_x=r.readInt16(),this.quat_y=r.readInt16(),this.quat_z=r.readInt16()):this.version==1),this.flags&32&&(this.id=r.readUint32())}),o.createFullBoxCtor("cmin",function(r){this.focal_length_x=r.readInt32(),this.principal_point_x=r.readInt32(),this.principal_point_y=r.readInt32(),this.flags&1&&(this.focal_length_y=r.readInt32(),this.skew_factor=r.readInt32())}),o.createBoxCtor("cmpd",function(r){for(this.component_count=r.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var a=r.readUint16();this.component_types.push(a),a>=32768&&this.component_type_urls.push(r.readCString())}}),o.createFullBoxCtor("co64",function(r){var a,u;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(u=0;u<a;u++)this.chunk_offsets.push(r.readUint64())}),o.createFullBoxCtor("CoLL",function(r){this.maxCLL=r.readUint16(),this.maxFALL=r.readUint16()}),o.createBoxCtor("colr",function(r){if(this.colour_type=r.readString(4),this.colour_type==="nclx"){this.colour_primaries=r.readUint16(),this.transfer_characteristics=r.readUint16(),this.matrix_coefficients=r.readUint16();var a=r.readUint8();this.full_range_flag=a>>7}else this.colour_type==="rICC"?this.ICC_profile=r.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=r.readUint8Array(this.size-4))}),o.createFullBoxCtor("cprt",function(r){this.parseLanguage(r),this.notice=r.readCString()}),o.createFullBoxCtor("cslg",function(r){this.version===0&&(this.compositionToDTSShift=r.readInt32(),this.leastDecodeToDisplayDelta=r.readInt32(),this.greatestDecodeToDisplayDelta=r.readInt32(),this.compositionStartTime=r.readInt32(),this.compositionEndTime=r.readInt32())}),o.createFullBoxCtor("ctts",function(r){var a,u;if(a=r.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(u=0;u<a;u++){this.sample_counts.push(r.readUint32());var f=r.readInt32();f<0&&t.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(f)}else if(this.version==1)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),this.sample_offsets.push(r.readInt32())}),o.createBoxCtor("dac3",function(r){var a=r.readUint8(),u=r.readUint8(),f=r.readUint8();this.fscod=a>>6,this.bsid=a>>1&31,this.bsmod=(a&1)<<2|u>>6&3,this.acmod=u>>3&7,this.lfeon=u>>2&1,this.bit_rate_code=u&3|f>>5&7}),o.createBoxCtor("dec3",function(r){var a=r.readUint16();this.data_rate=a>>3,this.num_ind_sub=a&7,this.ind_subs=[];for(var u=0;u<this.num_ind_sub+1;u++){var f={};this.ind_subs.push(f);var g=r.readUint8(),b=r.readUint8(),S=r.readUint8();f.fscod=g>>6,f.bsid=g>>1&31,f.bsmod=(g&1)<<4|b>>4&15,f.acmod=b>>1&7,f.lfeon=b&1,f.num_dep_sub=S>>1&15,f.num_dep_sub>0&&(f.chan_loc=(S&1)<<8|r.readUint8())}}),o.createFullBoxCtor("dfLa",function(r){var a=127,u=128,f=[],g=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var b=r.readUint8(),S=Math.min(b&a,g.length-1);if(S?r.readUint8Array(r.readUint24()):(r.readUint8Array(13),this.samplerate=r.readUint32()>>12,r.readUint8Array(20)),f.push(g[S]),b&u)break}while(!0);this.numMetadataBlocks=f.length+" ("+f.join(", ")+")"}),o.createBoxCtor("dimm",function(r){this.bytessent=r.readUint64()}),o.createBoxCtor("dmax",function(r){this.time=r.readUint32()}),o.createBoxCtor("dmed",function(r){this.bytessent=r.readUint64()}),o.createBoxCtor("dOps",function(r){if(this.Version=r.readUint8(),this.OutputChannelCount=r.readUint8(),this.PreSkip=r.readUint16(),this.InputSampleRate=r.readUint32(),this.OutputGain=r.readInt16(),this.ChannelMappingFamily=r.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=r.readUint8(),this.CoupledCount=r.readUint8(),this.ChannelMapping=[];for(var a=0;a<this.OutputChannelCount;a++)this.ChannelMapping[a]=r.readUint8()}}),o.createFullBoxCtor("dref",function(r){var a,u;this.entries=[];for(var f=r.readUint32(),g=0;g<f;g++)if(a=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===o.OK)u=a.box,this.entries.push(u);else return}),o.createBoxCtor("drep",function(r){this.bytessent=r.readUint64()}),o.createFullBoxCtor("elng",function(r){this.extended_language=r.readString(this.size-this.hdr_size)}),o.createFullBoxCtor("elst",function(r){this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),this.version===1?(f.segment_duration=r.readUint64(),f.media_time=r.readInt64()):(f.segment_duration=r.readUint32(),f.media_time=r.readInt32()),f.media_rate_integer=r.readInt16(),f.media_rate_fraction=r.readInt16()}}),o.createFullBoxCtor("emsg",function(r){this.version==1?(this.timescale=r.readUint32(),this.presentation_time=r.readUint64(),this.event_duration=r.readUint32(),this.id=r.readUint32(),this.scheme_id_uri=r.readCString(),this.value=r.readCString()):(this.scheme_id_uri=r.readCString(),this.value=r.readCString(),this.timescale=r.readUint32(),this.presentation_time_delta=r.readUint32(),this.event_duration=r.readUint32(),this.id=r.readUint32());var a=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(a-=4),this.message_data=r.readUint8Array(a)}),o.createEntityToGroupCtor=function(r,a){o[r+"Box"]=function(u){o.FullBox.call(this,r,u)},o[r+"Box"].prototype=new o.FullBox,o[r+"Box"].prototype.parse=function(u){if(this.parseFullHeader(u),a)a.call(this,u);else for(this.group_id=u.readUint32(),this.num_entities_in_group=u.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var f=u.readUint32();this.entity_ids.push(f)}}},o.createEntityToGroupCtor("aebr"),o.createEntityToGroupCtor("afbr"),o.createEntityToGroupCtor("albc"),o.createEntityToGroupCtor("altr"),o.createEntityToGroupCtor("brst"),o.createEntityToGroupCtor("dobr"),o.createEntityToGroupCtor("eqiv"),o.createEntityToGroupCtor("favc"),o.createEntityToGroupCtor("fobr"),o.createEntityToGroupCtor("iaug"),o.createEntityToGroupCtor("pano"),o.createEntityToGroupCtor("slid"),o.createEntityToGroupCtor("ster"),o.createEntityToGroupCtor("tsyn"),o.createEntityToGroupCtor("wbbr"),o.createEntityToGroupCtor("prgr"),o.createEntityToGroupCtor("pymd",function(r){this.group_id=r.readUint32(),this.num_entities_in_group=r.readUint32(),this.entity_ids=[];for(var a=0;a<this.num_entities_in_group;a++){var u=r.readUint32();this.entity_ids.push(u)}for(this.tile_size_x=r.readUint16(),this.tile_size_y=r.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],a=0;a<this.num_entities_in_group;a++)this.layer_binning[a]=r.readUint16(),this.tiles_in_layer_row_minus1[a]=r.readUint16(),this.tiles_in_layer_column_minus1[a]=r.readUint16()}),o.createFullBoxCtor("esds",function(r){var a=r.readUint8Array(this.size-this.hdr_size);if(this.data=a,typeof d<"u"){var u=new d;this.esd=u.parseOneDescriptor(new n(a.buffer,0,n.BIG_ENDIAN))}}),o.createBoxCtor("fiel",function(r){this.fieldCount=r.readUint8(),this.fieldOrdering=r.readUint8()}),o.createBoxCtor("frma",function(r){this.data_format=r.readString(4)}),o.createBoxCtor("ftyp",function(r){var a=this.size-this.hdr_size;this.major_brand=r.readString(4),this.minor_version=r.readUint32(),a-=8,this.compatible_brands=[];for(var u=0;a>=4;)this.compatible_brands[u]=r.readString(4),a-=4,u++}),o.createFullBoxCtor("hdlr",function(r){this.version===0&&(r.readUint32(),this.handler=r.readString(4),r.readUint32Array(3),this.name=r.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),o.createBoxCtor("hvcC",function(r){var a,u,f,g;this.configurationVersion=r.readUint8(),g=r.readUint8(),this.general_profile_space=g>>6,this.general_tier_flag=(g&32)>>5,this.general_profile_idc=g&31,this.general_profile_compatibility=r.readUint32(),this.general_constraint_indicator=r.readUint8Array(6),this.general_level_idc=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,this.chroma_format_idc=r.readUint8()&3,this.bit_depth_luma_minus8=r.readUint8()&7,this.bit_depth_chroma_minus8=r.readUint8()&7,this.avgFrameRate=r.readUint16(),g=r.readUint8(),this.constantFrameRate=g>>6,this.numTemporalLayers=(g&13)>>3,this.temporalIdNested=(g&4)>>2,this.lengthSizeMinusOne=g&3,this.nalu_arrays=[];var b=r.readUint8();for(a=0;a<b;a++){var S=[];this.nalu_arrays.push(S),g=r.readUint8(),S.completeness=(g&128)>>7,S.nalu_type=g&63;var A=r.readUint16();for(u=0;u<A;u++){var C={};S.push(C),f=r.readUint16(),C.data=r.readUint8Array(f)}}}),o.createFullBoxCtor("iinf",function(r){var a;this.version===0?this.entry_count=r.readUint16():this.entry_count=r.readUint32(),this.item_infos=[];for(var u=0;u<this.entry_count;u++)if(a=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===o.OK)a.box.type!=="infe"&&t.error("BoxParser","Expected 'infe' box, got "+a.box.type),this.item_infos[u]=a.box;else return}),o.createFullBoxCtor("iloc",function(r){var a;a=r.readUint8(),this.offset_size=a>>4&15,this.length_size=a&15,a=r.readUint8(),this.base_offset_size=a>>4&15,this.version===1||this.version===2?this.index_size=a&15:this.index_size=0,this.items=[];var u=0;if(this.version<2)u=r.readUint16();else if(this.version===2)u=r.readUint32();else throw"version of iloc box not supported";for(var f=0;f<u;f++){var g={};if(this.items.push(g),this.version<2)g.item_ID=r.readUint16();else if(this.version===2)g.item_ID=r.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?g.construction_method=r.readUint16()&15:g.construction_method=0,g.data_reference_index=r.readUint16(),this.base_offset_size){case 0:g.base_offset=0;break;case 4:g.base_offset=r.readUint32();break;case 8:g.base_offset=r.readUint64();break;default:throw"Error reading base offset size"}var b=r.readUint16();g.extents=[];for(var S=0;S<b;S++){var A={};if(g.extents.push(A),this.version===1||this.version===2)switch(this.index_size){case 0:A.extent_index=0;break;case 4:A.extent_index=r.readUint32();break;case 8:A.extent_index=r.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:A.extent_offset=0;break;case 4:A.extent_offset=r.readUint32();break;case 8:A.extent_offset=r.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:A.extent_length=0;break;case 4:A.extent_length=r.readUint32();break;case 8:A.extent_length=r.readUint64();break;default:throw"Error reading extent index"}}}}),o.createBoxCtor("imir",function(r){var a=r.readUint8();this.reserved=a>>7,this.axis=a&1}),o.createFullBoxCtor("infe",function(r){if((this.version===0||this.version===1)&&(this.item_ID=r.readUint16(),this.item_protection_index=r.readUint16(),this.item_name=r.readCString(),this.content_type=r.readCString(),this.content_encoding=r.readCString()),this.version===1){this.extension_type=r.readString(4),t.warn("BoxParser","Cannot parse extension type"),r.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=r.readUint16():this.version===3&&(this.item_ID=r.readUint32()),this.item_protection_index=r.readUint16(),this.item_type=r.readString(4),this.item_name=r.readCString(),this.item_type==="mime"?(this.content_type=r.readCString(),this.content_encoding=r.readCString()):this.item_type==="uri "&&(this.item_uri_type=r.readCString()))}),o.createFullBoxCtor("ipma",function(r){var a,u;for(entry_count=r.readUint32(),this.associations=[],a=0;a<entry_count;a++){var f={};this.associations.push(f),this.version<1?f.id=r.readUint16():f.id=r.readUint32();var g=r.readUint8();for(f.props=[],u=0;u<g;u++){var b=r.readUint8(),S={};f.props.push(S),S.essential=(b&128)>>7===1,this.flags&1?S.property_index=(b&127)<<8|r.readUint8():S.property_index=b&127}}}),o.createFullBoxCtor("iref",function(r){var a,u;for(this.references=[];r.getPosition()<this.start+this.size;)if(a=o.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===o.OK)this.version===0?u=new o.SingleItemTypeReferenceBox(a.type,a.size,a.hdr_size,a.start):u=new o.SingleItemTypeReferenceBoxLarge(a.type,a.size,a.hdr_size,a.start),u.write===o.Box.prototype.write&&u.type!=="mdat"&&(t.warn("BoxParser",u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.references.push(u);else return}),o.createBoxCtor("irot",function(r){this.angle=r.readUint8()&3}),o.createFullBoxCtor("ispe",function(r){this.image_width=r.readUint32(),this.image_height=r.readUint32()}),o.createFullBoxCtor("kind",function(r){this.schemeURI=r.readCString(),this.value=r.readCString()}),o.createFullBoxCtor("leva",function(r){var a=r.readUint8();this.levels=[];for(var u=0;u<a;u++){var f={};this.levels[u]=f,f.track_ID=r.readUint32();var g=r.readUint8();switch(f.padding_flag=g>>7,f.assignment_type=g&127,f.assignment_type){case 0:f.grouping_type=r.readString(4);break;case 1:f.grouping_type=r.readString(4),f.grouping_type_parameter=r.readUint32();break;case 2:break;case 3:break;case 4:f.sub_track_id=r.readUint32();break;default:t.warn("BoxParser","Unknown leva assignement type")}}}),o.createBoxCtor("lhvC",function(r){var a,u,f;this.configurationVersion=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,f=r.readUint8(),this.numTemporalLayers=(f&13)>>3,this.temporalIdNested=(f&4)>>2,this.lengthSizeMinusOne=f&3,this.nalu_arrays=[];var g=r.readUint8();for(a=0;a<g;a++){var b=[];this.nalu_arrays.push(b),f=r.readUint8(),b.completeness=(f&128)>>7,b.nalu_type=f&63;var S=r.readUint16();for(u=0;u<S;u++){var A={};b.push(A);var C=r.readUint16();A.data=r.readUint8Array(C)}}}),o.createBoxCtor("lsel",function(r){this.layer_id=r.readUint16()}),o.createBoxCtor("maxr",function(r){this.period=r.readUint32(),this.bytes=r.readUint32()});function _(r,a){this.x=r,this.y=a}_.prototype.toString=function(){return"("+this.x+","+this.y+")"},o.createBoxCtor("mdcv",function(r){this.display_primaries=[],this.display_primaries[0]=new _(r.readUint16(),r.readUint16()),this.display_primaries[1]=new _(r.readUint16(),r.readUint16()),this.display_primaries[2]=new _(r.readUint16(),r.readUint16()),this.white_point=new _(r.readUint16(),r.readUint16()),this.max_display_mastering_luminance=r.readUint32(),this.min_display_mastering_luminance=r.readUint32()}),o.createFullBoxCtor("mdhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.parseLanguage(r),r.readUint16()}),o.createFullBoxCtor("mehd",function(r){this.flags&1&&(t.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=r.readUint64():this.fragment_duration=r.readUint32()}),o.createFullBoxCtor("meta",function(r){this.boxes=[],o.ContainerBox.prototype.parse.call(this,r)}),o.createFullBoxCtor("mfhd",function(r){this.sequence_number=r.readUint32()}),o.createFullBoxCtor("mfro",function(r){this._size=r.readUint32()}),o.createFullBoxCtor("mskC",function(r){this.bits_per_pixel=r.readUint8()}),o.createFullBoxCtor("mvhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.rate=r.readUint32(),this.volume=r.readUint16()>>8,r.readUint16(),r.readUint32Array(2),this.matrix=r.readUint32Array(9),r.readUint32Array(6),this.next_track_id=r.readUint32()}),o.createBoxCtor("npck",function(r){this.packetssent=r.readUint32()}),o.createBoxCtor("nump",function(r){this.packetssent=r.readUint64()}),o.createFullBoxCtor("padb",function(r){var a=r.readUint32();this.padbits=[];for(var u=0;u<Math.floor((a+1)/2);u++)this.padbits=r.readUint8()}),o.createBoxCtor("pasp",function(r){this.hSpacing=r.readUint32(),this.vSpacing=r.readUint32()}),o.createBoxCtor("payl",function(r){this.text=r.readString(this.size-this.hdr_size)}),o.createBoxCtor("payt",function(r){this.payloadID=r.readUint32();var a=r.readUint8();this.rtpmap_string=r.readString(a)}),o.createFullBoxCtor("pdin",function(r){var a=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var u=0;u<a;u++)this.rate[u]=r.readUint32(),this.initial_delay[u]=r.readUint32()}),o.createFullBoxCtor("pitm",function(r){this.version===0?this.item_id=r.readUint16():this.item_id=r.readUint32()}),o.createFullBoxCtor("pixi",function(r){var a;for(this.num_channels=r.readUint8(),this.bits_per_channels=[],a=0;a<this.num_channels;a++)this.bits_per_channels[a]=r.readUint8()}),o.createBoxCtor("pmax",function(r){this.bytes=r.readUint32()}),o.createFullBoxCtor("prdi",function(r){if(this.step_count=r.readUint16(),this.item_count=[],this.flags&2)for(var a=0;a<this.step_count;a++)this.item_count[a]=r.readUint16()}),o.createFullBoxCtor("prft",function(r){this.ref_track_id=r.readUint32(),this.ntp_timestamp=r.readUint64(),this.version===0?this.media_time=r.readUint32():this.media_time=r.readUint64()}),o.createFullBoxCtor("pssh",function(r){if(this.system_id=o.parseHex16(r),this.version>0){var a=r.readUint32();this.kid=[];for(var u=0;u<a;u++)this.kid[u]=o.parseHex16(r)}var f=r.readUint32();f>0&&(this.data=r.readUint8Array(f))}),o.createFullBoxCtor("clef",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),o.createFullBoxCtor("enof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),o.createFullBoxCtor("prof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),o.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),o.createBoxCtor("rtp ",function(r){this.descriptionformat=r.readString(4),this.sdptext=r.readString(this.size-this.hdr_size-4)}),o.createFullBoxCtor("saio",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32());var a=r.readUint32();this.offset=[];for(var u=0;u<a;u++)this.version===0?this.offset[u]=r.readUint32():this.offset[u]=r.readUint64()}),o.createFullBoxCtor("saiz",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32()),this.default_sample_info_size=r.readUint8();var a=r.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var u=0;u<a;u++)this.sample_info_size[u]=r.readUint8()}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(r){this.parseHeader(r),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.auxiliary_mime_types=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(r){this.parseHeader(r),this.displayFlags=r.readUint32(),this.horizontal_justification=r.readInt8(),this.vertical_justification=r.readInt8(),this.bg_color_rgba=r.readUint8Array(4),this.box_record=r.readInt16Array(4),this.style_record=r.readUint8Array(12),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(r){this.parseHeader(r),this.parseFooter(r)}),o.createSampleGroupCtor("alst",function(r){var a,u=r.readUint16();for(this.first_output_sample=r.readUint16(),this.sample_offset=[],a=0;a<u;a++)this.sample_offset[a]=r.readUint32();var f=this.description_length-4-4*u;for(this.num_output_samples=[],this.num_total_samples=[],a=0;a<f/4;a++)this.num_output_samples[a]=r.readUint16(),this.num_total_samples[a]=r.readUint16()}),o.createSampleGroupCtor("avll",function(r){this.layerNumber=r.readUint8(),this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()}),o.createSampleGroupCtor("avss",function(r){this.subSequenceIdentifier=r.readUint16(),this.layerNumber=r.readUint8();var a=r.readUint8();this.durationFlag=a>>7,this.avgRateFlag=a>>6&1,this.durationFlag&&(this.duration=r.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()),this.dependency=[];for(var u=r.readUint8(),f=0;f<u;f++){var g={};this.dependency.push(g),g.subSeqDirectionFlag=r.readUint8(),g.layerNumber=r.readUint8(),g.subSequenceIdentifier=r.readUint16()}}),o.createSampleGroupCtor("dtrt",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("mvif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("prol",function(r){this.roll_distance=r.readInt16()}),o.createSampleGroupCtor("rap ",function(r){var a=r.readUint8();this.num_leading_samples_known=a>>7,this.num_leading_samples=a&127}),o.createSampleGroupCtor("rash",function(r){if(this.operation_point_count=r.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)t.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=r.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=r.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var a=0;a<this.operation_point_count;a++)this.available_bitrate[a]=r.readUint32(),this.target_rate_share[a]=r.readUint16()}this.maximum_bitrate=r.readUint32(),this.minimum_bitrate=r.readUint32(),this.discard_priority=r.readUint8()}}),o.createSampleGroupCtor("roll",function(r){this.roll_distance=r.readInt16()}),o.SampleGroupEntry.prototype.parse=function(r){t.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=r.readUint8Array(this.description_length)},o.createSampleGroupCtor("scif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("scnm",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("seig",function(r){this.reserved=r.readUint8();var a=r.readUint8();this.crypt_byte_block=a>>4,this.skip_byte_block=a&15,this.isProtected=r.readUint8(),this.Per_Sample_IV_Size=r.readUint8(),this.KID=o.parseHex16(r),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=r.readUint8(),this.constant_IV=r.readUint8Array(this.constant_IV_size))}),o.createSampleGroupCtor("stsa",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("sync",function(r){var a=r.readUint8();this.NAL_unit_type=a&63}),o.createSampleGroupCtor("tele",function(r){var a=r.readUint8();this.level_independently_decodable=a>>7}),o.createSampleGroupCtor("tsas",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("tscl",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("vipr",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createFullBoxCtor("sbgp",function(r){this.grouping_type=r.readString(4),this.version===1?this.grouping_type_parameter=r.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),f.sample_count=r.readInt32(),f.group_description_index=r.readInt32()}});function m(r,a){this.bad_pixel_row=r,this.bad_pixel_column=a}m.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},o.createFullBoxCtor("sbpm",function(r){var a;for(this.component_count=r.readUint16(),this.component_index=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16());var u=r.readUint8();for(this.correction_applied=(u&128)==128,this.num_bad_rows=r.readUint32(),this.num_bad_cols=r.readUint32(),this.num_bad_pixels=r.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],a=0;a<this.num_bad_rows;a++)this.bad_rows.push(r.readUint32());for(a=0;a<this.num_bad_cols;a++)this.bad_columns.push(r.readUint32());for(a=0;a<this.num_bad_pixels;a++){var f=r.readUint32(),g=r.readUint32();this.bad_pixels.push(new m(f,g))}}),o.createFullBoxCtor("schm",function(r){this.scheme_type=r.readString(4),this.scheme_version=r.readUint32(),this.flags&1&&(this.scheme_uri=r.readString(this.size-this.hdr_size-8))}),o.createBoxCtor("sdp ",function(r){this.sdptext=r.readString(this.size-this.hdr_size)}),o.createFullBoxCtor("sdtp",function(r){var a,u=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var f=0;f<u;f++)a=r.readUint8(),this.is_leading[f]=a>>6,this.sample_depends_on[f]=a>>4&3,this.sample_is_depended_on[f]=a>>2&3,this.sample_has_redundancy[f]=a&3}),o.createFullBoxCtor("senc"),o.createFullBoxCtor("sgpd",function(r){this.grouping_type=r.readString(4),t.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=r.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=r.readUint32()),this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f;o[this.grouping_type+"SampleGroupEntry"]?f=new o[this.grouping_type+"SampleGroupEntry"](this.grouping_type):f=new o.SampleGroupEntry(this.grouping_type),this.entries.push(f),this.version===1?this.default_length===0?f.description_length=r.readUint32():f.description_length=this.default_length:f.description_length=this.default_length,f.write===o.SampleGroupEntry.prototype.write&&(t.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),f.data=r.readUint8Array(f.description_length),r.position-=f.description_length),f.parse(r)}}),o.createFullBoxCtor("sidx",function(r){this.reference_ID=r.readUint32(),this.timescale=r.readUint32(),this.version===0?(this.earliest_presentation_time=r.readUint32(),this.first_offset=r.readUint32()):(this.earliest_presentation_time=r.readUint64(),this.first_offset=r.readUint64()),r.readUint16(),this.references=[];for(var a=r.readUint16(),u=0;u<a;u++){var f={};this.references.push(f);var g=r.readUint32();f.reference_type=g>>31&1,f.referenced_size=g&2147483647,f.subsegment_duration=r.readUint32(),g=r.readUint32(),f.starts_with_SAP=g>>31&1,f.SAP_type=g>>28&7,f.SAP_delta_time=g&268435455}}),o.SingleItemTypeReferenceBox=function(r,a,u,f){o.Box.call(this,r,a),this.hdr_size=u,this.start=f},o.SingleItemTypeReferenceBox.prototype=new o.Box,o.SingleItemTypeReferenceBox.prototype.parse=function(r){this.from_item_ID=r.readUint16();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint16()},o.SingleItemTypeReferenceBoxLarge=function(r,a,u,f){o.Box.call(this,r,a),this.hdr_size=u,this.start=f},o.SingleItemTypeReferenceBoxLarge.prototype=new o.Box,o.SingleItemTypeReferenceBoxLarge.prototype.parse=function(r){this.from_item_ID=r.readUint32();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint32()},o.createFullBoxCtor("SmDm",function(r){this.primaryRChromaticity_x=r.readUint16(),this.primaryRChromaticity_y=r.readUint16(),this.primaryGChromaticity_x=r.readUint16(),this.primaryGChromaticity_y=r.readUint16(),this.primaryBChromaticity_x=r.readUint16(),this.primaryBChromaticity_y=r.readUint16(),this.whitePointChromaticity_x=r.readUint16(),this.whitePointChromaticity_y=r.readUint16(),this.luminanceMax=r.readUint32(),this.luminanceMin=r.readUint32()}),o.createFullBoxCtor("smhd",function(r){this.balance=r.readUint16(),r.readUint16()}),o.createFullBoxCtor("ssix",function(r){this.subsegments=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.subsegments.push(f),f.ranges=[];for(var g=r.readUint32(),b=0;b<g;b++){var S={};f.ranges.push(S),S.level=r.readUint8(),S.range_size=r.readUint24()}}}),o.createFullBoxCtor("stco",function(r){var a;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(var u=0;u<a;u++)this.chunk_offsets.push(r.readUint32())}),o.createFullBoxCtor("stdp",function(r){var a=(this.size-this.hdr_size)/2;this.priority=[];for(var u=0;u<a;u++)this.priority[u]=r.readUint16()}),o.createFullBoxCtor("sthd"),o.createFullBoxCtor("stri",function(r){this.switch_group=r.readUint16(),this.alternate_group=r.readUint16(),this.sub_track_id=r.readUint32();var a=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),o.createFullBoxCtor("stsc",function(r){var a,u;if(a=r.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(u=0;u<a;u++)this.first_chunk.push(r.readUint32()),this.samples_per_chunk.push(r.readUint32()),this.sample_description_index.push(r.readUint32())}),o.createFullBoxCtor("stsd",function(r){var a,u,f,g;for(this.entries=[],f=r.readUint32(),a=1;a<=f;a++)if(u=o.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),u.code===o.OK)o[u.type+"SampleEntry"]?(g=new o[u.type+"SampleEntry"](u.size),g.hdr_size=u.hdr_size,g.start=u.start):(t.warn("BoxParser","Unknown sample entry type: "+u.type),g=new o.SampleEntry(u.type,u.size,u.hdr_size,u.start)),g.write===o.SampleEntry.prototype.write&&(t.info("BoxParser","SampleEntry "+g.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),g.parseDataAndRewind(r)),g.parse(r),this.entries.push(g);else return}),o.createFullBoxCtor("stsg",function(r){this.grouping_type=r.readUint32();var a=r.readUint16();this.group_description_index=[];for(var u=0;u<a;u++)this.group_description_index[u]=r.readUint32()}),o.createFullBoxCtor("stsh",function(r){var a,u;if(a=r.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(u=0;u<a;u++)this.shadowed_sample_numbers.push(r.readUint32()),this.sync_sample_numbers.push(r.readUint32())}),o.createFullBoxCtor("stss",function(r){var a,u;if(u=r.readUint32(),this.version===0)for(this.sample_numbers=[],a=0;a<u;a++)this.sample_numbers.push(r.readUint32())}),o.createFullBoxCtor("stsz",function(r){var a;if(this.sample_sizes=[],this.version===0)for(this.sample_size=r.readUint32(),this.sample_count=r.readUint32(),a=0;a<this.sample_count;a++)this.sample_size===0?this.sample_sizes.push(r.readUint32()):this.sample_sizes[a]=this.sample_size}),o.createFullBoxCtor("stts",function(r){var a,u,f;if(a=r.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),f=r.readInt32(),f<0&&(t.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),f=1),this.sample_deltas.push(f)}),o.createFullBoxCtor("stvi",function(r){var a=r.readUint32();this.single_view_allowed=a&3,this.stereo_scheme=r.readUint32();var u=r.readUint32();this.stereo_indication_type=r.readString(u);var f,g;for(this.boxes=[];r.getPosition()<this.start+this.size;)if(f=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),f.code===o.OK)g=f.box,this.boxes.push(g),this[g.type]=g;else return}),o.createBoxCtor("styp",function(r){o.ftypBox.prototype.parse.call(this,r)}),o.createFullBoxCtor("stz2",function(r){var a,u;if(this.sample_sizes=[],this.version===0)if(this.reserved=r.readUint24(),this.field_size=r.readUint8(),u=r.readUint32(),this.field_size===4)for(a=0;a<u;a+=2){var f=r.readUint8();this.sample_sizes[a]=f>>4&15,this.sample_sizes[a+1]=f&15}else if(this.field_size===8)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint8();else if(this.field_size===16)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint16();else t.error("BoxParser","Error in length field in stz2 box")}),o.createFullBoxCtor("subs",function(r){var a,u,f,g;for(f=r.readUint32(),this.entries=[],a=0;a<f;a++){var b={};if(this.entries[a]=b,b.sample_delta=r.readUint32(),b.subsamples=[],g=r.readUint16(),g>0)for(u=0;u<g;u++){var S={};b.subsamples.push(S),this.version==1?S.size=r.readUint32():S.size=r.readUint16(),S.priority=r.readUint8(),S.discardable=r.readUint8(),S.codec_specific_parameters=r.readUint32()}}}),o.createFullBoxCtor("tenc",function(r){if(r.readUint8(),this.version===0)r.readUint8();else{var a=r.readUint8();this.default_crypt_byte_block=a>>4&15,this.default_skip_byte_block=a&15}this.default_isProtected=r.readUint8(),this.default_Per_Sample_IV_Size=r.readUint8(),this.default_KID=o.parseHex16(r),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=r.readUint8(),this.default_constant_IV=r.readUint8Array(this.default_constant_IV_size))}),o.createFullBoxCtor("tfdt",function(r){this.version==1?this.baseMediaDecodeTime=r.readUint64():this.baseMediaDecodeTime=r.readUint32()}),o.createFullBoxCtor("tfhd",function(r){var a=0;this.track_id=r.readUint32(),this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=r.readUint64(),a+=8):this.base_data_offset=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=r.readUint32(),a+=4):this.default_sample_description_index=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=r.readUint32(),a+=4):this.default_sample_duration=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=r.readUint32(),a+=4):this.default_sample_size=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=r.readUint32(),a+=4):this.default_sample_flags=0}),o.createFullBoxCtor("tfra",function(r){this.track_ID=r.readUint32(),r.readUint24();var a=r.readUint8();this.length_size_of_traf_num=a>>4&3,this.length_size_of_trun_num=a>>2&3,this.length_size_of_sample_num=a&3,this.entries=[];for(var u=r.readUint32(),f=0;f<u;f++)this.version===1?(this.time=r.readUint64(),this.moof_offset=r.readUint64()):(this.time=r.readUint32(),this.moof_offset=r.readUint32()),this.traf_number=r["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=r["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=r["readUint"+8*(this.length_size_of_sample_num+1)]()}),o.createFullBoxCtor("tkhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint32()),r.readUint32Array(2),this.layer=r.readInt16(),this.alternate_group=r.readInt16(),this.volume=r.readInt16()>>8,r.readUint16(),this.matrix=r.readInt32Array(9),this.width=r.readUint32(),this.height=r.readUint32()}),o.createBoxCtor("tmax",function(r){this.time=r.readUint32()}),o.createBoxCtor("tmin",function(r){this.time=r.readUint32()}),o.createBoxCtor("totl",function(r){this.bytessent=r.readUint32()}),o.createBoxCtor("tpay",function(r){this.bytessent=r.readUint32()}),o.createBoxCtor("tpyl",function(r){this.bytessent=r.readUint64()}),o.TrackGroupTypeBox.prototype.parse=function(r){this.parseFullHeader(r),this.track_group_id=r.readUint32()},o.createTrackGroupCtor("msrc"),o.TrackReferenceTypeBox=function(r,a,u,f){o.Box.call(this,r,a),this.hdr_size=u,this.start=f},o.TrackReferenceTypeBox.prototype=new o.Box,o.TrackReferenceTypeBox.prototype.parse=function(r){this.track_ids=r.readUint32Array((this.size-this.hdr_size)/4)},o.trefBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=o.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===o.OK)u=new o.TrackReferenceTypeBox(a.type,a.size,a.hdr_size,a.start),u.write===o.Box.prototype.write&&u.type!=="mdat"&&(t.info("BoxParser","TrackReference "+u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.boxes.push(u);else return},o.createFullBoxCtor("trep",function(r){for(this.track_ID=r.readUint32(),this.boxes=[];r.getPosition()<this.start+this.size;)if(ret=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),ret.code===o.OK)box=ret.box,this.boxes.push(box);else return}),o.createFullBoxCtor("trex",function(r){this.track_id=r.readUint32(),this.default_sample_description_index=r.readUint32(),this.default_sample_duration=r.readUint32(),this.default_sample_size=r.readUint32(),this.default_sample_flags=r.readUint32()}),o.createBoxCtor("trpy",function(r){this.bytessent=r.readUint64()}),o.createFullBoxCtor("trun",function(r){var a=0;if(this.sample_count=r.readUint32(),a+=4,this.size-this.hdr_size>a&&this.flags&o.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=r.readInt32(),a+=4):this.data_offset=0,this.size-this.hdr_size>a&&this.flags&o.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=r.readUint32(),a+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>a)for(var u=0;u<this.sample_count;u++)this.flags&o.TRUN_FLAGS_DURATION&&(this.sample_duration[u]=r.readUint32()),this.flags&o.TRUN_FLAGS_SIZE&&(this.sample_size[u]=r.readUint32()),this.flags&o.TRUN_FLAGS_FLAGS&&(this.sample_flags[u]=r.readUint32()),this.flags&o.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[u]=r.readUint32():this.sample_composition_time_offset[u]=r.readInt32())}),o.createFullBoxCtor("tsel",function(r){this.switch_group=r.readUint32();var a=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),o.createFullBoxCtor("txtC",function(r){this.config=r.readCString()}),o.createBoxCtor("tyco",function(r){var a=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var u=0;u<a;u++)this.compatible_brands[u]=r.readString(4)}),o.createFullBoxCtor("udes",function(r){this.lang=r.readCString(),this.name=r.readCString(),this.description=r.readCString(),this.tags=r.readCString()}),o.createFullBoxCtor("uncC",function(r){var a;if(this.profile=r.readUint32(),this.version!=1){if(this.version==0){for(this.component_count=r.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16()),this.component_bit_depth_minus_one.push(r.readUint8()),this.component_format.push(r.readUint8()),this.component_align_size.push(r.readUint8());this.sampling_type=r.readUint8(),this.interleave_type=r.readUint8(),this.block_size=r.readUint8();var u=r.readUint8();this.component_little_endian=u>>7&1,this.block_pad_lsb=u>>6&1,this.block_little_endian=u>>5&1,this.block_reversed=u>>4&1,this.pad_unknown=u>>3&1,this.pixel_size=r.readUint32(),this.row_align_size=r.readUint32(),this.tile_align_size=r.readUint32(),this.num_tile_cols_minus_one=r.readUint32(),this.num_tile_rows_minus_one=r.readUint32()}}}),o.createFullBoxCtor("url ",function(r){this.flags!==1&&(this.location=r.readCString())}),o.createFullBoxCtor("urn ",function(r){this.name=r.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=r.readCString())}),o.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(r){this.LiveServerManifest=r.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),o.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(r){this.system_id=o.parseHex16(r);var a=r.readUint32();a>0&&(this.data=r.readUint8Array(a))}),o.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),o.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(r){this.default_AlgorithmID=r.readUint24(),this.default_IV_size=r.readUint8(),this.default_KID=o.parseHex16(r)}),o.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(r){this.fragment_count=r.readUint8(),this.entries=[];for(var a=0;a<this.fragment_count;a++){var u={},f=0,g=0;this.version===1?(f=r.readUint64(),g=r.readUint64()):(f=r.readUint32(),g=r.readUint32()),u.absolute_time=f,u.absolute_duration=g,this.entries.push(u)}}),o.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(r){this.version===1?(this.absolute_time=r.readUint64(),this.duration=r.readUint64()):(this.absolute_time=r.readUint32(),this.duration=r.readUint32())}),o.createFullBoxCtor("vmhd",function(r){this.graphicsmode=r.readUint16(),this.opcolor=r.readUint16Array(3)}),o.createFullBoxCtor("vpcC",function(r){var a;this.version===1?(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4,this.chromaSubsampling=a>>1&7,this.videoFullRangeFlag=a&1,this.colourPrimaries=r.readUint8(),this.transferCharacteristics=r.readUint8(),this.matrixCoefficients=r.readUint8(),this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize)):(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4&15,this.colorSpace=a&15,a=r.readUint8(),this.chromaSubsampling=a>>4&15,this.transferFunction=a>>1&7,this.videoFullRangeFlag=a&1,this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize))}),o.createBoxCtor("vttC",function(r){this.text=r.readString(this.size-this.hdr_size)}),o.createFullBoxCtor("vvcC",function(r){var a,u,f={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(L){this.held_bits=L.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(L){this.held_bits=L.readUint16(),this.num_held_bits=16},extract_bits:function(L){var W=this.held_bits>>this.num_held_bits-L&(1<<L)-1;return this.num_held_bits-=L,W}};if(f.stream_read_1_bytes(r),f.extract_bits(5),this.lengthSizeMinusOne=f.extract_bits(2),this.ptl_present_flag=f.extract_bits(1),this.ptl_present_flag){f.stream_read_2_bytes(r),this.ols_idx=f.extract_bits(9),this.num_sublayers=f.extract_bits(3),this.constant_frame_rate=f.extract_bits(2),this.chroma_format_idc=f.extract_bits(2),f.stream_read_1_bytes(r),this.bit_depth_minus8=f.extract_bits(3),f.extract_bits(5);{if(f.stream_read_2_bytes(r),f.extract_bits(2),this.num_bytes_constraint_info=f.extract_bits(6),this.general_profile_idc=f.extract_bits(7),this.general_tier_flag=f.extract_bits(1),this.general_level_idc=r.readUint8(),f.stream_read_1_bytes(r),this.ptl_frame_only_constraint_flag=f.extract_bits(1),this.ptl_multilayer_enabled_flag=f.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(a=0;a<this.num_bytes_constraint_info-1;a++){var g=f.extract_bits(6);f.stream_read_1_bytes(r);var b=f.extract_bits(2);this.general_constraint_info[a]=g<<2|b}this.general_constraint_info[this.num_bytes_constraint_info-1]=f.extract_bits(6)}else f.extract_bits(6);if(this.num_sublayers>1){for(f.stream_read_1_bytes(r),this.ptl_sublayer_present_mask=0,u=this.num_sublayers-2;u>=0;--u){var S=f.extract_bits(1);this.ptl_sublayer_present_mask|=S<<u}for(u=this.num_sublayers;u<=8&&this.num_sublayers>1;++u)f.extract_bits(1);for(this.sublayer_level_idc=[],u=this.num_sublayers-2;u>=0;--u)this.ptl_sublayer_present_mask&1<<u&&(this.sublayer_level_idc[u]=r.readUint8())}if(this.ptl_num_sub_profiles=r.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(a=0;a<this.ptl_num_sub_profiles;a++)this.general_sub_profile_idc.push(r.readUint32())}this.max_picture_width=r.readUint16(),this.max_picture_height=r.readUint16(),this.avg_frame_rate=r.readUint16()}var A=12,C=13;this.nalu_arrays=[];var B=r.readUint8();for(a=0;a<B;a++){var R=[];this.nalu_arrays.push(R),f.stream_read_1_bytes(r),R.completeness=f.extract_bits(1),f.extract_bits(2),R.nalu_type=f.extract_bits(5);var M=1;for(R.nalu_type!=C&&R.nalu_type!=A&&(M=r.readUint16()),u=0;u<M;u++){var N=r.readUint16();R.push({data:r.readUint8Array(N),length:N})}}}),o.createFullBoxCtor("vvnC",function(r){var a=strm.readUint8();this.lengthSizeMinusOne=a&3}),o.SampleEntry.prototype.isVideo=function(){return!1},o.SampleEntry.prototype.isAudio=function(){return!1},o.SampleEntry.prototype.isSubtitle=function(){return!1},o.SampleEntry.prototype.isMetadata=function(){return!1},o.SampleEntry.prototype.isHint=function(){return!1},o.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},o.SampleEntry.prototype.getWidth=function(){return""},o.SampleEntry.prototype.getHeight=function(){return""},o.SampleEntry.prototype.getChannelCount=function(){return""},o.SampleEntry.prototype.getSampleRate=function(){return""},o.SampleEntry.prototype.getSampleSize=function(){return""},o.VisualSampleEntry.prototype.isVideo=function(){return!0},o.VisualSampleEntry.prototype.getWidth=function(){return this.width},o.VisualSampleEntry.prototype.getHeight=function(){return this.height},o.AudioSampleEntry.prototype.isAudio=function(){return!0},o.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},o.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},o.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},o.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},o.MetadataSampleEntry.prototype.isMetadata=function(){return!0},o.decimalToHex=function(r,a){var u=Number(r).toString(16);for(a=typeof a>"u"||a===null?a=2:a;u.length<a;)u="0"+u;return u},o.avc1SampleEntry.prototype.getCodec=o.avc2SampleEntry.prototype.getCodec=o.avc3SampleEntry.prototype.getCodec=o.avc4SampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this);return this.avcC?r+"."+o.decimalToHex(this.avcC.AVCProfileIndication)+o.decimalToHex(this.avcC.profile_compatibility)+o.decimalToHex(this.avcC.AVCLevelIndication):r},o.hev1SampleEntry.prototype.getCodec=o.hvc1SampleEntry.prototype.getCodec=function(){var r,a=o.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(a+=".",this.hvcC.general_profile_space){case 0:a+="";break;case 1:a+="A";break;case 2:a+="B";break;case 3:a+="C";break}a+=this.hvcC.general_profile_idc,a+=".";var u=this.hvcC.general_profile_compatibility,f=0;for(r=0;r<32&&(f|=u&1,r!=31);r++)f<<=1,u>>=1;a+=o.decimalToHex(f,0),a+=".",this.hvcC.general_tier_flag===0?a+="L":a+="H",a+=this.hvcC.general_level_idc;var g=!1,b="";for(r=5;r>=0;r--)(this.hvcC.general_constraint_indicator[r]||g)&&(b="."+o.decimalToHex(this.hvcC.general_constraint_indicator[r],0)+b,g=!0);a+=b}return a},o.vvc1SampleEntry.prototype.getCodec=o.vvi1SampleEntry.prototype.getCodec=function(){var r,a=o.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){a+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?a+=".H":a+=".L",a+=this.vvcC.general_level_idc;var u="";if(this.vvcC.general_constraint_info){var f=[],g=0;g|=this.vvcC.ptl_frame_only_constraint<<7,g|=this.vvcC.ptl_multilayer_enabled<<6;var b;for(r=0;r<this.vvcC.general_constraint_info.length;++r)g|=this.vvcC.general_constraint_info[r]>>2&63,f.push(g),g&&(b=r),g=this.vvcC.general_constraint_info[r]>>2&3;if(b===void 0)u=".CA";else{u=".C";var S="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",A=0,C=0;for(r=0;r<=b;++r)for(A=A<<8|f[r],C+=8;C>=5;){var B=A>>C-5&31;u+=S[B],C-=5,A&=(1<<C)-1}C&&(A<<=5-C,u+=S[A&31])}}a+=u}return a},o.mp4aSampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var a=this.esds.esd.getOTI(),u=this.esds.esd.getAudioConfig();return r+"."+o.decimalToHex(a)+(u?"."+u:"")}else return r},o.stxtSampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this);return this.mime_format?r+"."+this.mime_format:r},o.vp08SampleEntry.prototype.getCodec=o.vp09SampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this),a=this.vpcC.level;a==0&&(a="00");var u=this.vpcC.bitDepth;return u==8&&(u="08"),r+".0"+this.vpcC.profile+"."+a+"."+u},o.av01SampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this),a=this.av1C.seq_level_idx_0;a<10&&(a="0"+a);var u;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?u=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(u=this.av1C.high_bitdepth===1?"10":"08"),r+"."+this.av1C.seq_profile+"."+a+(this.av1C.seq_tier_0?"H":"M")+"."+u},o.Box.prototype.writeHeader=function(r,a){this.size+=8,this.size>l&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+r.getPosition()+(a||"")),this.size>l?r.writeUint32(1):(this.sizePosition=r.getPosition(),r.writeUint32(this.size)),r.writeString(this.type,null,4),this.type==="uuid"&&r.writeUint8Array(this.uuid),this.size>l&&r.writeUint64(this.size)},o.FullBox.prototype.writeHeader=function(r){this.size+=4,o.Box.prototype.writeHeader.call(this,r," v="+this.version+" f="+this.flags),r.writeUint8(this.version),r.writeUint24(this.flags)},o.Box.prototype.write=function(r){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(r),r.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(r),this.data&&r.writeUint8Array(this.data))},o.ContainerBox.prototype.write=function(r){this.size=0,this.writeHeader(r);for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&(this.boxes[a].write(r),this.size+=this.boxes[a].size);t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.TrackReferenceTypeBox.prototype.write=function(r){this.size=this.track_ids.length*4,this.writeHeader(r),r.writeUint32Array(this.track_ids)},o.avcCBox.prototype.write=function(r){var a;for(this.size=7,a=0;a<this.SPS.length;a++)this.size+=2+this.SPS[a].length;for(a=0;a<this.PPS.length;a++)this.size+=2+this.PPS[a].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8(this.AVCProfileIndication),r.writeUint8(this.profile_compatibility),r.writeUint8(this.AVCLevelIndication),r.writeUint8(this.lengthSizeMinusOne+252),r.writeUint8(this.SPS.length+224),a=0;a<this.SPS.length;a++)r.writeUint16(this.SPS[a].length),r.writeUint8Array(this.SPS[a].nalu);for(r.writeUint8(this.PPS.length),a=0;a<this.PPS.length;a++)r.writeUint16(this.PPS[a].length),r.writeUint8Array(this.PPS[a].nalu);this.ext&&r.writeUint8Array(this.ext)},o.co64Box.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),a=0;a<this.chunk_offsets.length;a++)r.writeUint64(this.chunk_offsets[a])},o.cslgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeInt32(this.compositionToDTSShift),r.writeInt32(this.leastDecodeToDisplayDelta),r.writeInt32(this.greatestDecodeToDisplayDelta),r.writeInt32(this.compositionStartTime),r.writeInt32(this.compositionEndTime)},o.cttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),this.version===1?r.writeInt32(this.sample_offsets[a]):r.writeUint32(this.sample_offsets[a])},o.drefBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.elngBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(r),r.writeString(this.extended_language)},o.elstBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeUint32(u.segment_duration),r.writeInt32(u.media_time),r.writeInt16(u.media_rate_integer),r.writeInt16(u.media_rate_fraction)}},o.emsgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(r),r.writeCString(this.scheme_id_uri),r.writeCString(this.value),r.writeUint32(this.timescale),r.writeUint32(this.presentation_time_delta),r.writeUint32(this.event_duration),r.writeUint32(this.id),r.writeUint8Array(this.message_data)},o.ftypBox.prototype.write=function(r){this.size=8+4*this.compatible_brands.length,this.writeHeader(r),r.writeString(this.major_brand,null,4),r.writeUint32(this.minor_version);for(var a=0;a<this.compatible_brands.length;a++)r.writeString(this.compatible_brands[a],null,4)},o.hdlrBox.prototype.write=function(r){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(r),r.writeUint32(0),r.writeString(this.handler,null,4),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeCString(this.name)},o.hvcCBox.prototype.write=function(r){var a,u;for(this.size=23,a=0;a<this.nalu_arrays.length;a++)for(this.size+=3,u=0;u<this.nalu_arrays[a].length;u++)this.size+=2+this.nalu_arrays[a][u].data.length;for(this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),r.writeUint32(this.general_profile_compatibility),r.writeUint8Array(this.general_constraint_indicator),r.writeUint8(this.general_level_idc),r.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),r.writeUint8(this.parallelismType+252),r.writeUint8(this.chroma_format_idc+252),r.writeUint8(this.bit_depth_luma_minus8+248),r.writeUint8(this.bit_depth_chroma_minus8+248),r.writeUint16(this.avgFrameRate),r.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),r.writeUint8(this.nalu_arrays.length),a=0;a<this.nalu_arrays.length;a++)for(r.writeUint8((this.nalu_arrays[a].completeness<<7)+this.nalu_arrays[a].nalu_type),r.writeUint16(this.nalu_arrays[a].length),u=0;u<this.nalu_arrays[a].length;u++)r.writeUint16(this.nalu_arrays[a][u].data.length),r.writeUint8Array(this.nalu_arrays[a][u].data)},o.kindBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(r),r.writeCString(this.schemeURI),r.writeCString(this.value)},o.mdhdBox.prototype.write=function(r){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint16(this.language),r.writeUint16(0)},o.mehdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.fragment_duration)},o.mfhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.sequence_number)},o.mvhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint32(this.rate),r.writeUint16(this.volume<<8),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32Array(this.matrix),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(this.next_track_id)},o.SampleEntry.prototype.writeHeader=function(r){this.size=8,o.Box.prototype.writeHeader.call(this,r),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint16(this.data_reference_index)},o.SampleEntry.prototype.writeFooter=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r),this.size+=this.boxes[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.SampleEntry.prototype.write=function(r){this.writeHeader(r),r.writeUint8Array(this.data),this.size+=this.data.length,t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.VisualSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*7+6*4+32,r.writeUint16(0),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.width),r.writeUint16(this.height),r.writeUint32(this.horizresolution),r.writeUint32(this.vertresolution),r.writeUint32(0),r.writeUint16(this.frame_count),r.writeUint8(Math.min(31,this.compressorname.length)),r.writeString(this.compressorname,null,31),r.writeUint16(this.depth),r.writeInt16(-1),this.writeFooter(r)},o.AudioSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*4+3*4,r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.channel_count),r.writeUint16(this.samplesize),r.writeUint16(0),r.writeUint16(0),r.writeUint32(this.samplerate<<16),this.writeFooter(r)},o.stppSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,r.writeCString(this.namespace),r.writeCString(this.schema_location),r.writeCString(this.auxiliary_mime_types),this.writeFooter(r)},o.SampleGroupEntry.prototype.write=function(r){r.writeUint8Array(this.data)},o.sbgpBox.prototype.write=function(r){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(r),r.writeString(this.grouping_type,null,4),r.writeUint32(this.grouping_type_parameter),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeInt32(u.sample_count),r.writeInt32(u.group_description_index)}},o.sgpdBox.prototype.write=function(r){var a,u;for(this.flags=0,this.size=12,a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=u.data.length);for(this.writeHeader(r),r.writeString(this.grouping_type,null,4),this.version===1&&r.writeUint32(this.default_length),this.version>=2&&r.writeUint32(this.default_sample_description_index),r.writeUint32(this.entries.length),a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&this.default_length===0&&r.writeUint32(u.description_length),u.write(r)},o.sidxBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(r),r.writeUint32(this.reference_ID),r.writeUint32(this.timescale),r.writeUint32(this.earliest_presentation_time),r.writeUint32(this.first_offset),r.writeUint16(0),r.writeUint16(this.references.length);for(var a=0;a<this.references.length;a++){var u=this.references[a];r.writeUint32(u.reference_type<<31|u.referenced_size),r.writeUint32(u.subsegment_duration),r.writeUint32(u.starts_with_SAP<<31|u.SAP_type<<28|u.SAP_delta_time)}},o.smhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=4,this.writeHeader(r),r.writeUint16(this.balance),r.writeUint16(0)},o.stcoBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),r.writeUint32Array(this.chunk_offsets)},o.stscBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(r),r.writeUint32(this.first_chunk.length),a=0;a<this.first_chunk.length;a++)r.writeUint32(this.first_chunk[a]),r.writeUint32(this.samples_per_chunk[a]),r.writeUint32(this.sample_description_index[a])},o.stsdBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(r),r.writeUint32(this.entries.length),this.size+=4,a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.stshBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(r),r.writeUint32(this.shadowed_sample_numbers.length),a=0;a<this.shadowed_sample_numbers.length;a++)r.writeUint32(this.shadowed_sample_numbers[a]),r.writeUint32(this.sync_sample_numbers[a])},o.stssBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(r),r.writeUint32(this.sample_numbers.length),r.writeUint32Array(this.sample_numbers)},o.stszBox.prototype.write=function(r){var a,u=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(a=0;a+1<this.sample_sizes.length;)if(this.sample_sizes[a+1]!==this.sample_sizes[0]){u=!1;break}else a++;else u=!1;this.size=8,u||(this.size+=4*this.sample_sizes.length),this.writeHeader(r),u?r.writeUint32(this.sample_sizes[0]):r.writeUint32(0),r.writeUint32(this.sample_sizes.length),u||r.writeUint32Array(this.sample_sizes)},o.sttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),r.writeUint32(this.sample_deltas[a])},o.tfdtBox.prototype.write=function(r){var a=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>a?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(r),this.version===1?r.writeUint64(this.baseMediaDecodeTime):r.writeUint32(this.baseMediaDecodeTime)},o.tfhdBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&o.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&o.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&o.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&o.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&o.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(r),r.writeUint32(this.track_id),this.flags&o.TFHD_FLAG_BASE_DATA_OFFSET&&r.writeUint64(this.base_data_offset),this.flags&o.TFHD_FLAG_SAMPLE_DESC&&r.writeUint32(this.default_sample_description_index),this.flags&o.TFHD_FLAG_SAMPLE_DUR&&r.writeUint32(this.default_sample_duration),this.flags&o.TFHD_FLAG_SAMPLE_SIZE&&r.writeUint32(this.default_sample_size),this.flags&o.TFHD_FLAG_SAMPLE_FLAGS&&r.writeUint32(this.default_sample_flags)},o.tkhdBox.prototype.write=function(r){this.version=0,this.size=4*18+2*4,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.track_id),r.writeUint32(0),r.writeUint32(this.duration),r.writeUint32(0),r.writeUint32(0),r.writeInt16(this.layer),r.writeInt16(this.alternate_group),r.writeInt16(this.volume<<8),r.writeUint16(0),r.writeInt32Array(this.matrix),r.writeUint32(this.width),r.writeUint32(this.height)},o.trexBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeUint32(this.track_id),r.writeUint32(this.default_sample_description_index),r.writeUint32(this.default_sample_duration),r.writeUint32(this.default_sample_size),r.writeUint32(this.default_sample_flags)},o.trunBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&o.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&o.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&o.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&o.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&o.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&o.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(r),r.writeUint32(this.sample_count),this.flags&o.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=r.getPosition(),r.writeInt32(this.data_offset)),this.flags&o.TRUN_FLAGS_FIRST_FLAG&&r.writeUint32(this.first_sample_flags);for(var a=0;a<this.sample_count;a++)this.flags&o.TRUN_FLAGS_DURATION&&r.writeUint32(this.sample_duration[a]),this.flags&o.TRUN_FLAGS_SIZE&&r.writeUint32(this.sample_size[a]),this.flags&o.TRUN_FLAGS_FLAGS&&r.writeUint32(this.sample_flags[a]),this.flags&o.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?r.writeUint32(this.sample_composition_time_offset[a]):r.writeInt32(this.sample_composition_time_offset[a]))},o["url Box"].prototype.write=function(r){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(r),this.location&&r.writeCString(this.location)},o["urn Box"].prototype.write=function(r){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(r),r.writeCString(this.name),this.location&&r.writeCString(this.location)},o.vmhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=8,this.writeHeader(r),r.writeUint16(this.graphicsmode),r.writeUint16Array(this.opcolor)},o.cttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)r[f].pts=r[f].dts+this.sample_offsets[a],f++},o.sttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)f===0?r[f].dts=0:r[f].dts=r[f-1].dts+this.sample_deltas[a],f++},o.stcoBox.prototype.unpack=function(r){var a;for(a=0;a<this.chunk_offsets.length;a++)r[a].offset=this.chunk_offsets[a]},o.stscBox.prototype.unpack=function(r){var a,u,f,g,b;for(g=0,b=0,a=0;a<this.first_chunk.length;a++)for(u=0;u<(a+1<this.first_chunk.length?this.first_chunk[a+1]:1/0);u++)for(b++,f=0;f<this.samples_per_chunk[a];f++){if(r[g])r[g].description_index=this.sample_description_index[a],r[g].chunk_index=b;else return;g++}},o.stszBox.prototype.unpack=function(r){var a;for(a=0;a<this.sample_sizes.length;a++)r[a].size=this.sample_sizes[a]},o.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],o.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],o.boxEqualFields=function(r,a){if(r&&!a)return!1;var u;for(u in r)if(!(o.DIFF_BOXES_PROP_NAMES.indexOf(u)>-1)){if(r[u]instanceof o.Box||a[u]instanceof o.Box)continue;if(typeof r[u]>"u"||typeof a[u]>"u")continue;if(typeof r[u]=="function"||typeof a[u]=="function")continue;if(r.subBoxNames&&r.subBoxNames.indexOf(u.slice(0,4))>-1||a.subBoxNames&&a.subBoxNames.indexOf(u.slice(0,4))>-1)continue;if(u==="data"||u==="start"||u==="size"||u==="creation_time"||u==="modification_time")continue;if(o.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(u)>-1)continue;if(r[u]!==a[u])return!1}return!0},o.boxEqual=function(r,a){if(!o.boxEqualFields(r,a))return!1;for(var u=0;u<o.DIFF_BOXES_PROP_NAMES.length;u++){var f=o.DIFF_BOXES_PROP_NAMES[u];if(r[f]&&a[f]&&!o.boxEqual(r[f],a[f]))return!1}return!0};var v=function(){};v.prototype.parseSample=function(r){var a={},u;a.resources=[];var f=new e(r.data.buffer);if(!r.subsamples||r.subsamples.length===0)a.documentString=f.readString(r.data.length);else if(a.documentString=f.readString(r.subsamples[0].size),r.subsamples.length>1)for(u=1;u<r.subsamples.length;u++)a.resources[u]=f.readUint8Array(r.subsamples[u].size);return typeof DOMParser<"u"&&(a.document=new DOMParser().parseFromString(a.documentString,"application/xml")),a};var w=function(){};w.prototype.parseSample=function(r){var a,u=new e(r.data.buffer);return a=u.readString(r.data.length),a},w.prototype.parseConfig=function(r){var a,u=new e(r.buffer);return u.readUint32(),a=u.readCString(),a},s.XMLSubtitlein4Parser=v,s.Textin4Parser=w;var x=function(r){this.stream=r||new h,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};x.prototype.setSegmentOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.fragmentedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.segmentStream=null,g.nb_samples=1e3,g.rapAlignement=!0,u&&(u.nbSamples&&(g.nb_samples=u.nbSamples),u.rapAlignement&&(g.rapAlignement=u.rapAlignement))}},x.prototype.unsetSegmentOptions=function(r){for(var a=-1,u=0;u<this.fragmentedTracks.length;u++){var f=this.fragmentedTracks[u];f.id==r&&(a=u)}a>-1&&this.fragmentedTracks.splice(a,1)},x.prototype.setExtractionOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.extractedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.nb_samples=1e3,g.samples=[],u&&u.nbSamples&&(g.nb_samples=u.nbSamples)}},x.prototype.unsetExtractionOptions=function(r){for(var a=-1,u=0;u<this.extractedTracks.length;u++){var f=this.extractedTracks[u];f.id==r&&(a=u)}a>-1&&this.extractedTracks.splice(a,1)},x.prototype.parse=function(){var r,a,u=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),r=o.parseOneBox(this.stream,u),r.code===o.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(r))continue;return}else return;else{var f;switch(a=r.box,f=a.type!=="uuid"?a.type:a.uuid,this.boxes.push(a),f){case"mdat":this.mdats.push(a);break;case"moof":this.moofs.push(a);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[f]!==void 0&&t.warn("ISOFile","Duplicate Box of type: "+f+", overriding previous occurrence"),this[f]=a;break}this.updateUsedBytes&&this.updateUsedBytes(a,r)}},x.prototype.checkBuffer=function(r){if(r==null)throw"Buffer must be defined and non empty";if(r.fileStart===void 0)throw"Buffer must have a fileStart property";return r.byteLength===0?(t.warn("ISOFile","Ignoring empty buffer (fileStart: "+r.fileStart+")"),this.stream.logBufferLevel(),!1):(t.info("ISOFile","Processing buffer (fileStart: "+r.fileStart+")"),r.usedBytes=0,this.stream.insertBuffer(r),this.stream.logBufferLevel(),this.stream.initialized()?!0:(t.warn("ISOFile","Not ready to start parsing"),!1))},x.prototype.appendBuffer=function(r,a){var u;if(this.checkBuffer(r))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(a),this.nextSeekPosition?(u=this.nextSeekPosition,this.nextSeekPosition=void 0):u=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(u=this.stream.getEndFilePositionAfter(u))):this.nextParsePosition?u=this.nextParsePosition:u=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(t.info("ISOFile","Done processing buffer (fileStart: "+r.fileStart+") - next buffer to fetch should have a fileStart position of "+u),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),u},x.prototype.getInfo=function(){var r,a,u={},f,g,b,S,A=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(u.hasMoov=!0,u.duration=this.moov.mvhd.duration,u.timescale=this.moov.mvhd.timescale,u.isFragmented=this.moov.mvex!=null,u.isFragmented&&this.moov.mvex.mehd&&(u.fragment_duration=this.moov.mvex.mehd.fragment_duration),u.isProgressive=this.isProgressive,u.hasIOD=this.moov.iods!=null,u.brands=[],u.brands.push(this.ftyp.major_brand),u.brands=u.brands.concat(this.ftyp.compatible_brands),u.created=new Date(A+this.moov.mvhd.creation_time*1e3),u.modified=new Date(A+this.moov.mvhd.modification_time*1e3),u.tracks=[],u.audioTracks=[],u.videoTracks=[],u.subtitleTracks=[],u.metadataTracks=[],u.hintTracks=[],u.otherTracks=[],r=0;r<this.moov.traks.length;r++){if(f=this.moov.traks[r],S=f.mdia.minf.stbl.stsd.entries[0],g={},u.tracks.push(g),g.id=f.tkhd.track_id,g.name=f.mdia.hdlr.name,g.references=[],f.tref)for(a=0;a<f.tref.boxes.length;a++)b={},g.references.push(b),b.type=f.tref.boxes[a].type,b.track_ids=f.tref.boxes[a].track_ids;f.edts&&(g.edits=f.edts.elst.entries),g.created=new Date(A+f.tkhd.creation_time*1e3),g.modified=new Date(A+f.tkhd.modification_time*1e3),g.movie_duration=f.tkhd.duration,g.movie_timescale=u.timescale,g.layer=f.tkhd.layer,g.alternate_group=f.tkhd.alternate_group,g.volume=f.tkhd.volume,g.matrix=f.tkhd.matrix,g.track_width=f.tkhd.width/65536,g.track_height=f.tkhd.height/65536,g.timescale=f.mdia.mdhd.timescale,g.cts_shift=f.mdia.minf.stbl.cslg,g.duration=f.mdia.mdhd.duration,g.samples_duration=f.samples_duration,g.codec=S.getCodec(),g.kind=f.udta&&f.udta.kinds.length?f.udta.kinds[0]:{schemeURI:"",value:""},g.language=f.mdia.elng?f.mdia.elng.extended_language:f.mdia.mdhd.languageString,g.nb_samples=f.samples.length,g.size=f.samples_size,g.bitrate=g.size*8*g.timescale/g.samples_duration,S.isAudio()?(g.type="audio",u.audioTracks.push(g),g.audio={},g.audio.sample_rate=S.getSampleRate(),g.audio.channel_count=S.getChannelCount(),g.audio.sample_size=S.getSampleSize()):S.isVideo()?(g.type="video",u.videoTracks.push(g),g.video={},g.video.width=S.getWidth(),g.video.height=S.getHeight()):S.isSubtitle()?(g.type="subtitles",u.subtitleTracks.push(g)):S.isHint()?(g.type="metadata",u.hintTracks.push(g)):S.isMetadata()?(g.type="metadata",u.metadataTracks.push(g)):(g.type="metadata",u.otherTracks.push(g))}else u.hasMoov=!1;if(u.mime="",u.hasMoov&&u.tracks){for(u.videoTracks&&u.videoTracks.length>0?u.mime+='video/mp4; codecs="':u.audioTracks&&u.audioTracks.length>0?u.mime+='audio/mp4; codecs="':u.mime+='application/mp4; codecs="',r=0;r<u.tracks.length;r++)r!==0&&(u.mime+=","),u.mime+=u.tracks[r].codec;u.mime+='"; profiles="',u.mime+=this.ftyp.compatible_brands.join(),u.mime+='"'}return u},x.prototype.setNextSeekPositionFromSample=function(r){r&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(r.offset+r.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=r.offset+r.alreadyRead)},x.prototype.processSamples=function(r){var a,u;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(a=0;a<this.fragmentedTracks.length;a++){var f=this.fragmentedTracks[a];for(u=f.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Creating media fragment on track #"+f.id+" for sample "+u.nextSample);var g=this.createFragment(f.id,u.nextSample,f.segmentStream);if(g)f.segmentStream=g,u.nextSample++;else break;if((u.nextSample%f.nb_samples===0||r||u.nextSample>=u.samples.length)&&(t.info("ISOFile","Sending fragmented data on track #"+f.id+" for samples ["+Math.max(0,u.nextSample-f.nb_samples)+","+(u.nextSample-1)+"]"),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(f.id,f.user,f.segmentStream.buffer,u.nextSample,r||u.nextSample>=u.samples.length),f.segmentStream=null,f!==this.fragmentedTracks[a]))break}}if(this.onSamples!==null)for(a=0;a<this.extractedTracks.length;a++){var b=this.extractedTracks[a];for(u=b.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Exporting on track #"+b.id+" sample #"+u.nextSample);var S=this.getSample(u,u.nextSample);if(S)u.nextSample++,b.samples.push(S);else{this.setNextSeekPositionFromSample(u.samples[u.nextSample]);break}if((u.nextSample%b.nb_samples===0||u.nextSample>=u.samples.length)&&(t.debug("ISOFile","Sending samples on track #"+b.id+" for sample "+u.nextSample),this.onSamples&&this.onSamples(b.id,b.user,b.samples),b.samples=[],b!==this.extractedTracks[a]))break}}}},x.prototype.getBox=function(r){var a=this.getBoxes(r,!0);return a.length?a[0]:null},x.prototype.getBoxes=function(r,a){var u=[];return x._sweep.call(this,r,u,a),u},x._sweep=function(r,a,u){this.type&&this.type==r&&a.push(this);for(var f in this.boxes){if(a.length&&u)return;x._sweep.call(this.boxes[f],r,a,u)}},x.prototype.getTrackSamplesInfo=function(r){var a=this.getTrackById(r);if(a)return a.samples},x.prototype.getTrackSample=function(r,a){var u=this.getTrackById(r),f=this.getSample(u,a);return f},x.prototype.releaseUsedSamples=function(r,a){var u=0,f=this.getTrackById(r);f.lastValidSample||(f.lastValidSample=0);for(var g=f.lastValidSample;g<a;g++)u+=this.releaseSample(f,g);t.info("ISOFile","Track #"+r+" released samples up to "+a+" (released size: "+u+", remaining: "+this.samplesDataSize+")"),f.lastValidSample=a},x.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},x.prototype.stop=function(){this.sampleProcessingStarted=!1},x.prototype.flush=function(){t.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},x.prototype.seekTrack=function(r,a,u){var f,g,b=1/0,S=0,A=0,C;if(u.samples.length===0)return t.info("ISOFile","No sample in track, cannot seek! Using time "+t.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(f=0;f<u.samples.length;f++){if(g=u.samples[f],f===0)A=0,C=g.timescale;else if(g.cts>r*g.timescale){A=f-1;break}a&&g.is_sync&&(S=f)}for(a&&(A=S),r=u.samples[A].cts,u.nextSample=A;u.samples[A].alreadyRead===u.samples[A].size&&u.samples[A+1];)A++;return b=u.samples[A].offset+u.samples[A].alreadyRead,t.info("ISOFile","Seeking to "+(a?"RAP":"")+" sample #"+u.nextSample+" on track "+u.tkhd.track_id+", time "+t.getDurationString(r,C)+" and offset: "+b),{offset:b,time:r/C}},x.prototype.getTrackDuration=function(r){var a;return r.samples?(a=r.samples[r.samples.length-1],(a.cts+a.duration)/a.timescale):1/0},x.prototype.seek=function(r,a){var u=this.moov,f,g,b,S={offset:1/0,time:1/0};if(this.moov){for(b=0;b<u.traks.length;b++)f=u.traks[b],!(r>this.getTrackDuration(f))&&(g=this.seekTrack(r,a,f),g.offset<S.offset&&(S.offset=g.offset),g.time<S.time&&(S.time=g.time));return t.info("ISOFile","Seeking at time "+t.getDurationString(S.time,1)+" needs a buffer with a fileStart position of "+S.offset),S.offset===1/0?S={offset:this.nextParsePosition,time:0}:S.offset=this.stream.getEndFilePositionAfter(S.offset),t.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+S.offset),S}else throw"Cannot seek: moov not received!"},x.prototype.equal=function(r){for(var a=0;a<this.boxes.length&&a<r.boxes.length;){var u=this.boxes[a],f=r.boxes[a];if(!o.boxEqual(u,f))return!1;a++}return!0},s.ISOFile=x,x.prototype.lastBoxStartPosition=0,x.prototype.parsingMdat=null,x.prototype.nextParsePosition=0,x.prototype.discardMdatData=!1,x.prototype.processIncompleteBox=function(r){var a,u,f;return r.type==="mdat"?(a=new o[r.type+"Box"](r.size),this.parsingMdat=a,this.boxes.push(a),this.mdats.push(a),a.start=r.start,a.hdr_size=r.hdr_size,this.stream.addUsedBytes(a.hdr_size),this.lastBoxStartPosition=a.start+a.size,f=this.stream.seek(a.start+a.size,!1,this.discardMdatData),f?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=a.start+a.size,!1)):(r.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),u=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,u?(this.nextParsePosition=this.stream.getEndPosition(),!0):(r.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+r.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},x.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},x.prototype.processIncompleteMdat=function(){var r,a;return r=this.parsingMdat,a=this.stream.seek(r.start+r.size,!1,this.discardMdatData),a?(t.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},x.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},x.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},x.prototype.updateUsedBytes=function(r,a){this.stream.addUsedBytes&&(r.type==="mdat"?(this.stream.addUsedBytes(r.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(r.size-r.hdr_size)):this.stream.addUsedBytes(r.size))},x.prototype.add=o.Box.prototype.add,x.prototype.addBox=o.Box.prototype.addBox,x.prototype.init=function(r){var a=r||{};this.add("ftyp").set("major_brand",a.brands&&a.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",a.brands||["iso4"]);var u=this.add("moov");return u.add("mvhd").set("timescale",a.timescale||600).set("rate",a.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",a.duration||0).set("volume",a.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),u.add("mvex"),this},x.prototype.addTrack=function(r){this.moov||this.init(r);var a=r||{};a.width=a.width||320,a.height=a.height||320,a.id=a.id||this.moov.mvhd.next_track_id,a.type=a.type||"avc1";var u=this.moov.add("trak");this.moov.mvhd.next_track_id=a.id+1,u.add("tkhd").set("flags",o.TKHD_FLAG_ENABLED|o.TKHD_FLAG_IN_MOVIE|o.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",a.id).set("duration",a.duration||0).set("layer",a.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",a.width<<16).set("height",a.height<<16);var f=u.add("mdia");f.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",a.timescale||1).set("duration",a.media_duration||0).set("language",a.language||"und"),f.add("hdlr").set("handler",a.hdlr||"vide").set("name",a.name||"Track created with MP4Box.js"),f.add("elng").set("extended_language",a.language||"fr-FR");var g=f.add("minf");if(o[a.type+"SampleEntry"]!==void 0){var b=new o[a.type+"SampleEntry"];b.data_reference_index=1;var S="";for(var A in o.sampleEntryCodes)for(var C=o.sampleEntryCodes[A],B=0;B<C.length;B++)if(C.indexOf(a.type)>-1){S=A;break}switch(S){case"Visual":if(g.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),b.set("width",a.width).set("height",a.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",a.type+" Compressor").set("depth",24),a.avcDecoderConfigRecord){var R=new o.avcCBox;R.parse(new e(a.avcDecoderConfigRecord)),b.addBox(R)}else if(a.hevcDecoderConfigRecord){var M=new o.hvcCBox;M.parse(new e(a.hevcDecoderConfigRecord)),b.addBox(M)}break;case"Audio":g.add("smhd").set("balance",a.balance||0),b.set("channel_count",a.channel_count||2).set("samplesize",a.samplesize||16).set("samplerate",a.samplerate||65536);break;case"Hint":g.add("hmhd");break;case"Subtitle":switch(g.add("sthd"),a.type){case"stpp":b.set("namespace",a.namespace||"nonamespace").set("schema_location",a.schema_location||"").set("auxiliary_mime_types",a.auxiliary_mime_types||"");break}break;case"Metadata":g.add("nmhd");break;case"System":g.add("nmhd");break;default:g.add("nmhd");break}a.description&&b.addBox(a.description),a.description_boxes&&a.description_boxes.forEach(function(L){b.addBox(L)}),g.add("dinf").add("dref").addEntry(new o["url Box"]().set("flags",1));var N=g.add("stbl");return N.add("stsd").addEntry(b),N.add("stts").set("sample_counts",[]).set("sample_deltas",[]),N.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),N.add("stco").set("chunk_offsets",[]),N.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",a.id).set("default_sample_description_index",a.default_sample_description_index||1).set("default_sample_duration",a.default_sample_duration||0).set("default_sample_size",a.default_sample_size||0).set("default_sample_flags",a.default_sample_flags||0),this.buildTrakSampleLists(u),a.id}},o.Box.prototype.computeSize=function(r){var a=r||new n;a.endianness=n.BIG_ENDIAN,this.write(a)},x.prototype.addSample=function(r,a,u){var f=u||{},g={},b=this.getTrackById(r);if(b!==null){g.number=b.samples.length,g.track_id=b.tkhd.track_id,g.timescale=b.mdia.mdhd.timescale,g.description_index=f.sample_description_index?f.sample_description_index-1:0,g.description=b.mdia.minf.stbl.stsd.entries[g.description_index],g.data=a,g.size=a.byteLength,g.alreadyRead=g.size,g.duration=f.duration||1,g.cts=f.cts||0,g.dts=f.dts||0,g.is_sync=f.is_sync||!1,g.is_leading=f.is_leading||0,g.depends_on=f.depends_on||0,g.is_depended_on=f.is_depended_on||0,g.has_redundancy=f.has_redundancy||0,g.degradation_priority=f.degradation_priority||0,g.offset=0,g.subsamples=f.subsamples,b.samples.push(g),b.samples_size+=g.size,b.samples_duration+=g.duration,b.first_dts===void 0&&(b.first_dts=f.dts),this.processSamples();var S=this.createSingleSampleMoof(g);return this.addBox(S),S.computeSize(),S.trafs[0].truns[0].data_offset=S.size+8,this.add("mdat").data=new Uint8Array(a),g}},x.prototype.createSingleSampleMoof=function(r){var a=0;r.is_sync?a=1<<25:a=65536;var u=new o.moofBox;u.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var f=u.add("traf"),g=this.getTrackById(r.track_id);return f.add("tfhd").set("track_id",r.track_id).set("flags",o.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),f.add("tfdt").set("baseMediaDecodeTime",r.dts-(g.first_dts||0)),f.add("trun").set("flags",o.TRUN_FLAGS_DATA_OFFSET|o.TRUN_FLAGS_DURATION|o.TRUN_FLAGS_SIZE|o.TRUN_FLAGS_FLAGS|o.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[r.duration]).set("sample_size",[r.size]).set("sample_flags",[a]).set("sample_composition_time_offset",[r.cts-r.dts]),u},x.prototype.lastMoofIndex=0,x.prototype.samplesDataSize=0,x.prototype.resetTables=function(){var r,a,u,f,g,b,S,A;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,r=0;r<this.moov.traks.length;r++){a=this.moov.traks[r],a.tkhd.duration=0,a.mdia.mdhd.duration=0,u=a.mdia.minf.stbl.stco||a.mdia.minf.stbl.co64,u.chunk_offsets=[],f=a.mdia.minf.stbl.stsc,f.first_chunk=[],f.samples_per_chunk=[],f.sample_description_index=[],g=a.mdia.minf.stbl.stsz||a.mdia.minf.stbl.stz2,g.sample_sizes=[],b=a.mdia.minf.stbl.stts,b.sample_counts=[],b.sample_deltas=[],S=a.mdia.minf.stbl.ctts,S&&(S.sample_counts=[],S.sample_offsets=[]),A=a.mdia.minf.stbl.stss;var C=a.mdia.minf.stbl.boxes.indexOf(A);C!=-1&&(a.mdia.minf.stbl.boxes[C]=null)}},x.initSampleGroups=function(r,a,u,f,g){var b,S,A,C;function B(R,M,N){this.grouping_type=R,this.grouping_type_parameter=M,this.sbgp=N,this.last_sample_in_run=-1,this.entry_index=-1}for(a&&(a.sample_groups_info=[]),r.sample_groups_info||(r.sample_groups_info=[]),S=0;S<u.length;S++){for(C=u[S].grouping_type+"/"+u[S].grouping_type_parameter,A=new B(u[S].grouping_type,u[S].grouping_type_parameter,u[S]),a&&(a.sample_groups_info[C]=A),r.sample_groups_info[C]||(r.sample_groups_info[C]=A),b=0;b<f.length;b++)f[b].grouping_type===u[S].grouping_type&&(A.description=f[b],A.description.used=!0);if(g)for(b=0;b<g.length;b++)g[b].grouping_type===u[S].grouping_type&&(A.fragment_description=g[b],A.fragment_description.used=!0,A.is_fragment=!0)}if(a){if(g)for(S=0;S<g.length;S++)!g[S].used&&g[S].version>=2&&(C=g[S].grouping_type+"/0",A=new B(g[S].grouping_type,0),A.is_fragment=!0,a.sample_groups_info[C]||(a.sample_groups_info[C]=A))}else for(S=0;S<f.length;S++)!f[S].used&&f[S].version>=2&&(C=f[S].grouping_type+"/0",A=new B(f[S].grouping_type,0),r.sample_groups_info[C]||(r.sample_groups_info[C]=A))},x.setSampleGroupProperties=function(r,a,u,f){var g,b;a.sample_groups=[];for(g in f)if(a.sample_groups[g]={},a.sample_groups[g].grouping_type=f[g].grouping_type,a.sample_groups[g].grouping_type_parameter=f[g].grouping_type_parameter,u>=f[g].last_sample_in_run&&(f[g].last_sample_in_run<0&&(f[g].last_sample_in_run=0),f[g].entry_index++,f[g].entry_index<=f[g].sbgp.entries.length-1&&(f[g].last_sample_in_run+=f[g].sbgp.entries[f[g].entry_index].sample_count)),f[g].entry_index<=f[g].sbgp.entries.length-1?a.sample_groups[g].group_description_index=f[g].sbgp.entries[f[g].entry_index].group_description_index:a.sample_groups[g].group_description_index=-1,a.sample_groups[g].group_description_index!==0){var S;f[g].fragment_description?S=f[g].fragment_description:S=f[g].description,a.sample_groups[g].group_description_index>0?(a.sample_groups[g].group_description_index>65535?b=(a.sample_groups[g].group_description_index>>16)-1:b=a.sample_groups[g].group_description_index-1,S&&b>=0&&(a.sample_groups[g].description=S.entries[b])):S&&S.version>=2&&S.default_group_description_index>0&&(a.sample_groups[g].description=S.entries[S.default_group_description_index-1])}},x.process_sdtp=function(r,a,u){a&&(r?(a.is_leading=r.is_leading[u],a.depends_on=r.sample_depends_on[u],a.is_depended_on=r.sample_is_depended_on[u],a.has_redundancy=r.sample_has_redundancy[u]):(a.is_leading=0,a.depends_on=0,a.is_depended_on=0,a.has_redundancy=0))},x.prototype.buildSampleLists=function(){var r,a;for(r=0;r<this.moov.traks.length;r++)a=this.moov.traks[r],this.buildTrakSampleLists(a)},x.prototype.buildTrakSampleLists=function(r){var a,u,f,g,b,S,A,C,B,R,M,N,L,W,k,j,Y,ut,it,gt,Q,rt,Z,H;if(r.samples=[],r.samples_duration=0,r.samples_size=0,u=r.mdia.minf.stbl.stco||r.mdia.minf.stbl.co64,f=r.mdia.minf.stbl.stsc,g=r.mdia.minf.stbl.stsz||r.mdia.minf.stbl.stz2,b=r.mdia.minf.stbl.stts,S=r.mdia.minf.stbl.ctts,A=r.mdia.minf.stbl.stss,C=r.mdia.minf.stbl.stsd,B=r.mdia.minf.stbl.subs,N=r.mdia.minf.stbl.stdp,R=r.mdia.minf.stbl.sbgps,M=r.mdia.minf.stbl.sgpds,ut=-1,it=-1,gt=-1,Q=-1,rt=0,Z=0,H=0,x.initSampleGroups(r,null,R,M),!(typeof g>"u")){for(a=0;a<g.sample_sizes.length;a++){var G={};G.number=a,G.track_id=r.tkhd.track_id,G.timescale=r.mdia.mdhd.timescale,G.alreadyRead=0,r.samples[a]=G,G.size=g.sample_sizes[a],r.samples_size+=G.size,a===0?(W=1,L=0,G.chunk_index=W,G.chunk_run_index=L,Y=f.samples_per_chunk[L],j=0,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0):a<Y?(G.chunk_index=W,G.chunk_run_index=L):(W++,G.chunk_index=W,j=0,W<=k||(L++,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0),G.chunk_run_index=L,Y+=f.samples_per_chunk[L]),G.description_index=f.sample_description_index[G.chunk_run_index]-1,G.description=C.entries[G.description_index],G.offset=u.chunk_offsets[G.chunk_index-1]+j,j+=G.size,a>ut&&(it++,ut<0&&(ut=0),ut+=b.sample_counts[it]),a>0?(r.samples[a-1].duration=b.sample_deltas[it],r.samples_duration+=r.samples[a-1].duration,G.dts=r.samples[a-1].dts+r.samples[a-1].duration):G.dts=0,S?(a>=gt&&(Q++,gt<0&&(gt=0),gt+=S.sample_counts[Q]),G.cts=r.samples[a].dts+S.sample_offsets[Q]):G.cts=G.dts,A?(a==A.sample_numbers[rt]-1?(G.is_sync=!0,rt++):(G.is_sync=!1,G.degradation_priority=0),B&&B.entries[Z].sample_delta+H==a+1&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta,Z++)):G.is_sync=!0,x.process_sdtp(r.mdia.minf.stbl.sdtp,G,G.number),N?G.degradation_priority=N.priority[a]:G.degradation_priority=0,B&&B.entries[Z].sample_delta+H==a&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta),(R.length>0||M.length>0)&&x.setSampleGroupProperties(r,G,a,r.sample_groups_info)}a>0&&(r.samples[a-1].duration=Math.max(r.mdia.mdhd.duration-r.samples[a-1].dts,0),r.samples_duration+=r.samples[a-1].duration)}},x.prototype.updateSampleLists=function(){var r,a,u,f,g,b,S,A,C,B,R,M,N,L,W;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(C=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,C.type=="moof")for(B=C,r=0;r<B.trafs.length;r++){for(R=B.trafs[r],M=this.getTrackById(R.tfhd.track_id),N=this.getTrexById(R.tfhd.track_id),R.tfhd.flags&o.TFHD_FLAG_SAMPLE_DESC?f=R.tfhd.default_sample_description_index:f=N?N.default_sample_description_index:1,R.tfhd.flags&o.TFHD_FLAG_SAMPLE_DUR?g=R.tfhd.default_sample_duration:g=N?N.default_sample_duration:0,R.tfhd.flags&o.TFHD_FLAG_SAMPLE_SIZE?b=R.tfhd.default_sample_size:b=N?N.default_sample_size:0,R.tfhd.flags&o.TFHD_FLAG_SAMPLE_FLAGS?S=R.tfhd.default_sample_flags:S=N?N.default_sample_flags:0,R.sample_number=0,R.sbgps.length>0&&x.initSampleGroups(M,R,R.sbgps,M.mdia.minf.stbl.sgpds,R.sgpds),a=0;a<R.truns.length;a++){var k=R.truns[a];for(u=0;u<k.sample_count;u++){L={},L.moof_number=this.lastMoofIndex,L.number_in_traf=R.sample_number,R.sample_number++,L.number=M.samples.length,R.first_sample_index=M.samples.length,M.samples.push(L),L.track_id=M.tkhd.track_id,L.timescale=M.mdia.mdhd.timescale,L.description_index=f-1,L.description=M.mdia.minf.stbl.stsd.entries[L.description_index],L.size=b,k.flags&o.TRUN_FLAGS_SIZE&&(L.size=k.sample_size[u]),M.samples_size+=L.size,L.duration=g,k.flags&o.TRUN_FLAGS_DURATION&&(L.duration=k.sample_duration[u]),M.samples_duration+=L.duration,M.first_traf_merged||u>0?L.dts=M.samples[M.samples.length-2].dts+M.samples[M.samples.length-2].duration:(R.tfdt?L.dts=R.tfdt.baseMediaDecodeTime:L.dts=0,M.first_traf_merged=!0),L.cts=L.dts,k.flags&o.TRUN_FLAGS_CTS_OFFSET&&(L.cts=L.dts+k.sample_composition_time_offset[u]),W=S,k.flags&o.TRUN_FLAGS_FLAGS?W=k.sample_flags[u]:u===0&&k.flags&o.TRUN_FLAGS_FIRST_FLAG&&(W=k.first_sample_flags),L.is_sync=!(W>>16&1),L.is_leading=W>>26&3,L.depends_on=W>>24&3,L.is_depended_on=W>>22&3,L.has_redundancy=W>>20&3,L.degradation_priority=W&65535;var j=!!(R.tfhd.flags&o.TFHD_FLAG_BASE_DATA_OFFSET),Y=!!(R.tfhd.flags&o.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),ut=!!(k.flags&o.TRUN_FLAGS_DATA_OFFSET),it=0;j?it=R.tfhd.base_data_offset:Y||a===0?it=B.start:it=A,a===0&&u===0?ut?L.offset=it+k.data_offset:L.offset=it:L.offset=A,A=L.offset+L.size,(R.sbgps.length>0||R.sgpds.length>0||M.mdia.minf.stbl.sbgps.length>0||M.mdia.minf.stbl.sgpds.length>0)&&x.setSampleGroupProperties(M,L,L.number_in_traf,R.sample_groups_info)}}if(R.subs){M.has_fragment_subsamples=!0;var gt=R.first_sample_index;for(a=0;a<R.subs.entries.length;a++)gt+=R.subs.entries[a].sample_delta,L=M.samples[gt-1],L.subsamples=R.subs.entries[a].subsamples}}}},x.prototype.getSample=function(r,a){var u,f=r.samples[a];if(!this.moov)return null;if(!f.data)f.data=new Uint8Array(f.size),f.alreadyRead=0,this.samplesDataSize+=f.size,t.debug("ISOFile","Allocating sample #"+a+" on track #"+r.tkhd.track_id+" of size "+f.size+" (total: "+this.samplesDataSize+")");else if(f.alreadyRead==f.size)return f;for(;;){var g=this.stream.findPosition(!0,f.offset+f.alreadyRead,!1);if(g>-1){u=this.stream.buffers[g];var b=u.byteLength-(f.offset+f.alreadyRead-u.fileStart);if(f.size-f.alreadyRead<=b)return t.debug("ISOFile","Getting sample #"+a+" data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+(f.size-f.alreadyRead)+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,f.size-f.alreadyRead),u.usedBytes+=f.size-f.alreadyRead,this.stream.logBufferLevel(),f.alreadyRead=f.size,f;if(b===0)return null;t.debug("ISOFile","Getting sample #"+a+" partial data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+b+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,b),f.alreadyRead+=b,u.usedBytes+=b,this.stream.logBufferLevel()}else return null}},x.prototype.releaseSample=function(r,a){var u=r.samples[a];return u.data?(this.samplesDataSize-=u.size,u.data=null,u.alreadyRead=0,u.size):0},x.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},x.prototype.getCodecs=function(){var r,a="";for(r=0;r<this.moov.traks.length;r++){var u=this.moov.traks[r];r>0&&(a+=","),a+=u.mdia.minf.stbl.stsd.entries[0].getCodec()}return a},x.prototype.getTrexById=function(r){var a;if(!this.moov||!this.moov.mvex)return null;for(a=0;a<this.moov.mvex.trexs.length;a++){var u=this.moov.mvex.trexs[a];if(u.track_id==r)return u}return null},x.prototype.getTrackById=function(r){if(this.moov===void 0)return null;for(var a=0;a<this.moov.traks.length;a++){var u=this.moov.traks[a];if(u.tkhd.track_id==r)return u}return null},x.prototype.items=[],x.prototype.entity_groups=[],x.prototype.itemsDataSize=0,x.prototype.flattenItemInfo=function(){var r=this.items,a=this.entity_groups,u,f,g,b=this.meta;if(b!=null&&b.hdlr!==void 0&&b.iinf!==void 0){for(u=0;u<b.iinf.item_infos.length;u++)g={},g.id=b.iinf.item_infos[u].item_ID,r[g.id]=g,g.ref_to=[],g.name=b.iinf.item_infos[u].item_name,b.iinf.item_infos[u].protection_index>0&&(g.protection=b.ipro.protections[b.iinf.item_infos[u].protection_index-1]),b.iinf.item_infos[u].item_type?g.type=b.iinf.item_infos[u].item_type:g.type="mime",g.content_type=b.iinf.item_infos[u].content_type,g.content_encoding=b.iinf.item_infos[u].content_encoding;if(b.grpl)for(u=0;u<b.grpl.boxes.length;u++)entity_group={},entity_group.id=b.grpl.boxes[u].group_id,entity_group.entity_ids=b.grpl.boxes[u].entity_ids,entity_group.type=b.grpl.boxes[u].type,a[entity_group.id]=entity_group;if(b.iloc)for(u=0;u<b.iloc.items.length;u++){var S=b.iloc.items[u];switch(g=r[S.item_ID],S.data_reference_index!==0&&(t.warn("Item storage with reference to other files: not supported"),g.source=b.dinf.boxes[S.data_reference_index-1]),S.construction_method){case 0:break;case 1:t.warn("Item storage with construction_method : not supported");break;case 2:t.warn("Item storage with construction_method : not supported");break}for(g.extents=[],g.size=0,f=0;f<S.extents.length;f++)g.extents[f]={},g.extents[f].offset=S.extents[f].extent_offset+S.base_offset,g.extents[f].length=S.extents[f].extent_length,g.extents[f].alreadyRead=0,g.size+=g.extents[f].length}if(b.pitm&&(r[b.pitm.item_id].primary=!0),b.iref)for(u=0;u<b.iref.references.length;u++){var A=b.iref.references[u];for(f=0;f<A.references.length;f++)r[A.from_item_ID].ref_to.push({type:A.type,id:A.references[f]})}if(b.iprp)for(var C=0;C<b.iprp.ipmas.length;C++){var B=b.iprp.ipmas[C];for(u=0;u<B.associations.length;u++){var R=B.associations[u];if(g=r[R.id],g||(g=a[R.id]),g)for(g.properties===void 0&&(g.properties={},g.properties.boxes=[]),f=0;f<R.props.length;f++){var M=R.props[f];if(M.property_index>0&&M.property_index-1<b.iprp.ipco.boxes.length){var N=b.iprp.ipco.boxes[M.property_index-1];g.properties[N.type]=N,g.properties.boxes.push(N)}}}}}},x.prototype.getItem=function(r){var a,u;if(!this.meta)return null;if(u=this.items[r],!u.data&&u.size)u.data=new Uint8Array(u.size),u.alreadyRead=0,this.itemsDataSize+=u.size,t.debug("ISOFile","Allocating item #"+r+" of size "+u.size+" (total: "+this.itemsDataSize+")");else if(u.alreadyRead===u.size)return u;for(var f=0;f<u.extents.length;f++){var g=u.extents[f];if(g.alreadyRead!==g.length){var b=this.stream.findPosition(!0,g.offset+g.alreadyRead,!1);if(b>-1){a=this.stream.buffers[b];var S=a.byteLength-(g.offset+g.alreadyRead-a.fileStart);if(g.length-g.alreadyRead<=S)t.debug("ISOFile","Getting item #"+r+" extent #"+f+" data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+(g.length-g.alreadyRead)+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,g.length-g.alreadyRead),a.usedBytes+=g.length-g.alreadyRead,this.stream.logBufferLevel(),u.alreadyRead+=g.length-g.alreadyRead,g.alreadyRead=g.length;else return t.debug("ISOFile","Getting item #"+r+" extent #"+f+" partial data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+S+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,S),g.alreadyRead+=S,u.alreadyRead+=S,a.usedBytes+=S,this.stream.logBufferLevel(),null}else return null}}return u.alreadyRead===u.size?u:null},x.prototype.releaseItem=function(r){var a=this.items[r];if(a.data){this.itemsDataSize-=a.size,a.data=null,a.alreadyRead=0;for(var u=0;u<a.extents.length;u++){var f=a.extents[u];f.alreadyRead=0}return a.size}else return 0},x.prototype.processItems=function(r){for(var a in this.items){var u=this.items[a];this.getItem(u.id),r&&!u.sent&&(r(u),u.sent=!0,u.data=null)}},x.prototype.hasItem=function(r){for(var a in this.items){var u=this.items[a];if(u.name===r)return u.id}return-1},x.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},x.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},x.prototype.itemToFragmentedTrackFile=function(r){var a=r||{},u=null;if(a.itemId?u=this.getItem(a.itemId):u=this.getPrimaryItem(),u==null)return null;var f=new x;f.discardMdatData=!1;var g={type:u.type,description_boxes:u.properties.boxes};u.properties.ispe&&(g.width=u.properties.ispe.image_width,g.height=u.properties.ispe.image_height);var b=f.addTrack(g);return b?(f.addSample(b,u.data),f):null},x.prototype.write=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r)},x.prototype.createFragment=function(r,a,u){var f=this.getTrackById(r),g=this.getSample(f,a);if(g==null)return this.setNextSeekPositionFromSample(f.samples[a]),null;var b=u||new n;b.endianness=n.BIG_ENDIAN;var S=this.createSingleSampleMoof(g);S.write(b),S.trafs[0].truns[0].data_offset=S.size+8,t.debug("MP4Box","Adjusting data_offset with new value "+S.trafs[0].truns[0].data_offset),b.adjustUint32(S.trafs[0].truns[0].data_offset_position,S.trafs[0].truns[0].data_offset);var A=new o.mdatBox;return A.data=g.data,A.write(b),b},x.writeInitializationSegment=function(r,a,u,f){var g;t.debug("ISOFile","Generating initialization segment");var b=new n;b.endianness=n.BIG_ENDIAN,r.write(b);var S=a.add("mvex");for(u&&S.add("mehd").set("fragment_duration",u),g=0;g<a.traks.length;g++)S.add("trex").set("track_id",a.traks[g].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",f).set("default_sample_size",0).set("default_sample_flags",65536);return a.write(b),b.buffer},x.prototype.save=function(r){var a=new n;a.endianness=n.BIG_ENDIAN,this.write(a),a.save(r)},x.prototype.getBuffer=function(){var r=new n;return r.endianness=n.BIG_ENDIAN,this.write(r),r.buffer},x.prototype.initializeSegmentation=function(){var r,a,u,f;for(this.onSegment===null&&t.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),a=[],r=0;r<this.fragmentedTracks.length;r++){var g=new o.moovBox;g.mvhd=this.moov.mvhd,g.boxes.push(g.mvhd),u=this.getTrackById(this.fragmentedTracks[r].id),g.boxes.push(u),g.traks.push(u),f={},f.id=u.tkhd.track_id,f.user=this.fragmentedTracks[r].user,f.buffer=x.writeInitializationSegment(this.ftyp,g,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[r].samples.length>0?this.moov.traks[r].samples[0].duration:0),a.push(f)}return a},o.Box.prototype.printHeader=function(r){this.size+=8,this.size>l&&(this.size+=8),this.type==="uuid"&&(this.size+=16),r.log(r.indent+"size:"+this.size),r.log(r.indent+"type:"+this.type)},o.FullBox.prototype.printHeader=function(r){this.size+=4,o.Box.prototype.printHeader.call(this,r),r.log(r.indent+"version:"+this.version),r.log(r.indent+"flags:"+this.flags)},o.Box.prototype.print=function(r){this.printHeader(r)},o.ContainerBox.prototype.print=function(r){this.printHeader(r);for(var a=0;a<this.boxes.length;a++)if(this.boxes[a]){var u=r.indent;r.indent+=" ",this.boxes[a].print(r),r.indent=u}},x.prototype.print=function(r){r.indent="";for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&this.boxes[a].print(r)},o.mvhdBox.prototype.print=function(r){o.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"timescale: "+this.timescale),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"rate: "+this.rate),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"next_track_id: "+this.next_track_id)},o.tkhdBox.prototype.print=function(r){o.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"track_id: "+this.track_id),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"layer: "+this.layer),r.log(r.indent+"alternate_group: "+this.alternate_group),r.log(r.indent+"width: "+this.width),r.log(r.indent+"height: "+this.height)};var T={};T.createFile=function(r,a){var u=r!==void 0?r:!0,f=new x(a);return f.discardMdatData=!u,f},s.createFile=T.createFile})(Q0);const mp=Cc(Q0);var tx={};(function(s){var t=function(){var r=new Date,a=4,u=3,f=2,g=1,b=a,S={setLogLevel:function(A){A==this.debug?b=g:A==this.info?b=f:A==this.warn?b=u:(A==this.error,b=a)},debug:function(A,C){console.debug===void 0&&(console.debug=console.log),g>=b&&console.debug("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},log:function(A,C){this.debug(A.msg)},info:function(A,C){f>=b&&console.info("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},warn:function(A,C){u>=b&&console.warn("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},error:function(A,C){a>=b&&console.error("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)}};return S}();t.getDurationString=function(r,a){var u;function f(B,R){for(var M=""+B,N=M.split(".");N[0].length<R;)N[0]="0"+N[0];return N.join(".")}r<0?(u=!0,r=-r):u=!1;var g=a||1,b=r/g,S=Math.floor(b/3600);b-=S*3600;var A=Math.floor(b/60);b-=A*60;var C=b*1e3;return b=Math.floor(b),C-=b*1e3,C=Math.floor(C),(u?"-":"")+S+":"+f(A,2)+":"+f(b,2)+"."+f(C,3)},t.printRanges=function(r){var a=r.length;if(a>0){for(var u="",f=0;f<a;f++)f>0&&(u+=","),u+="["+t.getDurationString(r.start(f))+","+t.getDurationString(r.end(f))+"]";return u}else return"(empty)"},s.Log=t;var e=function(r){if(r instanceof ArrayBuffer)this.buffer=r,this.dataview=new DataView(r);else throw"Needs an array buffer";this.position=0};e.prototype.getPosition=function(){return this.position},e.prototype.getEndPosition=function(){return this.buffer.byteLength},e.prototype.getLength=function(){return this.buffer.byteLength},e.prototype.seek=function(r){var a=Math.max(0,Math.min(this.buffer.byteLength,r));return this.position=isNaN(a)||!isFinite(a)?0:a,!0},e.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},e.prototype.readAnyInt=function(r,a){var u=0;if(this.position+r<=this.buffer.byteLength){switch(r){case 1:a?u=this.dataview.getInt8(this.position):u=this.dataview.getUint8(this.position);break;case 2:a?u=this.dataview.getInt16(this.position):u=this.dataview.getUint16(this.position);break;case 3:if(a)throw"No method for reading signed 24 bits values";u=this.dataview.getUint8(this.position)<<16,u|=this.dataview.getUint8(this.position+1)<<8,u|=this.dataview.getUint8(this.position+2);break;case 4:a?u=this.dataview.getInt32(this.position):u=this.dataview.getUint32(this.position);break;case 8:if(a)throw"No method for reading signed 64 bits values";u=this.dataview.getUint32(this.position)<<32,u|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+r}return this.position+=r,u}else throw"Not enough bytes in buffer"},e.prototype.readUint8=function(){return this.readAnyInt(1,!1)},e.prototype.readUint16=function(){return this.readAnyInt(2,!1)},e.prototype.readUint24=function(){return this.readAnyInt(3,!1)},e.prototype.readUint32=function(){return this.readAnyInt(4,!1)},e.prototype.readUint64=function(){return this.readAnyInt(8,!1)},e.prototype.readString=function(r){if(this.position+r<=this.buffer.byteLength){for(var a="",u=0;u<r;u++)a+=String.fromCharCode(this.readUint8());return a}else throw"Not enough bytes in buffer"},e.prototype.readCString=function(){for(var r=[];;){var a=this.readUint8();if(a!==0)r.push(a);else break}return String.fromCharCode.apply(null,r)},e.prototype.readInt8=function(){return this.readAnyInt(1,!0)},e.prototype.readInt16=function(){return this.readAnyInt(2,!0)},e.prototype.readInt32=function(){return this.readAnyInt(4,!0)},e.prototype.readInt64=function(){return this.readAnyInt(8,!1)},e.prototype.readUint8Array=function(r){for(var a=new Uint8Array(r),u=0;u<r;u++)a[u]=this.readUint8();return a},e.prototype.readInt16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readInt16();return a},e.prototype.readUint16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readUint16();return a},e.prototype.readUint32Array=function(r){for(var a=new Uint32Array(r),u=0;u<r;u++)a[u]=this.readUint32();return a},e.prototype.readInt32Array=function(r){for(var a=new Int32Array(r),u=0;u<r;u++)a[u]=this.readInt32();return a},s.MP4BoxStream=e;var n=function(r,a,u){this._byteOffset=a||0,r instanceof ArrayBuffer?this.buffer=r:typeof r=="object"?(this.dataView=r,a&&(this._byteOffset+=a)):this.buffer=new ArrayBuffer(r||0),this.position=0,this.endianness=u??n.LITTLE_ENDIAN};n.prototype={},n.prototype.getPosition=function(){return this.position},n.prototype._realloc=function(r){if(this._dynamicSize){var a=this._byteOffset+this.position+r,u=this._buffer.byteLength;if(a<=u){a>this._byteLength&&(this._byteLength=a);return}for(u<1&&(u=1);a>u;)u*=2;var f=new ArrayBuffer(u),g=new Uint8Array(this._buffer),b=new Uint8Array(f,0,g.length);b.set(g),this.buffer=f,this._byteLength=a}},n.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var r=new ArrayBuffer(this._byteLength),a=new Uint8Array(r),u=new Uint8Array(this._buffer,0,a.length);a.set(u),this.buffer=r}},n.BIG_ENDIAN=!1,n.LITTLE_ENDIAN=!0,n.prototype._byteLength=0,Object.defineProperty(n.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(r){this._buffer=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(r){this._byteOffset=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"dataView",{get:function(){return this._dataView},set:function(r){this._byteOffset=r.byteOffset,this._buffer=r.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+r.byteLength}}),n.prototype.seek=function(r){var a=Math.max(0,Math.min(this.byteLength,r));this.position=isNaN(a)||!isFinite(a)?0:a},n.prototype.isEof=function(){return this.position>=this._byteLength},n.prototype.mapUint8Array=function(r){this._realloc(r*1);var a=new Uint8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.readInt32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Int32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Int16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt8Array=function(r){r=r??this.byteLength-this.position;var a=new Int8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readUint32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Uint32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Uint16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint8Array=function(r){r=r??this.byteLength-this.position;var a=new Uint8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readFloat64Array=function(r,a){r=r??this.byteLength-this.position/8;var u=new Float64Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readFloat32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Float32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt32=function(r){var a=this._dataView.getInt32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readInt16=function(r){var a=this._dataView.getInt16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readInt8=function(){var r=this._dataView.getInt8(this.position);return this.position+=1,r},n.prototype.readUint32=function(r){var a=this._dataView.getUint32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readUint16=function(r){var a=this._dataView.getUint16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readUint8=function(){var r=this._dataView.getUint8(this.position);return this.position+=1,r},n.prototype.readFloat32=function(r){var a=this._dataView.getFloat32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readFloat64=function(r){var a=this._dataView.getFloat64(this.position,r??this.endianness);return this.position+=8,a},n.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,n.memcpy=function(r,a,u,f,g){var b=new Uint8Array(r,a,g),S=new Uint8Array(u,f,g);b.set(S)},n.arrayToNative=function(r,a){return a==this.endianness?r:this.flipArrayEndianness(r)},n.nativeToEndian=function(r,a){return this.endianness==a?r:this.flipArrayEndianness(r)},n.flipArrayEndianness=function(r){for(var a=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),u=0;u<r.byteLength;u+=r.BYTES_PER_ELEMENT)for(var f=u+r.BYTES_PER_ELEMENT-1,g=u;f>g;f--,g++){var b=a[g];a[g]=a[f],a[f]=b}return r},n.prototype.failurePosition=0,String.fromCharCodeUint8=function(r){for(var a=[],u=0;u<r.length;u++)a[u]=r[u];return String.fromCharCode.apply(null,a)},n.prototype.readString=function(r,a){return a==null||a=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(r??this.byteLength-this.position)]):new TextDecoder(a).decode(this.mapUint8Array(r))},n.prototype.readCString=function(r){var a=this.byteLength-this.position,u=new Uint8Array(this._buffer,this._byteOffset+this.position),f=a;r!=null&&(f=Math.min(r,a));for(var g=0;g<f&&u[g]!==0;g++);var b=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(g)]);return r!=null?this.position+=f-g:g!=a&&(this.position+=1),b};var l=Math.pow(2,32);n.prototype.readInt64=function(){return this.readInt32()*l+this.readUint32()},n.prototype.readUint64=function(){return this.readUint32()*l+this.readUint32()},n.prototype.readInt64=function(){return this.readUint32()*l+this.readUint32()},n.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},s.DataStream=n,n.prototype.save=function(r){var a=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var u=window.URL.createObjectURL(a),f=document.createElement("a");document.body.appendChild(f),f.setAttribute("href",u),f.setAttribute("download",r),f.setAttribute("target","_self"),f.click(),window.URL.revokeObjectURL(u)}else throw"DataStream.save: Can't create object URL."},n.prototype._dynamicSize=!0,Object.defineProperty(n.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(r){r||this._trimAlloc(),this._dynamicSize=r}}),n.prototype.shift=function(r){var a=new ArrayBuffer(this._byteLength-r),u=new Uint8Array(a),f=new Uint8Array(this._buffer,r,u.length);u.set(f),this.buffer=a,this.position-=r},n.prototype.writeInt32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Int32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt32(r[u],a)},n.prototype.writeInt16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Int16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt16(r[u],a)},n.prototype.writeInt8Array=function(r){if(this._realloc(r.length*1),r instanceof Int8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt8Array(r.length);else for(var a=0;a<r.length;a++)this.writeInt8(r[a])},n.prototype.writeUint32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Uint32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint32(r[u],a)},n.prototype.writeUint16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Uint16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint16(r[u],a)},n.prototype.writeUint8Array=function(r){if(this._realloc(r.length*1),r instanceof Uint8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint8Array(r.length);else for(var a=0;a<r.length;a++)this.writeUint8(r[a])},n.prototype.writeFloat64Array=function(r,a){if(this._realloc(r.length*8),r instanceof Float64Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat64Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat64(r[u],a)},n.prototype.writeFloat32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Float32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat32(r[u],a)},n.prototype.writeInt32=function(r,a){this._realloc(4),this._dataView.setInt32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeInt16=function(r,a){this._realloc(2),this._dataView.setInt16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeInt8=function(r){this._realloc(1),this._dataView.setInt8(this.position,r),this.position+=1},n.prototype.writeUint32=function(r,a){this._realloc(4),this._dataView.setUint32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeUint16=function(r,a){this._realloc(2),this._dataView.setUint16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeUint8=function(r){this._realloc(1),this._dataView.setUint8(this.position,r),this.position+=1},n.prototype.writeFloat32=function(r,a){this._realloc(4),this._dataView.setFloat32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeFloat64=function(r,a){this._realloc(8),this._dataView.setFloat64(this.position,r,a??this.endianness),this.position+=8},n.prototype.writeUCS2String=function(r,a,u){u==null&&(u=r.length);for(var f=0;f<r.length&&f<u;f++)this.writeUint16(r.charCodeAt(f),a);for(;f<u;f++)this.writeUint16(0)},n.prototype.writeString=function(r,a,u){var f=0;if(a==null||a=="ASCII")if(u!=null){var g=Math.min(r.length,u);for(f=0;f<g;f++)this.writeUint8(r.charCodeAt(f));for(;f<u;f++)this.writeUint8(0)}else for(f=0;f<r.length;f++)this.writeUint8(r.charCodeAt(f));else this.writeUint8Array(new TextEncoder(a).encode(r.substring(0,u)))},n.prototype.writeCString=function(r,a){var u=0;if(a!=null){var f=Math.min(r.length,a);for(u=0;u<f;u++)this.writeUint8(r.charCodeAt(u));for(;u<a;u++)this.writeUint8(0)}else{for(u=0;u<r.length;u++)this.writeUint8(r.charCodeAt(u));this.writeUint8(0)}},n.prototype.writeStruct=function(r,a){for(var u=0;u<r.length;u+=2){var f=r[u+1];this.writeType(f,a[r[u]],a)}},n.prototype.writeType=function(r,a,u){var f;if(typeof r=="function")return r(this,a);if(typeof r=="object"&&!(r instanceof Array))return r.set(this,a,u);var g=null,b="ASCII",S=this.position;switch(typeof r=="string"&&/:/.test(r)&&(f=r.split(":"),r=f[0],g=parseInt(f[1])),typeof r=="string"&&/,/.test(r)&&(f=r.split(","),r=f[0],b=parseInt(f[1])),r){case"uint8":this.writeUint8(a);break;case"int8":this.writeInt8(a);break;case"uint16":this.writeUint16(a,this.endianness);break;case"int16":this.writeInt16(a,this.endianness);break;case"uint32":this.writeUint32(a,this.endianness);break;case"int32":this.writeInt32(a,this.endianness);break;case"float32":this.writeFloat32(a,this.endianness);break;case"float64":this.writeFloat64(a,this.endianness);break;case"uint16be":this.writeUint16(a,n.BIG_ENDIAN);break;case"int16be":this.writeInt16(a,n.BIG_ENDIAN);break;case"uint32be":this.writeUint32(a,n.BIG_ENDIAN);break;case"int32be":this.writeInt32(a,n.BIG_ENDIAN);break;case"float32be":this.writeFloat32(a,n.BIG_ENDIAN);break;case"float64be":this.writeFloat64(a,n.BIG_ENDIAN);break;case"uint16le":this.writeUint16(a,n.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(a,n.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(a,n.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(a,n.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(a,n.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(a,n.LITTLE_ENDIAN);break;case"cstring":this.writeCString(a,g);break;case"string":this.writeString(a,b,g);break;case"u16string":this.writeUCS2String(a,this.endianness,g);break;case"u16stringle":this.writeUCS2String(a,n.LITTLE_ENDIAN,g);break;case"u16stringbe":this.writeUCS2String(a,n.BIG_ENDIAN,g);break;default:if(r.length==3){for(var A=r[1],C=0;C<a.length;C++)this.writeType(A,a[C]);break}else{this.writeStruct(r,a);break}}g!=null&&(this.position=S,this._realloc(g),this.position=S+g)},n.prototype.writeUint64=function(r){var a=Math.floor(r/l);this.writeUint32(a),this.writeUint32(r&4294967295)},n.prototype.writeUint24=function(r){this.writeUint8((r&16711680)>>16),this.writeUint8((r&65280)>>8),this.writeUint8(r&255)},n.prototype.adjustUint32=function(r,a){var u=this.position;this.seek(r),this.writeUint32(a),this.seek(u)},n.prototype.mapInt32Array=function(r,a){this._realloc(r*4);var u=new Int32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapInt16Array=function(r,a){this._realloc(r*2);var u=new Int16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapInt8Array=function(r){this._realloc(r*1);var a=new Int8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.mapUint32Array=function(r,a){this._realloc(r*4);var u=new Uint32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapUint16Array=function(r,a){this._realloc(r*2);var u=new Uint16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapFloat64Array=function(r,a){this._realloc(r*8);var u=new Float64Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*8,u},n.prototype.mapFloat32Array=function(r,a){this._realloc(r*4);var u=new Float32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u};var h=function(r){this.buffers=[],this.bufferIndex=-1,r&&(this.insertBuffer(r),this.bufferIndex=0)};h.prototype=new n(new ArrayBuffer,0,n.BIG_ENDIAN),h.prototype.initialized=function(){var r;return this.bufferIndex>-1?!0:this.buffers.length>0?(r=this.buffers[0],r.fileStart===0?(this.buffer=r,this.bufferIndex=0,t.debug("MultiBufferStream","Stream ready for parsing"),!0):(t.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(t.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(r,a){t.debug("ArrayBuffer","Trying to create a new buffer of size: "+(r.byteLength+a.byteLength));var u=new Uint8Array(r.byteLength+a.byteLength);return u.set(new Uint8Array(r),0),u.set(new Uint8Array(a),r.byteLength),u.buffer},h.prototype.reduceBuffer=function(r,a,u){var f;return f=new Uint8Array(u),f.set(new Uint8Array(r,a,u)),f.buffer.fileStart=r.fileStart+a,f.buffer.usedBytes=0,f.buffer},h.prototype.insertBuffer=function(r){for(var a=!0,u=0;u<this.buffers.length;u++){var f=this.buffers[u];if(r.fileStart<=f.fileStart){if(r.fileStart===f.fileStart)if(r.byteLength>f.byteLength){this.buffers.splice(u,1),u--;continue}else t.warn("MultiBufferStream","Buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+") already appended, ignoring");else r.fileStart+r.byteLength<=f.fileStart||(r=this.reduceBuffer(r,0,f.fileStart-r.fileStart)),t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.splice(u,0,r),u===0&&(this.buffer=r);a=!1;break}else if(r.fileStart<f.fileStart+f.byteLength){var g=f.fileStart+f.byteLength-r.fileStart,b=r.byteLength-g;if(b>0)r=this.reduceBuffer(r,g,b);else{a=!1;break}}}a&&(t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.push(r),u===0&&(this.buffer=r))},h.prototype.logBufferLevel=function(r){var a,u,f,g,b=[],S,A="";for(f=0,g=0,a=0;a<this.buffers.length;a++)u=this.buffers[a],a===0?(S={},b.push(S),S.start=u.fileStart,S.end=u.fileStart+u.byteLength,A+="["+S.start+"-"):S.end===u.fileStart?S.end=u.fileStart+u.byteLength:(S={},S.start=u.fileStart,A+=b[b.length-1].end-1+"], ["+S.start+"-",S.end=u.fileStart+u.byteLength,b.push(S)),f+=u.usedBytes,g+=u.byteLength;b.length>0&&(A+=S.end-1+"]");var C=r?t.info:t.debug;this.buffers.length===0?C("MultiBufferStream","No more buffer in memory"):C("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+f+"/"+g+" bytes), continuous ranges: "+A)},h.prototype.cleanBuffers=function(){var r,a;for(r=0;r<this.buffers.length;r++)a=this.buffers[r],a.usedBytes===a.byteLength&&(t.debug("MultiBufferStream","Removing buffer #"+r),this.buffers.splice(r,1),r--)},h.prototype.mergeNextBuffer=function(){var r;if(this.bufferIndex+1<this.buffers.length)if(r=this.buffers[this.bufferIndex+1],r.fileStart===this.buffer.fileStart+this.buffer.byteLength){var a=this.buffer.byteLength,u=this.buffer.usedBytes,f=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,r),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=u,this.buffer.fileStart=f,t.debug("ISOFile","Concatenating buffer for box parsing (length: "+a+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},h.prototype.findPosition=function(r,a,u){var f,g=null,b=-1;for(r===!0?f=0:f=this.bufferIndex;f<this.buffers.length&&(g=this.buffers[f],g.fileStart<=a);){b=f,u&&(g.fileStart+g.byteLength<=a?g.usedBytes=g.byteLength:g.usedBytes=a-g.fileStart,this.logBufferLevel());f++}return b!==-1?(g=this.buffers[b],g.fileStart+g.byteLength>=a?(t.debug("MultiBufferStream","Found position in existing buffer #"+b),b):-1):-1},h.prototype.findEndContiguousBuf=function(r){var a,u,f,g=r!==void 0?r:this.bufferIndex;if(u=this.buffers[g],this.buffers.length>g+1)for(a=g+1;a<this.buffers.length&&(f=this.buffers[a],f.fileStart===u.fileStart+u.byteLength);a++)u=f;return u.fileStart+u.byteLength},h.prototype.getEndFilePositionAfter=function(r){var a=this.findPosition(!0,r,!1);return a!==-1?this.findEndContiguousBuf(a):r},h.prototype.addUsedBytes=function(r){this.buffer.usedBytes+=r,this.logBufferLevel()},h.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},h.prototype.seek=function(r,a,u){var f;return f=this.findPosition(a,r,u),f!==-1?(this.buffer=this.buffers[f],this.bufferIndex=f,this.position=r-this.buffer.fileStart,t.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(t.debug("MultiBufferStream","Position "+r+" not found in buffered data"),!1)},h.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},h.prototype.getLength=function(){return this.byteLength},h.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},s.MultiBufferStream=h;var d=function(){var r=3,a=4,u=5,f=6,g=[];g[r]="ES_Descriptor",g[a]="DecoderConfigDescriptor",g[u]="DecoderSpecificInfo",g[f]="SLConfigDescriptor",this.getDescriptorName=function(A){return g[A]};var b=this,S={};return this.parseOneDescriptor=function(A){var C=0,B,R,M;for(B=A.readUint8(),M=A.readUint8();M&128;)C=(M&127)<<7,M=A.readUint8();return C+=M&127,t.debug("MPEG4DescriptorParser","Found "+(g[B]||"Descriptor "+B)+", size "+C+" at position "+A.getPosition()),g[B]?R=new S[g[B]](C):R=new S.Descriptor(C),R.parse(A),R},S.Descriptor=function(A,C){this.tag=A,this.size=C,this.descs=[]},S.Descriptor.prototype.parse=function(A){this.data=A.readUint8Array(this.size)},S.Descriptor.prototype.findDescriptor=function(A){for(var C=0;C<this.descs.length;C++)if(this.descs[C].tag==A)return this.descs[C];return null},S.Descriptor.prototype.parseRemainingDescriptors=function(A){for(var C=A.position;A.position<C+this.size;){var B=b.parseOneDescriptor(A);this.descs.push(B)}},S.ES_Descriptor=function(A){S.Descriptor.call(this,r,A)},S.ES_Descriptor.prototype=new S.Descriptor,S.ES_Descriptor.prototype.parse=function(A){if(this.ES_ID=A.readUint16(),this.flags=A.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=A.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var C=A.readUint8();this.URL=A.readString(C),this.size-=C+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=A.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(A)},S.ES_Descriptor.prototype.getOTI=function(A){var C=this.findDescriptor(a);return C?C.oti:0},S.ES_Descriptor.prototype.getAudioConfig=function(A){var C=this.findDescriptor(a);if(!C)return null;var B=C.findDescriptor(u);if(B&&B.data){var R=(B.data[0]&248)>>3;return R===31&&B.data.length>=2&&(R=32+((B.data[0]&7)<<3)+((B.data[1]&224)>>5)),R}else return null},S.DecoderConfigDescriptor=function(A){S.Descriptor.call(this,a,A)},S.DecoderConfigDescriptor.prototype=new S.Descriptor,S.DecoderConfigDescriptor.prototype.parse=function(A){this.oti=A.readUint8(),this.streamType=A.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=A.readUint24(),this.maxBitrate=A.readUint32(),this.avgBitrate=A.readUint32(),this.size-=13,this.parseRemainingDescriptors(A)},S.DecoderSpecificInfo=function(A){S.Descriptor.call(this,u,A)},S.DecoderSpecificInfo.prototype=new S.Descriptor,S.SLConfigDescriptor=function(A){S.Descriptor.call(this,f,A)},S.SLConfigDescriptor.prototype=new S.Descriptor,this};s.MPEG4DescriptorParser=d;var o={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"],["grpl"],["j2kH"],["etyp",["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){o.FullBox.prototype=new o.Box,o.ContainerBox.prototype=new o.Box,o.SampleEntry.prototype=new o.Box,o.TrackGroupTypeBox.prototype=new o.FullBox,o.BASIC_BOXES.forEach(function(r){o.createBoxCtor(r)}),o.FULL_BOXES.forEach(function(r){o.createFullBoxCtor(r)}),o.CONTAINER_BOXES.forEach(function(r){o.createContainerBoxCtor(r[0],null,r[1])})},Box:function(r,a,u){this.type=r,this.size=a,this.uuid=u},FullBox:function(r,a,u){o.Box.call(this,r,a,u),this.flags=0,this.version=0},ContainerBox:function(r,a,u){o.Box.call(this,r,a,u),this.boxes=[]},SampleEntry:function(r,a,u,f){o.ContainerBox.call(this,r,a),this.hdr_size=u,this.start=f},SampleGroupEntry:function(r){this.grouping_type=r},TrackGroupTypeBox:function(r,a){o.FullBox.call(this,r,a)},createBoxCtor:function(r,a){o.boxCodes.push(r),o[r+"Box"]=function(u){o.Box.call(this,r,u)},o[r+"Box"].prototype=new o.Box,a&&(o[r+"Box"].prototype.parse=a)},createFullBoxCtor:function(r,a){o[r+"Box"]=function(u){o.FullBox.call(this,r,u)},o[r+"Box"].prototype=new o.FullBox,o[r+"Box"].prototype.parse=function(u){this.parseFullHeader(u),a&&a.call(this,u)}},addSubBoxArrays:function(r){if(r){this.subBoxNames=r;for(var a=r.length,u=0;u<a;u++)this[r[u]+"s"]=[]}},createContainerBoxCtor:function(r,a,u){o[r+"Box"]=function(f){o.ContainerBox.call(this,r,f),o.addSubBoxArrays.call(this,u)},o[r+"Box"].prototype=new o.ContainerBox,a&&(o[r+"Box"].prototype.parse=a)},createMediaSampleEntryCtor:function(r,a,u){o.sampleEntryCodes[r]=[],o[r+"SampleEntry"]=function(f,g){o.SampleEntry.call(this,f,g),o.addSubBoxArrays.call(this,u)},o[r+"SampleEntry"].prototype=new o.SampleEntry,a&&(o[r+"SampleEntry"].prototype.parse=a)},createSampleEntryCtor:function(r,a,u,f){o.sampleEntryCodes[r].push(a),o[a+"SampleEntry"]=function(g){o[r+"SampleEntry"].call(this,a,g),o.addSubBoxArrays.call(this,f)},o[a+"SampleEntry"].prototype=new o[r+"SampleEntry"],u&&(o[a+"SampleEntry"].prototype.parse=u)},createEncryptedSampleEntryCtor:function(r,a,u){o.createSampleEntryCtor.call(this,r,a,u,["sinf"])},createSampleGroupCtor:function(r,a){o[r+"SampleGroupEntry"]=function(u){o.SampleGroupEntry.call(this,r,u)},o[r+"SampleGroupEntry"].prototype=new o.SampleGroupEntry,a&&(o[r+"SampleGroupEntry"].prototype.parse=a)},createTrackGroupCtor:function(r,a){o[r+"TrackGroupTypeBox"]=function(u){o.TrackGroupTypeBox.call(this,r,u)},o[r+"TrackGroupTypeBox"].prototype=new o.TrackGroupTypeBox,a&&(o[r+"TrackGroupTypeBox"].prototype.parse=a)},createUUIDBox:function(r,a,u,f){o.UUIDs.push(r),o.UUIDBoxes[r]=function(g){a?o.FullBox.call(this,"uuid",g,r):u?o.ContainerBox.call(this,"uuid",g,r):o.Box.call(this,"uuid",g,r)},o.UUIDBoxes[r].prototype=a?new o.FullBox:u?new o.ContainerBox:new o.Box,f&&(a?o.UUIDBoxes[r].prototype.parse=function(g){this.parseFullHeader(g),f&&f.call(this,g)}:o.UUIDBoxes[r].prototype.parse=f)}};o.initialize(),o.TKHD_FLAG_ENABLED=1,o.TKHD_FLAG_IN_MOVIE=2,o.TKHD_FLAG_IN_PREVIEW=4,o.TFHD_FLAG_BASE_DATA_OFFSET=1,o.TFHD_FLAG_SAMPLE_DESC=2,o.TFHD_FLAG_SAMPLE_DUR=8,o.TFHD_FLAG_SAMPLE_SIZE=16,o.TFHD_FLAG_SAMPLE_FLAGS=32,o.TFHD_FLAG_DUR_EMPTY=65536,o.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,o.TRUN_FLAGS_DATA_OFFSET=1,o.TRUN_FLAGS_FIRST_FLAG=4,o.TRUN_FLAGS_DURATION=256,o.TRUN_FLAGS_SIZE=512,o.TRUN_FLAGS_FLAGS=1024,o.TRUN_FLAGS_CTS_OFFSET=2048,o.Box.prototype.add=function(r){return this.addBox(new o[r+"Box"])},o.Box.prototype.addBox=function(r){return this.boxes.push(r),this[r.type+"s"]?this[r.type+"s"].push(r):this[r.type]=r,r},o.Box.prototype.set=function(r,a){return this[r]=a,this},o.Box.prototype.addEntry=function(r,a){var u=a||"entries";return this[u]||(this[u]=[]),this[u].push(r),this},s.BoxParser=o,o.parseUUID=function(r){return o.parseHex16(r)},o.parseHex16=function(r){for(var a="",u=0;u<16;u++){var f=r.readUint8().toString(16);a+=f.length===1?"0"+f:f}return a},o.parseOneBox=function(r,a,u){var f,g=r.getPosition(),b=0,S,A;if(r.getEndPosition()-g<8)return t.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:o.ERR_NOT_ENOUGH_DATA};if(u&&u<8)return t.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:o.ERR_NOT_ENOUGH_DATA};var C=r.readUint32(),B=r.readString(4),R=B;if(t.debug("BoxParser","Found box of type '"+B+"' and size "+C+" at position "+g),b=8,B=="uuid"){if(r.getEndPosition()-r.getPosition()<16||u-b<16)return r.seek(g),t.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:o.ERR_NOT_ENOUGH_DATA};A=o.parseUUID(r),b+=16,R=A}if(C==1){if(r.getEndPosition()-r.getPosition()<8||u&&u-b<8)return r.seek(g),t.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+B+'" box'),{code:o.ERR_NOT_ENOUGH_DATA};C=r.readUint64(),b+=8}else if(C===0){if(u)C=u;else if(B!=="mdat")return t.error("BoxParser","Unlimited box size not supported for type: '"+B+"'"),f=new o.Box(B,C),{code:o.OK,box:f,size:f.size}}return C!==0&&C<b?(t.error("BoxParser","Box of type "+B+" has an invalid size "+C+" (too small to be a box)"),{code:o.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:b,start:g}):C!==0&&u&&C>u?(t.error("BoxParser","Box of type '"+B+"' has a size "+C+" greater than its container size "+u),{code:o.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:b,start:g}):C!==0&&g+C>r.getEndPosition()?(r.seek(g),t.info("BoxParser","Not enough data in stream to parse the entire '"+B+"' box"),{code:o.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:b,start:g}):a?{code:o.OK,type:B,size:C,hdr_size:b,start:g}:(o[B+"Box"]?f=new o[B+"Box"](C):B!=="uuid"?(t.warn("BoxParser","Unknown box type: '"+B+"'"),f=new o.Box(B,C),f.has_unparsed_data=!0):o.UUIDBoxes[A]?f=new o.UUIDBoxes[A](C):(t.warn("BoxParser","Unknown uuid type: '"+A+"'"),f=new o.Box(B,C),f.uuid=A,f.has_unparsed_data=!0),f.hdr_size=b,f.start=g,f.write===o.Box.prototype.write&&f.type!=="mdat"&&(t.info("BoxParser","'"+R+"' box writing not yet implemented, keeping unparsed data in memory for later write"),f.parseDataAndRewind(r)),f.parse(r),S=r.getPosition()-(f.start+f.size),S<0?(t.warn("BoxParser","Parsing of box '"+R+"' did not read the entire indicated box data size (missing "+-S+" bytes), seeking forward"),r.seek(f.start+f.size)):S>0&&(t.error("BoxParser","Parsing of box '"+R+"' read "+S+" more bytes than the indicated box data size, seeking backwards"),f.size!==0&&r.seek(f.start+f.size)),{code:o.OK,box:f,size:f.size})},o.Box.prototype.parse=function(r){this.type!="mdat"?this.data=r.readUint8Array(this.size-this.hdr_size):this.size===0?r.seek(r.getEndPosition()):r.seek(this.start+this.size)},o.Box.prototype.parseDataAndRewind=function(r){this.data=r.readUint8Array(this.size-this.hdr_size),r.position-=this.size-this.hdr_size},o.FullBox.prototype.parseDataAndRewind=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,r.position-=this.size-this.hdr_size},o.FullBox.prototype.parseFullHeader=function(r){this.version=r.readUint8(),this.flags=r.readUint24(),this.hdr_size+=4},o.FullBox.prototype.parse=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},o.ContainerBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===o.OK)if(u=a.box,this.boxes.push(u),this.subBoxNames&&this.subBoxNames.indexOf(u.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(u.type)]+"s"].push(u);else{var f=u.type!=="uuid"?u.type:u.uuid;this[f]?t.warn("Box of type "+f+" already stored in field of this type"):this[f]=u}else return},o.Box.prototype.parseLanguage=function(r){this.language=r.readUint16();var a=[];a[0]=this.language>>10&31,a[1]=this.language>>5&31,a[2]=this.language&31,this.languageString=String.fromCharCode(a[0]+96,a[1]+96,a[2]+96)},o.SAMPLE_ENTRY_TYPE_VISUAL="Visual",o.SAMPLE_ENTRY_TYPE_AUDIO="Audio",o.SAMPLE_ENTRY_TYPE_HINT="Hint",o.SAMPLE_ENTRY_TYPE_METADATA="Metadata",o.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",o.SAMPLE_ENTRY_TYPE_SYSTEM="System",o.SAMPLE_ENTRY_TYPE_TEXT="Text",o.SampleEntry.prototype.parseHeader=function(r){r.readUint8Array(6),this.data_reference_index=r.readUint16(),this.hdr_size+=8},o.SampleEntry.prototype.parse=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},o.SampleEntry.prototype.parseDataAndRewind=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,r.position-=this.size-this.hdr_size},o.SampleEntry.prototype.parseFooter=function(r){o.ContainerBox.prototype.parse.call(this,r)},o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_HINT),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SYSTEM),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_TEXT),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,function(r){var a;this.parseHeader(r),r.readUint16(),r.readUint16(),r.readUint32Array(3),this.width=r.readUint16(),this.height=r.readUint16(),this.horizresolution=r.readUint32(),this.vertresolution=r.readUint32(),r.readUint32(),this.frame_count=r.readUint16(),a=Math.min(31,r.readUint8()),this.compressorname=r.readString(a),a<31&&r.readString(31-a),this.depth=r.readUint16(),r.readUint16(),this.parseFooter(r)}),o.createMediaSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,function(r){this.parseHeader(r),r.readUint32Array(2),this.channel_count=r.readUint16(),this.samplesize=r.readUint16(),r.readUint16(),r.readUint16(),this.samplerate=r.readUint32()/65536,this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_TEXT,"enct"),o.createEncryptedSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"encm"),o.createBoxCtor("a1lx",function(r){var a=r.readUint8()&1,u=((a&1)+1)*16;this.layer_size=[];for(var f=0;f<3;f++)u==16?this.layer_size[f]=r.readUint16():this.layer_size[f]=r.readUint32()}),o.createBoxCtor("a1op",function(r){this.op_index=r.readUint8()}),o.createFullBoxCtor("auxC",function(r){this.aux_type=r.readCString();var a=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=r.readUint8Array(a)}),o.createBoxCtor("av1C",function(r){var a=r.readUint8();if(a>>7&!1){t.error("av1C marker problem");return}if(this.version=a&127,this.version!==1){t.error("av1C version "+this.version+" not supported");return}if(a=r.readUint8(),this.seq_profile=a>>5&7,this.seq_level_idx_0=a&31,a=r.readUint8(),this.seq_tier_0=a>>7&1,this.high_bitdepth=a>>6&1,this.twelve_bit=a>>5&1,this.monochrome=a>>4&1,this.chroma_subsampling_x=a>>3&1,this.chroma_subsampling_y=a>>2&1,this.chroma_sample_position=a&3,a=r.readUint8(),this.reserved_1=a>>5&7,this.reserved_1!==0){t.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=a>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=a&15;else if(this.reserved_2=a&15,this.reserved_2!==0){t.error("av1C reserved_2 parsing problem");return}var u=this.size-this.hdr_size-4;this.configOBUs=r.readUint8Array(u)}),o.createBoxCtor("avcC",function(r){var a,u;for(this.configurationVersion=r.readUint8(),this.AVCProfileIndication=r.readUint8(),this.profile_compatibility=r.readUint8(),this.AVCLevelIndication=r.readUint8(),this.lengthSizeMinusOne=r.readUint8()&3,this.nb_SPS_nalus=r.readUint8()&31,u=this.size-this.hdr_size-6,this.SPS=[],a=0;a<this.nb_SPS_nalus;a++)this.SPS[a]={},this.SPS[a].length=r.readUint16(),this.SPS[a].nalu=r.readUint8Array(this.SPS[a].length),u-=2+this.SPS[a].length;for(this.nb_PPS_nalus=r.readUint8(),u--,this.PPS=[],a=0;a<this.nb_PPS_nalus;a++)this.PPS[a]={},this.PPS[a].length=r.readUint16(),this.PPS[a].nalu=r.readUint8Array(this.PPS[a].length),u-=2+this.PPS[a].length;u>0&&(this.ext=r.readUint8Array(u))}),o.createBoxCtor("btrt",function(r){this.bufferSizeDB=r.readUint32(),this.maxBitrate=r.readUint32(),this.avgBitrate=r.readUint32()}),o.createFullBoxCtor("ccst",function(r){var a=r.readUint8();this.all_ref_pics_intra=(a&128)==128,this.intra_pred_used=(a&64)==64,this.max_ref_per_pic=(a&63)>>2,r.readUint24()}),o.createBoxCtor("cdef",function(r){var a;for(this.channel_count=r.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],a=0;a<this.channel_count;a++)this.channel_indexes.push(r.readUint16()),this.channel_types.push(r.readUint16()),this.channel_associations.push(r.readUint16())}),o.createBoxCtor("clap",function(r){this.cleanApertureWidthN=r.readUint32(),this.cleanApertureWidthD=r.readUint32(),this.cleanApertureHeightN=r.readUint32(),this.cleanApertureHeightD=r.readUint32(),this.horizOffN=r.readUint32(),this.horizOffD=r.readUint32(),this.vertOffN=r.readUint32(),this.vertOffD=r.readUint32()}),o.createBoxCtor("clli",function(r){this.max_content_light_level=r.readUint16(),this.max_pic_average_light_level=r.readUint16()}),o.createFullBoxCtor("cmex",function(r){this.flags&1&&(this.pos_x=r.readInt32()),this.flags&2&&(this.pos_y=r.readInt32()),this.flags&4&&(this.pos_z=r.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=r.readInt32(),this.quat_y=r.readInt32(),this.quat_z=r.readInt32()):(this.quat_x=r.readInt16(),this.quat_y=r.readInt16(),this.quat_z=r.readInt16()):this.version==1),this.flags&32&&(this.id=r.readUint32())}),o.createFullBoxCtor("cmin",function(r){this.focal_length_x=r.readInt32(),this.principal_point_x=r.readInt32(),this.principal_point_y=r.readInt32(),this.flags&1&&(this.focal_length_y=r.readInt32(),this.skew_factor=r.readInt32())}),o.createBoxCtor("cmpd",function(r){for(this.component_count=r.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var a=r.readUint16();this.component_types.push(a),a>=32768&&this.component_type_urls.push(r.readCString())}}),o.createFullBoxCtor("co64",function(r){var a,u;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(u=0;u<a;u++)this.chunk_offsets.push(r.readUint64())}),o.createFullBoxCtor("CoLL",function(r){this.maxCLL=r.readUint16(),this.maxFALL=r.readUint16()}),o.createBoxCtor("colr",function(r){if(this.colour_type=r.readString(4),this.colour_type==="nclx"){this.colour_primaries=r.readUint16(),this.transfer_characteristics=r.readUint16(),this.matrix_coefficients=r.readUint16();var a=r.readUint8();this.full_range_flag=a>>7}else this.colour_type==="rICC"?this.ICC_profile=r.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=r.readUint8Array(this.size-4))}),o.createFullBoxCtor("cprt",function(r){this.parseLanguage(r),this.notice=r.readCString()}),o.createFullBoxCtor("cslg",function(r){this.version===0&&(this.compositionToDTSShift=r.readInt32(),this.leastDecodeToDisplayDelta=r.readInt32(),this.greatestDecodeToDisplayDelta=r.readInt32(),this.compositionStartTime=r.readInt32(),this.compositionEndTime=r.readInt32())}),o.createFullBoxCtor("ctts",function(r){var a,u;if(a=r.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(u=0;u<a;u++){this.sample_counts.push(r.readUint32());var f=r.readInt32();f<0&&t.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(f)}else if(this.version==1)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),this.sample_offsets.push(r.readInt32())}),o.createBoxCtor("dac3",function(r){var a=r.readUint8(),u=r.readUint8(),f=r.readUint8();this.fscod=a>>6,this.bsid=a>>1&31,this.bsmod=(a&1)<<2|u>>6&3,this.acmod=u>>3&7,this.lfeon=u>>2&1,this.bit_rate_code=u&3|f>>5&7}),o.createBoxCtor("dec3",function(r){var a=r.readUint16();this.data_rate=a>>3,this.num_ind_sub=a&7,this.ind_subs=[];for(var u=0;u<this.num_ind_sub+1;u++){var f={};this.ind_subs.push(f);var g=r.readUint8(),b=r.readUint8(),S=r.readUint8();f.fscod=g>>6,f.bsid=g>>1&31,f.bsmod=(g&1)<<4|b>>4&15,f.acmod=b>>1&7,f.lfeon=b&1,f.num_dep_sub=S>>1&15,f.num_dep_sub>0&&(f.chan_loc=(S&1)<<8|r.readUint8())}}),o.createFullBoxCtor("dfLa",function(r){var a=127,u=128,f=[],g=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var b=r.readUint8(),S=Math.min(b&a,g.length-1);if(S?r.readUint8Array(r.readUint24()):(r.readUint8Array(13),this.samplerate=r.readUint32()>>12,r.readUint8Array(20)),f.push(g[S]),b&u)break}while(!0);this.numMetadataBlocks=f.length+" ("+f.join(", ")+")"}),o.createBoxCtor("dimm",function(r){this.bytessent=r.readUint64()}),o.createBoxCtor("dmax",function(r){this.time=r.readUint32()}),o.createBoxCtor("dmed",function(r){this.bytessent=r.readUint64()}),o.createBoxCtor("dOps",function(r){if(this.Version=r.readUint8(),this.OutputChannelCount=r.readUint8(),this.PreSkip=r.readUint16(),this.InputSampleRate=r.readUint32(),this.OutputGain=r.readInt16(),this.ChannelMappingFamily=r.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=r.readUint8(),this.CoupledCount=r.readUint8(),this.ChannelMapping=[];for(var a=0;a<this.OutputChannelCount;a++)this.ChannelMapping[a]=r.readUint8()}}),o.createFullBoxCtor("dref",function(r){var a,u;this.entries=[];for(var f=r.readUint32(),g=0;g<f;g++)if(a=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===o.OK)u=a.box,this.entries.push(u);else return}),o.createBoxCtor("drep",function(r){this.bytessent=r.readUint64()}),o.createFullBoxCtor("elng",function(r){this.extended_language=r.readString(this.size-this.hdr_size)}),o.createFullBoxCtor("elst",function(r){this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),this.version===1?(f.segment_duration=r.readUint64(),f.media_time=r.readInt64()):(f.segment_duration=r.readUint32(),f.media_time=r.readInt32()),f.media_rate_integer=r.readInt16(),f.media_rate_fraction=r.readInt16()}}),o.createFullBoxCtor("emsg",function(r){this.version==1?(this.timescale=r.readUint32(),this.presentation_time=r.readUint64(),this.event_duration=r.readUint32(),this.id=r.readUint32(),this.scheme_id_uri=r.readCString(),this.value=r.readCString()):(this.scheme_id_uri=r.readCString(),this.value=r.readCString(),this.timescale=r.readUint32(),this.presentation_time_delta=r.readUint32(),this.event_duration=r.readUint32(),this.id=r.readUint32());var a=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(a-=4),this.message_data=r.readUint8Array(a)}),o.createEntityToGroupCtor=function(r,a){o[r+"Box"]=function(u){o.FullBox.call(this,r,u)},o[r+"Box"].prototype=new o.FullBox,o[r+"Box"].prototype.parse=function(u){if(this.parseFullHeader(u),a)a.call(this,u);else for(this.group_id=u.readUint32(),this.num_entities_in_group=u.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var f=u.readUint32();this.entity_ids.push(f)}}},o.createEntityToGroupCtor("aebr"),o.createEntityToGroupCtor("afbr"),o.createEntityToGroupCtor("albc"),o.createEntityToGroupCtor("altr"),o.createEntityToGroupCtor("brst"),o.createEntityToGroupCtor("dobr"),o.createEntityToGroupCtor("eqiv"),o.createEntityToGroupCtor("favc"),o.createEntityToGroupCtor("fobr"),o.createEntityToGroupCtor("iaug"),o.createEntityToGroupCtor("pano"),o.createEntityToGroupCtor("slid"),o.createEntityToGroupCtor("ster"),o.createEntityToGroupCtor("tsyn"),o.createEntityToGroupCtor("wbbr"),o.createEntityToGroupCtor("prgr"),o.createEntityToGroupCtor("pymd",function(r){this.group_id=r.readUint32(),this.num_entities_in_group=r.readUint32(),this.entity_ids=[];for(var a=0;a<this.num_entities_in_group;a++){var u=r.readUint32();this.entity_ids.push(u)}for(this.tile_size_x=r.readUint16(),this.tile_size_y=r.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],a=0;a<this.num_entities_in_group;a++)this.layer_binning[a]=r.readUint16(),this.tiles_in_layer_row_minus1[a]=r.readUint16(),this.tiles_in_layer_column_minus1[a]=r.readUint16()}),o.createFullBoxCtor("esds",function(r){var a=r.readUint8Array(this.size-this.hdr_size);if(this.data=a,typeof d<"u"){var u=new d;this.esd=u.parseOneDescriptor(new n(a.buffer,0,n.BIG_ENDIAN))}}),o.createBoxCtor("fiel",function(r){this.fieldCount=r.readUint8(),this.fieldOrdering=r.readUint8()}),o.createBoxCtor("frma",function(r){this.data_format=r.readString(4)}),o.createBoxCtor("ftyp",function(r){var a=this.size-this.hdr_size;this.major_brand=r.readString(4),this.minor_version=r.readUint32(),a-=8,this.compatible_brands=[];for(var u=0;a>=4;)this.compatible_brands[u]=r.readString(4),a-=4,u++}),o.createFullBoxCtor("hdlr",function(r){this.version===0&&(r.readUint32(),this.handler=r.readString(4),r.readUint32Array(3),this.name=r.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),o.createBoxCtor("hvcC",function(r){var a,u,f,g;this.configurationVersion=r.readUint8(),g=r.readUint8(),this.general_profile_space=g>>6,this.general_tier_flag=(g&32)>>5,this.general_profile_idc=g&31,this.general_profile_compatibility=r.readUint32(),this.general_constraint_indicator=r.readUint8Array(6),this.general_level_idc=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,this.chroma_format_idc=r.readUint8()&3,this.bit_depth_luma_minus8=r.readUint8()&7,this.bit_depth_chroma_minus8=r.readUint8()&7,this.avgFrameRate=r.readUint16(),g=r.readUint8(),this.constantFrameRate=g>>6,this.numTemporalLayers=(g&13)>>3,this.temporalIdNested=(g&4)>>2,this.lengthSizeMinusOne=g&3,this.nalu_arrays=[];var b=r.readUint8();for(a=0;a<b;a++){var S=[];this.nalu_arrays.push(S),g=r.readUint8(),S.completeness=(g&128)>>7,S.nalu_type=g&63;var A=r.readUint16();for(u=0;u<A;u++){var C={};S.push(C),f=r.readUint16(),C.data=r.readUint8Array(f)}}}),o.createFullBoxCtor("iinf",function(r){var a;this.version===0?this.entry_count=r.readUint16():this.entry_count=r.readUint32(),this.item_infos=[];for(var u=0;u<this.entry_count;u++)if(a=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===o.OK)a.box.type!=="infe"&&t.error("BoxParser","Expected 'infe' box, got "+a.box.type),this.item_infos[u]=a.box;else return}),o.createFullBoxCtor("iloc",function(r){var a;a=r.readUint8(),this.offset_size=a>>4&15,this.length_size=a&15,a=r.readUint8(),this.base_offset_size=a>>4&15,this.version===1||this.version===2?this.index_size=a&15:this.index_size=0,this.items=[];var u=0;if(this.version<2)u=r.readUint16();else if(this.version===2)u=r.readUint32();else throw"version of iloc box not supported";for(var f=0;f<u;f++){var g={};if(this.items.push(g),this.version<2)g.item_ID=r.readUint16();else if(this.version===2)g.item_ID=r.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?g.construction_method=r.readUint16()&15:g.construction_method=0,g.data_reference_index=r.readUint16(),this.base_offset_size){case 0:g.base_offset=0;break;case 4:g.base_offset=r.readUint32();break;case 8:g.base_offset=r.readUint64();break;default:throw"Error reading base offset size"}var b=r.readUint16();g.extents=[];for(var S=0;S<b;S++){var A={};if(g.extents.push(A),this.version===1||this.version===2)switch(this.index_size){case 0:A.extent_index=0;break;case 4:A.extent_index=r.readUint32();break;case 8:A.extent_index=r.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:A.extent_offset=0;break;case 4:A.extent_offset=r.readUint32();break;case 8:A.extent_offset=r.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:A.extent_length=0;break;case 4:A.extent_length=r.readUint32();break;case 8:A.extent_length=r.readUint64();break;default:throw"Error reading extent index"}}}}),o.createBoxCtor("imir",function(r){var a=r.readUint8();this.reserved=a>>7,this.axis=a&1}),o.createFullBoxCtor("infe",function(r){if((this.version===0||this.version===1)&&(this.item_ID=r.readUint16(),this.item_protection_index=r.readUint16(),this.item_name=r.readCString(),this.content_type=r.readCString(),this.content_encoding=r.readCString()),this.version===1){this.extension_type=r.readString(4),t.warn("BoxParser","Cannot parse extension type"),r.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=r.readUint16():this.version===3&&(this.item_ID=r.readUint32()),this.item_protection_index=r.readUint16(),this.item_type=r.readString(4),this.item_name=r.readCString(),this.item_type==="mime"?(this.content_type=r.readCString(),this.content_encoding=r.readCString()):this.item_type==="uri "&&(this.item_uri_type=r.readCString()))}),o.createFullBoxCtor("ipma",function(r){var a,u;for(entry_count=r.readUint32(),this.associations=[],a=0;a<entry_count;a++){var f={};this.associations.push(f),this.version<1?f.id=r.readUint16():f.id=r.readUint32();var g=r.readUint8();for(f.props=[],u=0;u<g;u++){var b=r.readUint8(),S={};f.props.push(S),S.essential=(b&128)>>7===1,this.flags&1?S.property_index=(b&127)<<8|r.readUint8():S.property_index=b&127}}}),o.createFullBoxCtor("iref",function(r){var a,u;for(this.references=[];r.getPosition()<this.start+this.size;)if(a=o.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===o.OK)this.version===0?u=new o.SingleItemTypeReferenceBox(a.type,a.size,a.hdr_size,a.start):u=new o.SingleItemTypeReferenceBoxLarge(a.type,a.size,a.hdr_size,a.start),u.write===o.Box.prototype.write&&u.type!=="mdat"&&(t.warn("BoxParser",u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.references.push(u);else return}),o.createBoxCtor("irot",function(r){this.angle=r.readUint8()&3}),o.createFullBoxCtor("ispe",function(r){this.image_width=r.readUint32(),this.image_height=r.readUint32()}),o.createFullBoxCtor("kind",function(r){this.schemeURI=r.readCString(),this.value=r.readCString()}),o.createFullBoxCtor("leva",function(r){var a=r.readUint8();this.levels=[];for(var u=0;u<a;u++){var f={};this.levels[u]=f,f.track_ID=r.readUint32();var g=r.readUint8();switch(f.padding_flag=g>>7,f.assignment_type=g&127,f.assignment_type){case 0:f.grouping_type=r.readString(4);break;case 1:f.grouping_type=r.readString(4),f.grouping_type_parameter=r.readUint32();break;case 2:break;case 3:break;case 4:f.sub_track_id=r.readUint32();break;default:t.warn("BoxParser","Unknown leva assignement type")}}}),o.createBoxCtor("lhvC",function(r){var a,u,f;this.configurationVersion=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,f=r.readUint8(),this.numTemporalLayers=(f&13)>>3,this.temporalIdNested=(f&4)>>2,this.lengthSizeMinusOne=f&3,this.nalu_arrays=[];var g=r.readUint8();for(a=0;a<g;a++){var b=[];this.nalu_arrays.push(b),f=r.readUint8(),b.completeness=(f&128)>>7,b.nalu_type=f&63;var S=r.readUint16();for(u=0;u<S;u++){var A={};b.push(A);var C=r.readUint16();A.data=r.readUint8Array(C)}}}),o.createBoxCtor("lsel",function(r){this.layer_id=r.readUint16()}),o.createBoxCtor("maxr",function(r){this.period=r.readUint32(),this.bytes=r.readUint32()});function _(r,a){this.x=r,this.y=a}_.prototype.toString=function(){return"("+this.x+","+this.y+")"},o.createBoxCtor("mdcv",function(r){this.display_primaries=[],this.display_primaries[0]=new _(r.readUint16(),r.readUint16()),this.display_primaries[1]=new _(r.readUint16(),r.readUint16()),this.display_primaries[2]=new _(r.readUint16(),r.readUint16()),this.white_point=new _(r.readUint16(),r.readUint16()),this.max_display_mastering_luminance=r.readUint32(),this.min_display_mastering_luminance=r.readUint32()}),o.createFullBoxCtor("mdhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.parseLanguage(r),r.readUint16()}),o.createFullBoxCtor("mehd",function(r){this.flags&1&&(t.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=r.readUint64():this.fragment_duration=r.readUint32()}),o.createFullBoxCtor("meta",function(r){this.boxes=[],o.ContainerBox.prototype.parse.call(this,r)}),o.createFullBoxCtor("mfhd",function(r){this.sequence_number=r.readUint32()}),o.createFullBoxCtor("mfro",function(r){this._size=r.readUint32()}),o.createFullBoxCtor("mskC",function(r){this.bits_per_pixel=r.readUint8()}),o.createFullBoxCtor("mvhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.rate=r.readUint32(),this.volume=r.readUint16()>>8,r.readUint16(),r.readUint32Array(2),this.matrix=r.readUint32Array(9),r.readUint32Array(6),this.next_track_id=r.readUint32()}),o.createBoxCtor("npck",function(r){this.packetssent=r.readUint32()}),o.createBoxCtor("nump",function(r){this.packetssent=r.readUint64()}),o.createFullBoxCtor("padb",function(r){var a=r.readUint32();this.padbits=[];for(var u=0;u<Math.floor((a+1)/2);u++)this.padbits=r.readUint8()}),o.createBoxCtor("pasp",function(r){this.hSpacing=r.readUint32(),this.vSpacing=r.readUint32()}),o.createBoxCtor("payl",function(r){this.text=r.readString(this.size-this.hdr_size)}),o.createBoxCtor("payt",function(r){this.payloadID=r.readUint32();var a=r.readUint8();this.rtpmap_string=r.readString(a)}),o.createFullBoxCtor("pdin",function(r){var a=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var u=0;u<a;u++)this.rate[u]=r.readUint32(),this.initial_delay[u]=r.readUint32()}),o.createFullBoxCtor("pitm",function(r){this.version===0?this.item_id=r.readUint16():this.item_id=r.readUint32()}),o.createFullBoxCtor("pixi",function(r){var a;for(this.num_channels=r.readUint8(),this.bits_per_channels=[],a=0;a<this.num_channels;a++)this.bits_per_channels[a]=r.readUint8()}),o.createBoxCtor("pmax",function(r){this.bytes=r.readUint32()}),o.createFullBoxCtor("prdi",function(r){if(this.step_count=r.readUint16(),this.item_count=[],this.flags&2)for(var a=0;a<this.step_count;a++)this.item_count[a]=r.readUint16()}),o.createFullBoxCtor("prft",function(r){this.ref_track_id=r.readUint32(),this.ntp_timestamp=r.readUint64(),this.version===0?this.media_time=r.readUint32():this.media_time=r.readUint64()}),o.createFullBoxCtor("pssh",function(r){if(this.system_id=o.parseHex16(r),this.version>0){var a=r.readUint32();this.kid=[];for(var u=0;u<a;u++)this.kid[u]=o.parseHex16(r)}var f=r.readUint32();f>0&&(this.data=r.readUint8Array(f))}),o.createFullBoxCtor("clef",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),o.createFullBoxCtor("enof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),o.createFullBoxCtor("prof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),o.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),o.createBoxCtor("rtp ",function(r){this.descriptionformat=r.readString(4),this.sdptext=r.readString(this.size-this.hdr_size-4)}),o.createFullBoxCtor("saio",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32());var a=r.readUint32();this.offset=[];for(var u=0;u<a;u++)this.version===0?this.offset[u]=r.readUint32():this.offset[u]=r.readUint64()}),o.createFullBoxCtor("saiz",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32()),this.default_sample_info_size=r.readUint8();var a=r.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var u=0;u<a;u++)this.sample_info_size[u]=r.readUint8()}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(r){this.parseHeader(r),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.auxiliary_mime_types=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(r){this.parseHeader(r),this.displayFlags=r.readUint32(),this.horizontal_justification=r.readInt8(),this.vertical_justification=r.readInt8(),this.bg_color_rgba=r.readUint8Array(4),this.box_record=r.readInt16Array(4),this.style_record=r.readUint8Array(12),this.parseFooter(r)}),o.createSampleEntryCtor(o.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(r){this.parseHeader(r),this.parseFooter(r)}),o.createSampleGroupCtor("alst",function(r){var a,u=r.readUint16();for(this.first_output_sample=r.readUint16(),this.sample_offset=[],a=0;a<u;a++)this.sample_offset[a]=r.readUint32();var f=this.description_length-4-4*u;for(this.num_output_samples=[],this.num_total_samples=[],a=0;a<f/4;a++)this.num_output_samples[a]=r.readUint16(),this.num_total_samples[a]=r.readUint16()}),o.createSampleGroupCtor("avll",function(r){this.layerNumber=r.readUint8(),this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()}),o.createSampleGroupCtor("avss",function(r){this.subSequenceIdentifier=r.readUint16(),this.layerNumber=r.readUint8();var a=r.readUint8();this.durationFlag=a>>7,this.avgRateFlag=a>>6&1,this.durationFlag&&(this.duration=r.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()),this.dependency=[];for(var u=r.readUint8(),f=0;f<u;f++){var g={};this.dependency.push(g),g.subSeqDirectionFlag=r.readUint8(),g.layerNumber=r.readUint8(),g.subSequenceIdentifier=r.readUint16()}}),o.createSampleGroupCtor("dtrt",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("mvif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("prol",function(r){this.roll_distance=r.readInt16()}),o.createSampleGroupCtor("rap ",function(r){var a=r.readUint8();this.num_leading_samples_known=a>>7,this.num_leading_samples=a&127}),o.createSampleGroupCtor("rash",function(r){if(this.operation_point_count=r.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)t.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=r.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=r.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var a=0;a<this.operation_point_count;a++)this.available_bitrate[a]=r.readUint32(),this.target_rate_share[a]=r.readUint16()}this.maximum_bitrate=r.readUint32(),this.minimum_bitrate=r.readUint32(),this.discard_priority=r.readUint8()}}),o.createSampleGroupCtor("roll",function(r){this.roll_distance=r.readInt16()}),o.SampleGroupEntry.prototype.parse=function(r){t.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=r.readUint8Array(this.description_length)},o.createSampleGroupCtor("scif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("scnm",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("seig",function(r){this.reserved=r.readUint8();var a=r.readUint8();this.crypt_byte_block=a>>4,this.skip_byte_block=a&15,this.isProtected=r.readUint8(),this.Per_Sample_IV_Size=r.readUint8(),this.KID=o.parseHex16(r),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=r.readUint8(),this.constant_IV=r.readUint8Array(this.constant_IV_size))}),o.createSampleGroupCtor("stsa",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("sync",function(r){var a=r.readUint8();this.NAL_unit_type=a&63}),o.createSampleGroupCtor("tele",function(r){var a=r.readUint8();this.level_independently_decodable=a>>7}),o.createSampleGroupCtor("tsas",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("tscl",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createSampleGroupCtor("vipr",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),o.createFullBoxCtor("sbgp",function(r){this.grouping_type=r.readString(4),this.version===1?this.grouping_type_parameter=r.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),f.sample_count=r.readInt32(),f.group_description_index=r.readInt32()}});function m(r,a){this.bad_pixel_row=r,this.bad_pixel_column=a}m.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},o.createFullBoxCtor("sbpm",function(r){var a;for(this.component_count=r.readUint16(),this.component_index=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16());var u=r.readUint8();for(this.correction_applied=(u&128)==128,this.num_bad_rows=r.readUint32(),this.num_bad_cols=r.readUint32(),this.num_bad_pixels=r.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],a=0;a<this.num_bad_rows;a++)this.bad_rows.push(r.readUint32());for(a=0;a<this.num_bad_cols;a++)this.bad_columns.push(r.readUint32());for(a=0;a<this.num_bad_pixels;a++){var f=r.readUint32(),g=r.readUint32();this.bad_pixels.push(new m(f,g))}}),o.createFullBoxCtor("schm",function(r){this.scheme_type=r.readString(4),this.scheme_version=r.readUint32(),this.flags&1&&(this.scheme_uri=r.readString(this.size-this.hdr_size-8))}),o.createBoxCtor("sdp ",function(r){this.sdptext=r.readString(this.size-this.hdr_size)}),o.createFullBoxCtor("sdtp",function(r){var a,u=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var f=0;f<u;f++)a=r.readUint8(),this.is_leading[f]=a>>6,this.sample_depends_on[f]=a>>4&3,this.sample_is_depended_on[f]=a>>2&3,this.sample_has_redundancy[f]=a&3}),o.createFullBoxCtor("senc"),o.createFullBoxCtor("sgpd",function(r){this.grouping_type=r.readString(4),t.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=r.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=r.readUint32()),this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f;o[this.grouping_type+"SampleGroupEntry"]?f=new o[this.grouping_type+"SampleGroupEntry"](this.grouping_type):f=new o.SampleGroupEntry(this.grouping_type),this.entries.push(f),this.version===1?this.default_length===0?f.description_length=r.readUint32():f.description_length=this.default_length:f.description_length=this.default_length,f.write===o.SampleGroupEntry.prototype.write&&(t.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),f.data=r.readUint8Array(f.description_length),r.position-=f.description_length),f.parse(r)}}),o.createFullBoxCtor("sidx",function(r){this.reference_ID=r.readUint32(),this.timescale=r.readUint32(),this.version===0?(this.earliest_presentation_time=r.readUint32(),this.first_offset=r.readUint32()):(this.earliest_presentation_time=r.readUint64(),this.first_offset=r.readUint64()),r.readUint16(),this.references=[];for(var a=r.readUint16(),u=0;u<a;u++){var f={};this.references.push(f);var g=r.readUint32();f.reference_type=g>>31&1,f.referenced_size=g&2147483647,f.subsegment_duration=r.readUint32(),g=r.readUint32(),f.starts_with_SAP=g>>31&1,f.SAP_type=g>>28&7,f.SAP_delta_time=g&268435455}}),o.SingleItemTypeReferenceBox=function(r,a,u,f){o.Box.call(this,r,a),this.hdr_size=u,this.start=f},o.SingleItemTypeReferenceBox.prototype=new o.Box,o.SingleItemTypeReferenceBox.prototype.parse=function(r){this.from_item_ID=r.readUint16();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint16()},o.SingleItemTypeReferenceBoxLarge=function(r,a,u,f){o.Box.call(this,r,a),this.hdr_size=u,this.start=f},o.SingleItemTypeReferenceBoxLarge.prototype=new o.Box,o.SingleItemTypeReferenceBoxLarge.prototype.parse=function(r){this.from_item_ID=r.readUint32();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint32()},o.createFullBoxCtor("SmDm",function(r){this.primaryRChromaticity_x=r.readUint16(),this.primaryRChromaticity_y=r.readUint16(),this.primaryGChromaticity_x=r.readUint16(),this.primaryGChromaticity_y=r.readUint16(),this.primaryBChromaticity_x=r.readUint16(),this.primaryBChromaticity_y=r.readUint16(),this.whitePointChromaticity_x=r.readUint16(),this.whitePointChromaticity_y=r.readUint16(),this.luminanceMax=r.readUint32(),this.luminanceMin=r.readUint32()}),o.createFullBoxCtor("smhd",function(r){this.balance=r.readUint16(),r.readUint16()}),o.createFullBoxCtor("ssix",function(r){this.subsegments=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.subsegments.push(f),f.ranges=[];for(var g=r.readUint32(),b=0;b<g;b++){var S={};f.ranges.push(S),S.level=r.readUint8(),S.range_size=r.readUint24()}}}),o.createFullBoxCtor("stco",function(r){var a;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(var u=0;u<a;u++)this.chunk_offsets.push(r.readUint32())}),o.createFullBoxCtor("stdp",function(r){var a=(this.size-this.hdr_size)/2;this.priority=[];for(var u=0;u<a;u++)this.priority[u]=r.readUint16()}),o.createFullBoxCtor("sthd"),o.createFullBoxCtor("stri",function(r){this.switch_group=r.readUint16(),this.alternate_group=r.readUint16(),this.sub_track_id=r.readUint32();var a=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),o.createFullBoxCtor("stsc",function(r){var a,u;if(a=r.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(u=0;u<a;u++)this.first_chunk.push(r.readUint32()),this.samples_per_chunk.push(r.readUint32()),this.sample_description_index.push(r.readUint32())}),o.createFullBoxCtor("stsd",function(r){var a,u,f,g;for(this.entries=[],f=r.readUint32(),a=1;a<=f;a++)if(u=o.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),u.code===o.OK)o[u.type+"SampleEntry"]?(g=new o[u.type+"SampleEntry"](u.size),g.hdr_size=u.hdr_size,g.start=u.start):(t.warn("BoxParser","Unknown sample entry type: "+u.type),g=new o.SampleEntry(u.type,u.size,u.hdr_size,u.start)),g.write===o.SampleEntry.prototype.write&&(t.info("BoxParser","SampleEntry "+g.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),g.parseDataAndRewind(r)),g.parse(r),this.entries.push(g);else return}),o.createFullBoxCtor("stsg",function(r){this.grouping_type=r.readUint32();var a=r.readUint16();this.group_description_index=[];for(var u=0;u<a;u++)this.group_description_index[u]=r.readUint32()}),o.createFullBoxCtor("stsh",function(r){var a,u;if(a=r.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(u=0;u<a;u++)this.shadowed_sample_numbers.push(r.readUint32()),this.sync_sample_numbers.push(r.readUint32())}),o.createFullBoxCtor("stss",function(r){var a,u;if(u=r.readUint32(),this.version===0)for(this.sample_numbers=[],a=0;a<u;a++)this.sample_numbers.push(r.readUint32())}),o.createFullBoxCtor("stsz",function(r){var a;if(this.sample_sizes=[],this.version===0)for(this.sample_size=r.readUint32(),this.sample_count=r.readUint32(),a=0;a<this.sample_count;a++)this.sample_size===0?this.sample_sizes.push(r.readUint32()):this.sample_sizes[a]=this.sample_size}),o.createFullBoxCtor("stts",function(r){var a,u,f;if(a=r.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),f=r.readInt32(),f<0&&(t.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),f=1),this.sample_deltas.push(f)}),o.createFullBoxCtor("stvi",function(r){var a=r.readUint32();this.single_view_allowed=a&3,this.stereo_scheme=r.readUint32();var u=r.readUint32();this.stereo_indication_type=r.readString(u);var f,g;for(this.boxes=[];r.getPosition()<this.start+this.size;)if(f=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),f.code===o.OK)g=f.box,this.boxes.push(g),this[g.type]=g;else return}),o.createBoxCtor("styp",function(r){o.ftypBox.prototype.parse.call(this,r)}),o.createFullBoxCtor("stz2",function(r){var a,u;if(this.sample_sizes=[],this.version===0)if(this.reserved=r.readUint24(),this.field_size=r.readUint8(),u=r.readUint32(),this.field_size===4)for(a=0;a<u;a+=2){var f=r.readUint8();this.sample_sizes[a]=f>>4&15,this.sample_sizes[a+1]=f&15}else if(this.field_size===8)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint8();else if(this.field_size===16)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint16();else t.error("BoxParser","Error in length field in stz2 box")}),o.createFullBoxCtor("subs",function(r){var a,u,f,g;for(f=r.readUint32(),this.entries=[],a=0;a<f;a++){var b={};if(this.entries[a]=b,b.sample_delta=r.readUint32(),b.subsamples=[],g=r.readUint16(),g>0)for(u=0;u<g;u++){var S={};b.subsamples.push(S),this.version==1?S.size=r.readUint32():S.size=r.readUint16(),S.priority=r.readUint8(),S.discardable=r.readUint8(),S.codec_specific_parameters=r.readUint32()}}}),o.createFullBoxCtor("tenc",function(r){if(r.readUint8(),this.version===0)r.readUint8();else{var a=r.readUint8();this.default_crypt_byte_block=a>>4&15,this.default_skip_byte_block=a&15}this.default_isProtected=r.readUint8(),this.default_Per_Sample_IV_Size=r.readUint8(),this.default_KID=o.parseHex16(r),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=r.readUint8(),this.default_constant_IV=r.readUint8Array(this.default_constant_IV_size))}),o.createFullBoxCtor("tfdt",function(r){this.version==1?this.baseMediaDecodeTime=r.readUint64():this.baseMediaDecodeTime=r.readUint32()}),o.createFullBoxCtor("tfhd",function(r){var a=0;this.track_id=r.readUint32(),this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=r.readUint64(),a+=8):this.base_data_offset=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=r.readUint32(),a+=4):this.default_sample_description_index=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=r.readUint32(),a+=4):this.default_sample_duration=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=r.readUint32(),a+=4):this.default_sample_size=0,this.size-this.hdr_size>a&&this.flags&o.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=r.readUint32(),a+=4):this.default_sample_flags=0}),o.createFullBoxCtor("tfra",function(r){this.track_ID=r.readUint32(),r.readUint24();var a=r.readUint8();this.length_size_of_traf_num=a>>4&3,this.length_size_of_trun_num=a>>2&3,this.length_size_of_sample_num=a&3,this.entries=[];for(var u=r.readUint32(),f=0;f<u;f++)this.version===1?(this.time=r.readUint64(),this.moof_offset=r.readUint64()):(this.time=r.readUint32(),this.moof_offset=r.readUint32()),this.traf_number=r["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=r["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=r["readUint"+8*(this.length_size_of_sample_num+1)]()}),o.createFullBoxCtor("tkhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint32()),r.readUint32Array(2),this.layer=r.readInt16(),this.alternate_group=r.readInt16(),this.volume=r.readInt16()>>8,r.readUint16(),this.matrix=r.readInt32Array(9),this.width=r.readUint32(),this.height=r.readUint32()}),o.createBoxCtor("tmax",function(r){this.time=r.readUint32()}),o.createBoxCtor("tmin",function(r){this.time=r.readUint32()}),o.createBoxCtor("totl",function(r){this.bytessent=r.readUint32()}),o.createBoxCtor("tpay",function(r){this.bytessent=r.readUint32()}),o.createBoxCtor("tpyl",function(r){this.bytessent=r.readUint64()}),o.TrackGroupTypeBox.prototype.parse=function(r){this.parseFullHeader(r),this.track_group_id=r.readUint32()},o.createTrackGroupCtor("msrc"),o.TrackReferenceTypeBox=function(r,a,u,f){o.Box.call(this,r,a),this.hdr_size=u,this.start=f},o.TrackReferenceTypeBox.prototype=new o.Box,o.TrackReferenceTypeBox.prototype.parse=function(r){this.track_ids=r.readUint32Array((this.size-this.hdr_size)/4)},o.trefBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=o.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===o.OK)u=new o.TrackReferenceTypeBox(a.type,a.size,a.hdr_size,a.start),u.write===o.Box.prototype.write&&u.type!=="mdat"&&(t.info("BoxParser","TrackReference "+u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.boxes.push(u);else return},o.createFullBoxCtor("trep",function(r){for(this.track_ID=r.readUint32(),this.boxes=[];r.getPosition()<this.start+this.size;)if(ret=o.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),ret.code===o.OK)box=ret.box,this.boxes.push(box);else return}),o.createFullBoxCtor("trex",function(r){this.track_id=r.readUint32(),this.default_sample_description_index=r.readUint32(),this.default_sample_duration=r.readUint32(),this.default_sample_size=r.readUint32(),this.default_sample_flags=r.readUint32()}),o.createBoxCtor("trpy",function(r){this.bytessent=r.readUint64()}),o.createFullBoxCtor("trun",function(r){var a=0;if(this.sample_count=r.readUint32(),a+=4,this.size-this.hdr_size>a&&this.flags&o.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=r.readInt32(),a+=4):this.data_offset=0,this.size-this.hdr_size>a&&this.flags&o.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=r.readUint32(),a+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>a)for(var u=0;u<this.sample_count;u++)this.flags&o.TRUN_FLAGS_DURATION&&(this.sample_duration[u]=r.readUint32()),this.flags&o.TRUN_FLAGS_SIZE&&(this.sample_size[u]=r.readUint32()),this.flags&o.TRUN_FLAGS_FLAGS&&(this.sample_flags[u]=r.readUint32()),this.flags&o.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[u]=r.readUint32():this.sample_composition_time_offset[u]=r.readInt32())}),o.createFullBoxCtor("tsel",function(r){this.switch_group=r.readUint32();var a=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),o.createFullBoxCtor("txtC",function(r){this.config=r.readCString()}),o.createBoxCtor("tyco",function(r){var a=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var u=0;u<a;u++)this.compatible_brands[u]=r.readString(4)}),o.createFullBoxCtor("udes",function(r){this.lang=r.readCString(),this.name=r.readCString(),this.description=r.readCString(),this.tags=r.readCString()}),o.createFullBoxCtor("uncC",function(r){var a;if(this.profile=r.readUint32(),this.version!=1){if(this.version==0){for(this.component_count=r.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16()),this.component_bit_depth_minus_one.push(r.readUint8()),this.component_format.push(r.readUint8()),this.component_align_size.push(r.readUint8());this.sampling_type=r.readUint8(),this.interleave_type=r.readUint8(),this.block_size=r.readUint8();var u=r.readUint8();this.component_little_endian=u>>7&1,this.block_pad_lsb=u>>6&1,this.block_little_endian=u>>5&1,this.block_reversed=u>>4&1,this.pad_unknown=u>>3&1,this.pixel_size=r.readUint32(),this.row_align_size=r.readUint32(),this.tile_align_size=r.readUint32(),this.num_tile_cols_minus_one=r.readUint32(),this.num_tile_rows_minus_one=r.readUint32()}}}),o.createFullBoxCtor("url ",function(r){this.flags!==1&&(this.location=r.readCString())}),o.createFullBoxCtor("urn ",function(r){this.name=r.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=r.readCString())}),o.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(r){this.LiveServerManifest=r.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),o.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(r){this.system_id=o.parseHex16(r);var a=r.readUint32();a>0&&(this.data=r.readUint8Array(a))}),o.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),o.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(r){this.default_AlgorithmID=r.readUint24(),this.default_IV_size=r.readUint8(),this.default_KID=o.parseHex16(r)}),o.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(r){this.fragment_count=r.readUint8(),this.entries=[];for(var a=0;a<this.fragment_count;a++){var u={},f=0,g=0;this.version===1?(f=r.readUint64(),g=r.readUint64()):(f=r.readUint32(),g=r.readUint32()),u.absolute_time=f,u.absolute_duration=g,this.entries.push(u)}}),o.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(r){this.version===1?(this.absolute_time=r.readUint64(),this.duration=r.readUint64()):(this.absolute_time=r.readUint32(),this.duration=r.readUint32())}),o.createFullBoxCtor("vmhd",function(r){this.graphicsmode=r.readUint16(),this.opcolor=r.readUint16Array(3)}),o.createFullBoxCtor("vpcC",function(r){var a;this.version===1?(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4,this.chromaSubsampling=a>>1&7,this.videoFullRangeFlag=a&1,this.colourPrimaries=r.readUint8(),this.transferCharacteristics=r.readUint8(),this.matrixCoefficients=r.readUint8(),this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize)):(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4&15,this.colorSpace=a&15,a=r.readUint8(),this.chromaSubsampling=a>>4&15,this.transferFunction=a>>1&7,this.videoFullRangeFlag=a&1,this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize))}),o.createBoxCtor("vttC",function(r){this.text=r.readString(this.size-this.hdr_size)}),o.createFullBoxCtor("vvcC",function(r){var a,u,f={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(L){this.held_bits=L.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(L){this.held_bits=L.readUint16(),this.num_held_bits=16},extract_bits:function(L){var W=this.held_bits>>this.num_held_bits-L&(1<<L)-1;return this.num_held_bits-=L,W}};if(f.stream_read_1_bytes(r),f.extract_bits(5),this.lengthSizeMinusOne=f.extract_bits(2),this.ptl_present_flag=f.extract_bits(1),this.ptl_present_flag){f.stream_read_2_bytes(r),this.ols_idx=f.extract_bits(9),this.num_sublayers=f.extract_bits(3),this.constant_frame_rate=f.extract_bits(2),this.chroma_format_idc=f.extract_bits(2),f.stream_read_1_bytes(r),this.bit_depth_minus8=f.extract_bits(3),f.extract_bits(5);{if(f.stream_read_2_bytes(r),f.extract_bits(2),this.num_bytes_constraint_info=f.extract_bits(6),this.general_profile_idc=f.extract_bits(7),this.general_tier_flag=f.extract_bits(1),this.general_level_idc=r.readUint8(),f.stream_read_1_bytes(r),this.ptl_frame_only_constraint_flag=f.extract_bits(1),this.ptl_multilayer_enabled_flag=f.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(a=0;a<this.num_bytes_constraint_info-1;a++){var g=f.extract_bits(6);f.stream_read_1_bytes(r);var b=f.extract_bits(2);this.general_constraint_info[a]=g<<2|b}this.general_constraint_info[this.num_bytes_constraint_info-1]=f.extract_bits(6)}else f.extract_bits(6);if(this.num_sublayers>1){for(f.stream_read_1_bytes(r),this.ptl_sublayer_present_mask=0,u=this.num_sublayers-2;u>=0;--u){var S=f.extract_bits(1);this.ptl_sublayer_present_mask|=S<<u}for(u=this.num_sublayers;u<=8&&this.num_sublayers>1;++u)f.extract_bits(1);for(this.sublayer_level_idc=[],u=this.num_sublayers-2;u>=0;--u)this.ptl_sublayer_present_mask&1<<u&&(this.sublayer_level_idc[u]=r.readUint8())}if(this.ptl_num_sub_profiles=r.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(a=0;a<this.ptl_num_sub_profiles;a++)this.general_sub_profile_idc.push(r.readUint32())}this.max_picture_width=r.readUint16(),this.max_picture_height=r.readUint16(),this.avg_frame_rate=r.readUint16()}var A=12,C=13;this.nalu_arrays=[];var B=r.readUint8();for(a=0;a<B;a++){var R=[];this.nalu_arrays.push(R),f.stream_read_1_bytes(r),R.completeness=f.extract_bits(1),f.extract_bits(2),R.nalu_type=f.extract_bits(5);var M=1;for(R.nalu_type!=C&&R.nalu_type!=A&&(M=r.readUint16()),u=0;u<M;u++){var N=r.readUint16();R.push({data:r.readUint8Array(N),length:N})}}}),o.createFullBoxCtor("vvnC",function(r){var a=strm.readUint8();this.lengthSizeMinusOne=a&3}),o.SampleEntry.prototype.isVideo=function(){return!1},o.SampleEntry.prototype.isAudio=function(){return!1},o.SampleEntry.prototype.isSubtitle=function(){return!1},o.SampleEntry.prototype.isMetadata=function(){return!1},o.SampleEntry.prototype.isHint=function(){return!1},o.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},o.SampleEntry.prototype.getWidth=function(){return""},o.SampleEntry.prototype.getHeight=function(){return""},o.SampleEntry.prototype.getChannelCount=function(){return""},o.SampleEntry.prototype.getSampleRate=function(){return""},o.SampleEntry.prototype.getSampleSize=function(){return""},o.VisualSampleEntry.prototype.isVideo=function(){return!0},o.VisualSampleEntry.prototype.getWidth=function(){return this.width},o.VisualSampleEntry.prototype.getHeight=function(){return this.height},o.AudioSampleEntry.prototype.isAudio=function(){return!0},o.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},o.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},o.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},o.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},o.MetadataSampleEntry.prototype.isMetadata=function(){return!0},o.decimalToHex=function(r,a){var u=Number(r).toString(16);for(a=typeof a>"u"||a===null?a=2:a;u.length<a;)u="0"+u;return u},o.avc1SampleEntry.prototype.getCodec=o.avc2SampleEntry.prototype.getCodec=o.avc3SampleEntry.prototype.getCodec=o.avc4SampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this);return this.avcC?r+"."+o.decimalToHex(this.avcC.AVCProfileIndication)+o.decimalToHex(this.avcC.profile_compatibility)+o.decimalToHex(this.avcC.AVCLevelIndication):r},o.hev1SampleEntry.prototype.getCodec=o.hvc1SampleEntry.prototype.getCodec=function(){var r,a=o.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(a+=".",this.hvcC.general_profile_space){case 0:a+="";break;case 1:a+="A";break;case 2:a+="B";break;case 3:a+="C";break}a+=this.hvcC.general_profile_idc,a+=".";var u=this.hvcC.general_profile_compatibility,f=0;for(r=0;r<32&&(f|=u&1,r!=31);r++)f<<=1,u>>=1;a+=o.decimalToHex(f,0),a+=".",this.hvcC.general_tier_flag===0?a+="L":a+="H",a+=this.hvcC.general_level_idc;var g=!1,b="";for(r=5;r>=0;r--)(this.hvcC.general_constraint_indicator[r]||g)&&(b="."+o.decimalToHex(this.hvcC.general_constraint_indicator[r],0)+b,g=!0);a+=b}return a},o.vvc1SampleEntry.prototype.getCodec=o.vvi1SampleEntry.prototype.getCodec=function(){var r,a=o.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){a+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?a+=".H":a+=".L",a+=this.vvcC.general_level_idc;var u="";if(this.vvcC.general_constraint_info){var f=[],g=0;g|=this.vvcC.ptl_frame_only_constraint<<7,g|=this.vvcC.ptl_multilayer_enabled<<6;var b;for(r=0;r<this.vvcC.general_constraint_info.length;++r)g|=this.vvcC.general_constraint_info[r]>>2&63,f.push(g),g&&(b=r),g=this.vvcC.general_constraint_info[r]>>2&3;if(b===void 0)u=".CA";else{u=".C";var S="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",A=0,C=0;for(r=0;r<=b;++r)for(A=A<<8|f[r],C+=8;C>=5;){var B=A>>C-5&31;u+=S[B],C-=5,A&=(1<<C)-1}C&&(A<<=5-C,u+=S[A&31])}}a+=u}return a},o.mp4aSampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var a=this.esds.esd.getOTI(),u=this.esds.esd.getAudioConfig();return r+"."+o.decimalToHex(a)+(u?"."+u:"")}else return r},o.stxtSampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this);return this.mime_format?r+"."+this.mime_format:r},o.vp08SampleEntry.prototype.getCodec=o.vp09SampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this),a=this.vpcC.level;a==0&&(a="00");var u=this.vpcC.bitDepth;return u==8&&(u="08"),r+".0"+this.vpcC.profile+"."+a+"."+u},o.av01SampleEntry.prototype.getCodec=function(){var r=o.SampleEntry.prototype.getCodec.call(this),a=this.av1C.seq_level_idx_0;a<10&&(a="0"+a);var u;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?u=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(u=this.av1C.high_bitdepth===1?"10":"08"),r+"."+this.av1C.seq_profile+"."+a+(this.av1C.seq_tier_0?"H":"M")+"."+u},o.Box.prototype.writeHeader=function(r,a){this.size+=8,this.size>l&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+r.getPosition()+(a||"")),this.size>l?r.writeUint32(1):(this.sizePosition=r.getPosition(),r.writeUint32(this.size)),r.writeString(this.type,null,4),this.type==="uuid"&&r.writeUint8Array(this.uuid),this.size>l&&r.writeUint64(this.size)},o.FullBox.prototype.writeHeader=function(r){this.size+=4,o.Box.prototype.writeHeader.call(this,r," v="+this.version+" f="+this.flags),r.writeUint8(this.version),r.writeUint24(this.flags)},o.Box.prototype.write=function(r){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(r),r.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(r),this.data&&r.writeUint8Array(this.data))},o.ContainerBox.prototype.write=function(r){this.size=0,this.writeHeader(r);for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&(this.boxes[a].write(r),this.size+=this.boxes[a].size);t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.TrackReferenceTypeBox.prototype.write=function(r){this.size=this.track_ids.length*4,this.writeHeader(r),r.writeUint32Array(this.track_ids)},o.avcCBox.prototype.write=function(r){var a;for(this.size=7,a=0;a<this.SPS.length;a++)this.size+=2+this.SPS[a].length;for(a=0;a<this.PPS.length;a++)this.size+=2+this.PPS[a].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8(this.AVCProfileIndication),r.writeUint8(this.profile_compatibility),r.writeUint8(this.AVCLevelIndication),r.writeUint8(this.lengthSizeMinusOne+252),r.writeUint8(this.SPS.length+224),a=0;a<this.SPS.length;a++)r.writeUint16(this.SPS[a].length),r.writeUint8Array(this.SPS[a].nalu);for(r.writeUint8(this.PPS.length),a=0;a<this.PPS.length;a++)r.writeUint16(this.PPS[a].length),r.writeUint8Array(this.PPS[a].nalu);this.ext&&r.writeUint8Array(this.ext)},o.co64Box.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),a=0;a<this.chunk_offsets.length;a++)r.writeUint64(this.chunk_offsets[a])},o.cslgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeInt32(this.compositionToDTSShift),r.writeInt32(this.leastDecodeToDisplayDelta),r.writeInt32(this.greatestDecodeToDisplayDelta),r.writeInt32(this.compositionStartTime),r.writeInt32(this.compositionEndTime)},o.cttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),this.version===1?r.writeInt32(this.sample_offsets[a]):r.writeUint32(this.sample_offsets[a])},o.drefBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.elngBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(r),r.writeString(this.extended_language)},o.elstBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeUint32(u.segment_duration),r.writeInt32(u.media_time),r.writeInt16(u.media_rate_integer),r.writeInt16(u.media_rate_fraction)}},o.emsgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(r),r.writeCString(this.scheme_id_uri),r.writeCString(this.value),r.writeUint32(this.timescale),r.writeUint32(this.presentation_time_delta),r.writeUint32(this.event_duration),r.writeUint32(this.id),r.writeUint8Array(this.message_data)},o.ftypBox.prototype.write=function(r){this.size=8+4*this.compatible_brands.length,this.writeHeader(r),r.writeString(this.major_brand,null,4),r.writeUint32(this.minor_version);for(var a=0;a<this.compatible_brands.length;a++)r.writeString(this.compatible_brands[a],null,4)},o.hdlrBox.prototype.write=function(r){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(r),r.writeUint32(0),r.writeString(this.handler,null,4),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeCString(this.name)},o.hvcCBox.prototype.write=function(r){var a,u;for(this.size=23,a=0;a<this.nalu_arrays.length;a++)for(this.size+=3,u=0;u<this.nalu_arrays[a].length;u++)this.size+=2+this.nalu_arrays[a][u].data.length;for(this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),r.writeUint32(this.general_profile_compatibility),r.writeUint8Array(this.general_constraint_indicator),r.writeUint8(this.general_level_idc),r.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),r.writeUint8(this.parallelismType+252),r.writeUint8(this.chroma_format_idc+252),r.writeUint8(this.bit_depth_luma_minus8+248),r.writeUint8(this.bit_depth_chroma_minus8+248),r.writeUint16(this.avgFrameRate),r.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),r.writeUint8(this.nalu_arrays.length),a=0;a<this.nalu_arrays.length;a++)for(r.writeUint8((this.nalu_arrays[a].completeness<<7)+this.nalu_arrays[a].nalu_type),r.writeUint16(this.nalu_arrays[a].length),u=0;u<this.nalu_arrays[a].length;u++)r.writeUint16(this.nalu_arrays[a][u].data.length),r.writeUint8Array(this.nalu_arrays[a][u].data)},o.kindBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(r),r.writeCString(this.schemeURI),r.writeCString(this.value)},o.mdhdBox.prototype.write=function(r){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint16(this.language),r.writeUint16(0)},o.mehdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.fragment_duration)},o.mfhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.sequence_number)},o.mvhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint32(this.rate),r.writeUint16(this.volume<<8),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32Array(this.matrix),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(this.next_track_id)},o.SampleEntry.prototype.writeHeader=function(r){this.size=8,o.Box.prototype.writeHeader.call(this,r),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint16(this.data_reference_index)},o.SampleEntry.prototype.writeFooter=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r),this.size+=this.boxes[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.SampleEntry.prototype.write=function(r){this.writeHeader(r),r.writeUint8Array(this.data),this.size+=this.data.length,t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.VisualSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*7+6*4+32,r.writeUint16(0),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.width),r.writeUint16(this.height),r.writeUint32(this.horizresolution),r.writeUint32(this.vertresolution),r.writeUint32(0),r.writeUint16(this.frame_count),r.writeUint8(Math.min(31,this.compressorname.length)),r.writeString(this.compressorname,null,31),r.writeUint16(this.depth),r.writeInt16(-1),this.writeFooter(r)},o.AudioSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*4+3*4,r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.channel_count),r.writeUint16(this.samplesize),r.writeUint16(0),r.writeUint16(0),r.writeUint32(this.samplerate<<16),this.writeFooter(r)},o.stppSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,r.writeCString(this.namespace),r.writeCString(this.schema_location),r.writeCString(this.auxiliary_mime_types),this.writeFooter(r)},o.SampleGroupEntry.prototype.write=function(r){r.writeUint8Array(this.data)},o.sbgpBox.prototype.write=function(r){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(r),r.writeString(this.grouping_type,null,4),r.writeUint32(this.grouping_type_parameter),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeInt32(u.sample_count),r.writeInt32(u.group_description_index)}},o.sgpdBox.prototype.write=function(r){var a,u;for(this.flags=0,this.size=12,a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=u.data.length);for(this.writeHeader(r),r.writeString(this.grouping_type,null,4),this.version===1&&r.writeUint32(this.default_length),this.version>=2&&r.writeUint32(this.default_sample_description_index),r.writeUint32(this.entries.length),a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&this.default_length===0&&r.writeUint32(u.description_length),u.write(r)},o.sidxBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(r),r.writeUint32(this.reference_ID),r.writeUint32(this.timescale),r.writeUint32(this.earliest_presentation_time),r.writeUint32(this.first_offset),r.writeUint16(0),r.writeUint16(this.references.length);for(var a=0;a<this.references.length;a++){var u=this.references[a];r.writeUint32(u.reference_type<<31|u.referenced_size),r.writeUint32(u.subsegment_duration),r.writeUint32(u.starts_with_SAP<<31|u.SAP_type<<28|u.SAP_delta_time)}},o.smhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=4,this.writeHeader(r),r.writeUint16(this.balance),r.writeUint16(0)},o.stcoBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),r.writeUint32Array(this.chunk_offsets)},o.stscBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(r),r.writeUint32(this.first_chunk.length),a=0;a<this.first_chunk.length;a++)r.writeUint32(this.first_chunk[a]),r.writeUint32(this.samples_per_chunk[a]),r.writeUint32(this.sample_description_index[a])},o.stsdBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(r),r.writeUint32(this.entries.length),this.size+=4,a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},o.stshBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(r),r.writeUint32(this.shadowed_sample_numbers.length),a=0;a<this.shadowed_sample_numbers.length;a++)r.writeUint32(this.shadowed_sample_numbers[a]),r.writeUint32(this.sync_sample_numbers[a])},o.stssBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(r),r.writeUint32(this.sample_numbers.length),r.writeUint32Array(this.sample_numbers)},o.stszBox.prototype.write=function(r){var a,u=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(a=0;a+1<this.sample_sizes.length;)if(this.sample_sizes[a+1]!==this.sample_sizes[0]){u=!1;break}else a++;else u=!1;this.size=8,u||(this.size+=4*this.sample_sizes.length),this.writeHeader(r),u?r.writeUint32(this.sample_sizes[0]):r.writeUint32(0),r.writeUint32(this.sample_sizes.length),u||r.writeUint32Array(this.sample_sizes)},o.sttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),r.writeUint32(this.sample_deltas[a])},o.tfdtBox.prototype.write=function(r){var a=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>a?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(r),this.version===1?r.writeUint64(this.baseMediaDecodeTime):r.writeUint32(this.baseMediaDecodeTime)},o.tfhdBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&o.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&o.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&o.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&o.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&o.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(r),r.writeUint32(this.track_id),this.flags&o.TFHD_FLAG_BASE_DATA_OFFSET&&r.writeUint64(this.base_data_offset),this.flags&o.TFHD_FLAG_SAMPLE_DESC&&r.writeUint32(this.default_sample_description_index),this.flags&o.TFHD_FLAG_SAMPLE_DUR&&r.writeUint32(this.default_sample_duration),this.flags&o.TFHD_FLAG_SAMPLE_SIZE&&r.writeUint32(this.default_sample_size),this.flags&o.TFHD_FLAG_SAMPLE_FLAGS&&r.writeUint32(this.default_sample_flags)},o.tkhdBox.prototype.write=function(r){this.version=0,this.size=4*18+2*4,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.track_id),r.writeUint32(0),r.writeUint32(this.duration),r.writeUint32(0),r.writeUint32(0),r.writeInt16(this.layer),r.writeInt16(this.alternate_group),r.writeInt16(this.volume<<8),r.writeUint16(0),r.writeInt32Array(this.matrix),r.writeUint32(this.width),r.writeUint32(this.height)},o.trexBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeUint32(this.track_id),r.writeUint32(this.default_sample_description_index),r.writeUint32(this.default_sample_duration),r.writeUint32(this.default_sample_size),r.writeUint32(this.default_sample_flags)},o.trunBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&o.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&o.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&o.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&o.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&o.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&o.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(r),r.writeUint32(this.sample_count),this.flags&o.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=r.getPosition(),r.writeInt32(this.data_offset)),this.flags&o.TRUN_FLAGS_FIRST_FLAG&&r.writeUint32(this.first_sample_flags);for(var a=0;a<this.sample_count;a++)this.flags&o.TRUN_FLAGS_DURATION&&r.writeUint32(this.sample_duration[a]),this.flags&o.TRUN_FLAGS_SIZE&&r.writeUint32(this.sample_size[a]),this.flags&o.TRUN_FLAGS_FLAGS&&r.writeUint32(this.sample_flags[a]),this.flags&o.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?r.writeUint32(this.sample_composition_time_offset[a]):r.writeInt32(this.sample_composition_time_offset[a]))},o["url Box"].prototype.write=function(r){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(r),this.location&&r.writeCString(this.location)},o["urn Box"].prototype.write=function(r){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(r),r.writeCString(this.name),this.location&&r.writeCString(this.location)},o.vmhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=8,this.writeHeader(r),r.writeUint16(this.graphicsmode),r.writeUint16Array(this.opcolor)},o.cttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)r[f].pts=r[f].dts+this.sample_offsets[a],f++},o.sttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)f===0?r[f].dts=0:r[f].dts=r[f-1].dts+this.sample_deltas[a],f++},o.stcoBox.prototype.unpack=function(r){var a;for(a=0;a<this.chunk_offsets.length;a++)r[a].offset=this.chunk_offsets[a]},o.stscBox.prototype.unpack=function(r){var a,u,f,g,b;for(g=0,b=0,a=0;a<this.first_chunk.length;a++)for(u=0;u<(a+1<this.first_chunk.length?this.first_chunk[a+1]:1/0);u++)for(b++,f=0;f<this.samples_per_chunk[a];f++){if(r[g])r[g].description_index=this.sample_description_index[a],r[g].chunk_index=b;else return;g++}},o.stszBox.prototype.unpack=function(r){var a;for(a=0;a<this.sample_sizes.length;a++)r[a].size=this.sample_sizes[a]},o.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],o.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],o.boxEqualFields=function(r,a){if(r&&!a)return!1;var u;for(u in r)if(!(o.DIFF_BOXES_PROP_NAMES.indexOf(u)>-1)){if(r[u]instanceof o.Box||a[u]instanceof o.Box)continue;if(typeof r[u]>"u"||typeof a[u]>"u")continue;if(typeof r[u]=="function"||typeof a[u]=="function")continue;if(r.subBoxNames&&r.subBoxNames.indexOf(u.slice(0,4))>-1||a.subBoxNames&&a.subBoxNames.indexOf(u.slice(0,4))>-1)continue;if(u==="data"||u==="start"||u==="size"||u==="creation_time"||u==="modification_time")continue;if(o.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(u)>-1)continue;if(r[u]!==a[u])return!1}return!0},o.boxEqual=function(r,a){if(!o.boxEqualFields(r,a))return!1;for(var u=0;u<o.DIFF_BOXES_PROP_NAMES.length;u++){var f=o.DIFF_BOXES_PROP_NAMES[u];if(r[f]&&a[f]&&!o.boxEqual(r[f],a[f]))return!1}return!0};var v=function(){};v.prototype.parseSample=function(r){var a={},u;a.resources=[];var f=new e(r.data.buffer);if(!r.subsamples||r.subsamples.length===0)a.documentString=f.readString(r.data.length);else if(a.documentString=f.readString(r.subsamples[0].size),r.subsamples.length>1)for(u=1;u<r.subsamples.length;u++)a.resources[u]=f.readUint8Array(r.subsamples[u].size);return typeof DOMParser<"u"&&(a.document=new DOMParser().parseFromString(a.documentString,"application/xml")),a};var w=function(){};w.prototype.parseSample=function(r){var a,u=new e(r.data.buffer);return a=u.readString(r.data.length),a},w.prototype.parseConfig=function(r){var a,u=new e(r.buffer);return u.readUint32(),a=u.readCString(),a},s.XMLSubtitlein4Parser=v,s.Textin4Parser=w;var x=function(r){this.stream=r||new h,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};x.prototype.setSegmentOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.fragmentedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.segmentStream=null,g.nb_samples=1e3,g.rapAlignement=!0,u&&(u.nbSamples&&(g.nb_samples=u.nbSamples),u.rapAlignement&&(g.rapAlignement=u.rapAlignement))}},x.prototype.unsetSegmentOptions=function(r){for(var a=-1,u=0;u<this.fragmentedTracks.length;u++){var f=this.fragmentedTracks[u];f.id==r&&(a=u)}a>-1&&this.fragmentedTracks.splice(a,1)},x.prototype.setExtractionOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.extractedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.nb_samples=1e3,g.samples=[],u&&u.nbSamples&&(g.nb_samples=u.nbSamples)}},x.prototype.unsetExtractionOptions=function(r){for(var a=-1,u=0;u<this.extractedTracks.length;u++){var f=this.extractedTracks[u];f.id==r&&(a=u)}a>-1&&this.extractedTracks.splice(a,1)},x.prototype.parse=function(){var r,a,u=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),r=o.parseOneBox(this.stream,u),r.code===o.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(r))continue;return}else return;else{var f;switch(a=r.box,f=a.type!=="uuid"?a.type:a.uuid,this.boxes.push(a),f){case"mdat":this.mdats.push(a);break;case"moof":this.moofs.push(a);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[f]!==void 0&&t.warn("ISOFile","Duplicate Box of type: "+f+", overriding previous occurrence"),this[f]=a;break}this.updateUsedBytes&&this.updateUsedBytes(a,r)}},x.prototype.checkBuffer=function(r){if(r==null)throw"Buffer must be defined and non empty";if(r.fileStart===void 0)throw"Buffer must have a fileStart property";return r.byteLength===0?(t.warn("ISOFile","Ignoring empty buffer (fileStart: "+r.fileStart+")"),this.stream.logBufferLevel(),!1):(t.info("ISOFile","Processing buffer (fileStart: "+r.fileStart+")"),r.usedBytes=0,this.stream.insertBuffer(r),this.stream.logBufferLevel(),this.stream.initialized()?!0:(t.warn("ISOFile","Not ready to start parsing"),!1))},x.prototype.appendBuffer=function(r,a){var u;if(this.checkBuffer(r))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(a),this.nextSeekPosition?(u=this.nextSeekPosition,this.nextSeekPosition=void 0):u=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(u=this.stream.getEndFilePositionAfter(u))):this.nextParsePosition?u=this.nextParsePosition:u=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(t.info("ISOFile","Done processing buffer (fileStart: "+r.fileStart+") - next buffer to fetch should have a fileStart position of "+u),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),u},x.prototype.getInfo=function(){var r,a,u={},f,g,b,S,A=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(u.hasMoov=!0,u.duration=this.moov.mvhd.duration,u.timescale=this.moov.mvhd.timescale,u.isFragmented=this.moov.mvex!=null,u.isFragmented&&this.moov.mvex.mehd&&(u.fragment_duration=this.moov.mvex.mehd.fragment_duration),u.isProgressive=this.isProgressive,u.hasIOD=this.moov.iods!=null,u.brands=[],u.brands.push(this.ftyp.major_brand),u.brands=u.brands.concat(this.ftyp.compatible_brands),u.created=new Date(A+this.moov.mvhd.creation_time*1e3),u.modified=new Date(A+this.moov.mvhd.modification_time*1e3),u.tracks=[],u.audioTracks=[],u.videoTracks=[],u.subtitleTracks=[],u.metadataTracks=[],u.hintTracks=[],u.otherTracks=[],r=0;r<this.moov.traks.length;r++){if(f=this.moov.traks[r],S=f.mdia.minf.stbl.stsd.entries[0],g={},u.tracks.push(g),g.id=f.tkhd.track_id,g.name=f.mdia.hdlr.name,g.references=[],f.tref)for(a=0;a<f.tref.boxes.length;a++)b={},g.references.push(b),b.type=f.tref.boxes[a].type,b.track_ids=f.tref.boxes[a].track_ids;f.edts&&(g.edits=f.edts.elst.entries),g.created=new Date(A+f.tkhd.creation_time*1e3),g.modified=new Date(A+f.tkhd.modification_time*1e3),g.movie_duration=f.tkhd.duration,g.movie_timescale=u.timescale,g.layer=f.tkhd.layer,g.alternate_group=f.tkhd.alternate_group,g.volume=f.tkhd.volume,g.matrix=f.tkhd.matrix,g.track_width=f.tkhd.width/65536,g.track_height=f.tkhd.height/65536,g.timescale=f.mdia.mdhd.timescale,g.cts_shift=f.mdia.minf.stbl.cslg,g.duration=f.mdia.mdhd.duration,g.samples_duration=f.samples_duration,g.codec=S.getCodec(),g.kind=f.udta&&f.udta.kinds.length?f.udta.kinds[0]:{schemeURI:"",value:""},g.language=f.mdia.elng?f.mdia.elng.extended_language:f.mdia.mdhd.languageString,g.nb_samples=f.samples.length,g.size=f.samples_size,g.bitrate=g.size*8*g.timescale/g.samples_duration,S.isAudio()?(g.type="audio",u.audioTracks.push(g),g.audio={},g.audio.sample_rate=S.getSampleRate(),g.audio.channel_count=S.getChannelCount(),g.audio.sample_size=S.getSampleSize()):S.isVideo()?(g.type="video",u.videoTracks.push(g),g.video={},g.video.width=S.getWidth(),g.video.height=S.getHeight()):S.isSubtitle()?(g.type="subtitles",u.subtitleTracks.push(g)):S.isHint()?(g.type="metadata",u.hintTracks.push(g)):S.isMetadata()?(g.type="metadata",u.metadataTracks.push(g)):(g.type="metadata",u.otherTracks.push(g))}else u.hasMoov=!1;if(u.mime="",u.hasMoov&&u.tracks){for(u.videoTracks&&u.videoTracks.length>0?u.mime+='video/mp4; codecs="':u.audioTracks&&u.audioTracks.length>0?u.mime+='audio/mp4; codecs="':u.mime+='application/mp4; codecs="',r=0;r<u.tracks.length;r++)r!==0&&(u.mime+=","),u.mime+=u.tracks[r].codec;u.mime+='"; profiles="',u.mime+=this.ftyp.compatible_brands.join(),u.mime+='"'}return u},x.prototype.setNextSeekPositionFromSample=function(r){r&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(r.offset+r.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=r.offset+r.alreadyRead)},x.prototype.processSamples=function(r){var a,u;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(a=0;a<this.fragmentedTracks.length;a++){var f=this.fragmentedTracks[a];for(u=f.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Creating media fragment on track #"+f.id+" for sample "+u.nextSample);var g=this.createFragment(f.id,u.nextSample,f.segmentStream);if(g)f.segmentStream=g,u.nextSample++;else break;if((u.nextSample%f.nb_samples===0||r||u.nextSample>=u.samples.length)&&(t.info("ISOFile","Sending fragmented data on track #"+f.id+" for samples ["+Math.max(0,u.nextSample-f.nb_samples)+","+(u.nextSample-1)+"]"),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(f.id,f.user,f.segmentStream.buffer,u.nextSample,r||u.nextSample>=u.samples.length),f.segmentStream=null,f!==this.fragmentedTracks[a]))break}}if(this.onSamples!==null)for(a=0;a<this.extractedTracks.length;a++){var b=this.extractedTracks[a];for(u=b.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Exporting on track #"+b.id+" sample #"+u.nextSample);var S=this.getSample(u,u.nextSample);if(S)u.nextSample++,b.samples.push(S);else{this.setNextSeekPositionFromSample(u.samples[u.nextSample]);break}if((u.nextSample%b.nb_samples===0||u.nextSample>=u.samples.length)&&(t.debug("ISOFile","Sending samples on track #"+b.id+" for sample "+u.nextSample),this.onSamples&&this.onSamples(b.id,b.user,b.samples),b.samples=[],b!==this.extractedTracks[a]))break}}}},x.prototype.getBox=function(r){var a=this.getBoxes(r,!0);return a.length?a[0]:null},x.prototype.getBoxes=function(r,a){var u=[];return x._sweep.call(this,r,u,a),u},x._sweep=function(r,a,u){this.type&&this.type==r&&a.push(this);for(var f in this.boxes){if(a.length&&u)return;x._sweep.call(this.boxes[f],r,a,u)}},x.prototype.getTrackSamplesInfo=function(r){var a=this.getTrackById(r);if(a)return a.samples},x.prototype.getTrackSample=function(r,a){var u=this.getTrackById(r),f=this.getSample(u,a);return f},x.prototype.releaseUsedSamples=function(r,a){var u=0,f=this.getTrackById(r);f.lastValidSample||(f.lastValidSample=0);for(var g=f.lastValidSample;g<a;g++)u+=this.releaseSample(f,g);t.info("ISOFile","Track #"+r+" released samples up to "+a+" (released size: "+u+", remaining: "+this.samplesDataSize+")"),f.lastValidSample=a},x.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},x.prototype.stop=function(){this.sampleProcessingStarted=!1},x.prototype.flush=function(){t.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},x.prototype.seekTrack=function(r,a,u){var f,g,b=1/0,S=0,A=0,C;if(u.samples.length===0)return t.info("ISOFile","No sample in track, cannot seek! Using time "+t.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(f=0;f<u.samples.length;f++){if(g=u.samples[f],f===0)A=0,C=g.timescale;else if(g.cts>r*g.timescale){A=f-1;break}a&&g.is_sync&&(S=f)}for(a&&(A=S),r=u.samples[A].cts,u.nextSample=A;u.samples[A].alreadyRead===u.samples[A].size&&u.samples[A+1];)A++;return b=u.samples[A].offset+u.samples[A].alreadyRead,t.info("ISOFile","Seeking to "+(a?"RAP":"")+" sample #"+u.nextSample+" on track "+u.tkhd.track_id+", time "+t.getDurationString(r,C)+" and offset: "+b),{offset:b,time:r/C}},x.prototype.getTrackDuration=function(r){var a;return r.samples?(a=r.samples[r.samples.length-1],(a.cts+a.duration)/a.timescale):1/0},x.prototype.seek=function(r,a){var u=this.moov,f,g,b,S={offset:1/0,time:1/0};if(this.moov){for(b=0;b<u.traks.length;b++)f=u.traks[b],!(r>this.getTrackDuration(f))&&(g=this.seekTrack(r,a,f),g.offset<S.offset&&(S.offset=g.offset),g.time<S.time&&(S.time=g.time));return t.info("ISOFile","Seeking at time "+t.getDurationString(S.time,1)+" needs a buffer with a fileStart position of "+S.offset),S.offset===1/0?S={offset:this.nextParsePosition,time:0}:S.offset=this.stream.getEndFilePositionAfter(S.offset),t.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+S.offset),S}else throw"Cannot seek: moov not received!"},x.prototype.equal=function(r){for(var a=0;a<this.boxes.length&&a<r.boxes.length;){var u=this.boxes[a],f=r.boxes[a];if(!o.boxEqual(u,f))return!1;a++}return!0},s.ISOFile=x,x.prototype.lastBoxStartPosition=0,x.prototype.parsingMdat=null,x.prototype.nextParsePosition=0,x.prototype.discardMdatData=!1,x.prototype.processIncompleteBox=function(r){var a,u,f;return r.type==="mdat"?(a=new o[r.type+"Box"](r.size),this.parsingMdat=a,this.boxes.push(a),this.mdats.push(a),a.start=r.start,a.hdr_size=r.hdr_size,this.stream.addUsedBytes(a.hdr_size),this.lastBoxStartPosition=a.start+a.size,f=this.stream.seek(a.start+a.size,!1,this.discardMdatData),f?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=a.start+a.size,!1)):(r.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),u=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,u?(this.nextParsePosition=this.stream.getEndPosition(),!0):(r.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+r.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},x.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},x.prototype.processIncompleteMdat=function(){var r,a;return r=this.parsingMdat,a=this.stream.seek(r.start+r.size,!1,this.discardMdatData),a?(t.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},x.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},x.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},x.prototype.updateUsedBytes=function(r,a){this.stream.addUsedBytes&&(r.type==="mdat"?(this.stream.addUsedBytes(r.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(r.size-r.hdr_size)):this.stream.addUsedBytes(r.size))},x.prototype.add=o.Box.prototype.add,x.prototype.addBox=o.Box.prototype.addBox,x.prototype.init=function(r){var a=r||{};this.add("ftyp").set("major_brand",a.brands&&a.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",a.brands||["iso4"]);var u=this.add("moov");return u.add("mvhd").set("timescale",a.timescale||600).set("rate",a.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",a.duration||0).set("volume",a.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),u.add("mvex"),this},x.prototype.addTrack=function(r){this.moov||this.init(r);var a=r||{};a.width=a.width||320,a.height=a.height||320,a.id=a.id||this.moov.mvhd.next_track_id,a.type=a.type||"avc1";var u=this.moov.add("trak");this.moov.mvhd.next_track_id=a.id+1,u.add("tkhd").set("flags",o.TKHD_FLAG_ENABLED|o.TKHD_FLAG_IN_MOVIE|o.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",a.id).set("duration",a.duration||0).set("layer",a.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",a.width<<16).set("height",a.height<<16);var f=u.add("mdia");f.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",a.timescale||1).set("duration",a.media_duration||0).set("language",a.language||"und"),f.add("hdlr").set("handler",a.hdlr||"vide").set("name",a.name||"Track created with MP4Box.js"),f.add("elng").set("extended_language",a.language||"fr-FR");var g=f.add("minf");if(o[a.type+"SampleEntry"]!==void 0){var b=new o[a.type+"SampleEntry"];b.data_reference_index=1;var S="";for(var A in o.sampleEntryCodes)for(var C=o.sampleEntryCodes[A],B=0;B<C.length;B++)if(C.indexOf(a.type)>-1){S=A;break}switch(S){case"Visual":if(g.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),b.set("width",a.width).set("height",a.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",a.type+" Compressor").set("depth",24),a.avcDecoderConfigRecord){var R=new o.avcCBox;R.parse(new e(a.avcDecoderConfigRecord)),b.addBox(R)}else if(a.hevcDecoderConfigRecord){var M=new o.hvcCBox;M.parse(new e(a.hevcDecoderConfigRecord)),b.addBox(M)}break;case"Audio":g.add("smhd").set("balance",a.balance||0),b.set("channel_count",a.channel_count||2).set("samplesize",a.samplesize||16).set("samplerate",a.samplerate||65536);break;case"Hint":g.add("hmhd");break;case"Subtitle":switch(g.add("sthd"),a.type){case"stpp":b.set("namespace",a.namespace||"nonamespace").set("schema_location",a.schema_location||"").set("auxiliary_mime_types",a.auxiliary_mime_types||"");break}break;case"Metadata":g.add("nmhd");break;case"System":g.add("nmhd");break;default:g.add("nmhd");break}a.description&&b.addBox(a.description),a.description_boxes&&a.description_boxes.forEach(function(L){b.addBox(L)}),g.add("dinf").add("dref").addEntry(new o["url Box"]().set("flags",1));var N=g.add("stbl");return N.add("stsd").addEntry(b),N.add("stts").set("sample_counts",[]).set("sample_deltas",[]),N.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),N.add("stco").set("chunk_offsets",[]),N.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",a.id).set("default_sample_description_index",a.default_sample_description_index||1).set("default_sample_duration",a.default_sample_duration||0).set("default_sample_size",a.default_sample_size||0).set("default_sample_flags",a.default_sample_flags||0),this.buildTrakSampleLists(u),a.id}},o.Box.prototype.computeSize=function(r){var a=r||new n;a.endianness=n.BIG_ENDIAN,this.write(a)},x.prototype.addSample=function(r,a,u){var f=u||{},g={},b=this.getTrackById(r);if(b!==null){g.number=b.samples.length,g.track_id=b.tkhd.track_id,g.timescale=b.mdia.mdhd.timescale,g.description_index=f.sample_description_index?f.sample_description_index-1:0,g.description=b.mdia.minf.stbl.stsd.entries[g.description_index],g.data=a,g.size=a.byteLength,g.alreadyRead=g.size,g.duration=f.duration||1,g.cts=f.cts||0,g.dts=f.dts||0,g.is_sync=f.is_sync||!1,g.is_leading=f.is_leading||0,g.depends_on=f.depends_on||0,g.is_depended_on=f.is_depended_on||0,g.has_redundancy=f.has_redundancy||0,g.degradation_priority=f.degradation_priority||0,g.offset=0,g.subsamples=f.subsamples,b.samples.push(g),b.samples_size+=g.size,b.samples_duration+=g.duration,b.first_dts===void 0&&(b.first_dts=f.dts),this.processSamples();var S=this.createSingleSampleMoof(g);return this.addBox(S),S.computeSize(),S.trafs[0].truns[0].data_offset=S.size+8,this.add("mdat").data=new Uint8Array(a),g}},x.prototype.createSingleSampleMoof=function(r){var a=0;r.is_sync?a=1<<25:a=65536;var u=new o.moofBox;u.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var f=u.add("traf"),g=this.getTrackById(r.track_id);return f.add("tfhd").set("track_id",r.track_id).set("flags",o.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),f.add("tfdt").set("baseMediaDecodeTime",r.dts-(g.first_dts||0)),f.add("trun").set("flags",o.TRUN_FLAGS_DATA_OFFSET|o.TRUN_FLAGS_DURATION|o.TRUN_FLAGS_SIZE|o.TRUN_FLAGS_FLAGS|o.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[r.duration]).set("sample_size",[r.size]).set("sample_flags",[a]).set("sample_composition_time_offset",[r.cts-r.dts]),u},x.prototype.lastMoofIndex=0,x.prototype.samplesDataSize=0,x.prototype.resetTables=function(){var r,a,u,f,g,b,S,A;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,r=0;r<this.moov.traks.length;r++){a=this.moov.traks[r],a.tkhd.duration=0,a.mdia.mdhd.duration=0,u=a.mdia.minf.stbl.stco||a.mdia.minf.stbl.co64,u.chunk_offsets=[],f=a.mdia.minf.stbl.stsc,f.first_chunk=[],f.samples_per_chunk=[],f.sample_description_index=[],g=a.mdia.minf.stbl.stsz||a.mdia.minf.stbl.stz2,g.sample_sizes=[],b=a.mdia.minf.stbl.stts,b.sample_counts=[],b.sample_deltas=[],S=a.mdia.minf.stbl.ctts,S&&(S.sample_counts=[],S.sample_offsets=[]),A=a.mdia.minf.stbl.stss;var C=a.mdia.minf.stbl.boxes.indexOf(A);C!=-1&&(a.mdia.minf.stbl.boxes[C]=null)}},x.initSampleGroups=function(r,a,u,f,g){var b,S,A,C;function B(R,M,N){this.grouping_type=R,this.grouping_type_parameter=M,this.sbgp=N,this.last_sample_in_run=-1,this.entry_index=-1}for(a&&(a.sample_groups_info=[]),r.sample_groups_info||(r.sample_groups_info=[]),S=0;S<u.length;S++){for(C=u[S].grouping_type+"/"+u[S].grouping_type_parameter,A=new B(u[S].grouping_type,u[S].grouping_type_parameter,u[S]),a&&(a.sample_groups_info[C]=A),r.sample_groups_info[C]||(r.sample_groups_info[C]=A),b=0;b<f.length;b++)f[b].grouping_type===u[S].grouping_type&&(A.description=f[b],A.description.used=!0);if(g)for(b=0;b<g.length;b++)g[b].grouping_type===u[S].grouping_type&&(A.fragment_description=g[b],A.fragment_description.used=!0,A.is_fragment=!0)}if(a){if(g)for(S=0;S<g.length;S++)!g[S].used&&g[S].version>=2&&(C=g[S].grouping_type+"/0",A=new B(g[S].grouping_type,0),A.is_fragment=!0,a.sample_groups_info[C]||(a.sample_groups_info[C]=A))}else for(S=0;S<f.length;S++)!f[S].used&&f[S].version>=2&&(C=f[S].grouping_type+"/0",A=new B(f[S].grouping_type,0),r.sample_groups_info[C]||(r.sample_groups_info[C]=A))},x.setSampleGroupProperties=function(r,a,u,f){var g,b;a.sample_groups=[];for(g in f)if(a.sample_groups[g]={},a.sample_groups[g].grouping_type=f[g].grouping_type,a.sample_groups[g].grouping_type_parameter=f[g].grouping_type_parameter,u>=f[g].last_sample_in_run&&(f[g].last_sample_in_run<0&&(f[g].last_sample_in_run=0),f[g].entry_index++,f[g].entry_index<=f[g].sbgp.entries.length-1&&(f[g].last_sample_in_run+=f[g].sbgp.entries[f[g].entry_index].sample_count)),f[g].entry_index<=f[g].sbgp.entries.length-1?a.sample_groups[g].group_description_index=f[g].sbgp.entries[f[g].entry_index].group_description_index:a.sample_groups[g].group_description_index=-1,a.sample_groups[g].group_description_index!==0){var S;f[g].fragment_description?S=f[g].fragment_description:S=f[g].description,a.sample_groups[g].group_description_index>0?(a.sample_groups[g].group_description_index>65535?b=(a.sample_groups[g].group_description_index>>16)-1:b=a.sample_groups[g].group_description_index-1,S&&b>=0&&(a.sample_groups[g].description=S.entries[b])):S&&S.version>=2&&S.default_group_description_index>0&&(a.sample_groups[g].description=S.entries[S.default_group_description_index-1])}},x.process_sdtp=function(r,a,u){a&&(r?(a.is_leading=r.is_leading[u],a.depends_on=r.sample_depends_on[u],a.is_depended_on=r.sample_is_depended_on[u],a.has_redundancy=r.sample_has_redundancy[u]):(a.is_leading=0,a.depends_on=0,a.is_depended_on=0,a.has_redundancy=0))},x.prototype.buildSampleLists=function(){var r,a;for(r=0;r<this.moov.traks.length;r++)a=this.moov.traks[r],this.buildTrakSampleLists(a)},x.prototype.buildTrakSampleLists=function(r){var a,u,f,g,b,S,A,C,B,R,M,N,L,W,k,j,Y,ut,it,gt,Q,rt,Z,H;if(r.samples=[],r.samples_duration=0,r.samples_size=0,u=r.mdia.minf.stbl.stco||r.mdia.minf.stbl.co64,f=r.mdia.minf.stbl.stsc,g=r.mdia.minf.stbl.stsz||r.mdia.minf.stbl.stz2,b=r.mdia.minf.stbl.stts,S=r.mdia.minf.stbl.ctts,A=r.mdia.minf.stbl.stss,C=r.mdia.minf.stbl.stsd,B=r.mdia.minf.stbl.subs,N=r.mdia.minf.stbl.stdp,R=r.mdia.minf.stbl.sbgps,M=r.mdia.minf.stbl.sgpds,ut=-1,it=-1,gt=-1,Q=-1,rt=0,Z=0,H=0,x.initSampleGroups(r,null,R,M),!(typeof g>"u")){for(a=0;a<g.sample_sizes.length;a++){var G={};G.number=a,G.track_id=r.tkhd.track_id,G.timescale=r.mdia.mdhd.timescale,G.alreadyRead=0,r.samples[a]=G,G.size=g.sample_sizes[a],r.samples_size+=G.size,a===0?(W=1,L=0,G.chunk_index=W,G.chunk_run_index=L,Y=f.samples_per_chunk[L],j=0,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0):a<Y?(G.chunk_index=W,G.chunk_run_index=L):(W++,G.chunk_index=W,j=0,W<=k||(L++,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0),G.chunk_run_index=L,Y+=f.samples_per_chunk[L]),G.description_index=f.sample_description_index[G.chunk_run_index]-1,G.description=C.entries[G.description_index],G.offset=u.chunk_offsets[G.chunk_index-1]+j,j+=G.size,a>ut&&(it++,ut<0&&(ut=0),ut+=b.sample_counts[it]),a>0?(r.samples[a-1].duration=b.sample_deltas[it],r.samples_duration+=r.samples[a-1].duration,G.dts=r.samples[a-1].dts+r.samples[a-1].duration):G.dts=0,S?(a>=gt&&(Q++,gt<0&&(gt=0),gt+=S.sample_counts[Q]),G.cts=r.samples[a].dts+S.sample_offsets[Q]):G.cts=G.dts,A?(a==A.sample_numbers[rt]-1?(G.is_sync=!0,rt++):(G.is_sync=!1,G.degradation_priority=0),B&&B.entries[Z].sample_delta+H==a+1&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta,Z++)):G.is_sync=!0,x.process_sdtp(r.mdia.minf.stbl.sdtp,G,G.number),N?G.degradation_priority=N.priority[a]:G.degradation_priority=0,B&&B.entries[Z].sample_delta+H==a&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta),(R.length>0||M.length>0)&&x.setSampleGroupProperties(r,G,a,r.sample_groups_info)}a>0&&(r.samples[a-1].duration=Math.max(r.mdia.mdhd.duration-r.samples[a-1].dts,0),r.samples_duration+=r.samples[a-1].duration)}},x.prototype.updateSampleLists=function(){var r,a,u,f,g,b,S,A,C,B,R,M,N,L,W;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(C=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,C.type=="moof")for(B=C,r=0;r<B.trafs.length;r++){for(R=B.trafs[r],M=this.getTrackById(R.tfhd.track_id),N=this.getTrexById(R.tfhd.track_id),R.tfhd.flags&o.TFHD_FLAG_SAMPLE_DESC?f=R.tfhd.default_sample_description_index:f=N?N.default_sample_description_index:1,R.tfhd.flags&o.TFHD_FLAG_SAMPLE_DUR?g=R.tfhd.default_sample_duration:g=N?N.default_sample_duration:0,R.tfhd.flags&o.TFHD_FLAG_SAMPLE_SIZE?b=R.tfhd.default_sample_size:b=N?N.default_sample_size:0,R.tfhd.flags&o.TFHD_FLAG_SAMPLE_FLAGS?S=R.tfhd.default_sample_flags:S=N?N.default_sample_flags:0,R.sample_number=0,R.sbgps.length>0&&x.initSampleGroups(M,R,R.sbgps,M.mdia.minf.stbl.sgpds,R.sgpds),a=0;a<R.truns.length;a++){var k=R.truns[a];for(u=0;u<k.sample_count;u++){L={},L.moof_number=this.lastMoofIndex,L.number_in_traf=R.sample_number,R.sample_number++,L.number=M.samples.length,R.first_sample_index=M.samples.length,M.samples.push(L),L.track_id=M.tkhd.track_id,L.timescale=M.mdia.mdhd.timescale,L.description_index=f-1,L.description=M.mdia.minf.stbl.stsd.entries[L.description_index],L.size=b,k.flags&o.TRUN_FLAGS_SIZE&&(L.size=k.sample_size[u]),M.samples_size+=L.size,L.duration=g,k.flags&o.TRUN_FLAGS_DURATION&&(L.duration=k.sample_duration[u]),M.samples_duration+=L.duration,M.first_traf_merged||u>0?L.dts=M.samples[M.samples.length-2].dts+M.samples[M.samples.length-2].duration:(R.tfdt?L.dts=R.tfdt.baseMediaDecodeTime:L.dts=0,M.first_traf_merged=!0),L.cts=L.dts,k.flags&o.TRUN_FLAGS_CTS_OFFSET&&(L.cts=L.dts+k.sample_composition_time_offset[u]),W=S,k.flags&o.TRUN_FLAGS_FLAGS?W=k.sample_flags[u]:u===0&&k.flags&o.TRUN_FLAGS_FIRST_FLAG&&(W=k.first_sample_flags),L.is_sync=!(W>>16&1),L.is_leading=W>>26&3,L.depends_on=W>>24&3,L.is_depended_on=W>>22&3,L.has_redundancy=W>>20&3,L.degradation_priority=W&65535;var j=!!(R.tfhd.flags&o.TFHD_FLAG_BASE_DATA_OFFSET),Y=!!(R.tfhd.flags&o.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),ut=!!(k.flags&o.TRUN_FLAGS_DATA_OFFSET),it=0;j?it=R.tfhd.base_data_offset:Y||a===0?it=B.start:it=A,a===0&&u===0?ut?L.offset=it+k.data_offset:L.offset=it:L.offset=A,A=L.offset+L.size,(R.sbgps.length>0||R.sgpds.length>0||M.mdia.minf.stbl.sbgps.length>0||M.mdia.minf.stbl.sgpds.length>0)&&x.setSampleGroupProperties(M,L,L.number_in_traf,R.sample_groups_info)}}if(R.subs){M.has_fragment_subsamples=!0;var gt=R.first_sample_index;for(a=0;a<R.subs.entries.length;a++)gt+=R.subs.entries[a].sample_delta,L=M.samples[gt-1],L.subsamples=R.subs.entries[a].subsamples}}}},x.prototype.getSample=function(r,a){var u,f=r.samples[a];if(!this.moov)return null;if(!f.data)f.data=new Uint8Array(f.size),f.alreadyRead=0,this.samplesDataSize+=f.size,t.debug("ISOFile","Allocating sample #"+a+" on track #"+r.tkhd.track_id+" of size "+f.size+" (total: "+this.samplesDataSize+")");else if(f.alreadyRead==f.size)return f;for(;;){var g=this.stream.findPosition(!0,f.offset+f.alreadyRead,!1);if(g>-1){u=this.stream.buffers[g];var b=u.byteLength-(f.offset+f.alreadyRead-u.fileStart);if(f.size-f.alreadyRead<=b)return t.debug("ISOFile","Getting sample #"+a+" data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+(f.size-f.alreadyRead)+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,f.size-f.alreadyRead),u.usedBytes+=f.size-f.alreadyRead,this.stream.logBufferLevel(),f.alreadyRead=f.size,f;if(b===0)return null;t.debug("ISOFile","Getting sample #"+a+" partial data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+b+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,b),f.alreadyRead+=b,u.usedBytes+=b,this.stream.logBufferLevel()}else return null}},x.prototype.releaseSample=function(r,a){var u=r.samples[a];return u.data?(this.samplesDataSize-=u.size,u.data=null,u.alreadyRead=0,u.size):0},x.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},x.prototype.getCodecs=function(){var r,a="";for(r=0;r<this.moov.traks.length;r++){var u=this.moov.traks[r];r>0&&(a+=","),a+=u.mdia.minf.stbl.stsd.entries[0].getCodec()}return a},x.prototype.getTrexById=function(r){var a;if(!this.moov||!this.moov.mvex)return null;for(a=0;a<this.moov.mvex.trexs.length;a++){var u=this.moov.mvex.trexs[a];if(u.track_id==r)return u}return null},x.prototype.getTrackById=function(r){if(this.moov===void 0)return null;for(var a=0;a<this.moov.traks.length;a++){var u=this.moov.traks[a];if(u.tkhd.track_id==r)return u}return null},x.prototype.items=[],x.prototype.entity_groups=[],x.prototype.itemsDataSize=0,x.prototype.flattenItemInfo=function(){var r=this.items,a=this.entity_groups,u,f,g,b=this.meta;if(b!=null&&b.hdlr!==void 0&&b.iinf!==void 0){for(u=0;u<b.iinf.item_infos.length;u++)g={},g.id=b.iinf.item_infos[u].item_ID,r[g.id]=g,g.ref_to=[],g.name=b.iinf.item_infos[u].item_name,b.iinf.item_infos[u].protection_index>0&&(g.protection=b.ipro.protections[b.iinf.item_infos[u].protection_index-1]),b.iinf.item_infos[u].item_type?g.type=b.iinf.item_infos[u].item_type:g.type="mime",g.content_type=b.iinf.item_infos[u].content_type,g.content_encoding=b.iinf.item_infos[u].content_encoding;if(b.grpl)for(u=0;u<b.grpl.boxes.length;u++)entity_group={},entity_group.id=b.grpl.boxes[u].group_id,entity_group.entity_ids=b.grpl.boxes[u].entity_ids,entity_group.type=b.grpl.boxes[u].type,a[entity_group.id]=entity_group;if(b.iloc)for(u=0;u<b.iloc.items.length;u++){var S=b.iloc.items[u];switch(g=r[S.item_ID],S.data_reference_index!==0&&(t.warn("Item storage with reference to other files: not supported"),g.source=b.dinf.boxes[S.data_reference_index-1]),S.construction_method){case 0:break;case 1:t.warn("Item storage with construction_method : not supported");break;case 2:t.warn("Item storage with construction_method : not supported");break}for(g.extents=[],g.size=0,f=0;f<S.extents.length;f++)g.extents[f]={},g.extents[f].offset=S.extents[f].extent_offset+S.base_offset,g.extents[f].length=S.extents[f].extent_length,g.extents[f].alreadyRead=0,g.size+=g.extents[f].length}if(b.pitm&&(r[b.pitm.item_id].primary=!0),b.iref)for(u=0;u<b.iref.references.length;u++){var A=b.iref.references[u];for(f=0;f<A.references.length;f++)r[A.from_item_ID].ref_to.push({type:A.type,id:A.references[f]})}if(b.iprp)for(var C=0;C<b.iprp.ipmas.length;C++){var B=b.iprp.ipmas[C];for(u=0;u<B.associations.length;u++){var R=B.associations[u];if(g=r[R.id],g||(g=a[R.id]),g)for(g.properties===void 0&&(g.properties={},g.properties.boxes=[]),f=0;f<R.props.length;f++){var M=R.props[f];if(M.property_index>0&&M.property_index-1<b.iprp.ipco.boxes.length){var N=b.iprp.ipco.boxes[M.property_index-1];g.properties[N.type]=N,g.properties.boxes.push(N)}}}}}},x.prototype.getItem=function(r){var a,u;if(!this.meta)return null;if(u=this.items[r],!u.data&&u.size)u.data=new Uint8Array(u.size),u.alreadyRead=0,this.itemsDataSize+=u.size,t.debug("ISOFile","Allocating item #"+r+" of size "+u.size+" (total: "+this.itemsDataSize+")");else if(u.alreadyRead===u.size)return u;for(var f=0;f<u.extents.length;f++){var g=u.extents[f];if(g.alreadyRead!==g.length){var b=this.stream.findPosition(!0,g.offset+g.alreadyRead,!1);if(b>-1){a=this.stream.buffers[b];var S=a.byteLength-(g.offset+g.alreadyRead-a.fileStart);if(g.length-g.alreadyRead<=S)t.debug("ISOFile","Getting item #"+r+" extent #"+f+" data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+(g.length-g.alreadyRead)+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,g.length-g.alreadyRead),a.usedBytes+=g.length-g.alreadyRead,this.stream.logBufferLevel(),u.alreadyRead+=g.length-g.alreadyRead,g.alreadyRead=g.length;else return t.debug("ISOFile","Getting item #"+r+" extent #"+f+" partial data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+S+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,S),g.alreadyRead+=S,u.alreadyRead+=S,a.usedBytes+=S,this.stream.logBufferLevel(),null}else return null}}return u.alreadyRead===u.size?u:null},x.prototype.releaseItem=function(r){var a=this.items[r];if(a.data){this.itemsDataSize-=a.size,a.data=null,a.alreadyRead=0;for(var u=0;u<a.extents.length;u++){var f=a.extents[u];f.alreadyRead=0}return a.size}else return 0},x.prototype.processItems=function(r){for(var a in this.items){var u=this.items[a];this.getItem(u.id),r&&!u.sent&&(r(u),u.sent=!0,u.data=null)}},x.prototype.hasItem=function(r){for(var a in this.items){var u=this.items[a];if(u.name===r)return u.id}return-1},x.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},x.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},x.prototype.itemToFragmentedTrackFile=function(r){var a=r||{},u=null;if(a.itemId?u=this.getItem(a.itemId):u=this.getPrimaryItem(),u==null)return null;var f=new x;f.discardMdatData=!1;var g={type:u.type,description_boxes:u.properties.boxes};u.properties.ispe&&(g.width=u.properties.ispe.image_width,g.height=u.properties.ispe.image_height);var b=f.addTrack(g);return b?(f.addSample(b,u.data),f):null},x.prototype.write=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r)},x.prototype.createFragment=function(r,a,u){var f=this.getTrackById(r),g=this.getSample(f,a);if(g==null)return this.setNextSeekPositionFromSample(f.samples[a]),null;var b=u||new n;b.endianness=n.BIG_ENDIAN;var S=this.createSingleSampleMoof(g);S.write(b),S.trafs[0].truns[0].data_offset=S.size+8,t.debug("MP4Box","Adjusting data_offset with new value "+S.trafs[0].truns[0].data_offset),b.adjustUint32(S.trafs[0].truns[0].data_offset_position,S.trafs[0].truns[0].data_offset);var A=new o.mdatBox;return A.data=g.data,A.write(b),b},x.writeInitializationSegment=function(r,a,u,f){var g;t.debug("ISOFile","Generating initialization segment");var b=new n;b.endianness=n.BIG_ENDIAN,r.write(b);var S=a.add("mvex");for(u&&S.add("mehd").set("fragment_duration",u),g=0;g<a.traks.length;g++)S.add("trex").set("track_id",a.traks[g].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",f).set("default_sample_size",0).set("default_sample_flags",65536);return a.write(b),b.buffer},x.prototype.save=function(r){var a=new n;a.endianness=n.BIG_ENDIAN,this.write(a),a.save(r)},x.prototype.getBuffer=function(){var r=new n;return r.endianness=n.BIG_ENDIAN,this.write(r),r.buffer},x.prototype.initializeSegmentation=function(){var r,a,u,f;for(this.onSegment===null&&t.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),a=[],r=0;r<this.fragmentedTracks.length;r++){var g=new o.moovBox;g.mvhd=this.moov.mvhd,g.boxes.push(g.mvhd),u=this.getTrackById(this.fragmentedTracks[r].id),g.boxes.push(u),g.traks.push(u),f={},f.id=u.tkhd.track_id,f.user=this.fragmentedTracks[r].user,f.buffer=x.writeInitializationSegment(this.ftyp,g,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[r].samples.length>0?this.moov.traks[r].samples[0].duration:0),a.push(f)}return a},o.Box.prototype.printHeader=function(r){this.size+=8,this.size>l&&(this.size+=8),this.type==="uuid"&&(this.size+=16),r.log(r.indent+"size:"+this.size),r.log(r.indent+"type:"+this.type)},o.FullBox.prototype.printHeader=function(r){this.size+=4,o.Box.prototype.printHeader.call(this,r),r.log(r.indent+"version:"+this.version),r.log(r.indent+"flags:"+this.flags)},o.Box.prototype.print=function(r){this.printHeader(r)},o.ContainerBox.prototype.print=function(r){this.printHeader(r);for(var a=0;a<this.boxes.length;a++)if(this.boxes[a]){var u=r.indent;r.indent+=" ",this.boxes[a].print(r),r.indent=u}},x.prototype.print=function(r){r.indent="";for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&this.boxes[a].print(r)},o.mvhdBox.prototype.print=function(r){o.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"timescale: "+this.timescale),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"rate: "+this.rate),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"next_track_id: "+this.next_track_id)},o.tkhdBox.prototype.print=function(r){o.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"track_id: "+this.track_id),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"layer: "+this.layer),r.log(r.indent+"alternate_group: "+this.alternate_group),r.log(r.indent+"width: "+this.width),r.log(r.indent+"height: "+this.height)};var T={};T.createFile=function(r,a){var u=r!==void 0?r:!0,f=new x(a);return f.discardMdatData=!u,f},s.createFile=T.createFile})(tx);const uo=Cc(tx);var cI=Object.defineProperty,ex=s=>{throw TypeError(s)},dI=(s,t,e)=>t in s?cI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,df=(s,t,e)=>dI(s,typeof t!="symbol"?t+"":t,e),fI=(s,t,e)=>t.has(s)||ex("Cannot "+e),Ta=(s,t,e)=>(fI(s,t,"read from private field"),e?e.call(s):t.get(s)),pI=(s,t,e)=>t.has(s)?ex("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),Xn;let ea=class{constructor(){pI(this,Xn,new Map),df(this,"on",(t,e)=>{const n=Ta(this,Xn).get(t)??new Set;return n.add(e),Ta(this,Xn).has(t)||Ta(this,Xn).set(t,n),()=>{n.delete(e),n.size===0&&Ta(this,Xn).delete(t)}}),df(this,"once",(t,e)=>{const n=this.on(t,(...l)=>{n(),e(...l)});return n}),df(this,"emit",(t,...e)=>{const n=Ta(this,Xn).get(t);n!=null&&n.forEach(l=>l(...e))})}static forwardEvent(t,e,n){const l=n.map(h=>{const[d,o]=Array.isArray(h)?h:[h,h];return t.on(d,(..._)=>{e.emit(o,..._)})});return()=>{l.forEach(h=>h())}}destroy(){Ta(this,Xn).clear()}};Xn=new WeakMap;const _I=()=>{let s,t=16.6;self.onmessage=e=>{e.data.event==="start"&&(self.clearInterval(s),s=self.setInterval(()=>{self.postMessage({})},t)),e.data.event==="stop"&&self.clearInterval(s)}},gI=()=>{const s=new Blob([`(${_I.toString()})()`]),t=URL.createObjectURL(s);return new Worker(t)},Ba=new Map;let yp=1,ro=null;globalThis.Worker!=null&&(ro=gI(),ro.onmessage=()=>{yp+=1;for(const[s,t]of Ba)if(yp%s===0)for(const e of t)e()});const M_=(s,t)=>{const e=Math.round(t/16.6),n=Ba.get(e)??new Set;return n.add(s),Ba.set(e,n),Ba.size===1&&n.size===1&&(ro==null||ro.postMessage({event:"start"})),()=>{n.delete(s),n.size===0&&Ba.delete(e),Ba.size===0&&(yp=0,ro==null||ro.postMessage({event:"stop"}))}};function mI(s,t){let e=!1;async function n(){const l=s.getReader();for(;!e;){const{value:h,done:d}=await l.read();if(d){t.onDone();return}await t.onChunk(h)}l.releaseLock(),await s.cancel()}return n().catch(console.error),()=>{e=!0}}function yI(s,t,e){let n=0,l=0;const h=s.boxes;let d=!1;const o=()=>{var w;if(!d)if(h.find(r=>r.type==="moof")!=null)d=!0;else return null;if(l>=h.length)return null;const x=new uo.DataStream;x.endianness=uo.DataStream.BIG_ENDIAN;let T=l;try{for(;T<h.length;)h[T].write(x),delete h[T],T+=1}catch(r){const a=h[T];throw r instanceof Error&&a!=null?Error(`${r.message} | deltaBuf( boxType: ${a.type}, boxSize: ${a.size}, boxDataLen: ${((w=a.data)==null?void 0:w.length)??-1})`):r}return vI(s),l=h.length,new Uint8Array(x.buffer)};let _=!1,m=!1,v=null;return{stream:new ReadableStream({start(w){n=self.setInterval(()=>{const x=o();x!=null&&!m&&w.enqueue(x)},t),v=x=>{if(clearInterval(n),s.flush(),x!=null){w.error(x);return}const T=o();T!=null&&!m&&w.enqueue(T),m||w.close()},_&&v()},cancel(){m=!0,clearInterval(n),e==null||e()}}),stop:w=>{_||(_=!0,v==null||v(w))}}}function vI(s){if(s.moov!=null){for(var t=0;t<s.moov.traks.length;t++)s.moov.traks[t].samples=[];s.mdats=[],s.moofs=[]}}const L_=(s,t)=>{const e=new Uint8Array(8);new DataView(e.buffer).setUint32(0,t);for(let n=0;n<4;n++)e[4+n]=s.charCodeAt(n);return e},xI=()=>{const s=new TextEncoder,t=s.encode("mdta"),e=s.encode("mp4 handler"),n=32+e.byteLength+1,l=new Uint8Array(n),h=new DataView(l.buffer);return l.set(L_("hdlr",n),0),h.setUint32(8,0),l.set(t,16),l.set(e,32),l},bI=s=>{const t=new TextEncoder,e=t.encode("mdta"),n=s.map(_=>{const m=t.encode(_),v=8+m.byteLength,w=new Uint8Array(v);return new DataView(w.buffer).setUint32(0,v),w.set(e,4),w.set(m,4+e.byteLength),w}),l=16+n.reduce((_,m)=>_+m.byteLength,0),h=new Uint8Array(l),d=new DataView(h.buffer);h.set(L_("keys",l),0),d.setUint32(8,0),d.setUint32(12,s.length);let o=16;for(const _ of n)h.set(_,o),o+=_.byteLength;return h},wI=s=>{const t=new TextEncoder,e=t.encode("data"),n=Object.entries(s).map(([o,_],m)=>{const v=m+1,w=t.encode(_),x=24+w.byteLength,T=new Uint8Array(x),r=new DataView(T.buffer);return r.setUint32(0,x),r.setUint32(4,v),r.setUint32(8,16+w.byteLength),T.set(e,12),r.setUint32(16,1),T.set(w,24),T}),l=8+n.reduce((o,_)=>o+_.byteLength,0),h=new Uint8Array(l);h.set(L_("ilst",l),0);let d=8;for(const o of n)h.set(o,d),d+=o.byteLength;return h},SI=s=>{const t=xI(),e=bI(Object.keys(s)),n=wI(s),l=t.length+e.length+n.length,h=new Uint8Array(l);return h.set(t,0),h.set(e,t.length),h.set(n,t.length+e.length),h};function EI(s){return s instanceof Error?String(s):typeof s=="object"?JSON.stringify(s,(t,e)=>e instanceof Error?String(e):e):String(s)}function TI(){const s=new Date;return`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}.${s.getMilliseconds()}`}let ix=1;const rx=[],Ny=["debug","info","warn","error"].reduce((s,t,e)=>Object.assign(s,{[t]:(...n)=>{ix<=e&&(console[t](...n),rx.push({lvName:t,timeStr:TI(),args:n}))}}),{}),zl=new Map,Zt={setLogLevel:s=>{ix=zl.get(s)??1},...Ny,create:s=>Object.fromEntries(Object.entries(Ny).map(([t,e])=>[t,(...n)=>e(s,...n)])),async dump(){return rx.reduce((s,{lvName:t,timeStr:e,args:n})=>s+`[${t}][${e}]  ${n.map(l=>EI(l)).join(" ")}
`,"")}};zl.set(Zt.debug,0);zl.set(Zt.info,1);zl.set(Zt.warn,2);zl.set(Zt.error,3);(async function(){await Promise.resolve(),!(globalThis.navigator==null||globalThis.document==null)&&(Zt.info(`@webav version: 1.0.11, date: ${new Date().toLocaleDateString()}`),Zt.info(globalThis.navigator.userAgent),document.addEventListener("visibilitychange",()=>{Zt.info(`visibilitychange: ${document.visibilityState}`)}),"PressureObserver"in globalThis&&new PressureObserver(s=>{Zt.info(`cpu state change: ${JSON.stringify(s.map(t=>t.state))}`)}).observe("cpu"))})();function AI(s){Zt.info("recodemux opts:",s);const t=uo.createFile(),e=new ea,n=(_,m)=>{const v=_.add("udta").add("meta");v.data=SI(m),v.size=v.data.byteLength};let l=!1;const h=()=>{t.moov==null||l||(l=!0,s.metaDataTags!=null&&n(t.moov,s.metaDataTags),s.duration!=null&&(t.moov.mvhd.duration=s.duration))};e.once("VideoReady",h),e.once("AudioReady",h);let d=s.video!=null?CI(s.video,t,e):null,o=s.audio!=null?II(s.audio,t,e):null;return s.video==null&&e.emit("VideoReady"),s.audio==null&&e.emit("AudioReady"),{encodeVideo:(_,m)=>{d==null||d.encode(_,m),_.close()},encodeAudio:_=>{if(o!=null)try{o.encode(_),_.close()}catch(m){const v=`encode audio chunk error: ${m.message}, state: ${JSON.stringify({qSize:o.encodeQueueSize,state:o.state})}`;throw Zt.error(v),Error(v)}},getEncodeQueueSize:()=>(d==null?void 0:d.encodeQueueSize)??(o==null?void 0:o.encodeQueueSize)??0,flush:async()=>{await Promise.all([d==null?void 0:d.flush(),(o==null?void 0:o.state)==="configured"?o.flush():null])},close:()=>{e.destroy(),d==null||d.close(),(o==null?void 0:o.state)==="configured"&&o.close()},mp4file:t}}function CI(s,t,e){const n={timescale:1e6,width:s.width,height:s.height,brands:["isom","iso2","avc1","mp42","mp41"],avcDecoderConfigRecord:null,name:"Track created with WebAV"};let l=-1,h=!1;e.once("AudioReady",()=>{h=!0});const d={encoder0:[],encoder1:[]},o=(f,g,b)=>{var S;if(l===-1&&b!=null){const A=(S=b.decoderConfig)==null?void 0:S.description;UI(A),n.avcDecoderConfigRecord=A,l=t.addTrack(n),e.emit("VideoReady"),Zt.info("VideoEncoder, video track ready, trackId:",l)}d[f].push(vp(g))};let _="encoder1",m=0;const v=Math.floor(1e3/s.expectFPS*1e3);function w(){if(!h)return;const f=_==="encoder1"?"encoder0":"encoder1",g=d[_],b=d[f];if(g.length===0&&b.length===0)return;let S=g[0];if(S!=null&&(!S.is_sync||S.cts-m<v)){const C=x(g);C>m&&(m=C)}const A=b[0];if(A!=null&&A.is_sync&&A.cts-m<v){_=f,w();return}if(S!=null&&S.is_sync&&A!=null&&A.is_sync)if(S.cts<=A.cts){const C=x(g);C>m&&(m=C)}else{_=f,w();return}}function x(f){let g=-1,b=0;for(;b<f.length;b++){const S=f[b];if(b>0&&S.is_sync)break;t.addSample(l,S.data,S),g=S.cts+S.duration}return f.splice(0,b),g}const T=M_(w,15),r=zy(s,(f,g)=>o("encoder0",f,g)),a=zy(s,(f,g)=>o("encoder1",f,g));let u=0;return{get encodeQueueSize(){return r.encodeQueueSize+a.encodeQueueSize},encode:(f,g)=>{try{g.keyFrame&&(u+=1),(u%2===0?r:a).encode(f,g)}catch(b){const S=`encode video frame error: ${b.message}, state: ${JSON.stringify({ts:f.timestamp,keyFrame:g.keyFrame,duration:f.duration,gopId:u})}`;throw Zt.error(S),Error(S)}},flush:async()=>{await Promise.all([r.state==="configured"?await r.flush():null,a.state==="configured"?await a.flush():null]),T(),w()},close:()=>{r.state==="configured"&&r.close(),a.state==="configured"&&a.close()}}}function UI(s){const t=new Uint8Array(s);t[2].toString(2).slice(-2).includes("1")&&(t[2]=0)}function zy(s,t){const e={codec:s.codec,framerate:s.expectFPS,hardwareAcceleration:s.__unsafe_hardwareAcceleration__,bitrate:s.bitrate,width:s.width,height:s.height,alpha:"discard",avc:{format:"avc"}},n=new VideoEncoder({error:l=>{const h=`VideoEncoder error: ${l.message}, config: ${JSON.stringify(e)}, state: ${JSON.stringify({qSize:n.encodeQueueSize,state:n.state})}`;throw Zt.error(h),Error(h)},output:t});return n.configure(e),n}function II(s,t,e){const n={timescale:1e6,samplerate:s.sampleRate,channel_count:s.channelCount,hdlr:"soun",type:s.codec==="aac"?"mp4a":"Opus",name:"Track created with WebAV"};let l=-1,h=[],d=!1;e.once("VideoReady",()=>{d=!0,h.forEach(m=>{const v=vp(m);t.addSample(l,v.data,v)}),h=[]});const o={codec:s.codec==="aac"?"mp4a.40.2":"opus",sampleRate:s.sampleRate,numberOfChannels:s.channelCount,bitrate:128e3},_=new AudioEncoder({error:m=>{const v=`AudioEncoder error: ${m.message}, config: ${JSON.stringify(o)}, state: ${JSON.stringify({qSize:_.encodeQueueSize,state:_.state})}`;throw Zt.error(v),Error(v)},output:(m,v)=>{var w;if(l===-1){const x=(w=v.decoderConfig)==null?void 0:w.description;l=t.addTrack({...n,description:x==null?void 0:PI(x)}),e.emit("AudioReady"),Zt.info("AudioEncoder, audio track ready, trackId:",l)}if(d){const x=vp(m);t.addSample(l,x.data,x)}else h.push(m)}});return _.configure(o),_}function PI(s){const t=s.byteLength,e=new Uint8Array([0,0,0,0,3,23+t,0,2,0,4,18+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5,t,...new Uint8Array(s instanceof ArrayBuffer?s:s.buffer),6,1,2]),n=new uo.BoxParser.esdsBox(e.byteLength);return n.hdr_size=0,n.parse(new uo.DataStream(e,0,uo.DataStream.BIG_ENDIAN)),n}function vp(s){const t=new ArrayBuffer(s.byteLength);s.copyTo(t);const e=s.timestamp;return{duration:s.duration??0,dts:e,cts:e,is_sync:s.type==="key",data:t}}class RI{constructor(t,e,n){this.length_=t,this.scaleFactor_=(t-1)/e,this.interpolate=this.cubic,n.method==="point"?this.interpolate=this.point:n.method==="linear"?this.interpolate=this.linear:n.method==="sinc"&&(this.interpolate=this.sinc),this.tangentFactor_=1-Math.max(0,Math.min(1,n.tension||0)),this.sincFilterSize_=n.sincFilterSize||1,this.kernel_=FI(n.sincWindow||BI)}point(t,e){return this.getClippedInput_(Math.round(this.scaleFactor_*t),e)}linear(t,e){t=this.scaleFactor_*t;let n=Math.floor(t);return t-=n,(1-t)*this.getClippedInput_(n,e)+t*this.getClippedInput_(n+1,e)}cubic(t,e){t=this.scaleFactor_*t;let n=Math.floor(t),l=[this.getTangent_(n,e),this.getTangent_(n+1,e)],h=[this.getClippedInput_(n,e),this.getClippedInput_(n+1,e)];t-=n;let d=t*t,o=t*d;return(2*o-3*d+1)*h[0]+(o-2*d+t)*l[0]+(-2*o+3*d)*h[1]+(o-d)*l[1]}sinc(t,e){t=this.scaleFactor_*t;let n=Math.floor(t),l=n-this.sincFilterSize_+1,h=n+this.sincFilterSize_,d=0;for(let o=l;o<=h;o++)d+=this.kernel_(t-o)*this.getClippedInput_(o,e);return d}getTangent_(t,e){return this.tangentFactor_*(this.getClippedInput_(t+1,e)-this.getClippedInput_(t-1,e))/2}getClippedInput_(t,e){return 0<=t&&t<this.length_?e[t]:0}}function BI(s){return Math.exp(-s/2*s/2)}function FI(s){return function(t){return MI(t)*s(t)}}function MI(s){return s===0?1:Math.sin(Math.PI*s)/(Math.PI*s)}class LI{constructor(t,e,n){let l=2*Math.PI*n/e,h=0;this.filters=[];for(let d=0;d<=t;d++)d-t/2===0?this.filters[d]=l:(this.filters[d]=Math.sin(l*(d-t/2))/(d-t/2),this.filters[d]*=.54-.46*Math.cos(2*Math.PI*d/t)),h=h+this.filters[d];for(let d=0;d<=t;d++)this.filters[d]/=h;this.z=this.initZ_()}filter(t){this.z.buf[this.z.pointer]=t;let e=0;for(let n=0,l=this.z.buf.length;n<l;n++)e+=this.filters[n]*this.z.buf[(this.z.pointer+n)%this.z.buf.length];return this.z.pointer=(this.z.pointer+1)%this.z.buf.length,e}reset(){this.z=this.initZ_()}initZ_(){let t=[];for(let e=0;e<this.filters.length-1;e++)t.push(0);return{buf:t,pointer:0}}}class DI{constructor(t,e,n){let l=[];for(let h=0;h<t;h++)l.push(this.getCoeffs_({Fs:e,Fc:n,Q:.5/Math.sin(Math.PI/(t*2)*(h+.5))}));this.stages=[];for(let h=0;h<l.length;h++)this.stages[h]={b0:l[h].b[0],b1:l[h].b[1],b2:l[h].b[2],a1:l[h].a[0],a2:l[h].a[1],k:l[h].k,z:[0,0]}}filter(t){let e=t;for(let n=0,l=this.stages.length;n<l;n++)e=this.runStage_(n,e);return e}getCoeffs_(t){let e={};e.z=[0,0],e.a=[],e.b=[];let n=this.preCalc_(t,e);return e.k=1,e.b.push((1-n.cw)/(2*n.a0)),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e}preCalc_(t,e){let n={},l=2*Math.PI*t.Fc/t.Fs;return n.alpha=Math.sin(l)/(2*t.Q),n.cw=Math.cos(l),n.a0=1+n.alpha,e.a0=n.a0,e.a.push(-2*n.cw/n.a0),e.k=1,e.a.push((1-n.alpha)/n.a0),n}runStage_(t,e){let n=e*this.stages[t].k-this.stages[t].a1*this.stages[t].z[0]-this.stages[t].a2*this.stages[t].z[1],l=this.stages[t].b0*n+this.stages[t].b1*this.stages[t].z[0]+this.stages[t].b2*this.stages[t].z[1];return this.stages[t].z[1]=this.stages[t].z[0],this.stages[t].z[0]=n,l}reset(){for(let t=0;t<this.stages.length;t++)this.stages[t].z=[0,0]}}const kI={point:!1,linear:!1,cubic:!0,sinc:!0},Gy={IIR:16,FIR:71},OI={IIR:DI,FIR:LI};function NI(s,t,e,n={}){let l=(e-t)/t+1,h=new Float64Array(s.length*l);n.method=n.method||"cubic";let d=new RI(s.length,h.length,{method:n.method,tension:n.tension||0,sincFilterSize:n.sincFilterSize||6,sincWindow:n.sincWindow||void 0});if(n.LPF===void 0&&(n.LPF=kI[n.method]),n.LPF){n.LPFType=n.LPFType||"IIR";const o=OI[n.LPFType];if(e>t){let _=new o(n.LPFOrder||Gy[n.LPFType],e,t/2);zI(s,h,d,_)}else{let _=new o(n.LPFOrder||Gy[n.LPFType],t,e/2);GI(s,h,d,_)}}else nx(s,h,d);return h}function nx(s,t,e){for(let n=0,l=t.length;n<l;n++)t[n]=e.interpolate(n,s)}function zI(s,t,e,n){for(let l=0,h=t.length;l<h;l++)t[l]=n.filter(e.interpolate(l,s));n.reset();for(let l=t.length-1;l>=0;l--)t[l]=n.filter(t[l])}function GI(s,t,e,n){for(let l=0,h=s.length;l<h;l++)s[l]=n.filter(s[l]);n.reset();for(let l=s.length-1;l>=0;l--)s[l]=n.filter(s[l]);nx(s,t,e)}var HI=Object.defineProperty,sx=s=>{throw TypeError(s)},$I=(s,t,e)=>t in s?HI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Le=(s,t,e)=>$I(s,typeof t!="symbol"?t+"":t,e),D_=(s,t,e)=>t.has(s)||sx("Cannot "+e),F=(s,t,e)=>(D_(s,t,"read from private field"),e?e.call(s):t.get(s)),_t=(s,t,e)=>t.has(s)?sx("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),ct=(s,t,e,n)=>(D_(s,t,"write to private field"),t.set(s,e),e),wr=(s,t,e)=>(D_(s,t,"access private method"),e);function VI(s){if(s.format==="f32-planar"){const t=[];for(let e=0;e<s.numberOfChannels;e+=1){const n=s.allocationSize({planeIndex:e}),l=new ArrayBuffer(n);s.copyTo(l,{planeIndex:e}),t.push(new Float32Array(l))}return t}else if(s.format==="f32"){const t=new ArrayBuffer(s.allocationSize({planeIndex:0}));return s.copyTo(t,{planeIndex:0}),XI(new Float32Array(t),s.numberOfChannels)}else if(s.format==="s16"){const t=new ArrayBuffer(s.allocationSize({planeIndex:0}));return s.copyTo(t,{planeIndex:0}),WI(new Int16Array(t),s.numberOfChannels)}throw Error("Unsupported audio data format")}function WI(s,t){const e=s.length/t,n=Array.from({length:t},()=>new Float32Array(e));for(let l=0;l<e;l++)for(let h=0;h<t;h++){const d=s[l*t+h];n[h][l]=d/32768}return n}function XI(s,t){const e=s.length/t,n=Array.from({length:t},()=>new Float32Array(e));for(let l=0;l<e;l++)for(let h=0;h<t;h++)n[h][l]=s[l*t+h];return n}function ax(s){return Array(s.numberOfChannels).fill(0).map((t,e)=>s.getChannelData(e))}async function YI(s,t){var e;const n={type:t,data:s},l=new ImageDecoder(n);await Promise.all([l.completed,l.tracks.ready]);let h=((e=l.tracks.selectedTrack)==null?void 0:e.frameCount)??1;const d=[];for(let o=0;o<h;o+=1)d.push((await l.decode({frameIndex:o})).image);return d}async function jI(s,t,e){const n=s.length,l=Array(e.chanCount).fill(0).map(()=>new Float32Array(0));if(n===0)return l;const h=Math.max(...s.map(m=>m.length));if(h===0)return l;if(globalThis.OfflineAudioContext==null)return s.map(m=>new Float32Array(NI(m,t,e.rate,{method:"sinc",LPF:!1})));const d=new globalThis.OfflineAudioContext(e.chanCount,h*e.rate/t,e.rate),o=d.createBufferSource(),_=d.createBuffer(n,h,t);return s.forEach((m,v)=>_.copyToChannel(m,v)),o.buffer=_,o.connect(d.destination),o.start(),ax(await d.startRendering())}function k_(s){return new Promise(t=>{const e=M_(()=>{e(),t()},s)})}function Hy(s,t,e){const n=e-t,l=new Float32Array(n);let h=0;for(;h<n;)l[h]=s[(t+h)%s.length],h+=1;return l}function ox(s,t){const e=Math.floor(s.length/t),n=new Float32Array(e);for(let l=0;l<e;l++){const h=l*t,d=Math.floor(h),o=h-d;d+1<s.length?n[l]=s[d]*(1-o)+s[d+1]*o:n[l]=s[d]}return n}const Ie={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2"};function qI(s,t){const e=t.videoTracks[0],n={};if(e!=null){const h=KI(s.getTrackById(e.id)).buffer,{descKey:d,type:o}=e.codec.startsWith("avc1")?{descKey:"avcDecoderConfigRecord",type:"avc1"}:e.codec.startsWith("hvc1")?{descKey:"hevcDecoderConfigRecord",type:"hvc1"}:{descKey:"",type:""};d!==""&&(n.videoTrackConf={timescale:e.timescale,duration:e.duration,width:e.video.width,height:e.video.height,brands:t.brands,type:o,[d]:h}),n.videoDecoderConf={codec:e.codec,codedHeight:e.video.height,codedWidth:e.video.width,description:h}}const l=t.audioTracks[0];if(l!=null){const h=$y(s);n.audioTrackConf={timescale:l.timescale,samplerate:l.audio.sample_rate,channel_count:l.audio.channel_count,hdlr:"soun",type:l.codec.startsWith("mp4a")?"mp4a":l.codec,description:$y(s)},n.audioDecoderConf={codec:l.codec.startsWith("mp4a")?Ie.codec:l.codec,numberOfChannels:l.audio.channel_count,sampleRate:l.audio.sample_rate,...h==null?{}:ZI(h)}}return n}function KI(s){for(const t of s.mdia.minf.stbl.stsd.entries){const e=t.avcC??t.hvcC??t.av1C??t.vpcC;if(e!=null){const n=new mp.DataStream(void 0,0,mp.DataStream.BIG_ENDIAN);return e.write(n),new Uint8Array(n.buffer.slice(8))}}throw Error("avcC, hvcC, av1C or VPX not found")}function $y(s,t="mp4a"){var e;const n=(e=s.moov)==null?void 0:e.traks.map(l=>l.mdia.minf.stbl.stsd.entries).flat().find(({type:l})=>l===t);return n==null?void 0:n.esds}function ZI(s){var t;const e=(t=s.esd.descs[0])==null?void 0:t.descs[0];if(e==null)return{};const[n,l]=e.data,h=((n&7)<<1)+(l>>7),d=(l&127)>>3;return{sampleRate:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][h],numberOfChannels:d}}async function JI(s,t,e){const n=mp.createFile(!1);n.onReady=h=>{var d,o;t({mp4boxFile:n,info:h});const _=(d=h.videoTracks[0])==null?void 0:d.id;_!=null&&n.setExtractionOptions(_,"video",{nbSamples:100});const m=(o=h.audioTracks[0])==null?void 0:o.id;m!=null&&n.setExtractionOptions(m,"audio",{nbSamples:100}),n.start()},n.onSamples=e,await l();async function l(){let h=0;const d=30*1024*1024;for(;;){const o=await s.read(d,{at:h});if(o.byteLength===0)break;o.fileStart=h;const _=n.appendBuffer(o);if(_==null)break;h=_}n.stop()}}let O_=0;function ff(s){return s.kind==="file"&&s.createReader instanceof Function}var xp,uu,cu,Dr,Oi,du,kr,Cs,ll,Fa,_n,Ni,hl;const QI=class Ma{constructor(t,e={}){if(_t(this,xp,O_++),_t(this,uu,Zt.create(`MP4Clip id:${F(this,xp)},`)),Le(this,"ready"),_t(this,cu,!1),_t(this,Dr,{duration:0,width:0,height:0,audioSampleRate:0,audioChanCount:0}),_t(this,Oi),_t(this,du,1),_t(this,kr,[]),_t(this,Cs,[]),_t(this,ll,null),_t(this,Fa,null),_t(this,_n,{video:null,audio:null}),_t(this,Ni,{audio:!0}),Le(this,"tickInterceptor",async(l,h)=>h),_t(this,hl,new AbortController),!(t instanceof ReadableStream)&&!ff(t)&&!Array.isArray(t.videoSamples))throw Error("Illegal argument");ct(this,Ni,{audio:!0,...e}),ct(this,du,typeof e.audio=="object"&&"volume"in e.audio?e.audio.volume:1);const n=async l=>(await F_(F(this,Oi),l),F(this,Oi));ct(this,Oi,ff(t)?t:"localFile"in t?t.localFile:oI()),this.ready=(t instanceof ReadableStream?n(t).then(l=>Vy(l,F(this,Ni))):ff(t)?Vy(t,F(this,Ni)):Promise.resolve(t)).then(async({videoSamples:l,audioSamples:h,decoderConf:d})=>{ct(this,kr,l),ct(this,Cs,h),ct(this,_n,d);const{videoFrameFinder:o,audioFrameFinder:_}=e2({video:d.video==null?null:{...d.video,hardwareAcceleration:F(this,Ni).__unsafe_hardwareAcceleration__},audio:d.audio},await F(this,Oi).createReader(),l,h,F(this,Ni).audio!==!1?F(this,du):0);return ct(this,ll,o),ct(this,Fa,_),ct(this,Dr,t2(d,l,h)),F(this,uu).info("MP4Clip meta:",F(this,Dr)),{...F(this,Dr)}})}get meta(){return{...F(this,Dr)}}async tick(t){var e,n,l;if(t>=F(this,Dr).duration)return await this.tickInterceptor(t,{audio:await((e=F(this,Fa))==null?void 0:e.find(t))??[],state:"done"});const[h,d]=await Promise.all([((n=F(this,Fa))==null?void 0:n.find(t))??[],(l=F(this,ll))==null?void 0:l.find(t)]);return d==null?await this.tickInterceptor(t,{audio:h,state:"success"}):await this.tickInterceptor(t,{video:d,audio:h,state:"success"})}async thumbnails(t=100,e){F(this,hl).abort(),ct(this,hl,new AbortController);const n=F(this,hl).signal;await this.ready;const l="generate thumbnails aborted";if(n.aborted)throw Error(l);const{width:h,height:d}=F(this,Dr),o=a2(t,Math.round(d*(t/h)),{quality:.1,type:"image/png"});return new Promise(async(_,m)=>{let v=[];const w=F(this,_n).video;if(w==null||F(this,kr).length===0){x();return}n.addEventListener("abort",()=>{m(Error(l))});async function x(){n.aborted||_(await Promise.all(v.map(async f=>({ts:f.ts,img:await f.img}))))}function T(f){v.push({ts:f.timestamp,img:o(f)})}const{start:r=0,end:a=F(this,Dr).duration,step:u}=e??{};if(u){let f=r;const g=new lx(await F(this,Oi).createReader(),F(this,kr),{...w,hardwareAcceleration:F(this,Ni).__unsafe_hardwareAcceleration__});for(;f<=a&&!n.aborted;){const b=await g.find(f);b&&T(b),f+=u}g.destroy(),x()}else await c2(F(this,kr),F(this,Oi),w,n,{start:r,end:a},(f,g)=>{f!=null&&T(f),g&&x()})})}async split(t){if(await this.ready,t<=0||t>=F(this,Dr).duration)throw Error('"time" out of bounds');const[e,n]=o2(F(this,kr),t),[l,h]=l2(F(this,Cs),t),d=new Ma({localFile:F(this,Oi),videoSamples:e??[],audioSamples:l??[],decoderConf:F(this,_n)},F(this,Ni)),o=new Ma({localFile:F(this,Oi),videoSamples:n??[],audioSamples:h??[],decoderConf:F(this,_n)},F(this,Ni));return await Promise.all([d.ready,o.ready]),[d,o]}async clone(){await this.ready;const t=new Ma({localFile:F(this,Oi),videoSamples:[...F(this,kr)],audioSamples:[...F(this,Cs)],decoderConf:F(this,_n)},F(this,Ni));return await t.ready,t.tickInterceptor=this.tickInterceptor,t}async splitTrack(){await this.ready;const t=[];if(F(this,kr).length>0){const e=new Ma({localFile:F(this,Oi),videoSamples:[...F(this,kr)],audioSamples:[],decoderConf:{video:F(this,_n).video,audio:null}},F(this,Ni));await e.ready,e.tickInterceptor=this.tickInterceptor,t.push(e)}if(F(this,Cs).length>0){const e=new Ma({localFile:F(this,Oi),videoSamples:[],audioSamples:[...F(this,Cs)],decoderConf:{audio:F(this,_n).audio,video:null}},F(this,Ni));await e.ready,e.tickInterceptor=this.tickInterceptor,t.push(e)}return t}destroy(){var t,e;F(this,cu)||(F(this,uu).info("MP4Clip destroy"),ct(this,cu,!0),(t=F(this,ll))==null||t.destroy(),(e=F(this,Fa))==null||e.destroy())}};xp=new WeakMap,uu=new WeakMap,cu=new WeakMap,Dr=new WeakMap,Oi=new WeakMap,du=new WeakMap,kr=new WeakMap,Cs=new WeakMap,ll=new WeakMap,Fa=new WeakMap,_n=new WeakMap,Ni=new WeakMap,hl=new WeakMap;let N_=QI;function t2(s,t,e){const n={duration:0,width:0,height:0,audioSampleRate:0,audioChanCount:0};s.video!=null&&t.length>0&&(n.width=s.video.codedWidth??0,n.height=s.video.codedHeight??0),s.audio!=null&&e.length>0&&(n.audioSampleRate=Ie.sampleRate,n.audioChanCount=Ie.channelCount);let l=0,h=0;if(t.length>0)for(let d=t.length-1;d>=0;d--){const o=t[d];if(!o.deleted){l=o.cts+o.duration;break}}if(e.length>0){const d=e.at(-1);h=d.cts+d.duration}return n.duration=Math.max(l,h),n}function e2(s,t,e,n,l){return{audioFrameFinder:l===0||s.audio==null||n.length===0?null:new r2(t,n,s.audio,{volume:l,targetSampleRate:Ie.sampleRate}),videoFrameFinder:s.video==null||e.length===0?null:new lx(t,e,s.video)}}async function Vy(s,t={}){let e=null;const n={video:null,audio:null};let l=[],h=[],d=-1,o=-1;const _=await s.createReader();await JI(_,w=>{e=w.info;let{videoDecoderConf:x,audioDecoderConf:T}=qI(w.mp4boxFile,w.info);n.video=x??null,n.audio=T??null,x==null&&T==null&&Zt.error("MP4Clip no video and audio track"),Zt.info("mp4BoxFile moov ready",{...w.info,tracks:null,videoTracks:null,audioTracks:null},n)},(w,x,T)=>{if(x==="video"){d===-1&&(d=T[0].dts);for(const r of T)l.push(v(r,d,"video"))}else if(x==="audio"&&t.audio){o===-1&&(o=T[0].dts);for(const r of T)h.push(v(r,o,"audio"))}}),await _.close();const m=l.at(-1)??h.at(-1);if(e==null)throw Error("MP4Clip stream is done, but not emit ready");if(m==null)throw Error("MP4Clip stream not contain any sample");return Ep(l),Zt.info("mp4 stream parsed"),{videoSamples:l,audioSamples:h,decoderConf:n};function v(w,x=0,T){const r=T==="video"&&w.is_sync&&u2(w.data,w.description.type);let a=w.offset,u=w.size;if(r){const f=h2(w.data,w.description.type);a+=f,u-=f}return{...w,is_idr:r,offset:a,size:u,cts:(w.cts-x)/w.timescale*1e6,dts:(w.dts-x)/w.timescale*1e6,duration:w.duration/w.timescale*1e6,timescale:1e6,data:T==="video"?null:w.data}}}var bi,La,Da,fu,ka,gn,tr,Yn,Us,Oa,ul,Is,pu,Na,_u;class lx{constructor(t,e,n){_t(this,bi,null),_t(this,La,0),_t(this,Da,{abort:!1,st:performance.now()}),Le(this,"find",async l=>{(F(this,bi)==null||F(this,bi).state==="closed"||l<=F(this,La)||l-F(this,La)>3e6)&&F(this,Na).call(this,l),F(this,Da).abort=!0,ct(this,La,l),ct(this,Da,{abort:!1,st:performance.now()});const h=await F(this,ul).call(this,l,F(this,bi),F(this,Da));return ct(this,Oa,0),h}),_t(this,fu,0),_t(this,ka,!1),_t(this,gn,0),_t(this,tr,[]),_t(this,Yn,0),_t(this,Us,0),_t(this,Oa,0),_t(this,ul,async(l,h,d)=>{if(h==null||h.state==="closed"||d.abort)return null;if(F(this,tr).length>0){const o=F(this,tr)[0];return l<o.timestamp?null:(F(this,tr).shift(),l>o.timestamp+(o.duration??0)?(o.close(),await F(this,ul).call(this,l,h,d)):(F(this,tr).length<10&&F(this,pu).call(this,h).catch(_=>{throw F(this,Na).call(this,l),_}),o))}if(F(this,Is)||F(this,Yn)<F(this,Us)&&h.decodeQueueSize>0){if(performance.now()-d.st>6e3)throw Error(`MP4Clip.tick video timeout, ${JSON.stringify(F(this,_u).call(this))}`);ct(this,Oa,F(this,Oa)+1),await k_(15)}else{if(F(this,gn)>=this.samples.length)return null;try{await F(this,pu).call(this,h)}catch(o){throw F(this,Na).call(this,l),o}}return await F(this,ul).call(this,l,h,d)}),_t(this,Is,!1),_t(this,pu,async l=>{var h,d;if(F(this,Is)||l.decodeQueueSize>600)return;let o=F(this,gn)+1;if(o>this.samples.length)return;ct(this,Is,!0);let _=!1;for(;o<this.samples.length;o++){const m=this.samples[o];if(!_&&!m.deleted&&(_=!0),m.is_idr)break}if(_){const m=this.samples.slice(F(this,gn),o);if(((h=m[0])==null?void 0:h.is_idr)!==!0)Zt.warn("First sample not idr frame");else{const v=performance.now(),w=await hx(m,this.localFileReader),x=performance.now()-v;if(x>1e3){const T=m[0],r=m.at(-1),a=r.offset+r.size-T.offset;Zt.warn(`Read video samples time cost: ${Math.round(x)}ms, file chunk size: ${a}`)}if(l.state==="closed")return;ct(this,fu,((d=w[0])==null?void 0:d.duration)??0),Sp(l,w,{onDecodingError:T=>{if(F(this,ka))throw T;F(this,Yn)===0&&(ct(this,ka,!0),Zt.warn("Downgrade to software decode"),F(this,Na).call(this))}}),ct(this,Us,F(this,Us)+w.length)}}ct(this,gn,o),ct(this,Is,!1)}),_t(this,Na,l=>{var h,d;if(ct(this,Is,!1),F(this,tr).forEach(_=>_.close()),ct(this,tr,[]),l==null||l===0)ct(this,gn,0);else{let _=0;for(let m=0;m<this.samples.length;m++){const v=this.samples[m];if(v.is_idr&&(_=m),!(v.cts<l)){ct(this,gn,_);break}}}ct(this,Us,0),ct(this,Yn,0),((h=F(this,bi))==null?void 0:h.state)!=="closed"&&((d=F(this,bi))==null||d.close());const o={...this.conf,...F(this,ka)?{hardwareAcceleration:"prefer-software"}:{}};ct(this,bi,new VideoDecoder({output:_=>{if(ct(this,Yn,F(this,Yn)+1),_.timestamp===-1){_.close();return}let m=_;_.duration==null&&(m=new VideoFrame(_,{duration:F(this,fu)}),_.close()),F(this,tr).push(m)},error:_=>{if(_.message.includes("Codec reclaimed due to inactivity")){ct(this,bi,null);return}const m=`VideoFinder VideoDecoder err: ${_.message}, config: ${JSON.stringify(o)}, state: ${JSON.stringify(F(this,_u).call(this))}`;throw Zt.error(m),Error(m)}})),F(this,bi).configure(o)}),_t(this,_u,()=>{var l,h;return{time:F(this,La),decState:(l=F(this,bi))==null?void 0:l.state,decQSize:(h=F(this,bi))==null?void 0:h.decodeQueueSize,decCusorIdx:F(this,gn),sampleLen:this.samples.length,inputCnt:F(this,Us),outputCnt:F(this,Yn),cacheFrameLen:F(this,tr).length,softDeocde:F(this,ka),clipIdCnt:O_,sleepCnt:F(this,Oa),memInfo:ux()}}),Le(this,"destroy",()=>{var l,h;((l=F(this,bi))==null?void 0:l.state)!=="closed"&&((h=F(this,bi))==null||h.close()),ct(this,bi,null),F(this,Da).abort=!0,F(this,tr).forEach(d=>d.close()),ct(this,tr,[]),this.localFileReader.close()}),this.localFileReader=t,this.samples=e,this.conf=n}}bi=new WeakMap,La=new WeakMap,Da=new WeakMap,fu=new WeakMap,ka=new WeakMap,gn=new WeakMap,tr=new WeakMap,Yn=new WeakMap,Us=new WeakMap,Oa=new WeakMap,ul=new WeakMap,Is=new WeakMap,pu=new WeakMap,Na=new WeakMap,_u=new WeakMap;function i2(s,t){for(let e=0;e<t.length;e++){const n=t[e];if(s>=n.cts&&s<n.cts+n.duration)return e;if(n.cts>s)break}return 0}var gu,mu,Or,za,mn,jn,mr,Ga,yu,vu,bp,wp;class r2{constructor(t,e,n,l){_t(this,gu,1),_t(this,mu),_t(this,Or,null),_t(this,za,{abort:!1,st:performance.now()}),Le(this,"find",async h=>{const d=h<=F(this,mn)||h-F(this,mn)>1e5;(F(this,Or)==null||F(this,Or).state==="closed"||d)&&F(this,bp).call(this),d&&(ct(this,mn,h),ct(this,jn,i2(h,this.samples))),F(this,za).abort=!0;const o=h-F(this,mn);ct(this,mn,h),ct(this,za,{abort:!1,st:performance.now()});const _=await F(this,yu).call(this,Math.ceil(o*(F(this,mu)/1e6)),F(this,Or),F(this,za));return ct(this,Ga,0),_}),_t(this,mn,0),_t(this,jn,0),_t(this,mr,{frameCnt:0,data:[]}),_t(this,Ga,0),_t(this,yu,async(h,d=null,o)=>{if(d==null||o.abort||d.state==="closed"||h===0)return[];const _=F(this,mr).frameCnt-h;if(_>0)return _<Ie.sampleRate/10&&F(this,vu).call(this,d),Wy(F(this,mr),h);if(d.decoding){if(performance.now()-o.st>3e3)throw o.abort=!0,Error(`MP4Clip.tick audio timeout, ${JSON.stringify(F(this,wp).call(this))}`);ct(this,Ga,F(this,Ga)+1),await k_(15)}else{if(F(this,jn)>=this.samples.length-1)return Wy(F(this,mr),F(this,mr).frameCnt);F(this,vu).call(this,d)}return F(this,yu).call(this,h,d,o)}),_t(this,vu,h=>{if(h.decodeQueueSize>10)return;const d=[];let o=F(this,jn);for(;o<this.samples.length;){const _=this.samples[o];if(o+=1,!_.deleted&&(d.push(_),d.length>=10))break}ct(this,jn,o),h.decode(d.map(_=>new EncodedAudioChunk({type:"key",timestamp:_.cts,duration:_.duration,data:_.data})))}),_t(this,bp,()=>{var h;ct(this,mn,0),ct(this,jn,0),ct(this,mr,{frameCnt:0,data:[]}),(h=F(this,Or))==null||h.close(),ct(this,Or,n2(this.conf,{resampleRate:Ie.sampleRate,volume:F(this,gu)},d=>{F(this,mr).data.push(d),F(this,mr).frameCnt+=d[0].length}))}),_t(this,wp,()=>{var h,d;return{time:F(this,mn),decState:(h=F(this,Or))==null?void 0:h.state,decQSize:(d=F(this,Or))==null?void 0:d.decodeQueueSize,decCusorIdx:F(this,jn),sampleLen:this.samples.length,pcmLen:F(this,mr).frameCnt,clipIdCnt:O_,sleepCnt:F(this,Ga),memInfo:ux()}}),Le(this,"destroy",()=>{ct(this,Or,null),F(this,za).abort=!0,ct(this,mr,{frameCnt:0,data:[]}),this.localFileReader.close()}),this.localFileReader=t,this.samples=e,this.conf=n,ct(this,gu,l.volume),ct(this,mu,l.targetSampleRate)}}gu=new WeakMap,mu=new WeakMap,Or=new WeakMap,za=new WeakMap,mn=new WeakMap,jn=new WeakMap,mr=new WeakMap,Ga=new WeakMap,yu=new WeakMap,vu=new WeakMap,bp=new WeakMap,wp=new WeakMap;function n2(s,t,e){let n=0,l=0;const h=v=>{if(l+=1,v.length!==0){if(t.volume!==1)for(const w of v)for(let x=0;x<w.length;x++)w[x]*=t.volume;v.length===1&&(v=[v[0],v[0]]),e(v)}},d=s2(h),o=t.resampleRate!==s.sampleRate;let _=new AudioDecoder({output:v=>{const w=VI(v);o?d(()=>jI(w,v.sampleRate,{rate:t.resampleRate,chanCount:v.numberOfChannels})):h(w),v.close()},error:v=>{v.message.includes("Codec reclaimed due to inactivity")||m("MP4Clip AudioDecoder err",v)}});_.configure(s);function m(v,w){const x=`${v}: ${w.message}, state: ${JSON.stringify({qSize:_.decodeQueueSize,state:_.state,inputCnt:n,outputCnt:l})}`;throw Zt.error(x),Error(x)}return{decode(v){n+=v.length;try{for(const w of v)_.decode(w)}catch(w){m("decode audio chunk error",w)}},close(){_.state!=="closed"&&_.close()},get decoding(){return n>l&&_.decodeQueueSize>0},get state(){return _.state},get decodeQueueSize(){return _.decodeQueueSize}}}function s2(s){const t=[];let e=0;function n(d,o){t[o]=d,l()}function l(){const d=t[e];d!=null&&(s(d),e+=1,l())}let h=0;return d=>{const o=h;h+=1,d().then(_=>n(_,o)).catch(_=>n(_,o))}}function Wy(s,t){const e=[new Float32Array(t),new Float32Array(t)];let n=0,l=0;for(;l<s.data.length;){const[h,d]=s.data[l];if(n+h.length>t){const o=t-n;e[0].set(h.subarray(0,o),n),e[1].set(d.subarray(0,o),n),s.data[l][0]=h.subarray(o,h.length),s.data[l][1]=d.subarray(o,d.length);break}else e[0].set(h,n),e[1].set(d,n),n+=h.length,l++}return s.data=s.data.slice(l),s.frameCnt-=t,e}async function hx(s,t){const e=s[0],n=s.at(-1);if(n==null)return[];const l=n.offset+n.size-e.offset;if(l<3e7){const h=new Uint8Array(await t.read(l,{at:e.offset}));return s.map(d=>{const o=d.offset-e.offset;return new EncodedVideoChunk({type:d.is_sync?"key":"delta",timestamp:d.cts,duration:d.duration,data:h.subarray(o,o+d.size)})})}return await Promise.all(s.map(async h=>new EncodedVideoChunk({type:h.is_sync?"key":"delta",timestamp:h.cts,duration:h.duration,data:await t.read(h.size,{at:h.offset})})))}function a2(s,t,e){const n=new OffscreenCanvas(s,t),l=n.getContext("2d");return async h=>(l.drawImage(h,0,0,s,t),h.close(),await n.convertToBlob(e))}function o2(s,t){if(s.length===0)return[];let e=0,n=0,l=-1;for(let _=0;_<s.length;_++){const m=s[_];if(l===-1&&t<m.cts&&(l=_-1),m.is_idr)if(l===-1)e=_;else{n=_;break}}const h=s[l];if(h==null)throw Error("Not found video sample by time");const d=s.slice(0,n===0?s.length:n).map(_=>({..._}));for(let _=e;_<d.length;_++){const m=d[_];t<m.cts&&(m.deleted=!0,m.cts=-1)}Ep(d);const o=s.slice(h.is_idr?l:e).map(_=>({..._,cts:_.cts-t}));for(const _ of o)_.cts<0&&(_.deleted=!0,_.cts=-1);return Ep(o),[d,o]}function l2(s,t){if(s.length===0)return[];let e=-1;for(let h=0;h<s.length;h++){const d=s[h];if(!(t>d.cts)){e=h;break}}if(e===-1)throw Error("Not found audio sample by time");const n=s.slice(0,e).map(h=>({...h})),l=s.slice(e).map(h=>({...h,cts:h.cts-t}));return[n,l]}function Sp(s,t,e){let n=0;if(s.state==="configured"){for(;n<t.length;n++)s.decode(t[n]);s.flush().catch(l=>{if(!(l instanceof Error))throw l;if(l.message.includes("Decoding error")&&e.onDecodingError!=null){e.onDecodingError(l);return}if(!l.message.includes("Aborted due to close"))throw l})}}function h2(s,t){if(t!=="avc1"&&t!=="hvc1")return 0;const e=new DataView(s.buffer);if(t==="avc1"&&(e.getUint8(4)&31)===6)return e.getUint32(0)+4;if(t==="hvc1"){const n=e.getUint8(4)>>1&63;if(n===39||n===40)return e.getUint32(0)+4}return 0}function u2(s,t){if(t!=="avc1"&&t!=="hvc1")return!0;const e=new DataView(s.buffer);let n=0;for(;n<s.byteLength-4;){if(t==="avc1"&&(e.getUint8(n+4)&31)===5)return!0;if(t==="hvc1"){const l=e.getUint8(n+4)>>1&63;if(l===19||l===20)return!0}n+=e.getUint32(n)+4}return!1}async function c2(s,t,e,n,l,h){const d=await t.createReader(),o=await hx(s.filter(v=>!v.deleted&&v.is_sync&&v.cts>=l.start&&v.cts<=l.end),d);if(o.length===0||n.aborted)return;let _=0;Sp(m(),o,{onDecodingError:v=>{Zt.warn("thumbnailsByKeyFrame",v),_===0?Sp(m(!0),o,{onDecodingError:w=>{d.close(),Zt.error("thumbnailsByKeyFrame retry soft deocde",w)}}):(h(null,!0),d.close())}});function m(v=!1){const w={...e,...v?{hardwareAcceleration:"prefer-software"}:{}},x=new VideoDecoder({output:T=>{_+=1;const r=_===o.length;h(T,r),r&&(d.close(),x.state!=="closed"&&x.close())},error:T=>{const r=`thumbnails decoder error: ${T.message}, config: ${JSON.stringify(w)}, state: ${JSON.stringify({qSize:x.decodeQueueSize,state:x.state,outputCnt:_,inputCnt:o.length})}`;throw Zt.error(r),Error(r)}});return n.addEventListener("abort",()=>{d.close(),x.state!=="closed"&&x.close()}),x.configure(w),x}}function Ep(s){let t=0,e=null;for(const n of s)if(!n.deleted){if(n.is_sync&&(t+=1),t>=2)break;(e==null||n.cts<e.cts)&&(e=n)}e!=null&&e.cts<2e5&&(e.duration+=e.cts,e.cts=0)}function ux(){try{const s=performance.memory;return{jsHeapSizeLimit:s.jsHeapSizeLimit,totalJSHeapSize:s.totalJSHeapSize,usedJSHeapSize:s.usedJSHeapSize,percentUsed:(s.usedJSHeapSize/s.jsHeapSizeLimit).toFixed(3),percentTotal:(s.totalJSHeapSize/s.jsHeapSizeLimit).toFixed(3)}}catch{return{}}}var Ui,yr,pi,Tp,cx;const d2=class Ha{constructor(t){_t(this,Tp),Le(this,"ready"),_t(this,Ui,{duration:0,width:0,height:0}),_t(this,yr,null),_t(this,pi,[]);const e=n=>(ct(this,yr,n),F(this,Ui).width=n.width,F(this,Ui).height=n.height,F(this,Ui).duration=1/0,{...F(this,Ui)});if(t instanceof ReadableStream)this.ready=new Response(t).blob().then(n=>createImageBitmap(n)).then(e);else if(t instanceof ImageBitmap)this.ready=Promise.resolve(e(t));else if(Array.isArray(t)&&t.every(n=>n instanceof VideoFrame)){ct(this,pi,t);const n=F(this,pi)[0];if(n==null)throw Error("The frame count must be greater than 0");ct(this,Ui,{width:n.displayWidth,height:n.displayHeight,duration:F(this,pi).reduce((l,h)=>l+(h.duration??0),0)}),this.ready=Promise.resolve({...F(this,Ui),duration:1/0})}else if("type"in t)this.ready=wr(this,Tp,cx).call(this,t.stream,t.type).then(()=>({width:F(this,Ui).width,height:F(this,Ui).height,duration:1/0}));else throw Error("Illegal arguments")}get meta(){return{...F(this,Ui)}}async tick(t){if(F(this,yr)!=null)return{video:await createImageBitmap(F(this,yr)),state:"success"};const e=t%F(this,Ui).duration;return{video:(F(this,pi).find(n=>e>=n.timestamp&&e<=n.timestamp+(n.duration??0))??F(this,pi)[0]).clone(),state:"success"}}async split(t){if(await this.ready,F(this,yr)!=null)return[new Ha(await createImageBitmap(F(this,yr))),new Ha(await createImageBitmap(F(this,yr)))];let e=-1;for(let h=0;h<F(this,pi).length;h++){const d=F(this,pi)[h];if(!(t>d.timestamp)){e=h;break}}if(e===-1)throw Error("Not found frame by time");const n=F(this,pi).slice(0,e).map(h=>new VideoFrame(h)),l=F(this,pi).slice(e).map(h=>new VideoFrame(h,{timestamp:h.timestamp-t}));return[new Ha(n),new Ha(l)]}async clone(){await this.ready;const t=F(this,yr)==null?F(this,pi).map(e=>e.clone()):await createImageBitmap(F(this,yr));return new Ha(t)}destroy(){var t;Zt.info("ImgClip destroy"),(t=F(this,yr))==null||t.close(),F(this,pi).forEach(e=>e.close())}};Ui=new WeakMap,yr=new WeakMap,pi=new WeakMap,Tp=new WeakSet,cx=async function(s,t){ct(this,pi,await YI(s,t));const e=F(this,pi)[0];if(e==null)throw Error("No frame available in gif");ct(this,Ui,{duration:F(this,pi).reduce((n,l)=>n+(l.duration??0),0),width:e.codedWidth,height:e.codedHeight}),Zt.info("ImgClip ready:",F(this,Ui))};let Ku=d2;var no,ts,Hs,xn,Ap,dx,Ps,yn;const cl=class xu{constructor(t,e={}){_t(this,Ap),Le(this,"ready"),_t(this,no,{duration:0,width:0,height:0}),_t(this,ts,new Float32Array),_t(this,Hs,new Float32Array),_t(this,xn),_t(this,Ps,0),_t(this,yn,0),ct(this,xn,{loop:!1,volume:1,...e}),this.ready=wr(this,Ap,dx).call(this,t).then(()=>({width:0,height:0,duration:e.loop?1/0:F(this,no).duration}))}get meta(){return{...F(this,no),sampleRate:Ie.sampleRate,chanCount:2}}getPCMData(){return[F(this,ts),F(this,Hs)]}async tick(t){if(!F(this,xn).loop&&t>=F(this,no).duration)return{audio:[],state:"done"};const e=t-F(this,Ps);if(t<F(this,Ps)||e>3e6)return ct(this,Ps,t),ct(this,yn,Math.ceil(F(this,Ps)/1e6*Ie.sampleRate)),{audio:[new Float32Array(0),new Float32Array(0)],state:"success"};ct(this,Ps,t);const n=Math.ceil(e/1e6*Ie.sampleRate),l=F(this,yn)+n,h=F(this,xn).loop?[Hy(F(this,ts),F(this,yn),l),Hy(F(this,Hs),F(this,yn),l)]:[F(this,ts).slice(F(this,yn),l),F(this,Hs).slice(F(this,yn),l)];return ct(this,yn,l),{audio:h,state:"success"}}async split(t){await this.ready;const e=Math.ceil(t/1e6*Ie.sampleRate),n=new xu(this.getPCMData().map(h=>h.slice(0,e)),F(this,xn)),l=new xu(this.getPCMData().map(h=>h.slice(e)),F(this,xn));return[n,l]}async clone(){await this.ready;const t=new xu(this.getPCMData(),F(this,xn));return await t.ready,t}destroy(){ct(this,ts,new Float32Array(0)),ct(this,Hs,new Float32Array(0)),Zt.info("---- audioclip destroy ----")}};no=new WeakMap,ts=new WeakMap,Hs=new WeakMap,xn=new WeakMap,Ap=new WeakSet,dx=async function(s){cl.ctx==null&&(cl.ctx=new AudioContext({sampleRate:Ie.sampleRate}));const t=performance.now(),e=s instanceof ReadableStream?await f2(s,cl.ctx):s;Zt.info("Audio clip decoded complete:",performance.now()-t);const n=F(this,xn).volume;if(n!==1)for(const l of e)for(let h=0;h<l.length;h+=1)l[h]*=n;F(this,no).duration=e[0].length/Ie.sampleRate*1e6,ct(this,ts,e[0]),ct(this,Hs,e[1]??F(this,ts)),Zt.info("Audio clip convert to AudioData, time:",performance.now()-t)},Ps=new WeakMap,yn=new WeakMap,Le(cl,"ctx",null);let z_=cl;async function f2(s,t){const e=await new Response(s).arrayBuffer();return ax(await t.decodeAudioData(e))}var $a,bu,Va,dl;const fx=class px{constructor(t){Le(this,"ready"),_t(this,$a,{duration:0,width:0,height:0}),_t(this,bu,()=>{}),Le(this,"audioTrack"),_t(this,Va,null),_t(this,dl),ct(this,dl,t);const e=t.getVideoTracks()[0];if(e!=null){const{width:n,height:l}=e.getSettings();e.contentHint="motion",F(this,$a).width=n??0,F(this,$a).height=l??0,ct(this,Va,new OffscreenCanvas(n??0,l??0)),ct(this,bu,_2(F(this,Va).getContext("2d"),e))}this.audioTrack=t.getAudioTracks()[0]??null,F(this,$a).duration=1/0,this.ready=Promise.resolve(this.meta)}get meta(){return{...F(this,$a)}}async tick(){return{video:F(this,Va)==null?null:await createImageBitmap(F(this,Va)),audio:[],state:"success"}}async split(){return[await this.clone(),await this.clone()]}async clone(){return new px(F(this,dl).clone())}destroy(){F(this,dl).getTracks().forEach(t=>t.stop()),F(this,bu).call(this)}};$a=new WeakMap,bu=new WeakMap,Va=new WeakMap,dl=new WeakMap,Le(fx,"ctx",null);let p2=fx;function _2(s,t){return mI(new MediaStreamTrackProcessor({track:t}).readable,{onChunk:async e=>{s.drawImage(e,0,0),e.close()},onDone:async()=>{}})}var Zu,Ju,Qu,tc,ec,ic,Rs,Wa,Bs;const g2=class _x{constructor(t,e,n,l,h){_t(this,Rs),_t(this,Zu,new ea),Le(this,"on",F(this,Zu).on),_t(this,Ju,0),_t(this,Qu,0),_t(this,tc,0),_t(this,ec,0),_t(this,ic,0),_t(this,Bs,null),Le(this,"fixedAspectRatio",!1),Le(this,"fixedScaleCenter",!1),this.x=t??0,this.y=e??0,this.w=n??0,this.h=l??0,ct(this,Bs,h??null)}get x(){return F(this,Ju)}set x(t){wr(this,Rs,Wa).call(this,"x",t)}get y(){return F(this,Qu)}set y(t){wr(this,Rs,Wa).call(this,"y",t)}get w(){return F(this,tc)}set w(t){wr(this,Rs,Wa).call(this,"w",t)}get h(){return F(this,ec)}set h(t){wr(this,Rs,Wa).call(this,"h",t)}get angle(){return F(this,ic)}set angle(t){wr(this,Rs,Wa).call(this,"angle",t)}get center(){const{x:t,y:e,w:n,h:l}=this;return{x:t+n/2,y:e+l/2}}clone(){const{x:t,y:e,w:n,h:l}=this,h=new _x(t,e,n,l,F(this,Bs));return h.angle=this.angle,h.fixedAspectRatio=this.fixedAspectRatio,h.fixedScaleCenter=this.fixedScaleCenter,h}checkHit(t,e){var n,l;let{angle:h,center:d,x:o,y:_,w:m,h:v}=this;const w=((n=F(this,Bs))==null?void 0:n.center)??d,x=((l=F(this,Bs))==null?void 0:l.angle)??h;F(this,Bs)==null&&(o=o-w.x,_=_-w.y);const T=t-w.x,r=e-w.y;let a=T,u=r;return x!==0&&(a=T*Math.cos(x)+r*Math.sin(x),u=r*Math.cos(x)-T*Math.sin(x)),!(a<o||a>o+m||u<_||u>_+v)}};Zu=new WeakMap,Ju=new WeakMap,Qu=new WeakMap,tc=new WeakMap,ec=new WeakMap,ic=new WeakMap,Rs=new WeakSet,Wa=function(s,t){const e=this[s]!==t;switch(s){case"x":ct(this,Ju,t);break;case"y":ct(this,Qu,t);break;case"w":ct(this,tc,t);break;case"h":ct(this,ec,t);break;case"angle":ct(this,ic,t);break}e&&F(this,Zu).emit("propsChange",{[s]:t})},Bs=new WeakMap;let Nr=g2;var wu,Xa,fl,Fs,vn;class gx{constructor(){Le(this,"rect",new Nr),_t(this,wu,{offset:0,duration:0,playbackRate:1}),_t(this,Xa,new ea),Le(this,"on",F(this,Xa).on),_t(this,fl,0),Le(this,"opacity",1),Le(this,"flip",null),_t(this,Fs,null),_t(this,vn,null),Le(this,"ready",Promise.resolve()),this.rect.on("propsChange",t=>{F(this,Xa).emit("propsChange",{rect:t})})}get time(){return F(this,wu)}set time(t){Object.assign(F(this,wu),t)}get zIndex(){return F(this,fl)}set zIndex(t){const e=F(this,fl)!==t;ct(this,fl,t),e&&F(this,Xa).emit("propsChange",{zIndex:t})}_render(t){const{rect:{center:e,angle:n}}=this;t.setTransform(this.flip==="horizontal"?-1:1,0,0,this.flip==="vertical"?-1:1,e.x,e.y),t.rotate((this.flip==null?1:-1)*n),t.globalAlpha=this.opacity}setAnimation(t,e){ct(this,Fs,Object.entries(t).map(([n,l])=>{const h={from:0,to:100}[n]??Number(n.slice(0,-1));if(isNaN(h)||h>100||h<0)throw Error("keyFrame must between 0~100");return[h/100,l]})),ct(this,vn,Object.assign({},F(this,vn),{duration:e.duration,delay:e.delay??0,iterCount:e.iterCount??1/0}))}animate(t){if(F(this,Fs)==null||F(this,vn)==null||t<F(this,vn).delay)return;const e=m2(t,F(this,Fs),F(this,vn));for(const n in e)switch(n){case"opacity":this.opacity=e[n];break;case"x":case"y":case"w":case"h":case"angle":this.rect[n]=e[n];break}}copyStateTo(t){ct(t,Fs,F(this,Fs)),ct(t,vn,F(this,vn)),t.zIndex=this.zIndex,t.opacity=this.opacity,t.flip=this.flip,t.rect=this.rect.clone(),t.time={...this.time}}destroy(){F(this,Xa).destroy()}}wu=new WeakMap,Xa=new WeakMap,fl=new WeakMap,Fs=new WeakMap,vn=new WeakMap;function m2(s,t,e){const n=s-e.delay;if(n/e.duration>=e.iterCount)return{};const l=n%e.duration,h=n===e.duration?1:l/e.duration,d=t.findIndex(T=>T[0]>=h);if(d===-1)return{};const o=t[d-1],_=t[d],m=_[1];if(o==null)return m;const v=o[1],w={},x=(h-o[0])/(_[0]-o[0]);for(const T in m){const r=T;v[r]!=null&&(w[r]=(m[r]-v[r])*x+v[r])}return w}var Ya,Ms,Su;const y2=class mx extends gx{constructor(t){super(),_t(this,Ya),_t(this,Ms,null),_t(this,Su,!1),ct(this,Ya,t),this.ready=t.ready.then(({width:e,height:n,duration:l})=>{this.rect.w=this.rect.w===0?e:this.rect.w,this.rect.h=this.rect.h===0?n:this.rect.h,this.time.duration=this.time.duration===0?l:this.time.duration})}async offscreenRender(t,e){var n;const l=e*this.time.playbackRate;this.animate(l),super._render(t);const{w:h,h:d}=this.rect,{video:o,audio:_,state:m}=await F(this,Ya).tick(l);let v=_??[];if(_!=null&&this.time.playbackRate!==1&&(v=_.map(x=>ox(x,this.time.playbackRate))),m==="done")return{audio:v,done:!0};const w=o??F(this,Ms);return w!=null&&t.drawImage(w,-h/2,-d/2,h,d),o!=null&&((n=F(this,Ms))==null||n.close(),ct(this,Ms,o)),{audio:v,done:!1}}async clone(){const t=new mx(await F(this,Ya).clone());return await t.ready,this.copyStateTo(t),t}destroy(){var t;F(this,Su)||(ct(this,Su,!0),Zt.info("OffscreenSprite destroy"),super.destroy(),(t=F(this,Ms))==null||t.close(),ct(this,Ms,null),F(this,Ya).destroy())}};Ya=new WeakMap,Ms=new WeakMap,Su=new WeakMap;let v2=y2;var so,js,co,pl,Eu,Cp,Tu,Au;const x2=class yx extends gx{constructor(t){super(),_t(this,Eu),_t(this,so),Le(this,"visible",!0),_t(this,js,null),_t(this,co,[]),_t(this,pl,!1),_t(this,Tu,-1),_t(this,Au,!1),ct(this,so,t),this.ready=t.ready.then(({width:e,height:n,duration:l})=>{this.rect.w=this.rect.w===0?e:this.rect.w,this.rect.h=this.rect.h===0?n:this.rect.h,this.time.duration=this.time.duration===0?l:this.time.duration})}getClip(){return F(this,so)}preFrame(t){wr(this,Eu,Cp).call(this,t)}render(t,e){this.animate(e),super._render(t);const{w:n,h:l}=this.rect;F(this,Tu)!==e&&wr(this,Eu,Cp).call(this,e),ct(this,Tu,e);const h=F(this,co);ct(this,co,[]);const d=F(this,js);return d!=null&&t.drawImage(d,-n/2,-l/2,n,l),{audio:h}}copyStateTo(t){super.copyStateTo(t),t instanceof yx&&(t.visible=this.visible)}destroy(){var t;F(this,Au)||(ct(this,Au,!0),Zt.info("VisibleSprite destroy"),super.destroy(),(t=F(this,js))==null||t.close(),ct(this,js,null),F(this,so).destroy())}};so=new WeakMap,js=new WeakMap,co=new WeakMap,pl=new WeakMap,Eu=new WeakSet,Cp=function(s){F(this,pl)||(ct(this,pl,!0),F(this,so).tick(s*this.time.playbackRate).then(({video:t,audio:e})=>{var n;t!=null&&((n=F(this,js))==null||n.close(),ct(this,js,t??null)),ct(this,co,e??[]),e!=null&&this.time.playbackRate!==1&&ct(this,co,e.map(l=>ox(l,this.time.playbackRate)))}).finally(()=>{ct(this,pl,!1)}))},Tu=new WeakMap,Au=new WeakMap;let Jo=x2,b2=0;async function vx(s){s()>50&&(await k_(15),await vx(s))}var bn,Cu,Xr,Sl,rc,Uu,ao,El,Ls,Iu,xx,bx;class w2{constructor(t={}){_t(this,Iu),_t(this,bn,Zt.create(`id:${b2++},`)),_t(this,Cu,!1),_t(this,Xr,[]),_t(this,Sl),_t(this,rc),_t(this,Uu,null),_t(this,ao),_t(this,El),_t(this,Ls,new ea),Le(this,"on",F(this,Ls).on);const{width:e=0,height:n=0}=t;ct(this,Sl,new OffscreenCanvas(e,n));const l=F(this,Sl).getContext("2d",{alpha:!1});if(l==null)throw Error("Can not create 2d offscreen context");ct(this,rc,l),ct(this,ao,Object.assign({bgColor:"#000",width:0,height:0,videoCodec:"avc1.42E032",audio:!0,bitrate:5e6,fps:30,metaDataTags:null},t)),ct(this,El,e*n>0)}static async isSupported(t={}){return(self.OffscreenCanvas!=null&&self.VideoEncoder!=null&&self.VideoDecoder!=null&&self.VideoFrame!=null&&self.AudioEncoder!=null&&self.AudioDecoder!=null&&self.AudioData!=null&&((await self.VideoEncoder.isConfigSupported({codec:t.videoCodec??"avc1.42E032",width:t.width??1920,height:t.height??1080,bitrate:t.bitrate??7e6})).supported??!1)&&(await self.AudioEncoder.isConfigSupported({codec:Ie.codec,sampleRate:Ie.sampleRate,numberOfChannels:Ie.channelCount})).supported)??!1}async addSprite(t,e={}){const n={rect:A2(["x","y","w","h"],t.rect),time:{...t.time},zIndex:t.zIndex};F(this,bn).info("Combinator add sprite",n);const l=await t.clone();F(this,bn).info("Combinator add sprite ready"),F(this,Xr).push(Object.assign(l,{main:e.main??!1,expired:!1})),F(this,Xr).sort((h,d)=>h.zIndex-d.zIndex)}output(){if(F(this,Xr).length===0)throw Error("No sprite added");const t=F(this,Xr).find(_=>_.main),e=t!=null?t.time.offset+t.time.duration:Math.max(...F(this,Xr).map(_=>_.time.offset+_.time.duration));if(e===1/0)throw Error("Unable to determine the end time, please specify a main sprite, or limit the duration of ImgClip, AudioCli");e===-1&&F(this,bn).warn("Unable to determine the end time, process value don't update"),F(this,bn).info(`start combinate video, maxTime:${e}`);const n=wr(this,Iu,xx).call(this,e);let l=performance.now();const h=wr(this,Iu,bx).call(this,n,e,{onProgress:_=>{F(this,bn).debug("OutputProgress:",_),F(this,Ls).emit("OutputProgress",_)},onEnded:async()=>{await n.flush(),F(this,bn).info("===== output ended =====, cost:",performance.now()-l),F(this,Ls).emit("OutputProgress",1),this.destroy()},onError:_=>{F(this,Ls).emit("error",_),o(_),this.destroy()}});ct(this,Uu,()=>{h(),n.close(),o()});const{stream:d,stop:o}=yI(n.mp4file,500,this.destroy);return d}destroy(){var t;F(this,Cu)||(ct(this,Cu,!0),(t=F(this,Uu))==null||t.call(this),F(this,Ls).destroy())}}bn=new WeakMap,Cu=new WeakMap,Xr=new WeakMap,Sl=new WeakMap,rc=new WeakMap,Uu=new WeakMap,ao=new WeakMap,El=new WeakMap,Ls=new WeakMap,Iu=new WeakSet,xx=function(s){const{fps:t,width:e,height:n,videoCodec:l,bitrate:h,audio:d,metaDataTags:o}=F(this,ao);return AI({video:F(this,El)?{width:e,height:n,expectFPS:t,codec:l,bitrate:h,__unsafe_hardwareAcceleration__:F(this,ao).__unsafe_hardwareAcceleration__}:null,audio:d===!1?null:{codec:"aac",sampleRate:Ie.sampleRate,channelCount:Ie.channelCount},duration:s,metaDataTags:o})},bx=function(s,t,{onProgress:e,onEnded:n,onError:l}){let h=0;const d={aborted:!1};let o=null;(async()=>{const{fps:v,bgColor:w,audio:x}=F(this,ao),T=Math.round(1e6/v),r=F(this,rc),a=S2({ctx:r,bgColor:w,sprites:F(this,Xr),aborter:d}),u=E2({remux:s,ctx:r,cvs:F(this,Sl),outputAudio:x,hasVideoTrack:F(this,El),timeSlice:T});let f=0;for(;;){if(o!=null)return;if(d.aborted||t!==-1&&f>t||F(this,Xr).length===0){m(),await n();return}h=f/t;const{audios:g,mainSprDone:b}=await a(f);if(b){m(),await n();return}if(d.aborted)return;u(f,g),f+=T,await vx(s.getEncodeQueueSize)}})().catch(v=>{o=v,F(this,bn).error(v),m(),l(v)});const _=setInterval(()=>{e(h)},500),m=()=>{d.aborted||(d.aborted=!0,clearInterval(_),F(this,Xr).forEach(v=>v.destroy()))};return m};function S2(s){const{ctx:t,bgColor:e,sprites:n,aborter:l}=s,{width:h,height:d}=t.canvas;return async o=>{t.fillStyle=e,t.fillRect(0,0,h,d);const _=[];let m=!1;for(const v of n){if(l.aborted)break;if(o<v.time.offset||v.expired)continue;t.save();const{audio:w,done:x}=await v.offscreenRender(t,o-v.time.offset);_.push(w),t.restore(),(v.time.duration>0&&o>v.time.offset+v.time.duration||x)&&(v.main&&(m=!0),v.destroy(),v.expired=!0)}return{audios:_,mainSprDone:m}}}function E2(s){const{ctx:t,cvs:e,outputAudio:n,remux:l,hasVideoTrack:h,timeSlice:d}=s,{width:o,height:_}=e;let m=0;const v=T2(1024);return(w,x)=>{if(n!==!1)for(const T of v(w,x))l.encodeAudio(T);if(h){const T=new VideoFrame(e,{duration:d,timestamp:w});l.encodeVideo(T,{keyFrame:m%150===0}),t.resetTransform(),t.clearRect(0,0,o,_),m+=1}}}function T2(s){const t=s*Ie.channelCount,e=new Float32Array(t*3);let n=0,l=0;const h=s/Ie.sampleRate*1e6,d=new Float32Array(t),o=_=>{let m=0;const v=Math.floor(n/t),w=[];for(let x=0;x<v;x++)w.push(new AudioData({timestamp:l,numberOfChannels:Ie.channelCount,numberOfFrames:s,sampleRate:Ie.sampleRate,format:"f32",data:e.subarray(m,m+t)})),m+=t,l+=h;for(e.set(e.subarray(m,n),0),n-=m;_-l>h;)w.push(new AudioData({timestamp:l,numberOfChannels:Ie.channelCount,numberOfFrames:s,sampleRate:Ie.sampleRate,format:"f32",data:d})),l+=h;return w};return(_,m)=>{var v,w;const x=Math.max(...m.map(T=>{var r;return((r=T[0])==null?void 0:r.length)??0}));for(let T=0;T<x;T++){let r=0,a=0;for(let u=0;u<m.length;u++){const f=((v=m[u][0])==null?void 0:v[T])??0,g=((w=m[u][1])==null?void 0:w[T])??f;r+=f,a+=g}e[n]=r,e[n+1]=a,n+=2}return o(_)}}function A2(s,t){return s.reduce((e,n)=>(e[n]=t[n],e),{})}var C2=Object.defineProperty,wx=s=>{throw TypeError(s)},U2=(s,t,e)=>t in s?C2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Pu=(s,t,e)=>U2(s,typeof t!="symbol"?t+"":t,e),G_=(s,t,e)=>t.has(s)||wx("Cannot "+e),ot=(s,t,e)=>(G_(s,t,"read from private field"),e?e.call(s):t.get(s)),je=(s,t,e)=>t.has(s)?wx("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),Gi=(s,t,e,n)=>(G_(s,t,"write to private field"),t.set(s,e),e),$s=(s,t,e)=>(G_(s,t,"access private method"),e);const I2=["t","b","l","r","lt","lb","rt","rb","rotate"];function Eo(s){return document.createElement(s)}function P2(s){let t=16;const e=new ResizeObserver(l=>{const h=l[0];h!=null&&(t=10/(h.contentRect.width/s.width))});e.observe(s);function n(l){const{w:h,h:d}=l,o=t,_=o/2,m=h/2,v=d/2,w=o*1.5,x=w/2;return{...l.fixedAspectRatio?{}:{t:new Nr(-_,-v-_,o,o,l),b:new Nr(-_,v-_,o,o,l),l:new Nr(-m-_,-_,o,o,l),r:new Nr(m-_,-_,o,o,l)},lt:new Nr(-m-_,-v-_,o,o,l),lb:new Nr(-m-_,v-_,o,o,l),rt:new Nr(m-_,-v-_,o,o,l),rb:new Nr(m-_,v-_,o,o,l),rotate:new Nr(-x,-v-o*2-x,w,w,l)}}return{rectCtrlsGetter:n,destroy:()=>{e.disconnect()}}}var Rl=(s=>(s.ActiveSpriteChange="activeSpriteChange",s.AddSprite="addSprite",s))(Rl||{}),er,ja,qa,_l;class R2{constructor(){je(this,er,[]),je(this,ja,null),je(this,qa,new ea),Pu(this,"on",ot(this,qa).on),je(this,_l,0)}get activeSprite(){return ot(this,ja)}set activeSprite(t){t!==ot(this,ja)&&(Gi(this,ja,t),ot(this,qa).emit("activeSpriteChange",t))}async addSprite(t){await t.ready,ot(this,er).push(t),Gi(this,er,ot(this,er).sort((e,n)=>e.zIndex-n.zIndex)),t.on("propsChange",e=>{e.zIndex!=null&&Gi(this,er,ot(this,er).sort((n,l)=>n.zIndex-l.zIndex))}),ot(this,qa).emit("addSprite",t)}removeSprite(t){ot(this,ja)===t&&(this.activeSprite=null),Gi(this,er,ot(this,er).filter(e=>e!==t)),t.destroy()}getSprites(t={time:!0}){return ot(this,er).filter(e=>e.visible&&(t.time?ot(this,_l)>=e.time.offset&&ot(this,_l)<=e.time.offset+e.time.duration:!0))}updateRenderTime(t){Gi(this,_l,t);const e=this.activeSprite;e!=null&&(t<e.time.offset||t>e.time.offset+e.time.duration)&&(this.activeSprite=null)}destroy(){ot(this,qa).destroy(),ot(this,er).forEach(t=>t.destroy()),Gi(this,er,[])}}er=new WeakMap,ja=new WeakMap,qa=new WeakMap,_l=new WeakMap;function B2(s,t,e,n){const l={w:t.clientWidth/t.width,h:t.clientHeight/t.height},h=new ResizeObserver(()=>{l.w=t.clientWidth/t.width,l.h=t.clientHeight/t.height,e.activeSprite!=null&&pf(e.activeSprite,d,o,l,n)});h.observe(t);const{rectEl:d,ctrlsEl:o}=F2(s),_=e.on(Rl.ActiveSpriteChange,T=>{if(T==null){d.style.display="none";return}pf(T,d,o,l,n),d.style.display=""});let m=!1;const v=T=>{T.button===0&&(m=!0)},w=()=>{m=!1},x=()=>{!m||e.activeSprite==null||pf(e.activeSprite,d,o,l,n)};return t.addEventListener("mousedown",v),window.addEventListener("mouseup",w),window.addEventListener("mousemove",x),()=>{h.disconnect(),_(),d.remove(),t.removeEventListener("mousedown",v),window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",x)}}function F2(s){const t=Eo("div");t.style.cssText=`
    position: absolute;
    pointer-events: none;
    border: 1px solid #eee;
    box-sizing: border-box;
    display: none;
  `;const e=Object.fromEntries(I2.map(n=>{const l=Eo("div");return l.style.cssText=`
        display: none;
        position: absolute;
        border: 1px solid #3ee; border-radius: 50%;
        box-sizing: border-box;
        background-color: #fff;
      `,[n,l]}));return Object.values(e).forEach(n=>t.appendChild(n)),s.appendChild(t),{rectEl:t,ctrlsEl:e}}function pf(s,t,e,n,l){const{x:h,y:d,w:o,h:_,angle:m}=s.rect;Object.assign(t.style,{left:`${h*n.w}px`,top:`${d*n.h}px`,width:`${o*n.w}px`,height:`${_*n.h}px`,rotate:`${m}rad`}),Object.entries(l(s.rect)).forEach(([v,{x:w,y:x,w:T,h:r}])=>{Object.assign(e[v].style,{display:"block",left:"50%",top:"50%",width:`${T*n.w}px`,height:`${r*n.h}px`,transform:`translate(${w*n.w}px, ${x*n.h}px)`})})}function M2(s,t,e){const n={w:s.clientWidth/s.width,h:s.clientHeight/s.height},l=new ResizeObserver(()=>{n.w=s.clientWidth/s.width,n.h=s.clientHeight/s.height});l.observe(s);const h=d=>{if(d.button!==0)return;const{offsetX:o,offsetY:_}=d,m=o/n.w,v=_/n.h;if(t.activeSprite!=null){const[w]=Object.entries(e(t.activeSprite.rect)).find(([,x])=>x.checkHit(m,v))??[];if(w!=null)return}t.activeSprite=t.getSprites().reverse().find(w=>w.visible&&w.rect.checkHit(m,v))??null};return s.addEventListener("mousedown",h),()=>{l.disconnect(),s.removeEventListener("mousedown",h)}}function L2(s,t,e,n){const l={w:s.clientWidth/s.width,h:s.clientHeight/s.height},h=new ResizeObserver(()=>{l.w=s.clientWidth/s.width,l.h=s.clientHeight/s.height});h.observe(s);let d=0,o=0,_=null;const m=H2(s,e);let v=null;const w=r=>{if(r.button!==0||t.activeSprite==null)return;v=t.activeSprite;const{offsetX:a,offsetY:u,clientX:f,clientY:g}=r;N2({rect:v.rect,offsetX:a,offsetY:u,clientX:f,clientY:g,cvsRatio:l,cvsEl:s,rectCtrlsGetter:n})||(_=v.rect.clone(),m.magneticEffect(v.rect.x,v.rect.y,v.rect),d=f,o=g,window.addEventListener("mousemove",x),window.addEventListener("mouseup",T))},x=r=>{if(v==null||_==null)return;const{clientX:a,clientY:u}=r;let f=_.x+(a-d)/l.w,g=_.y+(u-o)/l.h;Sx(v.rect,s,m.magneticEffect(f,g,v.rect))};s.addEventListener("mousedown",w);const T=()=>{m.hide(),window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",T)};return()=>{h.disconnect(),m.destroy(),T(),s.removeEventListener("mousedown",w)}}function D2({sprRect:s,startX:t,startY:e,ctrlKey:n,cvsRatio:l,cvsEl:h}){const d=s.clone(),o=m=>{const{clientX:v,clientY:w}=m,x=(v-t)/l.w,T=(w-e)/l.h,r=n.length===1?k2:O2,{x:a,y:u,w:f,h:g}=d,b=Math.atan2(g,f),{incW:S,incH:A,incS:C,rotateAngle:B}=r({deltaX:x,deltaY:T,angle:s.angle,ctrlKey:n,diagonalAngle:b}),R=10;let M=f,N=g,L=d.fixedScaleCenter?S*2:S,W=d.fixedScaleCenter?A*2:A,k=C;const j=Math.sqrt(g**2+f**2),Y=Math.sqrt((R*(g/f))**2+R**2);switch(n){case"l":M=Math.max(f+L,R),k=Math.min(C,f-R);break;case"r":M=Math.max(f+L,R),k=Math.max(C,R-f);break;case"b":N=Math.max(g+W,R),k=Math.min(C,g-R);break;case"t":N=Math.max(g+W,R),k=Math.max(C,R-g);break;case"lt":case"lb":M=Math.max(f+L,R),N=M===R?g/f*M:g+W,k=Math.min(C,j-Y);break;case"rt":case"rb":M=Math.max(f+L,R),N=M===R?g/f*M:g+W,k=Math.max(C,Y-j);break}let ut=a,it=u;if(d.fixedScaleCenter)ut=a+f/2-M/2,it=u+g/2-N/2;else{const gt=k/2*Math.cos(B)+a+f/2,Q=k/2*Math.sin(B)+u+g/2;ut=gt-M/2,it=Q-N/2}Sx(s,h,{x:ut,y:it,w:M,h:N})},_=()=>{window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",_)};window.addEventListener("mousemove",o),window.addEventListener("mouseup",_)}function k2({deltaX:s,deltaY:t,angle:e,ctrlKey:n}){let l=0,h=0,d=0,o=e;return n==="l"||n==="r"?(l=s*Math.cos(e)+t*Math.sin(e),h=l*(n==="l"?-1:1)):(n==="t"||n==="b")&&(o=e-Math.PI/2,l=s*Math.cos(o)+t*Math.sin(o),d=l*(n==="b"?-1:1)),{incW:h,incH:d,incS:l,rotateAngle:o}}function O2({deltaX:s,deltaY:t,angle:e,ctrlKey:n,diagonalAngle:l}){const h=(n==="lt"||n==="rb"?1:-1)*l+e,d=s*Math.cos(h)+t*Math.sin(h),o=n==="lt"||n==="lb"?-1:1,_=d*Math.cos(l)*o,m=d*Math.sin(l)*o;return{incW:_,incH:m,incS:d,rotateAngle:h}}function N2({rect:s,cvsRatio:t,offsetX:e,offsetY:n,clientX:l,clientY:h,cvsEl:d,rectCtrlsGetter:o}){const _=e/t.w,m=n/t.h,[v]=Object.entries(o(s)).find(([,w])=>w.checkHit(_,m))??[];return v==null?!1:(v==="rotate"?z2(s,G2(s.center,t,d)):D2({sprRect:s,ctrlKey:v,startX:l,startY:h,cvsRatio:t,cvsEl:d}),!0)}function z2(s,t){const e=({clientX:l,clientY:h})=>{const d=l-t.x,o=h-t.y,_=Math.atan2(o,d)+Math.PI/2;s.angle=_},n=()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)}function G2(s,t,e){const n=s.x*t.w,l=s.y*t.h,{left:h,top:d}=e.getBoundingClientRect();return{x:n+h,y:l+d}}function Sx(s,t,e){const n={x:s.x,y:s.y,w:s.w,h:s.h,...e},l=t.width*.05,h=t.height*.05;n.x<-n.w+l?n.x=-n.w+l:n.x>t.width-l&&(n.x=t.width-l),n.y<-n.h+h?n.y=-n.h+h:n.y>t.height-h&&(n.y=t.height-h),s.x=n.x,s.y=n.y,s.w=n.w,s.h=n.h}function H2(s,t){const e="display: none; position: absolute;",n={w:0,h:0,x:0,y:0},l={vertMiddle:{...n,h:100,x:50,ref:{prop:"x",val:({w:_})=>(s.width-_)/2}},horMiddle:{...n,w:100,y:50,ref:{prop:"y",val:({h:_})=>(s.height-_)/2}},top:{...n,w:100,ref:{prop:"y",val:()=>0}},bottom:{...n,w:100,y:100,ref:{prop:"y",val:({h:_})=>s.height-_}},left:{...n,h:100,ref:{prop:"x",val:()=>0}},right:{...n,h:100,x:100,ref:{prop:"x",val:({w:_})=>s.width-_}}},h=Eo("div");h.style.cssText=`
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    box-sizing: border-box;
  `;const d=Object.fromEntries(Object.entries(l).map(([_,{w:m,h:v,x:w,y:x}])=>{const T=Eo("div");return T.style.cssText=`
        ${e}
        border-${m>0?"top":"left"}: 1px solid #3ee;
        top: ${x}%; left: ${w}%;
        ${w===100?"margin-left: -1px":""};
        ${x===100?"margin-top: -1px":""};
        width: ${m}%; height: ${v}%;
      `,h.appendChild(T),[_,T]}));t.appendChild(h);const o=6/(900/s.width);return{magneticEffect(_,m,v){const w={x:_,y:m};let x,T={x:!1,y:!1};for(x in l){const{prop:r,val:a}=l[x].ref;if(T[r])continue;const u=a(v);Math.abs(v[r]-u)<=o&&Math.abs(v[r]-(r==="x"?_:m))<=o?(w[r]=u,d[x].style.display="block",T[r]=!0):d[x].style.display="none"}return w},hide(){Object.values(d).forEach(_=>_.style.display="none")},destroy(){h.remove()}}}function $2(s,t,e){const n={w:s.clientWidth/s.width,h:s.clientHeight/s.height},l=new ResizeObserver(()=>{n.w=s.clientWidth/s.width,n.h=s.clientHeight/s.height});l.observe(s);const h=s.style;let d=t.activeSprite;t.on(Rl.ActiveSpriteChange,T=>{d=T,T==null&&(h.cursor="")});let o=!1;const _=({offsetX:T,offsetY:r})=>{o=!0;const a=T/n.w,u=r/n.h;(d==null?void 0:d.rect.checkHit(a,u))===!0&&h.cursor===""&&(h.cursor="move")},m=()=>{o=!1},v=["ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize"],w={t:0,rt:1,r:2,rb:3,b:4,lb:5,l:6,lt:7},x=T=>{if(d==null||o)return;const{offsetX:r,offsetY:a}=T,u=r/n.w,f=a/n.h,[g]=Object.entries(e(d.rect)).find(([,b])=>b.checkHit(u,f))??[];if(g!=null){if(g==="rotate"){h.cursor="crosshair";return}const b=d.rect.angle,S=b<0?b+2*Math.PI:b,A=(w[g]+Math.floor((S+Math.PI/8)/(Math.PI/4)))%8;h.cursor=v[A];return}if(d.rect.checkHit(u,f)){h.cursor="move";return}h.cursor=""};return s.addEventListener("mousemove",x),s.addEventListener("mousedown",_),window.addEventListener("mouseup",m),()=>{l.disconnect(),s.removeEventListener("mousemove",x),s.removeEventListener("mousedown",_),window.removeEventListener("mouseup",m)}}const V2={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2"};function W2(s){const t=Eo("canvas");return t.style.cssText=`
    width: 100%;
    height: 100%;
    display: block;
  `,t.width=s.width,t.height=s.height,t}var ni,We,oo,Ru,Bu,Fu,Zn,Mu,es,Sn,nc,sc,wi,Vs,Ws,Ex,br,Lu;class X2{constructor(t,e){je(this,Sn),je(this,ni),je(this,We),je(this,oo),je(this,Ru,!1),je(this,Bu,[]),je(this,Fu),je(this,Zn,new ea),Pu(this,"on",ot(this,Zn).on),je(this,Mu),je(this,es,0),je(this,wi,new AudioContext),je(this,Vs,ot(this,wi).createMediaStreamDestination()),je(this,Ws,new Set),je(this,br,{start:0,end:0,step:0,audioPlayAt:0}),je(this,Lu,new WeakMap),Pu(this,"addSprite",async w=>{ot(this,wi).state==="suspended"&&ot(this,wi).resume().catch(Zt.error);const x=w.getClip();if(x instanceof p2&&x.audioTrack!=null){const T=ot(this,wi).createMediaStreamSource(new MediaStream([x.audioTrack]));T.connect(ot(this,Vs)),ot(this,Lu).set(w,T)}await ot(this,We).addSprite(w)}),Pu(this,"removeSprite",w=>{var x;(x=ot(this,Lu).get(w))==null||x.disconnect(),ot(this,We).removeSprite(w)}),Gi(this,Mu,e),Gi(this,ni,W2(e));const n=ot(this,ni).getContext("2d",{alpha:!1});if(n==null)throw Error("canvas context is null");Gi(this,oo,n);const l=Eo("div");l.style.cssText="width: 100%; height: 100%; position: relative; overflow: hidden;",l.appendChild(ot(this,ni)),t.appendChild(l),j2(ot(this,wi)).connect(ot(this,Vs)),Gi(this,We,new R2);const{rectCtrlsGetter:h,destroy:d}=P2(ot(this,ni));ot(this,Bu).push(d,M2(ot(this,ni),ot(this,We),h),$2(ot(this,ni),ot(this,We),h),L2(ot(this,ni),ot(this,We),l,h),B2(l,ot(this,ni),ot(this,We),h),ot(this,We).on(Rl.AddSprite,w=>{const{rect:x}=w;x.x===0&&x.y===0&&(x.x=(ot(this,ni).width-x.w)/2,x.y=(ot(this,ni).height-x.h)/2)}),ea.forwardEvent(ot(this,We),ot(this,Zn),[Rl.ActiveSpriteChange]));let o=ot(this,es),_=performance.now(),m=0;const v=1e3/30;Gi(this,Fu,M_(()=>{(performance.now()-_)/(v*m)<1||(m+=1,ot(this,oo).fillStyle=e.bgColor,ot(this,oo).fillRect(0,0,ot(this,ni).width,ot(this,ni).height),$s(this,Sn,Ex).call(this),o!==ot(this,es)&&(o=ot(this,es),ot(this,Zn).emit("timeupdate",Math.round(o))))},v))}play(t){const e=ot(this,We).getSprites({time:!1}).map(l=>l.time.offset+l.time.duration),n=t.end??(e.length>0?Math.max(...e):1/0);if(t.start>=n||t.start<0)throw Error(`Invalid time parameter, ${JSON.stringify({start:t.start,end:n})}`);$s(this,Sn,nc).call(this,t.start),ot(this,We).getSprites({time:!1}).forEach(l=>{const{offset:h,duration:d}=l.time,o=ot(this,es)-h;l.preFrame(o>0&&o<d?o:0)}),ot(this,br).start=t.start,ot(this,br).end=n,ot(this,br).step=(t.playbackRate??1)*(1e3/30)*1e3,ot(this,wi).resume(),ot(this,br).audioPlayAt=0,ot(this,Zn).emit("playing"),Zt.info("AVCanvs play by:",ot(this,br))}pause(){$s(this,Sn,sc).call(this)}previewFrame(t){$s(this,Sn,nc).call(this,t),$s(this,Sn,sc).call(this)}captureImage(){return ot(this,ni).toDataURL()}get activeSprite(){return ot(this,We).activeSprite}set activeSprite(t){ot(this,We).activeSprite=t}destroy(){var t;ot(this,Ru)||(Gi(this,Ru,!0),ot(this,wi).close(),ot(this,Vs).disconnect(),ot(this,Zn).destroy(),ot(this,Fu).call(this),(t=ot(this,ni).parentElement)==null||t.remove(),ot(this,Bu).forEach(e=>e()),ot(this,Ws).clear(),ot(this,We).destroy())}captureStream(){ot(this,wi).state==="suspended"&&ot(this,wi).resume().catch(Zt.error);const t=new MediaStream(ot(this,ni).captureStream().getTracks().concat(ot(this,Vs).stream.getTracks()));return Zt.info("AVCanvas.captureStream, tracks:",t.getTracks().map(e=>e.kind)),t}async createCombinator(t={}){Zt.info("AVCanvas.createCombinator, opts:",t);const e=new w2({...ot(this,Mu),...t}),n=ot(this,We).getSprites({time:!1});if(n.length===0)throw Error("No sprite added");for(const l of n){const h=new v2(l.getClip());h.time={...l.time},l.copyStateTo(h),await e.addSprite(h)}return e}}ni=new WeakMap,We=new WeakMap,oo=new WeakMap,Ru=new WeakMap,Bu=new WeakMap,Fu=new WeakMap,Zn=new WeakMap,Mu=new WeakMap,es=new WeakMap,Sn=new WeakSet,nc=function(s){Gi(this,es,s),ot(this,We).updateRenderTime(s)},sc=function(){const s=ot(this,br).step!==0;ot(this,br).step=0,s&&(ot(this,Zn).emit("paused"),ot(this,wi).suspend());for(const t of ot(this,Ws))t.stop(),t.disconnect();ot(this,Ws).clear()},wi=new WeakMap,Vs=new WeakMap,Ws=new WeakMap,Ex=function(){var s;const t=ot(this,oo);let e=ot(this,es);const{start:n,end:l,step:h,audioPlayAt:d}=ot(this,br);h!==0&&e>=n&&e<l?e+=h:$s(this,Sn,sc).call(this),$s(this,Sn,nc).call(this,e);const o=[];for(const _ of ot(this,We).getSprites()){t.save();const{audio:m}=_.render(t,e-_.time.offset);t.restore(),o.push(m)}if(t.resetTransform(),h!==0){const _=Math.max(ot(this,wi).currentTime,d),m=Y2(o,ot(this,wi));let v=0;for(const w of m)w.start(_),w.connect(ot(this,wi).destination),w.connect(ot(this,Vs)),ot(this,Ws).add(w),w.onended=()=>{w.disconnect(),ot(this,Ws).delete(w)},v=Math.max(v,((s=w.buffer)==null?void 0:s.duration)??0);ot(this,br).audioPlayAt=_+v}},br=new WeakMap,Lu=new WeakMap;function Y2(s,t){const e=[];if(s.length===0)return e;for(const[n,l]of s){if(n==null||n.length<=0)continue;const h=t.createBuffer(2,n.length,V2.sampleRate);h.copyToChannel(n,0),h.copyToChannel(l??n,1);const d=t.createBufferSource();d.buffer=h,e.push(d)}return e}function j2(s){const t=s.createOscillator(),e=new Float32Array([0,0]),n=new Float32Array([0,0]),l=s.createPeriodicWave(e,n,{disableNormalization:!0});return t.setPeriodicWave(l),t.start(),t}const sa=eI("track",{state:()=>({showContextMenu:!1,contextMenuPosition:{x:0,y:0},dragData:null,canvasSize:{width:0,height:0},currentHistoryIndex:-1,maxHistoryIndex:-1,maxHistorySize:50,clipUpdateSubscribers:new Map,activeClip:null}),getters:{getShowContextMenu:s=>s.showContextMenu,getContextMenuPosition:s=>s.contextMenuPosition,getDragData:s=>s.dragData,getCanvasSize:s=>s.canvasSize,canUndo:s=>s.currentHistoryIndex>0},actions:{subscribeToClipUpdates(s,t){this.clipUpdateSubscribers.set(s,t)},unsubscribeFromClipUpdates(s){this.clipUpdateSubscribers.delete(s)},publishClipUpdate(s,t="default"){const e=this.clipUpdateSubscribers.get(s.id);e&&e(s,t)},setShowContextMenu(s){this.showContextMenu=s},setContextMenuPosition(s){this.contextMenuPosition=s},setDragData(s){this.dragData=s},clearDragData(){this.dragData=null},setCanvasSize(s){this.canvasSize=s},async saveHistoryState(s,t){if(await Ke.history.where("projectId").equals(s).and(n=>n.index>this.currentHistoryIndex).delete(),this.currentHistoryIndex++,this.maxHistoryIndex=this.currentHistoryIndex,await Ke.history.add({projectId:s,tracks:JSON.parse(JSON.stringify(t)),index:this.currentHistoryIndex,timestamp:Date.now()}),await Ke.history.where("projectId").equals(s).count()>this.maxHistorySize){const n=await Ke.history.where("projectId").equals(s).and(l=>l.index===0).toArray();n.length>0&&(await Ke.history.delete(n[0].id),this.currentHistoryIndex--,this.maxHistoryIndex--)}},async undo(s){if(!this.canUndo)return null;const t=await Ke.history.where("projectId").equals(s).and(e=>e.index===this.currentHistoryIndex-1).first();return t?(this.currentHistoryIndex--,t.tracks):null},async redo(s){const t=await Ke.history.where("projectId").equals(s).and(e=>e.index===this.currentHistoryIndex+1).first();return t?(this.currentHistoryIndex++,t.tracks):null},async getCanRedo(s){const t=await Ke.history.where("projectId").equals(s).count();return this.currentHistoryIndex<t-1},async clearHistory(s){await Ke.history.where("projectId").equals(s).delete(),this.currentHistoryIndex=-1,this.maxHistoryIndex=-1},setActiveClip(s){this.activeClip=s}}}),Tx=/^[a-z0-9]+(-[a-z0-9]+)*$/,Ic=(s,t,e,n="")=>{const l=s.split(":");if(s.slice(0,1)==="@"){if(l.length<2||l.length>3)return null;n=l.shift().slice(1)}if(l.length>3||!l.length)return null;if(l.length>1){const o=l.pop(),_=l.pop(),m={provider:l.length>0?l[0]:n,prefix:_,name:o};return t&&!Du(m)?null:m}const h=l[0],d=h.split("-");if(d.length>1){const o={provider:n,prefix:d.shift(),name:d.join("-")};return t&&!Du(o)?null:o}if(e&&n===""){const o={provider:n,prefix:"",name:h};return t&&!Du(o,e)?null:o}return null},Du=(s,t)=>s?!!((t&&s.prefix===""||s.prefix)&&s.name):!1,Ax=Object.freeze({left:0,top:0,width:16,height:16}),ac=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),Pc=Object.freeze({...Ax,...ac}),Up=Object.freeze({...Pc,body:"",hidden:!1});function q2(s,t){const e={};!s.hFlip!=!t.hFlip&&(e.hFlip=!0),!s.vFlip!=!t.vFlip&&(e.vFlip=!0);const n=((s.rotate||0)+(t.rotate||0))%4;return n&&(e.rotate=n),e}function Xy(s,t){const e=q2(s,t);for(const n in Up)n in ac?n in s&&!(n in e)&&(e[n]=ac[n]):n in t?e[n]=t[n]:n in s&&(e[n]=s[n]);return e}function K2(s,t){const e=s.icons,n=s.aliases||Object.create(null),l=Object.create(null);function h(d){if(e[d])return l[d]=[];if(!(d in l)){l[d]=null;const o=n[d]&&n[d].parent,_=o&&h(o);_&&(l[d]=[o].concat(_))}return l[d]}return Object.keys(e).concat(Object.keys(n)).forEach(h),l}function Z2(s,t,e){const n=s.icons,l=s.aliases||Object.create(null);let h={};function d(o){h=Xy(n[o]||l[o],h)}return d(t),e.forEach(d),Xy(s,h)}function Cx(s,t){const e=[];if(typeof s!="object"||typeof s.icons!="object")return e;s.not_found instanceof Array&&s.not_found.forEach(l=>{t(l,null),e.push(l)});const n=K2(s);for(const l in n){const h=n[l];h&&(t(l,Z2(s,l,h)),e.push(l))}return e}const J2={provider:"",aliases:{},not_found:{},...Ax};function _f(s,t){for(const e in t)if(e in s&&typeof s[e]!=typeof t[e])return!1;return!0}function Ux(s){if(typeof s!="object"||s===null)return null;const t=s;if(typeof t.prefix!="string"||!s.icons||typeof s.icons!="object"||!_f(s,J2))return null;const e=t.icons;for(const l in e){const h=e[l];if(!l||typeof h.body!="string"||!_f(h,Up))return null}const n=t.aliases||Object.create(null);for(const l in n){const h=n[l],d=h.parent;if(!l||typeof d!="string"||!e[d]&&!n[d]||!_f(h,Up))return null}return t}const Yy=Object.create(null);function Q2(s,t){return{provider:s,prefix:t,icons:Object.create(null),missing:new Set}}function To(s,t){const e=Yy[s]||(Yy[s]=Object.create(null));return e[t]||(e[t]=Q2(s,t))}function Ix(s,t){return Ux(t)?Cx(t,(e,n)=>{n?s.icons[e]=n:s.missing.add(e)}):[]}function tP(s,t,e){try{if(typeof e.body=="string")return s.icons[t]={...e},!0}catch{}return!1}let Bl=!1;function Px(s){return typeof s=="boolean"&&(Bl=s),Bl}function eP(s){const t=typeof s=="string"?Ic(s,!0,Bl):s;if(t){const e=To(t.provider,t.prefix),n=t.name;return e.icons[n]||(e.missing.has(n)?null:void 0)}}function iP(s,t){const e=Ic(s,!0,Bl);if(!e)return!1;const n=To(e.provider,e.prefix);return t?tP(n,e.name,t):(n.missing.add(e.name),!0)}function rP(s,t){if(typeof s!="object")return!1;if(typeof t!="string"&&(t=s.provider||""),Bl&&!t&&!s.prefix){let l=!1;return Ux(s)&&(s.prefix="",Cx(s,(h,d)=>{iP(h,d)&&(l=!0)})),l}const e=s.prefix;if(!Du({provider:t,prefix:e,name:"a"}))return!1;const n=To(t,e);return!!Ix(n,s)}const Rx=Object.freeze({width:null,height:null}),Bx=Object.freeze({...Rx,...ac}),nP=/(-?[0-9.]*[0-9]+[0-9.]*)/g,sP=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function jy(s,t,e){if(t===1)return s;if(e=e||100,typeof s=="number")return Math.ceil(s*t*e)/e;if(typeof s!="string")return s;const n=s.split(nP);if(n===null||!n.length)return s;const l=[];let h=n.shift(),d=sP.test(h);for(;;){if(d){const o=parseFloat(h);isNaN(o)?l.push(h):l.push(Math.ceil(o*t*e)/e)}else l.push(h);if(h=n.shift(),h===void 0)return l.join("");d=!d}}function aP(s,t="defs"){let e="";const n=s.indexOf("<"+t);for(;n>=0;){const l=s.indexOf(">",n),h=s.indexOf("</"+t);if(l===-1||h===-1)break;const d=s.indexOf(">",h);if(d===-1)break;e+=s.slice(l+1,h).trim(),s=s.slice(0,n).trim()+s.slice(d+1)}return{defs:e,content:s}}function oP(s,t){return s?"<defs>"+s+"</defs>"+t:t}function lP(s,t,e){const n=aP(s);return oP(n.defs,t+n.content+e)}const hP=s=>s==="unset"||s==="undefined"||s==="none";function uP(s,t){const e={...Pc,...s},n={...Bx,...t},l={left:e.left,top:e.top,width:e.width,height:e.height};let h=e.body;[e,n].forEach(a=>{const u=[],f=a.hFlip,g=a.vFlip;let b=a.rotate;f?g?b+=2:(u.push("translate("+(l.width+l.left).toString()+" "+(0-l.top).toString()+")"),u.push("scale(-1 1)"),l.top=l.left=0):g&&(u.push("translate("+(0-l.left).toString()+" "+(l.height+l.top).toString()+")"),u.push("scale(1 -1)"),l.top=l.left=0);let S;switch(b<0&&(b-=Math.floor(b/4)*4),b=b%4,b){case 1:S=l.height/2+l.top,u.unshift("rotate(90 "+S.toString()+" "+S.toString()+")");break;case 2:u.unshift("rotate(180 "+(l.width/2+l.left).toString()+" "+(l.height/2+l.top).toString()+")");break;case 3:S=l.width/2+l.left,u.unshift("rotate(-90 "+S.toString()+" "+S.toString()+")");break}b%2===1&&(l.left!==l.top&&(S=l.left,l.left=l.top,l.top=S),l.width!==l.height&&(S=l.width,l.width=l.height,l.height=S)),u.length&&(h=lP(h,'<g transform="'+u.join(" ")+'">',"</g>"))});const d=n.width,o=n.height,_=l.width,m=l.height;let v,w;d===null?(w=o===null?"1em":o==="auto"?m:o,v=jy(w,_/m)):(v=d==="auto"?_:d,w=o===null?jy(v,m/_):o==="auto"?m:o);const x={},T=(a,u)=>{hP(u)||(x[a]=u.toString())};T("width",v),T("height",w);const r=[l.left,l.top,_,m];return x.viewBox=r.join(" "),{attributes:x,viewBox:r,body:h}}const cP=/\sid="(\S+)"/g,dP="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let fP=0;function pP(s,t=dP){const e=[];let n;for(;n=cP.exec(s);)e.push(n[1]);if(!e.length)return s;const l="suffix"+(Math.random()*16777216|Date.now()).toString(16);return e.forEach(h=>{const d=typeof t=="function"?t(h):t+(fP++).toString(),o=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s=s.replace(new RegExp('([#;"])('+o+')([")]|\\.[a-z])',"g"),"$1"+d+l+"$3")}),s=s.replace(new RegExp(l,"g"),""),s}const Ip=Object.create(null);function _P(s,t){Ip[s]=t}function Pp(s){return Ip[s]||Ip[""]}function H_(s){let t;if(typeof s.resources=="string")t=[s.resources];else if(t=s.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}const $_=Object.create(null),Qo=["https://api.simplesvg.com","https://api.unisvg.com"],ku=[];for(;Qo.length>0;)Qo.length===1||Math.random()>.5?ku.push(Qo.shift()):ku.push(Qo.pop());$_[""]=H_({resources:["https://api.iconify.design"].concat(ku)});function gP(s,t){const e=H_(t);return e===null?!1:($_[s]=e,!0)}function V_(s){return $_[s]}const mP=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}};let qy=mP();function yP(s,t){const e=V_(s);if(!e)return 0;let n;if(!e.maxURL)n=0;else{let l=0;e.resources.forEach(d=>{l=Math.max(l,d.length)});const h=t+".json?icons=";n=e.maxURL-l-e.path.length-h.length}return n}function vP(s){return s===404}const xP=(s,t,e)=>{const n=[],l=yP(s,t),h="icons";let d={type:h,provider:s,prefix:t,icons:[]},o=0;return e.forEach((_,m)=>{o+=_.length+1,o>=l&&m>0&&(n.push(d),d={type:h,provider:s,prefix:t,icons:[]},o=_.length),d.icons.push(_)}),n.push(d),n};function bP(s){if(typeof s=="string"){const t=V_(s);if(t)return t.path}return"/"}const wP=(s,t,e)=>{if(!qy){e("abort",424);return}let n=bP(t.provider);switch(t.type){case"icons":{const h=t.prefix,o=t.icons.join(","),_=new URLSearchParams({icons:o});n+=h+".json?"+_.toString();break}case"custom":{const h=t.uri;n+=h.slice(0,1)==="/"?h.slice(1):h;break}default:e("abort",400);return}let l=503;qy(s+n).then(h=>{const d=h.status;if(d!==200){setTimeout(()=>{e(vP(d)?"abort":"next",d)});return}return l=501,h.json()}).then(h=>{if(typeof h!="object"||h===null){setTimeout(()=>{h===404?e("abort",h):e("next",l)});return}setTimeout(()=>{e("success",h)})}).catch(()=>{e("next",l)})},SP={prepare:xP,send:wP};function EP(s){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);s.sort((l,h)=>l.provider!==h.provider?l.provider.localeCompare(h.provider):l.prefix!==h.prefix?l.prefix.localeCompare(h.prefix):l.name.localeCompare(h.name));let n={provider:"",prefix:"",name:""};return s.forEach(l=>{if(n.name===l.name&&n.prefix===l.prefix&&n.provider===l.provider)return;n=l;const h=l.provider,d=l.prefix,o=l.name,_=e[h]||(e[h]=Object.create(null)),m=_[d]||(_[d]=To(h,d));let v;o in m.icons?v=t.loaded:d===""||m.missing.has(o)?v=t.missing:v=t.pending;const w={provider:h,prefix:d,name:o};v.push(w)}),t}function Fx(s,t){s.forEach(e=>{const n=e.loaderCallbacks;n&&(e.loaderCallbacks=n.filter(l=>l.id!==t))})}function TP(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;const t=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const n=s.provider,l=s.prefix;t.forEach(h=>{const d=h.icons,o=d.pending.length;d.pending=d.pending.filter(_=>{if(_.prefix!==l)return!0;const m=_.name;if(s.icons[m])d.loaded.push({provider:n,prefix:l,name:m});else if(s.missing.has(m))d.missing.push({provider:n,prefix:l,name:m});else return e=!0,!0;return!1}),d.pending.length!==o&&(e||Fx([s],h.id),h.callback(d.loaded.slice(0),d.missing.slice(0),d.pending.slice(0),h.abort))})}))}let AP=0;function CP(s,t,e){const n=AP++,l=Fx.bind(null,e,n);if(!t.pending.length)return l;const h={id:n,icons:t,callback:s,abort:l};return e.forEach(d=>{(d.loaderCallbacks||(d.loaderCallbacks=[])).push(h)}),l}function UP(s,t=!0,e=!1){const n=[];return s.forEach(l=>{const h=typeof l=="string"?Ic(l,t,e):l;h&&n.push(h)}),n}var IP={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function PP(s,t,e,n){const l=s.resources.length,h=s.random?Math.floor(Math.random()*l):s.index;let d;if(s.random){let C=s.resources.slice(0);for(d=[];C.length>1;){const B=Math.floor(Math.random()*C.length);d.push(C[B]),C=C.slice(0,B).concat(C.slice(B+1))}d=d.concat(C)}else d=s.resources.slice(h).concat(s.resources.slice(0,h));const o=Date.now();let _="pending",m=0,v,w=null,x=[],T=[];typeof n=="function"&&T.push(n);function r(){w&&(clearTimeout(w),w=null)}function a(){_==="pending"&&(_="aborted"),r(),x.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),x=[]}function u(C,B){B&&(T=[]),typeof C=="function"&&T.push(C)}function f(){return{startTime:o,payload:t,status:_,queriesSent:m,queriesPending:x.length,subscribe:u,abort:a}}function g(){_="failed",T.forEach(C=>{C(void 0,v)})}function b(){x.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),x=[]}function S(C,B,R){const M=B!=="success";switch(x=x.filter(N=>N!==C),_){case"pending":break;case"failed":if(M||!s.dataAfterTimeout)return;break;default:return}if(B==="abort"){v=R,g();return}if(M){v=R,x.length||(d.length?A():g());return}if(r(),b(),!s.random){const N=s.resources.indexOf(C.resource);N!==-1&&N!==s.index&&(s.index=N)}_="completed",T.forEach(N=>{N(R)})}function A(){if(_!=="pending")return;r();const C=d.shift();if(C===void 0){if(x.length){w=setTimeout(()=>{r(),_==="pending"&&(b(),g())},s.timeout);return}g();return}const B={status:"pending",resource:C,callback:(R,M)=>{S(B,R,M)}};x.push(B),m++,w=setTimeout(A,s.rotate),e(C,t,B.callback)}return setTimeout(A),f}function Mx(s){const t={...IP,...s};let e=[];function n(){e=e.filter(o=>o().status==="pending")}function l(o,_,m){const v=PP(t,o,_,(w,x)=>{n(),m&&m(w,x)});return e.push(v),v}function h(o){return e.find(_=>o(_))||null}return{query:l,find:h,setIndex:o=>{t.index=o},getIndex:()=>t.index,cleanup:n}}function Ky(){}const gf=Object.create(null);function RP(s){if(!gf[s]){const t=V_(s);if(!t)return;const e=Mx(t),n={config:t,redundancy:e};gf[s]=n}return gf[s]}function BP(s,t,e){let n,l;if(typeof s=="string"){const h=Pp(s);if(!h)return e(void 0,424),Ky;l=h.send;const d=RP(s);d&&(n=d.redundancy)}else{const h=H_(s);if(h){n=Mx(h);const d=s.resources?s.resources[0]:"",o=Pp(d);o&&(l=o.send)}}return!n||!l?(e(void 0,424),Ky):n.query(t,l,e)().abort}function Zy(){}function FP(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,TP(s)}))}function MP(s){const t=[],e=[];return s.forEach(n=>{(n.match(Tx)?t:e).push(n)}),{valid:t,invalid:e}}function tl(s,t,e){function n(){const l=s.pendingIcons;t.forEach(h=>{l&&l.delete(h),s.icons[h]||s.missing.add(h)})}if(e&&typeof e=="object")try{if(!Ix(s,e).length){n();return}}catch(l){console.error(l)}n(),FP(s)}function Jy(s,t){s instanceof Promise?s.then(e=>{t(e)}).catch(()=>{t(null)}):t(s)}function LP(s,t){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(t).sort():s.iconsToLoad=t,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;const{provider:e,prefix:n}=s,l=s.iconsToLoad;if(delete s.iconsToLoad,!l||!l.length)return;const h=s.loadIcon;if(s.loadIcons&&(l.length>1||!h)){Jy(s.loadIcons(l,n,e),v=>{tl(s,l,v)});return}if(h){l.forEach(v=>{const w=h(v,n,e);Jy(w,x=>{const T=x?{prefix:n,icons:{[v]:x}}:null;tl(s,[v],T)})});return}const{valid:d,invalid:o}=MP(l);if(o.length&&tl(s,o,null),!d.length)return;const _=n.match(Tx)?Pp(e):null;if(!_){tl(s,d,null);return}_.prepare(e,n,d).forEach(v=>{BP(e,v,w=>{tl(s,v.icons,w)})})}))}const DP=(s,t)=>{const e=UP(s,!0,Px()),n=EP(e);if(!n.pending.length){let _=!0;return t&&setTimeout(()=>{_&&t(n.loaded,n.missing,n.pending,Zy)}),()=>{_=!1}}const l=Object.create(null),h=[];let d,o;return n.pending.forEach(_=>{const{provider:m,prefix:v}=_;if(v===o&&m===d)return;d=m,o=v,h.push(To(m,v));const w=l[m]||(l[m]=Object.create(null));w[v]||(w[v]=[])}),n.pending.forEach(_=>{const{provider:m,prefix:v,name:w}=_,x=To(m,v),T=x.pendingIcons||(x.pendingIcons=new Set);T.has(w)||(T.add(w),l[m][v].push(w))}),h.forEach(_=>{const m=l[_.provider][_.prefix];m.length&&LP(_,m)}),t?CP(t,n,h):Zy};function kP(s,t){const e={...s};for(const n in t){const l=t[n],h=typeof l;n in Rx?(l===null||l&&(h==="string"||h==="number"))&&(e[n]=l):h===typeof e[n]&&(e[n]=n==="rotate"?l%4:l)}return e}const OP=/[\s,]+/;function NP(s,t){t.split(OP).forEach(e=>{switch(e.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}function zP(s,t=0){const e=s.replace(/^-?[0-9.]*/,"");function n(l){for(;l<0;)l+=4;return l%4}if(e===""){const l=parseInt(s);return isNaN(l)?0:n(l)}else if(e!==s){let l=0;switch(e){case"%":l=25;break;case"deg":l=90}if(l){let h=parseFloat(s.slice(0,s.length-e.length));return isNaN(h)?0:(h=h/l,h%1===0?n(h):0)}}return t}function GP(s,t){let e=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const n in t)e+=" "+n+'="'+t[n]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+s+"</svg>"}function HP(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function $P(s){return"data:image/svg+xml,"+HP(s)}function VP(s){return'url("'+$P(s)+'")'}const Qy={...Bx,inline:!1},WP={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},XP={display:"inline-block"},Rp={backgroundColor:"currentColor"},Lx={backgroundColor:"transparent"},tv={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},ev={webkitMask:Rp,mask:Rp,background:Lx};for(const s in ev){const t=ev[s];for(const e in tv)t[s+e]=tv[e]}const Ou={};["horizontal","vertical"].forEach(s=>{const t=s.slice(0,1)+"Flip";Ou[s+"-flip"]=t,Ou[s.slice(0,1)+"-flip"]=t,Ou[s+"Flip"]=t});function iv(s){return s+(s.match(/^[-0-9.]+$/)?"px":"")}const rv=(s,t)=>{const e=kP(Qy,t),n={...WP},l=t.mode||"svg",h={},d=t.style,o=typeof d=="object"&&!(d instanceof Array)?d:{};for(let a in t){const u=t[a];if(u!==void 0)switch(a){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":e[a]=u===!0||u==="true"||u===1;break;case"flip":typeof u=="string"&&NP(e,u);break;case"color":h.color=u;break;case"rotate":typeof u=="string"?e[a]=zP(u):typeof u=="number"&&(e[a]=u);break;case"ariaHidden":case"aria-hidden":u!==!0&&u!=="true"&&delete n["aria-hidden"];break;default:{const f=Ou[a];f?(u===!0||u==="true"||u===1)&&(e[f]=!0):Qy[a]===void 0&&(n[a]=u)}}}const _=uP(s,e),m=_.attributes;if(e.inline&&(h.verticalAlign="-0.125em"),l==="svg"){n.style={...h,...o},Object.assign(n,m);let a=0,u=t.id;return typeof u=="string"&&(u=u.replace(/-/g,"_")),n.innerHTML=pP(_.body,u?()=>u+"ID"+a++:"iconifyVue"),ky("svg",n)}const{body:v,width:w,height:x}=s,T=l==="mask"||(l==="bg"?!1:v.indexOf("currentColor")!==-1),r=GP(v,{...m,width:w+"",height:x+""});return n.style={...h,"--svg":VP(r),width:iv(m.width),height:iv(m.height),...XP,...T?Rp:Lx,...o},ky("span",n)};Px(!0);_P("",SP);if(typeof document<"u"&&typeof window<"u"){const s=window;if(s.IconifyPreload!==void 0){const t=s.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(n=>{try{(typeof n!="object"||n===null||n instanceof Array||typeof n.icons!="object"||typeof n.prefix!="string"||!rP(n))&&console.error(e)}catch{console.error(e)}})}if(s.IconifyProviders!==void 0){const t=s.IconifyProviders;if(typeof t=="object"&&t!==null)for(let e in t){const n="IconifyProviders["+e+"] is invalid.";try{const l=t[e];if(typeof l!="object"||!l||l.resources===void 0)continue;gP(e,l)||console.error(n)}catch{console.error(n)}}}}const YP={...Pc,body:""},ye=hi({inheritAttrs:!1,data(){return{_name:"",_loadingIcon:null,iconMounted:!1,counter:0}},mounted(){this.iconMounted=!0},unmounted(){this.abortLoading()},methods:{abortLoading(){this._loadingIcon&&(this._loadingIcon.abort(),this._loadingIcon=null)},getIcon(s,t,e){if(typeof s=="object"&&s!==null&&typeof s.body=="string")return this._name="",this.abortLoading(),{data:s};let n;if(typeof s!="string"||(n=Ic(s,!1,!0))===null)return this.abortLoading(),null;let l=eP(n);if(!l)return(!this._loadingIcon||this._loadingIcon.name!==s)&&(this.abortLoading(),this._name="",l!==null&&(this._loadingIcon={name:s,abort:DP([n],()=>{this.counter++})})),null;if(this.abortLoading(),this._name!==s&&(this._name=s,t&&t(s)),e){l=Object.assign({},l);const d=e(l.body,n.name,n.prefix,n.provider);typeof d=="string"&&(l.body=d)}const h=["iconify"];return n.prefix!==""&&h.push("iconify--"+n.prefix),n.provider!==""&&h.push("iconify--"+n.provider),{data:l,classes:h}}},render(){this.counter;const s=this.$attrs,t=this.iconMounted||s.ssr?this.getIcon(s.icon,s.onLoad,s.customise):null;if(!t)return rv(YP,s);let e=s;return t.classes&&(e={...s,class:(typeof s.class=="string"?s.class+" ":"")+t.classes.join(" ")}),rv({...Pc,...t.data},e)}});var Ye,Je,bo,ee,Ks,Ur,Fp,Mp,Lp;const og=class og{constructor(t,e){Hn(this,Ur);Hn(this,Ye);Hn(this,Je);Hn(this,bo);lf(this,"ready");Hn(this,ee);Hn(this,Ks,{width:0,height:0,duration:1/0});$n(this,Ye,document.createElement("canvas")),$n(this,ee,t),$n(this,bo,e),$n(this,Je,xt(this,Ye).getContext("2d"));const n=xt(this,ee).content.split(`
`),{xPadding:l,yPadding:h}=Es(this,Ur,Fp).call(this);xt(this,Ye).width=Es(this,Ur,Mp).call(this,n)+l*2,xt(this,Ye).height=Es(this,Ur,Lp).call(this,n)+h*2,this.ready=Promise.resolve({width:xt(this,Ye).width,height:xt(this,Ye).height,duration:1/0}),xt(this,Je).font=`${xt(this,ee).fontSize}px ${xt(this,ee).fontFamily}`}get textConfig(){return xt(this,ee)}set textConfig(t){$n(this,ee,t)}get meta(){return xt(this,Ks)}set meta(t){$n(this,Ks,t)}async tick(t){const e=xt(this,ee).content.split(`
`),{xPadding:n,yPadding:l}=Es(this,Ur,Fp).call(this),h=Es(this,Ur,Mp).call(this,e),d=Es(this,Ur,Lp).call(this,e);xt(this,Ye).width=h+n*2,xt(this,Ye).height=d+l*2,xt(this,Ks).width=xt(this,Ye).width,xt(this,Ks).height=xt(this,Ye).height,xt(this,bo).call(this,h+n*2,d+l*2),xt(this,Je).clearRect(0,0,xt(this,Ye).width,xt(this,Ye).height),xt(this,Je).fillStyle=xt(this,ee).color,xt(this,Je).font=`${xt(this,ee).bold?"bold":""} ${xt(this,ee).italic?"italic":""} ${xt(this,ee).fontSize}px ${xt(this,ee).fontFamily}`,xt(this,Je).textBaseline="hanging",xt(this,ee).showShadow&&(xt(this,Je).shadowColor=xt(this,ee).shadowColor,xt(this,Je).shadowBlur=xt(this,ee).shadowBlur,xt(this,Je).shadowOffsetX=xt(this,ee).shadowOffsetX,xt(this,Je).shadowOffsetY=xt(this,ee).shadowOffsetY);let o=0,_=0;for(let m=0;m<e.length;m++){let v=xt(this,ee).fontSize*e[m].length+xt(this,ee).letterSpacing*(e[m].length-1);switch(xt(this,ee).align){case"left":o=0;break;case"center":o=(xt(this,Ye).width-v)/2;break;case"right":o=xt(this,Ye).width-v;break}for(let w=0;w<e[m].length;w++)xt(this,ee).showStroke&&(xt(this,Je).lineJoin="round",xt(this,Je).strokeStyle=xt(this,ee).strokeColor,xt(this,Je).lineWidth=xt(this,ee).strokeWidth,xt(this,Je).strokeText(e[m][w],o+w*xt(this,ee).fontSize+xt(this,ee).letterSpacing*w,m*xt(this,ee).fontSize+xt(this,ee).lineSpacing*m+_)),xt(this,Je).fillText(e[m][w],w*xt(this,ee).fontSize+xt(this,ee).letterSpacing*w+o,m*xt(this,ee).fontSize+xt(this,ee).lineSpacing*m+_)}return{state:"success",video:new VideoFrame(xt(this,Ye),{timestamp:t})}}async generateImage(){const{video:t}=await this.tick(0),e=new OffscreenCanvas(t.codedWidth,t.codedHeight);e.getContext("2d").drawImage(t,0,0,t.codedWidth,t.codedHeight);const l=await e.convertToBlob(),h=document.createElement("a");h.href=URL.createObjectURL(l),h.download="text.png",h.click()}async clone(){return new og(xt(this,ee),xt(this,bo))}destroy(){xt(this,Ye).remove()}};Ye=new WeakMap,Je=new WeakMap,bo=new WeakMap,ee=new WeakMap,Ks=new WeakMap,Ur=new WeakSet,Fp=function(){let t=0,e=0;const n=xt(this,ee);return t=Math.max(n.showStroke?n.strokeWidth:0,n.showShadow?Math.max(n.shadowBlur,n.shadowOffsetX):0),e=Math.max(n.showStroke?n.strokeWidth:0,n.showShadow?Math.max(n.shadowBlur,n.shadowOffsetY):0),{xPadding:t,yPadding:e}},Mp=function(t){return Math.max(...t.map(e=>xt(this,ee).fontSize*e.length+xt(this,ee).letterSpacing*(e.length-1)))},Lp=function(t){return xt(this,ee).fontSize*t.length+xt(this,ee).lineSpacing*(t.length-1)};let Bp=og;var wo;const lg=class lg{constructor(t){lf(this,"ready");Hn(this,wo,{width:0,height:0,duration:0});this.ready=Promise.resolve({width:0,height:0,duration:t})}get meta(){return xt(this,wo)}set meta(t){$n(this,wo,t)}async tick(t){return{state:"success"}}async clone(){return new lg(xt(this,wo).duration)}destroy(){}};wo=new WeakMap;let Dp=lg;var aa=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(aa||{}),Dx=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(Dx||{}),kp=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(kp||{}),Vt=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(Vt||{}),Kr=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(Kr||{}),ft=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(ft||{}),fo=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(fo||{}),Bt=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(Bt||{}),bt=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(bt||{}),En=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(En||{}),os=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(os||{}),Qr=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(Qr||{}),Ri=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Ri||{}),Yr=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(Yr||{}),W_=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(W_||{}),nr=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(nr||{}),qe=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(qe||{}),Ge=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(Ge||{}),Zr=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(Zr||{});const jP={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},wt={ADAPTER:jP,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var mf=/iPhone/i,nv=/iPod/i,sv=/iPad/i,av=/\biOS-universal(?:.+)Mac\b/i,yf=/\bAndroid(?:.+)Mobile\b/i,ov=/Android/i,Aa=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,kh=/Silk/i,dn=/Windows Phone/i,lv=/\bWindows(?:.+)ARM\b/i,hv=/BlackBerry/i,uv=/BB10/i,cv=/Opera Mini/i,dv=/\b(CriOS|Chrome)(?:.+)Mobile/i,fv=/Mobile(?:.+)Firefox\b/i,pv=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function qP(s){return function(t){return t.test(s)}}function _v(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,n=e.split("[FBAN");typeof n[1]<"u"&&(e=n[0]),n=e.split("Twitter"),typeof n[1]<"u"&&(e=n[0]);var l=qP(e),h={apple:{phone:l(mf)&&!l(dn),ipod:l(nv),tablet:!l(mf)&&(l(sv)||pv(t))&&!l(dn),universal:l(av),device:(l(mf)||l(nv)||l(sv)||l(av)||pv(t))&&!l(dn)},amazon:{phone:l(Aa),tablet:!l(Aa)&&l(kh),device:l(Aa)||l(kh)},android:{phone:!l(dn)&&l(Aa)||!l(dn)&&l(yf),tablet:!l(dn)&&!l(Aa)&&!l(yf)&&(l(kh)||l(ov)),device:!l(dn)&&(l(Aa)||l(kh)||l(yf)||l(ov))||l(/\bokhttp\b/i)},windows:{phone:l(dn),tablet:l(lv),device:l(dn)||l(lv)},other:{blackberry:l(hv),blackberry10:l(uv),opera:l(cv),firefox:l(fv),chrome:l(dv),device:l(hv)||l(uv)||l(cv)||l(fv)||l(dv)},any:!1,phone:!1,tablet:!1};return h.any=h.apple.device||h.android.device||h.windows.device||h.other.device,h.phone=h.apple.phone||h.android.phone||h.windows.phone,h.tablet=h.apple.tablet||h.android.tablet||h.windows.tablet,h}const KP=_v.default??_v,Tn=KP(globalThis.navigator);wt.RETINA_PREFIX=/@([0-9\.]+)x/;wt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var kx={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function l(_,m,v){this.fn=_,this.context=m,this.once=v||!1}function h(_,m,v,w,x){if(typeof v!="function")throw new TypeError("The listener must be a function");var T=new l(v,w||_,x),r=e?e+m:m;return _._events[r]?_._events[r].fn?_._events[r]=[_._events[r],T]:_._events[r].push(T):(_._events[r]=T,_._eventsCount++),_}function d(_,m){--_._eventsCount===0?_._events=new n:delete _._events[m]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var m=[],v,w;if(this._eventsCount===0)return m;for(w in v=this._events)t.call(v,w)&&m.push(e?w.slice(1):w);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(v)):m},o.prototype.listeners=function(m){var v=e?e+m:m,w=this._events[v];if(!w)return[];if(w.fn)return[w.fn];for(var x=0,T=w.length,r=new Array(T);x<T;x++)r[x]=w[x].fn;return r},o.prototype.listenerCount=function(m){var v=e?e+m:m,w=this._events[v];return w?w.fn?1:w.length:0},o.prototype.emit=function(m,v,w,x,T,r){var a=e?e+m:m;if(!this._events[a])return!1;var u=this._events[a],f=arguments.length,g,b;if(u.fn){switch(u.once&&this.removeListener(m,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,v),!0;case 3:return u.fn.call(u.context,v,w),!0;case 4:return u.fn.call(u.context,v,w,x),!0;case 5:return u.fn.call(u.context,v,w,x,T),!0;case 6:return u.fn.call(u.context,v,w,x,T,r),!0}for(b=1,g=new Array(f-1);b<f;b++)g[b-1]=arguments[b];u.fn.apply(u.context,g)}else{var S=u.length,A;for(b=0;b<S;b++)switch(u[b].once&&this.removeListener(m,u[b].fn,void 0,!0),f){case 1:u[b].fn.call(u[b].context);break;case 2:u[b].fn.call(u[b].context,v);break;case 3:u[b].fn.call(u[b].context,v,w);break;case 4:u[b].fn.call(u[b].context,v,w,x);break;default:if(!g)for(A=1,g=new Array(f-1);A<f;A++)g[A-1]=arguments[A];u[b].fn.apply(u[b].context,g)}}return!0},o.prototype.on=function(m,v,w){return h(this,m,v,w,!1)},o.prototype.once=function(m,v,w){return h(this,m,v,w,!0)},o.prototype.removeListener=function(m,v,w,x){var T=e?e+m:m;if(!this._events[T])return this;if(!v)return d(this,T),this;var r=this._events[T];if(r.fn)r.fn===v&&(!x||r.once)&&(!w||r.context===w)&&d(this,T);else{for(var a=0,u=[],f=r.length;a<f;a++)(r[a].fn!==v||x&&!r[a].once||w&&r[a].context!==w)&&u.push(r[a]);u.length?this._events[T]=u.length===1?u[0]:u:d(this,T)}return this},o.prototype.removeAllListeners=function(m){var v;return m?(v=e?e+m:m,this._events[v]&&d(this,v)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})(kx);var ZP=kx.exports;const Gl=Cc(ZP);var X_={exports:{}};X_.exports=Rc;X_.exports.default=Rc;function Rc(s,t,e){e=e||2;var n=t&&t.length,l=n?t[0]*e:s.length,h=Ox(s,0,l,e,!0),d=[];if(!h||h.next===h.prev)return d;var o,_,m,v,w,x,T;if(n&&(h=iR(s,t,h,e)),s.length>80*e){o=m=s[0],_=v=s[1];for(var r=e;r<l;r+=e)w=s[r],x=s[r+1],w<o&&(o=w),x<_&&(_=x),w>m&&(m=w),x>v&&(v=x);T=Math.max(m-o,v-_),T=T!==0?32767/T:0}return Fl(h,d,e,o,_,T,0),d}function Ox(s,t,e,n,l){var h,d;if(l===zp(s,t,e,n)>0)for(h=t;h<e;h+=n)d=gv(h,s[h],s[h+1],d);else for(h=e-n;h>=t;h-=n)d=gv(h,s[h],s[h+1],d);return d&&Bc(d,d.next)&&(Ll(d),d=d.next),d}function ia(s,t){if(!s)return s;t||(t=s);var e=s,n;do if(n=!1,!e.steiner&&(Bc(e,e.next)||Pe(e.prev,e,e.next)===0)){if(Ll(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Fl(s,t,e,n,l,h,d){if(s){!d&&h&&oR(s,n,l,h);for(var o=s,_,m;s.prev!==s.next;){if(_=s.prev,m=s.next,h?QP(s,n,l,h):JP(s)){t.push(_.i/e|0),t.push(s.i/e|0),t.push(m.i/e|0),Ll(s),s=m.next,o=m.next;continue}if(s=m,s===o){d?d===1?(s=tR(ia(s),t,e),Fl(s,t,e,n,l,h,2)):d===2&&eR(s,t,e,n,l,h):Fl(ia(s),t,e,n,l,h,1);break}}}}function JP(s){var t=s.prev,e=s,n=s.next;if(Pe(t,e,n)>=0)return!1;for(var l=t.x,h=e.x,d=n.x,o=t.y,_=e.y,m=n.y,v=l<h?l<d?l:d:h<d?h:d,w=o<_?o<m?o:m:_<m?_:m,x=l>h?l>d?l:d:h>d?h:d,T=o>_?o>m?o:m:_>m?_:m,r=n.next;r!==t;){if(r.x>=v&&r.x<=x&&r.y>=w&&r.y<=T&&lo(l,o,h,_,d,m,r.x,r.y)&&Pe(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function QP(s,t,e,n){var l=s.prev,h=s,d=s.next;if(Pe(l,h,d)>=0)return!1;for(var o=l.x,_=h.x,m=d.x,v=l.y,w=h.y,x=d.y,T=o<_?o<m?o:m:_<m?_:m,r=v<w?v<x?v:x:w<x?w:x,a=o>_?o>m?o:m:_>m?_:m,u=v>w?v>x?v:x:w>x?w:x,f=Op(T,r,t,e,n),g=Op(a,u,t,e,n),b=s.prevZ,S=s.nextZ;b&&b.z>=f&&S&&S.z<=g;){if(b.x>=T&&b.x<=a&&b.y>=r&&b.y<=u&&b!==l&&b!==d&&lo(o,v,_,w,m,x,b.x,b.y)&&Pe(b.prev,b,b.next)>=0||(b=b.prevZ,S.x>=T&&S.x<=a&&S.y>=r&&S.y<=u&&S!==l&&S!==d&&lo(o,v,_,w,m,x,S.x,S.y)&&Pe(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;b&&b.z>=f;){if(b.x>=T&&b.x<=a&&b.y>=r&&b.y<=u&&b!==l&&b!==d&&lo(o,v,_,w,m,x,b.x,b.y)&&Pe(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;S&&S.z<=g;){if(S.x>=T&&S.x<=a&&S.y>=r&&S.y<=u&&S!==l&&S!==d&&lo(o,v,_,w,m,x,S.x,S.y)&&Pe(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function tR(s,t,e){var n=s;do{var l=n.prev,h=n.next.next;!Bc(l,h)&&Nx(l,n,n.next,h)&&Ml(l,h)&&Ml(h,l)&&(t.push(l.i/e|0),t.push(n.i/e|0),t.push(h.i/e|0),Ll(n),Ll(n.next),n=s=h),n=n.next}while(n!==s);return ia(n)}function eR(s,t,e,n,l,h){var d=s;do{for(var o=d.next.next;o!==d.prev;){if(d.i!==o.i&&uR(d,o)){var _=zx(d,o);d=ia(d,d.next),_=ia(_,_.next),Fl(d,t,e,n,l,h,0),Fl(_,t,e,n,l,h,0);return}o=o.next}d=d.next}while(d!==s)}function iR(s,t,e,n){var l=[],h,d,o,_,m;for(h=0,d=t.length;h<d;h++)o=t[h]*n,_=h<d-1?t[h+1]*n:s.length,m=Ox(s,o,_,n,!1),m===m.next&&(m.steiner=!0),l.push(hR(m));for(l.sort(rR),h=0;h<l.length;h++)e=nR(l[h],e);return e}function rR(s,t){return s.x-t.x}function nR(s,t){var e=sR(s,t);if(!e)return t;var n=zx(e,s);return ia(n,n.next),ia(e,e.next)}function sR(s,t){var e=t,n=s.x,l=s.y,h=-1/0,d;do{if(l<=e.y&&l>=e.next.y&&e.next.y!==e.y){var o=e.x+(l-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=n&&o>h&&(h=o,d=e.x<e.next.x?e:e.next,o===n))return d}e=e.next}while(e!==t);if(!d)return null;var _=d,m=d.x,v=d.y,w=1/0,x;e=d;do n>=e.x&&e.x>=m&&n!==e.x&&lo(l<v?n:h,l,m,v,l<v?h:n,l,e.x,e.y)&&(x=Math.abs(l-e.y)/(n-e.x),Ml(e,s)&&(x<w||x===w&&(e.x>d.x||e.x===d.x&&aR(d,e)))&&(d=e,w=x)),e=e.next;while(e!==_);return d}function aR(s,t){return Pe(s.prev,s,t.prev)<0&&Pe(t.next,s,s.next)<0}function oR(s,t,e,n){var l=s;do l.z===0&&(l.z=Op(l.x,l.y,t,e,n)),l.prevZ=l.prev,l.nextZ=l.next,l=l.next;while(l!==s);l.prevZ.nextZ=null,l.prevZ=null,lR(l)}function lR(s){var t,e,n,l,h,d,o,_,m=1;do{for(e=s,s=null,h=null,d=0;e;){for(d++,n=e,o=0,t=0;t<m&&(o++,n=n.nextZ,!!n);t++);for(_=m;o>0||_>0&&n;)o!==0&&(_===0||!n||e.z<=n.z)?(l=e,e=e.nextZ,o--):(l=n,n=n.nextZ,_--),h?h.nextZ=l:s=l,l.prevZ=h,h=l;e=n}h.nextZ=null,m*=2}while(d>1);return s}function Op(s,t,e,n,l){return s=(s-e)*l|0,t=(t-n)*l|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function hR(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function lo(s,t,e,n,l,h,d,o){return(l-d)*(t-o)>=(s-d)*(h-o)&&(s-d)*(n-o)>=(e-d)*(t-o)&&(e-d)*(h-o)>=(l-d)*(n-o)}function uR(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!cR(s,t)&&(Ml(s,t)&&Ml(t,s)&&dR(s,t)&&(Pe(s.prev,s,t.prev)||Pe(s,t.prev,t))||Bc(s,t)&&Pe(s.prev,s,s.next)>0&&Pe(t.prev,t,t.next)>0)}function Pe(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Bc(s,t){return s.x===t.x&&s.y===t.y}function Nx(s,t,e,n){var l=Nh(Pe(s,t,e)),h=Nh(Pe(s,t,n)),d=Nh(Pe(e,n,s)),o=Nh(Pe(e,n,t));return!!(l!==h&&d!==o||l===0&&Oh(s,e,t)||h===0&&Oh(s,n,t)||d===0&&Oh(e,s,n)||o===0&&Oh(e,t,n))}function Oh(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function Nh(s){return s>0?1:s<0?-1:0}function cR(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Nx(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Ml(s,t){return Pe(s.prev,s,s.next)<0?Pe(s,t,s.next)>=0&&Pe(s,s.prev,t)>=0:Pe(s,t,s.prev)<0||Pe(s,s.next,t)<0}function dR(s,t){var e=s,n=!1,l=(s.x+t.x)/2,h=(s.y+t.y)/2;do e.y>h!=e.next.y>h&&e.next.y!==e.y&&l<(e.next.x-e.x)*(h-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==s);return n}function zx(s,t){var e=new Np(s.i,s.x,s.y),n=new Np(t.i,t.x,t.y),l=s.next,h=t.prev;return s.next=t,t.prev=s,e.next=l,l.prev=e,n.next=e,e.prev=n,h.next=n,n.prev=h,n}function gv(s,t,e,n){var l=new Np(s,t,e);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function Ll(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Np(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Rc.deviation=function(s,t,e,n){var l=t&&t.length,h=l?t[0]*e:s.length,d=Math.abs(zp(s,0,h,e));if(l)for(var o=0,_=t.length;o<_;o++){var m=t[o]*e,v=o<_-1?t[o+1]*e:s.length;d-=Math.abs(zp(s,m,v,e))}var w=0;for(o=0;o<n.length;o+=3){var x=n[o]*e,T=n[o+1]*e,r=n[o+2]*e;w+=Math.abs((s[x]-s[r])*(s[T+1]-s[x+1])-(s[x]-s[T])*(s[r+1]-s[x+1]))}return d===0&&w===0?0:Math.abs((w-d)/d)};function zp(s,t,e,n){for(var l=0,h=t,d=e-n;h<e;h+=n)l+=(s[d]-s[h])*(s[h+1]+s[d+1]),d=h;return l}Rc.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,l=0;l<s.length;l++){for(var h=0;h<s[l].length;h++)for(var d=0;d<t;d++)e.vertices.push(s[l][h][d]);l>0&&(n+=s[l-1].length,e.holes.push(n))}return e};var fR=X_.exports;const pR=Cc(fR);var oc={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */oc.exports;(function(s,t){(function(e){var n=t&&!t.nodeType&&t,l=!s.nodeType&&s,h=typeof qr=="object"&&qr;(h.global===h||h.window===h||h.self===h)&&(e=h);var d,o=2147483647,_=36,m=1,v=26,w=38,x=700,T=72,r=128,a="-",u=/^xn--/,f=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=_-m,A=Math.floor,C=String.fromCharCode,B;function R(rt){throw new RangeError(b[rt])}function M(rt,Z){for(var H=rt.length,G=[];H--;)G[H]=Z(rt[H]);return G}function N(rt,Z){var H=rt.split("@"),G="";H.length>1&&(G=H[0]+"@",rt=H[1]),rt=rt.replace(g,".");var at=rt.split("."),vt=M(at,Z).join(".");return G+vt}function L(rt){for(var Z=[],H=0,G=rt.length,at,vt;H<G;)at=rt.charCodeAt(H++),at>=55296&&at<=56319&&H<G?(vt=rt.charCodeAt(H++),(vt&64512)==56320?Z.push(((at&1023)<<10)+(vt&1023)+65536):(Z.push(at),H--)):Z.push(at);return Z}function W(rt){return M(rt,function(Z){var H="";return Z>65535&&(Z-=65536,H+=C(Z>>>10&1023|55296),Z=56320|Z&1023),H+=C(Z),H}).join("")}function k(rt){return rt-48<10?rt-22:rt-65<26?rt-65:rt-97<26?rt-97:_}function j(rt,Z){return rt+22+75*(rt<26)-((Z!=0)<<5)}function Y(rt,Z,H){var G=0;for(rt=H?A(rt/x):rt>>1,rt+=A(rt/Z);rt>S*v>>1;G+=_)rt=A(rt/S);return A(G+(S+1)*rt/(rt+w))}function ut(rt){var Z=[],H=rt.length,G,at=0,vt=r,At=T,kt,ht,q,nt,dt,Xt,Ot,Nt,Lt;for(kt=rt.lastIndexOf(a),kt<0&&(kt=0),ht=0;ht<kt;++ht)rt.charCodeAt(ht)>=128&&R("not-basic"),Z.push(rt.charCodeAt(ht));for(q=kt>0?kt+1:0;q<H;){for(nt=at,dt=1,Xt=_;q>=H&&R("invalid-input"),Ot=k(rt.charCodeAt(q++)),(Ot>=_||Ot>A((o-at)/dt))&&R("overflow"),at+=Ot*dt,Nt=Xt<=At?m:Xt>=At+v?v:Xt-At,!(Ot<Nt);Xt+=_)Lt=_-Nt,dt>A(o/Lt)&&R("overflow"),dt*=Lt;G=Z.length+1,At=Y(at-nt,G,nt==0),A(at/G)>o-vt&&R("overflow"),vt+=A(at/G),at%=G,Z.splice(at++,0,vt)}return W(Z)}function it(rt){var Z,H,G,at,vt,At,kt,ht,q,nt,dt,Xt=[],Ot,Nt,Lt,ce;for(rt=L(rt),Ot=rt.length,Z=r,H=0,vt=T,At=0;At<Ot;++At)dt=rt[At],dt<128&&Xt.push(C(dt));for(G=at=Xt.length,at&&Xt.push(a);G<Ot;){for(kt=o,At=0;At<Ot;++At)dt=rt[At],dt>=Z&&dt<kt&&(kt=dt);for(Nt=G+1,kt-Z>A((o-H)/Nt)&&R("overflow"),H+=(kt-Z)*Nt,Z=kt,At=0;At<Ot;++At)if(dt=rt[At],dt<Z&&++H>o&&R("overflow"),dt==Z){for(ht=H,q=_;nt=q<=vt?m:q>=vt+v?v:q-vt,!(ht<nt);q+=_)ce=ht-nt,Lt=_-nt,Xt.push(C(j(nt+ce%Lt,0))),ht=A(ce/Lt);Xt.push(C(j(ht,0))),vt=Y(H,Nt,G==at),H=0,++G}++H,++Z}return Xt.join("")}function gt(rt){return N(rt,function(Z){return u.test(Z)?ut(Z.slice(4).toLowerCase()):Z})}function Q(rt){return N(rt,function(Z){return f.test(Z)?"xn--"+it(Z):Z})}if(d={version:"1.4.1",ucs2:{decode:L,encode:W},decode:ut,encode:it,toASCII:Q,toUnicode:gt},n&&l)if(s.exports==n)l.exports=d;else for(B in d)d.hasOwnProperty(B)&&(n[B]=d[B]);else e.punycode=d})(qr)})(oc,oc.exports);var _R=oc.exports,Po=TypeError;const gR={},mR=Object.freeze(Object.defineProperty({__proto__:null,default:gR},Symbol.toStringTag,{value:"Module"})),yR=iI(mR);var Y_=typeof Map=="function"&&Map.prototype,vf=Object.getOwnPropertyDescriptor&&Y_?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,lc=Y_&&vf&&typeof vf.get=="function"?vf.get:null,mv=Y_&&Map.prototype.forEach,j_=typeof Set=="function"&&Set.prototype,xf=Object.getOwnPropertyDescriptor&&j_?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,hc=j_&&xf&&typeof xf.get=="function"?xf.get:null,yv=j_&&Set.prototype.forEach,vR=typeof WeakMap=="function"&&WeakMap.prototype,Tl=vR?WeakMap.prototype.has:null,xR=typeof WeakSet=="function"&&WeakSet.prototype,Al=xR?WeakSet.prototype.has:null,bR=typeof WeakRef=="function"&&WeakRef.prototype,vv=bR?WeakRef.prototype.deref:null,wR=Boolean.prototype.valueOf,SR=Object.prototype.toString,ER=Function.prototype.toString,TR=String.prototype.match,q_=String.prototype.slice,rs=String.prototype.replace,AR=String.prototype.toUpperCase,xv=String.prototype.toLowerCase,Gx=RegExp.prototype.test,bv=Array.prototype.concat,jr=Array.prototype.join,CR=Array.prototype.slice,wv=Math.floor,Gp=typeof BigInt=="function"?BigInt.prototype.valueOf:null,bf=Object.getOwnPropertySymbols,Hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="object",_i=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ao||!0)?Symbol.toStringTag:null,Hx=Object.prototype.propertyIsEnumerable,Sv=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(s){return s.__proto__}:null);function Ev(s,t){if(s===1/0||s===-1/0||s!==s||s&&s>-1e3&&s<1e3||Gx.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof s=="number"){var n=s<0?-wv(-s):wv(s);if(n!==s){var l=String(n),h=q_.call(t,l.length+1);return rs.call(l,e,"$&_")+"."+rs.call(rs.call(h,/([0-9]{3})/g,"$&_"),/_$/,"")}}return rs.call(t,e,"$&_")}var $p=yR,Tv=$p.custom,Av=Wx(Tv)?Tv:null,$x={__proto__:null,double:'"',single:"'"},UR={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Fc=function s(t,e,n,l){var h=e||{};if(wn(h,"quoteStyle")&&!wn($x,h.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(wn(h,"maxStringLength")&&(typeof h.maxStringLength=="number"?h.maxStringLength<0&&h.maxStringLength!==1/0:h.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var d=wn(h,"customInspect")?h.customInspect:!0;if(typeof d!="boolean"&&d!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(wn(h,"indent")&&h.indent!==null&&h.indent!=="	"&&!(parseInt(h.indent,10)===h.indent&&h.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(wn(h,"numericSeparator")&&typeof h.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var o=h.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Yx(t,h);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var _=String(t);return o?Ev(t,_):_}if(typeof t=="bigint"){var m=String(t)+"n";return o?Ev(t,m):m}var v=typeof h.depth>"u"?5:h.depth;if(typeof n>"u"&&(n=0),n>=v&&v>0&&typeof t=="object")return Vp(t)?"[Array]":"[Object]";var w=XR(h,n);if(typeof l>"u")l=[];else if(Xx(l,t)>=0)return"[Circular]";function x(k,j,Y){if(j&&(l=CR.call(l),l.push(j)),Y){var ut={depth:h.depth};return wn(h,"quoteStyle")&&(ut.quoteStyle=h.quoteStyle),s(k,ut,n+1,l)}return s(k,h,n+1,l)}if(typeof t=="function"&&!Cv(t)){var T=kR(t),r=zh(t,x);return"[Function"+(T?": "+T:" (anonymous)")+"]"+(r.length>0?" { "+jr.call(r,", ")+" }":"")}if(Wx(t)){var a=Ao?rs.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Hp.call(t);return typeof t=="object"&&!Ao?el(a):a}if($R(t)){for(var u="<"+xv.call(String(t.nodeName)),f=t.attributes||[],g=0;g<f.length;g++)u+=" "+f[g].name+"="+Vx(IR(f[g].value),"double",h);return u+=">",t.childNodes&&t.childNodes.length&&(u+="..."),u+="</"+xv.call(String(t.nodeName))+">",u}if(Vp(t)){if(t.length===0)return"[]";var b=zh(t,x);return w&&!WR(b)?"["+Wp(b,w)+"]":"[ "+jr.call(b,", ")+" ]"}if(RR(t)){var S=zh(t,x);return!("cause"in Error.prototype)&&"cause"in t&&!Hx.call(t,"cause")?"{ ["+String(t)+"] "+jr.call(bv.call("[cause]: "+x(t.cause),S),", ")+" }":S.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+jr.call(S,", ")+" }"}if(typeof t=="object"&&d){if(Av&&typeof t[Av]=="function"&&$p)return $p(t,{depth:v-n});if(d!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(OR(t)){var A=[];return mv&&mv.call(t,function(k,j){A.push(x(j,t,!0)+" => "+x(k,t))}),Uv("Map",lc.call(t),A,w)}if(GR(t)){var C=[];return yv&&yv.call(t,function(k){C.push(x(k,t))}),Uv("Set",hc.call(t),C,w)}if(NR(t))return wf("WeakMap");if(HR(t))return wf("WeakSet");if(zR(t))return wf("WeakRef");if(FR(t))return el(x(Number(t)));if(LR(t))return el(x(Gp.call(t)));if(MR(t))return el(wR.call(t));if(BR(t))return el(x(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof qr<"u"&&t===qr)return"{ [object globalThis] }";if(!PR(t)&&!Cv(t)){var B=zh(t,x),R=Sv?Sv(t)===Object.prototype:t instanceof Object||t.constructor===Object,M=t instanceof Object?"":"null prototype",N=!R&&_i&&Object(t)===t&&_i in t?q_.call(cs(t),8,-1):M?"Object":"",L=R||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",W=L+(N||M?"["+jr.call(bv.call([],N||[],M||[]),": ")+"] ":"");return B.length===0?W+"{}":w?W+"{"+Wp(B,w)+"}":W+"{ "+jr.call(B,", ")+" }"}return String(t)};function Vx(s,t,e){var n=e.quoteStyle||t,l=$x[n];return l+s+l}function IR(s){return rs.call(String(s),/"/g,"&quot;")}function Vp(s){return cs(s)==="[object Array]"&&(!_i||!(typeof s=="object"&&_i in s))}function PR(s){return cs(s)==="[object Date]"&&(!_i||!(typeof s=="object"&&_i in s))}function Cv(s){return cs(s)==="[object RegExp]"&&(!_i||!(typeof s=="object"&&_i in s))}function RR(s){return cs(s)==="[object Error]"&&(!_i||!(typeof s=="object"&&_i in s))}function BR(s){return cs(s)==="[object String]"&&(!_i||!(typeof s=="object"&&_i in s))}function FR(s){return cs(s)==="[object Number]"&&(!_i||!(typeof s=="object"&&_i in s))}function MR(s){return cs(s)==="[object Boolean]"&&(!_i||!(typeof s=="object"&&_i in s))}function Wx(s){if(Ao)return s&&typeof s=="object"&&s instanceof Symbol;if(typeof s=="symbol")return!0;if(!s||typeof s!="object"||!Hp)return!1;try{return Hp.call(s),!0}catch{}return!1}function LR(s){if(!s||typeof s!="object"||!Gp)return!1;try{return Gp.call(s),!0}catch{}return!1}var DR=Object.prototype.hasOwnProperty||function(s){return s in this};function wn(s,t){return DR.call(s,t)}function cs(s){return SR.call(s)}function kR(s){if(s.name)return s.name;var t=TR.call(ER.call(s),/^function\s*([\w$]+)/);return t?t[1]:null}function Xx(s,t){if(s.indexOf)return s.indexOf(t);for(var e=0,n=s.length;e<n;e++)if(s[e]===t)return e;return-1}function OR(s){if(!lc||!s||typeof s!="object")return!1;try{lc.call(s);try{hc.call(s)}catch{return!0}return s instanceof Map}catch{}return!1}function NR(s){if(!Tl||!s||typeof s!="object")return!1;try{Tl.call(s,Tl);try{Al.call(s,Al)}catch{return!0}return s instanceof WeakMap}catch{}return!1}function zR(s){if(!vv||!s||typeof s!="object")return!1;try{return vv.call(s),!0}catch{}return!1}function GR(s){if(!hc||!s||typeof s!="object")return!1;try{hc.call(s);try{lc.call(s)}catch{return!0}return s instanceof Set}catch{}return!1}function HR(s){if(!Al||!s||typeof s!="object")return!1;try{Al.call(s,Al);try{Tl.call(s,Tl)}catch{return!0}return s instanceof WeakSet}catch{}return!1}function $R(s){return!s||typeof s!="object"?!1:typeof HTMLElement<"u"&&s instanceof HTMLElement?!0:typeof s.nodeName=="string"&&typeof s.getAttribute=="function"}function Yx(s,t){if(s.length>t.maxStringLength){var e=s.length-t.maxStringLength,n="... "+e+" more character"+(e>1?"s":"");return Yx(q_.call(s,0,t.maxStringLength),t)+n}var l=UR[t.quoteStyle||"single"];l.lastIndex=0;var h=rs.call(rs.call(s,l,"\\$1"),/[\x00-\x1f]/g,VR);return Vx(h,"single",t)}function VR(s){var t=s.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+AR.call(t.toString(16))}function el(s){return"Object("+s+")"}function wf(s){return s+" { ? }"}function Uv(s,t,e,n){var l=n?Wp(e,n):jr.call(e,", ");return s+" ("+t+") {"+l+"}"}function WR(s){for(var t=0;t<s.length;t++)if(Xx(s[t],`
`)>=0)return!1;return!0}function XR(s,t){var e;if(s.indent==="	")e="	";else if(typeof s.indent=="number"&&s.indent>0)e=jr.call(Array(s.indent+1)," ");else return null;return{base:e,prev:jr.call(Array(t+1),e)}}function Wp(s,t){if(s.length===0)return"";var e=`
`+t.prev+t.base;return e+jr.call(s,","+e)+`
`+t.prev}function zh(s,t){var e=Vp(s),n=[];if(e){n.length=s.length;for(var l=0;l<s.length;l++)n[l]=wn(s,l)?t(s[l],s):""}var h=typeof bf=="function"?bf(s):[],d;if(Ao){d={};for(var o=0;o<h.length;o++)d["$"+h[o]]=h[o]}for(var _ in s)wn(s,_)&&(e&&String(Number(_))===_&&_<s.length||Ao&&d["$"+_]instanceof Symbol||(Gx.call(/[^\w$]/,_)?n.push(t(_,s)+": "+t(s[_],s)):n.push(_+": "+t(s[_],s))));if(typeof bf=="function")for(var m=0;m<h.length;m++)Hx.call(s,h[m])&&n.push("["+t(h[m])+"]: "+t(s[h[m]],s));return n}var YR=Fc,jR=Po,Mc=function(s,t,e){for(var n=s,l;(l=n.next)!=null;n=l)if(l.key===t)return n.next=l.next,e||(l.next=s.next,s.next=l),l},qR=function(s,t){if(s){var e=Mc(s,t);return e&&e.value}},KR=function(s,t,e){var n=Mc(s,t);n?n.value=e:s.next={key:t,next:s.next,value:e}},ZR=function(s,t){return s?!!Mc(s,t):!1},JR=function(s,t){if(s)return Mc(s,t,!0)},QR=function(){var t,e={assert:function(n){if(!e.has(n))throw new jR("Side channel does not contain "+YR(n))},delete:function(n){var l=t&&t.next,h=JR(t,n);return h&&l&&l===h&&(t=void 0),!!h},get:function(n){return qR(t,n)},has:function(n){return ZR(t,n)},set:function(n,l){t||(t={next:void 0}),KR(t,n,l)}};return e},jx=Object,tB=Error,eB=EvalError,iB=RangeError,rB=ReferenceError,nB=SyntaxError,sB=URIError,aB=Math.abs,oB=Math.floor,lB=Math.max,hB=Math.min,uB=Math.pow,cB=Math.round,dB=Number.isNaN||function(t){return t!==t},fB=dB,pB=function(t){return fB(t)||t===0?t:t<0?-1:1},_B=Object.getOwnPropertyDescriptor,Nu=_B;if(Nu)try{Nu([],"length")}catch{Nu=null}var qx=Nu,zu=Object.defineProperty||!1;if(zu)try{zu({},"a",{value:1})}catch{zu=!1}var gB=zu,Sf,Iv;function mB(){return Iv||(Iv=1,Sf=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),n=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var l=42;t[e]=l;for(var h in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var d=Object.getOwnPropertySymbols(t);if(d.length!==1||d[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==l||o.enumerable!==!0)return!1}return!0}),Sf}var Ef,Pv;function yB(){if(Pv)return Ef;Pv=1;var s=typeof Symbol<"u"&&Symbol,t=mB();return Ef=function(){return typeof s!="function"||typeof Symbol!="function"||typeof s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Ef}var Tf,Rv;function Kx(){return Rv||(Rv=1,Tf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Tf}var Af,Bv;function Zx(){if(Bv)return Af;Bv=1;var s=jx;return Af=s.getPrototypeOf||null,Af}var Cf,Fv;function vB(){if(Fv)return Cf;Fv=1;var s="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,n="[object Function]",l=function(_,m){for(var v=[],w=0;w<_.length;w+=1)v[w]=_[w];for(var x=0;x<m.length;x+=1)v[x+_.length]=m[x];return v},h=function(_,m){for(var v=[],w=m,x=0;w<_.length;w+=1,x+=1)v[x]=_[w];return v},d=function(o,_){for(var m="",v=0;v<o.length;v+=1)m+=o[v],v+1<o.length&&(m+=_);return m};return Cf=function(_){var m=this;if(typeof m!="function"||t.apply(m)!==n)throw new TypeError(s+m);for(var v=h(arguments,1),w,x=function(){if(this instanceof w){var f=m.apply(this,l(v,arguments));return Object(f)===f?f:this}return m.apply(_,l(v,arguments))},T=e(0,m.length-v.length),r=[],a=0;a<T;a++)r[a]="$"+a;if(w=Function("binder","return function ("+d(r,",")+"){ return binder.apply(this,arguments); }")(x),m.prototype){var u=function(){};u.prototype=m.prototype,w.prototype=new u,u.prototype=null}return w},Cf}var Uf,Mv;function Lc(){if(Mv)return Uf;Mv=1;var s=vB();return Uf=Function.prototype.bind||s,Uf}var If,Lv;function K_(){return Lv||(Lv=1,If=Function.prototype.call),If}var Pf,Dv;function Jx(){return Dv||(Dv=1,Pf=Function.prototype.apply),Pf}var xB=typeof Reflect<"u"&&Reflect&&Reflect.apply,bB=Lc(),wB=Jx(),SB=K_(),EB=xB,TB=EB||bB.call(SB,wB),AB=Lc(),CB=Po,UB=K_(),IB=TB,Qx=function(t){if(t.length<1||typeof t[0]!="function")throw new CB("a function is required");return IB(AB,UB,t)},Rf,kv;function PB(){if(kv)return Rf;kv=1;var s=Qx,t=qx,e;try{e=[].__proto__===Array.prototype}catch(d){if(!d||typeof d!="object"||!("code"in d)||d.code!=="ERR_PROTO_ACCESS")throw d}var n=!!e&&t&&t(Object.prototype,"__proto__"),l=Object,h=l.getPrototypeOf;return Rf=n&&typeof n.get=="function"?s([n.get]):typeof h=="function"?function(o){return h(o==null?o:l(o))}:!1,Rf}var Bf,Ov;function RB(){if(Ov)return Bf;Ov=1;var s=Kx(),t=Zx(),e=PB();return Bf=s?function(l){return s(l)}:t?function(l){if(!l||typeof l!="object"&&typeof l!="function")throw new TypeError("getProto: not an object");return t(l)}:e?function(l){return e(l)}:null,Bf}var Ff,Nv;function BB(){if(Nv)return Ff;Nv=1;var s=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Lc();return Ff=e.call(s,t),Ff}var oe,FB=jx,MB=tB,LB=eB,DB=iB,kB=rB,Co=nB,po=Po,OB=sB,NB=aB,zB=oB,GB=lB,HB=hB,$B=uB,VB=cB,WB=pB,tb=Function,Mf=function(s){try{return tb('"use strict"; return ('+s+").constructor;")()}catch{}},Dl=qx,XB=gB,Lf=function(){throw new po},YB=Dl?function(){try{return arguments.callee,Lf}catch{try{return Dl(arguments,"callee").get}catch{return Lf}}}():Lf,Ca=yB()(),Qe=RB(),jB=Zx(),qB=Kx(),eb=Jx(),Hl=K_(),Ka={},KB=typeof Uint8Array>"u"||!Qe?oe:Qe(Uint8Array),Js={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?oe:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?oe:ArrayBuffer,"%ArrayIteratorPrototype%":Ca&&Qe?Qe([][Symbol.iterator]()):oe,"%AsyncFromSyncIteratorPrototype%":oe,"%AsyncFunction%":Ka,"%AsyncGenerator%":Ka,"%AsyncGeneratorFunction%":Ka,"%AsyncIteratorPrototype%":Ka,"%Atomics%":typeof Atomics>"u"?oe:Atomics,"%BigInt%":typeof BigInt>"u"?oe:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?oe:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?oe:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?oe:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":MB,"%eval%":eval,"%EvalError%":LB,"%Float32Array%":typeof Float32Array>"u"?oe:Float32Array,"%Float64Array%":typeof Float64Array>"u"?oe:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?oe:FinalizationRegistry,"%Function%":tb,"%GeneratorFunction%":Ka,"%Int8Array%":typeof Int8Array>"u"?oe:Int8Array,"%Int16Array%":typeof Int16Array>"u"?oe:Int16Array,"%Int32Array%":typeof Int32Array>"u"?oe:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ca&&Qe?Qe(Qe([][Symbol.iterator]())):oe,"%JSON%":typeof JSON=="object"?JSON:oe,"%Map%":typeof Map>"u"?oe:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ca||!Qe?oe:Qe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":FB,"%Object.getOwnPropertyDescriptor%":Dl,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?oe:Promise,"%Proxy%":typeof Proxy>"u"?oe:Proxy,"%RangeError%":DB,"%ReferenceError%":kB,"%Reflect%":typeof Reflect>"u"?oe:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?oe:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ca||!Qe?oe:Qe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?oe:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ca&&Qe?Qe(""[Symbol.iterator]()):oe,"%Symbol%":Ca?Symbol:oe,"%SyntaxError%":Co,"%ThrowTypeError%":YB,"%TypedArray%":KB,"%TypeError%":po,"%Uint8Array%":typeof Uint8Array>"u"?oe:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?oe:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?oe:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?oe:Uint32Array,"%URIError%":OB,"%WeakMap%":typeof WeakMap>"u"?oe:WeakMap,"%WeakRef%":typeof WeakRef>"u"?oe:WeakRef,"%WeakSet%":typeof WeakSet>"u"?oe:WeakSet,"%Function.prototype.call%":Hl,"%Function.prototype.apply%":eb,"%Object.defineProperty%":XB,"%Object.getPrototypeOf%":jB,"%Math.abs%":NB,"%Math.floor%":zB,"%Math.max%":GB,"%Math.min%":HB,"%Math.pow%":$B,"%Math.round%":VB,"%Math.sign%":WB,"%Reflect.getPrototypeOf%":qB};if(Qe)try{null.error}catch(s){var ZB=Qe(Qe(s));Js["%Error.prototype%"]=ZB}var JB=function s(t){var e;if(t==="%AsyncFunction%")e=Mf("async function () {}");else if(t==="%GeneratorFunction%")e=Mf("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Mf("async function* () {}");else if(t==="%AsyncGenerator%"){var n=s("%AsyncGeneratorFunction%");n&&(e=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var l=s("%AsyncGenerator%");l&&Qe&&(e=Qe(l.prototype))}return Js[t]=e,e},zv={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$l=Lc(),uc=BB(),QB=$l.call(Hl,Array.prototype.concat),tF=$l.call(eb,Array.prototype.splice),Gv=$l.call(Hl,String.prototype.replace),cc=$l.call(Hl,String.prototype.slice),eF=$l.call(Hl,RegExp.prototype.exec),iF=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,rF=/\\(\\)?/g,nF=function(t){var e=cc(t,0,1),n=cc(t,-1);if(e==="%"&&n!=="%")throw new Co("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&e!=="%")throw new Co("invalid intrinsic syntax, expected opening `%`");var l=[];return Gv(t,iF,function(h,d,o,_){l[l.length]=o?Gv(_,rF,"$1"):d||h}),l},sF=function(t,e){var n=t,l;if(uc(zv,n)&&(l=zv[n],n="%"+l[0]+"%"),uc(Js,n)){var h=Js[n];if(h===Ka&&(h=JB(n)),typeof h>"u"&&!e)throw new po("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:l,name:n,value:h}}throw new Co("intrinsic "+t+" does not exist!")},Z_=function(t,e){if(typeof t!="string"||t.length===0)throw new po("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new po('"allowMissing" argument must be a boolean');if(eF(/^%?[^%]*%?$/,t)===null)throw new Co("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=nF(t),l=n.length>0?n[0]:"",h=sF("%"+l+"%",e),d=h.name,o=h.value,_=!1,m=h.alias;m&&(l=m[0],tF(n,QB([0,1],m)));for(var v=1,w=!0;v<n.length;v+=1){var x=n[v],T=cc(x,0,1),r=cc(x,-1);if((T==='"'||T==="'"||T==="`"||r==='"'||r==="'"||r==="`")&&T!==r)throw new Co("property names with quotes must have matching quotes");if((x==="constructor"||!w)&&(_=!0),l+="."+x,d="%"+l+"%",uc(Js,d))o=Js[d];else if(o!=null){if(!(x in o)){if(!e)throw new po("base intrinsic for "+t+" exists, but the property is not available.");return}if(Dl&&v+1>=n.length){var a=Dl(o,x);w=!!a,w&&"get"in a&&!("originalValue"in a.get)?o=a.get:o=o[x]}else w=uc(o,x),o=o[x];w&&!_&&(Js[d]=o)}}return o},ib=Z_,rb=Qx,aF=rb([ib("%String.prototype.indexOf%")]),nb=function(t,e){var n=ib(t,!!e);return typeof n=="function"&&aF(t,".prototype.")>-1?rb([n]):n},oF=Z_,Vl=nb,lF=Fc,hF=Po,Hv=oF("%Map%",!0),uF=Vl("Map.prototype.get",!0),cF=Vl("Map.prototype.set",!0),dF=Vl("Map.prototype.has",!0),fF=Vl("Map.prototype.delete",!0),pF=Vl("Map.prototype.size",!0),sb=!!Hv&&function(){var t,e={assert:function(n){if(!e.has(n))throw new hF("Side channel does not contain "+lF(n))},delete:function(n){if(t){var l=fF(t,n);return pF(t)===0&&(t=void 0),l}return!1},get:function(n){if(t)return uF(t,n)},has:function(n){return t?dF(t,n):!1},set:function(n,l){t||(t=new Hv),cF(t,n,l)}};return e},_F=Z_,Dc=nb,gF=Fc,Gh=sb,mF=Po,Ua=_F("%WeakMap%",!0),yF=Dc("WeakMap.prototype.get",!0),vF=Dc("WeakMap.prototype.set",!0),xF=Dc("WeakMap.prototype.has",!0),bF=Dc("WeakMap.prototype.delete",!0),wF=Ua?function(){var t,e,n={assert:function(l){if(!n.has(l))throw new mF("Side channel does not contain "+gF(l))},delete:function(l){if(Ua&&l&&(typeof l=="object"||typeof l=="function")){if(t)return bF(t,l)}else if(Gh&&e)return e.delete(l);return!1},get:function(l){return Ua&&l&&(typeof l=="object"||typeof l=="function")&&t?yF(t,l):e&&e.get(l)},has:function(l){return Ua&&l&&(typeof l=="object"||typeof l=="function")&&t?xF(t,l):!!e&&e.has(l)},set:function(l,h){Ua&&l&&(typeof l=="object"||typeof l=="function")?(t||(t=new Ua),vF(t,l,h)):Gh&&(e||(e=Gh()),e.set(l,h))}};return n}:Gh,SF=Po,EF=Fc,TF=QR,AF=sb,CF=wF,UF=CF||AF||TF,IF=function(){var t,e={assert:function(n){if(!e.has(n))throw new SF("Side channel does not contain "+EF(n))},delete:function(n){return!!t&&t.delete(n)},get:function(n){return t&&t.get(n)},has:function(n){return!!t&&t.has(n)},set:function(n,l){t||(t=UF()),t.set(n,l)}};return e},PF=String.prototype.replace,RF=/%20/g,Df={RFC1738:"RFC1738",RFC3986:"RFC3986"},J_={default:Df.RFC3986,formatters:{RFC1738:function(s){return PF.call(s,RF,"+")},RFC3986:function(s){return String(s)}},RFC1738:Df.RFC1738,RFC3986:Df.RFC3986},BF=J_,kf=Object.prototype.hasOwnProperty,Xs=Array.isArray,Lr=function(){for(var s=[],t=0;t<256;++t)s.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return s}(),FF=function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(Xs(n)){for(var l=[],h=0;h<n.length;++h)typeof n[h]<"u"&&l.push(n[h]);e.obj[e.prop]=l}}},ab=function(t,e){for(var n=e&&e.plainObjects?{__proto__:null}:{},l=0;l<t.length;++l)typeof t[l]<"u"&&(n[l]=t[l]);return n},MF=function s(t,e,n){if(!e)return t;if(typeof e!="object"&&typeof e!="function"){if(Xs(t))t.push(e);else if(t&&typeof t=="object")(n&&(n.plainObjects||n.allowPrototypes)||!kf.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var l=t;return Xs(t)&&!Xs(e)&&(l=ab(t,n)),Xs(t)&&Xs(e)?(e.forEach(function(h,d){if(kf.call(t,d)){var o=t[d];o&&typeof o=="object"&&h&&typeof h=="object"?t[d]=s(o,h,n):t.push(h)}else t[d]=h}),t):Object.keys(e).reduce(function(h,d){var o=e[d];return kf.call(h,d)?h[d]=s(h[d],o,n):h[d]=o,h},l)},LF=function(t,e){return Object.keys(e).reduce(function(n,l){return n[l]=e[l],n},t)},DF=function(s,t,e){var n=s.replace(/\+/g," ");if(e==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},Of=1024,kF=function(t,e,n,l,h){if(t.length===0)return t;var d=t;if(typeof t=="symbol"?d=Symbol.prototype.toString.call(t):typeof t!="string"&&(d=String(t)),n==="iso-8859-1")return escape(d).replace(/%u[0-9a-f]{4}/gi,function(T){return"%26%23"+parseInt(T.slice(2),16)+"%3B"});for(var o="",_=0;_<d.length;_+=Of){for(var m=d.length>=Of?d.slice(_,_+Of):d,v=[],w=0;w<m.length;++w){var x=m.charCodeAt(w);if(x===45||x===46||x===95||x===126||x>=48&&x<=57||x>=65&&x<=90||x>=97&&x<=122||h===BF.RFC1738&&(x===40||x===41)){v[v.length]=m.charAt(w);continue}if(x<128){v[v.length]=Lr[x];continue}if(x<2048){v[v.length]=Lr[192|x>>6]+Lr[128|x&63];continue}if(x<55296||x>=57344){v[v.length]=Lr[224|x>>12]+Lr[128|x>>6&63]+Lr[128|x&63];continue}w+=1,x=65536+((x&1023)<<10|m.charCodeAt(w)&1023),v[v.length]=Lr[240|x>>18]+Lr[128|x>>12&63]+Lr[128|x>>6&63]+Lr[128|x&63]}o+=v.join("")}return o},OF=function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],l=0;l<e.length;++l)for(var h=e[l],d=h.obj[h.prop],o=Object.keys(d),_=0;_<o.length;++_){var m=o[_],v=d[m];typeof v=="object"&&v!==null&&n.indexOf(v)===-1&&(e.push({obj:d,prop:m}),n.push(v))}return FF(e),t},NF=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},zF=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},GF=function(t,e){return[].concat(t,e)},HF=function(t,e){if(Xs(t)){for(var n=[],l=0;l<t.length;l+=1)n.push(e(t[l]));return n}return e(t)},ob={arrayToObject:ab,assign:LF,combine:GF,compact:OF,decode:DF,encode:kF,isBuffer:zF,isRegExp:NF,maybeMap:HF,merge:MF},lb=IF,Gu=ob,Cl=J_,$F=Object.prototype.hasOwnProperty,hb={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Wr=Array.isArray,VF=Array.prototype.push,ub=function(s,t){VF.apply(s,Wr(t)?t:[t])},WF=Date.prototype.toISOString,$v=Cl.default,Xe={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Gu.encode,encodeValuesOnly:!1,filter:void 0,format:$v,formatter:Cl.formatters[$v],indices:!1,serializeDate:function(t){return WF.call(t)},skipNulls:!1,strictNullHandling:!1},XF=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Nf={},YF=function s(t,e,n,l,h,d,o,_,m,v,w,x,T,r,a,u,f,g){for(var b=t,S=g,A=0,C=!1;(S=S.get(Nf))!==void 0&&!C;){var B=S.get(t);if(A+=1,typeof B<"u"){if(B===A)throw new RangeError("Cyclic object value");C=!0}typeof S.get(Nf)>"u"&&(A=0)}if(typeof v=="function"?b=v(e,b):b instanceof Date?b=T(b):n==="comma"&&Wr(b)&&(b=Gu.maybeMap(b,function(rt){return rt instanceof Date?T(rt):rt})),b===null){if(d)return m&&!u?m(e,Xe.encoder,f,"key",r):e;b=""}if(XF(b)||Gu.isBuffer(b)){if(m){var R=u?e:m(e,Xe.encoder,f,"key",r);return[a(R)+"="+a(m(b,Xe.encoder,f,"value",r))]}return[a(e)+"="+a(String(b))]}var M=[];if(typeof b>"u")return M;var N;if(n==="comma"&&Wr(b))u&&m&&(b=Gu.maybeMap(b,m)),N=[{value:b.length>0?b.join(",")||null:void 0}];else if(Wr(v))N=v;else{var L=Object.keys(b);N=w?L.sort(w):L}var W=_?String(e).replace(/\./g,"%2E"):String(e),k=l&&Wr(b)&&b.length===1?W+"[]":W;if(h&&Wr(b)&&b.length===0)return k+"[]";for(var j=0;j<N.length;++j){var Y=N[j],ut=typeof Y=="object"&&Y&&typeof Y.value<"u"?Y.value:b[Y];if(!(o&&ut===null)){var it=x&&_?String(Y).replace(/\./g,"%2E"):String(Y),gt=Wr(b)?typeof n=="function"?n(k,it):k:k+(x?"."+it:"["+it+"]");g.set(t,A);var Q=lb();Q.set(Nf,g),ub(M,s(ut,gt,n,l,h,d,o,_,n==="comma"&&u&&Wr(b)?null:m,v,w,x,T,r,a,u,f,Q))}}return M},jF=function(t){if(!t)return Xe;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Xe.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Cl.default;if(typeof t.format<"u"){if(!$F.call(Cl.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var l=Cl.formatters[n],h=Xe.filter;(typeof t.filter=="function"||Wr(t.filter))&&(h=t.filter);var d;if(t.arrayFormat in hb?d=t.arrayFormat:"indices"in t?d=t.indices?"indices":"repeat":d=Xe.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var o=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:Xe.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Xe.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Xe.allowEmptyArrays,arrayFormat:d,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Xe.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Xe.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Xe.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Xe.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Xe.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Xe.encodeValuesOnly,filter:h,format:n,formatter:l,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Xe.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Xe.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Xe.strictNullHandling}},qF=function(s,t){var e=s,n=jF(t),l,h;typeof n.filter=="function"?(h=n.filter,e=h("",e)):Wr(n.filter)&&(h=n.filter,l=h);var d=[];if(typeof e!="object"||e===null)return"";var o=hb[n.arrayFormat],_=o==="comma"&&n.commaRoundTrip;l||(l=Object.keys(e)),n.sort&&l.sort(n.sort);for(var m=lb(),v=0;v<l.length;++v){var w=l[v],x=e[w];n.skipNulls&&x===null||ub(d,YF(x,w,o,_,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,m))}var T=d.join(n.delimiter),r=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?r+="utf8=%26%2310003%3B&":r+="utf8=%E2%9C%93&"),T.length>0?r+T:""},Uo=ob,Xp=Object.prototype.hasOwnProperty,KF=Array.isArray,Me={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Uo.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},ZF=function(s){return s.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},cb=function(s,t){return s&&typeof s=="string"&&t.comma&&s.indexOf(",")>-1?s.split(","):s},JF="utf8=%26%2310003%3B",QF="utf8=%E2%9C%93",t3=function(t,e){var n={__proto__:null},l=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;l=l.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var h=e.parameterLimit===1/0?void 0:e.parameterLimit,d=l.split(e.delimiter,h),o=-1,_,m=e.charset;if(e.charsetSentinel)for(_=0;_<d.length;++_)d[_].indexOf("utf8=")===0&&(d[_]===QF?m="utf-8":d[_]===JF&&(m="iso-8859-1"),o=_,_=d.length);for(_=0;_<d.length;++_)if(_!==o){var v=d[_],w=v.indexOf("]="),x=w===-1?v.indexOf("="):w+1,T,r;x===-1?(T=e.decoder(v,Me.decoder,m,"key"),r=e.strictNullHandling?null:""):(T=e.decoder(v.slice(0,x),Me.decoder,m,"key"),r=Uo.maybeMap(cb(v.slice(x+1),e),function(u){return e.decoder(u,Me.decoder,m,"value")})),r&&e.interpretNumericEntities&&m==="iso-8859-1"&&(r=ZF(String(r))),v.indexOf("[]=")>-1&&(r=KF(r)?[r]:r);var a=Xp.call(n,T);a&&e.duplicates==="combine"?n[T]=Uo.combine(n[T],r):(!a||e.duplicates==="last")&&(n[T]=r)}return n},e3=function(s,t,e,n){for(var l=n?t:cb(t,e),h=s.length-1;h>=0;--h){var d,o=s[h];if(o==="[]"&&e.parseArrays)d=e.allowEmptyArrays&&(l===""||e.strictNullHandling&&l===null)?[]:[].concat(l);else{d=e.plainObjects?{__proto__:null}:{};var _=o.charAt(0)==="["&&o.charAt(o.length-1)==="]"?o.slice(1,-1):o,m=e.decodeDotInKeys?_.replace(/%2E/g,"."):_,v=parseInt(m,10);!e.parseArrays&&m===""?d={0:l}:!isNaN(v)&&o!==m&&String(v)===m&&v>=0&&e.parseArrays&&v<=e.arrayLimit?(d=[],d[v]=l):m!=="__proto__"&&(d[m]=l)}l=d}return l},i3=function(t,e,n,l){if(t){var h=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,d=/(\[[^[\]]*])/,o=/(\[[^[\]]*])/g,_=n.depth>0&&d.exec(h),m=_?h.slice(0,_.index):h,v=[];if(m){if(!n.plainObjects&&Xp.call(Object.prototype,m)&&!n.allowPrototypes)return;v.push(m)}for(var w=0;n.depth>0&&(_=o.exec(h))!==null&&w<n.depth;){if(w+=1,!n.plainObjects&&Xp.call(Object.prototype,_[1].slice(1,-1))&&!n.allowPrototypes)return;v.push(_[1])}if(_){if(n.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");v.push("["+h.slice(_.index)+"]")}return e3(v,e,n,l)}},r3=function(t){if(!t)return Me;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Me.charset:t.charset,n=typeof t.duplicates>"u"?Me.duplicates:t.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var l=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:Me.allowDots:!!t.allowDots;return{allowDots:l,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Me.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Me.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Me.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Me.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Me.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Me.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:Me.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:Me.decoder,delimiter:typeof t.delimiter=="string"||Uo.isRegExp(t.delimiter)?t.delimiter:Me.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Me.depth,duplicates:n,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Me.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Me.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Me.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:Me.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Me.strictNullHandling}},n3=function(s,t){var e=r3(t);if(s===""||s===null||typeof s>"u")return e.plainObjects?{__proto__:null}:{};for(var n=typeof s=="string"?t3(s,e):s,l=e.plainObjects?{__proto__:null}:{},h=Object.keys(n),d=0;d<h.length;++d){var o=h[d],_=i3(o,n[o],e,typeof s=="string");l=Uo.merge(l,_,e)}return e.allowSparse===!0?l:Uo.compact(l)},s3=qF,a3=n3,o3=J_,l3={formats:o3,parse:a3,stringify:s3},h3=_R;function Un(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var u3=/^([a-z0-9.+-]+:)/i,c3=/:[0-9]*$/,d3=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,f3=["<",">",'"',"`"," ","\r",`
`,"	"],p3=["{","}","|","\\","^","`"].concat(f3),Yp=["'"].concat(p3),Vv=["%","/","?",";","#"].concat(Yp),Wv=["/","?","#"],_3=255,Xv=/^[+a-z0-9A-Z_-]{0,63}$/,g3=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m3={javascript:!0,"javascript:":!0},jp={javascript:!0,"javascript:":!0},_o={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},qp=l3;function y3(s,t,e){if(s&&typeof s=="object"&&s instanceof Un)return s;var n=new Un;return n.parse(s,t,e),n}Un.prototype.parse=function(s,t,e){if(typeof s!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var n=s.indexOf("?"),l=n!==-1&&n<s.indexOf("#")?"?":"#",h=s.split(l),d=/\\/g;h[0]=h[0].replace(d,"/"),s=h.join(l);var o=s;if(o=o.trim(),!e&&s.split("#").length===1){var _=d3.exec(o);if(_)return this.path=o,this.href=o,this.pathname=_[1],_[2]?(this.search=_[2],t?this.query=qp.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var m=u3.exec(o);if(m){m=m[0];var v=m.toLowerCase();this.protocol=v,o=o.substr(m.length)}if(e||m||o.match(/^\/\/[^@/]+@[^@/]+/)){var w=o.substr(0,2)==="//";w&&!(m&&jp[m])&&(o=o.substr(2),this.slashes=!0)}if(!jp[m]&&(w||m&&!_o[m])){for(var x=-1,T=0;T<Wv.length;T++){var r=o.indexOf(Wv[T]);r!==-1&&(x===-1||r<x)&&(x=r)}var a,u;x===-1?u=o.lastIndexOf("@"):u=o.lastIndexOf("@",x),u!==-1&&(a=o.slice(0,u),o=o.slice(u+1),this.auth=decodeURIComponent(a)),x=-1;for(var T=0;T<Vv.length;T++){var r=o.indexOf(Vv[T]);r!==-1&&(x===-1||r<x)&&(x=r)}x===-1&&(x=o.length),this.host=o.slice(0,x),o=o.slice(x),this.parseHost(),this.hostname=this.hostname||"";var f=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!f)for(var g=this.hostname.split(/\./),T=0,b=g.length;T<b;T++){var S=g[T];if(S&&!S.match(Xv)){for(var A="",C=0,B=S.length;C<B;C++)S.charCodeAt(C)>127?A+="x":A+=S[C];if(!A.match(Xv)){var R=g.slice(0,T),M=g.slice(T+1),N=S.match(g3);N&&(R.push(N[1]),M.unshift(N[2])),M.length&&(o="/"+M.join(".")+o),this.hostname=R.join(".");break}}}this.hostname.length>_3?this.hostname="":this.hostname=this.hostname.toLowerCase(),f||(this.hostname=h3.toASCII(this.hostname));var L=this.port?":"+this.port:"",W=this.hostname||"";this.host=W+L,this.href+=this.host,f&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!m3[v])for(var T=0,b=Yp.length;T<b;T++){var k=Yp[T];if(o.indexOf(k)!==-1){var j=encodeURIComponent(k);j===k&&(j=escape(k)),o=o.split(k).join(j)}}var Y=o.indexOf("#");Y!==-1&&(this.hash=o.substr(Y),o=o.slice(0,Y));var ut=o.indexOf("?");if(ut!==-1?(this.search=o.substr(ut),this.query=o.substr(ut+1),t&&(this.query=qp.parse(this.query)),o=o.slice(0,ut)):t&&(this.search="",this.query={}),o&&(this.pathname=o),_o[v]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var L=this.pathname||"",it=this.search||"";this.path=L+it}return this.href=this.format(),this};Un.prototype.format=function(){var s=this.auth||"";s&&(s=encodeURIComponent(s),s=s.replace(/%3A/i,":"),s+="@");var t=this.protocol||"",e=this.pathname||"",n=this.hash||"",l=!1,h="";this.host?l=s+this.host:this.hostname&&(l=s+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(l+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(h=qp.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var d=this.search||h&&"?"+h||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||_o[t])&&l!==!1?(l="//"+(l||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):l||(l=""),n&&n.charAt(0)!=="#"&&(n="#"+n),d&&d.charAt(0)!=="?"&&(d="?"+d),e=e.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),d=d.replace("#","%23"),t+l+e+d+n};Un.prototype.resolve=function(s){return this.resolveObject(y3(s,!1,!0)).format()};Un.prototype.resolveObject=function(s){if(typeof s=="string"){var t=new Un;t.parse(s,!1,!0),s=t}for(var e=new Un,n=Object.keys(this),l=0;l<n.length;l++){var h=n[l];e[h]=this[h]}if(e.hash=s.hash,s.href==="")return e.href=e.format(),e;if(s.slashes&&!s.protocol){for(var d=Object.keys(s),o=0;o<d.length;o++){var _=d[o];_!=="protocol"&&(e[_]=s[_])}return _o[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(s.protocol&&s.protocol!==e.protocol){if(!_o[s.protocol]){for(var m=Object.keys(s),v=0;v<m.length;v++){var w=m[v];e[w]=s[w]}return e.href=e.format(),e}if(e.protocol=s.protocol,!s.host&&!jp[s.protocol]){for(var b=(s.pathname||"").split("/");b.length&&!(s.host=b.shift()););s.host||(s.host=""),s.hostname||(s.hostname=""),b[0]!==""&&b.unshift(""),b.length<2&&b.unshift(""),e.pathname=b.join("/")}else e.pathname=s.pathname;if(e.search=s.search,e.query=s.query,e.host=s.host||"",e.auth=s.auth,e.hostname=s.hostname||s.host,e.port=s.port,e.pathname||e.search){var x=e.pathname||"",T=e.search||"";e.path=x+T}return e.slashes=e.slashes||s.slashes,e.href=e.format(),e}var r=e.pathname&&e.pathname.charAt(0)==="/",a=s.host||s.pathname&&s.pathname.charAt(0)==="/",u=a||r||e.host&&s.pathname,f=u,g=e.pathname&&e.pathname.split("/")||[],b=s.pathname&&s.pathname.split("/")||[],S=e.protocol&&!_o[e.protocol];if(S&&(e.hostname="",e.port=null,e.host&&(g[0]===""?g[0]=e.host:g.unshift(e.host)),e.host="",s.protocol&&(s.hostname=null,s.port=null,s.host&&(b[0]===""?b[0]=s.host:b.unshift(s.host)),s.host=null),u=u&&(b[0]===""||g[0]==="")),a)e.host=s.host||s.host===""?s.host:e.host,e.hostname=s.hostname||s.hostname===""?s.hostname:e.hostname,e.search=s.search,e.query=s.query,g=b;else if(b.length)g||(g=[]),g.pop(),g=g.concat(b),e.search=s.search,e.query=s.query;else if(s.search!=null){if(S){e.host=g.shift(),e.hostname=e.host;var A=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;A&&(e.auth=A.shift(),e.hostname=A.shift(),e.host=e.hostname)}return e.search=s.search,e.query=s.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!g.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var C=g.slice(-1)[0],B=(e.host||s.host||g.length>1)&&(C==="."||C==="..")||C==="",R=0,M=g.length;M>=0;M--)C=g[M],C==="."?g.splice(M,1):C===".."?(g.splice(M,1),R++):R&&(g.splice(M,1),R--);if(!u&&!f)for(;R--;R)g.unshift("..");u&&g[0]!==""&&(!g[0]||g[0].charAt(0)!=="/")&&g.unshift(""),B&&g.join("/").substr(-1)!=="/"&&g.push("");var N=g[0]===""||g[0]&&g[0].charAt(0)==="/";if(S){e.hostname=N?"":g.length?g.shift():"",e.host=e.hostname;var A=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;A&&(e.auth=A.shift(),e.hostname=A.shift(),e.host=e.hostname)}return u=u||e.host&&g.length,u&&!N&&g.unshift(""),g.length>0?e.pathname=g.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=s.auth||e.auth,e.slashes=e.slashes||s.slashes,e.href=e.format(),e};Un.prototype.parseHost=function(){var s=this.host,t=c3.exec(s);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),s=s.substr(0,s.length-t.length)),s&&(this.hostname=s)};const Yv={};function ne(s,t,e=3){if(Yv[t])return;let n=new Error().stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`):(n=n.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(n))),Yv[t]=!0}function cr(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function il(s){return s.split("?")[0].split("#")[0]}function v3(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function x3(s,t,e){return s.replace(new RegExp(v3(t),"g"),e)}function b3(s,t){let e="",n=0,l=-1,h=0,d=-1;for(let o=0;o<=s.length;++o){if(o<s.length)d=s.charCodeAt(o);else{if(d===47)break;d=47}if(d===47){if(!(l===o-1||h===1))if(l!==o-1&&h===2){if(e.length<2||n!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const _=e.lastIndexOf("/");if(_!==e.length-1){_===-1?(e="",n=0):(e=e.slice(0,_),n=e.length-1-e.lastIndexOf("/")),l=o,h=0;continue}}else if(e.length===2||e.length===1){e="",n=0,l=o,h=0;continue}}}else e.length>0?e+=`/${s.slice(l+1,o)}`:e=s.slice(l+1,o),n=o-l-1;l=o,h=0}else d===46&&h!==-1?++h:h=-1}return e}const ei={toPosix(s){return x3(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){cr(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(cr(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const n=il(this.toPosix(t??wt.ADAPTER.getBaseUrl())),l=il(this.toPosix(e??this.rootname(n)));return s=this.toPosix(s),s.startsWith("/")?ei.join(l,s.slice(1)):this.isAbsolute(s)?s:this.join(n,s)},normalize(s){if(cr(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const n=s.endsWith("/");return s=b3(s),s.length>0&&n&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return cr(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const n=s[e];if(cr(n),n.length>0)if(t===void 0)t=n;else{const l=s[e-1]??"";this.joinExtensions.includes(this.extname(l).toLowerCase())?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(cr(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let n=-1,l=!0;const h=this.getProtocol(s),d=s;s=s.slice(h.length);for(let o=s.length-1;o>=1;--o)if(t=s.charCodeAt(o),t===47){if(!l){n=o;break}}else l=!1;return n===-1?e?"/":this.isUrl(d)?h+s:h:e&&n===1?"//":h+s.slice(0,n)},rootname(s){cr(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){cr(s),t&&cr(t),s=il(this.toPosix(s));let e=0,n=-1,l=!0,h;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let d=t.length-1,o=-1;for(h=s.length-1;h>=0;--h){const _=s.charCodeAt(h);if(_===47){if(!l){e=h+1;break}}else o===-1&&(l=!1,o=h+1),d>=0&&(_===t.charCodeAt(d)?--d===-1&&(n=h):(d=-1,n=o))}return e===n?n=o:n===-1&&(n=s.length),s.slice(e,n)}for(h=s.length-1;h>=0;--h)if(s.charCodeAt(h)===47){if(!l){e=h+1;break}}else n===-1&&(l=!1,n=h+1);return n===-1?"":s.slice(e,n)},extname(s){cr(s),s=il(this.toPosix(s));let t=-1,e=0,n=-1,l=!0,h=0;for(let d=s.length-1;d>=0;--d){const o=s.charCodeAt(d);if(o===47){if(!l){e=d+1;break}continue}n===-1&&(l=!1,n=d+1),o===46?t===-1?t=d:h!==1&&(h=1):t!==-1&&(h=-1)}return t===-1||n===-1||h===0||h===1&&t===n-1&&t===e+1?"":s.slice(t,n)},parse(s){cr(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=il(this.toPosix(s));let e=s.charCodeAt(0);const n=this.isAbsolute(s);let l;t.root=this.rootname(s),n||this.hasProtocol(s)?l=1:l=0;let h=-1,d=0,o=-1,_=!0,m=s.length-1,v=0;for(;m>=l;--m){if(e=s.charCodeAt(m),e===47){if(!_){d=m+1;break}continue}o===-1&&(_=!1,o=m+1),e===46?h===-1?h=m:v!==1&&(v=1):h!==-1&&(v=-1)}return h===-1||o===-1||v===0||v===1&&h===o-1&&h===d+1?o!==-1&&(d===0&&n?t.base=t.name=s.slice(1,o):t.base=t.name=s.slice(d,o)):(d===0&&n?(t.name=s.slice(1,h),t.base=s.slice(1,o)):(t.name=s.slice(d,h),t.base=s.slice(d,o)),t.ext=s.slice(h,o)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let zf;async function w3(){return zf??(zf=(async()=>{var h;const s=document.createElement("canvas").getContext("webgl");if(!s)return Ri.UNPACK;const t=await new Promise(d=>{const o=document.createElement("video");o.onloadeddata=()=>d(o),o.onerror=()=>d(null),o.autoplay=!1,o.crossOrigin="anonymous",o.preload="auto",o.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",o.load()});if(!t)return Ri.UNPACK;const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);const n=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t);const l=new Uint8Array(4);return s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,l),s.deleteFramebuffer(n),s.deleteTexture(e),(h=s.getExtension("WEBGL_lose_context"))==null||h.loseContext(),l[0]<=l[3]?Ri.PMA:Ri.UNPACK})()),zf}let Gf;function S3(){return typeof Gf>"u"&&(Gf=function(){var t;const s={stencil:!0,failIfMajorPerformanceCaveat:wt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!wt.ADAPTER.getWebGLRenderingContext())return!1;const e=wt.ADAPTER.createCanvas();let n=e.getContext("webgl",s)||e.getContext("experimental-webgl",s);const l=!!((t=n==null?void 0:n.getContextAttributes())!=null&&t.stencil);if(n){const h=n.getExtension("WEBGL_lose_context");h&&h.loseContext()}return n=null,l}catch{return!1}}()),Gf}var E3={grad:.9,turn:360,rad:360/(2*Math.PI)},fn=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},ti=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},sr=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},db=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},jv=function(s){return{r:sr(s.r,0,255),g:sr(s.g,0,255),b:sr(s.b,0,255),a:sr(s.a)}},Hf=function(s){return{r:ti(s.r),g:ti(s.g),b:ti(s.b),a:ti(s.a,3)}},T3=/^#([0-9a-f]{3,8})$/i,Hh=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},fb=function(s){var t=s.r,e=s.g,n=s.b,l=s.a,h=Math.max(t,e,n),d=h-Math.min(t,e,n),o=d?h===t?(e-n)/d:h===e?2+(n-t)/d:4+(t-e)/d:0;return{h:60*(o<0?o+6:o),s:h?d/h*100:0,v:h/255*100,a:l}},pb=function(s){var t=s.h,e=s.s,n=s.v,l=s.a;t=t/360*6,e/=100,n/=100;var h=Math.floor(t),d=n*(1-e),o=n*(1-(t-h)*e),_=n*(1-(1-t+h)*e),m=h%6;return{r:255*[n,o,d,d,_,n][m],g:255*[_,n,n,o,d,d][m],b:255*[d,d,_,n,n,o][m],a:l}},qv=function(s){return{h:db(s.h),s:sr(s.s,0,100),l:sr(s.l,0,100),a:sr(s.a)}},Kv=function(s){return{h:ti(s.h),s:ti(s.s),l:ti(s.l),a:ti(s.a,3)}},Zv=function(s){return pb((e=(t=s).s,{h:t.h,s:(e*=((n=t.l)<50?n:100-n)/100)>0?2*e/(n+e)*100:0,v:n+e,a:t.a}));var t,e,n},Ul=function(s){return{h:(t=fb(s)).h,s:(l=(200-(e=t.s))*(n=t.v)/100)>0&&l<200?e*n/100/(l<=100?l:200-l)*100:0,l:l/2,a:t.a};var t,e,n,l},A3=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,C3=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,U3=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,I3=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Kp={string:[[function(s){var t=T3.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?ti(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?ti(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=U3.exec(s)||I3.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:jv({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=A3.exec(s)||C3.exec(s);if(!t)return null;var e,n,l=qv({h:(e=t[1],n=t[2],n===void 0&&(n="deg"),Number(e)*(E3[n]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Zv(l)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,n=s.b,l=s.a,h=l===void 0?1:l;return fn(t)&&fn(e)&&fn(n)?jv({r:Number(t),g:Number(e),b:Number(n),a:Number(h)}):null},"rgb"],[function(s){var t=s.h,e=s.s,n=s.l,l=s.a,h=l===void 0?1:l;if(!fn(t)||!fn(e)||!fn(n))return null;var d=qv({h:Number(t),s:Number(e),l:Number(n),a:Number(h)});return Zv(d)},"hsl"],[function(s){var t=s.h,e=s.s,n=s.v,l=s.a,h=l===void 0?1:l;if(!fn(t)||!fn(e)||!fn(n))return null;var d=function(o){return{h:db(o.h),s:sr(o.s,0,100),v:sr(o.v,0,100),a:sr(o.a)}}({h:Number(t),s:Number(e),v:Number(n),a:Number(h)});return pb(d)},"hsv"]]},Jv=function(s,t){for(var e=0;e<t.length;e++){var n=t[e][0](s);if(n)return[n,t[e][1]]}return[null,void 0]},P3=function(s){return typeof s=="string"?Jv(s.trim(),Kp.string):typeof s=="object"&&s!==null?Jv(s,Kp.object):[null,void 0]},$f=function(s,t){var e=Ul(s);return{h:e.h,s:sr(e.s+100*t,0,100),l:e.l,a:e.a}},Vf=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Qv=function(s,t){var e=Ul(s);return{h:e.h,s:e.s,l:sr(e.l+100*t,0,100),a:e.a}},Zp=function(){function s(t){this.parsed=P3(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return ti(Vf(this.rgba),2)},s.prototype.isDark=function(){return Vf(this.rgba)<.5},s.prototype.isLight=function(){return Vf(this.rgba)>=.5},s.prototype.toHex=function(){return t=Hf(this.rgba),e=t.r,n=t.g,l=t.b,d=(h=t.a)<1?Hh(ti(255*h)):"","#"+Hh(e)+Hh(n)+Hh(l)+d;var t,e,n,l,h,d},s.prototype.toRgb=function(){return Hf(this.rgba)},s.prototype.toRgbString=function(){return t=Hf(this.rgba),e=t.r,n=t.g,l=t.b,(h=t.a)<1?"rgba("+e+", "+n+", "+l+", "+h+")":"rgb("+e+", "+n+", "+l+")";var t,e,n,l,h},s.prototype.toHsl=function(){return Kv(Ul(this.rgba))},s.prototype.toHslString=function(){return t=Kv(Ul(this.rgba)),e=t.h,n=t.s,l=t.l,(h=t.a)<1?"hsla("+e+", "+n+"%, "+l+"%, "+h+")":"hsl("+e+", "+n+"%, "+l+"%)";var t,e,n,l,h},s.prototype.toHsv=function(){return t=fb(this.rgba),{h:ti(t.h),s:ti(t.s),v:ti(t.v),a:ti(t.a,3)};var t},s.prototype.invert=function(){return zr({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),zr($f(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),zr($f(this.rgba,-t))},s.prototype.grayscale=function(){return zr($f(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),zr(Qv(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),zr(Qv(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?zr({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ti(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=Ul(this.rgba);return typeof t=="number"?zr({h:t,s:e.s,l:e.l,a:e.a}):ti(e.h)},s.prototype.isEqual=function(t){return this.toHex()===zr(t).toHex()},s}(),zr=function(s){return s instanceof Zp?s:new Zp(s)},t0=[],R3=function(s){s.forEach(function(t){t0.indexOf(t)<0&&(t(Zp,Kp),t0.push(t))})};function B3(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var l in e)n[e[l]]=l;var h={};s.prototype.toName=function(d){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,_,m=n[this.toHex()];if(m)return m;if(d!=null&&d.closest){var v=this.toRgb(),w=1/0,x="black";if(!h.length)for(var T in e)h[T]=new s(e[T]).toRgb();for(var r in e){var a=(o=v,_=h[r],Math.pow(o.r-_.r,2)+Math.pow(o.g-_.g,2)+Math.pow(o.b-_.b,2));a<w&&(w=a,x=r)}return x}},t.string.push([function(d){var o=d.toLowerCase(),_=o==="transparent"?"#0000":e[o];return _?new s(_).toRgb():null},"name"])}R3([B3]);const Za=class Hu{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Hu)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const n=typeof t;if(n!==typeof e)return!1;if(n==="number"||n==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((l,h)=>l===e[h]);if(t!==null&&e!==null){const l=Object.keys(t),h=Object.keys(e);return l.length!==h.length?!1:l.every(d=>t[d]===e[d])}return t===e}toRgba(){const[t,e,n,l]=this._components;return{r:t,g:e,b:n,a:l}}toRgb(){const[t,e,n]=this._components;return{r:t,g:e,b:n}}toRgbaString(){const[t,e,n]=this.toUint8RgbArray();return`rgba(${t},${e},${n},${this.alpha})`}toUint8RgbArray(t){const[e,n,l]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(n*255),t[2]=Math.round(l*255),t}toRgbArray(t){t=t??[];const[e,n,l]=this._components;return t[0]=e,t[1]=n,t[2]=l,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,n,l,h]=Hu.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=n,this._components[2]*=l,this._components[3]*=h,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let n=this._int>>16&255,l=this._int>>8&255,h=this._int&255;return e&&(n=n*t+.5|0,l=l*t+.5|0,h=h*t+.5|0),(t*255<<24)+(n<<16)+(l<<8)+h}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,n,l]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(n*t)/t,this._components[2]=Math.round(l*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,n,l,h]=this._components;return t[0]=e,t[1]=n,t[2]=l,t[3]=h,t}normalize(t){let e,n,l,h;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const d=t;e=(d>>16&255)/255,n=(d>>8&255)/255,l=(d&255)/255,h=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,n,l,h=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,n,l,h=255]=t,e/=255,n/=255,l/=255,h/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=Hu.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const d=zr(t);d.isValid()&&({r:e,g:n,b:l,a:h}=d.rgba,e/=255,n/=255,l/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=n,this._components[2]=l,this._components[3]=h,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,n]=this._components;this._int=(t*255<<16)+(e*255<<8)+(n*255|0)}_clamp(t,e=0,n=1){return typeof t=="number"?Math.min(Math.max(t,e),n):(t.forEach((l,h)=>{t[h]=Math.min(Math.max(l,e),n)}),t)}};Za.shared=new Za,Za.temp=new Za,Za.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let we=Za;function F3(s){return ne("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),we.shared.setValue(s).toHex()}function M3(s){return ne("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),we.shared.setValue(s).toNumber()}function L3(){const s=[],t=[];for(let n=0;n<32;n++)s[n]=n,t[n]=n;s[Vt.NORMAL_NPM]=Vt.NORMAL,s[Vt.ADD_NPM]=Vt.ADD,s[Vt.SCREEN_NPM]=Vt.SCREEN,t[Vt.NORMAL]=Vt.NORMAL_NPM,t[Vt.ADD]=Vt.ADD_NPM,t[Vt.SCREEN]=Vt.SCREEN_NPM;const e=[];return e.push(t),e.push(s),e}const _b=L3();function gb(s,t){return _b[t?1:0][s]}function D3(s,t=null){const e=s*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let n=0,l=0;n<e;n+=6,l+=4)t[n+0]=l+0,t[n+1]=l+1,t[n+2]=l+2,t[n+3]=l+0,t[n+4]=l+2,t[n+5]=l+3;return t}function mb(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function dc(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function e0(s){return!(s&s-1)&&!!s}function i0(s){let t=(s>65535?1:0)<<4;s>>>=t;let e=(s>255?1:0)<<3;return s>>>=e,t|=e,e=(s>15?1:0)<<2,s>>>=e,t|=e,e=(s>3?1:0)<<1,s>>>=e,t|=e,t|s>>1}function go(s,t,e){const n=s.length;let l;if(t>=n||e===0)return;e=t+e>n?n-t:e;const h=n-e;for(l=t;l<h;++l)s[l]=s[l+e];s.length=h}function ns(s){return s===0?0:s<0?-1:1}let k3=0;function ra(){return++k3}const Jp=class{constructor(s,t,e,n){this.left=s,this.top=t,this.right=e,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Jp.EMPTY=new Jp(0,0,0,0);let r0=Jp;const n0={},Gr=Object.create(null),Vn=Object.create(null);class O3{constructor(t,e,n){this._canvas=wt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||wt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function s0(s,t,e){for(let n=0,l=4*e*t;n<t;++n,l+=4)if(s[l+3]!==0)return!1;return!0}function a0(s,t,e,n,l){const h=4*t;for(let d=n,o=n*h+4*e;d<=l;++d,o+=h)if(s[o+3]!==0)return!1;return!0}function N3(s){const{width:t,height:e}=s,n=s.getContext("2d",{willReadFrequently:!0});if(n===null)throw new TypeError("Failed to get canvas 2D context");const l=n.getImageData(0,0,t,e).data;let h=0,d=0,o=t-1,_=e-1;for(;d<e&&s0(l,t,d);)++d;if(d===e)return r0.EMPTY;for(;s0(l,t,_);)--_;for(;a0(l,t,h,d,_);)++h;for(;a0(l,t,o,d,_);)--o;return++o,++_,new r0(h,d,o,_)}function z3(s){const t=N3(s),{width:e,height:n}=t;let l=null;if(!t.isEmpty()){const h=s.getContext("2d");if(h===null)throw new TypeError("Failed to get canvas 2D context");l=h.getImageData(t.left,t.top,e,n)}return{width:e,height:n,data:l}}function G3(s,t=globalThis.location){if(s.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Pn(s,t=1){var n;const e=(n=wt.RETINA_PREFIX)==null?void 0:n.exec(s);return e?parseFloat(e[1]):t}var yt=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(yt||{});const Qp=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},o0=(s,t)=>Qp(s).priority??t,Ut={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Qp).forEach(t=>{t.type.forEach(e=>{var n,l;return(l=(n=this._removeHandlers)[e])==null?void 0:l.call(n,t)})}),this},add(...s){return s.map(Qp).forEach(t=>{t.type.forEach(e=>{var h,d;const n=this._addHandlers,l=this._queue;n[e]?(h=n[e])==null||h.call(n,t):(l[e]=l[e]||[],(d=l[e])==null||d.push(t))})}),this},handle(s,t,e){var d;const n=this._addHandlers,l=this._removeHandlers;if(n[s]||l[s])throw new Error(`Extension type ${s} already has a handler`);n[s]=t,l[s]=e;const h=this._queue;return h[s]&&((d=h[s])==null||d.forEach(o=>t(o)),delete h[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(s,t,e=-1){return this.handle(s,n=>{t.includes(n.ref)||(t.push(n.ref),t.sort((l,h)=>o0(h,e)-o0(l,e)))},n=>{const l=t.indexOf(n.ref);l!==-1&&t.splice(l,1)})}};class t_{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const H3=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function $3(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function V3(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const n=H3.replace(/%forloop%/gi,$3(s));if(t.shaderSource(e,n),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}return s}const Wf=0,Xf=1,Yf=2,jf=3,qf=4,Kf=5;class tn{constructor(){this.data=0,this.blendMode=Vt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Wf)}set blend(t){!!(this.data&1<<Wf)!==t&&(this.data^=1<<Wf)}get offsets(){return!!(this.data&1<<Xf)}set offsets(t){!!(this.data&1<<Xf)!==t&&(this.data^=1<<Xf)}get culling(){return!!(this.data&1<<Yf)}set culling(t){!!(this.data&1<<Yf)!==t&&(this.data^=1<<Yf)}get depthTest(){return!!(this.data&1<<jf)}set depthTest(t){!!(this.data&1<<jf)!==t&&(this.data^=1<<jf)}get depthMask(){return!!(this.data&1<<Kf)}set depthMask(t){!!(this.data&1<<Kf)!==t&&(this.data^=1<<Kf)}get clockwiseFrontFace(){return!!(this.data&1<<qf)}set clockwiseFrontFace(t){!!(this.data&1<<qf)!==t&&(this.data^=1<<qf)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Vt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new tn;return t.depthTest=!1,t.blend=!0,t}}tn.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const e_=[];function yb(s,t){if(!s)return null;let e="";if(typeof s=="string"){const n=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);n&&(e=n[1].toLowerCase())}for(let n=e_.length-1;n>=0;--n){const l=e_[n];if(l.test&&l.test(s,e))return new l(s,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Tr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,n,l,h,d,o,_){if(arguments.length>8)throw new Error("max arguments reached");const{name:m,items:v}=this;this._aliasCount++;for(let w=0,x=v.length;w<x;w++)v[w][m](t,e,n,l,h,d,o,_);return v===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Tr.prototype,{dispatch:{value:Tr.prototype.emit},run:{value:Tr.prototype.emit}});class kl{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Tr("setRealSize"),this.onUpdate=new Tr("update"),this.onError=new Tr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class kc extends kl{constructor(t,e){const{width:n,height:l}=e||{};if(!n||!l)throw new Error("BufferResource width or height invalid");super(n,l),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,n){const l=t.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,this.unpackAlignment),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ri.UNPACK);const h=e.realWidth,d=e.realHeight;return n.width===h&&n.height===d?l.texSubImage2D(e.target,0,0,0,h,d,e.format,n.type,this.data):(n.width=h,n.height=d,l.texImage2D(e.target,0,n.internalFormat,h,d,0,e.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const W3={scaleMode:En.NEAREST,alphaMode:Ri.NPM},i_=class Ja extends Gl{constructor(t=null,e=null){super(),e=Object.assign({},Ja.defaultOptions,e);const{alphaMode:n,mipmap:l,anisotropicLevel:h,scaleMode:d,width:o,height:_,wrapMode:m,format:v,type:w,target:x,resolution:T,resourceOptions:r}=e;t&&!(t instanceof kl)&&(t=yb(t,r),t.internal=!0),this.resolution=T||wt.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((_||0)*this.resolution)/this.resolution,this._mipmap=l,this.anisotropicLevel=h,this._wrapMode=m,this._scaleMode=d,this.format=v,this.type=w,this.target=x,this.alphaMode=n,this.uid=ra(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&_>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let n;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this}setSize(t,e,n){return n=n||this.resolution,this.setRealSize(t*n,e*n,n)}setRealSize(t,e,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=e0(this.realWidth)&&e0(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Vn[this.cacheId],delete Gr[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ja.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,n=wt.STRICT_TEXTURE_CACHE){const l=typeof t=="string";let h=null;if(l)h=t;else{if(!t._pixiId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${ra()}`}h=t._pixiId}let d=Vn[h];if(l&&n&&!d)throw new Error(`The cacheId "${h}" does not exist in BaseTextureCache.`);return d||(d=new Ja(t,e),d.cacheId=h,Ja.addToCache(d,h)),d}static fromBuffer(t,e,n,l){t=t||new Float32Array(e*n*4);const h=new kc(t,{width:e,height:n,...l==null?void 0:l.resourceOptions});let d,o;return t instanceof Float32Array?(d=ft.RGBA,o=Bt.FLOAT):t instanceof Int32Array?(d=ft.RGBA_INTEGER,o=Bt.INT):t instanceof Uint32Array?(d=ft.RGBA_INTEGER,o=Bt.UNSIGNED_INT):t instanceof Int16Array?(d=ft.RGBA_INTEGER,o=Bt.SHORT):t instanceof Uint16Array?(d=ft.RGBA_INTEGER,o=Bt.UNSIGNED_SHORT):t instanceof Int8Array?(d=ft.RGBA,o=Bt.BYTE):(d=ft.RGBA,o=Bt.UNSIGNED_BYTE),h.internal=!0,new Ja(h,Object.assign({},W3,{type:o,format:d},l))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Vn[e]&&Vn[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Vn[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Vn[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Vn[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Vn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};i_.defaultOptions={mipmap:Qr.POW2,anisotropicLevel:0,scaleMode:En.LINEAR,wrapMode:os.CLAMP,alphaMode:Ri.UNPACK,target:fo.TEXTURE_2D,format:ft.RGBA,type:Bt.UNSIGNED_BYTE},i_._globalBatch=0;let qt=i_;class r_{constructor(){this.texArray=null,this.blend=0,this.type=Kr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let X3=0;class Ne{constructor(t,e=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=X3++,this.disposeRunner=new Tr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Zr.ELEMENT_ARRAY_BUFFER:Zr.ARRAY_BUFFER}get index(){return this.type===Zr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ne(t)}}class fc{constructor(t,e=0,n=!1,l=Bt.FLOAT,h,d,o,_=1){this.buffer=t,this.size=e,this.normalized=n,this.type=l,this.stride=h,this.start=d,this.instance=o,this.divisor=_}destroy(){this.buffer=null}static from(t,e,n,l,h){return new fc(t,e,n,l,h)}}const Y3={Float32Array,Uint32Array,Int32Array,Uint8Array};function j3(s,t){let e=0,n=0;const l={};for(let _=0;_<s.length;_++)n+=t[_],e+=s[_].length;const h=new ArrayBuffer(e*4);let d=null,o=0;for(let _=0;_<s.length;_++){const m=t[_],v=s[_],w=mb(v);l[w]||(l[w]=new Y3[w](h)),d=l[w];for(let x=0;x<v.length;x++){const T=(x/m|0)*n+o,r=x%m;d[T+r]=v[x]}o+=m}return new Float32Array(h)}const l0={5126:4,5123:2,5121:1};let q3=0;const K3={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class hs{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=q3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Tr("disposeGeometry"),this.refCount=0}addAttribute(t,e,n=0,l=!1,h,d,o,_=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ne||(e instanceof Array&&(e=new Float32Array(e)),e=new Ne(e));const m=t.split("|");if(m.length>1){for(let w=0;w<m.length;w++)this.addAttribute(m[w],e,n,l,h);return this}let v=this.buffers.indexOf(e);return v===-1&&(this.buffers.push(e),v=this.buffers.length-1),this.attributes[t]=new fc(v,n,l,h,d,o,_),this.instanced=this.instanced||_,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ne||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ne(t)),t.type=Zr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],n=new Ne;let l;for(l in this.attributes){const h=this.attributes[l],d=this.buffers[h.buffer];t.push(d.data),e.push(h.size*l0[h.type]/4),h.buffer=0}for(n.data=j3(t,e),l=0;l<this.buffers.length;l++)this.buffers[l]!==this.indexBuffer&&this.buffers[l].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new hs;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ne(this.buffers[e].data.slice(0));for(const e in this.attributes){const n=this.attributes[e];t.attributes[e]=new fc(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Zr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new hs,n=[],l=[],h=[];let d;for(let o=0;o<t.length;o++){d=t[o];for(let _=0;_<d.buffers.length;_++)l[_]=l[_]||0,l[_]+=d.buffers[_].data.length,h[_]=0}for(let o=0;o<d.buffers.length;o++)n[o]=new K3[mb(d.buffers[o].data)](l[o]),e.buffers[o]=new Ne(n[o]);for(let o=0;o<t.length;o++){d=t[o];for(let _=0;_<d.buffers.length;_++)n[_].set(d.buffers[_].data,h[_]),h[_]+=d.buffers[_].data.length}if(e.attributes=d.attributes,d.indexBuffer){e.indexBuffer=e.buffers[d.buffers.indexOf(d.indexBuffer)],e.indexBuffer.type=Zr.ELEMENT_ARRAY_BUFFER;let o=0,_=0,m=0,v=0;for(let w=0;w<d.buffers.length;w++)if(d.buffers[w]!==d.indexBuffer){v=w;break}for(const w in d.attributes){const x=d.attributes[w];(x.buffer|0)===v&&(_+=x.size*l0[x.type]/4)}for(let w=0;w<t.length;w++){const x=t[w].indexBuffer.data;for(let T=0;T<x.length;T++)e.indexBuffer.data[T+m]+=o;o+=t[w].buffers[v].data.length/_,m+=x.length}}return e}}class vb extends hs{constructor(t=!1){super(),this._buffer=new Ne(null,t,!1),this._indexBuffer=new Ne(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Bt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Bt.FLOAT).addAttribute("aColor",this._buffer,4,!0,Bt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Bt.FLOAT).addIndex(this._indexBuffer)}}const pc=Math.PI*2,Z3=180/Math.PI,J3=Math.PI/180;var oi=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(oi||{});class ue{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ue(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}ue.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const $h=[new ue,new ue,new ue,new ue];class Jt{constructor(t=0,e=0,n=0,l=0){this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(l),this.type=oi.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Jt(0,0,0,0)}clone(){return new Jt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const R=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=R)return!1;const M=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>M}const n=this.left,l=this.right,h=this.top,d=this.bottom;if(l<=n||d<=h)return!1;const o=$h[0].set(t.left,t.top),_=$h[1].set(t.left,t.bottom),m=$h[2].set(t.right,t.top),v=$h[3].set(t.right,t.bottom);if(m.x<=o.x||_.y<=o.y)return!1;const w=Math.sign(e.a*e.d-e.b*e.c);if(w===0||(e.apply(o,o),e.apply(_,_),e.apply(m,m),e.apply(v,v),Math.max(o.x,_.x,m.x,v.x)<=n||Math.min(o.x,_.x,m.x,v.x)>=l||Math.max(o.y,_.y,m.y,v.y)<=h||Math.min(o.y,_.y,m.y,v.y)>=d))return!1;const x=w*(_.y-o.y),T=w*(o.x-_.x),r=x*n+T*h,a=x*l+T*h,u=x*n+T*d,f=x*l+T*d;if(Math.max(r,a,u,f)<=x*o.x+T*o.y||Math.min(r,a,u,f)>=x*v.x+T*v.y)return!1;const g=w*(o.y-m.y),b=w*(m.x-o.x),S=g*n+b*h,A=g*l+b*h,C=g*n+b*d,B=g*l+b*d;return!(Math.max(S,A,C,B)<=g*o.x+b*o.y||Math.min(S,A,C,B)>=g*v.x+b*v.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),l=Math.max(this.y,t.y),h=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=l,this.height=Math.max(h-l,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,l=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=l-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),l=Math.min(this.y,t.y),h=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=l,this.height=h-l,this}}Jt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Oc{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.radius=n,this.type=oi.CIRC}clone(){return new Oc(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let l=this.x-t,h=this.y-e;return l*=l,h*=h,l+h<=n}getBounds(){return new Jt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Oc.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Nc{constructor(t=0,e=0,n=0,l=0){this.x=t,this.y=e,this.width=n,this.height=l,this.type=oi.ELIP}clone(){return new Nc(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,l=(e-this.y)/this.height;return n*=n,l*=l,n+l<=1}getBounds(){return new Jt(this.x-this.width,this.y-this.height,this.width,this.height)}}Nc.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Qs{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const n=[];for(let l=0,h=e.length;l<h;l++)n.push(e[l].x,e[l].y);e=n}this.points=e,this.type=oi.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Qs(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let n=!1;const l=this.points.length/2;for(let h=0,d=l-1;h<l;d=h++){const o=this.points[h*2],_=this.points[h*2+1],m=this.points[d*2],v=this.points[d*2+1];_>e!=v>e&&t<(m-o)*((e-_)/(v-_))+o&&(n=!n)}return n}}Qs.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((s,t)=>`${s}, ${t}`,"")}]`};class zc{constructor(t=0,e=0,n=0,l=0,h=20){this.x=t,this.y=e,this.width=n,this.height=l,this.radius=h,this.type=oi.RREC}clone(){return new zc(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let l=t-(this.x+n),h=e-(this.y+n);const d=n*n;if(l*l+h*h<=d||(l=t-(this.x+this.width-n),l*l+h*h<=d)||(h=e-(this.y+this.height-n),l*l+h*h<=d)||(l=t-(this.x+n),l*l+h*h<=d))return!0}return!1}}zc.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Se{constructor(t=1,e=0,n=0,l=1,h=0,d=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=l,this.tx=h,this.ty=d}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,l,h,d){return this.a=t,this.b=e,this.c=n,this.d=l,this.tx=h,this.ty=d,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new ue;const n=t.x,l=t.y;return e.x=this.a*n+this.c*l+this.tx,e.y=this.b*n+this.d*l+this.ty,e}applyInverse(t,e){e=e||new ue;const n=1/(this.a*this.d+this.c*-this.b),l=t.x,h=t.y;return e.x=this.d*n*l+-this.c*n*h+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*h+-this.b*n*l+(-this.ty*this.a+this.tx*this.b)*n,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),l=this.a,h=this.c,d=this.tx;return this.a=l*e-this.b*n,this.b=l*n+this.b*e,this.c=h*e-this.d*n,this.d=h*n+this.d*e,this.tx=d*e-this.ty*n,this.ty=d*n+this.ty*e,this}append(t){const e=this.a,n=this.b,l=this.c,h=this.d;return this.a=t.a*e+t.b*l,this.b=t.a*n+t.b*h,this.c=t.c*e+t.d*l,this.d=t.c*n+t.d*h,this.tx=t.tx*e+t.ty*l+this.tx,this.ty=t.tx*n+t.ty*h+this.ty,this}setTransform(t,e,n,l,h,d,o,_,m){return this.a=Math.cos(o+m)*h,this.b=Math.sin(o+m)*h,this.c=-Math.sin(o-_)*d,this.d=Math.cos(o-_)*d,this.tx=t-(n*this.a+l*this.c),this.ty=e-(n*this.b+l*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const n=this.a,l=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=l*t.a+this.d*t.c,this.d=l*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,l=this.c,h=this.d,d=t.pivot,o=-Math.atan2(-l,h),_=Math.atan2(n,e),m=Math.abs(o+_);return m<1e-5||Math.abs(pc-m)<1e-5?(t.rotation=_,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=_),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(l*l+h*h),t.position.x=this.tx+(d.x*e+d.y*l),t.position.y=this.ty+(d.x*n+d.y*h),t}invert(){const t=this.a,e=this.b,n=this.c,l=this.d,h=this.tx,d=t*l-e*n;return this.a=l/d,this.b=-e/d,this.c=-n/d,this.d=t/d,this.tx=(n*this.ty-l*h)/d,this.ty=-(t*this.ty-e*h)/d,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Se;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Se}static get TEMP_MATRIX(){return new Se}}Se.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Ds=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ks=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Os=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ns=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],n_=[],xb=[],Vh=Math.sign;function Q3(){for(let s=0;s<16;s++){const t=[];n_.push(t);for(let e=0;e<16;e++){const n=Vh(Ds[s]*Ds[e]+Os[s]*ks[e]),l=Vh(ks[s]*Ds[e]+Ns[s]*ks[e]),h=Vh(Ds[s]*Os[e]+Os[s]*Ns[e]),d=Vh(ks[s]*Os[e]+Ns[s]*Ns[e]);for(let o=0;o<16;o++)if(Ds[o]===n&&ks[o]===l&&Os[o]===h&&Ns[o]===d){t.push(o);break}}}for(let s=0;s<16;s++){const t=new Se;t.set(Ds[s],ks[s],Os[s],Ns[s],0,0),xb.push(t)}}Q3();const Ue={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Ds[s],uY:s=>ks[s],vX:s=>Os[s],vY:s=>Ns[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>n_[s][t],sub:(s,t)=>n_[s][Ue.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?Ue.S:Ue.N:Math.abs(t)*2<=Math.abs(s)?s>0?Ue.E:Ue.W:t>0?s>0?Ue.SE:Ue.SW:s>0?Ue.NE:Ue.NW,matrixAppendRotationInv:(s,t,e=0,n=0)=>{const l=xb[Ue.inv(t)];l.tx=e,l.ty=n,s.append(l)}};class An{constructor(t,e,n=0,l=0){this._x=n,this._y=l,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new An(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}An.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const s_=class{constructor(){this.worldTransform=new Se,this.localTransform=new Se,this.position=new An(this.onChange,this,0,0),this.scale=new An(this.onChange,this,1,1),this.pivot=new An(this.onChange,this,0,0),this.skew=new An(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const e=s.worldTransform,n=this.worldTransform;n.a=t.a*e.a+t.b*e.c,n.b=t.a*e.b+t.b*e.d,n.c=t.c*e.a+t.d*e.c,n.d=t.c*e.b+t.d*e.d,n.tx=t.tx*e.a+t.ty*e.c+e.tx,n.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};s_.IDENTITY=new s_;let Q_=s_;Q_.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var tM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,eM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function h0(s,t,e){const n=s.createShader(t);return s.shaderSource(n,e),s.compileShader(n),n}function Zf(s){const t=new Array(s);for(let e=0;e<t.length;e++)t[e]=!1;return t}function bb(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Zf(2*t);case"bvec3":return Zf(3*t);case"bvec4":return Zf(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const mo=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,t)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,t)=>s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,t)=>s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,t)=>s.type==="vec3"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],iM={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},rM={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function nM(s,t){var n;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const l in s.uniforms){const h=t[l];if(!h){((n=s.uniforms[l])==null?void 0:n.group)===!0&&(s.uniforms[l].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${l}, '${l}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${l}, syncData);
                    `));continue}const d=s.uniforms[l];let o=!1;for(let _=0;_<mo.length;_++)if(mo[_].test(h,d)){e.push(mo[_].code(l,d)),o=!0;break}if(!o){const _=(h.size===1&&!h.isArray?iM:rM)[h.type].replace("location",`ud["${l}"].location`);e.push(`
            cu = ud["${l}"];
            cv = cu.value;
            v = uv["${l}"];
            ${_};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const wb={};let Ia=wb;function sM(){if(Ia===wb||Ia!=null&&Ia.isContextLost()){const s=wt.ADAPTER.createCanvas();let t;wt.PREFER_ENV>=aa.WEBGL2&&(t=s.getContext("webgl2",{})),t||(t=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ia=t}return Ia}let Wh;function aM(){if(!Wh){Wh=nr.MEDIUM;const s=sM();if(s&&s.getShaderPrecisionFormat){const t=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);t&&(Wh=t.precision?nr.HIGH:nr.MEDIUM)}}return Wh}function u0(s,t){const e=s.getShaderSource(t).split(`
`).map((m,v)=>`${v}: ${m}`),n=s.getShaderInfoLog(t),l=n.split(`
`),h={},d=l.map(m=>parseFloat(m.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(m=>m&&!h[m]?(h[m]=!0,!0):!1),o=[""];d.forEach(m=>{e[m-1]=`%c${e[m-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const _=e.join(`
`);o[0]=_,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function oM(s,t,e,n){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||u0(s,e),s.getShaderParameter(n,s.COMPILE_STATUS)||u0(s,n),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}const lM={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Sb(s){return lM[s]}let Xh=null;const c0={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Eb(s,t){if(!Xh){const e=Object.keys(c0);Xh={};for(let n=0;n<e.length;++n){const l=e[n];Xh[s[l]]=c0[l]}}return Xh[t]}function d0(s,t,e){if(s.substring(0,9)!=="precision"){let n=t;return t===nr.HIGH&&e!==nr.HIGH&&(n=nr.MEDIUM),`precision ${n} float;
${s}`}else if(e!==nr.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let rl;function hM(){if(typeof rl=="boolean")return rl;try{rl=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{rl=!1}return rl}let uM=0;const Yh={},a_=class Qa{constructor(t,e,n="pixi-shader",l={}){this.extra={},this.id=uM++,this.vertexSrc=t||Qa.defaultVertexSrc,this.fragmentSrc=e||Qa.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=l,this.vertexSrc.substring(0,8)!=="#version"&&(n=n.replace(/\s+/g,"-"),Yh[n]?(Yh[n]++,n+=`-${Yh[n]}`):Yh[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}
${this.fragmentSrc}`,this.vertexSrc=d0(this.vertexSrc,Qa.defaultVertexPrecision,nr.HIGH),this.fragmentSrc=d0(this.fragmentSrc,Qa.defaultFragmentPrecision,aM())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return eM}static get defaultFragmentSrc(){return tM}static from(t,e,n){const l=t+e;let h=n0[l];return h||(n0[l]=h=new Qa(t,e,n)),h}};a_.defaultVertexPrecision=nr.HIGH,a_.defaultFragmentPrecision=Tn.apple.device?nr.HIGH:nr.MEDIUM;let Cn=a_,cM=0;class Ar{constructor(t,e,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=cM++,this.static=!!e,this.ubo=!!n,t instanceof Ne?(this.buffer=t,this.buffer.type=Zr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ne(new Float32Array(1)),this.buffer.type=Zr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,n){if(!this.ubo)this.uniforms[t]=new Ar(e,n);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,n){return new Ar(t,e,n)}static uboFrom(t,e){return new Ar(t,e??!0,!0)}}class Jr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Ar?this.uniformGroup=e:this.uniformGroup=new Ar(e):this.uniformGroup=new Ar({}),this.disposeRunner=new Tr("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const n in e.uniforms){const l=e.uniforms[n];if(l.group===!0&&this.checkUniformExists(t,l))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,n){const l=Cn.from(t,e);return new Jr(l,n)}}class dM{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const n=new Int32Array(t);for(let h=0;h<t;h++)n[h]=h;this.defaultGroupCache[t]=Ar.from({uSamplers:n},!0);let l=this.fragTemplate;l=l.replace(/%count%/gi,`${t}`),l=l.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Cn(this.vertexSrc,l)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Se,default:this.defaultGroupCache[t]};return new Jr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let n=0;n<t;n++)n>0&&(e+=`
else `),n<t-1&&(e+=`if(vTextureId < ${n}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${n}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class o_{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function fM(){return!Tn.apple.device}function pM(s){let t=!0;const e=wt.ADAPTER.getNavigator();if(Tn.tablet||Tn.phone){if(Tn.apple.device){const n=e.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)<11&&(t=!1)}if(Tn.android.device){const n=e.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)<7&&(t=!1)}}return t?s:4}class Gc{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var _M=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,gM=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const gl=class vr extends Gc{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=vb,this.vertexSize=6,this.state=tn.for2d(),this.size=vr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??pM(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??fM(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return ne("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return gM}static get defaultFragmentTemplate(){return _M}setShaderGenerator({vertex:t=vr.defaultVertexSrc,fragment:e=vr.defaultFragmentTemplate}={}){this.shaderGenerator=new dM(t,e)}contextChange(){const t=this.renderer.gl;wt.PREFER_ENV===aa.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),vr.defaultMaxTextures),this.maxTextures=V3(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=vr,n=this.size/4,l=Math.floor(n/this.maxTextures)+1;for(;t.length<n;)t.push(new r_);for(;e.length<l;)e.push(new o_);for(let h=0;h<this.maxTextures;h++)this._tempBoundTextures[h]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,n=vr._textureArrayPool,l=this.renderer.batch,h=this._tempBoundTextures,d=this.renderer.textureGC.count;let o=++qt._globalBatch,_=0,m=n[0],v=0;l.copyBoundTextures(h,e);for(let w=0;w<this._bufferSize;++w){const x=t[w];t[w]=null,x._batchEnabled!==o&&(m.count>=e&&(l.boundArray(m,h,o,e),this.buildDrawCalls(m,v,w),v=w,m=n[++_],++o),x._batchEnabled=o,x.touched=d,m.elements[m.count++]=x)}m.count>0&&(l.boundArray(m,h,o,e),this.buildDrawCalls(m,v,this._bufferSize),++_,++o);for(let w=0;w<h.length;w++)h[w]=null;qt._globalBatch=o}buildDrawCalls(t,e,n){const{_bufferedElements:l,_attributeBuffer:h,_indexBuffer:d,vertexSize:o}=this,_=vr._drawCallPool;let m=this._dcIndex,v=this._aIndex,w=this._iIndex,x=_[m];x.start=this._iIndex,x.texArray=t;for(let T=e;T<n;++T){const r=l[T],a=r._texture.baseTexture,u=_b[a.alphaMode?1:0][r.blendMode];l[T]=null,e<T&&x.blend!==u&&(x.size=w-x.start,e=T,x=_[++m],x.texArray=t,x.start=w),this.packInterleavedGeometry(r,h,d,v,w),v+=r.vertexData.length/2*o,w+=r.indices.length,x.blend=u}e<n&&(x.size=w-x.start,++m),this._dcIndex=m,this._aIndex=v,this._iIndex=w}bindAndClearTexArray(t){const e=this.renderer.texture;for(let n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:n}=this;vr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:n}=this.renderer,l=vr._drawCallPool;let h=null;for(let d=0;d<t;d++){const{texArray:o,type:_,size:m,start:v,blend:w}=l[d];h!==o&&(h=o,this.bindAndClearTexArray(o)),this.state.blendMode=w,n.set(this.state),e.drawElements(_,m,e.UNSIGNED_SHORT,v*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),vr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=dc(Math.ceil(t/8)),n=i0(e),l=e*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let h=this._aBuffers[l];return h||(this._aBuffers[l]=h=new t_(l*this.vertexSize*4)),h}getIndexBuffer(t){const e=dc(Math.ceil(t/12)),n=i0(e),l=e*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let h=this._iBuffers[n];return h||(this._iBuffers[n]=h=new Uint16Array(l)),h}packInterleavedGeometry(t,e,n,l,h){const{uint32View:d,float32View:o}=e,_=l/this.vertexSize,m=t.uvs,v=t.indices,w=t.vertexData,x=t._texture.baseTexture._batchLocation,T=Math.min(t.worldAlpha,1),r=we.shared.setValue(t._tintRGB).toPremultiplied(T,t._texture.baseTexture.alphaMode>0);for(let a=0;a<w.length;a+=2)o[l++]=w[a],o[l++]=w[a+1],o[l++]=m[a],o[l++]=m[a+1],d[l++]=r,o[l++]=x;for(let a=0;a<v.length;a++)n[h++]=_+v[a]}};gl.defaultBatchSize=4096,gl.extension={name:"batch",type:yt.RendererPlugin},gl._drawCallPool=[],gl._textureArrayPool=[];let zs=gl;Ut.add(zs);var mM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,yM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const l_=class ml extends Jr{constructor(t,e,n){const l=Cn.from(t||ml.defaultVertexSrc,e||ml.defaultFragmentSrc);super(l,n),this.padding=0,this.resolution=ml.defaultResolution,this.multisample=ml.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new tn}apply(t,e,n,l,h){t.applyFilter(this,e,n,l)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return yM}static get defaultFragmentSrc(){return mM}};l_.defaultResolution=1,l_.defaultMultisample=Ge.NONE;let Si=l_;class _c{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new we(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:n,backgroundAlpha:l}=t,h=n??e;h!==void 0&&(this.color=h),this.alpha=l}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}_c.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},_c.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"background"};Ut.add(_c);class Tb{constructor(t){this.renderer=t,this.emptyRenderer=new Gc(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:n}=this.renderer.texture;for(let l=e-1;l>=0;--l)t[l]=n[l]||null,t[l]&&(t[l]._batchLocation=l)}boundArray(t,e,n,l){const{elements:h,ids:d,count:o}=t;let _=0;for(let m=0;m<o;m++){const v=h[m],w=v._batchLocation;if(w>=0&&w<l&&e[w]===v){d[m]=w;continue}for(;_<l;){const x=e[_];if(x&&x._batchEnabled===n&&x._batchLocation===_){_++;continue}d[m]=_,v._batchLocation=_,e[_]=v;break}}}destroy(){this.renderer=null}}Tb.extension={type:yt.RendererSystem,name:"batch"};Ut.add(Tb);let f0=0;class gc{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=f0++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=f0++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let n;if(wt.PREFER_ENV>=aa.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const l=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=l,l||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}gc.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},gc.extension={type:yt.RendererSystem,name:"context"};Ut.add(gc);class h_{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Tr("disposeFramebuffer"),this.multisample=Ge.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new qt(null,{scaleMode:En.NEAREST,resolution:1,mipmap:Qr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new qt(null,{scaleMode:En.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Qr.OFF,format:ft.DEPTH_COMPONENT,type:Bt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const l=this.colorTextures[n],h=l.resolution;l.setSize(t/h,e/h)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Ab extends qt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],n=arguments[1],l=arguments[2],h=arguments[3];t={width:e,height:n,scaleMode:l,resolution:h}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Ge.NONE),super(null,t),this.mipmap=Qr.OFF,this.valid=!0,this._clear=new we([0,0,0,0]),this.framebuffer=new h_(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Rn extends kl{constructor(t){const e=t,n=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,l=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(n,l),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,n){n===void 0&&!e.startsWith("data:")?t.crossOrigin=G3(e):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")}upload(t,e,n,l){const h=t.gl,d=e.realWidth,o=e.realHeight;if(l=l||this.source,typeof HTMLImageElement<"u"&&l instanceof HTMLImageElement){if(!l.complete||l.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&l instanceof HTMLVideoElement&&l.readyState<=1)return!1;return h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ri.UNPACK),!this.noSubImage&&e.target===h.TEXTURE_2D&&n.width===d&&n.height===o?h.texSubImage2D(h.TEXTURE_2D,0,0,0,e.format,n.type,l):(n.width=d,n.height=o,h.texImage2D(e.target,0,n.internalFormat,e.format,n.type,l)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(e,n),super.update()}dispose(){this.source=null}}class Cb extends Rn{constructor(t,e){if(e=e||{},typeof t=="string"){const n=new Image;Rn.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??wt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,n)=>{const l=this.source;this.url=l.src;const h=()=>{this.destroyed||(l.onload=null,l.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};l.complete&&l.src?h():(l.onload=h,l.onerror=d=>{n(d),this.onError.emit(d)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,n=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then(l=>l.blob()).then(l=>e(l,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ri.UNPACK?"premultiply":"none"})).then(l=>this.destroyed?Promise.reject():(this.bitmap=l,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,n){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,n,this.bitmap),!this.preserveBitmap){let l=!0;const h=e._glTextures;for(const d in h){const o=h[d];if(o!==n&&o.dirtyId!==e.dirtyId){l=!1;break}}l&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class tg{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,n){const l=e.width,h=e.height;if(n){const d=t.width/2/l,o=t.height/2/h,_=t.x/l+d,m=t.y/h+o;n=Ue.add(n,Ue.NW),this.x0=_+d*Ue.uX(n),this.y0=m+o*Ue.uY(n),n=Ue.add(n,2),this.x1=_+d*Ue.uX(n),this.y1=m+o*Ue.uY(n),n=Ue.add(n,2),this.x2=_+d*Ue.uX(n),this.y2=m+o*Ue.uY(n),n=Ue.add(n,2),this.x3=_+d*Ue.uX(n),this.y3=m+o*Ue.uY(n)}else this.x0=t.x/l,this.y0=t.y/h,this.x1=(t.x+t.width)/l,this.y1=t.y/h,this.x2=(t.x+t.width)/l,this.y2=(t.y+t.height)/h,this.x3=t.x/l,this.y3=(t.y+t.height)/h;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}tg.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const p0=new tg;function jh(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class Ct extends Gl{constructor(t,e,n,l,h,d,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Jt(0,0,1,1)),t instanceof Ct&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=l,this.valid=!1,this.destroyed=!1,this._uvs=p0,this.uvMatrix=null,this.orig=n||e,this._rotate=Number(h||0),h===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=d?new ue(d.x,d.y):new ue(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&Gr[e.url]&&Ct.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ct.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var l;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),n=new Ct(this.baseTexture,!this.noFrame&&t,e,(l=this.trim)==null?void 0:l.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===p0&&(this._uvs=new tg),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},n=wt.STRICT_TEXTURE_CACHE){const l=typeof t=="string";let h=null;if(l)h=t;else if(t instanceof qt){if(!t.cacheId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${o}-${ra()}`,qt.addToCache(t,t.cacheId)}h=t.cacheId}else{if(!t._pixiId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${ra()}`}h=t._pixiId}let d=Gr[h];if(l&&n&&!d)throw new Error(`The cacheId "${h}" does not exist in TextureCache.`);return!d&&!(t instanceof qt)?(e.resolution||(e.resolution=Pn(t)),d=new Ct(new qt(t,e)),d.baseTexture.cacheId=h,qt.addToCache(d.baseTexture,h),Ct.addToCache(d,h)):!d&&t instanceof qt&&(d=new Ct(t),Ct.addToCache(d,h)),d}static fromURL(t,e){const n=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),l=Ct.from(t,Object.assign({resourceOptions:n},e),!1),h=l.baseTexture.resource;return l.baseTexture.valid?Promise.resolve(l):h.load().then(()=>Promise.resolve(l))}static fromBuffer(t,e,n,l){return new Ct(qt.fromBuffer(t,e,n,l))}static fromLoader(t,e,n,l){const h=new qt(t,Object.assign({scaleMode:qt.defaultOptions.scaleMode,resolution:Pn(e)},l)),{resource:d}=h;d instanceof Cb&&(d.url=e);const o=new Ct(h);return n||(n=e),qt.addToCache(o.baseTexture,n),Ct.addToCache(o,n),n!==e&&(qt.addToCache(o.baseTexture,e),Ct.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(_=>{o.baseTexture.once("loaded",()=>_(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Gr[e]&&Gr[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Gr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Gr[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Gr[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Gr[t.textureCacheIds[e]]===t&&delete Gr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:n,width:l,height:h}=t,d=e+l>this.baseTexture.width,o=n+h>this.baseTexture.height;if(d||o){const _=d&&o?"and":"or",m=`X: ${e} + ${l} = ${e+l} > ${this.baseTexture.width}`,v=`Y: ${n} + ${h} = ${n+h} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${m} ${_} ${v}`)}this.valid=l&&h&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ct._EMPTY||(Ct._EMPTY=new Ct(new qt),jh(Ct._EMPTY),jh(Ct._EMPTY.baseTexture)),Ct._EMPTY}static get WHITE(){if(!Ct._WHITE){const t=wt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ct._WHITE=new Ct(qt.from(t)),jh(Ct._WHITE),jh(Ct._WHITE.baseTexture)}return Ct._WHITE}}class oa extends Ct{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,n=!0){const l=this.baseTexture.resolution,h=Math.round(t*l)/l,d=Math.round(e*l)/l;this.valid=h>0&&d>0,this._frame.width=this.orig.width=h,this._frame.height=this.orig.height=d,n&&this.baseTexture.resize(h,d),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new oa(new Ab(t))}}class Ub{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,n=Ge.NONE){const l=new Ab(Object.assign({width:t,height:e,resolution:1,multisample:n},this.textureOptions));return new oa(l)}getOptimalTexture(t,e,n=1,l=Ge.NONE){let h;t=Math.max(Math.ceil(t*n-1e-6),1),e=Math.max(Math.ceil(e*n-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=dc(t),e=dc(e),h=((t&65535)<<16|e&65535)>>>0,l>1&&(h+=l*4294967296)):h=l>1?-l:-1,this.texturePool[h]||(this.texturePool[h]=[]);let d=this.texturePool[h].pop();return d||(d=this.createTexture(t,e,l)),d.filterPoolKey=h,d.setResolution(n),d}getFilterTexture(t,e,n){const l=this.getOptimalTexture(t.width,t.height,e||t.resolution,n||Ge.NONE);return l.filterFrame=t.filterFrame,l}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const n=this.texturePool[e];if(n)for(let l=0;l<n.length;l++)n[l].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const n=this.texturePool[e];if(n)for(let l=0;l<n.length;l++)n[l].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Ub.SCREEN_KEY=-1;class vM extends hs{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ib extends hs{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ne(this.vertices),this.uvBuffer=new Ne(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let n=0,l=0;return this.uvs[0]=n,this.uvs[1]=l,this.uvs[2]=n+e.width/t.width,this.uvs[3]=l,this.uvs[4]=n+e.width/t.width,this.uvs[5]=l+e.height/t.height,this.uvs[6]=n,this.uvs[7]=l+e.height/t.height,n=e.x,l=e.y,this.vertices[0]=n,this.vertices[1]=l,this.vertices[2]=n+e.width,this.vertices[3]=l,this.vertices[4]=n+e.width,this.vertices[5]=l+e.height,this.vertices[6]=n,this.vertices[7]=l+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class xM{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Ge.NONE,this.sourceFrame=new Jt,this.destinationFrame=new Jt,this.bindingSourceFrame=new Jt,this.bindingDestinationFrame=new Jt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const qh=[new ue,new ue,new ue,new ue],Jf=new Se;class Pb{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Ub,this.statePool=[],this.quad=new vM,this.quadUv=new Ib,this.tempRect=new Jt,this.activeState={},this.globalUniforms=new Ar({outputFrame:new Jt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const n=this.renderer,l=this.defaultFilterStack,h=this.statePool.pop()||new xM,d=n.renderTexture;let o,_;if(d.current){const u=d.current;o=u.resolution,_=u.multisample}else o=n.resolution,_=n.multisample;let m=e[0].resolution||o,v=e[0].multisample??_,w=e[0].padding,x=e[0].autoFit,T=e[0].legacy??!0;for(let u=1;u<e.length;u++){const f=e[u];m=Math.min(m,f.resolution||o),v=Math.min(v,f.multisample??_),w=this.useMaxPadding?Math.max(w,f.padding):w+f.padding,x=x&&f.autoFit,T=T||(f.legacy??!0)}l.length===1&&(this.defaultFilterStack[0].renderTexture=d.current),l.push(h),h.resolution=m,h.multisample=v,h.legacy=T,h.target=t,h.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),h.sourceFrame.pad(w);const r=this.tempRect.copyFrom(d.sourceFrame);n.projection.transform&&this.transformAABB(Jf.copyFrom(n.projection.transform).invert(),r),x?(h.sourceFrame.fit(r),(h.sourceFrame.width<=0||h.sourceFrame.height<=0)&&(h.sourceFrame.width=0,h.sourceFrame.height=0)):h.sourceFrame.intersects(r)||(h.sourceFrame.width=0,h.sourceFrame.height=0),this.roundFrame(h.sourceFrame,d.current?d.current.resolution:n.resolution,d.sourceFrame,d.destinationFrame,n.projection.transform),h.renderTexture=this.getOptimalFilterTexture(h.sourceFrame.width,h.sourceFrame.height,m,v),h.filters=e,h.destinationFrame.width=h.renderTexture.width,h.destinationFrame.height=h.renderTexture.height;const a=this.tempRect;a.x=0,a.y=0,a.width=h.sourceFrame.width,a.height=h.sourceFrame.height,h.renderTexture.filterFrame=h.sourceFrame,h.bindingSourceFrame.copyFrom(d.sourceFrame),h.bindingDestinationFrame.copyFrom(d.destinationFrame),h.transform=n.projection.transform,n.projection.transform=null,d.bind(h.renderTexture,h.sourceFrame,a),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;const l=this.globalUniforms.uniforms;l.outputFrame=e.sourceFrame,l.resolution=e.resolution;const h=l.inputSize,d=l.inputPixel,o=l.inputClamp;if(h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=1/h[0],h[3]=1/h[1],d[0]=Math.round(h[0]*e.resolution),d[1]=Math.round(h[1]*e.resolution),d[2]=1/d[0],d[3]=1/d[1],o[0]=.5*d[2],o[1]=.5*d[3],o[2]=e.sourceFrame.width*h[2]-.5*d[2],o[3]=e.sourceFrame.height*h[3]-.5*d[3],e.legacy){const m=l.filterArea;m[0]=e.destinationFrame.width,m[1]=e.destinationFrame.height,m[2]=e.sourceFrame.x,m[3]=e.sourceFrame.y,l.filterClamp=l.inputClamp}this.globalUniforms.update();const _=t[t.length-1];if(this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,e.renderTexture,_.renderTexture,Yr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let m=e.renderTexture,v=this.getOptimalFilterTexture(m.width,m.height,e.resolution);v.filterFrame=m.filterFrame;let w=0;for(w=0;w<n.length-1;++w){w===1&&e.multisample>1&&(v=this.getOptimalFilterTexture(m.width,m.height,e.resolution),v.filterFrame=m.filterFrame),n[w].apply(this,m,v,Yr.CLEAR,e);const x=m;m=v,v=x}n[w].apply(this,m,_.renderTexture,Yr.BLEND,e),w>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(m),this.returnFilterTexture(v)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Yr.CLEAR){const{renderTexture:n,state:l}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const d=this.tempRect;d.x=0,d.y=0,d.width=t.filterFrame.width,d.height=t.filterFrame.height,n.bind(t,t.filterFrame,d)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const h=l.stateId&1||this.forceClear;(e===Yr.CLEAR||e===Yr.BLIT&&h)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,n,l){const h=this.renderer;h.state.set(t.state),this.bindAndClear(n,l),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,h.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),h.geometry.bind(this.quadUv),h.geometry.draw(Kr.TRIANGLES)):(h.geometry.bind(this.quad),h.geometry.draw(Kr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:n,destinationFrame:l}=this.activeState,{orig:h}=e._texture,d=t.set(l.width,0,0,l.height,n.x,n.y),o=e.worldTransform.copyTo(Se.TEMP_MATRIX);return o.invert(),d.prepend(o),d.scale(1/h.width,1/h.height),d.translate(e.anchor.x,e.anchor.y),d}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,n=1,l=Ge.NONE){return this.texturePool.getOptimalTexture(t,e,n,l)}getFilterTexture(t,e,n){if(typeof t=="number"){const h=t;t=e,e=h}t=t||this.activeState.renderTexture;const l=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,n||Ge.NONE);return l.filterFrame=t.filterFrame,l}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const n=qh[0],l=qh[1],h=qh[2],d=qh[3];n.set(e.left,e.top),l.set(e.left,e.bottom),h.set(e.right,e.top),d.set(e.right,e.bottom),t.apply(n,n),t.apply(l,l),t.apply(h,h),t.apply(d,d);const o=Math.min(n.x,l.x,h.x,d.x),_=Math.min(n.y,l.y,h.y,d.y),m=Math.max(n.x,l.x,h.x,d.x),v=Math.max(n.y,l.y,h.y,d.y);e.x=o,e.y=_,e.width=m-o,e.height=v-_}roundFrame(t,e,n,l,h){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(h){const{a:d,b:o,c:_,d:m}=h;if((Math.abs(o)>1e-4||Math.abs(_)>1e-4)&&(Math.abs(d)>1e-4||Math.abs(m)>1e-4))return}h=h?Jf.copyFrom(h):Jf.identity(),h.translate(-n.x,-n.y).scale(l.width/n.width,l.height/n.height).translate(l.x,l.y),this.transformAABB(h,t),t.ceil(e),this.transformAABB(h.invert(),t)}}}Pb.extension={type:yt.RendererSystem,name:"filter"};Ut.add(Pb);class bM{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Ge.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const wM=new Jt;class Rb{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new h_(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Jt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;wt.PREFER_ENV===aa.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=l=>e.drawBuffersWEBGL(l):(this.hasMRT=!1,t.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,n=0){const{gl:l}=this;if(t){const h=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,l.bindFramebuffer(l.FRAMEBUFFER,h.framebuffer)),h.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,h.mipLevel=n),h.dirtyId!==t.dirtyId&&(h.dirtyId=t.dirtyId,h.dirtyFormat!==t.dirtyFormat?(h.dirtyFormat=t.dirtyFormat,h.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):h.dirtySize!==t.dirtySize&&(h.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let d=0;d<t.colorTextures.length;d++){const o=t.colorTextures[d];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const d=e.width>>n,o=e.height>>n,_=d/e.width;this.setViewport(e.x*_,e.y*_,d,o)}else{const d=t.width>>n,o=t.height>>n;this.setViewport(0,0,d,o)}}else this.current&&(this.current=null,l.bindFramebuffer(l.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,n,l){const h=this.viewport;t=Math.round(t),e=Math.round(e),n=Math.round(n),l=Math.round(l),(h.width!==n||h.height!==l||h.x!==t||h.y!==e)&&(h.x=t,h.y=e,h.width=n,h.height=l,this.gl.viewport(t,e,n,l))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,n,l,h=kp.COLOR|kp.DEPTH){const{gl:d}=this;d.clearColor(t,e,n,l),d.clear(h)}initFramebuffer(t){const{gl:e}=this,n=new bM(e.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:e}=this,n=t.glFramebuffers[this.CONTEXT_UID];if(n.stencil){e.bindRenderbuffer(e.RENDERBUFFER,n.stencil);let d;this.renderer.context.webGLVersion===1?d=e.DEPTH_STENCIL:t.depth&&t.stencil?d=e.DEPTH24_STENCIL8:t.depth?d=e.DEPTH_COMPONENT24:d=e.STENCIL_INDEX8,n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,d,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,d,t.width,t.height)}const l=t.colorTextures;let h=l.length;e.drawBuffers||(h=Math.min(h,1));for(let d=0;d<h;d++){const o=l[d],_=o.parentTextureArray||o;this.renderer.texture.bind(_,0),d===0&&n.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,n.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,_._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:n}=this,l=t.glFramebuffers[this.CONTEXT_UID],h=t.colorTextures;let d=h.length;n.drawBuffers||(d=Math.min(d,1)),l.multisample>1&&this.canMultisampleFramebuffer(t)?l.msaaBuffer=l.msaaBuffer||n.createRenderbuffer():l.msaaBuffer&&(n.deleteRenderbuffer(l.msaaBuffer),l.msaaBuffer=null,l.blitFramebuffer&&(l.blitFramebuffer.dispose(),l.blitFramebuffer=null));const o=[];for(let _=0;_<d;_++){const m=h[_],v=m.parentTextureArray||m;this.renderer.texture.bind(v,0),_===0&&l.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,l.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,l.multisample,v._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,l.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+_,m.target,v._glTextures[this.CONTEXT_UID].texture,e),o.push(n.COLOR_ATTACHMENT0+_))}if(o.length>1&&n.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const _=t.depthTexture;this.renderer.texture.bind(_,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,_._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){l.stencil=l.stencil||n.createRenderbuffer();let _,m;this.renderer.context.webGLVersion===1?(_=n.DEPTH_STENCIL_ATTACHMENT,m=n.DEPTH_STENCIL):t.depth&&t.stencil?(_=n.DEPTH_STENCIL_ATTACHMENT,m=n.DEPTH24_STENCIL8):t.depth?(_=n.DEPTH_ATTACHMENT,m=n.DEPTH_COMPONENT24):(_=n.STENCIL_ATTACHMENT,m=n.STENCIL_INDEX8),n.bindRenderbuffer(n.RENDERBUFFER,l.stencil),l.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,l.multisample,m,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,m,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,_,n.RENDERBUFFER,l.stencil)}else l.stencil&&(n.deleteRenderbuffer(l.stencil),l.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let n=Ge.NONE;if(t<=1||e===null)return n;for(let l=0;l<e.length;l++)if(e[l]<=t){n=e[l];break}return n===1&&(n=Ge.NONE),n}blit(t,e,n){const{current:l,renderer:h,gl:d,CONTEXT_UID:o}=this;if(h.context.webGLVersion!==2||!l)return;const _=l.glFramebuffers[o];if(!_)return;if(!t){if(!_.msaaBuffer)return;const v=l.colorTextures[0];if(!v)return;_.blitFramebuffer||(_.blitFramebuffer=new h_(l.width,l.height),_.blitFramebuffer.addColorTexture(0,v)),t=_.blitFramebuffer,t.colorTextures[0]!==v&&(t.colorTextures[0]=v,t.dirtyId++,t.dirtyFormat++),(t.width!==l.width||t.height!==l.height)&&(t.width=l.width,t.height=l.height,t.dirtyId++,t.dirtySize++)}e||(e=wM,e.width=l.width,e.height=l.height),n||(n=e);const m=e.width===n.width&&e.height===n.height;this.bind(t),d.bindFramebuffer(d.READ_FRAMEBUFFER,_.framebuffer),d.blitFramebuffer(e.left,e.top,e.right,e.bottom,n.left,n.top,n.right,n.bottom,d.COLOR_BUFFER_BIT,m?d.NEAREST:d.LINEAR),d.bindFramebuffer(d.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const n=t.glFramebuffers[this.CONTEXT_UID],l=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const h=this.managedFramebuffers.indexOf(t);h>=0&&this.managedFramebuffers.splice(h,1),t.disposeRunner.remove(this),e||(l.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&l.deleteRenderbuffer(n.msaaBuffer),n.stencil&&l.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&this.disposeFramebuffer(n.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const n=t.width,l=t.height,h=this.gl,d=e.stencil=h.createRenderbuffer();h.bindRenderbuffer(h.RENDERBUFFER,d);let o,_;this.renderer.context.webGLVersion===1?(o=h.DEPTH_STENCIL_ATTACHMENT,_=h.DEPTH_STENCIL):t.depth?(o=h.DEPTH_STENCIL_ATTACHMENT,_=h.DEPTH24_STENCIL8):(o=h.STENCIL_ATTACHMENT,_=h.STENCIL_INDEX8),e.msaaBuffer?h.renderbufferStorageMultisample(h.RENDERBUFFER,e.multisample,_,n,l):h.renderbufferStorage(h.RENDERBUFFER,_,n,l),h.framebufferRenderbuffer(h.FRAMEBUFFER,o,h.RENDERBUFFER,d)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Jt}destroy(){this.renderer=null}}Rb.extension={type:yt.RendererSystem,name:"framebuffer"};Ut.add(Rb);const Qf={5126:4,5123:2,5121:1};class Bb{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let n=this.renderer.context.extensions.vertexArrayObject;wt.PREFER_ENV===aa.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=()=>n.createVertexArrayOES(),t.bindVertexArray=l=>n.bindVertexArrayOES(l),t.deleteVertexArray=l=>n.deleteVertexArrayOES(l)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=(l,h)=>n.vertexAttribDivisorANGLE(l,h),t.drawElementsInstanced=(l,h,d,o,_)=>n.drawElementsInstancedANGLE(l,h,d,o,_),t.drawArraysInstanced=(l,h,d,o)=>n.drawArraysInstancedANGLE(l,h,d,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:n}=this;let l=t.glVertexArrayObjects[this.CONTEXT_UID],h=!1;l||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=l={},h=!0);const d=l[e.program.id]||this.initGeometryVao(t,e,h);this._activeGeometry=t,this._activeVao!==d&&(this._activeVao=d,this.hasVao?n.bindVertexArray(d):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const l=t.buffers[n];e.update(l)}}checkCompatibility(t,e){const n=t.attributes,l=e.attributeData;for(const h in l)if(!n[h])throw new Error(`shader and geometry incompatible, geometry missing the "${h}" attribute`)}getSignature(t,e){const n=t.attributes,l=e.attributeData,h=["g",t.id];for(const d in n)l[d]&&h.push(d,l[d].location);return h.join("-")}initGeometryVao(t,e,n=!0){const l=this.gl,h=this.CONTEXT_UID,d=this.renderer.buffer,o=e.program;o.glPrograms[h]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const _=this.getSignature(t,o),m=t.glVertexArrayObjects[this.CONTEXT_UID];let v=m[_];if(v)return m[o.id]=v,v;const w=t.buffers,x=t.attributes,T={},r={};for(const a in w)T[a]=0,r[a]=0;for(const a in x)!x[a].size&&o.attributeData[a]?x[a].size=o.attributeData[a].size:x[a].size||console.warn(`PIXI Geometry attribute '${a}' size cannot be determined (likely the bound shader does not have the attribute)`),T[x[a].buffer]+=x[a].size*Qf[x[a].type];for(const a in x){const u=x[a],f=u.size;u.stride===void 0&&(T[u.buffer]===f*Qf[u.type]?u.stride=0:u.stride=T[u.buffer]),u.start===void 0&&(u.start=r[u.buffer],r[u.buffer]+=f*Qf[u.type])}v=l.createVertexArray(),l.bindVertexArray(v);for(let a=0;a<w.length;a++){const u=w[a];d.bind(u),n&&u._glBuffers[h].refCount++}return this.activateVao(t,o),m[o.id]=v,m[_]=v,l.bindVertexArray(null),d.unbind(Zr.ARRAY_BUFFER),v}disposeGeometry(t,e){var o;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],l=this.gl,h=t.buffers,d=(o=this.renderer)==null?void 0:o.buffer;if(t.disposeRunner.remove(this),!!n){if(d)for(let _=0;_<h.length;_++){const m=h[_]._glBuffers[this.CONTEXT_UID];m&&(m.refCount--,m.refCount===0&&!e&&d.dispose(h[_],e))}if(!e){for(const _ in n)if(_[0]==="g"){const m=n[_];this._activeVao===m&&this.unbind(),l.deleteVertexArray(m)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t)}activateVao(t,e){const n=this.gl,l=this.CONTEXT_UID,h=this.renderer.buffer,d=t.buffers,o=t.attributes;t.indexBuffer&&h.bind(t.indexBuffer);let _=null;for(const m in o){const v=o[m],w=d[v.buffer],x=w._glBuffers[l];if(e.attributeData[m]){_!==x&&(h.bind(w),_=x);const T=e.attributeData[m].location;if(n.enableVertexAttribArray(T),n.vertexAttribPointer(T,v.size,v.type||n.FLOAT,v.normalized,v.stride,v.start),v.instance)if(this.hasInstance)n.vertexAttribDivisor(T,v.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,n,l){const{gl:h}=this,d=this._activeGeometry;if(d.indexBuffer){const o=d.indexBuffer.data.BYTES_PER_ELEMENT,_=o===2?h.UNSIGNED_SHORT:h.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?d.instanced?h.drawElementsInstanced(t,e||d.indexBuffer.data.length,_,(n||0)*o,l||1):h.drawElements(t,e||d.indexBuffer.data.length,_,(n||0)*o):console.warn("unsupported index buffer type: uint32")}else d.instanced?h.drawArraysInstanced(t,n,e||d.getSize(),l||1):h.drawArrays(t,n,e||d.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Bb.extension={type:yt.RendererSystem,name:"geometry"};Ut.add(Bb);const _0=new Se;class Fb{constructor(t,e){this._texture=t,this.mapCoord=new Se,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const n=this.mapCoord;for(let l=0;l<t.length;l+=2){const h=t[l],d=t[l+1];e[l]=h*n.a+d*n.c+n.tx,e[l+1]=h*n.b+d*n.d+n.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const l=e.orig,h=e.trim;h&&(_0.set(l.width/h.width,0,0,l.height/h.height,-h.x/h.width,-h.y/h.height),this.mapCoord.append(_0));const d=e.baseTexture,o=this.uClampFrame,_=this.clampMargin/d.resolution,m=this.clampOffset;return o[0]=(e._frame.x+_+m)/d.width,o[1]=(e._frame.y+_+m)/d.height,o[2]=(e._frame.x+e._frame.width-_+m)/d.width,o[3]=(e._frame.y+e._frame.height-_+m)/d.height,this.uClampOffset[0]=m/d.realWidth,this.uClampOffset[1]=m/d.realHeight,this.isSimple=e._frame.width===d.width&&e._frame.height===d.height&&e.rotate===0,!0}}var SM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,EM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class TM extends Si{constructor(t,e,n){let l=null;typeof t!="string"&&e===void 0&&n===void 0&&(l=t,t=void 0,e=void 0,n=void 0),super(t||EM,e||SM,n),this.maskSprite=l,this.maskMatrix=new Se}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,n,l){const h=this._maskSprite,d=h._texture;d.valid&&(d.uvMatrix||(d.uvMatrix=new Fb(d,0)),d.uvMatrix.update(),this.uniforms.npmAlpha=d.baseTexture.alphaMode?0:1,this.uniforms.mask=d,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,h).prepend(d.uvMatrix.mapCoord),this.uniforms.alpha=h.worldAlpha,this.uniforms.maskClamp=d.uvMatrix.uClampFrame,t.applyFilter(this,e,n,l))}}class AM{constructor(t=null){this.type=qe.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Si.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=qe.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Mb{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let n=e;if(!n.isMaskData){const h=this.maskDataPool.pop()||new AM;h.pooled=!0,h.maskObject=e,n=h}const l=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(l),n._colorMask=l?l._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==qe.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case qe.SCISSOR:this.renderer.scissor.push(n);break;case qe.STENCIL:this.renderer.stencil.push(n);break;case qe.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case qe.COLOR:this.pushColorMask(n);break}n.type===qe.SPRITE&&this.maskStack.push(n)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case qe.SCISSOR:this.renderer.scissor.pop(e);break;case qe.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case qe.SPRITE:this.popSpriteMask(e);break;case qe.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const n=this.maskStack[this.maskStack.length-1];n.type===qe.SPRITE&&n._filters&&(n._filters[0].maskSprite=n.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=qe.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=qe.SCISSOR:t.type=qe.STENCIL:t.type=qe.COLOR}pushSpriteMask(t){const{maskObject:e}=t,n=t._target;let l=t._filters;l||(l=this.alphaMaskPool[this.alphaMaskIndex],l||(l=this.alphaMaskPool[this.alphaMaskIndex]=[new TM])),l[0].resolution=t.resolution,l[0].multisample=t.multisample,l[0].maskSprite=e;const h=n.filterArea;n.filterArea=e.getBounds(!0),this.renderer.filter.push(n,l),n.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,n=t._colorMask=e&t.colorMask;n!==e&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}popColorMask(t){const e=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==e&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}destroy(){this.renderer=null}}Mb.extension={type:yt.RendererSystem,name:"mask"};Ut.add(Mb);class Lb{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,n=this.getStackLength();this.maskStack=t;const l=this.getStackLength();l!==n&&(l===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const g0=new Se,m0=[],Db=class $u extends Lb{constructor(t){super(t),this.glConst=wt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:n}=t,{renderer:l}=this,h=l.renderTexture,d=n.getBounds(!0,m0.pop()??new Jt);this.roundFrameToPixels(d,h.current?h.current.resolution:l.resolution,h.sourceFrame,h.destinationFrame,l.projection.transform),e&&d.fit(e),t._scissorRectLocal=d}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:n,c:l,d:h}=t;return(Math.abs(n)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(h)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||$u.isMatrixRotated(e.worldTransform)||$u.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const n=t._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(t,e,n,l,h){$u.isMatrixRotated(h)||(h=h?g0.copyFrom(h):g0.identity(),h.translate(-n.x,-n.y).scale(l.width/n.width,l.height/n.height).translate(l.x,l.y),this.renderer.filter.transformAABB(h,t),t.fit(l),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&m0.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Db.extension={type:yt.RendererSystem,name:"scissor"};let CM=Db;Ut.add(CM);class kb extends Lb{constructor(t){super(t),this.glConst=wt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:n}=this.renderer,l=t._stencilCounter;l===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const h=t._colorMask;h!==0&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,l,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,h!==0&&(t._colorMask=h,n.colorMask((h&1)!==0,(h&2)!==0,(h&4)!==0,(h&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,l=n?n._colorMask:15;l!==0&&(n._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,l!==0&&(n._colorMask=l,e.colorMask((l&1)!==0,(l&2)!==0,(l&4)!==0,(l&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}kb.extension={type:yt.RendererSystem,name:"stencil"};Ut.add(kb);class Ob{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return ne("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return ne("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return ne("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Ob.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"_plugin"};Ut.add(Ob);class Nb{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Se,this.transform=null}update(t,e,n,l){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,l),this.transform&&this.projectionMatrix.append(this.transform);const h=this.renderer;h.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,h.globalUniforms.update(),h.shader.shader&&h.shader.syncUniformGroup(h.shader.shader.uniforms.globals)}calculateProjection(t,e,n,l){const h=this.projectionMatrix,d=l?-1:1;h.identity(),h.a=1/e.width*2,h.d=d*(1/e.height*2),h.tx=-1-e.x*h.a,h.ty=-d-e.y*h.d}setTransform(t){}destroy(){this.renderer=null}}Nb.extension={type:yt.RendererSystem,name:"projection"};Ut.add(Nb);const UM=new Q_,y0=new Jt;class zb{constructor(t){this.renderer=t,this._tempMatrix=new Se}generateTexture(t,e){const{region:n,...l}=e||{},h=(n==null?void 0:n.copyTo(y0))||t.getLocalBounds(y0,!0),d=l.resolution||this.renderer.resolution;h.width=Math.max(h.width,1/d),h.height=Math.max(h.height,1/d),l.width=h.width,l.height=h.height,l.resolution=d,l.multisample??(l.multisample=this.renderer.multisample);const o=oa.create(l);this._tempMatrix.tx=-h.x,this._tempMatrix.ty=-h.y;const _=t.transform;return t.transform=UM,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=_,o}destroy(){}}zb.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"textureGenerator"};Ut.add(zb);const Ts=new Jt,nl=new Jt;class Gb{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Jt,this.destinationFrame=new Jt,this.viewportFrame=new Jt}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,n){const l=this.renderer;this.current=t;let h,d,o;t?(h=t.baseTexture,o=h.resolution,e||(Ts.width=t.frame.width,Ts.height=t.frame.height,e=Ts),n||(nl.x=t.frame.x,nl.y=t.frame.y,nl.width=e.width,nl.height=e.height,n=nl),d=h.framebuffer):(o=l.resolution,e||(Ts.width=l._view.screen.width,Ts.height=l._view.screen.height,e=Ts),n||(n=Ts,n.width=e.width,n.height=e.height));const _=this.viewportFrame;_.x=n.x*o,_.y=n.y*o,_.width=n.width*o,_.height=n.height*o,t||(_.y=l.view.height-(_.y+_.height)),_.ceil(),this.renderer.framebuffer.bind(d,_),this.renderer.projection.update(n,e,o,!d),t?this.renderer.mask.setMaskStack(h.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(n)}clear(t,e){const n=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,l=we.shared.setValue(t||n);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&l.premultiply(l.alpha);const h=this.destinationFrame,d=this.current?this.current.baseTexture:this.renderer._view.screen,o=h.width!==d.width||h.height!==d.height;if(o){let{x:_,y:m,width:v,height:w}=this.viewportFrame;_=Math.round(_),m=Math.round(m),v=Math.round(v),w=Math.round(w),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(_,m,v,w)}this.renderer.framebuffer.clear(l.red,l.green,l.blue,l.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Gb.extension={type:yt.RendererSystem,name:"renderTexture"};Ut.add(Gb);class IM{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function PM(s,t){const e={},n=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let l=0;l<n;l++){const h=t.getActiveAttrib(s,l);if(h.name.startsWith("gl_"))continue;const d=Eb(t,h.type),o={type:d,name:h.name,size:Sb(d),location:t.getAttribLocation(s,h.name)};e[h.name]=o}return e}function RM(s,t){const e={},n=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let l=0;l<n;l++){const h=t.getActiveUniform(s,l),d=h.name.replace(/\[.*?\]$/,""),o=!!h.name.match(/\[.*?\]$/),_=Eb(t,h.type);e[d]={name:d,index:l,type:_,size:h.size,isArray:o,value:bb(_,h.size)}}return e}function BM(s,t){var o;const e=h0(s,s.VERTEX_SHADER,t.vertexSrc),n=h0(s,s.FRAGMENT_SHADER,t.fragmentSrc),l=s.createProgram();s.attachShader(l,e),s.attachShader(l,n);const h=(o=t.extra)==null?void 0:o.transformFeedbackVaryings;if(h&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(l,h.names,h.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(l),s.getProgramParameter(l,s.LINK_STATUS)||oM(s,l,e,n),t.attributeData=PM(l,s),t.uniformData=RM(l,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const _=Object.keys(t.attributeData);_.sort((m,v)=>m>v?1:-1);for(let m=0;m<_.length;m++)t.attributeData[_[m]].location=m,s.bindAttribLocation(l,m,_[m]);s.linkProgram(l)}s.deleteShader(e),s.deleteShader(n);const d={};for(const _ in t.uniformData){const m=t.uniformData[_];d[_]={location:s.getUniformLocation(l,_),value:bb(m.type,m.size)}}return new IM(l,d)}function FM(s,t,e,n,l){e.buffer.update(l)}const MM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Hb={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function LM(s){const t=s.map(h=>({data:h,offset:0,dataLen:0,dirty:0}));let e=0,n=0,l=0;for(let h=0;h<t.length;h++){const d=t[h];if(e=Hb[d.data.type],d.data.size>1&&(e=Math.max(e,16)*d.data.size),d.dataLen=e,n%e!==0&&n<16){const o=n%e%16;n+=o,l+=o}n+e>16?(l=Math.ceil(l/16)*16,d.offset=l,l+=e,n=e):(d.offset=l,n+=e,l+=e)}return l=Math.ceil(l/16)*16,{uboElements:t,size:l}}function DM(s,t){const e=[];for(const n in s)t[n]&&e.push(t[n]);return e.sort((n,l)=>n.index-l.index),e}function kM(s,t){if(!s.autoManage)return{size:0,syncFunc:FM};const e=DM(s.uniforms,t),{uboElements:n,size:l}=LM(e),h=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let d=0;d<n.length;d++){const o=n[d],_=s.uniforms[o.data.name],m=o.data.name;let v=!1;for(let w=0;w<mo.length;w++){const x=mo[w];if(x.codeUbo&&x.test(o.data,_)){h.push(`offset = ${o.offset/4};`,mo[w].codeUbo(o.data.name,_)),v=!0;break}}if(!v)if(o.data.size>1){const w=Sb(o.data.type),x=Math.max(Hb[o.data.type]/16,1),T=w/x,r=(4-T%4)%4;h.push(`
                cv = ud.${m}.value;
                v = uv.${m};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*x}; i++)
                {
                    for(var j = 0; j < ${T}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${r};
                }

                `)}else{const w=MM[o.data.type];h.push(`
                cv = ud.${m}.value;
                v = uv.${m};
                offset = ${o.offset/4};
                ${w};
                `)}}return h.push(`
       renderer.buffer.update(buffer);
    `),{size:l,syncFunc:new Function("ud","uv","renderer","syncData","buffer",h.join(`
`))}}let OM=0;const Kh={textureCount:0,uboCount:0};class $b{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=OM++}systemCheck(){if(!hM())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,l=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(l.program)),e||(Kh.textureCount=0,Kh.uboCount=0,this.syncUniformGroup(t.uniformGroup,Kh)),l}setUniforms(t){const e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,e){const n=this.getGlProgram();(!t.static||t.dirtyId!==n.uniformDirtyGroups[t.id])&&(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))}syncUniforms(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=nM(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const n=this.getGlProgram();if(!t.static||t.dirtyId!==0||!n.uniformGroups[t.id]){t.dirtyId=0;const l=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,e);t.buffer.update(),l(n.uniformData,t.uniforms,this.renderer,Kh,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[e])}createSyncBufferGroup(t,e,n){const{gl:l}=this.renderer;this.renderer.buffer.bind(t.buffer);const h=this.gl.getUniformBlockIndex(e.program,n);e.uniformBufferBindings[n]=this.shader.uniformBindCount,l.uniformBlockBinding(e.program,h,this.shader.uniformBindCount),this.shader.uniformBindCount++;const d=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[d];if(o||(o=this._uboCache[d]=kM(t,this.shader.program.uniformData)),t.autoManage){const _=new Float32Array(o.size/4);t.buffer.update(_)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,n){const l=t.uniforms,h=[`${n}-`];for(const d in l)h.push(d),e[d]&&h.push(e[d].type);return h.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,n=t.program,l=BM(e,n);return n.glPrograms[this.renderer.CONTEXT_UID]=l,l}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}$b.extension={type:yt.RendererSystem,name:"shader"};Ut.add($b);class mc{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}mc.defaultOptions={hello:!1},mc.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"startup"};Ut.add(mc);function NM(s,t=[]){return t[Vt.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.ADD]=[s.ONE,s.ONE],t[Vt.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.NONE]=[0,0],t[Vt.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t[Vt.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SRC_IN]=[s.DST_ALPHA,s.ZERO],t[Vt.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],t[Vt.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[Vt.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],t[Vt.DST_IN]=[s.ZERO,s.SRC_ALPHA],t[Vt.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],t[Vt.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],t[Vt.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[Vt.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],t}const zM=0,GM=1,HM=2,$M=3,VM=4,WM=5,Vb=class u_{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Vt.NONE,this._blendEq=!1,this.map=[],this.map[zM]=this.setBlend,this.map[GM]=this.setOffset,this.map[HM]=this.setCullFace,this.map[$M]=this.setDepthTest,this.map[VM]=this.setFrontFace,this.map[WM]=this.setDepthMask,this.checks=[],this.defaultState=new tn,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=NM(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,n=0;for(;e;)e&1&&this.map[n].call(this,!!(t.data&1<<n)),e=e>>1,n++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(u_.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(u_.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],n=this.gl;e.length===2?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const n=this.checks.indexOf(t);e&&n===-1?this.checks.push(t):!e&&n!==-1&&this.checks.splice(n,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Vb.extension={type:yt.RendererSystem,name:"state"};let XM=Vb;Ut.add(XM);class YM extends Gl{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(l=>t.systems[l]),n=[...e,...Object.keys(t.systems).filter(l=>!e.includes(l))];for(const l of n)this.addSystem(t.systems[l],l)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Tr(e)})}addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const l in this.runners)this.runners[l].add(n);return this}emitWithCustomOptions(t,e){const n=Object.keys(this._systemsHash);t.items.forEach(l=>{const h=n.find(d=>this._systemsHash[d]===l);l[t.name](e[h])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const yl=class Vu{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Vu.defaultMaxIdle,this.checkCountMax=Vu.defaultCheckCountMax,this.mode=Vu.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==W_.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let n=!1;for(let l=0;l<e.length;l++){const h=e[l];h.resource&&this.count-h.touched>this.maxIdle&&(t.destroyTexture(h,!0),e[l]=null,n=!0)}if(n){let l=0;for(let h=0;h<e.length;h++)e[h]!==null&&(e[l++]=e[h]);e.length=l}}unload(t){const e=this.renderer.texture,n=t._texture;n&&!n.framebuffer&&e.destroyTexture(n);for(let l=t.children.length-1;l>=0;l--)this.unload(t.children[l])}destroy(){this.renderer=null}};yl.defaultMode=W_.AUTO,yl.defaultMaxIdle=60*60,yl.defaultCheckCountMax=60*10,yl.extension={type:yt.RendererSystem,name:"textureGC"};let Gs=yl;Ut.add(Gs);class tp{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Bt.UNSIGNED_BYTE,this.internalFormat=ft.RGBA,this.samplerType=0}}function jM(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[s.RGB]:bt.FLOAT,[s.RGBA]:bt.FLOAT,[s.ALPHA]:bt.FLOAT,[s.LUMINANCE]:bt.FLOAT,[s.LUMINANCE_ALPHA]:bt.FLOAT,[s.R8]:bt.FLOAT,[s.R8_SNORM]:bt.FLOAT,[s.RG8]:bt.FLOAT,[s.RG8_SNORM]:bt.FLOAT,[s.RGB8]:bt.FLOAT,[s.RGB8_SNORM]:bt.FLOAT,[s.RGB565]:bt.FLOAT,[s.RGBA4]:bt.FLOAT,[s.RGB5_A1]:bt.FLOAT,[s.RGBA8]:bt.FLOAT,[s.RGBA8_SNORM]:bt.FLOAT,[s.RGB10_A2]:bt.FLOAT,[s.RGB10_A2UI]:bt.FLOAT,[s.SRGB8]:bt.FLOAT,[s.SRGB8_ALPHA8]:bt.FLOAT,[s.R16F]:bt.FLOAT,[s.RG16F]:bt.FLOAT,[s.RGB16F]:bt.FLOAT,[s.RGBA16F]:bt.FLOAT,[s.R32F]:bt.FLOAT,[s.RG32F]:bt.FLOAT,[s.RGB32F]:bt.FLOAT,[s.RGBA32F]:bt.FLOAT,[s.R11F_G11F_B10F]:bt.FLOAT,[s.RGB9_E5]:bt.FLOAT,[s.R8I]:bt.INT,[s.R8UI]:bt.UINT,[s.R16I]:bt.INT,[s.R16UI]:bt.UINT,[s.R32I]:bt.INT,[s.R32UI]:bt.UINT,[s.RG8I]:bt.INT,[s.RG8UI]:bt.UINT,[s.RG16I]:bt.INT,[s.RG16UI]:bt.UINT,[s.RG32I]:bt.INT,[s.RG32UI]:bt.UINT,[s.RGB8I]:bt.INT,[s.RGB8UI]:bt.UINT,[s.RGB16I]:bt.INT,[s.RGB16UI]:bt.UINT,[s.RGB32I]:bt.INT,[s.RGB32UI]:bt.UINT,[s.RGBA8I]:bt.INT,[s.RGBA8UI]:bt.UINT,[s.RGBA16I]:bt.INT,[s.RGBA16UI]:bt.UINT,[s.RGBA32I]:bt.INT,[s.RGBA32UI]:bt.UINT,[s.DEPTH_COMPONENT16]:bt.FLOAT,[s.DEPTH_COMPONENT24]:bt.FLOAT,[s.DEPTH_COMPONENT32F]:bt.FLOAT,[s.DEPTH_STENCIL]:bt.FLOAT,[s.DEPTH24_STENCIL8]:bt.FLOAT,[s.DEPTH32F_STENCIL8]:bt.FLOAT}:t={[s.RGB]:bt.FLOAT,[s.RGBA]:bt.FLOAT,[s.ALPHA]:bt.FLOAT,[s.LUMINANCE]:bt.FLOAT,[s.LUMINANCE_ALPHA]:bt.FLOAT,[s.DEPTH_STENCIL]:bt.FLOAT},t}function qM(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[Bt.UNSIGNED_BYTE]:{[ft.RGBA]:s.RGBA8,[ft.RGB]:s.RGB8,[ft.RG]:s.RG8,[ft.RED]:s.R8,[ft.RGBA_INTEGER]:s.RGBA8UI,[ft.RGB_INTEGER]:s.RGB8UI,[ft.RG_INTEGER]:s.RG8UI,[ft.RED_INTEGER]:s.R8UI,[ft.ALPHA]:s.ALPHA,[ft.LUMINANCE]:s.LUMINANCE,[ft.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[Bt.BYTE]:{[ft.RGBA]:s.RGBA8_SNORM,[ft.RGB]:s.RGB8_SNORM,[ft.RG]:s.RG8_SNORM,[ft.RED]:s.R8_SNORM,[ft.RGBA_INTEGER]:s.RGBA8I,[ft.RGB_INTEGER]:s.RGB8I,[ft.RG_INTEGER]:s.RG8I,[ft.RED_INTEGER]:s.R8I},[Bt.UNSIGNED_SHORT]:{[ft.RGBA_INTEGER]:s.RGBA16UI,[ft.RGB_INTEGER]:s.RGB16UI,[ft.RG_INTEGER]:s.RG16UI,[ft.RED_INTEGER]:s.R16UI,[ft.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[Bt.SHORT]:{[ft.RGBA_INTEGER]:s.RGBA16I,[ft.RGB_INTEGER]:s.RGB16I,[ft.RG_INTEGER]:s.RG16I,[ft.RED_INTEGER]:s.R16I},[Bt.UNSIGNED_INT]:{[ft.RGBA_INTEGER]:s.RGBA32UI,[ft.RGB_INTEGER]:s.RGB32UI,[ft.RG_INTEGER]:s.RG32UI,[ft.RED_INTEGER]:s.R32UI,[ft.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[Bt.INT]:{[ft.RGBA_INTEGER]:s.RGBA32I,[ft.RGB_INTEGER]:s.RGB32I,[ft.RG_INTEGER]:s.RG32I,[ft.RED_INTEGER]:s.R32I},[Bt.FLOAT]:{[ft.RGBA]:s.RGBA32F,[ft.RGB]:s.RGB32F,[ft.RG]:s.RG32F,[ft.RED]:s.R32F,[ft.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[Bt.HALF_FLOAT]:{[ft.RGBA]:s.RGBA16F,[ft.RGB]:s.RGB16F,[ft.RG]:s.RG16F,[ft.RED]:s.R16F},[Bt.UNSIGNED_SHORT_5_6_5]:{[ft.RGB]:s.RGB565},[Bt.UNSIGNED_SHORT_4_4_4_4]:{[ft.RGBA]:s.RGBA4},[Bt.UNSIGNED_SHORT_5_5_5_1]:{[ft.RGBA]:s.RGB5_A1},[Bt.UNSIGNED_INT_2_10_10_10_REV]:{[ft.RGBA]:s.RGB10_A2,[ft.RGBA_INTEGER]:s.RGB10_A2UI},[Bt.UNSIGNED_INT_10F_11F_11F_REV]:{[ft.RGB]:s.R11F_G11F_B10F},[Bt.UNSIGNED_INT_5_9_9_9_REV]:{[ft.RGB]:s.RGB9_E5},[Bt.UNSIGNED_INT_24_8]:{[ft.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[Bt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[ft.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:t={[Bt.UNSIGNED_BYTE]:{[ft.RGBA]:s.RGBA,[ft.RGB]:s.RGB,[ft.ALPHA]:s.ALPHA,[ft.LUMINANCE]:s.LUMINANCE,[ft.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[Bt.UNSIGNED_SHORT_5_6_5]:{[ft.RGB]:s.RGB},[Bt.UNSIGNED_SHORT_4_4_4_4]:{[ft.RGBA]:s.RGBA},[Bt.UNSIGNED_SHORT_5_5_5_1]:{[ft.RGBA]:s.RGBA}},t}class Wb{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new qt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=qM(t),this.samplerTypes=jM(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let l=0;l<e;l++)this.boundTextures[l]=null;this.emptyTextures={};const n=new tp(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new tp(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let l=0;l<6;l++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let l=0;l<this.boundTextures.length;l++)this.bind(null,l)}bind(t,e=0){const{gl:n}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const l=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,l.texture)),l.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)):l.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let l=0;l<n.length;l++)n[l]===this.unknownTexture&&this.bind(null,l)}for(let l=0;l<n.length;l++)n[l]===t&&(this.currentLocation!==l&&(e.activeTexture(e.TEXTURE0+l),this.currentLocation=l),e.bindTexture(t.target,this.emptyTextures[t.target].texture),n[l]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:n,CONTEXT_UID:l}=this;if(n)for(let h=t-1;h>=0;--h){const d=e[h];d&&d._glTextures[l].samplerType!==bt.FLOAT&&this.renderer.texture.unbind(d)}}initTexture(t){const e=new tp(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var n;e.internalFormat=((n=this.internalFormats[t.type])==null?void 0:n[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??bt.FLOAT,this.webGLVersion===2&&t.type===Bt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var l;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const n=this.renderer;if(this.initTextureType(t,e),(l=t.resource)==null?void 0:l.upload(n,t,e))e.samplerType!==bt.FLOAT&&(this.hasIntegerTextures=!0);else{const h=t.realWidth,d=t.realHeight,o=n.gl;(e.width!==h||e.height!==d||e.dirtyId<0)&&(e.width=h,e.height=d,o.texImage2D(t.target,0,e.internalFormat,h,d,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:n}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const l=this.managedTextures.indexOf(t);l!==-1&&go(this.managedTextures,l,1)}}updateTextureStyle(t){var n;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Qr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=os.CLAMP:e.wrapMode=t.wrapMode,(n=t.resource)!=null&&n.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const n=this.gl;if(e.mipmap&&t.mipmap!==Qr.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===En.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const l=this.renderer.context.extensions.anisotropicFiltering;if(l&&t.anisotropicLevel>0&&t.scaleMode===En.LINEAR){const h=Math.min(t.anisotropicLevel,n.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,l.TEXTURE_MAX_ANISOTROPY_EXT,h)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===En.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===En.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}Wb.extension={type:yt.RendererSystem,name:"texture"};Ut.add(Wb);class Xb{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,l=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,l)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:n,renderer:l}=this;e&&l.shader.bind(e),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:n,CONTEXT_UID:l}=this,h=e.createTransformFeedback();t._glTransformFeedbacks[l]=h,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,h);for(let d=0;d<t.buffers.length;d++){const o=t.buffers[d];o&&(n.buffer.update(o),o._glBuffers[l].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,d,o._glBuffers[l].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),h}disposeTransformFeedback(t,e){const n=t._glTransformFeedbacks[this.CONTEXT_UID],l=this.gl;t.disposeRunner.remove(this);const h=this.renderer.buffer;if(h)for(let d=0;d<t.buffers.length;d++){const o=t.buffers[d];if(!o)continue;const _=o._glBuffers[this.CONTEXT_UID];_&&(_.refCount--,_.refCount===0&&!e&&h.dispose(o,e))}n&&(e||l.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Xb.extension={type:yt.RendererSystem,name:"transformFeedback"};Ut.add(Xb);class yc{constructor(t){this.renderer=t}init(t){this.screen=new Jt(0,0,t.width,t.height),this.element=t.view||wt.ADAPTER.createCanvas(),this.resolution=t.resolution||wt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const n=this.element.width/this.resolution,l=this.element.height/this.resolution;this.screen.width=n,this.screen.height=l,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${l}px`),this.renderer.emit("resize",n,l),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}yc.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},yc.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"_view"};Ut.add(yc);wt.PREFER_ENV=aa.WEBGL2;wt.STRICT_TEXTURE_CACHE=!1;wt.RENDER_OPTIONS={...gc.defaultOptions,..._c.defaultOptions,...yc.defaultOptions,...mc.defaultOptions};Object.defineProperties(wt,{WRAP_MODE:{get(){return qt.defaultOptions.wrapMode},set(s){ne("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),qt.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return qt.defaultOptions.scaleMode},set(s){ne("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),qt.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return qt.defaultOptions.mipmap},set(s){ne("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),qt.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return qt.defaultOptions.anisotropicLevel},set(s){ne("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),qt.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return ne("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Si.defaultResolution},set(s){Si.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return ne("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Si.defaultMultisample},set(s){Si.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return zs.defaultMaxTextures},set(s){ne("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),zs.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return zs.defaultBatchSize},set(s){ne("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),zs.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return zs.canUploadSameBuffer},set(s){ne("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),zs.canUploadSameBuffer=s}},GC_MODE:{get(){return Gs.defaultMode},set(s){ne("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Gs.defaultMode=s}},GC_MAX_IDLE:{get(){return Gs.defaultMaxIdle},set(s){ne("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Gs.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return Gs.defaultCheckCountMax},set(s){ne("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Gs.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return Cn.defaultVertexPrecision},set(s){ne("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Cn.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return Cn.defaultFragmentPrecision},set(s){ne("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Cn.defaultFragmentPrecision=s}}});var na=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(na||{});class ep{constructor(t,e=null,n=0,l=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=n,this.once=l}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Yb=class zi{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ep(null,null,1/0),this.deltaMS=1/zi.targetFPMS,this.elapsedMS=1/zi.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=na.NORMAL){return this._addListener(new ep(t,e,n))}addOnce(t,e,n=na.NORMAL){return this._addListener(new ep(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(!e)t.connect(n);else{for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n.match(t,e)?n=n.destroy():n=n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const h=t-this._lastFrame|0;if(h<this._minElapsedMS)return;this._lastFrame=t-h%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*zi.targetFPMS;const n=this._head;let l=n.next;for(;l;)l=l.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,zi.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!zi._shared){const t=zi._shared=new zi;t.autoStart=!0,t._protected=!0}return zi._shared}static get system(){if(!zi._system){const t=zi._system=new zi;t.autoStart=!0,t._protected=!0}return zi._system}};Yb.targetFPMS=.06;let Hi=Yb;Object.defineProperties(wt,{TARGET_FPMS:{get(){return Hi.targetFPMS},set(s){ne("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Hi.targetFPMS=s}}});class jb{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,na.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Hi.shared:new Hi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}jb.extension=yt.Application;Ut.add(jb);const qb=[];Ut.handleByList(yt.Renderer,qb);function KM(s){for(const t of qb)if(t.test(s))return new t(s);throw new Error("Unable to auto-detect a suitable renderer.")}var ZM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,JM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const QM=ZM,Kb=JM;class Zb{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}e>=Ge.HIGH?this.multisample=Ge.HIGH:e>=Ge.MEDIUM?this.multisample=Ge.MEDIUM:e>=Ge.LOW?this.multisample=Ge.LOW:this.multisample=Ge.NONE}destroy(){}}Zb.extension={type:yt.RendererSystem,name:"_multisample"};Ut.add(Zb);class tL{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Jb{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,l=t._glBuffers[n]||this.createGLBuffer(t);e.bindBuffer(t.type,l.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:n,CONTEXT_UID:l}=this;if(this.boundBufferBases[e]!==t){const h=t._glBuffers[l]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,h.buffer)}}bindBufferRange(t,e,n){const{gl:l,CONTEXT_UID:h}=this;n=n||0;const d=t._glBuffers[h]||this.createGLBuffer(t);l.bindBufferRange(l.UNIFORM_BUFFER,e||0,d.buffer,n*256,256)}update(t){const{gl:e,CONTEXT_UID:n}=this,l=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==l.updateID)if(l.updateID=t._updateID,e.bindBuffer(t.type,l.buffer),l.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const h=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;l.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,h)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],l=this.gl;t.disposeRunner.remove(this),n&&(e||l.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let n=0;n<e.length;n++)this.dispose(this.managedBuffers[e[n]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:n}=this;return t._glBuffers[e]=new tL(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Jb.extension={type:yt.RendererSystem,name:"buffer"};Ut.add(Jb);class Qb{constructor(t){this.renderer=t}render(t,e){const n=this.renderer;let l,h,d,o;if(e&&(l=e.renderTexture,h=e.clear,d=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!l,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=d,!n.context.isLost){if(l||(this.lastObjectRendered=t),!o){const _=t.enableTempParent();t.updateTransform(),t.disableTempParent(_)}n.renderTexture.bind(l),n.batch.currentRenderer.start(),(h??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),l&&(e.blit&&n.framebuffer.blit(),l.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Qb.extension={type:yt.RendererSystem,name:"objectRenderer"};Ut.add(Qb);const Wu=class c_ extends YM{constructor(t){super(),this.type=Dx.WEBGL,t=Object.assign({},wt.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ar({projectionMatrix:new Se},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:c_.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(ne("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=c_.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:S3()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return ne("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return ne("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return ne("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return ne("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){ne("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return ne("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){ne("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return ne("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Wu.extension={type:yt.Renderer,priority:1},Wu.__plugins={},Wu.__systems={};let eg=Wu;Ut.handleByMap(yt.RendererPlugin,eg.__plugins);Ut.handleByMap(yt.RendererSystem,eg.__systems);Ut.add(eg);class tw extends kl{constructor(t,e){const{width:n,height:l}=e||{};super(n,l),this.items=[],this.itemDirtyIds=[];for(let h=0;h<t;h++){const d=new qt;this.items.push(d),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof kl?this.addResourceAt(t[n],n):this.addResourceAt(yb(t[n],e),n))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:n}=this.items[0];return this.resize(e,n),this.update(),Promise.resolve(this)}),this._load}}class eL extends tw{constructor(t,e){const{width:n,height:l}=e||{};let h,d;Array.isArray(t)?(h=t,d=t.length):d=t,super(d,{width:n,height:l}),h&&this.initFromArray(h,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=fo.TEXTURE_2D_ARRAY}upload(t,e,n){const{length:l,itemDirtyIds:h,items:d}=this,{gl:o}=t;n.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,l,0,e.format,n.type,null);for(let _=0;_<l;_++){const m=d[_];h[_]<m.dirtyId&&(h[_]=m.dirtyId,m.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,_,m.resource.width,m.resource.height,1,e.format,n.type,m.resource.source))}return!0}}class iL extends Rn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const ew=class vl extends tw{constructor(t,e){const{width:n,height:l,autoLoad:h,linkBaseTexture:d}=e||{};if(t&&t.length!==vl.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:n,height:l});for(let o=0;o<vl.SIDES;o++)this.items[o].target=fo.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=d!==!1,t&&this.initFromArray(t,e),h!==!1&&this.load()}bind(t){super.bind(t),t.target=fo.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,n){if(n===void 0&&(n=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=fo.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,n){const l=this.itemDirtyIds;for(let h=0;h<vl.SIDES;h++){const d=this.items[h];(l[h]<d.dirtyId||n.dirtyId<e.dirtyId)&&(d.valid&&d.resource?(d.resource.upload(t,d,n),l[h]=d.dirtyId):l[h]<-1&&(t.gl.texImage2D(d.target,0,n.internalFormat,e.realWidth,e.realHeight,0,e.format,n.type,null),l[h]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===vl.SIDES}};ew.SIDES=6;let rL=ew;class ho extends Rn{constructor(t,e){e=e||{};let n,l,h;typeof t=="string"?(n=ho.EMPTY,l=t,h=!0):(n=t,l=null,h=!1),super(n),this.url=l,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??h,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const n=await wt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const l=await n.blob();if(this.destroyed)return;const h=await createImageBitmap(l,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ri.UNPACK?"premultiply":"none"});if(this.destroyed){h.close();return}this.source=h,this.update(),t(this)}catch(n){if(this.destroyed)return;e(n),this.onError.emit(n)}}),this._load)}upload(t,e,n){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,n)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return ho._EMPTY=ho._EMPTY??wt.ADAPTER.createCanvas(0,0),ho._EMPTY}}const d_=class Xu extends Rn{constructor(t,e){e=e||{},super(wt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Xu.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Rn.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,n=t.height;if(!e||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let l=e*this.scale,h=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(l=this._overrideWidth||this._overrideHeight/n*e,h=this._overrideHeight||this._overrideWidth/e*n),l=Math.round(l),h=Math.round(h);const d=this.source;d.width=l,d.height=h,d._pixiId=`canvas_${ra()}`,d.getContext("2d").drawImage(t,0,0,e,n,0,0,l,h),this._resolve(),this._resolve=null}}static getSize(t){const e=Xu.SVG_SIZE.exec(t),n={};return e&&(n[e[1]]=Math.round(parseFloat(e[3])),n[e[5]]=Math.round(parseFloat(e[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Xu.SVG_XML.test(t)}};d_.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,d_.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let f_=d_;class nL extends Rn{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const p_=class __ extends Rn{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const n=document.createElement("video");e.autoLoad!==!1&&n.setAttribute("preload","auto"),e.playsinline!==!1&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),e.muted===!0&&(n.setAttribute("muted",""),n.muted=!0),e.loop===!0&&n.setAttribute("loop",""),e.autoPlay!==!1&&n.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const l=t[0].src||t[0];Rn.crossOrigin(n,l,e.crossorigin);for(let h=0;h<t.length;++h){const d=document.createElement("source");let{src:o,mime:_}=t[h];if(o=o||t[h],o.startsWith("data:"))_=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const m=o.split("?").shift().toLowerCase(),v=m.slice(m.lastIndexOf(".")+1);_=_||__.MIME_TYPES[v]||`video/${v}`}d.src=o,_&&(d.type=_),n.appendChild(d)}t=n}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Hi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,n)=>{this.valid?e(this):(this._resolve=e,this._reject=n,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Hi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Hi.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Hi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||__.TYPES.includes(e)}};p_.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],p_.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let iw=p_;e_.push(ho,Cb,iL,iw,nL,f_,kc,rL,eL);class vc{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Jt.EMPTY:(t=t||new Jt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:n,b:l,c:h,d,tx:o,ty:_}=t,m=n*e.x+h*e.y+o,v=l*e.x+d*e.y+_;this.minX=Math.min(this.minX,m),this.maxX=Math.max(this.maxX,m),this.minY=Math.min(this.minY,v),this.maxY=Math.max(this.maxY,v)}addQuad(t){let e=this.minX,n=this.minY,l=this.maxX,h=this.maxY,d=t[0],o=t[1];e=d<e?d:e,n=o<n?o:n,l=d>l?d:l,h=o>h?o:h,d=t[2],o=t[3],e=d<e?d:e,n=o<n?o:n,l=d>l?d:l,h=o>h?o:h,d=t[4],o=t[5],e=d<e?d:e,n=o<n?o:n,l=d>l?d:l,h=o>h?o:h,d=t[6],o=t[7],e=d<e?d:e,n=o<n?o:n,l=d>l?d:l,h=o>h?o:h,this.minX=e,this.minY=n,this.maxX=l,this.maxY=h}addFrame(t,e,n,l,h){this.addFrameMatrix(t.worldTransform,e,n,l,h)}addFrameMatrix(t,e,n,l,h){const d=t.a,o=t.b,_=t.c,m=t.d,v=t.tx,w=t.ty;let x=this.minX,T=this.minY,r=this.maxX,a=this.maxY,u=d*e+_*n+v,f=o*e+m*n+w;x=u<x?u:x,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,u=d*l+_*n+v,f=o*l+m*n+w,x=u<x?u:x,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,u=d*e+_*h+v,f=o*e+m*h+w,x=u<x?u:x,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,u=d*l+_*h+v,f=o*l+m*h+w,x=u<x?u:x,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,this.minX=x,this.minY=T,this.maxX=r,this.maxY=a}addVertexData(t,e,n){let l=this.minX,h=this.minY,d=this.maxX,o=this.maxY;for(let _=e;_<n;_+=2){const m=t[_],v=t[_+1];l=m<l?m:l,h=v<h?v:h,d=m>d?m:d,o=v>o?v:o}this.minX=l,this.minY=h,this.maxX=d,this.maxY=o}addVertices(t,e,n,l){this.addVerticesMatrix(t.worldTransform,e,n,l)}addVerticesMatrix(t,e,n,l,h=0,d=h){const o=t.a,_=t.b,m=t.c,v=t.d,w=t.tx,x=t.ty;let T=this.minX,r=this.minY,a=this.maxX,u=this.maxY;for(let f=n;f<l;f+=2){const g=e[f],b=e[f+1],S=o*g+m*b+w,A=v*b+_*g+x;T=Math.min(T,S-h),a=Math.max(a,S+h),r=Math.min(r,A-d),u=Math.max(u,A+d)}this.minX=T,this.minY=r,this.maxX=a,this.maxY=u}addBounds(t){const e=this.minX,n=this.minY,l=this.maxX,h=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>l?t.maxX:l,this.maxY=t.maxY>h?t.maxY:h}addBoundsMask(t,e){const n=t.minX>e.minX?t.minX:e.minX,l=t.minY>e.minY?t.minY:e.minY,h=t.maxX<e.maxX?t.maxX:e.maxX,d=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=h&&l<=d){const o=this.minX,_=this.minY,m=this.maxX,v=this.maxY;this.minX=n<o?n:o,this.minY=l<_?l:_,this.maxX=h>m?h:m,this.maxY=d>v?d:v}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const n=t.minX>e.x?t.minX:e.x,l=t.minY>e.y?t.minY:e.y,h=t.maxX<e.x+e.width?t.maxX:e.x+e.width,d=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=h&&l<=d){const o=this.minX,_=this.minY,m=this.maxX,v=this.maxY;this.minX=n<o?n:o,this.minY=l<_?l:_,this.maxX=h>m?h:m,this.maxY=d>v?d:v}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,n,l,h,d){t-=h,e-=d,n+=h,l+=d,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>l?this.maxY:l}}class Re extends Gl{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Q_,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new vc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let n=0;n<e.length;++n){const l=e[n];Object.defineProperty(Re.prototype,l,Object.getOwnPropertyDescriptor(t,l))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Jt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Jt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new vc);const e=this.transform,n=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(n==null?void 0:n.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const l=this._bounds,h=this._boundsID;this._bounds=this._localBounds;const d=this.getBounds(!1,t);return this.parent=n,this.transform=e,this._bounds=l,this._bounds.updateID+=this._boundsID-h,d}toGlobal(t,e,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,n,l){return e&&(t=e.toGlobal(t,n,l)),l||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,n=1,l=1,h=0,d=0,o=0,_=0,m=0){return this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=l||1,this.rotation=h,this.skew.x=d,this.skew.y=o,this.pivot.x=_,this.pivot.y=m,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new sL),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Z3}set angle(t){this.transform.rotation=t*J3}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class sL extends Re{constructor(){super(...arguments),this.sortDirty=null}}Re.prototype.displayObjectUpdateTransform=Re.prototype.updateTransform;const aL=new Se;function oL(s,t){return s.zIndex===t.zIndex?s._lastSortedIndex-t._lastSortedIndex:s.zIndex-t.zIndex}const rw=class g_ extends Re{constructor(){super(),this.children=[],this.sortableChildren=g_.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const n=this.getChildIndex(t),l=this.getChildIndex(e);this.children[n]=e,this.children[l]=t,this.onChildrenChange(n<l?n:l)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(t);go(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],n=this.children.indexOf(e);if(n===-1)return null;e.parent=null,e.transform._parentID=-1,go(this.children,n,1),this._boundsID++,this.onChildrenChange(n),e.emit("removed",this),this.emit("childRemoved",e,this,n)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,go(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const n=t,l=e,h=l-n;let d;if(h>0&&h<=l){d=this.children.splice(n,h);for(let o=0;o<d.length;++o)d[o].parent=null,d[o].transform&&(d[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<d.length;++o)d[o].emit("removed",this),this.emit("childRemoved",d[o],this,o);return d}else if(h===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,n=this.children.length;e<n;++e){const l=this.children[e];l._lastSortedIndex=e,!t&&l.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(oL),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const n=this.children[t];n.visible&&n.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(e._bounds,n._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const n=super.getLocalBounds(t);if(!e)for(let l=0,h=this.children.length;l<h;++l){const d=this.children[l];d.visible&&d.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let n,l;this.cullArea?(n=this.cullArea,l=this.worldTransform):this._render!==g_.prototype._render&&(n=this.getBounds(!0));const h=t.projection.transform;if(h&&(l?(l=aL.copyFrom(l),l.prepend(h)):l=h),n&&e.intersects(n,l))this._render(t);else if(this.cullArea)return;for(let d=0,o=this.children.length;d<o;++d){const _=this.children[d],m=_.cullable;_.cullable=m||!this.cullArea,_.render(t),_.cullable=m}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,l=this.children.length;n<l;++n)this.children[n].render(t)}}renderAdvanced(t){var h,d,o;const e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let _=0;_<e.length;_++)e[_].enabled&&this._enabledFilters.push(e[_])}const l=e&&((h=this._enabledFilters)==null?void 0:h.length)||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==qe.NONE));if(l&&t.batch.flush(),e&&((d=this._enabledFilters)!=null&&d.length)&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let _=0,m=this.children.length;_<m;++_)this.children[_].render(t)}l&&t.batch.flush(),n&&t.mask.pop(this),e&&((o=this._enabledFilters)!=null&&o.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,n=this.removeChildren(0,this.children.length);if(e)for(let l=0;l<n.length;++l)n[l].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};rw.defaultSortableChildren=!1;let Cr=rw;Cr.prototype.containerUpdateTransform=Cr.prototype.updateTransform;Object.defineProperties(wt,{SORTABLE_CHILDREN:{get(){return Cr.defaultSortableChildren},set(s){ne("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Cr.defaultSortableChildren=s}}});const sl=new ue,lL=new Uint16Array([0,1,2,0,2,3]);class la extends Cr{constructor(t){super(),this._anchor=new An(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new we(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Vt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ct.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=lL,this.pluginName="batch",this.isSprite=!0,this._roundPixels=wt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ns(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ns(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,n=e.a,l=e.b,h=e.c,d=e.d,o=e.tx,_=e.ty,m=this.vertexData,v=t.trim,w=t.orig,x=this._anchor;let T=0,r=0,a=0,u=0;if(v?(r=v.x-x._x*w.width,T=r+v.width,u=v.y-x._y*w.height,a=u+v.height):(r=-x._x*w.width,T=r+w.width,u=-x._y*w.height,a=u+w.height),m[0]=n*r+h*u+o,m[1]=d*u+l*r+_,m[2]=n*T+h*u+o,m[3]=d*u+l*T+_,m[4]=n*T+h*a+o,m[5]=d*a+l*T+_,m[6]=n*r+h*a+o,m[7]=d*a+l*r+_,this._roundPixels){const f=wt.RESOLUTION;for(let g=0;g<m.length;++g)m[g]=Math.round(m[g]*f)/f}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,n=t.orig,l=this._anchor,h=this.transform.worldTransform,d=h.a,o=h.b,_=h.c,m=h.d,v=h.tx,w=h.ty,x=-l._x*n.width,T=x+n.width,r=-l._y*n.height,a=r+n.height;if(e[0]=d*x+_*r+v,e[1]=m*r+o*x+w,e[2]=d*T+_*r+v,e[3]=m*r+o*T+w,e[4]=d*T+_*a+v,e[5]=m*a+o*T+w,e[6]=d*x+_*a+v,e[7]=m*a+o*x+w,this._roundPixels){const u=wt.RESOLUTION;for(let f=0;f<e.length;++f)e[f]=Math.round(e[f]*u)/u}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new vc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Jt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,sl);const e=this._texture.orig.width,n=this._texture.orig.height,l=-e*this.anchor.x;let h=0;return sl.x>=l&&sl.x<l+e&&(h=-n*this.anchor.y,sl.y>=h&&sl.y<h+n)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const n=t instanceof Ct?t:Ct.from(t,e);return new la(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=ns(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=ns(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ct.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const nw=new Se;Re.prototype._cacheAsBitmap=!1;Re.prototype._cacheData=null;Re.prototype._cacheAsBitmapResolution=null;Re.prototype._cacheAsBitmapMultisample=null;class hL{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Re.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(s){s!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(s){s!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(s){if(this._cacheAsBitmap===s)return;this._cacheAsBitmap=s;let t;s?(this._cacheData||(this._cacheData=new hL),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Re.prototype._renderCached=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(s),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(s))};Re.prototype._initCachedDisplayObject=function(s){var x,T;if((x=this._cacheData)!=null&&x.sprite)return;const t=this.alpha;this.alpha=1,s.batch.flush();const e=this.getLocalBounds(new Jt,!0);if((T=this.filters)!=null&&T.length){const r=this.filters[0].padding;e.pad(r)}const n=this.cacheAsBitmapResolution||s.resolution;e.ceil(n),e.width=Math.max(e.width,1/n),e.height=Math.max(e.height,1/n);const l=s.renderTexture.current,h=s.renderTexture.sourceFrame.clone(),d=s.renderTexture.destinationFrame.clone(),o=s.projection.transform,_=oa.create({width:e.width,height:e.height,resolution:n,multisample:this.cacheAsBitmapMultisample??s.multisample}),m=`cacheAsBitmap_${ra()}`;this._cacheData.textureCacheId=m,qt.addToCache(_.baseTexture,m),Ct.addToCache(_,m);const v=this.transform.localTransform.copyTo(nw).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,s.render(this,{renderTexture:_,clear:!0,transform:v,skipUpdateTransform:!1}),s.framebuffer.blit(),s.projection.transform=o,s.renderTexture.bind(l,h,d),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const w=new la(_);w.transform.worldTransform=this.transform.worldTransform,w.anchor.x=-(e.x/e.width),w.anchor.y=-(e.y/e.height),w.alpha=t,w._bounds=this._bounds,this._cacheData.sprite=w,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=w.containsPoint.bind(w)};Re.prototype._renderCachedCanvas=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(s),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(s))};Re.prototype._initCachedDisplayObjectCanvas=function(s){var v;if((v=this._cacheData)!=null&&v.sprite)return;const t=this.getLocalBounds(new Jt,!0),e=this.alpha;this.alpha=1;const n=s.canvasContext.activeContext,l=s._projTransform,h=this.cacheAsBitmapResolution||s.resolution;t.ceil(h),t.width=Math.max(t.width,1/h),t.height=Math.max(t.height,1/h);const d=oa.create({width:t.width,height:t.height,resolution:h}),o=`cacheAsBitmap_${ra()}`;this._cacheData.textureCacheId=o,qt.addToCache(d.baseTexture,o),Ct.addToCache(d,o);const _=nw;this.transform.localTransform.copyTo(_),_.invert(),_.tx-=t.x,_.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,s.render(this,{renderTexture:d,clear:!0,transform:_,skipUpdateTransform:!1}),s.canvasContext.activeContext=n,s._projTransform=l,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const m=new la(d);m.transform.worldTransform=this.transform.worldTransform,m.anchor.x=-(t.x/t.width),m.anchor.y=-(t.y/t.height),m.alpha=e,m._bounds=this._bounds,this._cacheData.sprite=m,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=s._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=m.containsPoint.bind(m)};Re.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Re.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Re.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,qt.removeFromCache(this._cacheData.textureCacheId),Ct.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Re.prototype._cacheAsBitmapDestroy=function(s){this.cacheAsBitmap=!1,this.destroy(s)};Re.prototype.name=null;Cr.prototype.getChildByName=function(s,t){for(let e=0,n=this.children.length;e<n;e++)if(this.children[e].name===s)return this.children[e];if(t)for(let e=0,n=this.children.length;e<n;e++){const l=this.children[e];if(!l.getChildByName)continue;const h=l.getChildByName(s,!0);if(h)return h}return null};Re.prototype.getGlobalPosition=function(s=new ue,t=!1){return this.parent?this.parent.toGlobal(this.position,s,t):(s.x=this.position.x,s.y=this.position.y),s};var uL=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class cL extends Si{constructor(t=1){super(QM,uL,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const dL={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fL=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function pL(s){const t=dL[s],e=t.length;let n=fL,l="";const h="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let d;for(let o=0;o<s;o++){let _=h.replace("%index%",o.toString());d=o,o>=e&&(d=s-o-1),_=_.replace("%value%",t[d].toString()),l+=_,l+=`
`}return n=n.replace("%blur%",l),n=n.replace("%size%",s.toString()),n}const _L=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function gL(s,t){const e=Math.ceil(s/2);let n=_L,l="",h;t?h="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":h="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let d=0;d<s;d++){let o=h.replace("%index%",d.toString());o=o.replace("%sampleIndex%",`${d-(e-1)}.0`),l+=o,l+=`
`}return n=n.replace("%blur%",l),n=n.replace("%size%",s.toString()),n}class m_ extends Si{constructor(t,e=8,n=4,l=Si.defaultResolution,h=5){const d=gL(h,t),o=pL(h);super(d,o),this.horizontal=t,this.resolution=l,this._quality=0,this.quality=n,this.blur=e}apply(t,e,n,l){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/e.width):this.uniforms.strength=1/n.height*(n.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,n,l);else{const h=t.getFilterTexture(),d=t.renderer;let o=e,_=h;this.state.blend=!1,t.applyFilter(this,o,_,Yr.CLEAR);for(let m=1;m<this.passes-1;m++){t.bindAndClear(o,Yr.BLIT),this.uniforms.uSampler=_;const v=_;_=o,o=v,d.shader.bind(this),d.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,_,n,l),t.returnFilterTexture(h)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class sw extends Si{constructor(t=8,e=4,n=Si.defaultResolution,l=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new m_(!0,t,e,n,l),this.blurYFilter=new m_(!1,t,e,n,l),this.resolution=n,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,n,l){const h=Math.abs(this.blurXFilter.strength),d=Math.abs(this.blurYFilter.strength);if(h&&d){const o=t.getFilterTexture();this.blurXFilter.apply(t,e,o,Yr.CLEAR),this.blurYFilter.apply(t,o,n,l),t.returnFilterTexture(o)}else d?this.blurYFilter.apply(t,e,n,l):this.blurXFilter.apply(t,e,n,l)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var mL=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class qs extends Si{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Kb,mL,t),this.alpha=1}_loadMatrix(t,e=!1){let n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}tint(t,e){const[n,l,h]=we.shared.setValue(t).toArray(),d=[n,0,0,0,0,0,l,0,0,0,0,0,h,0,0,0,0,0,1,0];this._loadMatrix(d,e)}greyscale(t,e){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const n=Math.cos(t),l=Math.sin(t),h=Math.sqrt,d=1/3,o=h(d),_=n+(1-n)*d,m=d*(1-n)-o*l,v=d*(1-n)+o*l,w=d*(1-n)+o*l,x=n+d*(1-n),T=d*(1-n)-o*l,r=d*(1-n)-o*l,a=d*(1-n)+o*l,u=n+d*(1-n),f=[_,m,v,0,0,w,x,T,0,0,r,a,u,0,0,0,0,0,1,0];this._loadMatrix(f,e)}contrast(t,e){const n=(t||0)+1,l=-.5*(n-1),h=[n,0,0,0,l,0,n,0,0,l,0,0,n,0,l,0,0,0,1,0];this._loadMatrix(h,e)}saturate(t=0,e){const n=t*2/3+1,l=(n-1)*-.5,h=[n,l,l,0,0,l,n,l,0,0,l,l,n,0,0,0,0,0,1,0];this._loadMatrix(h,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,n,l,h){t=t||.2,e=e||.15,n=n||16770432,l=l||3375104;const d=we.shared,[o,_,m]=d.setValue(n).toArray(),[v,w,x]=d.setValue(l).toArray(),T=[.3,.59,.11,0,0,o,_,m,t,0,v,w,x,e,0,o-v,_-w,m-x,0,0];this._loadMatrix(T,h)}night(t,e){t=t||.1;const n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,e)}predator(t,e){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}qs.prototype.grayscale=qs.prototype.greyscale;var yL=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,vL=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class xL extends Si{constructor(t,e){const n=new Se;t.renderable=!1,super(vL,yL,{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,e==null&&(e=20),this.scale=new ue(e,e)}apply(t,e,n,l){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const h=this.maskSprite.worldTransform,d=Math.sqrt(h.a*h.a+h.b*h.b),o=Math.sqrt(h.c*h.c+h.d*h.d);d!==0&&o!==0&&(this.uniforms.rotation[0]=h.a/d,this.uniforms.rotation[1]=h.b/d,this.uniforms.rotation[2]=h.c/o,this.uniforms.rotation[3]=h.d/o),t.applyFilter(this,e,n,l)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var bL=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,wL=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class SL extends Si{constructor(){super(wL,bL)}}var EL=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class TL extends Si{constructor(t=.5,e=Math.random()){super(Kb,EL,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const v0={AlphaFilter:cL,BlurFilter:sw,BlurFilterPass:m_,ColorMatrixFilter:qs,DisplacementFilter:xL,FXAAFilter:SL,NoiseFilter:TL};Object.entries(v0).forEach(([s,t])=>{Object.defineProperty(v0,s,{get(){return ne("7.1.0",`filters.${s} has moved to ${s}`),t}})});class AL{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Hi.system.add(this.tickerUpdate,this,na.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Hi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const is=new AL;class Wl{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Wl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ue,this.page=new ue,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,l,h){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class xc extends Wl{constructor(){super(...arguments),this.client=new ue,this.movement=new ue,this.offset=new ue,this.global=new ue,this.screen=new ue}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,l,h,d,o,_,m,v,w,x,T,r,a){throw new Error("Method not implemented.")}}class xr extends xc{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class yo extends xc{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}yo.DOM_DELTA_PIXEL=0,yo.DOM_DELTA_LINE=1,yo.DOM_DELTA_PAGE=2;const CL=2048,UL=new ue,ip=new ue;class IL{constructor(t){this.dispatch=new Gl,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((n,l)=>n.priority-l.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,l=e.length;n<l;n++)e[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){is.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",l=this[n](this.rootTarget,this.rootTarget.eventMode,UL.set(t,e),this.hitTestFn,this.hitPruneFn);return l&&l[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let l=0,h=n.length-1;l<h;l++)if(t.currentTarget=n[l],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let l=n.length-2;l>=0;l--)if(t.currentTarget=n[l],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this._allInteractiveElements){if(n.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const l=Array.isArray(e)?e:[e];for(let h=n.length-1;h>=0;h--)l.forEach(d=>{t.currentTarget=n[h],this.notifyTarget(t,d)})}propagationPath(t){const e=[t];for(let n=0;n<CL&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,n,l,h,d=!1){let o=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(is.pauseUpdate=!1),t.interactiveChildren&&t.children){const v=t.children;for(let w=v.length-1;w>=0;w--){const x=v[w],T=this.hitTestMoveRecursive(x,this._isInteractive(e)?e:x.eventMode,n,l,h,d||h(t,n));if(T){if(T.length>0&&!T[T.length-1].parent)continue;const r=t.isInteractive();(T.length>0||r)&&(r&&this._allInteractiveElements.push(t),T.push(t)),this._hitElements.length===0&&(this._hitElements=T),o=!0}}}const _=this._isInteractive(e),m=t.isInteractive();return _&&m&&this._allInteractiveElements.push(t),d||this._hitElements.length>0?null:o?this._hitElements:_&&!h(t,n)&&l(t,n)?m?[t]:[]:null}hitTestRecursive(t,e,n,l,h){if(this._interactivePrune(t)||h(t,n))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(is.pauseUpdate=!1),t.interactiveChildren&&t.children){const _=t.children;for(let m=_.length-1;m>=0;m--){const v=_[m],w=this.hitTestRecursive(v,this._isInteractive(e)?e:v.eventMode,n,l,h);if(w){if(w.length>0&&!w[w.length-1].parent)continue;const x=t.isInteractive();return(w.length>0||x)&&w.push(t),w}}}const d=this._isInteractive(e),o=t.isInteractive();return d&&l(t,n)?o?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var n;if(t.hitArea&&(t.worldTransform.applyInverse(e,ip),!t.hitArea.contains(ip.x,ip.y)))return!0;if(t._mask){const l=t._mask.isMaskData?t._mask.maskObject:t._mask;if(l&&!((n=l.containsPoint)!=null&&n.call(l,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var h,d;e=e??t.type;const n=`on${e}`;(d=(h=t.currentTarget)[n])==null||d.call(h,t);const l=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,l),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const l=e.button===2;this.dispatchEvent(e,l?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var _,m;if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n=e.pointerType==="mouse"||e.pointerType==="pen",l=this.trackingData(t.pointerId),h=this.findMountedTarget(l.overTargets);if(((_=l.overTargets)==null?void 0:_.length)>0&&h!==e.target){const v=t.type==="mousemove"?"mouseout":"pointerout",w=this.createPointerEvent(t,v,h);if(this.dispatchEvent(w,"pointerout"),n&&this.dispatchEvent(w,"mouseout"),!e.composedPath().includes(h)){const x=this.createPointerEvent(t,"pointerleave",h);for(x.eventPhase=x.AT_TARGET;x.target&&!e.composedPath().includes(x.target);)x.currentTarget=x.target,this.notifyTarget(x),n&&this.notifyTarget(x,"mouseleave"),x.target=x.target.parent;this.freeEvent(x)}this.freeEvent(w)}if(h!==e.target){const v=t.type==="mousemove"?"mouseover":"pointerover",w=this.clonePointerEvent(e,v);this.dispatchEvent(w,"pointerover"),n&&this.dispatchEvent(w,"mouseover");let x=h==null?void 0:h.parent;for(;x&&x!==this.rootTarget.parent&&x!==e.target;)x=x.parent;if(!x||x===this.rootTarget.parent){const T=this.clonePointerEvent(e,"pointerenter");for(T.eventPhase=T.AT_TARGET;T.target&&T.target!==h&&T.target!==this.rootTarget.parent;)T.currentTarget=T.target,this.notifyTarget(T),n&&this.notifyTarget(T,"mouseenter"),T.target=T.target.parent;this.freeEvent(T)}this.freeEvent(w)}const d=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?d.push("pointermove"):this.dispatchEvent(e,"pointermove"),o&&d.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?d.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),o&&d.push("globaltouchmove")),n&&(this.moveOnAll?d.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),o&&d.push("globalmousemove"),this.cursor=(m=e.target)==null?void 0:m.cursor),d.length>0&&this.all(e,d),this._allInteractiveElements.length=0,this._hitElements.length=0,l.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var d;if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.createPointerEvent(t),l=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),l&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(d=n.target)==null?void 0:d.cursor);const h=this.clonePointerEvent(n,"pointerenter");for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),l&&this.notifyTarget(h,"mouseenter"),h.target=h.target.parent;e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(h)}mapPointerOut(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",l=this.findMountedTarget(e.overTargets),h=this.createPointerEvent(t,"pointerout",l);this.dispatchEvent(h),n&&this.dispatchEvent(h,"mouseout");const d=this.createPointerEvent(t,"pointerleave",l);for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;e.overTargets=null,this.freeEvent(h),this.freeEvent(d)}this.cursor=null}mapPointerUp(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const o=n.button===2;this.dispatchEvent(n,o?"rightup":"mouseup")}const l=this.trackingData(t.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[t.button]);let d=h;if(h&&!n.composedPath().includes(h)){let o=h;for(;o&&!n.composedPath().includes(o);){if(n.currentTarget=o,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const _=n.button===2;this.notifyTarget(n,_?"rightupoutside":"mouseupoutside")}o=o.parent}delete l.pressTargetsByButton[t.button],d=o}if(d){const o=this.clonePointerEvent(n,"click");o.target=d,o.path=null,l.clicksByButton[t.button]||(l.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:e});const _=l.clicksByButton[t.button];if(_.target===o.target&&e-_.timeStamp<200?++_.clickCount:_.clickCount=1,_.target=o.target,_.timeStamp=e,o.detail=_.clickCount,o.pointerType==="mouse"){const m=o.button===2;this.dispatchEvent(o,m?"rightclick":"click")}else o.pointerType==="touch"&&this.dispatchEvent(o,"tap");this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),l=this.createPointerEvent(t);if(n){let h=n;for(;h;)l.currentTarget=h,this.notifyTarget(l,"pointerupoutside"),l.pointerType==="touch"?this.notifyTarget(l,"touchendoutside"):(l.pointerType==="mouse"||l.pointerType==="pen")&&this.notifyTarget(l,l.button===2?"rightupoutside":"mouseupoutside"),h=h.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(l)}mapWheel(t){if(!(t instanceof yo)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const l=this.allocateEvent(xr);return this.copyPointerData(t,l),this.copyMouseData(t,l),this.copyData(t,l),l.nativeEvent=t.nativeEvent,l.originalEvent=t,l.target=n??this.hitTest(l.global.x,l.global.y)??this._hitElements[0],typeof e=="string"&&(l.type=e),l}createWheelEvent(t){const e=this.allocateEvent(yo);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(xr);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof xr&&e instanceof xr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof xc&&e instanceof xc&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const n=t.currentTarget._events[e];if(n&&t.currentTarget.isInteractive())if("fn"in n)n.once&&t.currentTarget.removeListener(e,n.fn,void 0,!0),n.fn.call(n.context,t);else for(let l=0,h=n.length;l<h&&!t.propagationImmediatelyStopped;l++)n[l].once&&t.currentTarget.removeListener(e,n[l].fn,void 0,!0),n[l].fn.call(n[l].context,t)}}const PL=1,RL={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},y_=class v_{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new IL(null),is.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new xr(null),this.rootWheelEvent=new yo(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...v_.defaultEventFeatures},{set:(e,n,l)=>(n==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=l),e[n]=l,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:n}=this.renderer;this.setTargetElement(e),this.resolution=n,v_._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,l=e.length;n<l;n++){const h=e[n],d=this.bootstrapEvent(this.rootPointerEvent,h);this.rootBoundary.mapEvent(d)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,is.pointerMoved();const e=this.normalizeToPointerData(t);for(let n=0,l=e.length;n<l;n++){const h=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",l=this.normalizeToPointerData(t);for(let h=0,d=l.length;h<d;h++){const o=this.bootstrapEvent(this.rootPointerEvent,l[h]);o.type+=n,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let n=0,l=e.length;n<l;n++){const h=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,is.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;is.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;is.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,n){const l=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},h=1/this.resolution;t.x=(e-l.left)*(this.domElement.width/l.width)*h,t.y=(n-l.top)*(this.domElement.height/l.height)*h}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,l=t.changedTouches.length;n<l;n++){const h=t.changedTouches[n];typeof h.button>"u"&&(h.button=0),typeof h.buttons>"u"&&(h.buttons=1),typeof h.isPrimary>"u"&&(h.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof h.width>"u"&&(h.width=h.radiusX||1),typeof h.height>"u"&&(h.height=h.radiusY||1),typeof h.tiltX>"u"&&(h.tiltX=0),typeof h.tiltY>"u"&&(h.tiltY=0),typeof h.pointerType>"u"&&(h.pointerType="touch"),typeof h.pointerId>"u"&&(h.pointerId=h.identifier||0),typeof h.pressure>"u"&&(h.pressure=h.force||.5),typeof h.twist>"u"&&(h.twist=0),typeof h.tangentialPressure>"u"&&(h.tangentialPressure=0),typeof h.layerX>"u"&&(h.layerX=h.offsetX=h.clientX),typeof h.layerY>"u"&&(h.layerY=h.offsetY=h.clientY),h.isNormalized=!0,h.type=t.type,e.push(h)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=PL),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=RL[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};y_.extension={name:"events",type:[yt.RendererSystem,yt.CanvasRendererSystem]},y_.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let x_=y_;Ut.add(x_);function x0(s){return s==="dynamic"||s==="static"}const BL={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??x0(x_.defaultEventMode)},set interactive(s){ne("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=s,this.eventMode=s?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??x_.defaultEventMode},set eventMode(s){this._internalInteractive=x0(s),this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,l=typeof e=="object"?e.signal:void 0,h=typeof e=="object"?e.once===!0:!1,d=typeof t=="function"?void 0:t;s=n?`${s}capture`:s;const o=typeof t=="function"?t:t.handleEvent,_=this;l&&l.addEventListener("abort",()=>{_.off(s,o,d)}),h?_.once(s,o,d):_.on(s,o,d)},removeEventListener(s,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,l=typeof t=="function"?void 0:t;s=n?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.off(s,t,l)},dispatchEvent(s){if(!(s instanceof Wl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};Re.mixin(BL);const FL={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Re.mixin(FL);const ML=9,Zh=100,LL=0,DL=0,b0=2,w0=1,kL=-1e3,OL=-1e3,NL=2;class aw{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Tn.tablet||Tn.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Zh}px`,e.style.height=`${Zh}px`,e.style.position="absolute",e.style.top=`${LL}px`,e.style.left=`${DL}px`,e.style.zIndex=b0.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${w0}px`,t.style.height=`${w0}px`,t.style.position="absolute",t.style.top=`${kL}px`,t.style.left=`${OL}px`,t.style.zIndex=NL.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}update(){const t=performance.now();if(Tn.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:n,width:l,height:h}=this.renderer.view.getBoundingClientRect(),{width:d,height:o,resolution:_}=this.renderer,m=l/d*_,v=h/o*_;let w=this.div;w.style.left=`${e}px`,w.style.top=`${n}px`,w.style.width=`${d}px`,w.style.height=`${o}px`;for(let x=0;x<this.children.length;x++){const T=this.children[x];if(T.renderId!==this.renderId)T._accessibleActive=!1,go(this.children,x,1),this.div.removeChild(T._accessibleDiv),this.pool.push(T._accessibleDiv),T._accessibleDiv=null,x--;else{w=T._accessibleDiv;let r=T.hitArea;const a=T.worldTransform;T.hitArea?(w.style.left=`${(a.tx+r.x*a.a)*m}px`,w.style.top=`${(a.ty+r.y*a.d)*v}px`,w.style.width=`${r.width*a.a*m}px`,w.style.height=`${r.height*a.d*v}px`):(r=T.getBounds(),this.capHitArea(r),w.style.left=`${r.x*m}px`,w.style.top=`${r.y*v}px`,w.style.width=`${r.width*m}px`,w.style.height=`${r.height*v}px`,w.title!==T.accessibleTitle&&T.accessibleTitle!==null&&(w.title=T.accessibleTitle),w.getAttribute("aria-label")!==T.accessibleHint&&T.accessibleHint!==null&&w.setAttribute("aria-label",T.accessibleHint)),(T.accessibleTitle!==w.title||T.tabIndex!==w.tabIndex)&&(w.title=T.accessibleTitle,w.tabIndex=T.tabIndex,this.debug&&this.updateDebugHTML(w))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:n}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Zh}px`,e.style.height=`${Zh}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=b0.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:n}=t.target,l=this.renderer.events.rootBoundary,h=Object.assign(new Wl(l),{target:n});l.rootTarget=this.renderer.lastObjectRendered,e.forEach(d=>l.dispatchEvent(h,d))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===ML&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}aw.extension={name:"accessibility",type:[yt.RendererPlugin,yt.CanvasRendererPlugin]};Ut.add(aw);const ow=class b_{constructor(t){this.stage=new Cr,t=Object.assign({forceCanvas:!1},t),this.renderer=KM(t),b_._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const n=b_._plugins.slice(0);n.reverse(),n.forEach(l=>{l.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};ow._plugins=[];let lw=ow;Ut.handleByList(yt.Application,lw._plugins);class hw{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,n;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:l,clientHeight:h}=this._resizeTo;e=l,n=h}this.renderer.resize(e,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}hw.extension=yt.Application;Ut.add(hw);const S0={loader:yt.LoadParser,resolver:yt.ResolveParser,cache:yt.CacheParser,detection:yt.DetectionParser};Ut.handle(yt.Asset,s=>{const t=s.ref;Object.entries(S0).filter(([e])=>!!t[e]).forEach(([e,n])=>Ut.add(Object.assign(t[e],{extension:t[e].extension??n})))},s=>{const t=s.ref;Object.keys(S0).filter(e=>!!t[e]).forEach(e=>Ut.remove(t[e]))});class zL{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ro(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function ds(s,t){const e=s.split("?")[0],n=ei.extname(e).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const Sr=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(n=>typeof n=="string"||e?t(n):n):s),w_=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s};function uw(s,t,e,n,l){const h=t[e];for(let d=0;d<h.length;d++){const o=h[d];e<t.length-1?uw(s.replace(n[e],o),t,e+1,n,l):l.push(s.replace(n[e],o))}}function GL(s){const t=/\{(.*?)\}/g,e=s.match(t),n=[];if(e){const l=[];e.forEach(h=>{const d=h.substring(1,h.length-1).split(",");l.push(d)}),uw(s,l,0,e,n)}else n.push(s);return n}const bc=s=>!Array.isArray(s);class HL{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const n=Sr(t);let l;for(let o=0;o<this.parsers.length;o++){const _=this.parsers[o];if(_.test(e)){l=_.getCacheableAssets(n,e);break}}l||(l={},n.forEach(o=>{l[o]=e}));const h=Object.keys(l),d={cacheKeys:h,keys:n};if(n.forEach(o=>{this._cacheMap.set(o,d)}),h.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==e&&console.warn("[Cache] already has key:",o),this._cache.set(o,l[o])}),e instanceof Ct){const o=e;n.forEach(_=>{o.baseTexture!==Ct.EMPTY.baseTexture&&qt.addToCache(o.baseTexture,_),Ct.addToCache(o,_)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Ys=new HL;class $L{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,n)=>(this._parsersValidated=!1,t[e]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{var d,o;let l=null,h=null;if(e.loadParser&&(h=this._parserHash[e.loadParser],h||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!h){for(let _=0;_<this.parsers.length;_++){const m=this.parsers[_];if(m.load&&((d=m.test)!=null&&d.call(m,t,e,this))){h=m;break}}if(!h)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}l=await h.load(t,e,this),n.parser=h;for(let _=0;_<this.parsers.length;_++){const m=this.parsers[_];m.parse&&m.parse&&await((o=m.testParse)==null?void 0:o.call(m,l,e,this))&&(l=await m.parse(l,e,this)||l,n.parser=m)}return l})(),n}async load(t,e){this._parsersValidated||this._validateParsers();let n=0;const l={},h=bc(t),d=Sr(t,m=>({alias:[m],src:m})),o=d.length,_=d.map(async m=>{const v=ei.toAbsolute(m.src);if(!l[m.src])try{this.promiseCache[v]||(this.promiseCache[v]=this._getLoadPromiseAndParser(v,m)),l[m.src]=await this.promiseCache[v].promise,e&&e(++n/o)}catch(w){throw delete this.promiseCache[v],delete l[m.src],new Error(`[Loader.load] Failed to load ${v}.
${w}`)}});return await Promise.all(_),h?l[d[0].src]:l}async unload(t){const e=Sr(t,n=>({alias:[n],src:n})).map(async n=>{var d,o;const l=ei.toAbsolute(n.src),h=this.promiseCache[l];if(h){const _=await h.promise;delete this.promiseCache[l],(o=(d=h.parser)==null?void 0:d.unload)==null||o.call(d,_,n,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Ir=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(Ir||{});const VL=".json",WL="application/json",XL={extension:{type:yt.LoadParser,priority:Ir.Low},name:"loadJson",test(s){return Ro(s,WL)||ds(s,VL)},async load(s){return await(await wt.ADAPTER.fetch(s)).json()}};Ut.add(XL);const YL=".txt",jL="text/plain",qL={name:"loadTxt",extension:{type:yt.LoadParser,priority:Ir.Low},test(s){return Ro(s,jL)||ds(s,YL)},async load(s){return await(await wt.ADAPTER.fetch(s)).text()}};Ut.add(qL);const KL=["normal","bold","100","200","300","400","500","600","700","800","900"],ZL=[".ttf",".otf",".woff",".woff2"],JL=["font/ttf","font/otf","font/woff","font/woff2"],QL=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function tD(s){const t=ei.extname(s),e=ei.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(h=>h.charAt(0).toUpperCase()+h.slice(1));let n=e.length>0;for(const h of e)if(!h.match(QL)){n=!1;break}let l=e.join(" ");return n||(l=`"${l.replace(/[\\"]/g,"\\$&")}"`),l}const eD=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function iD(s){return eD.test(s)?s:encodeURI(s)}const rD={extension:{type:yt.LoadParser,priority:Ir.Low},name:"loadWebFont",test(s){return Ro(s,JL)||ds(s,ZL)},async load(s,t){var n,l,h;const e=wt.ADAPTER.getFontFaceSet();if(e){const d=[],o=((n=t.data)==null?void 0:n.family)??tD(s),_=((h=(l=t.data)==null?void 0:l.weights)==null?void 0:h.filter(v=>KL.includes(v)))??["normal"],m=t.data??{};for(let v=0;v<_.length;v++){const w=_[v],x=new FontFace(o,`url(${iD(s)})`,{...m,weight:w});await x.load(),e.add(x),d.push(x)}return d.length===1?d[0]:d}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(t=>wt.ADAPTER.getFontFaceSet().delete(t))}};Ut.add(rD);const nD=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let vo=null,S_=class{constructor(){vo||(vo=URL.createObjectURL(new Blob([nD],{type:"application/javascript"}))),this.worker=new Worker(vo)}};S_.revokeObjectURL=function(){vo&&(URL.revokeObjectURL(vo),vo=null)};const sD=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let xo=null;class cw{constructor(){xo||(xo=URL.createObjectURL(new Blob([sD],{type:"application/javascript"}))),this.worker=new Worker(xo)}}cw.revokeObjectURL=function(){xo&&(URL.revokeObjectURL(xo),xo=null)};let E0=0,rp;class aD{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new S_;e.addEventListener("message",n=>{e.terminate(),S_.revokeObjectURL(),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){rp===void 0&&(rp=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<rp&&(this._createdWorkers++,t=new cw().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const n=new Promise((l,h)=>{this.queue.push({id:t,arguments:e,resolve:l,reject:h})});return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),n=e.id;this.resolveHash[E0]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:E0++,id:n})}}const T0=new aD;function Xl(s,t,e){s.resource.internal=!0;const n=new Ct(s),l=()=>{delete t.promiseCache[e],Ys.has(e)&&Ys.remove(e)};return n.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),l())}),n.once("destroyed",()=>{s.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),l())}),n}const oD=[".jpeg",".jpg",".png",".webp",".avif"],lD=["image/jpeg","image/png","image/webp","image/avif"];async function hD(s){const t=await wt.ADAPTER.fetch(s);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const Hc={name:"loadTextures",extension:{type:yt.LoadParser,priority:Ir.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return Ro(s,lD)||ds(s,oD)},async load(s,t,e){var o;const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let l;n?this.config.preferWorkers&&await T0.isImageBitmapSupported()?l=await T0.loadImageBitmap(s):l=await hD(s):l=await new Promise((_,m)=>{const v=new Image;v.crossOrigin=this.config.crossOrigin,v.src=s,v.complete?_(v):(v.onload=()=>_(v),v.onerror=w=>m(w))});const h={...t.data};h.resolution??(h.resolution=Pn(s)),n&&((o=h.resourceOptions)==null?void 0:o.ownsImageBitmap)===void 0&&(h.resourceOptions={...h.resourceOptions},h.resourceOptions.ownsImageBitmap=!0);const d=new qt(l,h);return d.resource.src=s,Xl(d,e,s)},unload(s){s.destroy(!0)}};Ut.add(Hc);const uD=".svg",cD="image/svg+xml",dD={extension:{type:yt.LoadParser,priority:Ir.High},name:"loadSVG",test(s){return Ro(s,cD)||ds(s,uD)},async testParse(s){return f_.test(s)},async parse(s,t,e){var h;const n=new f_(s,(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions);await n.load();const l=new qt(n,{resolution:Pn(s),...t==null?void 0:t.data});return l.resource.src=t.src,Xl(l,e,t.src)},async load(s,t){return(await wt.ADAPTER.fetch(s)).text()},unload:Hc.unload};Ut.add(dD);const fD=[".mp4",".m4v",".webm",".ogv"],pD=["video/mp4","video/webm","video/ogg"],_D={name:"loadVideo",extension:{type:yt.LoadParser,priority:Ir.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(s){return Ro(s,pD)||ds(s,fD)},async load(s,t,e){var d;let n;const l=await(await wt.ADAPTER.fetch(s)).blob(),h=URL.createObjectURL(l);try{const o={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(d=t==null?void 0:t.data)==null?void 0:d.resourceOptions,autoLoad:!0},_=new iw(h,o);await _.load();const m=new qt(_,{alphaMode:await w3(),resolution:Pn(s),...t==null?void 0:t.data});m.resource.src=s,n=Xl(m,e,s),n.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(h)})}catch(o){throw URL.revokeObjectURL(h),o}return n},unload(s){s.destroy(!0)}};Ut.add(_D);class gD{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`).join("&")}}getAlias(t){const{alias:e,name:n,src:l,srcs:h}=t;return Sr(e||n||l||h,d=>typeof d=="string"?d:Array.isArray(d)?d.map(o=>(o==null?void 0:o.src)??(o==null?void 0:o.srcs)??o):d!=null&&d.src||d!=null&&d.srcs?d.src??d.srcs:d,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const n=[];Array.isArray(e)?e.forEach(l=>{const h=l.src??l.srcs,d=l.alias??l.name;let o;if(typeof d=="string"){const _=this._createBundleAssetId(t,d);n.push(_),o=[d,_]}else{const _=d.map(m=>this._createBundleAssetId(t,m));n.push(..._),o=[...d,..._]}this.add({...l,alias:o,src:h})}):Object.keys(e).forEach(l=>{const h=[l,this._createBundleAssetId(t,l)];if(typeof e[l]=="string")this.add({alias:h,src:e[l]});else if(Array.isArray(e[l]))this.add({alias:h,src:e[l]});else{const d=e[l],o=d.src??d.srcs;this.add({...d,alias:h,src:Array.isArray(o)?o:[o]})}n.push(...h)}),this._bundles[t]=n}add(t,e,n,l,h){const d=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(ne("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),d.push({alias:t,src:e,data:n,format:l,loadParser:h})):Array.isArray(t)?d.push(...t):d.push(t);let o;o=_=>{this.hasKey(_)&&console.warn(`[Resolver] already has key: ${_} overwriting`)},Sr(d).forEach(_=>{const{src:m,srcs:v}=_;let{data:w,format:x,loadParser:T}=_;const r=Sr(m||v).map(f=>typeof f=="string"?GL(f):Array.isArray(f)?f:[f]),a=this.getAlias(_);Array.isArray(a)?a.forEach(o):o(a);const u=[];r.forEach(f=>{f.forEach(g=>{let b={};if(typeof g!="object"){b.src=g;for(let S=0;S<this._parsers.length;S++){const A=this._parsers[S];if(A.test(g)){b=A.parse(g);break}}}else w=g.data??w,x=g.format??x,T=g.loadParser??T,b={...b,...g};if(!a)throw new Error(`[Resolver] alias is undefined for this asset: ${b.src}`);b=this.buildResolvedAsset(b,{aliases:a,data:w,format:x,loadParser:T}),u.push(b)})}),a.forEach(f=>{this._assetMap[f]=u})})}resolveBundle(t){const e=bc(t);t=Sr(t);const n={};return t.forEach(l=>{const h=this._bundles[l];if(h){const d=this.resolve(h),o={};for(const _ in d){const m=d[_];o[this._extractAssetIdFromBundle(l,_)]=m}n[l]=o}}),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const n={};for(const l in e)n[l]=e[l].src;return n}return e.src}resolve(t){const e=bc(t);t=Sr(t);const n={};return t.forEach(l=>{if(!this._resolverHash[l])if(this._assetMap[l]){let h=this._assetMap[l];const d=h[0],o=this._getPreferredOrder(h);o==null||o.priority.forEach(_=>{o.params[_].forEach(m=>{const v=h.filter(w=>w[_]?w[_]===m:!1);v.length&&(h=v)})}),this._resolverHash[l]=h[0]??d}else this._resolverHash[l]=this.buildResolvedAsset({alias:[l],src:l},{});n[l]=this._resolverHash[l]}),e?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const n=t[0],l=this._preferredOrder.find(h=>h.params.format.includes(n.format));if(l)return l}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:n,data:l,loadParser:h,format:d}=e;return(this._basePath||this._rootPath)&&(t.src=ei.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=n??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...l||{},...t.data},t.loadParser=h??t.loadParser,t.format=d??t.format??ei.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class mD{constructor(){this._detections=[],this._initialized=!1,this.resolver=new gD,this.loader=new $L,this.cache=Ys,this._backgroundLoader=new zL(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var h,d;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}const e=((h=t.texturePreference)==null?void 0:h.resolution)??1,n=typeof e=="number"?[e]:e,l=await this._detectFormats({preferredFormats:(d=t.texturePreference)==null?void 0:d.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:l,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,n,l,h){this.resolver.add(t,e,n,l,h)}async load(t,e){this._initialized||await this.init();const n=bc(t),l=Sr(t).map(o=>{if(typeof o!="string"){const _=this.resolver.getAlias(o);return _.some(m=>!this.resolver.hasKey(m))&&this.add(o),Array.isArray(_)?_[0]:_}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),h=this.resolver.resolve(l),d=await this._mapLoadToResolve(h,e);return n?d[l[0]]:d}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;typeof t=="string"&&(n=!0,t=[t]);const l=this.resolver.resolveBundle(t),h={},d=Object.keys(l);let o=0,_=0;const m=()=>{e==null||e(++o/_)},v=d.map(w=>{const x=l[w];return _+=Object.keys(x).length,this._mapLoadToResolve(x,m).then(T=>{h[w]=T})});return await Promise.all(v),n?h[t[0]]:h}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ys.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=Ys.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=Object.values(t),l=Object.keys(t);this._backgroundLoader.active=!1;const h=await this.loader.load(n,e);this._backgroundLoader.active=!0;const d={};return n.forEach((o,_)=>{const m=h[o.src],v=[o.src];o.alias&&v.push(...o.alias),d[l[_]]=m,Ys.set(v,m)}),d}async unload(t){this._initialized||await this.init();const e=Sr(t).map(l=>typeof l!="string"?l.src:l),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=Sr(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map(l=>this._unloadFromResolved(e[l]));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(n=>{Ys.remove(n.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const n of t.detections)t.skipDetections||await n.test()?e=await n.add(e):t.skipDetections||(e=await n.remove(e));return e=e.filter((n,l)=>e.indexOf(n)===l),e}get detections(){return this._detections}get preferWorkers(){return Hc.config.preferWorkers}set preferWorkers(t){ne("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(n=>n in t).forEach(n=>{e.config[n]=t[n]})})}}const Jh=new mD;Ut.handleByList(yt.LoadParser,Jh.loader.parsers).handleByList(yt.ResolveParser,Jh.resolver.parsers).handleByList(yt.CacheParser,Jh.cache.parsers).handleByList(yt.DetectionParser,Jh.detections);const yD={extension:yt.CacheParser,test:s=>Array.isArray(s)&&s.every(t=>t instanceof Ct),getCacheableAssets:(s,t)=>{const e={};return s.forEach(n=>{t.forEach((l,h)=>{e[n+(h===0?"":h+1)]=l})}),e}};Ut.add(yD);async function dw(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const vD={extension:{type:yt.DetectionParser,priority:1},test:async()=>dw("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")};Ut.add(vD);const xD={extension:{type:yt.DetectionParser,priority:0},test:async()=>dw("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};Ut.add(xD);const A0=["png","jpg","jpeg"],bD={extension:{type:yt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...A0],remove:async s=>s.filter(t=>!A0.includes(t))};Ut.add(bD);const wD="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ig(s){return wD?!1:document.createElement("video").canPlayType(s)!==""}const SD={extension:{type:yt.DetectionParser,priority:0},test:async()=>ig("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")};Ut.add(SD);const ED={extension:{type:yt.DetectionParser,priority:0},test:async()=>ig("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")};Ut.add(ED);const TD={extension:{type:yt.DetectionParser,priority:0},test:async()=>ig("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")};Ut.add(TD);const AD={extension:yt.ResolveParser,test:Hc.test,parse:s=>{var t;return{resolution:parseFloat(((t=wt.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:ei.extname(s).slice(1),src:s}}};Ut.add(AD);var ai=(s=>(s[s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",s[s.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",s[s.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",s[s.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",s[s.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",s[s.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",s[s.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",s[s.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",s[s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",s[s.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",s[s.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",s[s.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",s[s.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",s[s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",s[s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",s[s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",s))(ai||{});const wc={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Hr,to;function C0(){to={bptc:Hr.getExtension("EXT_texture_compression_bptc"),astc:Hr.getExtension("WEBGL_compressed_texture_astc"),etc:Hr.getExtension("WEBGL_compressed_texture_etc"),s3tc:Hr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Hr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Hr.getExtension("WEBGL_compressed_texture_pvrtc")||Hr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Hr.getExtension("WEBGL_compressed_texture_etc1"),atc:Hr.getExtension("WEBGL_compressed_texture_atc")}}const CD={extension:{type:yt.DetectionParser,priority:2},test:async()=>{const s=wt.ADAPTER.createCanvas().getContext("webgl");return s?(Hr=s,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async s=>{to||C0();const t=[];for(const e in to)to[e]&&t.push(e);return[...t,...s]},remove:async s=>(to||C0(),s.filter(t=>!(t in to)))};Ut.add(CD);class UD extends kc{constructor(t,e={width:1,height:1,autoLoad:!0}){let n,l;typeof t=="string"?(n=t,l=new Uint8Array):(n=null,l=t),super(l,e),this.origin=n,this.buffer=l?new t_(l):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new t_(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class ta extends UD{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=ta._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||ta._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,n){const l=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;l.pixelStorei(l.UNPACK_ALIGNMENT,4);for(let h=0,d=this.levels;h<d;h++){const{levelID:o,levelWidth:_,levelHeight:m,levelBuffer:v}=this._levelBuffers[h];l.compressedTexImage2D(l.TEXTURE_2D,o,this.format,_,m,0,v)}return!0}onBlobLoaded(){this._levelBuffers=ta._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,n,l,h,d,o){const _=new Array(n);let m=t.byteOffset,v=d,w=o,x=v+l-1&~(l-1),T=w+h-1&~(h-1),r=x*T*wc[e];for(let a=0;a<n;a++)_[a]={levelID:a,levelWidth:n>1?v:x,levelHeight:n>1?w:T,levelBuffer:new Uint8Array(t.buffer,m,r)},m+=r,v=v>>1||1,w=w>>1||1,x=v+l-1&~(l-1),T=w+h-1&~(h-1),r=x*T*wc[e];return _}}const np=4,Qh=124,ID=32,U0=20,PD=542327876,tu={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},RD={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},eu={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},BD=1,FD=2,MD=4,LD=64,DD=512,kD=131072,OD=827611204,ND=861165636,zD=894720068,GD=808540228,HD=4,$D={[OD]:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,[ND]:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,[zD]:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT},VD={70:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:ai.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:ai.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:ai.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:ai.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function WD(s){const t=new Uint32Array(s);if(t[0]!==PD)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(s,0,Qh/Uint32Array.BYTES_PER_ELEMENT),n=e[tu.HEIGHT],l=e[tu.WIDTH],h=e[tu.MIPMAP_COUNT],d=new Uint32Array(s,tu.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,ID/Uint32Array.BYTES_PER_ELEMENT),o=d[BD];if(o&MD){const _=d[RD.FOURCC];if(_!==GD){const g=$D[_],b=np+Qh,S=new Uint8Array(s,b);return[new ta(S,{format:g,width:l,height:n,levels:h})]}const m=np+Qh,v=new Uint32Array(t.buffer,m,U0/Uint32Array.BYTES_PER_ELEMENT),w=v[eu.DXGI_FORMAT],x=v[eu.RESOURCE_DIMENSION],T=v[eu.MISC_FLAG],r=v[eu.ARRAY_SIZE],a=VD[w];if(a===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${w}`);if(T===HD)throw new Error("DDSParser does not support cubemap textures");if(x===6)throw new Error("DDSParser does not supported 3D texture data");const u=new Array,f=np+Qh+U0;if(r===1)u.push(new Uint8Array(s,f));else{const g=wc[a];let b=0,S=l,A=n;for(let B=0;B<h;B++){const R=Math.max(1,S+3&-4),M=Math.max(1,A+3&-4),N=R*M*g;b+=N,S=S>>>1,A=A>>>1}let C=f;for(let B=0;B<r;B++)u.push(new Uint8Array(s,C,b)),C+=b}return u.map(g=>new ta(g,{format:a,width:l,height:n,levels:h}))}throw o&LD?new Error("DDSParser does not support uncompressed texture data."):o&DD?new Error("DDSParser does not supported YUV uncompressed texture data."):o&kD?new Error("DDSParser does not support single-channel (lumninance) texture data!"):o&FD?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const I0=[171,75,84,88,32,49,49,187,13,10,26,10],XD=67305985,dr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},E_=64,P0={[Bt.UNSIGNED_BYTE]:1,[Bt.UNSIGNED_SHORT]:2,[Bt.INT]:4,[Bt.UNSIGNED_INT]:4,[Bt.FLOAT]:4,[Bt.HALF_FLOAT]:8},YD={[ft.RGBA]:4,[ft.RGB]:3,[ft.RG]:2,[ft.RED]:1,[ft.LUMINANCE]:1,[ft.LUMINANCE_ALPHA]:2,[ft.ALPHA]:1},jD={[Bt.UNSIGNED_SHORT_4_4_4_4]:2,[Bt.UNSIGNED_SHORT_5_5_5_1]:2,[Bt.UNSIGNED_SHORT_5_6_5]:2};function qD(s,t,e=!1){const n=new DataView(t);if(!KD(s,n))return null;const l=n.getUint32(dr.ENDIANNESS,!0)===XD,h=n.getUint32(dr.GL_TYPE,l),d=n.getUint32(dr.GL_FORMAT,l),o=n.getUint32(dr.GL_INTERNAL_FORMAT,l),_=n.getUint32(dr.PIXEL_WIDTH,l),m=n.getUint32(dr.PIXEL_HEIGHT,l)||1,v=n.getUint32(dr.PIXEL_DEPTH,l)||1,w=n.getUint32(dr.NUMBER_OF_ARRAY_ELEMENTS,l)||1,x=n.getUint32(dr.NUMBER_OF_FACES,l),T=n.getUint32(dr.NUMBER_OF_MIPMAP_LEVELS,l),r=n.getUint32(dr.BYTES_OF_KEY_VALUE_DATA,l);if(m===0||v!==1)throw new Error("Only 2D textures are supported");if(x!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(w!==1)throw new Error("WebGL does not support array textures");const a=4,u=4,f=_+3&-4,g=m+3&-4,b=new Array(w);let S=_*m;h===0&&(S=f*g);let A;if(h!==0?P0[h]?A=P0[h]*YD[d]:A=jD[h]:A=wc[o],A===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=e?JD(n,r,l):null;let B=S*A,R=_,M=m,N=f,L=g,W=E_+r;for(let k=0;k<T;k++){const j=n.getUint32(W,l);let Y=W+4;for(let ut=0;ut<w;ut++){let it=b[ut];it||(it=b[ut]=new Array(T)),it[k]={levelID:k,levelWidth:T>1||h!==0?R:N,levelHeight:T>1||h!==0?M:L,levelBuffer:new Uint8Array(t,Y,B)},Y+=B}W+=j+4,W=W%4!==0?W+4-W%4:W,R=R>>1||1,M=M>>1||1,N=R+a-1&-4,L=M+u-1&-4,B=N*L*A}return h!==0?{uncompressed:b.map(k=>{let j=k[0].levelBuffer,Y=!1;return h===Bt.FLOAT?j=new Float32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4):h===Bt.UNSIGNED_INT?(Y=!0,j=new Uint32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)):h===Bt.INT&&(Y=!0,j=new Int32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)),{resource:new kc(j,{width:k[0].levelWidth,height:k[0].levelHeight}),type:h,format:Y?ZD(d):d}}),kvData:C}:{compressed:b.map(k=>new ta(null,{format:o,width:_,height:m,levels:T,levelBuffers:k})),kvData:C}}function KD(s,t){for(let e=0;e<I0.length;e++)if(t.getUint8(e)!==I0[e])return console.error(`${s} is not a valid *.ktx file!`),!1;return!0}function ZD(s){switch(s){case ft.RGBA:return ft.RGBA_INTEGER;case ft.RGB:return ft.RGB_INTEGER;case ft.RG:return ft.RG_INTEGER;case ft.RED:return ft.RED_INTEGER;default:return s}}function JD(s,t,e){const n=new Map;let l=0;for(;l<t;){const h=s.getUint32(E_+l,e),d=E_+l+4,o=3-(h+3)%4;if(h===0||h>t-l){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let _=0;for(;_<h&&s.getUint8(d+_)!==0;_++);if(_===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const m=new TextDecoder().decode(new Uint8Array(s.buffer,d,_)),v=new DataView(s.buffer,d+_+1,h-_-1);n.set(m,v),l+=4+h+o}return n}const QD={extension:{type:yt.LoadParser,priority:Ir.High},name:"loadDDS",test(s){return ds(s,".dds")},async load(s,t,e){const n=await(await wt.ADAPTER.fetch(s)).arrayBuffer(),l=WD(n).map(h=>{const d=new qt(h,{mipmap:Qr.OFF,alphaMode:Ri.NO_PREMULTIPLIED_ALPHA,resolution:Pn(s),...t.data});return Xl(d,e,s)});return l.length===1?l[0]:l},unload(s){Array.isArray(s)?s.forEach(t=>t.destroy(!0)):s.destroy(!0)}};Ut.add(QD);const tk={extension:{type:yt.LoadParser,priority:Ir.High},name:"loadKTX",test(s){return ds(s,".ktx")},async load(s,t,e){const n=await(await wt.ADAPTER.fetch(s)).arrayBuffer(),{compressed:l,uncompressed:h,kvData:d}=qD(s,n),o=l??h,_={mipmap:Qr.OFF,alphaMode:Ri.NO_PREMULTIPLIED_ALPHA,resolution:Pn(s),...t.data},m=o.map(v=>{o===h&&Object.assign(_,{type:v.type,format:v.format});const w=v.resource??v,x=new qt(w,_);return x.ktxKeyValueData=d,Xl(x,e,s)});return m.length===1?m[0]:m},unload(s){Array.isArray(s)?s.forEach(t=>t.destroy(!0)):s.destroy(!0)}};Ut.add(tk);const ek=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],ik={extension:yt.ResolveParser,test:s=>{const t=ei.extname(s).slice(1);return["basis","ktx","dds"].includes(t)},parse:s=>{var n,l;const t=s.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const h=t.pop();if(ek.includes(h))return{resolution:parseFloat(((n=wt.RETINA_PREFIX.exec(s))==null?void 0:n[1])??"1"),format:h,src:s}}return{resolution:parseFloat(((l=wt.RETINA_PREFIX.exec(s))==null?void 0:l[1])??"1"),format:e,src:s}}};Ut.add(ik);const iu=new Jt,rk=4,fw=class xl{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,n,l){const h=new Image;return h.src=await this.base64(t,e,n,l),h}async base64(t,e,n,l){const h=this.canvas(t,l);if(h.toBlob!==void 0)return new Promise((d,o)=>{h.toBlob(_=>{if(!_){o(new Error("ICanvas.toBlob failed!"));return}const m=new FileReader;m.onload=()=>d(m.result),m.onerror=o,m.readAsDataURL(_)},e,n)});if(h.toDataURL!==void 0)return h.toDataURL(e,n);if(h.convertToBlob!==void 0){const d=await h.convertToBlob({type:e,quality:n});return new Promise((o,_)=>{const m=new FileReader;m.onload=()=>o(m.result),m.onerror=_,m.readAsDataURL(d)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:n,width:l,height:h,flipY:d,premultipliedAlpha:o}=this._rawPixels(t,e);d&&xl._flipY(n,l,h),o&&xl._unpremultiplyAlpha(n);const _=new O3(l,h,1),m=new ImageData(new Uint8ClampedArray(n.buffer),l,h);return _.context.putImageData(m,0,0),_.canvas}pixels(t,e){const{pixels:n,width:l,height:h,flipY:d,premultipliedAlpha:o}=this._rawPixels(t,e);return d&&xl._flipY(n,l,h),o&&xl._unpremultiplyAlpha(n),n}_rawPixels(t,e){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let l,h=!1,d=!1,o,_=!1;t&&(t instanceof oa?o=t:(o=n.generateTexture(t,{region:e,resolution:n.resolution,multisample:n.multisample}),_=!0,e&&(iu.width=e.width,iu.height=e.height,e=iu)));const m=n.gl;if(o){if(l=o.baseTexture.resolution,e=e??o.frame,h=!1,d=o.baseTexture.alphaMode>0&&o.baseTexture.format===ft.RGBA,!_){n.renderTexture.bind(o);const T=o.framebuffer.glFramebuffers[n.CONTEXT_UID];T.blitFramebuffer&&n.framebuffer.bind(T.blitFramebuffer)}}else l=n.resolution,e||(e=iu,e.width=n.width/l,e.height=n.height/l),h=!0,d=this._rendererPremultipliedAlpha,n.renderTexture.bind();const v=Math.max(Math.round(e.width*l),1),w=Math.max(Math.round(e.height*l),1),x=new Uint8Array(rk*v*w);return m.readPixels(Math.round(e.x*l),Math.round(e.y*l),v,w,m.RGBA,m.UNSIGNED_BYTE,x),_&&(o==null||o.destroy(!0)),{pixels:x,width:v,height:w,flipY:h,premultipliedAlpha:d}}destroy(){this.renderer=null}static _flipY(t,e,n){const l=e<<2,h=n>>1,d=new Uint8Array(l);for(let o=0;o<h;o++){const _=o*l,m=(n-o-1)*l;d.set(t.subarray(_,_+l)),t.copyWithin(_,m,m+l),t.set(d,m)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let n=0;n<e;n+=4){const l=t[n+3];if(l!==0){const h=255.001/l;t[n]=t[n]*h+.5,t[n+1]=t[n+1]*h+.5,t[n+2]=t[n+2]*h+.5}}}};fw.extension={name:"extract",type:yt.RendererSystem};let nk=fw;Ut.add(nk);const Sc={build(s){const t=s.points;let e,n,l,h,d,o;if(s.type===oi.CIRC){const r=s.shape;e=r.x,n=r.y,d=o=r.radius,l=h=0}else if(s.type===oi.ELIP){const r=s.shape;e=r.x,n=r.y,d=r.width,o=r.height,l=h=0}else{const r=s.shape,a=r.width/2,u=r.height/2;e=r.x+a,n=r.y+u,d=o=Math.max(0,Math.min(r.radius,Math.min(a,u))),l=a-d,h=u-o}if(!(d>=0&&o>=0&&l>=0&&h>=0)){t.length=0;return}const _=Math.ceil(2.3*Math.sqrt(d+o)),m=_*8+(l?4:0)+(h?4:0);if(t.length=m,m===0)return;if(_===0){t.length=8,t[0]=t[6]=e+l,t[1]=t[3]=n+h,t[2]=t[4]=e-l,t[5]=t[7]=n-h;return}let v=0,w=_*4+(l?2:0)+2,x=w,T=m;{const r=l+d,a=h,u=e+r,f=e-r,g=n+a;if(t[v++]=u,t[v++]=g,t[--w]=g,t[--w]=f,h){const b=n-a;t[x++]=f,t[x++]=b,t[--T]=b,t[--T]=u}}for(let r=1;r<_;r++){const a=Math.PI/2*(r/_),u=l+Math.cos(a)*d,f=h+Math.sin(a)*o,g=e+u,b=e-u,S=n+f,A=n-f;t[v++]=g,t[v++]=S,t[--w]=S,t[--w]=b,t[x++]=b,t[x++]=A,t[--T]=A,t[--T]=g}{const r=l,a=h+o,u=e+r,f=e-r,g=n+a,b=n-a;t[v++]=u,t[v++]=g,t[--T]=b,t[--T]=u,l&&(t[v++]=f,t[v++]=g,t[--T]=b,t[--T]=f)}},triangulate(s,t){const e=s.points,n=t.points,l=t.indices;if(e.length===0)return;let h=n.length/2;const d=h;let o,_;if(s.type!==oi.RREC){const v=s.shape;o=v.x,_=v.y}else{const v=s.shape;o=v.x+v.width/2,_=v.y+v.height/2}const m=s.matrix;n.push(s.matrix?m.a*o+m.c*_+m.tx:o,s.matrix?m.b*o+m.d*_+m.ty:_),h++,n.push(e[0],e[1]);for(let v=2;v<e.length;v+=2)n.push(e[v],e[v+1]),l.push(h++,d,h);l.push(d+1,d,h)}};function R0(s,t=!1){const e=s.length;if(e<6)return;let n=0;for(let l=0,h=s[e-2],d=s[e-1];l<e;l+=2){const o=s[l],_=s[l+1];n+=(o-h)*(_+d),h=o,d=_}if(!t&&n>0||t&&n<=0){const l=e/2;for(let h=l+l%2;h<e;h+=2){const d=e-h-2,o=e-h-1,_=h,m=h+1;[s[d],s[_]]=[s[_],s[d]],[s[o],s[m]]=[s[m],s[o]]}}}const pw={build(s){s.points=s.shape.points.slice()},triangulate(s,t){let e=s.points;const n=s.holes,l=t.points,h=t.indices;if(e.length>=6){R0(e,!1);const d=[];for(let m=0;m<n.length;m++){const v=n[m];R0(v.points,!0),d.push(e.length/2),e=e.concat(v.points)}const o=pR(e,d,2);if(!o)return;const _=l.length/2;for(let m=0;m<o.length;m+=3)h.push(o[m]+_),h.push(o[m+1]+_),h.push(o[m+2]+_);for(let m=0;m<e.length;m++)l.push(e[m])}}},sk={build(s){const t=s.shape,e=t.x,n=t.y,l=t.width,h=t.height,d=s.points;d.length=0,l>=0&&h>=0&&d.push(e,n,e+l,n,e+l,n+h,e,n+h)},triangulate(s,t){const e=s.points,n=t.points;if(e.length===0)return;const l=n.length/2;n.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(l,l+1,l+2,l+1,l+2,l+3)}},ak={build(s){Sc.build(s)},triangulate(s,t){Sc.triangulate(s,t)}};var rr=(s=>(s.MITER="miter",s.BEVEL="bevel",s.ROUND="round",s))(rr||{}),ss=(s=>(s.BUTT="butt",s.ROUND="round",s.SQUARE="square",s))(ss||{});const Io={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(s,t=20){if(!this.adaptive||!s||isNaN(s))return t;let e=Math.ceil(s/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class B0{static curveTo(t,e,n,l,h,d){const o=d[d.length-2],_=d[d.length-1]-e,m=o-t,v=l-e,w=n-t,x=Math.abs(_*w-m*v);if(x<1e-8||h===0)return(d[d.length-2]!==t||d[d.length-1]!==e)&&d.push(t,e),null;const T=_*_+m*m,r=v*v+w*w,a=_*v+m*w,u=h*Math.sqrt(T)/x,f=h*Math.sqrt(r)/x,g=u*a/T,b=f*a/r,S=u*w+f*m,A=u*v+f*_,C=m*(f+g),B=_*(f+g),R=w*(u+b),M=v*(u+b),N=Math.atan2(B-A,C-S),L=Math.atan2(M-A,R-S);return{cx:S+t,cy:A+e,radius:h,startAngle:N,endAngle:L,anticlockwise:m*v>w*_}}static arc(t,e,n,l,h,d,o,_,m){const v=o-d,w=Io._segmentsCount(Math.abs(v)*h,Math.ceil(Math.abs(v)/pc)*40),x=v/(w*2),T=x*2,r=Math.cos(x),a=Math.sin(x),u=w-1,f=u%1/u;for(let g=0;g<=u;++g){const b=g+f*g,S=x+d+T*b,A=Math.cos(S),C=-Math.sin(S);m.push((r*A+a*C)*h+n,(r*-C+a*A)*h+l)}}}class ok{constructor(){this.reset()}begin(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class rg{static curveLength(t,e,n,l,h,d,o,_){let m=0,v=0,w=0,x=0,T=0,r=0,a=0,u=0,f=0,g=0,b=0,S=t,A=e;for(let C=1;C<=10;++C)v=C/10,w=v*v,x=w*v,T=1-v,r=T*T,a=r*T,u=a*t+3*r*v*n+3*T*w*h+x*o,f=a*e+3*r*v*l+3*T*w*d+x*_,g=S-u,b=A-f,S=u,A=f,m+=Math.sqrt(g*g+b*b);return m}static curveTo(t,e,n,l,h,d,o){const _=o[o.length-2],m=o[o.length-1];o.length-=2;const v=Io._segmentsCount(rg.curveLength(_,m,t,e,n,l,h,d));let w=0,x=0,T=0,r=0,a=0;o.push(_,m);for(let u=1,f=0;u<=v;++u)f=u/v,w=1-f,x=w*w,T=x*w,r=f*f,a=r*f,o.push(T*_+3*x*f*t+3*w*r*n+a*h,T*m+3*x*f*e+3*w*r*l+a*d)}}function F0(s,t,e,n,l,h,d,o){const _=s-e*l,m=t-n*l,v=s+e*h,w=t+n*h;let x,T;d?(x=n,T=-e):(x=-n,T=e);const r=_+x,a=m+T,u=v+x,f=w+T;return o.push(r,a,u,f),2}function As(s,t,e,n,l,h,d,o){const _=e-s,m=n-t;let v=Math.atan2(_,m),w=Math.atan2(l-s,h-t);o&&v<w?v+=Math.PI*2:!o&&v>w&&(w+=Math.PI*2);let x=v;const T=w-v,r=Math.abs(T),a=Math.sqrt(_*_+m*m),u=(15*r*Math.sqrt(a)/Math.PI>>0)+1,f=T/u;if(x+=f,o){d.push(s,t,e,n);for(let g=1,b=x;g<u;g++,b+=f)d.push(s,t,s+Math.sin(b)*a,t+Math.cos(b)*a);d.push(s,t,l,h)}else{d.push(e,n,s,t);for(let g=1,b=x;g<u;g++,b+=f)d.push(s+Math.sin(b)*a,t+Math.cos(b)*a,s,t);d.push(l,h,s,t)}return u*2}function lk(s,t){const e=s.shape;let n=s.points||e.points.slice();const l=t.closePointEps;if(n.length===0)return;const h=s.lineStyle,d=new ue(n[0],n[1]),o=new ue(n[n.length-2],n[n.length-1]),_=e.type!==oi.POLY||e.closeStroke,m=Math.abs(d.x-o.x)<l&&Math.abs(d.y-o.y)<l;if(_){n=n.slice(),m&&(n.pop(),n.pop(),o.set(n[n.length-2],n[n.length-1]));const it=(d.x+o.x)*.5,gt=(o.y+d.y)*.5;n.unshift(it,gt),n.push(it,gt)}const v=t.points,w=n.length/2;let x=n.length;const T=v.length/2,r=h.width/2,a=r*r,u=h.miterLimit*h.miterLimit;let f=n[0],g=n[1],b=n[2],S=n[3],A=0,C=0,B=-(g-S),R=f-b,M=0,N=0,L=Math.sqrt(B*B+R*R);B/=L,R/=L,B*=r,R*=r;const W=h.alignment,k=(1-W)*2,j=W*2;_||(h.cap===ss.ROUND?x+=As(f-B*(k-j)*.5,g-R*(k-j)*.5,f-B*k,g-R*k,f+B*j,g+R*j,v,!0)+2:h.cap===ss.SQUARE&&(x+=F0(f,g,B,R,k,j,!0,v))),v.push(f-B*k,g-R*k,f+B*j,g+R*j);for(let it=1;it<w-1;++it){f=n[(it-1)*2],g=n[(it-1)*2+1],b=n[it*2],S=n[it*2+1],A=n[(it+1)*2],C=n[(it+1)*2+1],B=-(g-S),R=f-b,L=Math.sqrt(B*B+R*R),B/=L,R/=L,B*=r,R*=r,M=-(S-C),N=b-A,L=Math.sqrt(M*M+N*N),M/=L,N/=L,M*=r,N*=r;const gt=b-f,Q=g-S,rt=b-A,Z=C-S,H=gt*rt+Q*Z,G=Q*rt-Z*gt,at=G<0;if(Math.abs(G)<.001*Math.abs(H)){v.push(b-B*k,S-R*k,b+B*j,S+R*j),H>=0&&(h.join===rr.ROUND?x+=As(b,S,b-B*k,S-R*k,b-M*k,S-N*k,v,!1)+4:x+=2,v.push(b-M*j,S-N*j,b+M*k,S+N*k));continue}const vt=(-B+f)*(-R+S)-(-B+b)*(-R+g),At=(-M+A)*(-N+S)-(-M+b)*(-N+C),kt=(gt*At-rt*vt)/G,ht=(Z*vt-Q*At)/G,q=(kt-b)*(kt-b)+(ht-S)*(ht-S),nt=b+(kt-b)*k,dt=S+(ht-S)*k,Xt=b-(kt-b)*j,Ot=S-(ht-S)*j,Nt=Math.min(gt*gt+Q*Q,rt*rt+Z*Z),Lt=at?k:j,ce=Nt+Lt*Lt*a,Be=q<=ce;let gi=h.join;if(gi===rr.MITER&&q/a>u&&(gi=rr.BEVEL),Be)switch(gi){case rr.MITER:{v.push(nt,dt,Xt,Ot);break}case rr.BEVEL:{at?v.push(nt,dt,b+B*j,S+R*j,nt,dt,b+M*j,S+N*j):v.push(b-B*k,S-R*k,Xt,Ot,b-M*k,S-N*k,Xt,Ot),x+=2;break}case rr.ROUND:{at?(v.push(nt,dt,b+B*j,S+R*j),x+=As(b,S,b+B*j,S+R*j,b+M*j,S+N*j,v,!0)+4,v.push(nt,dt,b+M*j,S+N*j)):(v.push(b-B*k,S-R*k,Xt,Ot),x+=As(b,S,b-B*k,S-R*k,b-M*k,S-N*k,v,!1)+4,v.push(b-M*k,S-N*k,Xt,Ot));break}}else{switch(v.push(b-B*k,S-R*k,b+B*j,S+R*j),gi){case rr.MITER:{at?v.push(Xt,Ot,Xt,Ot):v.push(nt,dt,nt,dt),x+=2;break}case rr.ROUND:{at?x+=As(b,S,b+B*j,S+R*j,b+M*j,S+N*j,v,!0)+2:x+=As(b,S,b-B*k,S-R*k,b-M*k,S-N*k,v,!1)+2;break}}v.push(b-M*k,S-N*k,b+M*j,S+N*j),x+=2}}f=n[(w-2)*2],g=n[(w-2)*2+1],b=n[(w-1)*2],S=n[(w-1)*2+1],B=-(g-S),R=f-b,L=Math.sqrt(B*B+R*R),B/=L,R/=L,B*=r,R*=r,v.push(b-B*k,S-R*k,b+B*j,S+R*j),_||(h.cap===ss.ROUND?x+=As(b-B*(k-j)*.5,S-R*(k-j)*.5,b-B*k,S-R*k,b+B*j,S+R*j,v,!1)+2:h.cap===ss.SQUARE&&(x+=F0(b,S,B,R,k,j,!1,v)));const Y=t.indices,ut=Io.epsilon*Io.epsilon;for(let it=T;it<x+T-2;++it)f=v[it*2],g=v[it*2+1],b=v[(it+1)*2],S=v[(it+1)*2+1],A=v[(it+2)*2],C=v[(it+2)*2+1],!(Math.abs(f*(S-C)+b*(C-g)+A*(g-S))<ut)&&Y.push(it,it+1,it+2)}function hk(s,t){let e=0;const n=s.shape,l=s.points||n.points,h=n.type!==oi.POLY||n.closeStroke;if(l.length===0)return;const d=t.points,o=t.indices,_=l.length/2,m=d.length/2;let v=m;for(d.push(l[0],l[1]),e=1;e<_;e++)d.push(l[e*2],l[e*2+1]),o.push(v,v+1),v++;h&&o.push(v,m)}function M0(s,t){s.lineStyle.native?hk(s,t):lk(s,t)}class ng{static curveLength(t,e,n,l,h,d){const o=t-2*n+h,_=e-2*l+d,m=2*n-2*t,v=2*l-2*e,w=4*(o*o+_*_),x=4*(o*m+_*v),T=m*m+v*v,r=2*Math.sqrt(w+x+T),a=Math.sqrt(w),u=2*w*a,f=2*Math.sqrt(T),g=x/a;return(u*r+a*x*(r-f)+(4*T*w-x*x)*Math.log((2*a+g+r)/(g+f)))/(4*u)}static curveTo(t,e,n,l,h){const d=h[h.length-2],o=h[h.length-1],_=Io._segmentsCount(ng.curveLength(d,o,t,e,n,l));let m=0,v=0;for(let w=1;w<=_;++w){const x=w/_;m=d+(t-d)*x,v=o+(e-o)*x,h.push(m+(t+(n-t)*x-m)*x,v+(e+(l-e)*x-v)*x)}}}const sp={[oi.POLY]:pw,[oi.CIRC]:Sc,[oi.ELIP]:Sc,[oi.RECT]:sk,[oi.RREC]:ak},L0=[],ru=[];class Ec{constructor(t,e=null,n=null,l=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=l,this.type=t.type}clone(){return new Ec(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Pa=new ue,_w=class gw extends vb{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new vc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),ru.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),L0.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,n=null,l=null){const h=new Ec(t,e,n,l);return this.graphicsData.push(h),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const n=new Ec(t,null,null,e),l=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=l.lineStyle,l.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let n=0;n<e.length;++n){const l=e[n];if(l.fillStyle.visible&&l.shape&&(l.matrix?l.matrix.applyInverse(t,Pa):Pa.copyFrom(t),l.shape.contains(Pa.x,Pa.y))){let h=!1;if(l.holes){for(let d=0;d<l.holes.length;d++)if(l.holes[d].shape.contains(Pa.x,Pa.y)){h=!0;break}}if(!h)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let n=null,l=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],l=n.style);for(let _=this.shapeIndex;_<e.length;_++){this.shapeIndex++;const m=e[_],v=m.fillStyle,w=m.lineStyle;sp[m.type].build(m),m.matrix&&this.transformPoints(m.points,m.matrix),(v.visible||w.visible)&&this.processHoles(m.holes);for(let x=0;x<2;x++){const T=x===0?v:w;if(!T.visible)continue;const r=T.texture.baseTexture,a=this.indices.length,u=this.points.length/2;r.wrapMode=os.REPEAT,x===0?this.processFill(m):this.processLine(m);const f=this.points.length/2-u;f!==0&&(n&&!this._compareStyles(l,T)&&(n.end(a,u),n=null),n||(n=L0.pop()||new ok,n.begin(T,a,u),this.batches.push(n),l=T),this.addUvs(this.points,t,T.texture,u,f,T.matrix))}}const h=this.indices.length,d=this.points.length/2;if(n&&n.end(h,d),this.batches.length===0){this.batchable=!0;return}const o=d>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const n=this.graphicsData[t],l=n.fillStyle,h=n.lineStyle;if(l&&!l.texture.baseTexture.valid||h&&!h.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,n=t.length;e<n;e++){const l=t[e];for(let h=0;h<l.size;h++){const d=l.start+h;this.indicesUint16[d]=this.indicesUint16[d]-l.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<gw.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++qt._globalBatch;for(let w=0;w<this.drawCalls.length;w++)this.drawCalls[w].texArray.clear(),ru.push(this.drawCalls[w]);this.drawCalls.length=0;const e=this.colors,n=this.textureIds;let l=ru.pop();l||(l=new r_,l.texArray=new o_),l.texArray.count=0,l.start=0,l.size=0,l.type=Kr.TRIANGLES;let h=0,d=null,o=0,_=!1,m=Kr.TRIANGLES,v=0;this.drawCalls.push(l);for(let w=0;w<this.batches.length;w++){const x=this.batches[w],T=8,r=x.style,a=r.texture.baseTexture;_!==!!r.native&&(_=!!r.native,m=_?Kr.LINES:Kr.TRIANGLES,d=null,h=T,t++),d!==a&&(d=a,a._batchEnabled!==t&&(h===T&&(t++,h=0,l.size>0&&(l=ru.pop(),l||(l=new r_,l.texArray=new o_),this.drawCalls.push(l)),l.start=v,l.size=0,l.texArray.count=0,l.type=m),a.touched=1,a._batchEnabled=t,a._batchLocation=h,a.wrapMode=os.REPEAT,l.texArray.elements[l.texArray.count++]=a,h++)),l.size+=x.size,v+=x.size,o=a._batchLocation,this.addColors(e,r.color,r.alpha,x.attribSize,x.attribStart),this.addTextureIds(n,o,x.attribSize,x.attribStart)}qt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,n=this.colors,l=this.textureIds,h=new ArrayBuffer(t.length*3*4),d=new Float32Array(h),o=new Uint32Array(h);let _=0;for(let m=0;m<t.length/2;m++)d[_++]=t[m*2],d[_++]=t[m*2+1],d[_++]=e[m*2],d[_++]=e[m*2+1],o[_++]=n[m],d[_++]=l[m];this._buffer.update(h),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?pw.triangulate(t,this):sp[t.type].triangulate(t,this)}processLine(t){M0(t,this);for(let e=0;e<t.holes.length;e++)M0(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const n=t[e];sp[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let n=0;n<t.length/2;n++){const l=t[n*2],h=t[n*2+1];t[n*2]=e.a*l+e.c*h+e.tx,t[n*2+1]=e.b*l+e.d*h+e.ty}}addColors(t,e,n,l,h=0){const d=we.shared.setValue(e).toLittleEndianNumber(),o=we.shared.setValue(d).toPremultiplied(n);t.length=Math.max(t.length,h+l);for(let _=0;_<l;_++)t[h+_]=o}addTextureIds(t,e,n,l=0){t.length=Math.max(t.length,l+n);for(let h=0;h<n;h++)t[l+h]=e}addUvs(t,e,n,l,h,d=null){let o=0;const _=e.length,m=n.frame;for(;o<h;){let w=t[(l+o)*2],x=t[(l+o)*2+1];if(d){const T=d.a*w+d.c*x+d.tx;x=d.b*w+d.d*x+d.ty,w=T}o++,e.push(w/m.width,x/m.height)}const v=n.baseTexture;(m.width<v.width||m.height<v.height)&&this.adjustUvs(e,n,_,h)}adjustUvs(t,e,n,l){const h=e.baseTexture,d=1e-6,o=n+l*2,_=e.frame,m=_.width/h.width,v=_.height/h.height;let w=_.x/_.width,x=_.y/_.height,T=Math.floor(t[n]+d),r=Math.floor(t[n+1]+d);for(let a=n+2;a<o;a+=2)T=Math.min(T,Math.floor(t[a]+d)),r=Math.min(r,Math.floor(t[a+1]+d));w-=T,x-=r;for(let a=n;a<o;a+=2)t[a]=(t[a]+w)*m,t[a+1]=(t[a+1]+x)*v}};_w.BATCHABLE_SIZE=100;let uk=_w;class $c{constructor(){this.color=16777215,this.alpha=1,this.texture=Ct.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new $c;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ct.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class sg extends $c{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ss.BUTT,this.join=rr.MITER,this.miterLimit=10}clone(){const t=new sg;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ss.BUTT,this.join=rr.MITER,this.miterLimit=10}}const ap={},T_=class Yu extends Cr{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new $c,this._lineStyle=new sg,this._matrix=null,this._holeMode=!1,this.state=tn.for2d(),this._geometry=t||new uk,this._geometry.refCount++,this._transformID=-1,this._tintColor=new we(16777215),this.blendMode=Vt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Yu(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,n,l=.5,h=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:n,alignment:l,native:h}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Ct.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ss.BUTT,join:rr.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.width>0&&t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:n},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Qs,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Qs,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,l=n[n.length-2],h=n[n.length-1];return(l!==t||h!==e)&&n.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,n,l){this._initCurve();const h=this.currentPath.points;return h.length===0&&this.moveTo(0,0),ng.curveTo(t,e,n,l,h),this}bezierCurveTo(t,e,n,l,h,d){return this._initCurve(),rg.curveTo(t,e,n,l,h,d,this.currentPath.points),this}arcTo(t,e,n,l,h){this._initCurve(t,e);const d=this.currentPath.points,o=B0.curveTo(t,e,n,l,h,d);if(o){const{cx:_,cy:m,radius:v,startAngle:w,endAngle:x,anticlockwise:T}=o;this.arc(_,m,v,w,x,T)}return this}arc(t,e,n,l,h,d=!1){if(l===h)return this;if(!d&&h<=l?h+=pc:d&&l<=h&&(l+=pc),h-l===0)return this;const o=t+Math.cos(l)*n,_=e+Math.sin(l)*n,m=this._geometry.closePointEps;let v=this.currentPath?this.currentPath.points:null;if(v){const w=Math.abs(v[v.length-2]-o),x=Math.abs(v[v.length-1]-_);w<m&&x<m||v.push(o,_)}else this.moveTo(o,_),v=this.currentPath.points;return B0.arc(o,_,t,e,n,l,h,d,v),this}beginFill(t=0,e){return this.beginTextureFill({texture:Ct.WHITE,color:t,alpha:e})}normalizeColor(t){const e=we.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Ct.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:n},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,n,l){return this.drawShape(new Jt(t,e,n,l))}drawRoundedRect(t,e,n,l,h){return this.drawShape(new zc(t,e,n,l,h))}drawCircle(t,e,n){return this.drawShape(new Oc(t,e,n))}drawEllipse(t,e,n,l){return this.drawShape(new Nc(t,e,n,l))}drawPolygon(...t){let e,n=!0;const l=t[0];l.points?(n=l.closeStroke,e=l.points):Array.isArray(t[0])?e=t[0]:e=t;const h=new Qs(e);return h.closeStroke=n,this.drawShape(h),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===oi.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(let l=0;l<n;l++){const h=t.batches[l],d=h.style.color,o=new Float32Array(this.vertexData.buffer,h.attribStart*4*2,h.attribSize*2),_=new Float32Array(t.uvsFloat32.buffer,h.attribStart*4*2,h.attribSize*2),m=new Uint16Array(t.indicesUint16.buffer,h.start*2,h.size),v={vertexData:o,blendMode:e,indices:m,uvs:_,_batchRGB:we.shared.setValue(d).toRgbArray(),_tintRGB:d,_texture:h.style.texture,alpha:h.style.alpha,worldAlpha:1};this.batches[l]=v}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,n=this.batches.length;e<n;e++){const l=this.batches[e];l.worldAlpha=this.worldAlpha*l.alpha,t.plugins[this.pluginName].render(l)}}}_renderDirect(t){const e=this._resolveDirectShader(t),n=this._geometry,l=this.worldAlpha,h=e.uniforms,d=n.drawCalls;h.translationMatrix=this.transform.worldTransform,we.shared.setValue(this._tintColor).premultiply(l).toArray(h.tint),t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(let o=0,_=d.length;o<_;o++)this._renderDrawCallDirect(t,n.drawCalls[o])}_renderDrawCallDirect(t,e){const{texArray:n,type:l,size:h,start:d}=e,o=n.count;for(let _=0;_<o;_++)t.texture.bind(n.elements[_],_);t.geometry.draw(l,h,d)}_resolveDirectShader(t){let e=this.shader;const n=this.pluginName;if(!e){if(!ap[n]){const{maxTextures:l}=t.plugins[n],h=new Int32Array(l);for(let _=0;_<l;_++)h[_]=_;const d={tint:new Float32Array([1,1,1,1]),translationMatrix:new Se,default:Ar.from({uSamplers:h},!0)},o=t.plugins[n]._shader.program;ap[n]=new Jr(o,d)}e=ap[n]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:n,maxX:l,maxY:h}=t.bounds;this._bounds.addFrame(this.transform,e,n,l,h)}containsPoint(t){return this.worldTransform.applyInverse(t,Yu._TEMP_POINT),this._geometry.containsPoint(Yu._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=we.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,n=e.a,l=e.b,h=e.c,d=e.d,o=e.tx,_=e.ty,m=this._geometry.points,v=this.vertexData;let w=0;for(let x=0;x<m.length;x+=2){const T=m[x],r=m[x+1];v[w++]=n*T+h*r+o,v[w++]=d*r+l*T+_}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};T_.curves=Io,T_._TEMP_POINT=new ue;let mw=T_;class ck{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const op=new ue,D0=new Qs,yw=class vw extends Cr{constructor(t,e,n,l=Kr.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=n||tn.for2d(),this.drawMode=l,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=wt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Kr.TRIANGLES&&e.length<vw.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const l=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[l]),t.plugins[l].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const l=this.transform.worldTransform,h=l.a,d=l.b,o=l.c,_=l.d,m=l.tx,v=l.ty,w=this.vertexData;for(let x=0;x<w.length/2;x++){const T=e[x*2],r=e[x*2+1];w[x*2]=h*T+o*r+m,w[x*2+1]=d*T+_*r+v}if(this._roundPixels){const x=wt.RESOLUTION;for(let T=0;T<w.length;++T)w[T]=Math.round(w[T]*x)/x}this.vertexDirty=n}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ck(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,op);const e=this.geometry.getBuffer("aVertexPosition").data,n=D0.points,l=this.geometry.getIndex().data,h=l.length,d=this.drawMode===4?3:1;for(let o=0;o+2<h;o+=d){const _=l[o]*2,m=l[o+1]*2,v=l[o+2]*2;if(n[0]=e[_],n[1]=e[_+1],n[2]=e[m],n[3]=e[m+1],n[4]=e[v],n[5]=e[v+1],D0.contains(op.x,op.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};yw.BATCHABLE_SIZE=100;let k0=yw;class dk extends hs{constructor(t,e,n){super();const l=new Ne(t),h=new Ne(e,!0),d=new Ne(n,!0,!0);this.addAttribute("aVertexPosition",l,2,!1,Bt.FLOAT).addAttribute("aTextureCoord",h,2,!1,Bt.FLOAT).addIndex(d),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var fk=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,pk=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class O0 extends Jr{constructor(t,e){const n={uSampler:t,alpha:1,uTextureMatrix:Se.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(n,e.uniforms),super(e.program||Cn.from(pk,fk),n),this._colorDirty=!1,this.uvMatrix=new Fb(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new we(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;we.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class N0{constructor(t,e,n){this.geometry=new hs,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let l=0;l<t.length;++l){let h=t[l];h={attributeName:h.attributeName,size:h.size,uploadFunction:h.uploadFunction,type:h.type||Bt.FLOAT,offset:h.offset},e[l]?this.dynamicProperties.push(h):this.staticProperties.push(h)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Ne(D3(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let d=0;d<this.dynamicProperties.length;++d){const o=this.dynamicProperties[d];o.offset=e,e+=o.size,this.dynamicStride+=o.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new Ne(this.dynamicData,!1,!1);let l=0;this.staticStride=0;for(let d=0;d<this.staticProperties.length;++d){const o=this.staticProperties[d];o.offset=l,l+=o.size,this.staticStride+=o.size}const h=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(h),this.staticDataUint32=new Uint32Array(h),this.staticBuffer=new Ne(this.staticData,!0,!1);for(let d=0;d<this.dynamicProperties.length;++d){const o=this.dynamicProperties[d];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===Bt.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let d=0;d<this.staticProperties.length;++d){const o=this.staticProperties[d];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===Bt.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(t,e,n){for(let l=0;l<this.dynamicProperties.length;l++){const h=this.dynamicProperties[l];h.uploadFunction(t,e,n,h.type===Bt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,h.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,n){for(let l=0;l<this.staticProperties.length;l++){const h=this.staticProperties[l];h.uploadFunction(t,e,n,h.type===Bt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,h.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var _k=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,gk=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class xw extends Gc{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Se,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Bt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Jr.from(gk,_k,{}),this.state=tn.for2d()}render(t){const e=t.children,n=t._maxSize,l=t._batchSize,h=this.renderer;let d=e.length;if(d===0)return;d>n&&!t.autoResize&&(d=n);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const _=e[0]._texture.baseTexture,m=_.alphaMode>0;this.state.blendMode=gb(t.blendMode,m),h.state.set(this.state);const v=h.gl,w=t.worldTransform.copyTo(this.tempMatrix);w.prepend(h.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=w.toArray(!0),this.shader.uniforms.uColor=we.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,m).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=_,this.renderer.shader.bind(this.shader);let x=!1;for(let T=0,r=0;T<d;T+=l,r+=1){let a=d-T;a>l&&(a=l),r>=o.length&&o.push(this._generateOneMoreBuffer(t));const u=o[r];u.uploadDynamic(e,T,a);const f=t._bufferUpdateIDs[r]||0;x=x||u._updateID<f,x&&(u._updateID=t._updateID,u.uploadStatic(e,T,a)),h.geometry.bind(u.geometry),v.drawElements(v.TRIANGLES,a*6,v.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],n=t._maxSize,l=t._batchSize,h=t._properties;for(let d=0;d<n;d+=l)e.push(new N0(this.properties,h,l));return e}_generateOneMoreBuffer(t){const e=t._batchSize,n=t._properties;return new N0(this.properties,n,e)}uploadVertices(t,e,n,l,h,d){let o=0,_=0,m=0,v=0;for(let w=0;w<n;++w){const x=t[e+w],T=x._texture,r=x.scale.x,a=x.scale.y,u=T.trim,f=T.orig;u?(_=u.x-x.anchor.x*f.width,o=_+u.width,v=u.y-x.anchor.y*f.height,m=v+u.height):(o=f.width*(1-x.anchor.x),_=f.width*-x.anchor.x,m=f.height*(1-x.anchor.y),v=f.height*-x.anchor.y),l[d]=_*r,l[d+1]=v*a,l[d+h]=o*r,l[d+h+1]=v*a,l[d+h*2]=o*r,l[d+h*2+1]=m*a,l[d+h*3]=_*r,l[d+h*3+1]=m*a,d+=h*4}}uploadPosition(t,e,n,l,h,d){for(let o=0;o<n;o++){const _=t[e+o].position;l[d]=_.x,l[d+1]=_.y,l[d+h]=_.x,l[d+h+1]=_.y,l[d+h*2]=_.x,l[d+h*2+1]=_.y,l[d+h*3]=_.x,l[d+h*3+1]=_.y,d+=h*4}}uploadRotation(t,e,n,l,h,d){for(let o=0;o<n;o++){const _=t[e+o].rotation;l[d]=_,l[d+h]=_,l[d+h*2]=_,l[d+h*3]=_,d+=h*4}}uploadUvs(t,e,n,l,h,d){for(let o=0;o<n;++o){const _=t[e+o]._texture._uvs;_?(l[d]=_.x0,l[d+1]=_.y0,l[d+h]=_.x1,l[d+h+1]=_.y1,l[d+h*2]=_.x2,l[d+h*2+1]=_.y2,l[d+h*3]=_.x3,l[d+h*3+1]=_.y3,d+=h*4):(l[d]=0,l[d+1]=0,l[d+h]=0,l[d+h+1]=0,l[d+h*2]=0,l[d+h*2+1]=0,l[d+h*3]=0,l[d+h*3+1]=0,d+=h*4)}}uploadTint(t,e,n,l,h,d){for(let o=0;o<n;++o){const _=t[e+o],m=we.shared.setValue(_._tintRGB).toPremultiplied(_.alpha,_.texture.baseTexture.alphaMode>0);l[d]=m,l[d+h]=m,l[d+h*2]=m,l[d+h*3]=m,d+=h*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}xw.extension={name:"particle",type:yt.RendererPlugin};Ut.add(xw);var Vc=(s=>(s[s.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",s[s.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",s))(Vc||{});const nu={willReadFrequently:!0},$r=class Rt{static get experimentalLetterSpacingSupported(){let t=Rt._experimentalLetterSpacingSupported;if(t!==void 0){const e=wt.ADAPTER.getCanvasRenderingContext2D().prototype;t=Rt._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,n,l,h,d,o,_,m){this.text=t,this.style=e,this.width=n,this.height=l,this.lines=h,this.lineWidths=d,this.lineHeight=o,this.maxLineWidth=_,this.fontProperties=m}static measureText(t,e,n,l=Rt._canvas){n=n??e.wordWrap;const h=e.toFontString(),d=Rt.measureFont(h);d.fontSize===0&&(d.fontSize=e.fontSize,d.ascent=e.fontSize);const o=l.getContext("2d",nu);o.font=h;const _=(n?Rt.wordWrap(t,e,l):t).split(/(?:\r\n|\r|\n)/),m=new Array(_.length);let v=0;for(let r=0;r<_.length;r++){const a=Rt._measureText(_[r],e.letterSpacing,o);m[r]=a,v=Math.max(v,a)}let w=v+e.strokeThickness;e.dropShadow&&(w+=e.dropShadowDistance);const x=e.lineHeight||d.fontSize+e.strokeThickness;let T=Math.max(x,d.fontSize+e.strokeThickness*2)+e.leading+(_.length-1)*(x+e.leading);return e.dropShadow&&(T+=e.dropShadowDistance),new Rt(t,e,w,T,_,m,x+e.leading,v,d)}static _measureText(t,e,n){let l=!1;Rt.experimentalLetterSpacingSupported&&(Rt.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,l=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let h=n.measureText(t).width;return h>0&&(l?h-=e:h+=(Rt.graphemeSegmenter(t).length-1)*e),h}static wordWrap(t,e,n=Rt._canvas){const l=n.getContext("2d",nu);let h=0,d="",o="";const _=Object.create(null),{letterSpacing:m,whiteSpace:v}=e,w=Rt.collapseSpaces(v),x=Rt.collapseNewlines(v);let T=!w;const r=e.wordWrapWidth+m,a=Rt.tokenize(t);for(let u=0;u<a.length;u++){let f=a[u];if(Rt.isNewline(f)){if(!x){o+=Rt.addLine(d),T=!w,d="",h=0;continue}f=" "}if(w){const b=Rt.isBreakingSpace(f),S=Rt.isBreakingSpace(d[d.length-1]);if(b&&S)continue}const g=Rt.getFromCache(f,m,_,l);if(g>r)if(d!==""&&(o+=Rt.addLine(d),d="",h=0),Rt.canBreakWords(f,e.breakWords)){const b=Rt.wordWrapSplit(f);for(let S=0;S<b.length;S++){let A=b[S],C=A,B=1;for(;b[S+B];){const M=b[S+B];if(!Rt.canBreakChars(C,M,f,S,e.breakWords))A+=M;else break;C=M,B++}S+=B-1;const R=Rt.getFromCache(A,m,_,l);R+h>r&&(o+=Rt.addLine(d),T=!1,d="",h=0),d+=A,h+=R}}else{d.length>0&&(o+=Rt.addLine(d),d="",h=0);const b=u===a.length-1;o+=Rt.addLine(f,!b),T=!1,d="",h=0}else g+h>r&&(T=!1,o+=Rt.addLine(d),d="",h=0),(d.length>0||!Rt.isBreakingSpace(f)||T)&&(d+=f,h+=g)}return o+=Rt.addLine(d,!1),o}static addLine(t,e=!0){return t=Rt.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,n,l){let h=n[t];return typeof h!="number"&&(h=Rt._measureText(t,e,l)+e,n[t]=h),h}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const n=t[e];if(!Rt.isBreakingSpace(n))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Rt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:Rt._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let n="";if(typeof t!="string")return e;for(let l=0;l<t.length;l++){const h=t[l],d=t[l+1];if(Rt.isBreakingSpace(h,d)||Rt.isNewline(h)){n!==""&&(e.push(n),n=""),e.push(h);continue}n+=h}return n!==""&&e.push(n),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,l,h){return!0}static wordWrapSplit(t){return Rt.graphemeSegmenter(t)}static measureFont(t){if(Rt._fonts[t])return Rt._fonts[t];const e={ascent:0,descent:0,fontSize:0},n=Rt._canvas,l=Rt._context;l.font=t;const h=Rt.METRICS_STRING+Rt.BASELINE_SYMBOL,d=Math.ceil(l.measureText(h).width);let o=Math.ceil(l.measureText(Rt.BASELINE_SYMBOL).width);const _=Math.ceil(Rt.HEIGHT_MULTIPLIER*o);if(o=o*Rt.BASELINE_MULTIPLIER|0,d===0||_===0)return Rt._fonts[t]=e,e;n.width=d,n.height=_,l.fillStyle="#f00",l.fillRect(0,0,d,_),l.font=t,l.textBaseline="alphabetic",l.fillStyle="#000",l.fillText(h,0,o);const m=l.getImageData(0,0,d,_).data,v=m.length,w=d*4;let x=0,T=0,r=!1;for(x=0;x<o;++x){for(let a=0;a<w;a+=4)if(m[T+a]!==255){r=!0;break}if(!r)T+=w;else break}for(e.ascent=o-x,T=v-w,r=!1,x=_;x>o;--x){for(let a=0;a<w;a+=4)if(m[T+a]!==255){r=!0;break}if(!r)T-=w;else break}return e.descent=x-o,e.fontSize=e.ascent+e.descent,Rt._fonts[t]=e,e}static clearMetrics(t=""){t?delete Rt._fonts[t]:Rt._fonts={}}static get _canvas(){var t;if(!Rt.__canvas){let e;try{const n=new OffscreenCanvas(0,0);if((t=n.getContext("2d",nu))!=null&&t.measureText)return Rt.__canvas=n,n;e=wt.ADAPTER.createCanvas()}catch{e=wt.ADAPTER.createCanvas()}e.width=e.height=10,Rt.__canvas=e}return Rt.__canvas}static get _context(){return Rt.__context||(Rt.__context=Rt._canvas.getContext("2d",nu)),Rt.__context}};$r.METRICS_STRING="|q",$r.BASELINE_SYMBOL="M",$r.BASELINE_MULTIPLIER=1.4,$r.HEIGHT_MULTIPLIER=2,$r.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>[...s.segment(t)].map(e=>e.segment)}return s=>[...s]})(),$r.experimentalLetterSpacing=!1,$r._fonts={},$r._newlines=[10,13],$r._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Jn=$r;const mk=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],bw=class bl{constructor(t){this.styleID=0,this.reset(),hp(this,t,t)}clone(){const t={};return hp(t,this,bl.defaultStyle),new bl(t)}reset(){hp(this,bl.defaultStyle,bl.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=lp(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=lp(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){yk(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=lp(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let l=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(l)&&!mk.includes(l)&&(l=`"${l}"`),e[n]=l}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};bw.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Vc.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let us=bw;function lp(s){const t=we.shared,e=n=>{const l=t.setValue(n);return l.alpha===1?l.toHex():l.toRgbaString()};return Array.isArray(s)?s.map(e):e(s)}function yk(s,t){if(!Array.isArray(s)||!Array.isArray(t)||s.length!==t.length)return!1;for(let e=0;e<s.length;++e)if(s[e]!==t[e])return!1;return!0}function hp(s,t,e){for(const n in e)Array.isArray(t[n])?s[n]=t[n].slice():s[n]=t[n]}const vk={texture:!0,children:!1,baseTexture:!0},ww=class A_ extends la{constructor(t,e,n){let l=!1;n||(n=wt.ADAPTER.createCanvas(),l=!0),n.width=3,n.height=3;const h=Ct.from(n);h.orig=new Jt,h.trim=new Jt,super(h),this._ownCanvas=l,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=A_.defaultResolution??wt.RESOLUTION,this._autoResolution=A_.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Jn.experimentalLetterSpacing}static set experimentalLetterSpacing(t){ne("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Jn.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const n=this.context,l=Jn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),h=l.width,d=l.height,o=l.lines,_=l.lineHeight,m=l.lineWidths,v=l.maxLineWidth,w=l.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,h)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,d)+e.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;let x,T;const r=e.dropShadow?2:1;for(let a=0;a<r;++a){const u=e.dropShadow&&a===0,f=u?Math.ceil(Math.max(1,d)+e.padding*2):0,g=f*this._resolution;if(u){n.fillStyle="black",n.strokeStyle="black";const S=e.dropShadowColor,A=e.dropShadowBlur*this._resolution,C=e.dropShadowDistance*this._resolution;n.shadowColor=we.shared.setValue(S).setAlpha(e.dropShadowAlpha).toRgbaString(),n.shadowBlur=A,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*C,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*C+g}else n.fillStyle=this._generateFillStyle(e,o,l),n.strokeStyle=e.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let b=(_-w.fontSize)/2;_-w.fontSize<0&&(b=0);for(let S=0;S<o.length;S++)x=e.strokeThickness/2,T=e.strokeThickness/2+S*_+w.ascent+b,e.align==="right"?x+=v-m[S]:e.align==="center"&&(x+=(v-m[S])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[S],x+e.padding,T+e.padding-f,!0),e.fill&&this.drawLetterSpacing(o[S],x+e.padding,T+e.padding-f)}this.updateTexture()}drawLetterSpacing(t,e,n,l=!1){const h=this._style.letterSpacing;let d=!1;if(Jn.experimentalLetterSpacingSupported&&(Jn.experimentalLetterSpacing?(this.context.letterSpacing=`${h}px`,this.context.textLetterSpacing=`${h}px`,d=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),h===0||d){l?this.context.strokeText(t,e,n):this.context.fillText(t,e,n);return}let o=e;const _=Jn.graphemeSegmenter(t);let m=this.context.measureText(t).width,v=0;for(let w=0;w<_.length;++w){const x=_[w];l?this.context.strokeText(x,o,n):this.context.fillText(x,o,n);let T="";for(let r=w+1;r<_.length;++r)T+=_[r];v=this.context.measureText(T).width,o+=m-v+h,m=v}}updateTexture(){const t=this.canvas;if(this._style.trim){const d=z3(t);d.data&&(t.width=d.width,t.height=d.height,this.context.putImageData(d.data,0,0))}const e=this._texture,n=this._style,l=n.trim?0:n.padding,h=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-l,e.trim.y=-l,e.orig.width=e._frame.width-l*2,e.orig.height=e._frame.height-l*2,this._onTextureUpdate(),h.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,n){const l=t.fill;if(Array.isArray(l)){if(l.length===1)return l[0]}else return l;let h;const d=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,_=this.canvas.width/this._resolution-d-o*2,m=this.canvas.height/this._resolution-d-o*2,v=l.slice(),w=t.fillGradientStops.slice();if(!w.length){const x=v.length+1;for(let T=1;T<x;++T)w.push(T/x)}if(v.unshift(l[0]),w.unshift(0),v.push(l[l.length-1]),w.push(1),t.fillGradientType===Vc.LINEAR_VERTICAL){h=this.context.createLinearGradient(_/2,o,_/2,m+o);const x=n.fontProperties.fontSize+t.strokeThickness;for(let T=0;T<e.length;T++){const r=n.lineHeight*(T-1)+x,a=n.lineHeight*T;let u=a;T>0&&r>a&&(u=(a+r)/2);const f=a+x,g=n.lineHeight*(T+1);let b=f;T+1<e.length&&g<f&&(b=(f+g)/2);const S=(b-u)/m;for(let A=0;A<v.length;A++){let C=0;typeof w[A]=="number"?C=w[A]:C=A/v.length;let B=Math.min(1,Math.max(0,u/m+C*S));B=Number(B.toFixed(5)),h.addColorStop(B,v[A])}}}else{h=this.context.createLinearGradient(o,m/2,_+o,m/2);const x=v.length+1;let T=1;for(let r=0;r<v.length;r++){let a;typeof w[r]=="number"?a=w[r]:a=T/x,h.addColorStop(a,v[r]),T++}}return h}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},vk,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=ns(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=ns(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof us?this._style=t:this._style=new us(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};ww.defaultAutoResolution=!0;let Sw=ww;class xk{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function bk(s,t){var n;let e=!1;if((n=s==null?void 0:s._textures)!=null&&n.length){for(let l=0;l<s._textures.length;l++)if(s._textures[l]instanceof Ct){const h=s._textures[l].baseTexture;t.includes(h)||(t.push(h),e=!0)}}return e}function wk(s,t){if(s.baseTexture instanceof qt){const e=s.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Sk(s,t){if(s._texture&&s._texture instanceof Ct){const e=s._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Ek(s,t){return t instanceof Sw?(t.updateText(!0),!0):!1}function Tk(s,t){if(t instanceof us){const e=t.toFontString();return Jn.measureFont(e),!0}return!1}function Ak(s,t){if(s instanceof Sw){t.includes(s.style)||t.push(s.style),t.includes(s)||t.push(s);const e=s._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Ck(s,t){return s instanceof us?(t.includes(s)||t.push(s),!0):!1}const Ew=class Tw{constructor(t){this.limiter=new xk(Tw.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Ak),this.registerFindHook(Ck),this.registerFindHook(bk),this.registerFindHook(wk),this.registerFindHook(Sk),this.registerUploadHook(Ek),this.registerUploadHook(Tk)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Hi.system.addOnce(this.tick,this,na.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let n=0,l=this.uploadHooks.length;n<l;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Hi.system.addOnce(this.tick,this,na.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,n=t.length;e<n;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Cr)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Hi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Ew.uploadsPerFrame=4;let C_=Ew;Object.defineProperties(wt,{UPLOADS_PER_FRAME:{get(){return C_.uploadsPerFrame},set(s){ne("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),C_.uploadsPerFrame=s}}});function Aw(s,t){return t instanceof qt?(t._glTextures[s.CONTEXT_UID]||s.texture.bind(t),!0):!1}function Uk(s,t){if(!(t instanceof mw))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:n}=e;for(let l=0;l<n.length;l++){const{texture:h}=n[l].style;h&&Aw(s,h.baseTexture)}return e.batchable||s.geometry.bind(e,t._resolveDirectShader(s)),!0}function Ik(s,t){return s instanceof mw?(t.push(s),!0):!1}class Cw extends C_{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Ik),this.registerUploadHook(Aw),this.registerUploadHook(Uk)}}Cw.extension={name:"prepare",type:yt.RendererSystem};Ut.add(Cw);var Pk=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Rk=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Bk=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,z0=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Fk=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const su=new Se;class Uw extends Gc{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Ib,this.state=tn.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Jr.from(z0,Fk,e),this.shader=t.context.webGLVersion>1?Jr.from(Rk,Pk,e):Jr.from(z0,Bk,e)}render(t){const e=this.renderer,n=this.quad;let l=n.vertices;l[0]=l[6]=t._width*-t.anchor.x,l[1]=l[3]=t._height*-t.anchor.y,l[2]=l[4]=t._width*(1-t.anchor.x),l[5]=l[7]=t._height*(1-t.anchor.y);const h=t.uvRespectAnchor?t.anchor.x:0,d=t.uvRespectAnchor?t.anchor.y:0;l=n.uvs,l[0]=l[6]=-h,l[1]=l[3]=-d,l[2]=l[4]=1-h,l[5]=l[7]=1-d,n.invalidate();const o=t._texture,_=o.baseTexture,m=_.alphaMode>0,v=t.tileTransform.localTransform,w=t.uvMatrix;let x=_.isPowerOfTwo&&o.frame.width===_.width&&o.frame.height===_.height;x&&(_._glTextures[e.CONTEXT_UID]?x=_.wrapMode!==os.CLAMP:_.wrapMode===os.CLAMP&&(_.wrapMode=os.REPEAT));const T=x?this.simpleShader:this.shader,r=o.width,a=o.height,u=t._width,f=t._height;su.set(v.a*r/u,v.b*r/f,v.c*a/u,v.d*a/f,v.tx/u,v.ty/f),su.invert(),x?su.prepend(w.mapCoord):(T.uniforms.uMapCoord=w.mapCoord.toArray(!0),T.uniforms.uClampFrame=w.uClampFrame,T.uniforms.uClampOffset=w.uClampOffset),T.uniforms.uTransform=su.toArray(!0),T.uniforms.uColor=we.shared.setValue(t.tint).premultiply(t.worldAlpha,m).toArray(T.uniforms.uColor),T.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),T.uniforms.uSampler=o,e.shader.bind(T),e.geometry.bind(n),this.state.blendMode=gb(t.blendMode,m),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Uw.extension={name:"tilingSprite",type:yt.RendererPlugin};Ut.add(Uw);const Iw=class wl{constructor(t,e,n){this.linkedSheets=[],(t instanceof qt||t instanceof Ct)&&(t={texture:t,data:e,resolutionFilename:n});const{texture:l,data:h,resolutionFilename:d=null,cachePrefix:o=""}=t;this.cachePrefix=o,this._texture=l instanceof Ct?l:null,this.baseTexture=l instanceof qt?l:this._texture.baseTexture,this.textures={},this.animations={},this.data=h;const _=this.baseTexture.resource;this.resolution=this._updateResolution(d||(_?_.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let n=Pn(t,null);return n===null&&(n=typeof e=="number"?e:parseFloat(e??"1")),n!==1&&this.baseTexture.setResolution(n),n}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=wl.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const n=wl.BATCH_SIZE;for(;e-t<n&&e<this._frameKeys.length;){const l=this._frameKeys[e],h=this._frames[l],d=h.frame;if(d){let o=null,_=null;const m=h.trimmed!==!1&&h.sourceSize?h.sourceSize:h.frame,v=new Jt(0,0,Math.floor(m.w)/this.resolution,Math.floor(m.h)/this.resolution);h.rotated?o=new Jt(Math.floor(d.x)/this.resolution,Math.floor(d.y)/this.resolution,Math.floor(d.h)/this.resolution,Math.floor(d.w)/this.resolution):o=new Jt(Math.floor(d.x)/this.resolution,Math.floor(d.y)/this.resolution,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution),h.trimmed!==!1&&h.spriteSourceSize&&(_=new Jt(Math.floor(h.spriteSourceSize.x)/this.resolution,Math.floor(h.spriteSourceSize.y)/this.resolution,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution)),this.textures[l]=new Ct(this.baseTexture,o,v,_,h.rotated?2:0,h.anchor,h.borders),Ct.addToCache(this.textures[l],this.cachePrefix+l.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++){const l=t[e][n];this.animations[e].push(this.textures[l])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*wl.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*wl.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const n in this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Iw.BATCH_SIZE=1e3;let G0=Iw;const Mk=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Pw(s,t,e){const n={};if(s.forEach(l=>{n[l]=t}),Object.keys(t.textures).forEach(l=>{n[`${t.cachePrefix}${l}`]=t.textures[l]}),!e){const l=ei.dirname(s[0]);t.linkedSheets.forEach((h,d)=>{Object.assign(n,Pw([`${l}/${t.data.meta.related_multi_packs[d]}`],h,!0))})}return n}const Lk={extension:yt.Asset,cache:{test:s=>s instanceof G0,getCacheableAssets:(s,t)=>Pw(s,t,!1)},resolver:{test:s=>{const t=s.split("?")[0].split("."),e=t.pop(),n=t.pop();return e==="json"&&Mk.includes(n)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=wt.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:yt.LoadParser,priority:Ir.Normal},async testParse(s,t){return ei.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var v,w;const{texture:n,imageFilename:l,cachePrefix:h}=(t==null?void 0:t.data)??{};let d=ei.dirname(t.src);d&&d.lastIndexOf("/")!==d.length-1&&(d+="/");let o;if(n&&n.baseTexture)o=n;else{const x=w_(d+(l??s.meta.image),t.src);o=(await e.load([x]))[x]}const _=new G0({texture:o.baseTexture,data:s,resolutionFilename:t.src,cachePrefix:h});await _.parse();const m=(v=s==null?void 0:s.meta)==null?void 0:v.related_multi_packs;if(Array.isArray(m)){const x=[];for(const r of m){if(typeof r!="string")continue;let a=d+r;(w=t.data)!=null&&w.ignoreMultiPack||(a=w_(a,t.src),x.push(e.load({src:a,data:{ignoreMultiPack:!0}})))}const T=await Promise.all(x);_.linkedSheets=T,T.forEach(r=>{r.linkedSheets=[_].concat(_.linkedSheets.filter(a=>a!==r))})}return _},unload(s){s.destroy(!0)}}};Ut.add(Lk);class Tc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ju{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const h in e){const d=e[h].match(/^[a-z]+/gm)[0],o=e[h].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),_={};for(const m in o){const v=o[m].split("="),w=v[0],x=v[1].replace(/"/gm,""),T=parseFloat(x),r=isNaN(T)?x:T;_[w]=r}n[d].push(_)}const l=new Tc;return n.info.forEach(h=>l.info.push({face:h.face,size:parseInt(h.size,10)})),n.common.forEach(h=>l.common.push({lineHeight:parseInt(h.lineHeight,10)})),n.page.forEach(h=>l.page.push({id:parseInt(h.id,10),file:h.file})),n.char.forEach(h=>l.char.push({id:parseInt(h.id,10),page:parseInt(h.page,10),x:parseInt(h.x,10),y:parseInt(h.y,10),width:parseInt(h.width,10),height:parseInt(h.height,10),xoffset:parseInt(h.xoffset,10),yoffset:parseInt(h.yoffset,10),xadvance:parseInt(h.xadvance,10)})),n.kerning.forEach(h=>l.kerning.push({first:parseInt(h.first,10),second:parseInt(h.second,10),amount:parseInt(h.amount,10)})),n.distanceField.forEach(h=>l.distanceField.push({distanceRange:parseInt(h.distanceRange,10),fieldType:h.fieldType})),l}}class U_{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new Tc,n=t.getElementsByTagName("info"),l=t.getElementsByTagName("common"),h=t.getElementsByTagName("page"),d=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),_=t.getElementsByTagName("distanceField");for(let m=0;m<n.length;m++)e.info.push({face:n[m].getAttribute("face"),size:parseInt(n[m].getAttribute("size"),10)});for(let m=0;m<l.length;m++)e.common.push({lineHeight:parseInt(l[m].getAttribute("lineHeight"),10)});for(let m=0;m<h.length;m++)e.page.push({id:parseInt(h[m].getAttribute("id"),10)||0,file:h[m].getAttribute("file")});for(let m=0;m<d.length;m++){const v=d[m];e.char.push({id:parseInt(v.getAttribute("id"),10),page:parseInt(v.getAttribute("page"),10)||0,x:parseInt(v.getAttribute("x"),10),y:parseInt(v.getAttribute("y"),10),width:parseInt(v.getAttribute("width"),10),height:parseInt(v.getAttribute("height"),10),xoffset:parseInt(v.getAttribute("xoffset"),10),yoffset:parseInt(v.getAttribute("yoffset"),10),xadvance:parseInt(v.getAttribute("xadvance"),10)})}for(let m=0;m<o.length;m++)e.kerning.push({first:parseInt(o[m].getAttribute("first"),10),second:parseInt(o[m].getAttribute("second"),10),amount:parseInt(o[m].getAttribute("amount"),10)});for(let m=0;m<_.length;m++)e.distanceField.push({fieldType:_[m].getAttribute("fieldType"),distanceRange:parseInt(_[m].getAttribute("distanceRange"),10)});return e}}class I_{static test(t){return typeof t=="string"&&t.includes("<font>")?U_.test(wt.ADAPTER.parseXML(t)):!1}static parse(t){return U_.parse(wt.ADAPTER.parseXML(t))}}const up=[ju,U_,I_];function Dk(s){for(let t=0;t<up.length;t++)if(up[t].test(s))return up[t];return null}function kk(s,t,e,n,l,h){const d=e.fill;if(Array.isArray(d)){if(d.length===1)return d[0]}else return d;let o;const _=e.dropShadow?e.dropShadowDistance:0,m=e.padding||0,v=s.width/n-_-m*2,w=s.height/n-_-m*2,x=d.slice(),T=e.fillGradientStops.slice();if(!T.length){const r=x.length+1;for(let a=1;a<r;++a)T.push(a/r)}if(x.unshift(d[0]),T.unshift(0),x.push(d[d.length-1]),T.push(1),e.fillGradientType===Vc.LINEAR_VERTICAL){o=t.createLinearGradient(v/2,m,v/2,w+m);let r=0;const a=(h.fontProperties.fontSize+e.strokeThickness)/w;for(let u=0;u<l.length;u++){const f=h.lineHeight*u;for(let g=0;g<x.length;g++){let b=0;typeof T[g]=="number"?b=T[g]:b=g/x.length;const S=f/w+b*a;let A=Math.max(r,S);A=Math.min(A,1),o.addColorStop(A,x[g]),r=A}}}else{o=t.createLinearGradient(m,w/2,v+m,w/2);const r=x.length+1;let a=1;for(let u=0;u<x.length;u++){let f;typeof T[u]=="number"?f=T[u]:f=a/r,o.addColorStop(f,x[u]),a++}}return o}function Ok(s,t,e,n,l,h,d){const o=e.text,_=e.fontProperties;t.translate(n,l),t.scale(h,h);const m=d.strokeThickness/2,v=-(d.strokeThickness/2);if(t.font=d.toFontString(),t.lineWidth=d.strokeThickness,t.textBaseline=d.textBaseline,t.lineJoin=d.lineJoin,t.miterLimit=d.miterLimit,t.fillStyle=kk(s,t,d,h,[o],e),t.strokeStyle=d.stroke,d.dropShadow){const w=d.dropShadowColor,x=d.dropShadowBlur*h,T=d.dropShadowDistance*h;t.shadowColor=we.shared.setValue(w).setAlpha(d.dropShadowAlpha).toRgbaString(),t.shadowBlur=x,t.shadowOffsetX=Math.cos(d.dropShadowAngle)*T,t.shadowOffsetY=Math.sin(d.dropShadowAngle)*T}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;d.stroke&&d.strokeThickness&&t.strokeText(o,m,v+e.lineHeight-_.descent),d.fill&&t.fillText(o,m,v+e.lineHeight-_.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function qu(s){return s.codePointAt?s.codePointAt(0):s.charCodeAt(0)}function Rw(s){return Array.from?Array.from(s):s.split("")}function Nk(s){typeof s=="string"&&(s=[s]);const t=[];for(let e=0,n=s.length;e<n;e++){const l=s[e];if(Array.isArray(l)){if(l.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${l.length}.`);const h=l[0].charCodeAt(0),d=l[1].charCodeAt(0);if(d<h)throw new Error("[BitmapFont]: Invalid character range.");for(let o=h,_=d;o<=_;o++)t.push(String.fromCharCode(o))}else t.push(...Rw(l))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const qn=class Vr{constructor(t,e,n){var v;const[l]=t.info,[h]=t.common,[d]=t.page,[o]=t.distanceField,_=Pn(d.file),m={};this._ownsTextures=n,this.font=l.face,this.size=l.size,this.lineHeight=h.lineHeight/_,this.chars={},this.pageTextures=m;for(let w=0;w<t.page.length;w++){const{id:x,file:T}=t.page[w];m[x]=e instanceof Array?e[w]:e[T],o!=null&&o.fieldType&&o.fieldType!=="none"&&(m[x].baseTexture.alphaMode=Ri.NO_PREMULTIPLIED_ALPHA,m[x].baseTexture.mipmap=Qr.OFF)}for(let w=0;w<t.char.length;w++){const{id:x,page:T}=t.char[w];let{x:r,y:a,width:u,height:f,xoffset:g,yoffset:b,xadvance:S}=t.char[w];r/=_,a/=_,u/=_,f/=_,g/=_,b/=_,S/=_;const A=new Jt(r+m[T].frame.x/_,a+m[T].frame.y/_,u,f);this.chars[x]={xOffset:g,yOffset:b,xAdvance:S,kerning:{},texture:new Ct(m[T].baseTexture,A),page:T}}for(let w=0;w<t.kerning.length;w++){let{first:x,second:T,amount:r}=t.kerning[w];x/=_,T/=_,r/=_,this.chars[T]&&(this.chars[T].kerning[x]=r)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=((v=o==null?void 0:o.fieldType)==null?void 0:v.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,n){let l;if(t instanceof Tc)l=t;else{const d=Dk(t);if(!d)throw new Error("Unrecognized data format for font.");l=d.parse(t)}e instanceof Ct&&(e=[e]);const h=new Vr(l,e,n);return Vr.available[h.font]=h,h}static uninstall(t){const e=Vr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Vr.available[t]}static from(t,e,n){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:l,padding:h,resolution:d,textureWidth:o,textureHeight:_,...m}=Object.assign({},Vr.defaultOptions,n),v=Nk(l),w=e instanceof us?e:new us(e),x=o,T=new Tc;T.info[0]={face:w.fontFamily,size:w.fontSize},T.common[0]={lineHeight:w.fontSize};let r=0,a=0,u,f,g,b=0;const S=[];for(let C=0;C<v.length;C++){u||(u=wt.ADAPTER.createCanvas(),u.width=o,u.height=_,f=u.getContext("2d"),g=new qt(u,{resolution:d,...m}),S.push(new Ct(g)),T.page.push({id:S.length-1,file:""}));const B=v[C],R=Jn.measureText(B,w,!1,u),M=R.width,N=Math.ceil(R.height),L=Math.ceil((w.fontStyle==="italic"?2:1)*M);if(a>=_-N*d){if(a===0)throw new Error(`[BitmapFont] textureHeight ${_}px is too small (fontFamily: '${w.fontFamily}', fontSize: ${w.fontSize}px, char: '${B}')`);--C,u=null,f=null,g=null,a=0,r=0,b=0;continue}if(b=Math.max(N+R.fontProperties.descent,b),L*d+r>=x){if(r===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${w.fontFamily}', fontSize: ${w.fontSize}px, char: '${B}')`);--C,a+=b*d,a=Math.ceil(a),r=0,b=0;continue}Ok(u,f,R,r,a,d,w);const W=qu(R.text);T.char.push({id:W,page:S.length-1,x:r/d,y:a/d,width:L,height:N,xoffset:0,yoffset:0,xadvance:M-(w.dropShadow?w.dropShadowDistance:0)-(w.stroke?w.strokeThickness:0)}),r+=(L+2*h)*d,r=Math.ceil(r)}if(!(n!=null&&n.skipKerning))for(let C=0,B=v.length;C<B;C++){const R=v[C];for(let M=0;M<B;M++){const N=v[M],L=f.measureText(R).width,W=f.measureText(N).width,k=f.measureText(R+N).width-(L+W);k&&T.kerning.push({first:qu(R),second:qu(N),amount:k})}}const A=new Vr(T,S,!0);return Vr.available[t]!==void 0&&Vr.uninstall(t),Vr.available[t]=A,A}};qn.ALPHA=[["a","z"],["A","Z"]," "],qn.NUMERIC=[["0","9"]],qn.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],qn.ASCII=[[" ","~"]],qn.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:qn.ALPHANUMERIC},qn.available={};let Kn=qn;var zk=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Gk=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const H0=[],$0=[],V0=[],Hk=class Bw extends Cr{constructor(t,e={}){super();const{align:n,tint:l,maxWidth:h,letterSpacing:d,fontName:o,fontSize:_}=Object.assign({},Bw.styleDefaults,e);if(!Kn.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new we(l),this._font=void 0,this._fontName=o,this._fontSize=_,this.text=t,this._maxWidth=h,this._maxLineHeight=0,this._letterSpacing=d,this._anchor=new An(()=>{this.dirty=!0},this,0,0),this._roundPixels=wt.ROUND_PIXELS,this.dirty=!0,this._resolution=wt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var L;const t=Kn.available[this._fontName],e=this.fontSize,n=e/t.size,l=new ue,h=[],d=[],o=[],_=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",m=Rw(_),v=this._maxWidth*t.size/e,w=t.distanceFieldType==="none"?H0:$0;let x=null,T=0,r=0,a=0,u=-1,f=0,g=0,b=0,S=0;for(let W=0;W<m.length;W++){const k=m[W],j=qu(k);if(/(?:\s)/.test(k)&&(u=W,f=T,S++),k==="\r"||k===`
`){d.push(T),o.push(-1),r=Math.max(r,T),++a,++g,l.x=0,l.y+=t.lineHeight,x=null,S=0;continue}const Y=t.chars[j];if(!Y)continue;x&&Y.kerning[x]&&(l.x+=Y.kerning[x]);const ut=V0.pop()||{texture:Ct.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ue};ut.texture=Y.texture,ut.line=a,ut.charCode=j,ut.position.x=Math.round(l.x+Y.xOffset+this._letterSpacing/2),ut.position.y=Math.round(l.y+Y.yOffset),ut.prevSpaces=S,h.push(ut),T=ut.position.x+Math.max(Y.xAdvance-Y.xOffset,Y.texture.orig.width),l.x+=Y.xAdvance+this._letterSpacing,b=Math.max(b,Y.yOffset+Y.texture.height),x=j,u!==-1&&v>0&&l.x>v&&(++g,go(h,1+u-g,1+W-u),W=u,u=-1,d.push(f),o.push(h.length>0?h[h.length-1].prevSpaces:0),r=Math.max(r,f),a++,l.x=0,l.y+=t.lineHeight,x=null,S=0)}const A=m[m.length-1];A!=="\r"&&A!==`
`&&(/(?:\s)/.test(A)&&(T=f),d.push(T),r=Math.max(r,T),o.push(-1));const C=[];for(let W=0;W<=a;W++){let k=0;this._align==="right"?k=r-d[W]:this._align==="center"?k=(r-d[W])/2:this._align==="justify"&&(k=o[W]<0?0:(r-d[W])/o[W]),C.push(k)}const B=h.length,R={},M=[],N=this._activePagesMeshData;w.push(...N);for(let W=0;W<B;W++){const k=h[W].texture,j=k.baseTexture.uid;if(!R[j]){let Y=w.pop();if(!Y){const it=new dk;let gt,Q;t.distanceFieldType==="none"?(gt=new O0(Ct.EMPTY),Q=Vt.NORMAL):(gt=new O0(Ct.EMPTY,{program:Cn.from(Gk,zk),uniforms:{uFWidth:0}}),Q=Vt.NORMAL_NPM);const rt=new k0(it,gt);rt.blendMode=Q,Y={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:rt,vertices:null,uvs:null,indices:null}}Y.index=0,Y.indexCount=0,Y.vertexCount=0,Y.uvsCount=0,Y.total=0;const{_textureCache:ut}=this;ut[j]=ut[j]||new Ct(k.baseTexture),Y.mesh.texture=ut[j],Y.mesh.tint=this._tintColor.value,M.push(Y),R[j]=Y}R[j].total++}for(let W=0;W<N.length;W++)M.includes(N[W])||this.removeChild(N[W].mesh);for(let W=0;W<M.length;W++)M[W].mesh.parent!==this&&this.addChild(M[W].mesh);this._activePagesMeshData=M;for(const W in R){const k=R[W],j=k.total;if(!(((L=k.indices)==null?void 0:L.length)>6*j)||k.vertices.length<k0.BATCHABLE_SIZE*2)k.vertices=new Float32Array(4*2*j),k.uvs=new Float32Array(4*2*j),k.indices=new Uint16Array(6*j);else{const Y=k.total,ut=k.vertices;for(let it=Y*4*2;it<ut.length;it++)ut[it]=0}k.mesh.size=6*j}for(let W=0;W<B;W++){const k=h[W];let j=k.position.x+C[k.line]*(this._align==="justify"?k.prevSpaces:1);this._roundPixels&&(j=Math.round(j));const Y=j*n,ut=k.position.y*n,it=k.texture,gt=R[it.baseTexture.uid],Q=it.frame,rt=it._uvs,Z=gt.index++;gt.indices[Z*6+0]=0+Z*4,gt.indices[Z*6+1]=1+Z*4,gt.indices[Z*6+2]=2+Z*4,gt.indices[Z*6+3]=0+Z*4,gt.indices[Z*6+4]=2+Z*4,gt.indices[Z*6+5]=3+Z*4,gt.vertices[Z*8+0]=Y,gt.vertices[Z*8+1]=ut,gt.vertices[Z*8+2]=Y+Q.width*n,gt.vertices[Z*8+3]=ut,gt.vertices[Z*8+4]=Y+Q.width*n,gt.vertices[Z*8+5]=ut+Q.height*n,gt.vertices[Z*8+6]=Y,gt.vertices[Z*8+7]=ut+Q.height*n,gt.uvs[Z*8+0]=rt.x0,gt.uvs[Z*8+1]=rt.y0,gt.uvs[Z*8+2]=rt.x1,gt.uvs[Z*8+3]=rt.y1,gt.uvs[Z*8+4]=rt.x2,gt.uvs[Z*8+5]=rt.y2,gt.uvs[Z*8+6]=rt.x3,gt.uvs[Z*8+7]=rt.y3}this._textWidth=r*n,this._textHeight=(l.y+t.lineHeight)*n;for(const W in R){const k=R[W];if(this.anchor.x!==0||this.anchor.y!==0){let it=0;const gt=this._textWidth*this.anchor.x,Q=this._textHeight*this.anchor.y;for(let rt=0;rt<k.total;rt++)k.vertices[it++]-=gt,k.vertices[it++]-=Q,k.vertices[it++]-=gt,k.vertices[it++]-=Q,k.vertices[it++]-=gt,k.vertices[it++]-=Q,k.vertices[it++]-=gt,k.vertices[it++]-=Q}this._maxLineHeight=b*n;const j=k.mesh.geometry.getBuffer("aVertexPosition"),Y=k.mesh.geometry.getBuffer("aTextureCoord"),ut=k.mesh.geometry.getIndex();j.data=k.vertices,Y.data=k.uvs,ut.data=k.indices,j.update(),Y.update(),ut.update()}for(let W=0;W<h.length;W++)V0.push(h[W]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:n,size:l}=Kn.available[this._fontName];if(n!=="none"){const{a:h,b:d,c:o,d:_}=this.worldTransform,m=Math.sqrt(h*h+d*d),v=Math.sqrt(o*o+_*_),w=(Math.abs(m)+Math.abs(v))/2,x=this.fontSize/l,T=t._view.resolution;for(const r of this._activePagesMeshData)r.mesh.shader.uniforms.uFWidth=w*e*x*T}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Kn.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Kn.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Kn.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,n=Kn.available[this._fontName].distanceFieldType==="none"?H0:$0;n.push(...this._activePagesMeshData);for(const l of this._activePagesMeshData)this.removeChild(l.mesh);this._activePagesMeshData=[],n.filter(l=>e[l.mesh.texture.baseTexture.uid]).forEach(l=>{l.mesh.texture=Ct.EMPTY});for(const l in e)e[l].destroy(),delete e[l];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Hk.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const $k=[".xml",".fnt"],Vk={extension:{type:yt.LoadParser,priority:Ir.Normal},name:"loadBitmapFont",test(s){return $k.includes(ei.extname(s).toLowerCase())},async testParse(s){return ju.test(s)||I_.test(s)},async parse(s,t,e){const n=ju.test(s)?ju.parse(s):I_.parse(s),{src:l}=t,{page:h}=n,d=[];for(let m=0;m<h.length;++m){const v=h[m].file;let w=ei.join(ei.dirname(l),v);w=w_(w,l),d.push(w)}const o=await e.load(d),_=d.map(m=>o[m]);return Kn.install(n,_,!0)},async load(s,t){return(await wt.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}};Ut.add(Vk);const P_=class eo extends us{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new eo(Object.keys(eo.defaultOptions).reduce((e,n)=>({...e,[n]:t[n]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete eo.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:n}=eo;if(n[t]){const l=n[t];return this._fonts.push(l),l.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return wt.ADAPTER.fetch(t).then(l=>l.blob()).then(async l=>new Promise((h,d)=>{const o=URL.createObjectURL(l),_=new FileReader;_.onload=()=>h([o,_.result]),_.onerror=d,_.readAsDataURL(l)})).then(async([l,h])=>{const d=Object.assign({family:ei.basename(t,ei.extname(t)),weight:"normal",style:"normal",display:"auto",src:l,dataSrc:h,refs:1,originalUrl:t,fontFace:null},e);n[t]=d,this._fonts.push(d),this.styleID++;const o=new FontFace(d.family,`url(${d.src})`,{weight:d.weight,style:d.style,display:d.display});d.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(n=>!this._overrides.includes(n));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(n=>this._overrides.includes(n));e.length>0&&(this._overrides=this._overrides.filter(n=>!e.includes(n)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=M3(t)),typeof t=="number"?F3(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),l=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const h=`${n}px ${l}px`;return this.dropShadowBlur>0?`text-shadow: ${h} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${h} ${t}`}reset(){Object.assign(this,eo.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=wt.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};P_.availableFonts={},P_.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let cp=P_;const au=class io extends la{constructor(t="",e={}){super(Ct.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const n=new Image,l=Ct.from(n,{scaleMode:wt.SCALE_MODE,resourceOptions:{autoLoad:!1}});l.orig=new Jt,l.trim=new Jt,this.texture=l;const h="http://www.w3.org/2000/svg",d="http://www.w3.org/1999/xhtml",o=document.createElementNS(h,"svg"),_=document.createElementNS(h,"foreignObject"),m=document.createElementNS(d,"div"),v=document.createElementNS(d,"style");_.setAttribute("width","10000"),_.setAttribute("height","10000"),_.style.overflow="hidden",o.appendChild(_),this.maxWidth=io.defaultMaxWidth,this.maxHeight=io.defaultMaxHeight,this._domElement=m,this._styleElement=v,this._svgRoot=o,this._foreignObject=_,this._foreignObject.appendChild(v),this._foreignObject.appendChild(m),this._image=n,this._loadImage=new Image,this._autoResolution=io.defaultAutoResolution,this._resolution=io.defaultResolution??wt.RESOLUTION,this.text=t,this.style=e}measureText(t){var v,w;const{text:e,style:n,resolution:l}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:n.toCSS(l)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const h=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:d,height:o}=h;(d>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const _=Math.min(this.maxWidth,Math.ceil(d)),m=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",_.toString()),this._svgRoot.setAttribute("height",m.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:(v=this._style)==null?void 0:v.toCSS(l)}),this._styleElement.textContent=(w=this._style)==null?void 0:w.toGlobalCSS()),{width:_+n.padding*2,height:m+n.padding*2}}async updateText(t=!0){const{style:e,_image:n,_loadImage:l}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:h,height:d}=this.measureText();n.width=l.width=Math.ceil(Math.max(1,h)),n.height=l.height=Math.ceil(Math.max(1,d)),this._updateID++;const o=this._updateID;await new Promise(_=>{l.onload=async()=>{if(o<this._updateID){_();return}await e.onBeforeDraw(),n.src=l.src,l.onload=null,l.src="",this.updateTexture(),_()};const m=new XMLSerializer().serializeToString(this._svgRoot);l.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(m)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:n,resolution:l}=this,{padding:h}=t,{baseTexture:d}=e;e.trim.width=e._frame.width=n.width/l,e.trim.height=e._frame.height=n.height/l,e.trim.x=-h,e.trim.y=-h,e.orig.width=e._frame.width-h*2,e.orig.height=e._frame.height-h*2,this._onTextureUpdate(),d.setRealSize(n.width,n.height,l),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var n,l,h,d,o;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},io.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((n=this._style)==null||n.cleanFonts()),this._style=e,(l=this._svgRoot)==null||l.remove(),this._svgRoot=e,(h=this._domElement)==null||h.remove(),this._domElement=e,(d=this._foreignObject)==null||d.remove(),this._foreignObject=e,(o=this._styleElement)==null||o.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=ns(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=ns(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof cp?(this.ownsStyle=!1,this._style=t):t instanceof us?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=cp.from(t)):(this.ownsStyle=!0,this._style=new cp(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};au.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},au.defaultMaxWidth=2024,au.defaultMaxHeight=2024,au.defaultAutoResolution=!0;const Wk={class:"flex-1 flex items-center justify-center"},Xk={class:"control-bar w-full px-4 py-4 flex items-center gap-4"},Yk={class:"text-white text-base"},jk={class:"text-white text-base"},qk={class:"flex w-full items-center justify-center gap-6"},Kk={class:"text-white hover:text-purple-500 transition-colors"},Zk={class:"ml-auto flex items-center gap-4"},Jk=hi({__name:"Player",props:{tracks:{},currentTime:{},playerDuration:{}},emits:["prevFrame","nextFrame","timeUpdate","captureImage","fullscreenChange","updateClipProps"],setup(s,{expose:t,emit:e}){const n=s,l=e,h=sa(),d=Uc("activeClip"),o=Tt(!1),_=Tt(!1),m=Tt(100),v=Tt(!1),w=Tt(!1),x=Tt(null),T=Tt(null),r=Tt(0);let a=null;De(()=>v.value||m.value===0?"fa-volume-mute":m.value<30?"fa:volume-off":m.value<70?"fa-volume-down":"fa-volume-up");const u=De(()=>h.getCanvasSize),f=De(()=>{let H=0;return n.tracks.forEach(G=>{G.clips.forEach(at=>{H++})}),H}),g=H=>{H?(a.play({start:n.currentTime*1e6}),_.value=!0):(a.pause(),_.value=!1)},b=()=>{a.pause(),_.value=!1},S=()=>{_.value&&g(!1),l("timeUpdate",n.currentTime-1/30),a.previewFrame(n.currentTime*1e6)},A=()=>{_.value&&g(!1),l("timeUpdate",n.currentTime+1/30),a.previewFrame(n.currentTime*1e6)},C=()=>{w.value=!w.value,w.value?T.value&&T.value.requestFullscreen():document.exitFullscreen()},B=H=>{const G=document.activeElement;if(!(G instanceof HTMLInputElement||G instanceof HTMLTextAreaElement||(G==null?void 0:G.getAttribute("contenteditable"))==="true"))switch(H.code){case"Space":H.preventDefault(),g(!_.value);break;case"ArrowLeft":H.preventDefault(),S();break;case"ArrowRight":H.preventDefault(),A();break}},R=()=>{a=new X2(x.value,{bgColor:"#000",width:1920,height:1080}),console.log(a),N(),a.previewFrame(0),a.on("timeupdate",H=>{l("timeUpdate",H/1e6)}),a.on("playing",()=>{console.log("playing")}),a.on("paused",()=>{console.log("paused"),n.currentTime>=n.playerDuration&&(_.value=!1,l("timeUpdate",0))}),a.on("activeSpriteChange",H=>{for(const[G,at]of M.entries())Object.is(at,H)&&d(G)})},M=new Map,N=()=>{n.tracks.forEach(H=>{H.clips.forEach(G=>{k(G)})})},L=H=>{k(H)},W=H=>{if(!H)return a.activeSprite=null;const G=M.get(H.id);a&&(G!=null&&G.visible)&&(a.activeSprite=G)},k=async H=>{if(M.has(H.id))return;let G=null;switch(H.type){case"video":{let at=await cf(H.path),vt=await new N_(await at.stream());vt.tickInterceptor=async(At,kt)=>{let ht=[];for(const q of kt.audio)ht.push(q.map(nt=>nt=nt*(H.volume/100)));return kt.audio=ht,kt.video=await j(kt.video),kt},Number(H.sourceStartTime)>0&&(vt=(await vt.split(Number(H.sourceStartTime)*1e6))[1]),G=new Jo(vt);break}case"audio":{const at=await cf(H.path);let vt=await new z_(await at.stream());if(Number(H.sourceStartTime)>0){const At=await vt.split(Number(H.sourceStartTime)*1e6);Number(H.sourceEndTime)?vt=(await At[1].split((Number(H.originalDuration)-Number(H.sourceEndTime)-Number(H.sourceStartTime))*1e6))[0]:vt=At[1]}G=new Jo(vt),G.visible=!1;break}case"image":{const at=await cf(H.path);let vt=null;if(H.isAnimateImg){const At=at.name.split(".").pop();vt=new Ku({type:`image/${At}`,stream:await at.stream()})}else vt=new Ku(await at.stream());G=new Jo(vt);break}case"text":{const at=new Bp(H.textConfig,(vt,At)=>{l("updateClipProps",H.id,{w:vt,h:At})});G=new Jo(at);break}case"filter":{const at=new Dp(Number(H.duration)*1e6);G=new Jo(at),G.visible=!1;break}}h.unsubscribeFromClipUpdates(H.id),h.subscribeToClipUpdates(H.id,async(at,vt)=>{ut(at,vt)}),G&&(G.time.offset=Number(H.startTime)*1e6,G.time.duration=Number(H.duration)*1e6,G.opacity=Number((H.opacity/100).toFixed(2)),G.rect.fixedScaleCenter=!0,G.rect.fixedAspectRatio=!0,M.set(H.id,G),await(a==null?void 0:a.addSprite(G)),r.value++,H.type!=="audio"&&(H.w?(G.rect.x=H.x,G.rect.y=H.y,G.rect.w=H.w,G.rect.h=H.h,G.rect.angle=H.angle):H.type==="text"?l("updateClipProps",H.id,{x:G.rect.x,y:G.rect.y,w:H.textConfig.width,h:H.textConfig.height,angle:G.rect.angle}):l("updateClipProps",H.id,{x:G.rect.x,y:G.rect.y,w:G.rect.w,h:G.rect.h,angle:G.rect.angle})),G.rect.on("propsChange",at=>{H.type==="text"?"w"in at&&H.w&&(H.textConfig.fontSize=at.w/H.w*H.textConfig.fontSize,H.w=at.w):l("updateClipProps",H.id,at)}))},j=async(H,G)=>{if(!H)return null;const at=H.displayWidth,vt=H.displayHeight,At=n.tracks.flatMap(Nt=>Nt.clips).filter(Nt=>Nt.type==="filter"&&n.currentTime>=Nt.startTime&&n.currentTime<Nt.startTime+Nt.duration);if(!At.length)return H;const kt=new lw({width:at,height:vt,backgroundAlpha:0}),ht=Ct.from(H),q=la.from(ht);kt.stage.addChild(q);const nt=[];for(const Nt of At){const Lt=Nt.intensity/100;switch(Nt.filterType){case"grayscale":{const ce=new qs;ce.grayscale(Lt,!1),nt.push(ce);break}case"sepia":{const ce=new qs;ce.sepia(!1),nt.push(ce);break}case"invert":{const ce=new qs;ce.negative(!1),nt.push(ce);break}case"brightness":{const ce=new qs;ce.brightness(1+Lt,!1),nt.push(ce);break}case"blur":{const ce=new sw;ce.blur=Lt*10,nt.push(ce);break}}}console.log(),q.filters=nt;const dt=H.timestamp,Xt=H.duration,Ot=kt.renderer.extract.canvas(kt.stage);return kt.destroy(!0),ht.destroy(!0),H.close(),new VideoFrame(Ot,{timestamp:dt,duration:Xt,displayWidth:at,displayHeight:vt})},Y=()=>{let H=0;n.tracks.forEach(G=>{G.clips.forEach(at=>{const vt=M.get(at.id);!vt||at.type==="text"||(vt.zIndex=H++)}),G.clips.forEach(at=>{const vt=M.get(at.id);!vt||at.type!=="text"||(vt.zIndex=H++)})})},ut=async(H,G="default")=>{if(g(!1),!M.has(H.id))return;const at=M.get(H.id);if(G==="delete"){H.type==="filter"&&n.tracks.forEach(vt=>{vt.clips.forEach(At=>{if(n.currentTime>=At.startTime&&n.currentTime<At.startTime+At.duration){const kt=M.get(At.id);kt.preFrame(n.currentTime*1e6-kt.time.offset)}})}),a==null||a.removeSprite(at),M.delete(H.id);return}if(G==="resize"&&(H.type==="video"||H.type==="audio")){a==null||a.removeSprite(at),M.delete(H.id),await k(H);return}if(at.time.offset=H.startTime*1e6,at.time.duration=Number(H.duration)*1e6,at.opacity=Number((H.opacity/100).toFixed(2)),Y(),H.type==="text"){const vt=at.getClip();vt.textConfig=H.textConfig,at.rect.w=H.w,at.rect.h=H.h,at.preFrame(n.currentTime*1e6)}else H.type==="filter"?n.tracks.forEach(vt=>{vt.clips.forEach(At=>{if((At.type==="video"||At.type==="image")&&At.startTime<=n.currentTime&&At.endTime>=n.currentTime){const kt=M.get(At.id);kt&&kt.preFrame(n.currentTime*1e6-kt.time.offset)}})}):H.type!=="audio"&&(at.rect.x=H.x,at.rect.y=H.y,at.rect.w=H.w,at.rect.h=H.h,at.rect.angle=H.angle);a==null||a.previewFrame(n.currentTime*1e6)},it=()=>{a==null||a.destroy(),M.clear(),r.value=0,Il(()=>{R()})},gt=async()=>{const H=await(a==null?void 0:a.createCombinator());try{const G={dangerouslyUseHTMLString:!0,showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!0,showConfirmButton:!1,cancelButtonText:"",customClass:"export-progress-dialog",beforeClose:(at,vt,At)=>{at==="cancel"&&(H==null||H.destroy(),At())}};uf.alert(`
            <div class="flex flex-col gap-2 w-full min-w-[300px]">
                <div class="text-center text-base">0%</div>
                <div class="w-full bg-[#2b2b2b] rounded-full h-2">
                    <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        `,"",G),await Il(),H.on("OutputProgress",at=>{const vt=Math.round(at*100),At=document.querySelector(".el-message-box__message");if(At&&(At.innerHTML=`
                    <div class="flex flex-col gap-2 w-full min-w-[300px]">
                        <div class="text-center text-base">${vt}%</div>
                        <div class="w-full bg-[#2b2b2b] rounded-full h-2">
                            <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: ${vt}%"></div>
                        </div>
                    </div>
                `,at===1)){const kt=document.querySelector(".el-message-box__cancel");kt&&(kt.style.display="none"),At.innerHTML=`
                        <div class="flex flex-col gap-2 w-full min-w-[300px]">
                            <div class="text-center text-green-500 text-base"></div>
                            <div class="w-full bg-[#2b2b2b] rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 100%"></div>
                            </div>
                        </div>
                    `,setTimeout(()=>{uf.close()},3e3)}}),await(H==null?void 0:H.output().pipeTo(await lI()))}catch(G){uf.close(),Zs.error(""+G.message)}},Q=H=>{const G=Math.floor(H/60),at=Math.floor(H%60);return`${G}:${at.toString().padStart(2,"0")}`},rt=()=>{T.value&&new ResizeObserver(G=>{var at;for(let vt of G){const{width:At,height:kt}=vt.contentRect,ht=(at=document.querySelector(".control-bar"))==null?void 0:at.clientHeight,q=kt-ht;At/q>1.7777777777777777?h.setCanvasSize({width:q*16/9,height:q}):h.setCanvasSize({width:At,height:At*9/16})}}).observe(T.value)};So(()=>{Zt.setLogLevel(Zt.warn),R(),rt(),window.addEventListener("keydown",B)}),Nl(()=>{a==null||a.destroy(),M.clear(),a=null,r.value=0,window.removeEventListener("keydown",B);for(const H of M.keys())h.unsubscribeFromClipUpdates(H)}),ls(()=>r.value,H=>{if(f.value!==0&&(o.value=!0),H>=f.value){o.value=!1,a==null||a.previewFrame(n.currentTime*1e6);for(const G of n.tracks.flatMap(at=>at.clips))Y();setTimeout(()=>{const G=a==null?void 0:a.captureImage();l("captureImage",G)},500)}},{immediate:!0}),ls(()=>n.currentTime,H=>{_.value||a.previewFrame(H*1e6)}),t({handleStopPlay:b,refreshPlayer:it,addClip:L,activeClip:W,handleExport:gt});const Z=document.createElement("style");return Z.textContent=`
.export-progress-dialog .el-message-box__content {
    padding: 20px;
}
.export-progress-dialog .el-message-box__message {
    padding: 0;
}
.export-progress-dialog .el-message-box__message p {
    margin: 0;
}
.export-progress-dialog .el-message-box__container {
    width: 100%;
}
`,document.head.appendChild(Z),(H,G)=>{const at=nI("loading");return rI((St(),Ft("div",{ref_key:"playerRef",ref:T,class:"player-container w-full h-full bg-[#1b1b1b] relative flex flex-col"},[$("div",Wk,[$("div",{ref_key:"avCanvas",ref:x,class:"",style:Er({width:Wt(u).width+"px",height:Wt(u).height+"px"})},null,4)]),$("div",Xk,[$("div",Yk,li(Q(H.currentTime)),1),G[2]||(G[2]=$("div",{class:"text-white text-base"},"/",-1)),$("div",jk,li(Q(H.playerDuration)),1),$("div",qk,[$("button",{class:"text-white hover:text-purple-500 transition-colors",onClick:S},[lt(Wt(ye),{icon:"fa-step-backward"})]),$("button",Kk,[Wt(_)?(St(),Pi(Wt(ye),{key:1,icon:"fa-pause",onClick:G[1]||(G[1]=vt=>g(!1))})):(St(),Pi(Wt(ye),{key:0,icon:"fa-play",onClick:G[0]||(G[0]=vt=>g(!0))}))]),$("button",{class:"text-white hover:text-purple-500 transition-colors",onClick:A},[lt(Wt(ye),{icon:"fa-step-forward"})])]),$("div",Zk,[$("button",{class:"text-white hover:text-purple-500 transition-colors",onClick:C},[lt(Wt(ye),{icon:Wt(w)?"fa-compress":"fa-expand"},null,8,["icon"])])])])])),[[at,Wt(o)]])}}}),Qk=ar(Jk,[["__scopeId","data-v-582de19e"]]);let ou;const tO=new Uint8Array(16);function eO(){if(!ou&&(ou=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ou))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ou(tO)}const si=[];for(let s=0;s<256;++s)si.push((s+256).toString(16).slice(1));function iO(s,t=0){return si[s[t+0]]+si[s[t+1]]+si[s[t+2]]+si[s[t+3]]+"-"+si[s[t+4]]+si[s[t+5]]+"-"+si[s[t+6]]+si[s[t+7]]+"-"+si[s[t+8]]+si[s[t+9]]+"-"+si[s[t+10]]+si[s[t+11]]+si[s[t+12]]+si[s[t+13]]+si[s[t+14]]+si[s[t+15]]}const rO=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W0={randomUUID:rO};function as(s,t,e){if(W0.randomUUID&&!s)return W0.randomUUID();s=s||{};const n=s.random||(s.rng||eO)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,iO(n)}const nO={class:"p-5"},sO={class:"flex items-center justify-center"},aO={class:"flex items-center justify-center"},oO={class:"h-[calc(100vh-7rem)] mt-2 overflow-y-auto"},lO={class:"w-full grid grid-cols-2 gap-3"},hO=["onContextmenu","onMouseover","onMouseleave","onDragstart"],uO={class:"relative w-full h-full bg-[#121212]"},cO=["src"],dO=["src"],fO={key:2,class:"w-full aspect-video flex items-center justify-center"},pO={key:3,class:"absolute w-[12%] h-[12%] right-[16%] bottom-[12%] flex items-center gap-1 rounded-full"},_O={class:"text-tiny truncate mt-1"},gO=hi({__name:"mediaLibrary",emits:["add-clip"],setup(s,{emit:t}){const e=sa(),n=Uc("addClip"),l=Tt([]),h=new Map,d=b=>S=>{h.set(b,S)};So(()=>{o()});const o=()=>{Ke.medias.toArray().then(async b=>{if(b){let S=[];for(const A of b){const C=await hI(A.path);S.push({...A,filePath:C})}l.value=S}})},_=async b=>{const S=await Ke.medias.where({name:b.name}).first();if(S&&S.size===b.size)return Zs.warning(""),!1;const A=b.name.split(".").pop();let C="";switch(A){case"mp4":case"mov":case"avi":case"wmv":C="video";break;case"mp3":case"wav":case"m4a":case"m4s":case"m3u8":case"aac":case"ogg":case"flac":case"webm":case"opus":C="audio";break;case"png":case"jpg":case"jpeg":case"gif":case"bmp":case"tiff":case"ico":case"svg":case"webp":case"avif":C="image";break;default:return Zs.warning(""),!1}let B="/"+C+"/"+b.name;const R=await Pl(B);let M=!1;if(R.exists()&&(await R.remove(),M=!0),await F_(B,b.stream()),await Pl(B).exists()){const N={name:b.name,size:b.size,type:C,path:B,isAnimateImg:!1};switch(C){case"video":const W=await new N_(b.stream()).ready;W&&(N.duration=W.duration);break;case"audio":const j=await new z_(await b.stream()).ready;j&&(N.duration=j.duration);break;case"image":try{N.duration=3e6;const Y=["gif","webp","avif","webp"],ut=b.name.split(".").pop();if(Y.includes(ut)){const it=new Ku({type:`image/${ut}`,stream:await b.stream()}),gt=await it.ready,{video:Q}=await it.tick(0),{video:rt}=await it.tick(1e6),H=new OffscreenCanvas(Q.codedWidth,Q.codedHeight).getContext("2d");H.drawImage(Q,0,0);const G=H.getImageData(0,0,Q.codedWidth,Q.codedHeight);H.clearRect(0,0,Q.codedWidth,Q.height),H.drawImage(rt,0,0);const at=H.getImageData(0,0,rt.codedWidth,rt.codedHeight),vt=m(G.data,at.data);N.isAnimateImg=!0}else N.isAnimateImg=!1}catch(Y){console.log(Y)}break}M&&S?(N.updateTime=new Date().getTime(),await Ke.medias.where({name:b.name}).modify(N)):(N.createTime=new Date().getTime(),await Ke.medias.add(N)),o()}else Zs.error("");return!1},m=(b,S)=>{if(b.length!==S.length)return!1;for(let A=0;A<b.length;A++)if(b[A]!==S[A])return!1;return!0},v=De(()=>e.getShowContextMenu),w=De(()=>e.getContextMenuPosition),x=Tt(""),T=(b,S)=>{x.value=S.id,e.setShowContextMenu(!0);const{offsetX:A,offsetY:C}=b;e.setContextMenuPosition({x:A,y:C})},r=(b,S)=>{b.hovered=!0;const A=h.get(S);A&&b.type==="video"&&A.play()},a=(b,S)=>{b.hovered=!1;const A=h.get(S);A&&b.type==="video"&&(A.currentTime=0,A.pause())},u=(b,S)=>{b.dataTransfer&&(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("application/json",JSON.stringify(S)),b.dataTransfer.setData("text/plain",JSON.stringify(S)),e.setDragData(S))},f=b=>{const S={id:as(),type:b.type,isAnimateImg:b.isAnimateImg,name:b.name,path:b.path,duration:b.duration?Number(b.duration)/1e6:5,startTime:0,endTime:b.duration?Number(b.duration)/1e6:5,opacity:100,angle:0};b.type==="image"&&(S.duration=5,S.endTime=5),n==null||n(S,!0)},g=b=>{Ke.medias.where({id:b.id}).delete(),o()};return(b,S)=>{const A=le("upload-filled"),C=le("el-icon"),B=le("el-upload"),R=le("Headset"),M=le("CirclePlus"),N=le("DeleteFilled");return St(),Ft("div",nO,[$("div",sO,[lt(B,{class:"w-full",drag:"",action:"163",multiple:"","show-file-list":!1,"before-upload":_},{tip:he(()=>S[1]||(S[1]=[])),default:he(()=>[$("div",aO,[lt(C,{class:"mr-1",size:"30"},{default:he(()=>[lt(A)]),_:1}),S[0]||(S[0]=$("div",{class:"flex flex-col items-start"},[$("div",{class:"text-tiny"},"  "),$("div",{class:"flex items-center justify-center text-xs"},"  ")],-1))])]),_:1})]),$("div",oO,[$("div",lO,[(St(!0),Ft($i,null,In(l.value,(L,W)=>(St(),Ft("div",{class:"relative flex flex-col justify-center w-full hover:bg-[#121212] p-1.5 rounded-md",onContextmenu:Ii(k=>T(k,L),["prevent"]),onMouseover:k=>r(L,W),onMouseleave:k=>a(L,W),onDragstart:k=>u(k,L),draggable:"true"},[$("div",uO,[L.type==="image"?(St(),Ft("img",{key:0,src:L.filePath,alt:"",class:"aspect-video object-contain rounded"},null,8,cO)):be("",!0),L.type==="video"?(St(),Ft("video",{key:1,ref_for:!0,ref:d(W),src:L.filePath,muted:"",loop:"",disablepictureinpicture:"",class:"aspect-video object-contain rounded"},null,8,dO)):be("",!0),L.type==="audio"?(St(),Ft("div",fO,[lt(C,null,{default:he(()=>[lt(R)]),_:1})])):be("",!0),L.hovered?(St(),Ft("div",pO,[lt(C,{class:"w-full h-full bg-[#333333] rounded-full cursor-pointer",onClick:Ii(k=>f(L),["stop"])},{default:he(()=>[lt(M)]),_:2},1032,["onClick"]),lt(C,{class:"w-full h-full bg-[#333333] rounded-full cursor-pointer",onClick:Ii(k=>g(L),["stop"])},{default:he(()=>[lt(N)]),_:2},1032,["onClick"])])):be("",!0),Wt(v)&&L.id===x.value?(St(),Ft("div",{key:4,class:"absolute flex flex-col justify-center bg-[#121212] py-1.5 rounded-md",style:Er({left:Wt(w).x+"px",top:Wt(w).y+"px"})},S[2]||(S[2]=[$("div",{class:"px-3 py-0.5 text-tiny hover:bg-gray cursor-pointer"},"",-1)]),4)):be("",!0)]),$("div",_O,li(L.name),1)],40,hO))),256))])])])}}}),mO=ar(gO,[["__scopeId","data-v-152a74d1"]]),yO=""+new URL("1-DX-6C8MT.png",import.meta.url).href,vO=""+new URL("2-Bbrfykah.png",import.meta.url).href,X0=s=>new URL(Object.assign({"../assets/image/text/1.png":yO,"../assets/image/text/2.png":vO})[`../assets/image/${s}`],import.meta.url).href,xO=[{preview:X0("text/1.png"),name:"",style:{content:"",fontSize:48,fontFamily:"Microsoft YaHei",bold:!0,italic:!1,color:"#FFFFFF",opacity:100,lineSpacing:0,letterSpacing:0,align:"center",showShadow:!1,shadowColor:"#000000",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,showStroke:!0,strokeColor:"red",strokeWidth:3}},{preview:X0("text/2.png"),name:"",style:{content:"",fontSize:52,fontFamily:"Microsoft YaHei",bold:!0,italic:!1,color:"#FFD93D",opacity:100,lineSpacing:0,letterSpacing:0,align:"center",showShadow:!0,shadowColor:"rgba(59, 59, 59, 1)",shadowBlur:10,shadowOffsetX:4,shadowOffsetY:4,showStroke:!1,strokeColor:"#000000",strokeWidth:0}}],bO={class:"p-4"},wO={class:"grid grid-cols-2 gap-4"},SO={class:"h-8 text-white text-xl mb-2"},EO={class:"text-[#666] text-sm"},TO={class:"absolute inset-0 bg-purple-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-lg"},AO=["onClick","onDragstart"],CO={class:"h-8 text-white text-xl mb-2"},UO=["src"],IO={class:"text-[#666] text-sm"},PO={class:"absolute inset-0 bg-purple-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-lg"},RO=hi({__name:"textLibrary",setup(s){const t=sa(),e=Uc("addClip"),n=Tt({preview:"Aa",name:"",style:{fontSize:72,fontFamily:"Microsoft YaHei",color:"#ffffff"}}),l=o=>{const _=d(o);t.setDragData(_)},h=o=>{const _=d(o);e==null||e(_,!0)},d=o=>({id:as(),type:"text",name:o.name,duration:5,startTime:0,endTime:5,opacity:100,angle:0,textConfig:{content:o.name||"",lineSpacing:0,letterSpacing:0,showStroke:!1,strokeColor:"#ffffff",strokeWidth:0,showShadow:!1,shadowColor:"#ffffff",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,...o.style}});return(o,_)=>{const m=le("el-icon");return St(),Ft("div",bO,[$("div",wO,[$("div",{class:"relative group cursor-pointer bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded-lg p-4 flex flex-col items-center",onClick:_[0]||(_[0]=v=>h(Wt(n))),draggable:"true",onDragstart:_[1]||(_[1]=v=>l(Wt(n)))},[$("div",SO,li(Wt(n).preview),1),$("div",EO,li(Wt(n).name),1),$("div",TO,[lt(m,{class:"text-white text-2xl"},{default:he(()=>[lt(Wt(gp))]),_:1})])],32),(St(!0),Ft($i,null,In(Wt(xO),v=>(St(),Ft("div",{key:v.name,class:"relative group cursor-pointer bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded-lg p-4 flex flex-col items-center",onClick:w=>h(v),draggable:"true",onDragstart:w=>l(v)},[$("div",CO,[$("img",{src:v.preview,class:"w-full h-full object-contain"},null,8,UO)]),$("div",IO,li(Wt(n).name),1),$("div",PO,[lt(m,{class:"text-white text-2xl"},{default:he(()=>[lt(Wt(gp))]),_:1})])],40,AO))),128))])])}}}),BO={class:"p-4"},FO={class:"grid grid-cols-2 gap-4"},MO=["onClick","onDragstart"],LO={class:"preview-box h-8 mb-2"},DO={class:"text-[#666] text-sm"},kO={class:"absolute inset-0 bg-purple-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-lg"},OO="/preview.jpg",NO=hi({__name:"filterLibrary",setup(s){const t=sa(),e=Uc("addClip"),n=[{type:"grayscale",name:""},{type:"sepia",name:""},{type:"invert",name:""},{type:"brightness",name:""},{type:"blur",name:""}],l=o=>{switch(o){case"grayscale":return{filter:"grayscale(100%)"};case"sepia":return{filter:"sepia(100%)"};case"invert":return{filter:"invert(100%)"};case"brightness":return{filter:"brightness(150%)"};case"blur":return{filter:"blur(2px)"};default:return{}}},h=(o,_)=>{if(!o.dataTransfer)return;const m={id:as(),type:"filter",filterType:_.type,name:_.name,intensity:100,duration:5,startTime:0,endTime:5,originalDuration:5};o.dataTransfer.setData("application/json",JSON.stringify(m)),t.setDragData(m),o.dataTransfer.effectAllowed="copy"},d=o=>{const _={id:as(),type:"filter",filterType:o.type,name:o.name,intensity:100,duration:5,startTime:0,endTime:5,originalDuration:5};e==null||e(_,!0)};return(o,_)=>{const m=le("el-icon");return St(),Ft("div",BO,[$("div",FO,[(St(),Ft($i,null,In(n,v=>$("div",{key:v.type,class:"relative group cursor-pointer bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded-lg p-4 flex flex-col items-center",onClick:w=>d(v),draggable:"true",onDragstart:w=>h(w,v)},[$("div",LO,[$("img",{src:OO,class:"h-full object-contain",style:Er(l(v.type))},null,4)]),$("div",DO,li(v.name),1),$("div",kO,[lt(m,{class:"text-white text-2xl"},{default:he(()=>[lt(Wt(gp))]),_:1})])],40,MO)),64))])])}}}),zO=ar(NO,[["__scopeId","data-v-cee563d8"]]),GO={class:"h-screen"},HO={class:"flex flex-col items-center justify-center"},$O=hi({__name:"clipMenu",setup(s){const t=[{name:"",component:mO},{name:"",component:RO},{name:"",component:zO}];return(e,n)=>{const l=le("Files"),h=le("el-icon"),d=le("el-tab-pane"),o=le("el-tabs");return St(),Ft("div",GO,[lt(o,{type:"border-card",tabPosition:"left"},{default:he(()=>[(St(),Ft($i,null,In(t,_=>lt(d,{label:"User"},{label:he(()=>[$("div",HO,[lt(h,null,{default:he(()=>[lt(l)]),_:1}),$("div",null,li(_.name),1)])]),default:he(()=>[(St(),Pi(sI(_.component),{class:"w-full h-screen bg-[#303030]"}))]),_:2},1024)),64))]),_:1})])}}}),VO=ar($O,[["__scopeId","data-v-946103cd"]]);var ir=typeof window<"u"?window:null,ag=ir===null,Ol=ag?void 0:ir.document,fr="addEventListener",pr="removeEventListener",dp="getBoundingClientRect",al="_a",_r="_b",pn="_c",lu="horizontal",gr=function(){return!1},WO=ag?"calc":["","-webkit-","-moz-","-o-"].filter(function(s){var t=Ol.createElement("div");return t.style.cssText="width:"+s+"calc(9px)",!!t.style.length}).shift()+"calc",Fw=function(s){return typeof s=="string"||s instanceof String},Y0=function(s){if(Fw(s)){var t=Ol.querySelector(s);if(!t)throw new Error("Selector "+s+" did not match a DOM element");return t}return s},fi=function(s,t,e){var n=s[t];return n!==void 0?n:e},hu=function(s,t,e,n){if(t){if(n==="end")return 0;if(n==="center")return s/2}else if(e){if(n==="start")return 0;if(n==="center")return s/2}return s},XO=function(s,t){var e=Ol.createElement("div");return e.className="gutter gutter-"+t,e},YO=function(s,t,e){var n={};return Fw(t)?n[s]=t:n[s]=WO+"("+t+"% - "+e+"px)",n},jO=function(s,t){var e;return e={},e[s]=t+"px",e},j0=function(s,t){if(t===void 0&&(t={}),ag)return{};var e=s,n,l,h,d,o,_;Array.from&&(e=Array.from(e));var m=Y0(e[0]),v=m.parentNode,w=getComputedStyle?getComputedStyle(v):null,x=w?w.flexDirection:null,T=fi(t,"sizes")||e.map(function(){return 100/e.length}),r=fi(t,"minSize",100),a=Array.isArray(r)?r:e.map(function(){return r}),u=fi(t,"maxSize",1/0),f=Array.isArray(u)?u:e.map(function(){return u}),g=fi(t,"expandToMin",!1),b=fi(t,"gutterSize",10),S=fi(t,"gutterAlign","center"),A=fi(t,"snapOffset",30),C=Array.isArray(A)?A:e.map(function(){return A}),B=fi(t,"dragInterval",1),R=fi(t,"direction",lu),M=fi(t,"cursor",R===lu?"col-resize":"row-resize"),N=fi(t,"gutter",XO),L=fi(t,"elementStyle",YO),W=fi(t,"gutterStyle",jO);R===lu?(n="width",l="clientX",h="left",d="right",o="clientWidth"):R==="vertical"&&(n="height",l="clientY",h="top",d="bottom",o="clientHeight");function k(ht,q,nt,dt){var Xt=L(n,q,nt,dt);Object.keys(Xt).forEach(function(Ot){ht.style[Ot]=Xt[Ot]})}function j(ht,q,nt){var dt=W(n,q,nt);Object.keys(dt).forEach(function(Xt){ht.style[Xt]=dt[Xt]})}function Y(){return _.map(function(ht){return ht.size})}function ut(ht){return"touches"in ht?ht.touches[0][l]:ht[l]}function it(ht){var q=_[this.a],nt=_[this.b],dt=q.size+nt.size;q.size=ht/this.size*dt,nt.size=dt-ht/this.size*dt,k(q.element,q.size,this[_r],q.i),k(nt.element,nt.size,this[pn],nt.i)}function gt(ht){var q,nt=_[this.a],dt=_[this.b];this.dragging&&(q=ut(ht)-this.start+(this[_r]-this.dragOffset),B>1&&(q=Math.round(q/B)*B),q<=nt.minSize+nt.snapOffset+this[_r]?q=nt.minSize+this[_r]:q>=this.size-(dt.minSize+dt.snapOffset+this[pn])&&(q=this.size-(dt.minSize+this[pn])),q>=nt.maxSize-nt.snapOffset+this[_r]?q=nt.maxSize+this[_r]:q<=this.size-(dt.maxSize-dt.snapOffset+this[pn])&&(q=this.size-(dt.maxSize+this[pn])),it.call(this,q),fi(t,"onDrag",gr)(Y()))}function Q(){var ht=_[this.a].element,q=_[this.b].element,nt=ht[dp](),dt=q[dp]();this.size=nt[n]+dt[n]+this[_r]+this[pn],this.start=nt[h],this.end=nt[d]}function rt(ht){if(!getComputedStyle)return null;var q=getComputedStyle(ht);if(!q)return null;var nt=ht[o];return nt===0?null:(R===lu?nt-=parseFloat(q.paddingLeft)+parseFloat(q.paddingRight):nt-=parseFloat(q.paddingTop)+parseFloat(q.paddingBottom),nt)}function Z(ht){var q=rt(v);if(q===null||a.reduce(function(Ot,Nt){return Ot+Nt},0)>q)return ht;var nt=0,dt=[],Xt=ht.map(function(Ot,Nt){var Lt=q*Ot/100,ce=hu(b,Nt===0,Nt===ht.length-1,S),Be=a[Nt]+ce;return Lt<Be?(nt+=Be-Lt,dt.push(0),Be):(dt.push(Lt-Be),Lt)});return nt===0?ht:Xt.map(function(Ot,Nt){var Lt=Ot;if(nt>0&&dt[Nt]-nt>0){var ce=Math.min(nt,dt[Nt]-nt);nt-=ce,Lt=Ot-ce}return Lt/q*100})}function H(){var ht=this,q=_[ht.a].element,nt=_[ht.b].element;ht.dragging&&fi(t,"onDragEnd",gr)(Y()),ht.dragging=!1,ir[pr]("mouseup",ht.stop),ir[pr]("touchend",ht.stop),ir[pr]("touchcancel",ht.stop),ir[pr]("mousemove",ht.move),ir[pr]("touchmove",ht.move),ht.stop=null,ht.move=null,q[pr]("selectstart",gr),q[pr]("dragstart",gr),nt[pr]("selectstart",gr),nt[pr]("dragstart",gr),q.style.userSelect="",q.style.webkitUserSelect="",q.style.MozUserSelect="",q.style.pointerEvents="",nt.style.userSelect="",nt.style.webkitUserSelect="",nt.style.MozUserSelect="",nt.style.pointerEvents="",ht.gutter.style.cursor="",ht.parent.style.cursor="",Ol.body.style.cursor=""}function G(ht){if(!("button"in ht&&ht.button!==0)){var q=this,nt=_[q.a].element,dt=_[q.b].element;q.dragging||fi(t,"onDragStart",gr)(Y()),ht.preventDefault(),q.dragging=!0,q.move=gt.bind(q),q.stop=H.bind(q),ir[fr]("mouseup",q.stop),ir[fr]("touchend",q.stop),ir[fr]("touchcancel",q.stop),ir[fr]("mousemove",q.move),ir[fr]("touchmove",q.move),nt[fr]("selectstart",gr),nt[fr]("dragstart",gr),dt[fr]("selectstart",gr),dt[fr]("dragstart",gr),nt.style.userSelect="none",nt.style.webkitUserSelect="none",nt.style.MozUserSelect="none",nt.style.pointerEvents="none",dt.style.userSelect="none",dt.style.webkitUserSelect="none",dt.style.MozUserSelect="none",dt.style.pointerEvents="none",q.gutter.style.cursor=M,q.parent.style.cursor=M,Ol.body.style.cursor=M,Q.call(q),q.dragOffset=ut(ht)-q.end}}T=Z(T);var at=[];_=e.map(function(ht,q){var nt={element:Y0(ht),size:T[q],minSize:a[q],maxSize:f[q],snapOffset:C[q],i:q},dt;if(q>0&&(dt={a:q-1,b:q,dragging:!1,direction:R,parent:v},dt[_r]=hu(b,q-1===0,!1,S),dt[pn]=hu(b,!1,q===e.length-1,S),x==="row-reverse"||x==="column-reverse")){var Xt=dt.a;dt.a=dt.b,dt.b=Xt}if(q>0){var Ot=N(q,R,nt.element);j(Ot,b,q),dt[al]=G.bind(dt),Ot[fr]("mousedown",dt[al]),Ot[fr]("touchstart",dt[al]),v.insertBefore(Ot,nt.element),dt.gutter=Ot}return k(nt.element,nt.size,hu(b,q===0,q===e.length-1,S),q),q>0&&at.push(dt),nt});function vt(ht){var q=ht.i===at.length,nt=q?at[ht.i-1]:at[ht.i];Q.call(nt);var dt=q?nt.size-ht.minSize-nt[pn]:ht.minSize+nt[_r];it.call(nt,dt)}_.forEach(function(ht){var q=ht.element[dp]()[n];q<ht.minSize&&(g?vt(ht):ht.minSize=q)});function At(ht){var q=Z(ht);q.forEach(function(nt,dt){if(dt>0){var Xt=at[dt-1],Ot=_[Xt.a],Nt=_[Xt.b];Ot.size=q[dt-1],Nt.size=nt,k(Ot.element,Ot.size,Xt[_r],Ot.i),k(Nt.element,Nt.size,Xt[pn],Nt.i)}})}function kt(ht,q){at.forEach(function(nt){if(q!==!0?nt.parent.removeChild(nt.gutter):(nt.gutter[pr]("mousedown",nt[al]),nt.gutter[pr]("touchstart",nt[al])),ht!==!0){var dt=L(n,nt.a.size,nt[_r]);Object.keys(dt).forEach(function(Xt){_[nt.a].element.style[Xt]="",_[nt.b].element.style[Xt]=""})}})}return{setSizes:At,getSizes:Y,collapse:function(q){vt(_[q])},destroy:kt,parent:v,pairs:at}};const qO={class:"ticks h-full"},KO={key:0,class:"tick-mark"},ZO={key:1,class:"tick-mark-long"},JO={key:2,class:"tick-label"},Ra=3,q0=100,QO=15,tN=hi({__name:"timelineRuler",props:{duration:{type:Number,required:!0},zoom:{type:Number,default:1},currentTime:{type:Number,default:0},totalWidth:{type:Number,default:0}},emits:["timeUpdate","scroll"],setup(s,{emit:t}){const e=s,n=t,l=Tt(null),h=De(()=>Ra*e.zoom),d=De(()=>Math.ceil(e.duration*10)),o=De(()=>e.currentTime*Ra*e.zoom*10),_=Tt(!1),m=Tt(0),v=Tt(null);let w=null,x=Tt(0);const T=S=>{const A=Math.floor(S/10),C=Math.floor(A/60),B=A%60;return`${C}:${B.toString().padStart(2,"0")}`},r=S=>{if(!l.value)return;const A=l.value.getBoundingClientRect(),B=(S.clientX-A.left)/(Ra*e.zoom*10);n("timeUpdate",Math.max(0,Math.min(B,e.duration))),u(S)},a=S=>{if(S.stopPropagation(),!l.value)return;const A=l.value.getBoundingClientRect(),C=S.clientX-A.left,B=Math.max(0,Math.min(C/(Ra*e.zoom*10),e.duration));n("timeUpdate",B),u(S)},u=S=>{_.value=!0,m.value=S.clientX,x.value=S.clientX,document.addEventListener("mousemove",g),document.addEventListener("mouseup",b)},f=()=>{if(!(!_.value||!l.value||!l.value.parentElement)&&v.value){n("scroll",v.value==="right"?QO:-15);const A=l.value.getBoundingClientRect(),C=m.value-A.left,B=Math.max(0,Math.min(C/(Ra*e.zoom*10),e.duration));n("timeUpdate",B),w=requestAnimationFrame(f)}},g=S=>{if(!_.value||!l.value)return;const A=l.value.getBoundingClientRect(),C=l.value.parentElement;if(!C)return;const B=S.clientX-A.left,R=S.clientX-x.value;if(x.value=S.clientX,R!==0){const N=C.getBoundingClientRect();R>0?S.clientX>N.right-q0?v.value!=="right"&&(v.value="right",f()):v.value=null:S.clientX<N.left+q0?v.value!=="left"&&(v.value="left",f()):v.value=null}const M=Math.max(0,Math.min(B/(Ra*e.zoom*10),e.duration));n("timeUpdate",M),m.value=S.clientX},b=()=>{_.value=!1,v.value=null,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",b),w!==null&&(cancelAnimationFrame(w),w=null)};return Nl(()=>{w!==null&&cancelAnimationFrame(w)}),(S,A)=>(St(),Ft($i,null,[$("div",{class:"ticks-container h-10",ref_key:"rulerContainer",ref:l,style:Er({width:s.totalWidth+"px"}),onMousedown:r},[$("div",qO,[(St(!0),Ft($i,null,In(Wt(d),C=>(St(),Ft("div",{key:C,class:"tick h-full",style:Er({left:C*Wt(h)+"px"})},[C%5===0?(St(),Ft("div",KO)):be("",!0),C%50===0?(St(),Ft("div",ZO)):be("",!0),C%50===0?(St(),Ft("span",JO,li(T(C)),1)):be("",!0)],4))),128))])],36),$("div",{class:"playhead",style:Er({left:Wt(o)+"px"}),onMousedown:a},A[0]||(A[0]=[$("div",{class:"playhead-line"},null,-1),$("div",{class:"playhead-triangle"},null,-1)]),36)],64))}}),eN=ar(tN,[["__scopeId","data-v-9b78982e"]]),iN={class:"w-full h-full p-1 flex flex-col justify-center items-center pointer-events-none select-none"},rN={key:0,class:"flex flex-nowrap gap-0.5 items-center overflow-hidden px-1 h-full"},nN=["src"],sN={key:1,class:"flex flex-nowrap gap-0.5 items-center overflow-hidden px-1 h-full"},aN=["src"],oN={key:2,class:"w-full h-full flex flex-col relative rounded"},lN={class:"absolute inset-0"},hN={key:0,class:"absolute inset-0 w-auto h-full flex items-center bg-[#ffffff] bg-opacity-10 text-[#000000]"},uN={class:"text-base inline-block truncate px-5 z-10"},cN={key:3,class:"flex items-center text-bigger text-white whitespace-nowrap overflow-hidden text-ellipsis w-full"},dN={class:"pl-6.5"},fN={key:4,class:"flex items-center text-bigger text-white whitespace-nowrap overflow-hidden text-ellipsis w-full"},pN={class:"pl-6.5"},_N={key:0},gN=hi({__name:"trackItem",props:{clip:{type:Object,required:!0},zoom:{type:Number,default:1},frameLength:{type:Number,default:20},hovered:{type:Boolean,default:!1}},setup(s){const t=s,e=De(()=>70/t.frameLength),n=Tt([]),l=Tt(null),h=()=>{try{if(!t.clip.thumbnail||!Array.isArray(t.clip.thumbnail)){n.value=[];return}const _=Number(t.clip.duration);if(isNaN(_)||_<=0){console.warn("Invalid clip duration:",_);return}const m=Math.ceil(_/e.value),v=[];if(t.clip.type==="image"&&t.clip.thumbnail.length>0){const w=t.clip.thumbnail[0];for(let x=0;x<m;x++)v.push(w)}else if(t.clip.type==="video"&&t.clip.thumbnail.length>0){const w=t.clip.thumbnail;let x=w[0];for(let T=0;T<m;T++){const r=T*e.value,a=w.find(u=>u.timestamp/1e6>=r)||x||w[w.length-1];a&&(v.push(a),x=a)}}n.value=v}catch(_){console.error("Error updating thumbnails:",_),n.value=[]}},d=()=>{try{if(!l.value||!t.clip.volumeData)return;const _=l.value,m=_.getContext("2d");if(!m)return;const v=_.getBoundingClientRect();if(_.width=v.width*window.devicePixelRatio,_.height=v.height*window.devicePixelRatio,m.clearRect(0,0,_.width,_.height),!t.clip.originalDuration){console.warn("Missing originalDuration for audio clip");return}const w=t.clip.volumeData.slice(t.clip.sourceStartTime/t.clip.originalDuration*t.clip.volumeData.length,(t.clip.originalDuration-t.clip.sourceEndTime)/t.clip.originalDuration*t.clip.volumeData.length);if(!w.length){console.warn("No volume data available");return}const x=2,T=2,r=Math.floor(_.width/(x+T)),a=_.height*.8,u=w.length/r;m.fillStyle="#ffffff80";for(let f=0;f<r;f++){const g=Math.floor(f*u),S=(w[g]||0)*a,A=f*(x+T),C=(_.height-S)/2;m.fillRect(A,C,x,S)}}catch(_){console.error("Error drawing waveform:",_)}},o=_=>_?{grayscale:"",invert:"",brightness:"",sepia:"",blur:""}[_]:"";return ls([()=>t.frameLength,()=>t.zoom,()=>t.clip.duration,()=>t.clip.sourceStartTime,()=>t.clip.sourceEndTime,()=>t.clip.thumbnail],()=>{t.clip&&(t.clip.type==="video"||t.clip.type==="image")&&Il(()=>{h()})},{deep:!0,immediate:!0}),ls(()=>t.clip.thumbnail,()=>{t.clip&&(t.clip.type==="video"||t.clip.type==="image")&&Il(()=>{h()})},{deep:!0,immediate:!0}),So(()=>{if(t.clip.type==="audio"){const _=new ResizeObserver(()=>{d()});l.value&&(_.observe(l.value),d())}}),(_,m)=>(St(),Ft("div",iN,[s.clip.type==="video"?(St(),Ft("div",rN,[n.value.length>0?(St(!0),Ft($i,{key:0},In(n.value,v=>(St(),Ft("img",{key:v.timestamp,src:v.url,class:"h-[90%] shrink-0 grow-0 object-cover rounded",style:{width:"70px"}},null,8,nN))),128)):be("",!0)])):be("",!0),s.clip.type==="image"?(St(),Ft("div",sN,[n.value.length>0?(St(!0),Ft($i,{key:0},In(n.value,v=>(St(),Ft("img",{key:v.timestamp,src:v.url,class:"h-[90%] shrink-0 grow-0 object-cover rounded",style:{width:"70px"}},null,8,aN))),128)):be("",!0)])):s.clip.type==="audio"?(St(),Ft("div",oN,[$("div",lN,[$("canvas",{ref_key:"waveformCanvas",ref:l,class:"w-full h-full"},null,512)]),s.hovered?(St(),Ft("div",hN,[$("span",uN,li(s.clip.name),1)])):be("",!0)])):s.clip.type==="text"?(St(),Ft("div",cN,[lt(Wt(ye),{icon:"material-symbols-light:text-fields",class:"w-6 h-6 absolute left-1 text-white"}),$("div",dN,li(s.clip.textConfig.content),1)])):s.clip.type==="filter"?(St(),Ft("div",fN,[lt(Wt(ye),{icon:"material-symbols-light:magnify-fullscreen-outline-rounded",class:"w-6 h-6 absolute left-1 text-white"}),$("div",pN,[$("span",null,li(o(s.clip.filterType)),1),s.clip.intensity!==void 0?(St(),Ft("span",_N,li(Math.round(s.clip.intensity))+"% ",1)):be("",!0)])])):be("",!0)]))}}),mN=ar(gN,[["__scopeId","data-v-d31631bc"]]),yN=["data-track","onDragenter","onDragleave"],vN=["data-clip","onMousedown","onMouseover","onMouseleave"],xN={class:"flex items-center justify-center w-full h-full relative"},bN=["onMousedown"],wN=["onMousedown"],SN=hi({__name:"tracksList",props:{tracks:{type:Array,required:!0},hoveredTrack:{type:Number,default:-1},dragPreview:{type:Boolean,default:!1},dragPreviewPosition:{type:Number,default:0},dragPreviewWidth:{type:Number,default:0},zoom:{type:Number,default:1},frameLength:{type:Number,default:20},isReplaceMode:{type:Boolean,default:!1}},emits:["track-drag-enter","track-drag-leave","clip-mouse-down","background-click","save-history-state","clip-hover","start-resize","delete-clip"],setup(s,{expose:t,emit:e}){const n=s,l=e,h=Tt(void 0),d=Tt(void 0),o=()=>{n.tracks.forEach(A=>{A.clips.forEach(C=>{C.selected=!1})}),d.value=void 0},_=A=>{o(),A&&(A.selected=!0,d.value=A)},m=A=>{A.preventDefault()},v=A=>{A.preventDefault();const C=A.currentTarget.getBoundingClientRect();A.clientX-C.left;const B=A.clientY-C.top,R=C.height/n.tracks.length,M=Math.floor(B/R);M>=0&&M<n.tracks.length&&l("track-drag-enter",M)},w=A=>{A.preventDefault();const C=A.currentTarget.getBoundingClientRect(),B=A.clientX,R=A.clientY;(B<C.left||B>C.right||R<C.top||R>C.bottom)&&l("track-drag-leave",n.hoveredTrack)},x=A=>{l("track-drag-enter",A)},T=A=>{l("track-drag-leave",A)},r=(A,C,B)=>{A.stopPropagation(),A.preventDefault(),n.tracks.forEach(M=>{M.clips.forEach(N=>{N!==C&&(N.selected=!1)})}),C.selected=!0,d.value=C,h.value=void 0;const R=A.target;!R.classList.contains("resize-handle")&&!R.closest(".resize-handle")&&l("clip-mouse-down",C,B,A)},a=A=>{d.value||(h.value=A,A.selected=!0),l("clip-hover",A)},u=A=>{h.value===A&&!d.value&&(h.value=void 0,A.selected=!1)},f=(A,C,B)=>{l("start-resize",A,C,B)},g=A=>{o(),l("background-click"),h.value=void 0},b=A=>{const C=document.activeElement;(C==null?void 0:C.tagName)==="INPUT"||(C==null?void 0:C.tagName)==="TEXTAREA"||(C==null?void 0:C.getAttribute("contenteditable"))==="true"||C!=null&&C.classList.contains("el-input__inner")||C!=null&&C.classList.contains("el-textarea__inner")||(A.key==="Delete"||A.key==="Backspace")&&(n.tracks.forEach((R,M)=>{R.clips.filter(L=>L.selected||L===d.value).forEach(L=>{l("delete-clip",L,M)})}),S())},S=()=>{l("save-history-state")};return So(()=>{window.addEventListener("keydown",b);const A=document.querySelector(".tracks-list");A&&A.focus()}),Nl(()=>{window.removeEventListener("keydown",b)}),t({activeClip:_}),(A,C)=>(St(),Ft("div",{class:"w-full h-full bg-[#252525] tracks-list select-none",onDragenter:Ii(m,["prevent"]),onDragover:Ii(v,["prevent"]),onDragleave:Ii(w,["prevent"]),onMousedown:g,onKeydown:b,tabindex:"0"},[(St(!0),Ft($i,null,In(s.tracks,(B,R)=>(St(),Ft("div",{key:B.id,class:"relative h-12 my-3 bg-[#252525]","data-track":B.id,onDragenter:Ii(M=>x(R),["prevent"]),onDragleave:Ii(M=>T(R),["prevent"])},[(St(!0),Ft($i,null,In(B.clips,M=>(St(),Ft("div",{key:M.id,class:Qn(["absolute top-0 h-full flex items-center bg-[#444] rounded-xl cursor-pointer select-none min-w-[30px]",{"ring-2 ring-[#b534cf]":M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id,"bg-[#631975]":M.type==="video","bg-[#6ab7ff]":M.type==="audio","bg-[#722ed133]":M.type==="image","bg-[#a85201]":M.type==="text","bg-[#f827eec2]":M.type==="filter"}]),style:Er({left:`${M.startTime*s.frameLength}px`,width:`${M.duration*s.frameLength}px`}),"data-clip":M.id,onMousedown:Ii(N=>r(N,M,B.id),["stop"]),onMouseover:N=>a(M),onMouseleave:N=>u(M)},[$("div",xN,[lt(mN,{clip:M,zoom:s.zoom,frameLength:s.frameLength,hovered:M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id},null,8,["clip","zoom","frameLength","hovered"])]),M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id?(St(),Ft("div",{key:0,class:"absolute left-[1.25px] top-[0.2px] bottom-0 flex items-center justify-center w-3 h-[98%] bg-[#d4d4d4] rounded-l-[0.75rem] cursor-w-resize hover:bg-[#a0a0a0] z-10",onMousedown:Ii(N=>f(N,M,"left"),["stop"])},C[0]||(C[0]=[$("div",{class:"w-1 h-[80%] bg-[#646464]"},null,-1)]),40,bN)):be("",!0),M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id?(St(),Ft("div",{key:1,class:"absolute right-[1.25px] top-[0.2px] bottom-0 flex items-center justify-center w-3 h-[98%] bg-[#d4d4d4] rounded-r-[0.75rem] cursor-w-resize hover:bg-[#a0a0a0] z-10",onMousedown:Ii(N=>f(N,M,"right"),["stop"])},C[1]||(C[1]=[$("div",{class:"w-1 h-[80%] bg-[#646464]"},null,-1)]),40,wN)):be("",!0)],46,vN))),128))],40,yN))),128))],32))}}),EN=ar(SN,[["__scopeId","data-v-8049a0ae"]]);function TN(s){let t=0;for(let n=0;n<s.length;n++)t+=s[n]*s[n];return Math.sqrt(t/s.length)}const R_=async s=>new Promise(async t=>{if(s.type==="image"){const e=await Pl(s.path),n=new Ku(await e.stream());if(await n.ready){const{video:h}=await n.tick(0);if(h instanceof ImageBitmap){const d=new OffscreenCanvas(h.width,h.height);d.getContext("2d").drawImage(h,0,0,h.width,h.height);const _=await d.convertToBlob();t({type:"image",data:_})}}}else if(s.type==="video"){const e=await Pl(s.path),n=new N_(e);if(await n.ready){let h=performance.now();n.thumbnails().then(d=>{let o=[];d.forEach(_=>{o.push({url:URL.createObjectURL(_.img),timestamp:_.ts})}),console.log("get video frame",(performance.now()-h)/1e3+"s"),t({type:"video",data:o})})}}}),B_=async s=>new Promise(async(t,e)=>{var _;const n=await Pl(s.path),l=new z_(await n.stream());await l.ready,performance.now();let h=!1,d=0,o=[];for(;!h;){const{audio:m,state:v}=await l.tick(d);if(v==="done"){h=!0;continue}if(d+=33333,m.length===0||((_=m[0])==null?void 0:_.length)===0){o.push(0);continue}else{const w=TN(m[0]);o.push(w)}}t({type:"audio",data:o})});var Ac={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ac.exports;(function(s,t){(function(){var e,n="4.17.21",l=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",o="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",m=500,v="__lodash_placeholder__",w=1,x=2,T=4,r=1,a=2,u=1,f=2,g=4,b=8,S=16,A=32,C=64,B=128,R=256,M=512,N=30,L="...",W=800,k=16,j=1,Y=2,ut=3,it=1/0,gt=9007199254740991,Q=17976931348623157e292,rt=NaN,Z=4294967295,H=Z-1,G=Z>>>1,at=[["ary",B],["bind",u],["bindKey",f],["curry",b],["curryRight",S],["flip",M],["partial",A],["partialRight",C],["rearg",R]],vt="[object Arguments]",At="[object Array]",kt="[object AsyncFunction]",ht="[object Boolean]",q="[object Date]",nt="[object DOMException]",dt="[object Error]",Xt="[object Function]",Ot="[object GeneratorFunction]",Nt="[object Map]",Lt="[object Number]",ce="[object Null]",Be="[object Object]",gi="[object Promise]",Wc="[object Proxy]",Vi="[object RegExp]",mi="[object Set]",en="[object String]",ha="[object Symbol]",Xc="[object Undefined]",pe="[object WeakMap]",Yc="[object WeakSet]",fs="[object ArrayBuffer]",Wi="[object DataView]",ua="[object Float32Array]",ps="[object Float64Array]",Bo="[object Int8Array]",Fo="[object Int16Array]",Mo="[object Int32Array]",Pr="[object Uint8Array]",Lo="[object Uint8ClampedArray]",Bn="[object Uint16Array]",Do="[object Uint32Array]",jc=/\b__p \+= '';/g,qc=/\b(__p \+=) '' \+/g,Kc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Yl=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,pt=RegExp(Yl.source),Dt=RegExp(J.source),Mt=/<%-([\s\S]+?)%>/g,It=/<%([\s\S]+?)%>/g,zt=/<%=([\s\S]+?)%>/g,Yt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ge=/^\w*$/,ze=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,He=/[\\^$.*+?()[\]{}|]/g,Te=RegExp(He.source),Ae=/^\s+/,ui=/\s/,Rr=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,jl=/\{\n\/\* \[wrapped with (.+)\] \*/,hg=/,? & /,Lw=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Dw=/[()=,{}\[\]\/\s]/,kw=/\\(\\)?/g,Ow=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ug=/\w*$/,Nw=/^[-+]0x[0-9a-f]+$/i,zw=/^0b[01]+$/i,Gw=/^\[object .+?Constructor\]$/,Hw=/^0o[0-7]+$/i,$w=/^(?:0|[1-9]\d*)$/,Vw=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ql=/($^)/,Ww=/['\n\r\u2028\u2029\\]/g,Kl="\\ud800-\\udfff",Xw="\\u0300-\\u036f",Yw="\\ufe20-\\ufe2f",jw="\\u20d0-\\u20ff",cg=Xw+Yw+jw,dg="\\u2700-\\u27bf",fg="a-z\\xdf-\\xf6\\xf8-\\xff",qw="\\xac\\xb1\\xd7\\xf7",Kw="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zw="\\u2000-\\u206f",Jw=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pg="A-Z\\xc0-\\xd6\\xd8-\\xde",_g="\\ufe0e\\ufe0f",gg=qw+Kw+Zw+Jw,Zc="[']",Qw="["+Kl+"]",mg="["+gg+"]",Zl="["+cg+"]",yg="\\d+",t1="["+dg+"]",vg="["+fg+"]",xg="[^"+Kl+gg+yg+dg+fg+pg+"]",Jc="\\ud83c[\\udffb-\\udfff]",e1="(?:"+Zl+"|"+Jc+")",bg="[^"+Kl+"]",Qc="(?:\\ud83c[\\udde6-\\uddff]){2}",td="[\\ud800-\\udbff][\\udc00-\\udfff]",ca="["+pg+"]",wg="\\u200d",Sg="(?:"+vg+"|"+xg+")",i1="(?:"+ca+"|"+xg+")",Eg="(?:"+Zc+"(?:d|ll|m|re|s|t|ve))?",Tg="(?:"+Zc+"(?:D|LL|M|RE|S|T|VE))?",Ag=e1+"?",Cg="["+_g+"]?",r1="(?:"+wg+"(?:"+[bg,Qc,td].join("|")+")"+Cg+Ag+")*",n1="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",s1="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ug=Cg+Ag+r1,a1="(?:"+[t1,Qc,td].join("|")+")"+Ug,o1="(?:"+[bg+Zl+"?",Zl,Qc,td,Qw].join("|")+")",l1=RegExp(Zc,"g"),h1=RegExp(Zl,"g"),ed=RegExp(Jc+"(?="+Jc+")|"+o1+Ug,"g"),u1=RegExp([ca+"?"+vg+"+"+Eg+"(?="+[mg,ca,"$"].join("|")+")",i1+"+"+Tg+"(?="+[mg,ca+Sg,"$"].join("|")+")",ca+"?"+Sg+"+"+Eg,ca+"+"+Tg,s1,n1,yg,a1].join("|"),"g"),c1=RegExp("["+wg+Kl+cg+_g+"]"),d1=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,f1=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],p1=-1,xe={};xe[ua]=xe[ps]=xe[Bo]=xe[Fo]=xe[Mo]=xe[Pr]=xe[Lo]=xe[Bn]=xe[Do]=!0,xe[vt]=xe[At]=xe[fs]=xe[ht]=xe[Wi]=xe[q]=xe[dt]=xe[Xt]=xe[Nt]=xe[Lt]=xe[Be]=xe[Vi]=xe[mi]=xe[en]=xe[pe]=!1;var ve={};ve[vt]=ve[At]=ve[fs]=ve[Wi]=ve[ht]=ve[q]=ve[ua]=ve[ps]=ve[Bo]=ve[Fo]=ve[Mo]=ve[Nt]=ve[Lt]=ve[Be]=ve[Vi]=ve[mi]=ve[en]=ve[ha]=ve[Pr]=ve[Lo]=ve[Bn]=ve[Do]=!0,ve[dt]=ve[Xt]=ve[pe]=!1;var _1={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},g1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},m1={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},y1={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},v1=parseFloat,x1=parseInt,Ig=typeof qr=="object"&&qr&&qr.Object===Object&&qr,b1=typeof self=="object"&&self&&self.Object===Object&&self,ii=Ig||b1||Function("return this")(),id=t&&!t.nodeType&&t,_s=id&&!0&&s&&!s.nodeType&&s,Pg=_s&&_s.exports===id,rd=Pg&&Ig.process,Xi=function(){try{var z=_s&&_s.require&&_s.require("util").types;return z||rd&&rd.binding&&rd.binding("util")}catch{}}(),Rg=Xi&&Xi.isArrayBuffer,Bg=Xi&&Xi.isDate,Fg=Xi&&Xi.isMap,Mg=Xi&&Xi.isRegExp,Lg=Xi&&Xi.isSet,Dg=Xi&&Xi.isTypedArray;function Bi(z,K,X){switch(X.length){case 0:return z.call(K);case 1:return z.call(K,X[0]);case 2:return z.call(K,X[0],X[1]);case 3:return z.call(K,X[0],X[1],X[2])}return z.apply(K,X)}function w1(z,K,X,Et){for(var jt=-1,de=z==null?0:z.length;++jt<de;){var $e=z[jt];K(Et,$e,X($e),z)}return Et}function Yi(z,K){for(var X=-1,Et=z==null?0:z.length;++X<Et&&K(z[X],X,z)!==!1;);return z}function S1(z,K){for(var X=z==null?0:z.length;X--&&K(z[X],X,z)!==!1;);return z}function kg(z,K){for(var X=-1,Et=z==null?0:z.length;++X<Et;)if(!K(z[X],X,z))return!1;return!0}function Fn(z,K){for(var X=-1,Et=z==null?0:z.length,jt=0,de=[];++X<Et;){var $e=z[X];K($e,X,z)&&(de[jt++]=$e)}return de}function Jl(z,K){var X=z==null?0:z.length;return!!X&&da(z,K,0)>-1}function nd(z,K,X){for(var Et=-1,jt=z==null?0:z.length;++Et<jt;)if(X(K,z[Et]))return!0;return!1}function Ee(z,K){for(var X=-1,Et=z==null?0:z.length,jt=Array(Et);++X<Et;)jt[X]=K(z[X],X,z);return jt}function Mn(z,K){for(var X=-1,Et=K.length,jt=z.length;++X<Et;)z[jt+X]=K[X];return z}function sd(z,K,X,Et){var jt=-1,de=z==null?0:z.length;for(Et&&de&&(X=z[++jt]);++jt<de;)X=K(X,z[jt],jt,z);return X}function E1(z,K,X,Et){var jt=z==null?0:z.length;for(Et&&jt&&(X=z[--jt]);jt--;)X=K(X,z[jt],jt,z);return X}function ad(z,K){for(var X=-1,Et=z==null?0:z.length;++X<Et;)if(K(z[X],X,z))return!0;return!1}var T1=od("length");function A1(z){return z.split("")}function C1(z){return z.match(Lw)||[]}function Og(z,K,X){var Et;return X(z,function(jt,de,$e){if(K(jt,de,$e))return Et=de,!1}),Et}function Ql(z,K,X,Et){for(var jt=z.length,de=X+(Et?1:-1);Et?de--:++de<jt;)if(K(z[de],de,z))return de;return-1}function da(z,K,X){return K===K?N1(z,K,X):Ql(z,Ng,X)}function U1(z,K,X,Et){for(var jt=X-1,de=z.length;++jt<de;)if(Et(z[jt],K))return jt;return-1}function Ng(z){return z!==z}function zg(z,K){var X=z==null?0:z.length;return X?hd(z,K)/X:rt}function od(z){return function(K){return K==null?e:K[z]}}function ld(z){return function(K){return z==null?e:z[K]}}function Gg(z,K,X,Et,jt){return jt(z,function(de,$e,me){X=Et?(Et=!1,de):K(X,de,$e,me)}),X}function I1(z,K){var X=z.length;for(z.sort(K);X--;)z[X]=z[X].value;return z}function hd(z,K){for(var X,Et=-1,jt=z.length;++Et<jt;){var de=K(z[Et]);de!==e&&(X=X===e?de:X+de)}return X}function ud(z,K){for(var X=-1,Et=Array(z);++X<z;)Et[X]=K(X);return Et}function P1(z,K){return Ee(K,function(X){return[X,z[X]]})}function Hg(z){return z&&z.slice(0,Xg(z)+1).replace(Ae,"")}function Fi(z){return function(K){return z(K)}}function cd(z,K){return Ee(K,function(X){return z[X]})}function ko(z,K){return z.has(K)}function $g(z,K){for(var X=-1,Et=z.length;++X<Et&&da(K,z[X],0)>-1;);return X}function Vg(z,K){for(var X=z.length;X--&&da(K,z[X],0)>-1;);return X}function R1(z,K){for(var X=z.length,Et=0;X--;)z[X]===K&&++Et;return Et}var B1=ld(_1),F1=ld(g1);function M1(z){return"\\"+y1[z]}function L1(z,K){return z==null?e:z[K]}function fa(z){return c1.test(z)}function D1(z){return d1.test(z)}function k1(z){for(var K,X=[];!(K=z.next()).done;)X.push(K.value);return X}function dd(z){var K=-1,X=Array(z.size);return z.forEach(function(Et,jt){X[++K]=[jt,Et]}),X}function Wg(z,K){return function(X){return z(K(X))}}function Ln(z,K){for(var X=-1,Et=z.length,jt=0,de=[];++X<Et;){var $e=z[X];($e===K||$e===v)&&(z[X]=v,de[jt++]=X)}return de}function th(z){var K=-1,X=Array(z.size);return z.forEach(function(Et){X[++K]=Et}),X}function O1(z){var K=-1,X=Array(z.size);return z.forEach(function(Et){X[++K]=[Et,Et]}),X}function N1(z,K,X){for(var Et=X-1,jt=z.length;++Et<jt;)if(z[Et]===K)return Et;return-1}function z1(z,K,X){for(var Et=X+1;Et--;)if(z[Et]===K)return Et;return Et}function pa(z){return fa(z)?H1(z):T1(z)}function or(z){return fa(z)?$1(z):A1(z)}function Xg(z){for(var K=z.length;K--&&ui.test(z.charAt(K)););return K}var G1=ld(m1);function H1(z){for(var K=ed.lastIndex=0;ed.test(z);)++K;return K}function $1(z){return z.match(ed)||[]}function V1(z){return z.match(u1)||[]}var W1=function z(K){K=K==null?ii:_a.defaults(ii.Object(),K,_a.pick(ii,f1));var X=K.Array,Et=K.Date,jt=K.Error,de=K.Function,$e=K.Math,me=K.Object,fd=K.RegExp,X1=K.String,ji=K.TypeError,eh=X.prototype,Y1=de.prototype,ga=me.prototype,ih=K["__core-js_shared__"],rh=Y1.toString,_e=ga.hasOwnProperty,j1=0,Yg=function(){var c=/[^.]+$/.exec(ih&&ih.keys&&ih.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),nh=ga.toString,q1=rh.call(me),K1=ii._,Z1=fd("^"+rh.call(_e).replace(He,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sh=Pg?K.Buffer:e,Dn=K.Symbol,ah=K.Uint8Array,jg=sh?sh.allocUnsafe:e,oh=Wg(me.getPrototypeOf,me),qg=me.create,Kg=ga.propertyIsEnumerable,lh=eh.splice,Zg=Dn?Dn.isConcatSpreadable:e,Oo=Dn?Dn.iterator:e,gs=Dn?Dn.toStringTag:e,hh=function(){try{var c=bs(me,"defineProperty");return c({},"",{}),c}catch{}}(),J1=K.clearTimeout!==ii.clearTimeout&&K.clearTimeout,Q1=Et&&Et.now!==ii.Date.now&&Et.now,tS=K.setTimeout!==ii.setTimeout&&K.setTimeout,uh=$e.ceil,ch=$e.floor,pd=me.getOwnPropertySymbols,eS=sh?sh.isBuffer:e,Jg=K.isFinite,iS=eh.join,rS=Wg(me.keys,me),Ve=$e.max,ci=$e.min,nS=Et.now,sS=K.parseInt,Qg=$e.random,aS=eh.reverse,_d=bs(K,"DataView"),No=bs(K,"Map"),gd=bs(K,"Promise"),ma=bs(K,"Set"),zo=bs(K,"WeakMap"),Go=bs(me,"create"),dh=zo&&new zo,ya={},oS=ws(_d),lS=ws(No),hS=ws(gd),uS=ws(ma),cS=ws(zo),fh=Dn?Dn.prototype:e,Ho=fh?fh.valueOf:e,tm=fh?fh.toString:e;function I(c){if(Fe(c)&&!Kt(c)&&!(c instanceof se)){if(c instanceof qi)return c;if(_e.call(c,"__wrapped__"))return ey(c)}return new qi(c)}var va=function(){function c(){}return function(p){if(!Ce(p))return{};if(qg)return qg(p);c.prototype=p;var y=new c;return c.prototype=e,y}}();function ph(){}function qi(c,p){this.__wrapped__=c,this.__actions__=[],this.__chain__=!!p,this.__index__=0,this.__values__=e}I.templateSettings={escape:Mt,evaluate:It,interpolate:zt,variable:"",imports:{_:I}},I.prototype=ph.prototype,I.prototype.constructor=I,qi.prototype=va(ph.prototype),qi.prototype.constructor=qi;function se(c){this.__wrapped__=c,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function dS(){var c=new se(this.__wrapped__);return c.__actions__=Ei(this.__actions__),c.__dir__=this.__dir__,c.__filtered__=this.__filtered__,c.__iteratees__=Ei(this.__iteratees__),c.__takeCount__=this.__takeCount__,c.__views__=Ei(this.__views__),c}function fS(){if(this.__filtered__){var c=new se(this);c.__dir__=-1,c.__filtered__=!0}else c=this.clone(),c.__dir__*=-1;return c}function pS(){var c=this.__wrapped__.value(),p=this.__dir__,y=Kt(c),E=p<0,U=y?c.length:0,P=AE(0,U,this.__views__),D=P.start,O=P.end,V=O-D,tt=E?O:D-1,et=this.__iteratees__,st=et.length,mt=0,Pt=ci(V,this.__takeCount__);if(!y||!E&&U==V&&Pt==V)return Em(c,this.__actions__);var Ht=[];t:for(;V--&&mt<Pt;){tt+=p;for(var te=-1,$t=c[tt];++te<st;){var re=et[te],ae=re.iteratee,Di=re.type,xi=ae($t);if(Di==Y)$t=xi;else if(!xi){if(Di==j)continue t;break t}}Ht[mt++]=$t}return Ht}se.prototype=va(ph.prototype),se.prototype.constructor=se;function ms(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var E=c[p];this.set(E[0],E[1])}}function _S(){this.__data__=Go?Go(null):{},this.size=0}function gS(c){var p=this.has(c)&&delete this.__data__[c];return this.size-=p?1:0,p}function mS(c){var p=this.__data__;if(Go){var y=p[c];return y===_?e:y}return _e.call(p,c)?p[c]:e}function yS(c){var p=this.__data__;return Go?p[c]!==e:_e.call(p,c)}function vS(c,p){var y=this.__data__;return this.size+=this.has(c)?0:1,y[c]=Go&&p===e?_:p,this}ms.prototype.clear=_S,ms.prototype.delete=gS,ms.prototype.get=mS,ms.prototype.has=yS,ms.prototype.set=vS;function rn(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var E=c[p];this.set(E[0],E[1])}}function xS(){this.__data__=[],this.size=0}function bS(c){var p=this.__data__,y=_h(p,c);if(y<0)return!1;var E=p.length-1;return y==E?p.pop():lh.call(p,y,1),--this.size,!0}function wS(c){var p=this.__data__,y=_h(p,c);return y<0?e:p[y][1]}function SS(c){return _h(this.__data__,c)>-1}function ES(c,p){var y=this.__data__,E=_h(y,c);return E<0?(++this.size,y.push([c,p])):y[E][1]=p,this}rn.prototype.clear=xS,rn.prototype.delete=bS,rn.prototype.get=wS,rn.prototype.has=SS,rn.prototype.set=ES;function nn(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var E=c[p];this.set(E[0],E[1])}}function TS(){this.size=0,this.__data__={hash:new ms,map:new(No||rn),string:new ms}}function AS(c){var p=Ch(this,c).delete(c);return this.size-=p?1:0,p}function CS(c){return Ch(this,c).get(c)}function US(c){return Ch(this,c).has(c)}function IS(c,p){var y=Ch(this,c),E=y.size;return y.set(c,p),this.size+=y.size==E?0:1,this}nn.prototype.clear=TS,nn.prototype.delete=AS,nn.prototype.get=CS,nn.prototype.has=US,nn.prototype.set=IS;function ys(c){var p=-1,y=c==null?0:c.length;for(this.__data__=new nn;++p<y;)this.add(c[p])}function PS(c){return this.__data__.set(c,_),this}function RS(c){return this.__data__.has(c)}ys.prototype.add=ys.prototype.push=PS,ys.prototype.has=RS;function lr(c){var p=this.__data__=new rn(c);this.size=p.size}function BS(){this.__data__=new rn,this.size=0}function FS(c){var p=this.__data__,y=p.delete(c);return this.size=p.size,y}function MS(c){return this.__data__.get(c)}function LS(c){return this.__data__.has(c)}function DS(c,p){var y=this.__data__;if(y instanceof rn){var E=y.__data__;if(!No||E.length<l-1)return E.push([c,p]),this.size=++y.size,this;y=this.__data__=new nn(E)}return y.set(c,p),this.size=y.size,this}lr.prototype.clear=BS,lr.prototype.delete=FS,lr.prototype.get=MS,lr.prototype.has=LS,lr.prototype.set=DS;function em(c,p){var y=Kt(c),E=!y&&Ss(c),U=!y&&!E&&Gn(c),P=!y&&!E&&!U&&Sa(c),D=y||E||U||P,O=D?ud(c.length,X1):[],V=O.length;for(var tt in c)(p||_e.call(c,tt))&&!(D&&(tt=="length"||U&&(tt=="offset"||tt=="parent")||P&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||ln(tt,V)))&&O.push(tt);return O}function im(c){var p=c.length;return p?c[Cd(0,p-1)]:e}function kS(c,p){return Uh(Ei(c),vs(p,0,c.length))}function OS(c){return Uh(Ei(c))}function md(c,p,y){(y!==e&&!hr(c[p],y)||y===e&&!(p in c))&&sn(c,p,y)}function $o(c,p,y){var E=c[p];(!(_e.call(c,p)&&hr(E,y))||y===e&&!(p in c))&&sn(c,p,y)}function _h(c,p){for(var y=c.length;y--;)if(hr(c[y][0],p))return y;return-1}function NS(c,p,y,E){return kn(c,function(U,P,D){p(E,U,y(U),D)}),E}function rm(c,p){return c&&Fr(p,Ze(p),c)}function zS(c,p){return c&&Fr(p,Ai(p),c)}function sn(c,p,y){p=="__proto__"&&hh?hh(c,p,{configurable:!0,enumerable:!0,value:y,writable:!0}):c[p]=y}function yd(c,p){for(var y=-1,E=p.length,U=X(E),P=c==null;++y<E;)U[y]=P?e:Jd(c,p[y]);return U}function vs(c,p,y){return c===c&&(y!==e&&(c=c<=y?c:y),p!==e&&(c=c>=p?c:p)),c}function Ki(c,p,y,E,U,P){var D,O=p&w,V=p&x,tt=p&T;if(y&&(D=U?y(c,E,U,P):y(c)),D!==e)return D;if(!Ce(c))return c;var et=Kt(c);if(et){if(D=UE(c),!O)return Ei(c,D)}else{var st=di(c),mt=st==Xt||st==Ot;if(Gn(c))return Cm(c,O);if(st==Be||st==vt||mt&&!U){if(D=V||mt?{}:Xm(c),!O)return V?mE(c,zS(D,c)):gE(c,rm(D,c))}else{if(!ve[st])return U?c:{};D=IE(c,st,O)}}P||(P=new lr);var Pt=P.get(c);if(Pt)return Pt;P.set(c,D),by(c)?c.forEach(function($t){D.add(Ki($t,p,y,$t,c,P))}):vy(c)&&c.forEach(function($t,re){D.set(re,Ki($t,p,y,re,c,P))});var Ht=tt?V?Od:kd:V?Ai:Ze,te=et?e:Ht(c);return Yi(te||c,function($t,re){te&&(re=$t,$t=c[re]),$o(D,re,Ki($t,p,y,re,c,P))}),D}function GS(c){var p=Ze(c);return function(y){return nm(y,c,p)}}function nm(c,p,y){var E=y.length;if(c==null)return!E;for(c=me(c);E--;){var U=y[E],P=p[U],D=c[U];if(D===e&&!(U in c)||!P(D))return!1}return!0}function sm(c,p,y){if(typeof c!="function")throw new ji(d);return Ko(function(){c.apply(e,y)},p)}function Vo(c,p,y,E){var U=-1,P=Jl,D=!0,O=c.length,V=[],tt=p.length;if(!O)return V;y&&(p=Ee(p,Fi(y))),E?(P=nd,D=!1):p.length>=l&&(P=ko,D=!1,p=new ys(p));t:for(;++U<O;){var et=c[U],st=y==null?et:y(et);if(et=E||et!==0?et:0,D&&st===st){for(var mt=tt;mt--;)if(p[mt]===st)continue t;V.push(et)}else P(p,st,E)||V.push(et)}return V}var kn=Bm(Br),am=Bm(xd,!0);function HS(c,p){var y=!0;return kn(c,function(E,U,P){return y=!!p(E,U,P),y}),y}function gh(c,p,y){for(var E=-1,U=c.length;++E<U;){var P=c[E],D=p(P);if(D!=null&&(O===e?D===D&&!Li(D):y(D,O)))var O=D,V=P}return V}function $S(c,p,y,E){var U=c.length;for(y=Qt(y),y<0&&(y=-y>U?0:U+y),E=E===e||E>U?U:Qt(E),E<0&&(E+=U),E=y>E?0:Sy(E);y<E;)c[y++]=p;return c}function om(c,p){var y=[];return kn(c,function(E,U,P){p(E,U,P)&&y.push(E)}),y}function ri(c,p,y,E,U){var P=-1,D=c.length;for(y||(y=RE),U||(U=[]);++P<D;){var O=c[P];p>0&&y(O)?p>1?ri(O,p-1,y,E,U):Mn(U,O):E||(U[U.length]=O)}return U}var vd=Fm(),lm=Fm(!0);function Br(c,p){return c&&vd(c,p,Ze)}function xd(c,p){return c&&lm(c,p,Ze)}function mh(c,p){return Fn(p,function(y){return hn(c[y])})}function xs(c,p){p=Nn(p,c);for(var y=0,E=p.length;c!=null&&y<E;)c=c[Mr(p[y++])];return y&&y==E?c:e}function hm(c,p,y){var E=p(c);return Kt(c)?E:Mn(E,y(c))}function yi(c){return c==null?c===e?Xc:ce:gs&&gs in me(c)?TE(c):OE(c)}function bd(c,p){return c>p}function VS(c,p){return c!=null&&_e.call(c,p)}function WS(c,p){return c!=null&&p in me(c)}function XS(c,p,y){return c>=ci(p,y)&&c<Ve(p,y)}function wd(c,p,y){for(var E=y?nd:Jl,U=c[0].length,P=c.length,D=P,O=X(P),V=1/0,tt=[];D--;){var et=c[D];D&&p&&(et=Ee(et,Fi(p))),V=ci(et.length,V),O[D]=!y&&(p||U>=120&&et.length>=120)?new ys(D&&et):e}et=c[0];var st=-1,mt=O[0];t:for(;++st<U&&tt.length<V;){var Pt=et[st],Ht=p?p(Pt):Pt;if(Pt=y||Pt!==0?Pt:0,!(mt?ko(mt,Ht):E(tt,Ht,y))){for(D=P;--D;){var te=O[D];if(!(te?ko(te,Ht):E(c[D],Ht,y)))continue t}mt&&mt.push(Ht),tt.push(Pt)}}return tt}function YS(c,p,y,E){return Br(c,function(U,P,D){p(E,y(U),P,D)}),E}function Wo(c,p,y){p=Nn(p,c),c=Km(c,p);var E=c==null?c:c[Mr(Ji(p))];return E==null?e:Bi(E,c,y)}function um(c){return Fe(c)&&yi(c)==vt}function jS(c){return Fe(c)&&yi(c)==fs}function qS(c){return Fe(c)&&yi(c)==q}function Xo(c,p,y,E,U){return c===p?!0:c==null||p==null||!Fe(c)&&!Fe(p)?c!==c&&p!==p:KS(c,p,y,E,Xo,U)}function KS(c,p,y,E,U,P){var D=Kt(c),O=Kt(p),V=D?At:di(c),tt=O?At:di(p);V=V==vt?Be:V,tt=tt==vt?Be:tt;var et=V==Be,st=tt==Be,mt=V==tt;if(mt&&Gn(c)){if(!Gn(p))return!1;D=!0,et=!1}if(mt&&!et)return P||(P=new lr),D||Sa(c)?$m(c,p,y,E,U,P):SE(c,p,V,y,E,U,P);if(!(y&r)){var Pt=et&&_e.call(c,"__wrapped__"),Ht=st&&_e.call(p,"__wrapped__");if(Pt||Ht){var te=Pt?c.value():c,$t=Ht?p.value():p;return P||(P=new lr),U(te,$t,y,E,P)}}return mt?(P||(P=new lr),EE(c,p,y,E,U,P)):!1}function ZS(c){return Fe(c)&&di(c)==Nt}function Sd(c,p,y,E){var U=y.length,P=U,D=!E;if(c==null)return!P;for(c=me(c);U--;){var O=y[U];if(D&&O[2]?O[1]!==c[O[0]]:!(O[0]in c))return!1}for(;++U<P;){O=y[U];var V=O[0],tt=c[V],et=O[1];if(D&&O[2]){if(tt===e&&!(V in c))return!1}else{var st=new lr;if(E)var mt=E(tt,et,V,c,p,st);if(!(mt===e?Xo(et,tt,r|a,E,st):mt))return!1}}return!0}function cm(c){if(!Ce(c)||FE(c))return!1;var p=hn(c)?Z1:Gw;return p.test(ws(c))}function JS(c){return Fe(c)&&yi(c)==Vi}function QS(c){return Fe(c)&&di(c)==mi}function tE(c){return Fe(c)&&Mh(c.length)&&!!xe[yi(c)]}function dm(c){return typeof c=="function"?c:c==null?Ci:typeof c=="object"?Kt(c)?_m(c[0],c[1]):pm(c):My(c)}function Ed(c){if(!qo(c))return rS(c);var p=[];for(var y in me(c))_e.call(c,y)&&y!="constructor"&&p.push(y);return p}function eE(c){if(!Ce(c))return kE(c);var p=qo(c),y=[];for(var E in c)E=="constructor"&&(p||!_e.call(c,E))||y.push(E);return y}function Td(c,p){return c<p}function fm(c,p){var y=-1,E=Ti(c)?X(c.length):[];return kn(c,function(U,P,D){E[++y]=p(U,P,D)}),E}function pm(c){var p=zd(c);return p.length==1&&p[0][2]?jm(p[0][0],p[0][1]):function(y){return y===c||Sd(y,c,p)}}function _m(c,p){return Hd(c)&&Ym(p)?jm(Mr(c),p):function(y){var E=Jd(y,c);return E===e&&E===p?Qd(y,c):Xo(p,E,r|a)}}function yh(c,p,y,E,U){c!==p&&vd(p,function(P,D){if(U||(U=new lr),Ce(P))iE(c,p,D,y,yh,E,U);else{var O=E?E(Vd(c,D),P,D+"",c,p,U):e;O===e&&(O=P),md(c,D,O)}},Ai)}function iE(c,p,y,E,U,P,D){var O=Vd(c,y),V=Vd(p,y),tt=D.get(V);if(tt){md(c,y,tt);return}var et=P?P(O,V,y+"",c,p,D):e,st=et===e;if(st){var mt=Kt(V),Pt=!mt&&Gn(V),Ht=!mt&&!Pt&&Sa(V);et=V,mt||Pt||Ht?Kt(O)?et=O:ke(O)?et=Ei(O):Pt?(st=!1,et=Cm(V,!0)):Ht?(st=!1,et=Um(V,!0)):et=[]:Zo(V)||Ss(V)?(et=O,Ss(O)?et=Ey(O):(!Ce(O)||hn(O))&&(et=Xm(V))):st=!1}st&&(D.set(V,et),U(et,V,E,P,D),D.delete(V)),md(c,y,et)}function gm(c,p){var y=c.length;if(y)return p+=p<0?y:0,ln(p,y)?c[p]:e}function mm(c,p,y){p.length?p=Ee(p,function(P){return Kt(P)?function(D){return xs(D,P.length===1?P[0]:P)}:P}):p=[Ci];var E=-1;p=Ee(p,Fi(Gt()));var U=fm(c,function(P,D,O){var V=Ee(p,function(tt){return tt(P)});return{criteria:V,index:++E,value:P}});return I1(U,function(P,D){return _E(P,D,y)})}function rE(c,p){return ym(c,p,function(y,E){return Qd(c,E)})}function ym(c,p,y){for(var E=-1,U=p.length,P={};++E<U;){var D=p[E],O=xs(c,D);y(O,D)&&Yo(P,Nn(D,c),O)}return P}function nE(c){return function(p){return xs(p,c)}}function Ad(c,p,y,E){var U=E?U1:da,P=-1,D=p.length,O=c;for(c===p&&(p=Ei(p)),y&&(O=Ee(c,Fi(y)));++P<D;)for(var V=0,tt=p[P],et=y?y(tt):tt;(V=U(O,et,V,E))>-1;)O!==c&&lh.call(O,V,1),lh.call(c,V,1);return c}function vm(c,p){for(var y=c?p.length:0,E=y-1;y--;){var U=p[y];if(y==E||U!==P){var P=U;ln(U)?lh.call(c,U,1):Pd(c,U)}}return c}function Cd(c,p){return c+ch(Qg()*(p-c+1))}function sE(c,p,y,E){for(var U=-1,P=Ve(uh((p-c)/(y||1)),0),D=X(P);P--;)D[E?P:++U]=c,c+=y;return D}function Ud(c,p){var y="";if(!c||p<1||p>gt)return y;do p%2&&(y+=c),p=ch(p/2),p&&(c+=c);while(p);return y}function ie(c,p){return Wd(qm(c,p,Ci),c+"")}function aE(c){return im(Ea(c))}function oE(c,p){var y=Ea(c);return Uh(y,vs(p,0,y.length))}function Yo(c,p,y,E){if(!Ce(c))return c;p=Nn(p,c);for(var U=-1,P=p.length,D=P-1,O=c;O!=null&&++U<P;){var V=Mr(p[U]),tt=y;if(V==="__proto__"||V==="constructor"||V==="prototype")return c;if(U!=D){var et=O[V];tt=E?E(et,V,O):e,tt===e&&(tt=Ce(et)?et:ln(p[U+1])?[]:{})}$o(O,V,tt),O=O[V]}return c}var xm=dh?function(c,p){return dh.set(c,p),c}:Ci,lE=hh?function(c,p){return hh(c,"toString",{configurable:!0,enumerable:!1,value:ef(p),writable:!0})}:Ci;function hE(c){return Uh(Ea(c))}function Zi(c,p,y){var E=-1,U=c.length;p<0&&(p=-p>U?0:U+p),y=y>U?U:y,y<0&&(y+=U),U=p>y?0:y-p>>>0,p>>>=0;for(var P=X(U);++E<U;)P[E]=c[E+p];return P}function uE(c,p){var y;return kn(c,function(E,U,P){return y=p(E,U,P),!y}),!!y}function vh(c,p,y){var E=0,U=c==null?E:c.length;if(typeof p=="number"&&p===p&&U<=G){for(;E<U;){var P=E+U>>>1,D=c[P];D!==null&&!Li(D)&&(y?D<=p:D<p)?E=P+1:U=P}return U}return Id(c,p,Ci,y)}function Id(c,p,y,E){var U=0,P=c==null?0:c.length;if(P===0)return 0;p=y(p);for(var D=p!==p,O=p===null,V=Li(p),tt=p===e;U<P;){var et=ch((U+P)/2),st=y(c[et]),mt=st!==e,Pt=st===null,Ht=st===st,te=Li(st);if(D)var $t=E||Ht;else tt?$t=Ht&&(E||mt):O?$t=Ht&&mt&&(E||!Pt):V?$t=Ht&&mt&&!Pt&&(E||!te):Pt||te?$t=!1:$t=E?st<=p:st<p;$t?U=et+1:P=et}return ci(P,H)}function bm(c,p){for(var y=-1,E=c.length,U=0,P=[];++y<E;){var D=c[y],O=p?p(D):D;if(!y||!hr(O,V)){var V=O;P[U++]=D===0?0:D}}return P}function wm(c){return typeof c=="number"?c:Li(c)?rt:+c}function Mi(c){if(typeof c=="string")return c;if(Kt(c))return Ee(c,Mi)+"";if(Li(c))return tm?tm.call(c):"";var p=c+"";return p=="0"&&1/c==-1/0?"-0":p}function On(c,p,y){var E=-1,U=Jl,P=c.length,D=!0,O=[],V=O;if(y)D=!1,U=nd;else if(P>=l){var tt=p?null:bE(c);if(tt)return th(tt);D=!1,U=ko,V=new ys}else V=p?[]:O;t:for(;++E<P;){var et=c[E],st=p?p(et):et;if(et=y||et!==0?et:0,D&&st===st){for(var mt=V.length;mt--;)if(V[mt]===st)continue t;p&&V.push(st),O.push(et)}else U(V,st,y)||(V!==O&&V.push(st),O.push(et))}return O}function Pd(c,p){return p=Nn(p,c),c=Km(c,p),c==null||delete c[Mr(Ji(p))]}function Sm(c,p,y,E){return Yo(c,p,y(xs(c,p)),E)}function xh(c,p,y,E){for(var U=c.length,P=E?U:-1;(E?P--:++P<U)&&p(c[P],P,c););return y?Zi(c,E?0:P,E?P+1:U):Zi(c,E?P+1:0,E?U:P)}function Em(c,p){var y=c;return y instanceof se&&(y=y.value()),sd(p,function(E,U){return U.func.apply(U.thisArg,Mn([E],U.args))},y)}function Rd(c,p,y){var E=c.length;if(E<2)return E?On(c[0]):[];for(var U=-1,P=X(E);++U<E;)for(var D=c[U],O=-1;++O<E;)O!=U&&(P[U]=Vo(P[U]||D,c[O],p,y));return On(ri(P,1),p,y)}function Tm(c,p,y){for(var E=-1,U=c.length,P=p.length,D={};++E<U;){var O=E<P?p[E]:e;y(D,c[E],O)}return D}function Bd(c){return ke(c)?c:[]}function Fd(c){return typeof c=="function"?c:Ci}function Nn(c,p){return Kt(c)?c:Hd(c,p)?[c]:ty(fe(c))}var cE=ie;function zn(c,p,y){var E=c.length;return y=y===e?E:y,!p&&y>=E?c:Zi(c,p,y)}var Am=J1||function(c){return ii.clearTimeout(c)};function Cm(c,p){if(p)return c.slice();var y=c.length,E=jg?jg(y):new c.constructor(y);return c.copy(E),E}function Md(c){var p=new c.constructor(c.byteLength);return new ah(p).set(new ah(c)),p}function dE(c,p){var y=p?Md(c.buffer):c.buffer;return new c.constructor(y,c.byteOffset,c.byteLength)}function fE(c){var p=new c.constructor(c.source,ug.exec(c));return p.lastIndex=c.lastIndex,p}function pE(c){return Ho?me(Ho.call(c)):{}}function Um(c,p){var y=p?Md(c.buffer):c.buffer;return new c.constructor(y,c.byteOffset,c.length)}function Im(c,p){if(c!==p){var y=c!==e,E=c===null,U=c===c,P=Li(c),D=p!==e,O=p===null,V=p===p,tt=Li(p);if(!O&&!tt&&!P&&c>p||P&&D&&V&&!O&&!tt||E&&D&&V||!y&&V||!U)return 1;if(!E&&!P&&!tt&&c<p||tt&&y&&U&&!E&&!P||O&&y&&U||!D&&U||!V)return-1}return 0}function _E(c,p,y){for(var E=-1,U=c.criteria,P=p.criteria,D=U.length,O=y.length;++E<D;){var V=Im(U[E],P[E]);if(V){if(E>=O)return V;var tt=y[E];return V*(tt=="desc"?-1:1)}}return c.index-p.index}function Pm(c,p,y,E){for(var U=-1,P=c.length,D=y.length,O=-1,V=p.length,tt=Ve(P-D,0),et=X(V+tt),st=!E;++O<V;)et[O]=p[O];for(;++U<D;)(st||U<P)&&(et[y[U]]=c[U]);for(;tt--;)et[O++]=c[U++];return et}function Rm(c,p,y,E){for(var U=-1,P=c.length,D=-1,O=y.length,V=-1,tt=p.length,et=Ve(P-O,0),st=X(et+tt),mt=!E;++U<et;)st[U]=c[U];for(var Pt=U;++V<tt;)st[Pt+V]=p[V];for(;++D<O;)(mt||U<P)&&(st[Pt+y[D]]=c[U++]);return st}function Ei(c,p){var y=-1,E=c.length;for(p||(p=X(E));++y<E;)p[y]=c[y];return p}function Fr(c,p,y,E){var U=!y;y||(y={});for(var P=-1,D=p.length;++P<D;){var O=p[P],V=E?E(y[O],c[O],O,y,c):e;V===e&&(V=c[O]),U?sn(y,O,V):$o(y,O,V)}return y}function gE(c,p){return Fr(c,Gd(c),p)}function mE(c,p){return Fr(c,Vm(c),p)}function bh(c,p){return function(y,E){var U=Kt(y)?w1:NS,P=p?p():{};return U(y,c,Gt(E,2),P)}}function xa(c){return ie(function(p,y){var E=-1,U=y.length,P=U>1?y[U-1]:e,D=U>2?y[2]:e;for(P=c.length>3&&typeof P=="function"?(U--,P):e,D&&vi(y[0],y[1],D)&&(P=U<3?e:P,U=1),p=me(p);++E<U;){var O=y[E];O&&c(p,O,E,P)}return p})}function Bm(c,p){return function(y,E){if(y==null)return y;if(!Ti(y))return c(y,E);for(var U=y.length,P=p?U:-1,D=me(y);(p?P--:++P<U)&&E(D[P],P,D)!==!1;);return y}}function Fm(c){return function(p,y,E){for(var U=-1,P=me(p),D=E(p),O=D.length;O--;){var V=D[c?O:++U];if(y(P[V],V,P)===!1)break}return p}}function yE(c,p,y){var E=p&u,U=jo(c);function P(){var D=this&&this!==ii&&this instanceof P?U:c;return D.apply(E?y:this,arguments)}return P}function Mm(c){return function(p){p=fe(p);var y=fa(p)?or(p):e,E=y?y[0]:p.charAt(0),U=y?zn(y,1).join(""):p.slice(1);return E[c]()+U}}function ba(c){return function(p){return sd(By(Ry(p).replace(l1,"")),c,"")}}function jo(c){return function(){var p=arguments;switch(p.length){case 0:return new c;case 1:return new c(p[0]);case 2:return new c(p[0],p[1]);case 3:return new c(p[0],p[1],p[2]);case 4:return new c(p[0],p[1],p[2],p[3]);case 5:return new c(p[0],p[1],p[2],p[3],p[4]);case 6:return new c(p[0],p[1],p[2],p[3],p[4],p[5]);case 7:return new c(p[0],p[1],p[2],p[3],p[4],p[5],p[6])}var y=va(c.prototype),E=c.apply(y,p);return Ce(E)?E:y}}function vE(c,p,y){var E=jo(c);function U(){for(var P=arguments.length,D=X(P),O=P,V=wa(U);O--;)D[O]=arguments[O];var tt=P<3&&D[0]!==V&&D[P-1]!==V?[]:Ln(D,V);if(P-=tt.length,P<y)return Nm(c,p,wh,U.placeholder,e,D,tt,e,e,y-P);var et=this&&this!==ii&&this instanceof U?E:c;return Bi(et,this,D)}return U}function Lm(c){return function(p,y,E){var U=me(p);if(!Ti(p)){var P=Gt(y,3);p=Ze(p),y=function(O){return P(U[O],O,U)}}var D=c(p,y,E);return D>-1?U[P?p[D]:D]:e}}function Dm(c){return on(function(p){var y=p.length,E=y,U=qi.prototype.thru;for(c&&p.reverse();E--;){var P=p[E];if(typeof P!="function")throw new ji(d);if(U&&!D&&Ah(P)=="wrapper")var D=new qi([],!0)}for(E=D?E:y;++E<y;){P=p[E];var O=Ah(P),V=O=="wrapper"?Nd(P):e;V&&$d(V[0])&&V[1]==(B|b|A|R)&&!V[4].length&&V[9]==1?D=D[Ah(V[0])].apply(D,V[3]):D=P.length==1&&$d(P)?D[O]():D.thru(P)}return function(){var tt=arguments,et=tt[0];if(D&&tt.length==1&&Kt(et))return D.plant(et).value();for(var st=0,mt=y?p[st].apply(this,tt):et;++st<y;)mt=p[st].call(this,mt);return mt}})}function wh(c,p,y,E,U,P,D,O,V,tt){var et=p&B,st=p&u,mt=p&f,Pt=p&(b|S),Ht=p&M,te=mt?e:jo(c);function $t(){for(var re=arguments.length,ae=X(re),Di=re;Di--;)ae[Di]=arguments[Di];if(Pt)var xi=wa($t),ki=R1(ae,xi);if(E&&(ae=Pm(ae,E,U,Pt)),P&&(ae=Rm(ae,P,D,Pt)),re-=ki,Pt&&re<tt){var Oe=Ln(ae,xi);return Nm(c,p,wh,$t.placeholder,y,ae,Oe,O,V,tt-re)}var ur=st?y:this,cn=mt?ur[c]:c;return re=ae.length,O?ae=NE(ae,O):Ht&&re>1&&ae.reverse(),et&&V<re&&(ae.length=V),this&&this!==ii&&this instanceof $t&&(cn=te||jo(cn)),cn.apply(ur,ae)}return $t}function km(c,p){return function(y,E){return YS(y,c,p(E),{})}}function Sh(c,p){return function(y,E){var U;if(y===e&&E===e)return p;if(y!==e&&(U=y),E!==e){if(U===e)return E;typeof y=="string"||typeof E=="string"?(y=Mi(y),E=Mi(E)):(y=wm(y),E=wm(E)),U=c(y,E)}return U}}function Ld(c){return on(function(p){return p=Ee(p,Fi(Gt())),ie(function(y){var E=this;return c(p,function(U){return Bi(U,E,y)})})})}function Eh(c,p){p=p===e?" ":Mi(p);var y=p.length;if(y<2)return y?Ud(p,c):p;var E=Ud(p,uh(c/pa(p)));return fa(p)?zn(or(E),0,c).join(""):E.slice(0,c)}function xE(c,p,y,E){var U=p&u,P=jo(c);function D(){for(var O=-1,V=arguments.length,tt=-1,et=E.length,st=X(et+V),mt=this&&this!==ii&&this instanceof D?P:c;++tt<et;)st[tt]=E[tt];for(;V--;)st[tt++]=arguments[++O];return Bi(mt,U?y:this,st)}return D}function Om(c){return function(p,y,E){return E&&typeof E!="number"&&vi(p,y,E)&&(y=E=e),p=un(p),y===e?(y=p,p=0):y=un(y),E=E===e?p<y?1:-1:un(E),sE(p,y,E,c)}}function Th(c){return function(p,y){return typeof p=="string"&&typeof y=="string"||(p=Qi(p),y=Qi(y)),c(p,y)}}function Nm(c,p,y,E,U,P,D,O,V,tt){var et=p&b,st=et?D:e,mt=et?e:D,Pt=et?P:e,Ht=et?e:P;p|=et?A:C,p&=~(et?C:A),p&g||(p&=-4);var te=[c,p,U,Pt,st,Ht,mt,O,V,tt],$t=y.apply(e,te);return $d(c)&&Zm($t,te),$t.placeholder=E,Jm($t,c,p)}function Dd(c){var p=$e[c];return function(y,E){if(y=Qi(y),E=E==null?0:ci(Qt(E),292),E&&Jg(y)){var U=(fe(y)+"e").split("e"),P=p(U[0]+"e"+(+U[1]+E));return U=(fe(P)+"e").split("e"),+(U[0]+"e"+(+U[1]-E))}return p(y)}}var bE=ma&&1/th(new ma([,-0]))[1]==it?function(c){return new ma(c)}:sf;function zm(c){return function(p){var y=di(p);return y==Nt?dd(p):y==mi?O1(p):P1(p,c(p))}}function an(c,p,y,E,U,P,D,O){var V=p&f;if(!V&&typeof c!="function")throw new ji(d);var tt=E?E.length:0;if(tt||(p&=-97,E=U=e),D=D===e?D:Ve(Qt(D),0),O=O===e?O:Qt(O),tt-=U?U.length:0,p&C){var et=E,st=U;E=U=e}var mt=V?e:Nd(c),Pt=[c,p,y,E,U,et,st,P,D,O];if(mt&&DE(Pt,mt),c=Pt[0],p=Pt[1],y=Pt[2],E=Pt[3],U=Pt[4],O=Pt[9]=Pt[9]===e?V?0:c.length:Ve(Pt[9]-tt,0),!O&&p&(b|S)&&(p&=-25),!p||p==u)var Ht=yE(c,p,y);else p==b||p==S?Ht=vE(c,p,O):(p==A||p==(u|A))&&!U.length?Ht=xE(c,p,y,E):Ht=wh.apply(e,Pt);var te=mt?xm:Zm;return Jm(te(Ht,Pt),c,p)}function Gm(c,p,y,E){return c===e||hr(c,ga[y])&&!_e.call(E,y)?p:c}function Hm(c,p,y,E,U,P){return Ce(c)&&Ce(p)&&(P.set(p,c),yh(c,p,e,Hm,P),P.delete(p)),c}function wE(c){return Zo(c)?e:c}function $m(c,p,y,E,U,P){var D=y&r,O=c.length,V=p.length;if(O!=V&&!(D&&V>O))return!1;var tt=P.get(c),et=P.get(p);if(tt&&et)return tt==p&&et==c;var st=-1,mt=!0,Pt=y&a?new ys:e;for(P.set(c,p),P.set(p,c);++st<O;){var Ht=c[st],te=p[st];if(E)var $t=D?E(te,Ht,st,p,c,P):E(Ht,te,st,c,p,P);if($t!==e){if($t)continue;mt=!1;break}if(Pt){if(!ad(p,function(re,ae){if(!ko(Pt,ae)&&(Ht===re||U(Ht,re,y,E,P)))return Pt.push(ae)})){mt=!1;break}}else if(!(Ht===te||U(Ht,te,y,E,P))){mt=!1;break}}return P.delete(c),P.delete(p),mt}function SE(c,p,y,E,U,P,D){switch(y){case Wi:if(c.byteLength!=p.byteLength||c.byteOffset!=p.byteOffset)return!1;c=c.buffer,p=p.buffer;case fs:return!(c.byteLength!=p.byteLength||!P(new ah(c),new ah(p)));case ht:case q:case Lt:return hr(+c,+p);case dt:return c.name==p.name&&c.message==p.message;case Vi:case en:return c==p+"";case Nt:var O=dd;case mi:var V=E&r;if(O||(O=th),c.size!=p.size&&!V)return!1;var tt=D.get(c);if(tt)return tt==p;E|=a,D.set(c,p);var et=$m(O(c),O(p),E,U,P,D);return D.delete(c),et;case ha:if(Ho)return Ho.call(c)==Ho.call(p)}return!1}function EE(c,p,y,E,U,P){var D=y&r,O=kd(c),V=O.length,tt=kd(p),et=tt.length;if(V!=et&&!D)return!1;for(var st=V;st--;){var mt=O[st];if(!(D?mt in p:_e.call(p,mt)))return!1}var Pt=P.get(c),Ht=P.get(p);if(Pt&&Ht)return Pt==p&&Ht==c;var te=!0;P.set(c,p),P.set(p,c);for(var $t=D;++st<V;){mt=O[st];var re=c[mt],ae=p[mt];if(E)var Di=D?E(ae,re,mt,p,c,P):E(re,ae,mt,c,p,P);if(!(Di===e?re===ae||U(re,ae,y,E,P):Di)){te=!1;break}$t||($t=mt=="constructor")}if(te&&!$t){var xi=c.constructor,ki=p.constructor;xi!=ki&&"constructor"in c&&"constructor"in p&&!(typeof xi=="function"&&xi instanceof xi&&typeof ki=="function"&&ki instanceof ki)&&(te=!1)}return P.delete(c),P.delete(p),te}function on(c){return Wd(qm(c,e,ny),c+"")}function kd(c){return hm(c,Ze,Gd)}function Od(c){return hm(c,Ai,Vm)}var Nd=dh?function(c){return dh.get(c)}:sf;function Ah(c){for(var p=c.name+"",y=ya[p],E=_e.call(ya,p)?y.length:0;E--;){var U=y[E],P=U.func;if(P==null||P==c)return U.name}return p}function wa(c){var p=_e.call(I,"placeholder")?I:c;return p.placeholder}function Gt(){var c=I.iteratee||rf;return c=c===rf?dm:c,arguments.length?c(arguments[0],arguments[1]):c}function Ch(c,p){var y=c.__data__;return BE(p)?y[typeof p=="string"?"string":"hash"]:y.map}function zd(c){for(var p=Ze(c),y=p.length;y--;){var E=p[y],U=c[E];p[y]=[E,U,Ym(U)]}return p}function bs(c,p){var y=L1(c,p);return cm(y)?y:e}function TE(c){var p=_e.call(c,gs),y=c[gs];try{c[gs]=e;var E=!0}catch{}var U=nh.call(c);return E&&(p?c[gs]=y:delete c[gs]),U}var Gd=pd?function(c){return c==null?[]:(c=me(c),Fn(pd(c),function(p){return Kg.call(c,p)}))}:af,Vm=pd?function(c){for(var p=[];c;)Mn(p,Gd(c)),c=oh(c);return p}:af,di=yi;(_d&&di(new _d(new ArrayBuffer(1)))!=Wi||No&&di(new No)!=Nt||gd&&di(gd.resolve())!=gi||ma&&di(new ma)!=mi||zo&&di(new zo)!=pe)&&(di=function(c){var p=yi(c),y=p==Be?c.constructor:e,E=y?ws(y):"";if(E)switch(E){case oS:return Wi;case lS:return Nt;case hS:return gi;case uS:return mi;case cS:return pe}return p});function AE(c,p,y){for(var E=-1,U=y.length;++E<U;){var P=y[E],D=P.size;switch(P.type){case"drop":c+=D;break;case"dropRight":p-=D;break;case"take":p=ci(p,c+D);break;case"takeRight":c=Ve(c,p-D);break}}return{start:c,end:p}}function CE(c){var p=c.match(jl);return p?p[1].split(hg):[]}function Wm(c,p,y){p=Nn(p,c);for(var E=-1,U=p.length,P=!1;++E<U;){var D=Mr(p[E]);if(!(P=c!=null&&y(c,D)))break;c=c[D]}return P||++E!=U?P:(U=c==null?0:c.length,!!U&&Mh(U)&&ln(D,U)&&(Kt(c)||Ss(c)))}function UE(c){var p=c.length,y=new c.constructor(p);return p&&typeof c[0]=="string"&&_e.call(c,"index")&&(y.index=c.index,y.input=c.input),y}function Xm(c){return typeof c.constructor=="function"&&!qo(c)?va(oh(c)):{}}function IE(c,p,y){var E=c.constructor;switch(p){case fs:return Md(c);case ht:case q:return new E(+c);case Wi:return dE(c,y);case ua:case ps:case Bo:case Fo:case Mo:case Pr:case Lo:case Bn:case Do:return Um(c,y);case Nt:return new E;case Lt:case en:return new E(c);case Vi:return fE(c);case mi:return new E;case ha:return pE(c)}}function PE(c,p){var y=p.length;if(!y)return c;var E=y-1;return p[E]=(y>1?"& ":"")+p[E],p=p.join(y>2?", ":" "),c.replace(Rr,`{
/* [wrapped with `+p+`] */
`)}function RE(c){return Kt(c)||Ss(c)||!!(Zg&&c&&c[Zg])}function ln(c,p){var y=typeof c;return p=p??gt,!!p&&(y=="number"||y!="symbol"&&$w.test(c))&&c>-1&&c%1==0&&c<p}function vi(c,p,y){if(!Ce(y))return!1;var E=typeof p;return(E=="number"?Ti(y)&&ln(p,y.length):E=="string"&&p in y)?hr(y[p],c):!1}function Hd(c,p){if(Kt(c))return!1;var y=typeof c;return y=="number"||y=="symbol"||y=="boolean"||c==null||Li(c)?!0:ge.test(c)||!Yt.test(c)||p!=null&&c in me(p)}function BE(c){var p=typeof c;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?c!=="__proto__":c===null}function $d(c){var p=Ah(c),y=I[p];if(typeof y!="function"||!(p in se.prototype))return!1;if(c===y)return!0;var E=Nd(y);return!!E&&c===E[0]}function FE(c){return!!Yg&&Yg in c}var ME=ih?hn:of;function qo(c){var p=c&&c.constructor,y=typeof p=="function"&&p.prototype||ga;return c===y}function Ym(c){return c===c&&!Ce(c)}function jm(c,p){return function(y){return y==null?!1:y[c]===p&&(p!==e||c in me(y))}}function LE(c){var p=Bh(c,function(E){return y.size===m&&y.clear(),E}),y=p.cache;return p}function DE(c,p){var y=c[1],E=p[1],U=y|E,P=U<(u|f|B),D=E==B&&y==b||E==B&&y==R&&c[7].length<=p[8]||E==(B|R)&&p[7].length<=p[8]&&y==b;if(!(P||D))return c;E&u&&(c[2]=p[2],U|=y&u?0:g);var O=p[3];if(O){var V=c[3];c[3]=V?Pm(V,O,p[4]):O,c[4]=V?Ln(c[3],v):p[4]}return O=p[5],O&&(V=c[5],c[5]=V?Rm(V,O,p[6]):O,c[6]=V?Ln(c[5],v):p[6]),O=p[7],O&&(c[7]=O),E&B&&(c[8]=c[8]==null?p[8]:ci(c[8],p[8])),c[9]==null&&(c[9]=p[9]),c[0]=p[0],c[1]=U,c}function kE(c){var p=[];if(c!=null)for(var y in me(c))p.push(y);return p}function OE(c){return nh.call(c)}function qm(c,p,y){return p=Ve(p===e?c.length-1:p,0),function(){for(var E=arguments,U=-1,P=Ve(E.length-p,0),D=X(P);++U<P;)D[U]=E[p+U];U=-1;for(var O=X(p+1);++U<p;)O[U]=E[U];return O[p]=y(D),Bi(c,this,O)}}function Km(c,p){return p.length<2?c:xs(c,Zi(p,0,-1))}function NE(c,p){for(var y=c.length,E=ci(p.length,y),U=Ei(c);E--;){var P=p[E];c[E]=ln(P,y)?U[P]:e}return c}function Vd(c,p){if(!(p==="constructor"&&typeof c[p]=="function")&&p!="__proto__")return c[p]}var Zm=Qm(xm),Ko=tS||function(c,p){return ii.setTimeout(c,p)},Wd=Qm(lE);function Jm(c,p,y){var E=p+"";return Wd(c,PE(E,zE(CE(E),y)))}function Qm(c){var p=0,y=0;return function(){var E=nS(),U=k-(E-y);if(y=E,U>0){if(++p>=W)return arguments[0]}else p=0;return c.apply(e,arguments)}}function Uh(c,p){var y=-1,E=c.length,U=E-1;for(p=p===e?E:p;++y<p;){var P=Cd(y,U),D=c[P];c[P]=c[y],c[y]=D}return c.length=p,c}var ty=LE(function(c){var p=[];return c.charCodeAt(0)===46&&p.push(""),c.replace(ze,function(y,E,U,P){p.push(U?P.replace(kw,"$1"):E||y)}),p});function Mr(c){if(typeof c=="string"||Li(c))return c;var p=c+"";return p=="0"&&1/c==-1/0?"-0":p}function ws(c){if(c!=null){try{return rh.call(c)}catch{}try{return c+""}catch{}}return""}function zE(c,p){return Yi(at,function(y){var E="_."+y[0];p&y[1]&&!Jl(c,E)&&c.push(E)}),c.sort()}function ey(c){if(c instanceof se)return c.clone();var p=new qi(c.__wrapped__,c.__chain__);return p.__actions__=Ei(c.__actions__),p.__index__=c.__index__,p.__values__=c.__values__,p}function GE(c,p,y){(y?vi(c,p,y):p===e)?p=1:p=Ve(Qt(p),0);var E=c==null?0:c.length;if(!E||p<1)return[];for(var U=0,P=0,D=X(uh(E/p));U<E;)D[P++]=Zi(c,U,U+=p);return D}function HE(c){for(var p=-1,y=c==null?0:c.length,E=0,U=[];++p<y;){var P=c[p];P&&(U[E++]=P)}return U}function $E(){var c=arguments.length;if(!c)return[];for(var p=X(c-1),y=arguments[0],E=c;E--;)p[E-1]=arguments[E];return Mn(Kt(y)?Ei(y):[y],ri(p,1))}var VE=ie(function(c,p){return ke(c)?Vo(c,ri(p,1,ke,!0)):[]}),WE=ie(function(c,p){var y=Ji(p);return ke(y)&&(y=e),ke(c)?Vo(c,ri(p,1,ke,!0),Gt(y,2)):[]}),XE=ie(function(c,p){var y=Ji(p);return ke(y)&&(y=e),ke(c)?Vo(c,ri(p,1,ke,!0),e,y):[]});function YE(c,p,y){var E=c==null?0:c.length;return E?(p=y||p===e?1:Qt(p),Zi(c,p<0?0:p,E)):[]}function jE(c,p,y){var E=c==null?0:c.length;return E?(p=y||p===e?1:Qt(p),p=E-p,Zi(c,0,p<0?0:p)):[]}function qE(c,p){return c&&c.length?xh(c,Gt(p,3),!0,!0):[]}function KE(c,p){return c&&c.length?xh(c,Gt(p,3),!0):[]}function ZE(c,p,y,E){var U=c==null?0:c.length;return U?(y&&typeof y!="number"&&vi(c,p,y)&&(y=0,E=U),$S(c,p,y,E)):[]}function iy(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=y==null?0:Qt(y);return U<0&&(U=Ve(E+U,0)),Ql(c,Gt(p,3),U)}function ry(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=E-1;return y!==e&&(U=Qt(y),U=y<0?Ve(E+U,0):ci(U,E-1)),Ql(c,Gt(p,3),U,!0)}function ny(c){var p=c==null?0:c.length;return p?ri(c,1):[]}function JE(c){var p=c==null?0:c.length;return p?ri(c,it):[]}function QE(c,p){var y=c==null?0:c.length;return y?(p=p===e?1:Qt(p),ri(c,p)):[]}function tT(c){for(var p=-1,y=c==null?0:c.length,E={};++p<y;){var U=c[p];E[U[0]]=U[1]}return E}function sy(c){return c&&c.length?c[0]:e}function eT(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=y==null?0:Qt(y);return U<0&&(U=Ve(E+U,0)),da(c,p,U)}function iT(c){var p=c==null?0:c.length;return p?Zi(c,0,-1):[]}var rT=ie(function(c){var p=Ee(c,Bd);return p.length&&p[0]===c[0]?wd(p):[]}),nT=ie(function(c){var p=Ji(c),y=Ee(c,Bd);return p===Ji(y)?p=e:y.pop(),y.length&&y[0]===c[0]?wd(y,Gt(p,2)):[]}),sT=ie(function(c){var p=Ji(c),y=Ee(c,Bd);return p=typeof p=="function"?p:e,p&&y.pop(),y.length&&y[0]===c[0]?wd(y,e,p):[]});function aT(c,p){return c==null?"":iS.call(c,p)}function Ji(c){var p=c==null?0:c.length;return p?c[p-1]:e}function oT(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=E;return y!==e&&(U=Qt(y),U=U<0?Ve(E+U,0):ci(U,E-1)),p===p?z1(c,p,U):Ql(c,Ng,U,!0)}function lT(c,p){return c&&c.length?gm(c,Qt(p)):e}var hT=ie(ay);function ay(c,p){return c&&c.length&&p&&p.length?Ad(c,p):c}function uT(c,p,y){return c&&c.length&&p&&p.length?Ad(c,p,Gt(y,2)):c}function cT(c,p,y){return c&&c.length&&p&&p.length?Ad(c,p,e,y):c}var dT=on(function(c,p){var y=c==null?0:c.length,E=yd(c,p);return vm(c,Ee(p,function(U){return ln(U,y)?+U:U}).sort(Im)),E});function fT(c,p){var y=[];if(!(c&&c.length))return y;var E=-1,U=[],P=c.length;for(p=Gt(p,3);++E<P;){var D=c[E];p(D,E,c)&&(y.push(D),U.push(E))}return vm(c,U),y}function Xd(c){return c==null?c:aS.call(c)}function pT(c,p,y){var E=c==null?0:c.length;return E?(y&&typeof y!="number"&&vi(c,p,y)?(p=0,y=E):(p=p==null?0:Qt(p),y=y===e?E:Qt(y)),Zi(c,p,y)):[]}function _T(c,p){return vh(c,p)}function gT(c,p,y){return Id(c,p,Gt(y,2))}function mT(c,p){var y=c==null?0:c.length;if(y){var E=vh(c,p);if(E<y&&hr(c[E],p))return E}return-1}function yT(c,p){return vh(c,p,!0)}function vT(c,p,y){return Id(c,p,Gt(y,2),!0)}function xT(c,p){var y=c==null?0:c.length;if(y){var E=vh(c,p,!0)-1;if(hr(c[E],p))return E}return-1}function bT(c){return c&&c.length?bm(c):[]}function wT(c,p){return c&&c.length?bm(c,Gt(p,2)):[]}function ST(c){var p=c==null?0:c.length;return p?Zi(c,1,p):[]}function ET(c,p,y){return c&&c.length?(p=y||p===e?1:Qt(p),Zi(c,0,p<0?0:p)):[]}function TT(c,p,y){var E=c==null?0:c.length;return E?(p=y||p===e?1:Qt(p),p=E-p,Zi(c,p<0?0:p,E)):[]}function AT(c,p){return c&&c.length?xh(c,Gt(p,3),!1,!0):[]}function CT(c,p){return c&&c.length?xh(c,Gt(p,3)):[]}var UT=ie(function(c){return On(ri(c,1,ke,!0))}),IT=ie(function(c){var p=Ji(c);return ke(p)&&(p=e),On(ri(c,1,ke,!0),Gt(p,2))}),PT=ie(function(c){var p=Ji(c);return p=typeof p=="function"?p:e,On(ri(c,1,ke,!0),e,p)});function RT(c){return c&&c.length?On(c):[]}function BT(c,p){return c&&c.length?On(c,Gt(p,2)):[]}function FT(c,p){return p=typeof p=="function"?p:e,c&&c.length?On(c,e,p):[]}function Yd(c){if(!(c&&c.length))return[];var p=0;return c=Fn(c,function(y){if(ke(y))return p=Ve(y.length,p),!0}),ud(p,function(y){return Ee(c,od(y))})}function oy(c,p){if(!(c&&c.length))return[];var y=Yd(c);return p==null?y:Ee(y,function(E){return Bi(p,e,E)})}var MT=ie(function(c,p){return ke(c)?Vo(c,p):[]}),LT=ie(function(c){return Rd(Fn(c,ke))}),DT=ie(function(c){var p=Ji(c);return ke(p)&&(p=e),Rd(Fn(c,ke),Gt(p,2))}),kT=ie(function(c){var p=Ji(c);return p=typeof p=="function"?p:e,Rd(Fn(c,ke),e,p)}),OT=ie(Yd);function NT(c,p){return Tm(c||[],p||[],$o)}function zT(c,p){return Tm(c||[],p||[],Yo)}var GT=ie(function(c){var p=c.length,y=p>1?c[p-1]:e;return y=typeof y=="function"?(c.pop(),y):e,oy(c,y)});function ly(c){var p=I(c);return p.__chain__=!0,p}function HT(c,p){return p(c),c}function Ih(c,p){return p(c)}var $T=on(function(c){var p=c.length,y=p?c[0]:0,E=this.__wrapped__,U=function(P){return yd(P,c)};return p>1||this.__actions__.length||!(E instanceof se)||!ln(y)?this.thru(U):(E=E.slice(y,+y+(p?1:0)),E.__actions__.push({func:Ih,args:[U],thisArg:e}),new qi(E,this.__chain__).thru(function(P){return p&&!P.length&&P.push(e),P}))});function VT(){return ly(this)}function WT(){return new qi(this.value(),this.__chain__)}function XT(){this.__values__===e&&(this.__values__=wy(this.value()));var c=this.__index__>=this.__values__.length,p=c?e:this.__values__[this.__index__++];return{done:c,value:p}}function YT(){return this}function jT(c){for(var p,y=this;y instanceof ph;){var E=ey(y);E.__index__=0,E.__values__=e,p?U.__wrapped__=E:p=E;var U=E;y=y.__wrapped__}return U.__wrapped__=c,p}function qT(){var c=this.__wrapped__;if(c instanceof se){var p=c;return this.__actions__.length&&(p=new se(this)),p=p.reverse(),p.__actions__.push({func:Ih,args:[Xd],thisArg:e}),new qi(p,this.__chain__)}return this.thru(Xd)}function KT(){return Em(this.__wrapped__,this.__actions__)}var ZT=bh(function(c,p,y){_e.call(c,y)?++c[y]:sn(c,y,1)});function JT(c,p,y){var E=Kt(c)?kg:HS;return y&&vi(c,p,y)&&(p=e),E(c,Gt(p,3))}function QT(c,p){var y=Kt(c)?Fn:om;return y(c,Gt(p,3))}var tA=Lm(iy),eA=Lm(ry);function iA(c,p){return ri(Ph(c,p),1)}function rA(c,p){return ri(Ph(c,p),it)}function nA(c,p,y){return y=y===e?1:Qt(y),ri(Ph(c,p),y)}function hy(c,p){var y=Kt(c)?Yi:kn;return y(c,Gt(p,3))}function uy(c,p){var y=Kt(c)?S1:am;return y(c,Gt(p,3))}var sA=bh(function(c,p,y){_e.call(c,y)?c[y].push(p):sn(c,y,[p])});function aA(c,p,y,E){c=Ti(c)?c:Ea(c),y=y&&!E?Qt(y):0;var U=c.length;return y<0&&(y=Ve(U+y,0)),Lh(c)?y<=U&&c.indexOf(p,y)>-1:!!U&&da(c,p,y)>-1}var oA=ie(function(c,p,y){var E=-1,U=typeof p=="function",P=Ti(c)?X(c.length):[];return kn(c,function(D){P[++E]=U?Bi(p,D,y):Wo(D,p,y)}),P}),lA=bh(function(c,p,y){sn(c,y,p)});function Ph(c,p){var y=Kt(c)?Ee:fm;return y(c,Gt(p,3))}function hA(c,p,y,E){return c==null?[]:(Kt(p)||(p=p==null?[]:[p]),y=E?e:y,Kt(y)||(y=y==null?[]:[y]),mm(c,p,y))}var uA=bh(function(c,p,y){c[y?0:1].push(p)},function(){return[[],[]]});function cA(c,p,y){var E=Kt(c)?sd:Gg,U=arguments.length<3;return E(c,Gt(p,4),y,U,kn)}function dA(c,p,y){var E=Kt(c)?E1:Gg,U=arguments.length<3;return E(c,Gt(p,4),y,U,am)}function fA(c,p){var y=Kt(c)?Fn:om;return y(c,Fh(Gt(p,3)))}function pA(c){var p=Kt(c)?im:aE;return p(c)}function _A(c,p,y){(y?vi(c,p,y):p===e)?p=1:p=Qt(p);var E=Kt(c)?kS:oE;return E(c,p)}function gA(c){var p=Kt(c)?OS:hE;return p(c)}function mA(c){if(c==null)return 0;if(Ti(c))return Lh(c)?pa(c):c.length;var p=di(c);return p==Nt||p==mi?c.size:Ed(c).length}function yA(c,p,y){var E=Kt(c)?ad:uE;return y&&vi(c,p,y)&&(p=e),E(c,Gt(p,3))}var vA=ie(function(c,p){if(c==null)return[];var y=p.length;return y>1&&vi(c,p[0],p[1])?p=[]:y>2&&vi(p[0],p[1],p[2])&&(p=[p[0]]),mm(c,ri(p,1),[])}),Rh=Q1||function(){return ii.Date.now()};function xA(c,p){if(typeof p!="function")throw new ji(d);return c=Qt(c),function(){if(--c<1)return p.apply(this,arguments)}}function cy(c,p,y){return p=y?e:p,p=c&&p==null?c.length:p,an(c,B,e,e,e,e,p)}function dy(c,p){var y;if(typeof p!="function")throw new ji(d);return c=Qt(c),function(){return--c>0&&(y=p.apply(this,arguments)),c<=1&&(p=e),y}}var jd=ie(function(c,p,y){var E=u;if(y.length){var U=Ln(y,wa(jd));E|=A}return an(c,E,p,y,U)}),fy=ie(function(c,p,y){var E=u|f;if(y.length){var U=Ln(y,wa(fy));E|=A}return an(p,E,c,y,U)});function py(c,p,y){p=y?e:p;var E=an(c,b,e,e,e,e,e,p);return E.placeholder=py.placeholder,E}function _y(c,p,y){p=y?e:p;var E=an(c,S,e,e,e,e,e,p);return E.placeholder=_y.placeholder,E}function gy(c,p,y){var E,U,P,D,O,V,tt=0,et=!1,st=!1,mt=!0;if(typeof c!="function")throw new ji(d);p=Qi(p)||0,Ce(y)&&(et=!!y.leading,st="maxWait"in y,P=st?Ve(Qi(y.maxWait)||0,p):P,mt="trailing"in y?!!y.trailing:mt);function Pt(Oe){var ur=E,cn=U;return E=U=e,tt=Oe,D=c.apply(cn,ur),D}function Ht(Oe){return tt=Oe,O=Ko(re,p),et?Pt(Oe):D}function te(Oe){var ur=Oe-V,cn=Oe-tt,Ly=p-ur;return st?ci(Ly,P-cn):Ly}function $t(Oe){var ur=Oe-V,cn=Oe-tt;return V===e||ur>=p||ur<0||st&&cn>=P}function re(){var Oe=Rh();if($t(Oe))return ae(Oe);O=Ko(re,te(Oe))}function ae(Oe){return O=e,mt&&E?Pt(Oe):(E=U=e,D)}function Di(){O!==e&&Am(O),tt=0,E=V=U=O=e}function xi(){return O===e?D:ae(Rh())}function ki(){var Oe=Rh(),ur=$t(Oe);if(E=arguments,U=this,V=Oe,ur){if(O===e)return Ht(V);if(st)return Am(O),O=Ko(re,p),Pt(V)}return O===e&&(O=Ko(re,p)),D}return ki.cancel=Di,ki.flush=xi,ki}var bA=ie(function(c,p){return sm(c,1,p)}),wA=ie(function(c,p,y){return sm(c,Qi(p)||0,y)});function SA(c){return an(c,M)}function Bh(c,p){if(typeof c!="function"||p!=null&&typeof p!="function")throw new ji(d);var y=function(){var E=arguments,U=p?p.apply(this,E):E[0],P=y.cache;if(P.has(U))return P.get(U);var D=c.apply(this,E);return y.cache=P.set(U,D)||P,D};return y.cache=new(Bh.Cache||nn),y}Bh.Cache=nn;function Fh(c){if(typeof c!="function")throw new ji(d);return function(){var p=arguments;switch(p.length){case 0:return!c.call(this);case 1:return!c.call(this,p[0]);case 2:return!c.call(this,p[0],p[1]);case 3:return!c.call(this,p[0],p[1],p[2])}return!c.apply(this,p)}}function EA(c){return dy(2,c)}var TA=cE(function(c,p){p=p.length==1&&Kt(p[0])?Ee(p[0],Fi(Gt())):Ee(ri(p,1),Fi(Gt()));var y=p.length;return ie(function(E){for(var U=-1,P=ci(E.length,y);++U<P;)E[U]=p[U].call(this,E[U]);return Bi(c,this,E)})}),qd=ie(function(c,p){var y=Ln(p,wa(qd));return an(c,A,e,p,y)}),my=ie(function(c,p){var y=Ln(p,wa(my));return an(c,C,e,p,y)}),AA=on(function(c,p){return an(c,R,e,e,e,p)});function CA(c,p){if(typeof c!="function")throw new ji(d);return p=p===e?p:Qt(p),ie(c,p)}function UA(c,p){if(typeof c!="function")throw new ji(d);return p=p==null?0:Ve(Qt(p),0),ie(function(y){var E=y[p],U=zn(y,0,p);return E&&Mn(U,E),Bi(c,this,U)})}function IA(c,p,y){var E=!0,U=!0;if(typeof c!="function")throw new ji(d);return Ce(y)&&(E="leading"in y?!!y.leading:E,U="trailing"in y?!!y.trailing:U),gy(c,p,{leading:E,maxWait:p,trailing:U})}function PA(c){return cy(c,1)}function RA(c,p){return qd(Fd(p),c)}function BA(){if(!arguments.length)return[];var c=arguments[0];return Kt(c)?c:[c]}function FA(c){return Ki(c,T)}function MA(c,p){return p=typeof p=="function"?p:e,Ki(c,T,p)}function LA(c){return Ki(c,w|T)}function DA(c,p){return p=typeof p=="function"?p:e,Ki(c,w|T,p)}function kA(c,p){return p==null||nm(c,p,Ze(p))}function hr(c,p){return c===p||c!==c&&p!==p}var OA=Th(bd),NA=Th(function(c,p){return c>=p}),Ss=um(function(){return arguments}())?um:function(c){return Fe(c)&&_e.call(c,"callee")&&!Kg.call(c,"callee")},Kt=X.isArray,zA=Rg?Fi(Rg):jS;function Ti(c){return c!=null&&Mh(c.length)&&!hn(c)}function ke(c){return Fe(c)&&Ti(c)}function GA(c){return c===!0||c===!1||Fe(c)&&yi(c)==ht}var Gn=eS||of,HA=Bg?Fi(Bg):qS;function $A(c){return Fe(c)&&c.nodeType===1&&!Zo(c)}function VA(c){if(c==null)return!0;if(Ti(c)&&(Kt(c)||typeof c=="string"||typeof c.splice=="function"||Gn(c)||Sa(c)||Ss(c)))return!c.length;var p=di(c);if(p==Nt||p==mi)return!c.size;if(qo(c))return!Ed(c).length;for(var y in c)if(_e.call(c,y))return!1;return!0}function WA(c,p){return Xo(c,p)}function XA(c,p,y){y=typeof y=="function"?y:e;var E=y?y(c,p):e;return E===e?Xo(c,p,e,y):!!E}function Kd(c){if(!Fe(c))return!1;var p=yi(c);return p==dt||p==nt||typeof c.message=="string"&&typeof c.name=="string"&&!Zo(c)}function YA(c){return typeof c=="number"&&Jg(c)}function hn(c){if(!Ce(c))return!1;var p=yi(c);return p==Xt||p==Ot||p==kt||p==Wc}function yy(c){return typeof c=="number"&&c==Qt(c)}function Mh(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=gt}function Ce(c){var p=typeof c;return c!=null&&(p=="object"||p=="function")}function Fe(c){return c!=null&&typeof c=="object"}var vy=Fg?Fi(Fg):ZS;function jA(c,p){return c===p||Sd(c,p,zd(p))}function qA(c,p,y){return y=typeof y=="function"?y:e,Sd(c,p,zd(p),y)}function KA(c){return xy(c)&&c!=+c}function ZA(c){if(ME(c))throw new jt(h);return cm(c)}function JA(c){return c===null}function QA(c){return c==null}function xy(c){return typeof c=="number"||Fe(c)&&yi(c)==Lt}function Zo(c){if(!Fe(c)||yi(c)!=Be)return!1;var p=oh(c);if(p===null)return!0;var y=_e.call(p,"constructor")&&p.constructor;return typeof y=="function"&&y instanceof y&&rh.call(y)==q1}var Zd=Mg?Fi(Mg):JS;function tC(c){return yy(c)&&c>=-9007199254740991&&c<=gt}var by=Lg?Fi(Lg):QS;function Lh(c){return typeof c=="string"||!Kt(c)&&Fe(c)&&yi(c)==en}function Li(c){return typeof c=="symbol"||Fe(c)&&yi(c)==ha}var Sa=Dg?Fi(Dg):tE;function eC(c){return c===e}function iC(c){return Fe(c)&&di(c)==pe}function rC(c){return Fe(c)&&yi(c)==Yc}var nC=Th(Td),sC=Th(function(c,p){return c<=p});function wy(c){if(!c)return[];if(Ti(c))return Lh(c)?or(c):Ei(c);if(Oo&&c[Oo])return k1(c[Oo]());var p=di(c),y=p==Nt?dd:p==mi?th:Ea;return y(c)}function un(c){if(!c)return c===0?c:0;if(c=Qi(c),c===it||c===-1/0){var p=c<0?-1:1;return p*Q}return c===c?c:0}function Qt(c){var p=un(c),y=p%1;return p===p?y?p-y:p:0}function Sy(c){return c?vs(Qt(c),0,Z):0}function Qi(c){if(typeof c=="number")return c;if(Li(c))return rt;if(Ce(c)){var p=typeof c.valueOf=="function"?c.valueOf():c;c=Ce(p)?p+"":p}if(typeof c!="string")return c===0?c:+c;c=Hg(c);var y=zw.test(c);return y||Hw.test(c)?x1(c.slice(2),y?2:8):Nw.test(c)?rt:+c}function Ey(c){return Fr(c,Ai(c))}function aC(c){return c?vs(Qt(c),-9007199254740991,gt):c===0?c:0}function fe(c){return c==null?"":Mi(c)}var oC=xa(function(c,p){if(qo(p)||Ti(p)){Fr(p,Ze(p),c);return}for(var y in p)_e.call(p,y)&&$o(c,y,p[y])}),Ty=xa(function(c,p){Fr(p,Ai(p),c)}),Dh=xa(function(c,p,y,E){Fr(p,Ai(p),c,E)}),lC=xa(function(c,p,y,E){Fr(p,Ze(p),c,E)}),hC=on(yd);function uC(c,p){var y=va(c);return p==null?y:rm(y,p)}var cC=ie(function(c,p){c=me(c);var y=-1,E=p.length,U=E>2?p[2]:e;for(U&&vi(p[0],p[1],U)&&(E=1);++y<E;)for(var P=p[y],D=Ai(P),O=-1,V=D.length;++O<V;){var tt=D[O],et=c[tt];(et===e||hr(et,ga[tt])&&!_e.call(c,tt))&&(c[tt]=P[tt])}return c}),dC=ie(function(c){return c.push(e,Hm),Bi(Ay,e,c)});function fC(c,p){return Og(c,Gt(p,3),Br)}function pC(c,p){return Og(c,Gt(p,3),xd)}function _C(c,p){return c==null?c:vd(c,Gt(p,3),Ai)}function gC(c,p){return c==null?c:lm(c,Gt(p,3),Ai)}function mC(c,p){return c&&Br(c,Gt(p,3))}function yC(c,p){return c&&xd(c,Gt(p,3))}function vC(c){return c==null?[]:mh(c,Ze(c))}function xC(c){return c==null?[]:mh(c,Ai(c))}function Jd(c,p,y){var E=c==null?e:xs(c,p);return E===e?y:E}function bC(c,p){return c!=null&&Wm(c,p,VS)}function Qd(c,p){return c!=null&&Wm(c,p,WS)}var wC=km(function(c,p,y){p!=null&&typeof p.toString!="function"&&(p=nh.call(p)),c[p]=y},ef(Ci)),SC=km(function(c,p,y){p!=null&&typeof p.toString!="function"&&(p=nh.call(p)),_e.call(c,p)?c[p].push(y):c[p]=[y]},Gt),EC=ie(Wo);function Ze(c){return Ti(c)?em(c):Ed(c)}function Ai(c){return Ti(c)?em(c,!0):eE(c)}function TC(c,p){var y={};return p=Gt(p,3),Br(c,function(E,U,P){sn(y,p(E,U,P),E)}),y}function AC(c,p){var y={};return p=Gt(p,3),Br(c,function(E,U,P){sn(y,U,p(E,U,P))}),y}var CC=xa(function(c,p,y){yh(c,p,y)}),Ay=xa(function(c,p,y,E){yh(c,p,y,E)}),UC=on(function(c,p){var y={};if(c==null)return y;var E=!1;p=Ee(p,function(P){return P=Nn(P,c),E||(E=P.length>1),P}),Fr(c,Od(c),y),E&&(y=Ki(y,w|x|T,wE));for(var U=p.length;U--;)Pd(y,p[U]);return y});function IC(c,p){return Cy(c,Fh(Gt(p)))}var PC=on(function(c,p){return c==null?{}:rE(c,p)});function Cy(c,p){if(c==null)return{};var y=Ee(Od(c),function(E){return[E]});return p=Gt(p),ym(c,y,function(E,U){return p(E,U[0])})}function RC(c,p,y){p=Nn(p,c);var E=-1,U=p.length;for(U||(U=1,c=e);++E<U;){var P=c==null?e:c[Mr(p[E])];P===e&&(E=U,P=y),c=hn(P)?P.call(c):P}return c}function BC(c,p,y){return c==null?c:Yo(c,p,y)}function FC(c,p,y,E){return E=typeof E=="function"?E:e,c==null?c:Yo(c,p,y,E)}var Uy=zm(Ze),Iy=zm(Ai);function MC(c,p,y){var E=Kt(c),U=E||Gn(c)||Sa(c);if(p=Gt(p,4),y==null){var P=c&&c.constructor;U?y=E?new P:[]:Ce(c)?y=hn(P)?va(oh(c)):{}:y={}}return(U?Yi:Br)(c,function(D,O,V){return p(y,D,O,V)}),y}function LC(c,p){return c==null?!0:Pd(c,p)}function DC(c,p,y){return c==null?c:Sm(c,p,Fd(y))}function kC(c,p,y,E){return E=typeof E=="function"?E:e,c==null?c:Sm(c,p,Fd(y),E)}function Ea(c){return c==null?[]:cd(c,Ze(c))}function OC(c){return c==null?[]:cd(c,Ai(c))}function NC(c,p,y){return y===e&&(y=p,p=e),y!==e&&(y=Qi(y),y=y===y?y:0),p!==e&&(p=Qi(p),p=p===p?p:0),vs(Qi(c),p,y)}function zC(c,p,y){return p=un(p),y===e?(y=p,p=0):y=un(y),c=Qi(c),XS(c,p,y)}function GC(c,p,y){if(y&&typeof y!="boolean"&&vi(c,p,y)&&(p=y=e),y===e&&(typeof p=="boolean"?(y=p,p=e):typeof c=="boolean"&&(y=c,c=e)),c===e&&p===e?(c=0,p=1):(c=un(c),p===e?(p=c,c=0):p=un(p)),c>p){var E=c;c=p,p=E}if(y||c%1||p%1){var U=Qg();return ci(c+U*(p-c+v1("1e-"+((U+"").length-1))),p)}return Cd(c,p)}var HC=ba(function(c,p,y){return p=p.toLowerCase(),c+(y?Py(p):p)});function Py(c){return tf(fe(c).toLowerCase())}function Ry(c){return c=fe(c),c&&c.replace(Vw,B1).replace(h1,"")}function $C(c,p,y){c=fe(c),p=Mi(p);var E=c.length;y=y===e?E:vs(Qt(y),0,E);var U=y;return y-=p.length,y>=0&&c.slice(y,U)==p}function VC(c){return c=fe(c),c&&Dt.test(c)?c.replace(J,F1):c}function WC(c){return c=fe(c),c&&Te.test(c)?c.replace(He,"\\$&"):c}var XC=ba(function(c,p,y){return c+(y?"-":"")+p.toLowerCase()}),YC=ba(function(c,p,y){return c+(y?" ":"")+p.toLowerCase()}),jC=Mm("toLowerCase");function qC(c,p,y){c=fe(c),p=Qt(p);var E=p?pa(c):0;if(!p||E>=p)return c;var U=(p-E)/2;return Eh(ch(U),y)+c+Eh(uh(U),y)}function KC(c,p,y){c=fe(c),p=Qt(p);var E=p?pa(c):0;return p&&E<p?c+Eh(p-E,y):c}function ZC(c,p,y){c=fe(c),p=Qt(p);var E=p?pa(c):0;return p&&E<p?Eh(p-E,y)+c:c}function JC(c,p,y){return y||p==null?p=0:p&&(p=+p),sS(fe(c).replace(Ae,""),p||0)}function QC(c,p,y){return(y?vi(c,p,y):p===e)?p=1:p=Qt(p),Ud(fe(c),p)}function tU(){var c=arguments,p=fe(c[0]);return c.length<3?p:p.replace(c[1],c[2])}var eU=ba(function(c,p,y){return c+(y?"_":"")+p.toLowerCase()});function iU(c,p,y){return y&&typeof y!="number"&&vi(c,p,y)&&(p=y=e),y=y===e?Z:y>>>0,y?(c=fe(c),c&&(typeof p=="string"||p!=null&&!Zd(p))&&(p=Mi(p),!p&&fa(c))?zn(or(c),0,y):c.split(p,y)):[]}var rU=ba(function(c,p,y){return c+(y?" ":"")+tf(p)});function nU(c,p,y){return c=fe(c),y=y==null?0:vs(Qt(y),0,c.length),p=Mi(p),c.slice(y,y+p.length)==p}function sU(c,p,y){var E=I.templateSettings;y&&vi(c,p,y)&&(p=e),c=fe(c),p=Dh({},p,E,Gm);var U=Dh({},p.imports,E.imports,Gm),P=Ze(U),D=cd(U,P),O,V,tt=0,et=p.interpolate||ql,st="__p += '",mt=fd((p.escape||ql).source+"|"+et.source+"|"+(et===zt?Ow:ql).source+"|"+(p.evaluate||ql).source+"|$","g"),Pt="//# sourceURL="+(_e.call(p,"sourceURL")?(p.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++p1+"]")+`
`;c.replace(mt,function($t,re,ae,Di,xi,ki){return ae||(ae=Di),st+=c.slice(tt,ki).replace(Ww,M1),re&&(O=!0,st+=`' +
__e(`+re+`) +
'`),xi&&(V=!0,st+=`';
`+xi+`;
__p += '`),ae&&(st+=`' +
((__t = (`+ae+`)) == null ? '' : __t) +
'`),tt=ki+$t.length,$t}),st+=`';
`;var Ht=_e.call(p,"variable")&&p.variable;if(!Ht)st=`with (obj) {
`+st+`
}
`;else if(Dw.test(Ht))throw new jt(o);st=(V?st.replace(jc,""):st).replace(qc,"$1").replace(Kc,"$1;"),st="function("+(Ht||"obj")+`) {
`+(Ht?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(O?", __e = _.escape":"")+(V?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+st+`return __p
}`;var te=Fy(function(){return de(P,Pt+"return "+st).apply(e,D)});if(te.source=st,Kd(te))throw te;return te}function aU(c){return fe(c).toLowerCase()}function oU(c){return fe(c).toUpperCase()}function lU(c,p,y){if(c=fe(c),c&&(y||p===e))return Hg(c);if(!c||!(p=Mi(p)))return c;var E=or(c),U=or(p),P=$g(E,U),D=Vg(E,U)+1;return zn(E,P,D).join("")}function hU(c,p,y){if(c=fe(c),c&&(y||p===e))return c.slice(0,Xg(c)+1);if(!c||!(p=Mi(p)))return c;var E=or(c),U=Vg(E,or(p))+1;return zn(E,0,U).join("")}function uU(c,p,y){if(c=fe(c),c&&(y||p===e))return c.replace(Ae,"");if(!c||!(p=Mi(p)))return c;var E=or(c),U=$g(E,or(p));return zn(E,U).join("")}function cU(c,p){var y=N,E=L;if(Ce(p)){var U="separator"in p?p.separator:U;y="length"in p?Qt(p.length):y,E="omission"in p?Mi(p.omission):E}c=fe(c);var P=c.length;if(fa(c)){var D=or(c);P=D.length}if(y>=P)return c;var O=y-pa(E);if(O<1)return E;var V=D?zn(D,0,O).join(""):c.slice(0,O);if(U===e)return V+E;if(D&&(O+=V.length-O),Zd(U)){if(c.slice(O).search(U)){var tt,et=V;for(U.global||(U=fd(U.source,fe(ug.exec(U))+"g")),U.lastIndex=0;tt=U.exec(et);)var st=tt.index;V=V.slice(0,st===e?O:st)}}else if(c.indexOf(Mi(U),O)!=O){var mt=V.lastIndexOf(U);mt>-1&&(V=V.slice(0,mt))}return V+E}function dU(c){return c=fe(c),c&&pt.test(c)?c.replace(Yl,G1):c}var fU=ba(function(c,p,y){return c+(y?" ":"")+p.toUpperCase()}),tf=Mm("toUpperCase");function By(c,p,y){return c=fe(c),p=y?e:p,p===e?D1(c)?V1(c):C1(c):c.match(p)||[]}var Fy=ie(function(c,p){try{return Bi(c,e,p)}catch(y){return Kd(y)?y:new jt(y)}}),pU=on(function(c,p){return Yi(p,function(y){y=Mr(y),sn(c,y,jd(c[y],c))}),c});function _U(c){var p=c==null?0:c.length,y=Gt();return c=p?Ee(c,function(E){if(typeof E[1]!="function")throw new ji(d);return[y(E[0]),E[1]]}):[],ie(function(E){for(var U=-1;++U<p;){var P=c[U];if(Bi(P[0],this,E))return Bi(P[1],this,E)}})}function gU(c){return GS(Ki(c,w))}function ef(c){return function(){return c}}function mU(c,p){return c==null||c!==c?p:c}var yU=Dm(),vU=Dm(!0);function Ci(c){return c}function rf(c){return dm(typeof c=="function"?c:Ki(c,w))}function xU(c){return pm(Ki(c,w))}function bU(c,p){return _m(c,Ki(p,w))}var wU=ie(function(c,p){return function(y){return Wo(y,c,p)}}),SU=ie(function(c,p){return function(y){return Wo(c,y,p)}});function nf(c,p,y){var E=Ze(p),U=mh(p,E);y==null&&!(Ce(p)&&(U.length||!E.length))&&(y=p,p=c,c=this,U=mh(p,Ze(p)));var P=!(Ce(y)&&"chain"in y)||!!y.chain,D=hn(c);return Yi(U,function(O){var V=p[O];c[O]=V,D&&(c.prototype[O]=function(){var tt=this.__chain__;if(P||tt){var et=c(this.__wrapped__),st=et.__actions__=Ei(this.__actions__);return st.push({func:V,args:arguments,thisArg:c}),et.__chain__=tt,et}return V.apply(c,Mn([this.value()],arguments))})}),c}function EU(){return ii._===this&&(ii._=K1),this}function sf(){}function TU(c){return c=Qt(c),ie(function(p){return gm(p,c)})}var AU=Ld(Ee),CU=Ld(kg),UU=Ld(ad);function My(c){return Hd(c)?od(Mr(c)):nE(c)}function IU(c){return function(p){return c==null?e:xs(c,p)}}var PU=Om(),RU=Om(!0);function af(){return[]}function of(){return!1}function BU(){return{}}function FU(){return""}function MU(){return!0}function LU(c,p){if(c=Qt(c),c<1||c>gt)return[];var y=Z,E=ci(c,Z);p=Gt(p),c-=Z;for(var U=ud(E,p);++y<c;)p(y);return U}function DU(c){return Kt(c)?Ee(c,Mr):Li(c)?[c]:Ei(ty(fe(c)))}function kU(c){var p=++j1;return fe(c)+p}var OU=Sh(function(c,p){return c+p},0),NU=Dd("ceil"),zU=Sh(function(c,p){return c/p},1),GU=Dd("floor");function HU(c){return c&&c.length?gh(c,Ci,bd):e}function $U(c,p){return c&&c.length?gh(c,Gt(p,2),bd):e}function VU(c){return zg(c,Ci)}function WU(c,p){return zg(c,Gt(p,2))}function XU(c){return c&&c.length?gh(c,Ci,Td):e}function YU(c,p){return c&&c.length?gh(c,Gt(p,2),Td):e}var jU=Sh(function(c,p){return c*p},1),qU=Dd("round"),KU=Sh(function(c,p){return c-p},0);function ZU(c){return c&&c.length?hd(c,Ci):0}function JU(c,p){return c&&c.length?hd(c,Gt(p,2)):0}return I.after=xA,I.ary=cy,I.assign=oC,I.assignIn=Ty,I.assignInWith=Dh,I.assignWith=lC,I.at=hC,I.before=dy,I.bind=jd,I.bindAll=pU,I.bindKey=fy,I.castArray=BA,I.chain=ly,I.chunk=GE,I.compact=HE,I.concat=$E,I.cond=_U,I.conforms=gU,I.constant=ef,I.countBy=ZT,I.create=uC,I.curry=py,I.curryRight=_y,I.debounce=gy,I.defaults=cC,I.defaultsDeep=dC,I.defer=bA,I.delay=wA,I.difference=VE,I.differenceBy=WE,I.differenceWith=XE,I.drop=YE,I.dropRight=jE,I.dropRightWhile=qE,I.dropWhile=KE,I.fill=ZE,I.filter=QT,I.flatMap=iA,I.flatMapDeep=rA,I.flatMapDepth=nA,I.flatten=ny,I.flattenDeep=JE,I.flattenDepth=QE,I.flip=SA,I.flow=yU,I.flowRight=vU,I.fromPairs=tT,I.functions=vC,I.functionsIn=xC,I.groupBy=sA,I.initial=iT,I.intersection=rT,I.intersectionBy=nT,I.intersectionWith=sT,I.invert=wC,I.invertBy=SC,I.invokeMap=oA,I.iteratee=rf,I.keyBy=lA,I.keys=Ze,I.keysIn=Ai,I.map=Ph,I.mapKeys=TC,I.mapValues=AC,I.matches=xU,I.matchesProperty=bU,I.memoize=Bh,I.merge=CC,I.mergeWith=Ay,I.method=wU,I.methodOf=SU,I.mixin=nf,I.negate=Fh,I.nthArg=TU,I.omit=UC,I.omitBy=IC,I.once=EA,I.orderBy=hA,I.over=AU,I.overArgs=TA,I.overEvery=CU,I.overSome=UU,I.partial=qd,I.partialRight=my,I.partition=uA,I.pick=PC,I.pickBy=Cy,I.property=My,I.propertyOf=IU,I.pull=hT,I.pullAll=ay,I.pullAllBy=uT,I.pullAllWith=cT,I.pullAt=dT,I.range=PU,I.rangeRight=RU,I.rearg=AA,I.reject=fA,I.remove=fT,I.rest=CA,I.reverse=Xd,I.sampleSize=_A,I.set=BC,I.setWith=FC,I.shuffle=gA,I.slice=pT,I.sortBy=vA,I.sortedUniq=bT,I.sortedUniqBy=wT,I.split=iU,I.spread=UA,I.tail=ST,I.take=ET,I.takeRight=TT,I.takeRightWhile=AT,I.takeWhile=CT,I.tap=HT,I.throttle=IA,I.thru=Ih,I.toArray=wy,I.toPairs=Uy,I.toPairsIn=Iy,I.toPath=DU,I.toPlainObject=Ey,I.transform=MC,I.unary=PA,I.union=UT,I.unionBy=IT,I.unionWith=PT,I.uniq=RT,I.uniqBy=BT,I.uniqWith=FT,I.unset=LC,I.unzip=Yd,I.unzipWith=oy,I.update=DC,I.updateWith=kC,I.values=Ea,I.valuesIn=OC,I.without=MT,I.words=By,I.wrap=RA,I.xor=LT,I.xorBy=DT,I.xorWith=kT,I.zip=OT,I.zipObject=NT,I.zipObjectDeep=zT,I.zipWith=GT,I.entries=Uy,I.entriesIn=Iy,I.extend=Ty,I.extendWith=Dh,nf(I,I),I.add=OU,I.attempt=Fy,I.camelCase=HC,I.capitalize=Py,I.ceil=NU,I.clamp=NC,I.clone=FA,I.cloneDeep=LA,I.cloneDeepWith=DA,I.cloneWith=MA,I.conformsTo=kA,I.deburr=Ry,I.defaultTo=mU,I.divide=zU,I.endsWith=$C,I.eq=hr,I.escape=VC,I.escapeRegExp=WC,I.every=JT,I.find=tA,I.findIndex=iy,I.findKey=fC,I.findLast=eA,I.findLastIndex=ry,I.findLastKey=pC,I.floor=GU,I.forEach=hy,I.forEachRight=uy,I.forIn=_C,I.forInRight=gC,I.forOwn=mC,I.forOwnRight=yC,I.get=Jd,I.gt=OA,I.gte=NA,I.has=bC,I.hasIn=Qd,I.head=sy,I.identity=Ci,I.includes=aA,I.indexOf=eT,I.inRange=zC,I.invoke=EC,I.isArguments=Ss,I.isArray=Kt,I.isArrayBuffer=zA,I.isArrayLike=Ti,I.isArrayLikeObject=ke,I.isBoolean=GA,I.isBuffer=Gn,I.isDate=HA,I.isElement=$A,I.isEmpty=VA,I.isEqual=WA,I.isEqualWith=XA,I.isError=Kd,I.isFinite=YA,I.isFunction=hn,I.isInteger=yy,I.isLength=Mh,I.isMap=vy,I.isMatch=jA,I.isMatchWith=qA,I.isNaN=KA,I.isNative=ZA,I.isNil=QA,I.isNull=JA,I.isNumber=xy,I.isObject=Ce,I.isObjectLike=Fe,I.isPlainObject=Zo,I.isRegExp=Zd,I.isSafeInteger=tC,I.isSet=by,I.isString=Lh,I.isSymbol=Li,I.isTypedArray=Sa,I.isUndefined=eC,I.isWeakMap=iC,I.isWeakSet=rC,I.join=aT,I.kebabCase=XC,I.last=Ji,I.lastIndexOf=oT,I.lowerCase=YC,I.lowerFirst=jC,I.lt=nC,I.lte=sC,I.max=HU,I.maxBy=$U,I.mean=VU,I.meanBy=WU,I.min=XU,I.minBy=YU,I.stubArray=af,I.stubFalse=of,I.stubObject=BU,I.stubString=FU,I.stubTrue=MU,I.multiply=jU,I.nth=lT,I.noConflict=EU,I.noop=sf,I.now=Rh,I.pad=qC,I.padEnd=KC,I.padStart=ZC,I.parseInt=JC,I.random=GC,I.reduce=cA,I.reduceRight=dA,I.repeat=QC,I.replace=tU,I.result=RC,I.round=qU,I.runInContext=z,I.sample=pA,I.size=mA,I.snakeCase=eU,I.some=yA,I.sortedIndex=_T,I.sortedIndexBy=gT,I.sortedIndexOf=mT,I.sortedLastIndex=yT,I.sortedLastIndexBy=vT,I.sortedLastIndexOf=xT,I.startCase=rU,I.startsWith=nU,I.subtract=KU,I.sum=ZU,I.sumBy=JU,I.template=sU,I.times=LU,I.toFinite=un,I.toInteger=Qt,I.toLength=Sy,I.toLower=aU,I.toNumber=Qi,I.toSafeInteger=aC,I.toString=fe,I.toUpper=oU,I.trim=lU,I.trimEnd=hU,I.trimStart=uU,I.truncate=cU,I.unescape=dU,I.uniqueId=kU,I.upperCase=fU,I.upperFirst=tf,I.each=hy,I.eachRight=uy,I.first=sy,nf(I,function(){var c={};return Br(I,function(p,y){_e.call(I.prototype,y)||(c[y]=p)}),c}(),{chain:!1}),I.VERSION=n,Yi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(c){I[c].placeholder=I}),Yi(["drop","take"],function(c,p){se.prototype[c]=function(y){y=y===e?1:Ve(Qt(y),0);var E=this.__filtered__&&!p?new se(this):this.clone();return E.__filtered__?E.__takeCount__=ci(y,E.__takeCount__):E.__views__.push({size:ci(y,Z),type:c+(E.__dir__<0?"Right":"")}),E},se.prototype[c+"Right"]=function(y){return this.reverse()[c](y).reverse()}}),Yi(["filter","map","takeWhile"],function(c,p){var y=p+1,E=y==j||y==ut;se.prototype[c]=function(U){var P=this.clone();return P.__iteratees__.push({iteratee:Gt(U,3),type:y}),P.__filtered__=P.__filtered__||E,P}}),Yi(["head","last"],function(c,p){var y="take"+(p?"Right":"");se.prototype[c]=function(){return this[y](1).value()[0]}}),Yi(["initial","tail"],function(c,p){var y="drop"+(p?"":"Right");se.prototype[c]=function(){return this.__filtered__?new se(this):this[y](1)}}),se.prototype.compact=function(){return this.filter(Ci)},se.prototype.find=function(c){return this.filter(c).head()},se.prototype.findLast=function(c){return this.reverse().find(c)},se.prototype.invokeMap=ie(function(c,p){return typeof c=="function"?new se(this):this.map(function(y){return Wo(y,c,p)})}),se.prototype.reject=function(c){return this.filter(Fh(Gt(c)))},se.prototype.slice=function(c,p){c=Qt(c);var y=this;return y.__filtered__&&(c>0||p<0)?new se(y):(c<0?y=y.takeRight(-c):c&&(y=y.drop(c)),p!==e&&(p=Qt(p),y=p<0?y.dropRight(-p):y.take(p-c)),y)},se.prototype.takeRightWhile=function(c){return this.reverse().takeWhile(c).reverse()},se.prototype.toArray=function(){return this.take(Z)},Br(se.prototype,function(c,p){var y=/^(?:filter|find|map|reject)|While$/.test(p),E=/^(?:head|last)$/.test(p),U=I[E?"take"+(p=="last"?"Right":""):p],P=E||/^find/.test(p);U&&(I.prototype[p]=function(){var D=this.__wrapped__,O=E?[1]:arguments,V=D instanceof se,tt=O[0],et=V||Kt(D),st=function(re){var ae=U.apply(I,Mn([re],O));return E&&mt?ae[0]:ae};et&&y&&typeof tt=="function"&&tt.length!=1&&(V=et=!1);var mt=this.__chain__,Pt=!!this.__actions__.length,Ht=P&&!mt,te=V&&!Pt;if(!P&&et){D=te?D:new se(this);var $t=c.apply(D,O);return $t.__actions__.push({func:Ih,args:[st],thisArg:e}),new qi($t,mt)}return Ht&&te?c.apply(this,O):($t=this.thru(st),Ht?E?$t.value()[0]:$t.value():$t)})}),Yi(["pop","push","shift","sort","splice","unshift"],function(c){var p=eh[c],y=/^(?:push|sort|unshift)$/.test(c)?"tap":"thru",E=/^(?:pop|shift)$/.test(c);I.prototype[c]=function(){var U=arguments;if(E&&!this.__chain__){var P=this.value();return p.apply(Kt(P)?P:[],U)}return this[y](function(D){return p.apply(Kt(D)?D:[],U)})}}),Br(se.prototype,function(c,p){var y=I[p];if(y){var E=y.name+"";_e.call(ya,E)||(ya[E]=[]),ya[E].push({name:p,func:y})}}),ya[wh(e,f).name]=[{name:"wrapper",func:e}],se.prototype.clone=dS,se.prototype.reverse=fS,se.prototype.value=pS,I.prototype.at=$T,I.prototype.chain=VT,I.prototype.commit=WT,I.prototype.next=XT,I.prototype.plant=jT,I.prototype.reverse=qT,I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=KT,I.prototype.first=I.prototype.head,Oo&&(I.prototype[Oo]=YT),I},_a=W1();_s?((_s.exports=_a)._=_a,id._=_a):ii._=_a}).call(qr)})(Ac,Ac.exports);var Mw=Ac.exports;const AN={class:"w-full h-full bg-[#201f20] relative overflow-hidden select-none"},CN={class:"flex justify-between items-center px-4 py-2"},UN={class:"flex items-center gap-4"},IN={class:"text-white hover:text-purple-500 transition-colors"},PN={class:"flex items-center gap-2"},RN={class:"text-white min-w-[50px] text-center"},BN={class:"flex items-center gap-2"},FN={key:0,class:"absolute w-[10%] left-0 top-0 inset-0 flex flex-col items-center justify-center"},fp="track-zoom-value",K0=3,Wn=150,MN=30,Z0=5,pp=15,LN=hi({__name:"clipTrack",props:{tracks:{},maxTracksNum:{},currentTime:{},timelineDuration:{}},emits:["resetTrack","stopPlay","timeUpdate","refreshPlayer","add-clip","activeClip","delete-empty-track","handleExport","update:tracks"],setup(s,{expose:t,emit:e}){const n=s,l=e,h=De(()=>K0*d.value*10),d=Tt(parseFloat(localStorage.getItem(fp)||"1")),o=()=>{d.value<5&&(d.value<1?d.value=Math.min(5,Math.round((d.value+.1)*10)/10):d.value=Math.min(5,Math.floor(d.value+1)),localStorage.setItem(fp,d.value.toString()))},_=()=>{d.value>.3&&(d.value<=1?d.value=Math.max(.3,Math.round((d.value-.1)*10)/10):d.value=Math.max(1,Math.floor(d.value-1)),localStorage.setItem(fp,d.value.toString()))},m=De(()=>n.timelineDuration*h.value),v=Tt(null),w=Tt(-1),x=Tt(!1),T=Tt(0),r=Tt(0),a=Tt(null),u=Tt(0),f=Tt(0),g=Tt(null),b=Tt(15),S=Tt(null),A=Tt([]),C=Tt(!1),B=Tt(null),R=Tt(null),M=sa(),N=J=>{J.preventDefault();const pt=J.currentTarget.getBoundingClientRect(),Dt=J.clientX-pt.left,It=J.target.closest("[data-track]"),zt=It==null?void 0:It.getAttribute("data-track");if(!M.getDragData)return;const ge=Dt/h.value;try{if(zt){const ze=n.tracks.find(He=>He.id===zt);if(ze){const He=n.tracks.indexOf(ze),Te=ze.clips.find(Ae=>ge>=Ae.startTime&&ge<=Ae.endTime);Te?(C.value=!0,R.value=Te,T.value=Te.startTime*h.value,w.value=He):(R.value=null,T.value=ge*h.value,w.value=He)}}else R.value=null,T.value=ge*h.value,w.value=-1}catch(ze){console.error("DragOver error:",ze)}},L=J=>{const pt=J.currentTarget.getBoundingClientRect(),Dt=J.clientX,Mt=J.clientY;(Dt<pt.left||Dt>pt.right||Mt<pt.top||Mt>pt.bottom)&&(W(),x.value=!1,w.value=-1)},W=()=>{S.value&&w.value>=0&&(n.tracks[w.value].clips.forEach(pt=>{const Dt=S.value.find(Mt=>Mt.id===pt.id);Dt&&(pt.startTime=Dt.startTime)}),S.value=null,A.value=[])},k=async J=>{J.preventDefault();const pt=J.currentTarget.getBoundingClientRect(),Mt=(J.clientX-pt.left)/h.value,It=M.getDragData;if(!It)return;const zt={...It,id:as(),rect:null,opacity:100,volume:100,startTime:C.value&&R.value?Number(R.value.startTime):Mt,duration:Number((It.duration||5*1e6)/1e6),selected:!1,sourceStartTime:0,sourceEndTime:0,originalDuration:Number((It.duration||5*1e6)/1e6)};if(zt.endTime=zt.startTime+zt.duration,zt.type==="video"||zt.type==="image"){const Yt=await R_(zt);Yt.type==="video"?zt.thumbnail=Yt.data:Yt.type==="image"&&(zt.thumbnail=[{timestamp:0,url:URL.createObjectURL(Yt.data)}])}else if(zt.type==="audio"){const Yt=await B_(zt);Yt.type==="audio"&&(zt.volumeData=Yt.data)}else zt.type==="text"&&(zt.textConfig={content:"Hello, World!",fontSize:24,fontFamily:"Arial",color:"#000000",x:10,y:10,width:100,height:100});if(w.value>=0){const Yt=n.tracks[w.value];Yt.clips.push(zt),Yt.clips.sort((ge,ze)=>ge.startTime-ze.startTime)}else if(n.tracks.length<n.maxTracksNum)n.tracks.push({id:as(),clips:[zt]});else{Zs.warning("("+n.maxTracksNum+")");return}j(n.tracks[w.value],zt),l("add-clip",zt),ut(),Pr(),M.clearDragData()},j=(J,pt)=>{if(!J||(J==null?void 0:J.clips.length)===0)return;const Dt=J.clips.filter(It=>It.endTime>pt.startTime&&It.startTime<pt.startTime);if(Dt.length!==0&&Nt.value==="other")pt.startTime=Dt[0].endTime,pt.endTime=pt.startTime+pt.duration;else if(Dt.length!==0&&Nt.value==="same")if(n.tracks.length<n.maxTracksNum){const It={id:as(),clips:[pt]},zt=n.tracks.findIndex(Yt=>Yt.id===J.id);n.tracks.splice(zt+1,0,It),J.clips=J.clips.filter(Yt=>Yt.id!==pt.id)}else return pt.startTime=Dt[0].endTime,pt.endTime=pt.startTime+pt.duration,Zs.warning(`(${n.maxTracksNum})`);const Mt=J.clips.filter(It=>It.id!==pt.id&&It.startTime>=pt.startTime).sort((It,zt)=>It.startTime-zt.startTime);if(Mt.length!==0&&Mt[0].startTime<pt.endTime){let It=pt.endTime;Mt.forEach(zt=>{const Yt=zt.endTime-zt.startTime;zt.startTime=It,zt.endTime=zt.startTime+Yt,It=zt.endTime})}},Y=J=>{var pt;(pt=v.value)==null||pt.activeClip(J),Q.value=J},ut=()=>{C.value=!1,B.value=null,R.value=null,x.value=!1,w.value=-1,T.value=0},it=J=>{w.value=J},gt=J=>{w.value===J&&(w.value=-1)},Q=Tt(null),rt=Tt(!1),Z=Tt(null),H=Tt(0),G=Tt(0),at=Tt(0),vt=J=>{Q.value||(Q.value=J)},At=(J,pt,Dt)=>{J.stopPropagation(),rt.value=!0,Z.value=Dt,Q.value=pt,H.value=J.clientX,G.value=Number(pt.startTime),at.value=Number(pt.endTime),pt.originalDuration||(pt.originalDuration=pt.duration),document.addEventListener("mousemove",ht),document.addEventListener("mouseup",q)},kt=De(()=>MN/h.value),ht=J=>{if(!rt.value||!Q.value)return;J.preventDefault(),J.stopPropagation();const pt=pe.value.getBoundingClientRect(),Mt=(J.clientX-pt.left+pe.value.scrollLeft)/h.value;if(Q.value.type==="video"||Q.value.type==="audio"){const It=Number(Q.value.originalDuration);if(Z.value==="left"){const zt=Number(Q.value.endTime),Yt=Number(Q.value.sourceEndTime),ge=zt-kt.value,ze=Math.min(Math.max(0,Mt),ge),He=zt-ze,Te=It-(Yt+He);Te>=0&&Te+Yt<=It&&(Q.value.startTime=ze,Q.value.duration=He,Q.value.sourceStartTime=Te)}else if(Z.value==="right"){const zt=Number(Q.value.startTime),Yt=Number(Q.value.sourceStartTime),ge=zt+kt.value,ze=zt+(It-Yt),He=Math.min(Math.max(ge,Mt),ze),Te=He-zt,Ae=It-(Yt+Te);Ae>=0&&Yt+Te<=It&&(Q.value.endTime=He,Q.value.duration=Te,Q.value.sourceEndTime=Ae)}}else if(Z.value==="left"){const It=Number(Q.value.endTime),zt=It-kt.value,Yt=Math.min(Math.max(0,Mt),zt),ge=It-Yt;Q.value.startTime=Yt,Q.value.duration=ge}else if(Z.value==="right"){const It=Number(Q.value.startTime),zt=It+kt.value,Yt=Math.max(zt,Mt),ge=Yt-It;Q.value.endTime=Yt,Q.value.duration=ge}},q=()=>{if(rt.value&&Q.value){const J=Number(Q.value.startTime),pt=Number(Q.value.duration);Q.value.endTime=J+pt,Q.value.startTime=J,Q.value.duration=pt,Q.value.sourceStartTime=Number(Q.value.sourceStartTime),Q.value.sourceEndTime=Number(Q.value.sourceEndTime),Q.value.originalDuration=Number(Q.value.originalDuration),M.publishClipUpdate(Q.value,"resize")}rt.value=!1,Z.value=null,Pr(),document.removeEventListener("mousemove",ht),document.removeEventListener("mouseup",q)},nt=Tt({x:0,y:0}),dt=Tt(""),Xt=(J,pt,Dt)=>{if(rt.value)return;Dt.preventDefault(),Dt.stopPropagation(),Q.value=J;const Mt=pe.value.getBoundingClientRect(),zt=(Dt.clientX-Mt.left+pe.value.scrollLeft)/h.value;nt.value={x:Dt.clientX,y:Dt.clientY},dt.value=pt;const Yt=ze=>{const He=Math.abs(ze.clientX-nt.value.x),Te=Math.abs(ze.clientY-nt.value.y);(He>Z0||Te>Z0)&&(document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",ge),Wc(J,Dt))},ge=()=>{document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",ge),console.log("handleClipMouseDown",J),l("activeClip",J),l("timeUpdate",zt)};document.addEventListener("mousemove",Yt),document.addEventListener("mouseup",ge)},Ot=Tt(!1),Nt=Tt(null),Lt=Tt(null),ce=Tt(0),Be=Tt(!1),gi=Tt(null),Wc=(J,pt)=>{if(!pe.value)return;Ot.value=!0,Lt.value=J,Q.value=J,J.selected=!0;const Dt=pe.value.getBoundingClientRect(),Mt=Number(J.startTime)*h.value+Dt.left-pe.value.scrollLeft;ce.value=pt.clientX-Mt,u.value=pt.clientX,window.addEventListener("mousemove",mi,{capture:!0,passive:!1}),window.addEventListener("mouseup",en,{capture:!0}),Vi()},Vi=()=>{if(!Ot.value||!Lt.value||!pe.value)return;const J=pe.value.getBoundingClientRect();let pt=0,Dt=!1;if(a.value==="right"){const It=1-(J.right-u.value)/Wn;pt=Math.max(1,Math.round(b.value*It)),pe.value.scrollLeft+=pt,Dt=!0}else if(a.value==="left"){const It=1-(u.value-J.left)/Wn;pt=Math.max(1,Math.round(b.value*It)),pe.value.scrollLeft-=pt,Dt=!0}else if(a.value==="up"){const It=1-(f.value-J.top)/Wn;pt=Math.max(1,Math.round(b.value*It)),pe.value.scrollTop-=pt,Dt=!0}else if(a.value==="down"){const It=1-(J.bottom-f.value)/Wn;pt=Math.max(1,Math.round(b.value*It)),pe.value.scrollTop+=pt,Dt=!0}if(Dt){const It=u.value-J.left+pe.value.scrollLeft-ce.value,zt=Math.max(0,It/h.value),Yt=Number(Lt.value.duration);Lt.value.startTime=zt,Lt.value.endTime=zt+Yt}if(a.value){const Mt=requestAnimationFrame(Vi);g.value=Mt}},mi=J=>{var He;if(!Ot.value||!Lt.value||!pe.value)return;J.preventDefault(),J.stopPropagation(),u.value=J.clientX,f.value=J.clientY;const pt=document.elementFromPoint(J.clientX,J.clientY),Dt=pt==null?void 0:pt.getAttribute("data-clip");let Mt=null;Dt?Mt=(He=pt==null?void 0:pt.parentElement)==null?void 0:He.getAttribute("data-track"):Mt=pt==null?void 0:pt.getAttribute("data-track");const It=pe.value.getBoundingClientRect(),Yt=J.clientX-It.left+pe.value.scrollLeft-ce.value,ge=Number(Lt.value.duration),ze=Mt?n.tracks.find(Te=>Te.id===Mt):null;if(ze){const Te=ze.clips.filter(Ae=>Ae.id!==Lt.value.id).sort((Ae,ui)=>Number(Ae.startTime)-Number(ui.startTime));if(Be.value&&gi.value!==null)if(Math.abs(Yt-gi.value)>pp/2)Be.value=!1,gi.value=null;else{const ui=gi.value/h.value;Lt.value.startTime=ui,Lt.value.endTime=ui+ge;return}for(const Ae of Te){const ui=Number(Ae.startTime)*h.value,Rr=Number(Ae.endTime)*h.value;if(Math.abs(Yt-Rr)<=pp){Be.value=!0,gi.value=Rr,Lt.value.startTime=Rr/h.value,Lt.value.endTime=Rr/h.value+ge;return}if(Math.abs(Yt+ge*h.value-ui)<=pp){Be.value=!0,gi.value=ui-ge*h.value,Lt.value.startTime=ui/h.value-ge,Lt.value.endTime=ui/h.value;return}}}if(Lt.value.startTime=Math.max(0,Yt/h.value),Lt.value.endTime=Math.max(ge,Yt/h.value+ge),Mt&&Mt!==dt.value){const Te=n.tracks.findIndex(Ae=>Ae.id===Mt);if(Te!==-1){const Ae=n.tracks.find(ui=>ui.id===dt.value);if(Ae){const ui=Ae.clips.findIndex(Rr=>Rr.id===Lt.value.id);ui!==-1&&(Ae.clips.splice(ui,1),n.tracks[Te].clips.push(Lt.value),n.tracks[Te].clips.sort((Rr,jl)=>Number(Rr.startTime)-Number(jl.startTime)),dt.value=Mt)}}Nt.value="other"}else Nt.value="same";J.clientX>It.right-Wn?a.value!=="right"&&(a.value="right",Vi()):J.clientX<It.left+Wn?a.value!=="left"&&(a.value="left",Vi()):J.clientY<It.top+Wn?a.value!=="up"&&(a.value="up",Vi()):J.clientY>It.bottom-Wn?a.value!=="down"&&(a.value="down",Vi()):a.value!==null&&(a.value=null)},en=J=>{if(!Ot.value||!Lt.value)return;J&&(J.preventDefault(),J.stopPropagation()),Be.value=!1,gi.value=null,g.value!==null&&(cancelAnimationFrame(g.value),g.value=null),Lt.value.selected=!0,Q.value=Lt.value;const pt=n.tracks.find(Dt=>Dt.id===dt.value);j(pt,Lt.value),M.publishClipUpdate(Lt.value),Ot.value=!1,a.value=null,Lt.value=null,dt.value="",ce.value=0,Pr(),window.removeEventListener("mousemove",mi,{capture:!0}),window.removeEventListener("mouseup",en,{capture:!0})};Nl(()=>{g.value!==null&&cancelAnimationFrame(g.value),window.removeEventListener("mousemove",mi,{capture:!0}),window.removeEventListener("mouseup",en,{capture:!0})});const ha=J=>{l("stopPlay"),l("timeUpdate",J)},Xc=(J,pt)=>{const Dt=n.tracks[pt],Mt=Dt.clips.findIndex(It=>It.id===J.id);Mt!==-1&&(Dt.clips.splice(Mt,1),M.publishClipUpdate(J,"delete"),Dt.clips.length===0&&n.tracks.splice(pt,1))},pe=Tt(null),Yc=J=>{if(pe.value){const pt=pe.value.scrollWidth-pe.value.clientWidth,Dt=Math.max(0,Math.min(pe.value.scrollLeft+J,pt));pe.value.scrollLeft=Dt}},fs=J0(),Wi=Number(fs.params.id),ua=De(()=>M.canUndo),ps=Tt(!1);ls(()=>n.tracks,async()=>{ps.value=await M.getCanRedo(Wi)});const Bo=async()=>{if(!ua.value)return;const J=await M.undo(Wi);J&&(l("update:tracks",J),l("refreshPlayer"))},Fo=async()=>{if(!ps.value)return;const J=await M.redo(Wi);J&&(l("update:tracks",J),l("refreshPlayer"))},Mo=async()=>{l("update:tracks",[]),await M.clearHistory(Wi),l("refreshPlayer")},Pr=async()=>{M.saveHistoryState&&(Lo(),await M.saveHistoryState(Wi,JSON.parse(JSON.stringify(n.tracks))))},Lo=()=>{l("delete-empty-track")},Bn=Tt(!1),Do=()=>{Bn.value=!1,l("activeClip",null)};ls([()=>Q.value,()=>n.currentTime],()=>{if(!Q.value){Bn.value=!1;return}const pt=["video","audio","image"].includes(Q.value.type),Dt=n.currentTime>Number(Q.value.startTime)&&n.currentTime<Number(Q.value.endTime);Bn.value=pt&&Dt});const jc=async()=>{const J=Mw.cloneDeep(Q.value);J.id=as(),J.startTime=n.currentTime,J.endTime=Number(J.endTime),J.type==="text"?(J.duration=Number(Q.value.duration)-(n.currentTime-Number(Q.value.startTime)),Q.value.endTime=n.currentTime,Q.value.duration=n.currentTime-Number(Q.value.startTime)):(J.sourceStartTime=n.currentTime-Number(Q.value.startTime)+Number(J.sourceStartTime),J.duration=Number(Q.value.duration)-J.startTime+Q.value.startTime,Q.value.endTime=n.currentTime,Q.value.duration=n.currentTime-Number(Q.value.startTime),Q.value.sourceEndTime=Number(Q.value.sourceEndTime)-(n.currentTime-Number(Q.value.startTime))),qc(Q.value).clips.push(J),M.publishClipUpdate(Q.value),l("add-clip",J),Pr()},qc=J=>n.tracks.find(pt=>pt.clips.some(Dt=>Dt.id===J.id)),Kc=()=>{var pt,Dt;const J=Q.value;J&&(M.publishClipUpdate(J,"delete"),(Dt=n.tracks.find(Mt=>Mt.clips.some(It=>It.id===J.id)))==null||Dt.clips.splice((pt=n.tracks.find(Mt=>Mt.clips.some(It=>It.id===J.id)))==null?void 0:pt.clips.findIndex(Mt=>Mt.id===J.id),1),Pr())},Yl=()=>{l("handleExport")};return t({activeClip:Y}),(J,pt)=>{const Dt=le("el-popconfirm"),Mt=le("el-tooltip"),It=le("el-button");return St(),Ft("div",AN,[$("div",CN,[$("div",UN,[lt(Dt,{id:"reset-button",title:"","confirm-button-text":"","cancel-button-text":"",onConfirm:Mo},{reference:he(()=>[$("button",IN,[lt(Wt(ye),{icon:"mdi:restore",width:"20"})])]),_:1}),lt(Mt,{content:"",placement:"top"},{default:he(()=>[$("button",{id:"undo-button",class:Qn(["text-white hover:text-purple-500 transition-colors",{"opacity-50 cursor-not-allowed":!ua.value}]),onClick:Bo},[lt(Wt(ye),{icon:"mdi:undo",width:"20"})],2)]),_:1}),lt(Mt,{content:"",placement:"top"},{default:he(()=>[$("button",{id:"redo-button",class:Qn(["text-white hover:text-purple-500 transition-colors",{"opacity-50 cursor-not-allowed":!ps.value}]),onClick:Fo},[lt(Wt(ye),{icon:"mdi:redo",width:"20"})],2)]),_:1}),lt(Mt,{content:"",placement:"top"},{default:he(()=>[$("button",{id:"split-button",class:Qn(["text-white hover:text-purple-500 transition-colors",{"opacity-50 cursor-not-allowed":!Bn.value}]),onClick:jc},[lt(Wt(ye),{icon:"material-symbols-light:split-scene-outline",width:"20"})],2)]),_:1}),lt(Mt,{content:"",placement:"top"},{default:he(()=>[$("button",{id:"delete-button",class:"text-white hover:text-purple-500 transition-colors",onClick:Kc},[lt(Wt(ye),{icon:"mdi:delete",width:"20"})])]),_:1})]),$("div",PN,[lt(Mt,{content:"",placement:"top"},{default:he(()=>[$("button",{id:"zoom-out-button",class:Qn(["text-white hover:text-purple-500 transition-colors p-1 rounded",{"opacity-50 cursor-not-allowed":d.value<=.3}]),onClick:_},[lt(Wt(ye),{icon:"mdi:minus",width:"20"})],2)]),_:1}),$("span",RN,li(Math.round(d.value*100))+"%",1),lt(Mt,{content:"",placement:"top"},{default:he(()=>[$("button",{id:"zoom-in-button",class:Qn(["text-white hover:text-purple-500 transition-colors p-1 rounded",{"opacity-50 cursor-not-allowed":d.value>=5}]),onClick:o},[lt(Wt(ye),{icon:"mdi:plus",width:"20"})],2)]),_:1}),lt(It,{id:"export-button",class:"text-white",type:"primary",size:"small",onClick:Yl},{default:he(()=>[$("div",BN,[lt(Wt(ye),{icon:"mdi:export",width:"20"}),pt[0]||(pt[0]=aI("  "))])]),_:1})])]),$("div",{class:"h-[calc(100%-36px)] relative overflow-x-scroll",ref_key:"trackContainer",ref:pe},[lt(eN,{duration:J.timelineDuration,zoom:d.value,"current-time":J.currentTime,"total-width":m.value,onScroll:Yc,onTimeUpdate:ha},null,8,["duration","zoom","current-time","total-width"]),$("div",{class:"relative h-[calc(100%-36px)] overflow-x-hidden overflow-y-auto",style:Er({width:m.value+"px"}),onDragover:Ii(N,["prevent"]),onDragleave:Ii(L,["prevent"]),onDrop:Ii(k,["prevent"])},[J.tracks.length?be("",!0):(St(),Ft("div",FN,pt[1]||(pt[1]=[$("div",{class:"text-[#666] text-lg mb-4"},"",-1),$("div",{class:"w-[200px] h-[40px] bg-purple-500/20 border-2 border-dashed border-purple-500 rounded"},null,-1)]))),lt(EN,{ref_key:"tracksListRef",ref:v,tracks:J.tracks,hoveredTrack:w.value,dragPreview:x.value,dragPreviewPosition:T.value,dragPreviewWidth:r.value,zoom:d.value,frameLength:K0*d.value*10,onStartResize:At,onTrackDragEnter:it,onTrackDragLeave:gt,onClipMouseDown:Xt,onClipHover:vt,onDeleteClip:Xc,onBackgroundClick:Do,onSaveHistoryState:Pr},null,8,["tracks","hoveredTrack","dragPreview","dragPreviewPosition","dragPreviewWidth","zoom","frameLength"])],36)],512)])}}}),DN={class:"mb-6"},kN={class:"grid grid-cols-2 gap-3 mb-4"},ON={class:"mb-4"},NN={class:"flex items-center gap-4"},zN={class:"w-full"},GN={class:"w-8 h-8 rounded-full border border-[#af24ff] relative"},HN={class:"flex gap-3 mb-3"},$N={class:"flex-1"},VN={class:"flex-1"},WN={class:"flex items-center gap-3 mb-3"},XN={class:"flex-1"},YN={class:"flex items-center gap-3"},jN={class:"flex items-center gap-3"},qN={class:"flex-1"},KN={class:"flex items-center gap-3"},ZN={class:"w-12 text-right"},JN=hi({__name:"VideoProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,l=Tt(!1),h=r=>{let a=r*(180/Math.PI);return a=a%360,a<0&&(a+=360),Math.round(a)},d=r=>r*(Math.PI/180),o=De(()=>{var a;if(((a=e.clip)==null?void 0:a.angle)===void 0)return 0;let r=h(e.clip.angle);return r=(r+180)%360,r}),_=De({get:()=>{var r;return((r=e.clip)==null?void 0:r.angle)===void 0?0:h(e.clip.angle)},set:r=>{e.clip&&(e.clip.angle=d(r))}}),m=r=>{if(!e.clip)return;if(r===null||isNaN(r)){e.clip.angle=0;return}let a=r%360;a<0&&(a+=360),e.clip.angle=d(a)},v=r=>{l.value=!0},w=r=>{if(!l.value||!e.clip)return;const a=r.currentTarget.getBoundingClientRect(),u=a.left+a.width/2,f=a.top+a.height/2;let g=Math.atan2(r.clientY-f,r.clientX-u);g=g+Math.PI/2,g<0&&(g+=Math.PI*2),e.clip.angle=g,n("update",e.clip)},x=()=>{l.value=!1},T=(r,a)=>{e.clip&&((r===null||isNaN(r))&&(e.clip[a]=0),n("update",e.clip))};return(r,a)=>{const u=le("el-input-number"),f=le("el-slider");return St(),Ft("div",DN,[a[22]||(a[22]=$("div",{class:"text-base font-medium text-white mb-4"},"",-1)),$("div",kN,[$("div",null,[a[14]||(a[14]=$("div",{class:"text-base text-[#999] mb-1"},"X ",-1)),lt(u,{class:"w-30",modelValue:r.clip.x,"onUpdate:modelValue":a[0]||(a[0]=g=>r.clip.x=g),size:"small",placeholder:"X",precision:0,onChange:a[1]||(a[1]=g=>T(g,"x"))},null,8,["modelValue"])]),$("div",null,[a[15]||(a[15]=$("div",{class:"text-base text-[#999] mb-1"},"Y ",-1)),lt(u,{class:"w-30",modelValue:r.clip.y,"onUpdate:modelValue":a[2]||(a[2]=g=>r.clip.y=g),size:"small",placeholder:"Y",precision:0,onChange:a[3]||(a[3]=g=>T(g,"y"))},null,8,["modelValue"])])]),$("div",ON,[a[17]||(a[17]=$("div",{class:"text-base text-[#999] mb-2"},"",-1)),$("div",NN,[$("div",zN,[lt(u,{class:"w-full",modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=g=>_.value=g),min:0,max:360,step:1,size:"small","controls-position":"right",onChange:m},null,8,["modelValue"])]),$("div",{class:"relative flex items-center justify-center",onMousedown:v,onMousemove:w,onMouseup:x,onMouseleave:x},[$("div",GN,[$("div",{class:"absolute w-[1px] h-[13px] bg-[#af24ff]",style:Er({transform:`rotate(${o.value}deg)`,left:"calc(50% - 0.5px)",top:"50%",transformOrigin:"top"})},a[16]||(a[16]=[$("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 rounded-full bg-[#af24ff]"},null,-1)]),4)])],32)])]),$("div",HN,[$("div",$N,[a[18]||(a[18]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),lt(u,{class:"w-30",modelValue:r.clip.sourceStartTime,"onUpdate:modelValue":a[5]||(a[5]=g=>r.clip.sourceStartTime=g),size:"small",min:0,step:.1,placeholder:"",onChange:a[6]||(a[6]=g=>T(g,"sourceStartTime"))},null,8,["modelValue"])]),$("div",VN,[a[19]||(a[19]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),lt(u,{class:"w-30",modelValue:r.clip.sourceEndTime,"onUpdate:modelValue":a[7]||(a[7]=g=>r.clip.sourceEndTime=g),size:"small",min:0,step:.1,placeholder:"",onChange:a[8]||(a[8]=g=>T(g,"sourceEndTime"))},null,8,["modelValue"])])]),$("div",WN,[$("div",XN,[a[20]||(a[20]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),$("div",YN,[lt(f,{modelValue:r.clip.volume,"onUpdate:modelValue":a[9]||(a[9]=g=>r.clip.volume=g),min:0,max:100,step:1},null,8,["modelValue"]),r.clip.volume===100?(St(),Pi(Wt(ye),{key:0,icon:"material-symbols:volume-up",onClick:a[10]||(a[10]=g=>r.clip.volume=0)})):r.clip.volume!==0?(St(),Pi(Wt(ye),{key:1,icon:"material-symbols:volume-down",onClick:a[11]||(a[11]=g=>r.clip.volume=0)})):(St(),Pi(Wt(ye),{key:2,icon:"material-symbols:volume-off",onClick:a[12]||(a[12]=g=>r.clip.volume=100)}))])])]),$("div",jN,[$("div",qN,[a[21]||(a[21]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),$("div",KN,[lt(f,{modelValue:r.clip.opacity,"onUpdate:modelValue":a[13]||(a[13]=g=>r.clip.opacity=g),min:0,max:100,step:1},null,8,["modelValue"]),$("div",ZN,li(Math.round(r.clip.opacity))+"%",1)])])])])}}}),QN=ar(JN,[["__scopeId","data-v-a203910b"]]),tz={class:"mb-6"},ez={class:"flex gap-3 mb-3"},iz={class:"flex-1"},rz={class:"flex-1"},nz={class:"flex items-center gap-3"},sz={class:"flex-1"},az={class:"flex items-center gap-3"},oz=hi({__name:"AudioProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,l=(h,d)=>{e.clip&&((h===null||isNaN(h))&&(e.clip[d]=0),n("update",e.clip))};return(h,d)=>{const o=le("el-input-number"),_=le("el-slider");return St(),Ft("div",tz,[d[11]||(d[11]=$("div",{class:"text-base font-medium text-white mb-4"},"",-1)),$("div",ez,[$("div",iz,[d[8]||(d[8]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),lt(o,{class:"w-30",modelValue:h.clip.sourceStartTime,"onUpdate:modelValue":d[0]||(d[0]=m=>h.clip.sourceStartTime=m),size:"small",min:0,step:.1,placeholder:"",onChange:d[1]||(d[1]=m=>l(m,"sourceStartTime"))},null,8,["modelValue"])]),$("div",rz,[d[9]||(d[9]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),lt(o,{class:"w-30",modelValue:h.clip.sourceEndTime,"onUpdate:modelValue":d[2]||(d[2]=m=>h.clip.sourceEndTime=m),size:"small",min:0,step:.1,placeholder:"",onChange:d[3]||(d[3]=m=>l(m,"sourceEndTime"))},null,8,["modelValue"])])]),$("div",nz,[$("div",sz,[d[10]||(d[10]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),$("div",az,[lt(_,{modelValue:h.clip.volume,"onUpdate:modelValue":d[4]||(d[4]=m=>h.clip.volume=m),min:0,max:100,step:1},null,8,["modelValue"]),h.clip.volume===100?(St(),Pi(Wt(ye),{key:0,icon:"material-symbols:volume-up",onClick:d[5]||(d[5]=m=>h.clip.volume=0)})):h.clip.volume!==0?(St(),Pi(Wt(ye),{key:1,icon:"material-symbols:volume-down",onClick:d[6]||(d[6]=m=>h.clip.volume=0)})):(St(),Pi(Wt(ye),{key:2,icon:"material-symbols:volume-off",onClick:d[7]||(d[7]=m=>h.clip.volume=100)}))])])])])}}}),lz=ar(oz,[["__scopeId","data-v-8cf099bb"]]),hz={class:"mb-6"},uz={class:"grid grid-cols-2 gap-3 mb-4"},cz={class:"mb-4"},dz={class:"flex items-center gap-4"},fz={class:"w-full"},pz={class:"w-8 h-8 rounded-full border border-[#af24ff] relative"},_z={class:"flex items-center gap-3"},gz={class:"flex-1"},mz={class:"flex items-center gap-3"},yz={class:"w-12 text-right"},vz=hi({__name:"ImageProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,l=Tt(!1),h=r=>{let a=r*(180/Math.PI);return a=a%360,a<0&&(a+=360),Math.round(a)},d=r=>r*(Math.PI/180),o=De(()=>{var a;if(((a=e.clip)==null?void 0:a.angle)===void 0)return 0;let r=h(e.clip.angle);return r=(r+180)%360,r}),_=De({get:()=>{var r;return((r=e.clip)==null?void 0:r.angle)===void 0?0:h(e.clip.angle)},set:r=>{e.clip&&(e.clip.angle=d(r))}}),m=r=>{if(!e.clip)return;if(r===null||isNaN(r)){e.clip.angle=0;return}let a=r%360;a<0&&(a+=360),e.clip.angle=d(a)},v=r=>{l.value=!0},w=r=>{if(!l.value||!e.clip)return;const a=r.currentTarget.getBoundingClientRect(),u=a.left+a.width/2,f=a.top+a.height/2;let g=Math.atan2(r.clientY-f,r.clientX-u);g=g+Math.PI/2,g<0&&(g+=Math.PI*2),e.clip.angle=g,n("update",e.clip)},x=()=>{l.value=!1},T=(r,a)=>{e.clip&&((r===null||isNaN(r))&&(e.clip[a]=0),n("update",e.clip))};return(r,a)=>{const u=le("el-input-number"),f=le("el-slider");return St(),Ft("div",hz,[a[11]||(a[11]=$("div",{class:"text-base font-medium text-white mb-4"},"",-1)),$("div",uz,[$("div",null,[a[6]||(a[6]=$("div",{class:"text-base text-[#999] mb-1"},"X ",-1)),lt(u,{class:"w-30",modelValue:r.clip.x,"onUpdate:modelValue":a[0]||(a[0]=g=>r.clip.x=g),size:"small",placeholder:"X",precision:0,onChange:a[1]||(a[1]=g=>T(g,"x"))},null,8,["modelValue"])]),$("div",null,[a[7]||(a[7]=$("div",{class:"text-base text-[#999] mb-1"},"Y ",-1)),lt(u,{class:"w-30",modelValue:r.clip.y,"onUpdate:modelValue":a[2]||(a[2]=g=>r.clip.y=g),size:"small",placeholder:"Y",precision:0,onChange:a[3]||(a[3]=g=>T(g,"y"))},null,8,["modelValue"])])]),$("div",cz,[a[9]||(a[9]=$("div",{class:"text-base text-[#999] mb-2"},"",-1)),$("div",dz,[$("div",fz,[lt(u,{class:"w-full",modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=g=>_.value=g),min:0,max:360,step:1,size:"small","controls-position":"right",onChange:m},null,8,["modelValue"])]),$("div",{class:"relative flex items-center justify-center",onMousedown:v,onMousemove:w,onMouseup:x,onMouseleave:x},[$("div",pz,[$("div",{class:"absolute w-[1px] h-[13px] bg-[#af24ff]",style:Er({transform:`rotate(${o.value}deg)`,left:"calc(50% - 0.5px)",top:"50%",transformOrigin:"top"})},a[8]||(a[8]=[$("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 rounded-full bg-[#af24ff]"},null,-1)]),4)])],32)])]),$("div",_z,[$("div",gz,[a[10]||(a[10]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),$("div",mz,[lt(f,{modelValue:r.clip.opacity,"onUpdate:modelValue":a[5]||(a[5]=g=>r.clip.opacity=g),min:0,max:100,step:1},null,8,["modelValue"]),$("div",yz,li(Math.round(r.clip.opacity))+"%",1)])])])])}}}),xz=ar(vz,[["__scopeId","data-v-6d7357c9"]]),bz={class:"mb-6"},wz={class:"mb-2"},Sz={class:"mb-4"},Ez={class:"flex items-center gap-4 mb-3"},Tz={class:"w-full"},Az={class:"w-8 h-8 rounded-full border border-[#af24ff] relative"},Cz={class:"flex justify-start items-center gap-1"},Uz={class:"py-2"},Iz={class:"flex justify-between items-center mb-2"},Pz={class:"flex-1 mx-4"},Rz={class:"flex justify-between items-center mb-2"},Bz={class:"flex justify-between items-center mb-2"},Fz={class:"flex justify-between items-center mb-2"},Mz={class:"flex justify-between items-center mb-2 pl-4"},Lz={class:"flex justify-between items-center mb-2 pl-4"},Dz={class:"flex justify-between items-center mb-2"},kz={class:"flex justify-between items-center mb-2 pl-4"},Oz={class:"flex justify-between items-center mb-2 pl-4"},Nz={class:"flex justify-between items-center mb-2 pl-4"},zz={class:"flex justify-between items-center mb-2 pl-4"},Gz=hi({__name:"TextProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,l=Tt(!1),h=Tt([]),d=u=>{let f=u*(180/Math.PI);return f=f%360,f<0&&(f+=360),Math.round(f)},o=u=>u*(Math.PI/180),_=De(()=>{var f;if(((f=e.clip)==null?void 0:f.angle)===void 0)return 0;let u=d(e.clip.angle);return u=(u+180)%360,u}),m=De({get:()=>{var u;return((u=e.clip)==null?void 0:u.angle)===void 0?0:d(e.clip.angle)},set:u=>{e.clip&&(e.clip.angle=o(u))}}),v=De(()=>{var u,f;switch((f=(u=e.clip)==null?void 0:u.textConfig)==null?void 0:f.align){case"center":return"material-symbols:format-align-center";case"right":return"material-symbols:format-align-right";default:return"material-symbols:format-align-left"}}),w=u=>{e.clip&&(e.clip.textConfig.align=u,n("update",e.clip))},x=u=>{if(!e.clip)return;if(u===null||isNaN(u)){e.clip.angle=0;return}let f=u%360;f<0&&(f+=360),e.clip.angle=o(f),n("update",e.clip)},T=u=>{l.value=!0},r=u=>{if(!l.value||!e.clip)return;const f=u.currentTarget.getBoundingClientRect(),g=f.left+f.width/2,b=f.top+f.height/2;let S=Math.atan2(u.clientY-b,u.clientX-g);S=S+Math.PI/2,S<0&&(S+=Math.PI*2),e.clip.angle=S,n("update",e.clip)},a=()=>{l.value=!1};return(u,f)=>{const g=le("el-input"),b=le("el-option"),S=le("el-select"),A=le("el-input-number"),C=le("el-button"),B=le("el-dropdown-item"),R=le("el-dropdown-menu"),M=le("el-dropdown"),N=le("el-color-picker"),L=le("el-slider"),W=le("el-switch"),k=le("el-collapse-item"),j=le("el-collapse");return St(),Ft("div",bz,[f[36]||(f[36]=$("div",{class:"text-base font-medium text-white mb-4"},"",-1)),$("div",wz,[lt(g,{modelValue:u.clip.textConfig.content,"onUpdate:modelValue":f[0]||(f[0]=Y=>u.clip.textConfig.content=Y),type:"textarea",rows:3,placeholder:""},null,8,["modelValue"])]),$("div",Sz,[f[22]||(f[22]=$("div",{class:"text-base text-white mb-2"},"",-1)),lt(S,{modelValue:u.clip.textConfig.fontFamily,"onUpdate:modelValue":f[1]||(f[1]=Y=>u.clip.textConfig.fontFamily=Y),class:"w-full mb-2"},{default:he(()=>[lt(b,{label:"DM Sans",value:"DM Sans"}),lt(b,{label:"",value:"Microsoft YaHei"}),lt(b,{label:"",value:"SimSun"}),lt(b,{label:"",value:"SimHei"})]),_:1},8,["modelValue"]),f[23]||(f[23]=$("div",{class:"text-base text-white mb-2"},"",-1)),$("div",Ez,[$("div",Tz,[lt(A,{class:"w-full",modelValue:m.value,"onUpdate:modelValue":f[2]||(f[2]=Y=>m.value=Y),min:0,max:360,step:1,size:"small","controls-position":"right",onChange:x},null,8,["modelValue"])]),$("div",{class:"relative flex items-center justify-center",onMousedown:T,onMousemove:r,onMouseup:a,onMouseleave:a},[$("div",Az,[$("div",{class:"absolute w-[1px] h-[13px] bg-[#af24ff]",style:Er({transform:`rotate(${_.value}deg)`,left:"calc(50% - 0.5px)",top:"50%",transformOrigin:"top"})},f[18]||(f[18]=[$("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 rounded-full bg-[#af24ff]"},null,-1)]),4)])],32)]),$("div",Cz,[lt(C,{class:Qn({"text-purple-500":u.clip.textConfig.bold}),size:"small",onClick:f[3]||(f[3]=Y=>u.clip.textConfig.bold=!u.clip.textConfig.bold)},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-bold"})]),_:1},8,["class"]),lt(C,{class:Qn(["!ml-0",{"text-purple-500":u.clip.textConfig.italic}]),size:"small",onClick:f[4]||(f[4]=Y=>u.clip.textConfig.italic=!u.clip.textConfig.italic)},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-italic"})]),_:1},8,["class"]),lt(M,{trigger:"click",onCommand:w},{dropdown:he(()=>[lt(R,null,{default:he(()=>[lt(B,{command:"left"},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-align-left"}),f[19]||(f[19]=$("span",{class:"text-sm text-white ml-2"},"",-1))]),_:1}),lt(B,{command:"center"},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-align-center"}),f[20]||(f[20]=$("span",{class:"text-sm text-white ml-2"},"",-1))]),_:1}),lt(B,{command:"right"},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-align-right"}),f[21]||(f[21]=$("span",{class:"text-sm text-white ml-2"},"",-1))]),_:1})]),_:1})]),default:he(()=>[lt(C,{size:"small"},{default:he(()=>[lt(Wt(ye),{icon:v.value},null,8,["icon"])]),_:1})]),_:1}),lt(N,{modelValue:u.clip.textConfig.color,"onUpdate:modelValue":f[5]||(f[5]=Y=>u.clip.textConfig.color=Y),size:"small","show-alpha":""},null,8,["modelValue"])])]),lt(j,{modelValue:h.value,"onUpdate:modelValue":f[17]||(f[17]=Y=>h.value=Y)},{default:he(()=>[lt(k,{name:"advanced"},{title:he(()=>f[24]||(f[24]=[$("span",{class:"text-base text-white"},"",-1)])),default:he(()=>[$("div",Uz,[$("div",Iz,[f[25]||(f[25]=$("span",{class:"text-base text-white"},"",-1)),$("div",Pz,[lt(L,{modelValue:u.clip.opacity,"onUpdate:modelValue":f[6]||(f[6]=Y=>u.clip.opacity=Y),min:0,max:100,step:1},null,8,["modelValue"])])]),$("div",Rz,[f[26]||(f[26]=$("span",{class:"text-base text-white"},"",-1)),lt(A,{modelValue:u.clip.textConfig.lineSpacing,"onUpdate:modelValue":f[7]||(f[7]=Y=>u.clip.textConfig.lineSpacing=Y),min:0,step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Bz,[f[27]||(f[27]=$("span",{class:"text-base text-white"},"",-1)),lt(A,{modelValue:u.clip.textConfig.letterSpacing,"onUpdate:modelValue":f[8]||(f[8]=Y=>u.clip.textConfig.letterSpacing=Y),step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Fz,[f[28]||(f[28]=$("span",{class:"text-base text-white"},"",-1)),lt(W,{modelValue:u.clip.textConfig.showStroke,"onUpdate:modelValue":f[9]||(f[9]=Y=>u.clip.textConfig.showStroke=Y)},null,8,["modelValue"])]),u.clip.textConfig.showStroke?(St(),Ft($i,{key:0},[$("div",Mz,[f[29]||(f[29]=$("span",{class:"text-base text-white"},"",-1)),lt(N,{modelValue:u.clip.textConfig.strokeColor,"onUpdate:modelValue":f[10]||(f[10]=Y=>u.clip.textConfig.strokeColor=Y),"show-alpha":"",size:"small"},null,8,["modelValue"])]),$("div",Lz,[f[30]||(f[30]=$("span",{class:"text-base text-white"},"",-1)),lt(A,{modelValue:u.clip.textConfig.strokeWidth,"onUpdate:modelValue":f[11]||(f[11]=Y=>u.clip.textConfig.strokeWidth=Y),min:0,step:.5,"controls-position":"right",class:"w-30"},null,8,["modelValue"])])],64)):be("",!0),$("div",Dz,[f[31]||(f[31]=$("span",{class:"text-base text-white"},"",-1)),lt(W,{modelValue:u.clip.textConfig.showShadow,"onUpdate:modelValue":f[12]||(f[12]=Y=>u.clip.textConfig.showShadow=Y)},null,8,["modelValue"])]),u.clip.textConfig.showShadow?(St(),Ft($i,{key:1},[$("div",kz,[f[32]||(f[32]=$("span",{class:"text-base text-white"},"",-1)),lt(N,{modelValue:u.clip.textConfig.shadowColor,"onUpdate:modelValue":f[13]||(f[13]=Y=>u.clip.textConfig.shadowColor=Y),"show-alpha":"",size:"small"},null,8,["modelValue"])]),$("div",Oz,[f[33]||(f[33]=$("span",{class:"text-base text-white"},"",-1)),lt(A,{modelValue:u.clip.textConfig.shadowBlur,"onUpdate:modelValue":f[14]||(f[14]=Y=>u.clip.textConfig.shadowBlur=Y),min:0,step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Nz,[f[34]||(f[34]=$("span",{class:"text-base text-white"},"",-1)),lt(A,{modelValue:u.clip.textConfig.shadowOffsetX,"onUpdate:modelValue":f[15]||(f[15]=Y=>u.clip.textConfig.shadowOffsetX=Y),step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",zz,[f[35]||(f[35]=$("span",{class:"text-base text-white"},"",-1)),lt(A,{modelValue:u.clip.textConfig.shadowOffsetY,"onUpdate:modelValue":f[16]||(f[16]=Y=>u.clip.textConfig.shadowOffsetY=Y),step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])])],64)):be("",!0)])]),_:1})]),_:1},8,["modelValue"])])}}}),Hz=ar(Gz,[["__scopeId","data-v-fcc51af5"]]),$z={class:"text-white"},Vz={key:0,class:"mb-6"},Wz={class:"mb-4"},Xz={class:"text-base text-white"},Yz={class:"mb-4"},jz=hi({__name:"FilterProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=h=>{e.clip.intensity=h},l=h=>h?{grayscale:"",invert:"",brightness:"",sepia:"",blur:""}[h]:"";return(h,d)=>{const o=le("el-slider");return St(),Ft("div",$z,[h.clip?(St(),Ft("div",Vz,[d[3]||(d[3]=$("div",{class:"text-base font-medium text-white mb-4"},"",-1)),$("div",Wz,[d[1]||(d[1]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),$("div",Xz,li(l(h.clip.filterType)),1)]),$("div",Yz,[d[2]||(d[2]=$("div",{class:"text-base text-[#999] mb-1"},"",-1)),lt(o,{modelValue:h.clip.intensity,"onUpdate:modelValue":d[0]||(d[0]=_=>h.clip.intensity=_),min:0,max:100,step:1,onChange:n,class:"filter-slider"},null,8,["modelValue"])])])):be("",!0)])}}}),qz=ar(jz,[["__scopeId","data-v-18c52553"]]),Kz={class:"p-6 text-white"},Zz={key:1,class:"text-center text-[#999] text-base"},Jz=hi({__name:"ClipProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,l=sa(),h=d=>{n("update",d)};return ls(()=>e.clip,d=>{d&&l.publishClipUpdate(d)},{deep:!0}),(d,o)=>(St(),Ft("div",Kz,[d.clip?(St(),Ft($i,{key:0},[d.clip.type==="video"?(St(),Pi(QN,{key:0,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="audio"?(St(),Pi(lz,{key:1,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="image"?(St(),Pi(xz,{key:2,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="text"?(St(),Pi(Hz,{key:3,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="filter"?(St(),Pi(qz,{key:4,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0)],64)):(St(),Ft("div",Zz,"  "))]))}}),Qz={id:"left",class:"h-screen"},t4={id:"right",class:"h-screen overflow-hidden"},e4={id:"top",class:"flex justify-between"},i4={id:"topLeft",class:"w-4/5"},r4={id:"topRight",class:"w-1/5 bg-[#303030]"},n4={id:"bottom",class:"bg-[#201f20]"},_p=10,s4=300,a4=5,ol="split-sizes",d4=hi({__name:"index",setup(s){const t=L=>{L.ctrlKey&&L.preventDefault()};So(()=>{window.addEventListener("wheel",t,{passive:!1})}),Nl(()=>{window.removeEventListener("wheel",t)});const e=J0(),n=sa(),l=Number(e.params.id),h=[25,75],d=[65,35],o=Tt([]),_=Tt(0),m=De(()=>Math.max(v.value+a4,s4)),v=De(()=>{let L=0;return o.value.forEach(W=>{W.clips.forEach(k=>{const j=Number(k.endTime);j>L&&(L=j)})}),L}),w=Tt(null),x=Tt(null),T=L=>{_.value=L},r=async L=>{const W=uI(L);await F_("/capture/"+l+".png",W,{overwrite:!0});const k=await Ke.projects.where({id:l}).first();k&&Ke.projects.update(k,{thumbnail:"/capture/"+l+".png"})},a=()=>{_.value-=30/1e3/1e3},u=()=>{_.value+=30/1e3/1e3};Oy("addClip",async(L,W)=>{if(L.startTime=_.value,L.endTime=_.value+L.duration,L.type==="video"&&(L.sourceStartTime=0,L.sourceEndTime=0,L.originalDuration=L.duration),L.type==="video"||L.type==="image"){const k=await R_(L);k.type==="video"?L.thumbnail=k.data:k.type==="image"&&(L.thumbnail=[{timestamp:0,url:URL.createObjectURL(k.data)}])}if(L.type==="audio"){const k=await B_(L);k.type==="audio"&&(L.volumeData=k.data)}if(W){if(o.value.length>=_p){Zs.warning(`(${_p})`);return}const k={id:String(o.value.length),clips:[L]};o.value.push(k)}else o.value.length===0&&o.value.push({id:"0",clips:[]}),o.value[o.value.length-1].clips.push(L);Il(()=>{var k;(k=w.value)==null||k.refreshPlayer()})}),Oy("activeClip",L=>{var W,k,j;if(L){const Y=(W=o.value.find(ut=>ut.clips.some(it=>it.id===L)))==null?void 0:W.clips.find(ut=>ut.id===L);Y&&((k=x.value)==null||k.activeClip(Y),S.value=Y)}else(j=x.value)==null||j.activeClip(null),S.value=null}),Tt(0),Tt(0),So(async()=>{const L=localStorage.getItem(ol),{horizontalSizes:W,verticalSizes:k}=L?JSON.parse(L):{horizontalSizes:h,verticalSizes:d};j0(["#left","#right"],{sizes:W,minSize:[250,500],snapOffset:0,onDragEnd:Y=>{const ut=localStorage.getItem(ol),it=ut?JSON.parse(ut):{};localStorage.setItem(ol,JSON.stringify({...it,horizontalSizes:Y}))}}),j0(["#top","#bottom"],{direction:"vertical",sizes:k,minSize:[250,150],snapOffset:0,onDragEnd:Y=>{const ut=localStorage.getItem(ol),it=ut?JSON.parse(ut):{};localStorage.setItem(ol,JSON.stringify({...it,verticalSizes:Y}))}});const j=await Ke.projects.where({id:l}).first();j&&(o.value=j.tracks,B(),o.value.forEach(Y=>{Y.clips.forEach(ut=>{ut.type==="audio"?B_(ut).then(it=>{it.type==="audio"&&(ut.volumeData=it.data)}):(ut.type==="video"||ut.type==="image")&&R_(ut).then(it=>{it.type==="video"?ut.thumbnail=it.data:it.type==="image"&&(ut.thumbnail=[{timestamp:0,url:URL.createObjectURL(it.data)}])})})}),n.clearHistory(l),n.saveHistoryState(l,o.value),M())});const f=()=>{n.setShowContextMenu(!1)},g=(L,W)=>{for(const k of o.value)for(const j of k.clips)if(j.id===L){Object.assign(j,W);break}};ls(()=>o.value,async L=>{await b()},{deep:!0});const b=async()=>{const L=await Ke.projects.where({id:l}).first();if(L){const W=Mw.cloneDeep(o.value);W.forEach(k=>{k.clips.forEach(j=>{j.thumbnail=null})}),await Ke.projects.update(L,{tracks:W})}},S=Tt(null),A=L=>{var W;S.value=L,(W=w.value)==null||W.activeClip(L)},C=L=>{var W;(W=w.value)==null||W.addClip(L)},B=()=>{o.value=o.value.filter(L=>L.clips.length>0)},R=()=>{var L;(L=w.value)==null||L.handleStopPlay()},M=()=>{var L;(L=w.value)==null||L.refreshPlayer()},N=()=>{var L;(L=w.value)==null||L.handleExport()};return(L,W)=>(St(),Ft("div",{class:"w-full h-full flex bg-[#1b1b1d] overflow-hidden",onClick:f},[$("div",Qz,[lt(VO)]),$("div",t4,[$("div",e4,[$("div",i4,[lt(Qk,{ref_key:"playerRef",ref:w,currentTime:_.value,tracks:o.value,timelineDuration:Wt(m),playerDuration:Wt(v),onPrevFrame:a,onNextFrame:u,onTimeUpdate:T,onCaptureImage:r,onUpdateClipProps:g},null,8,["currentTime","tracks","timelineDuration","playerDuration"])]),$("div",r4,[lt(Jz,{clip:S.value,onUpdate:g},null,8,["clip"])])]),$("div",n4,[lt(LN,{ref_key:"clipTrackRef",ref:x,tracks:o.value,"onUpdate:tracks":W[0]||(W[0]=k=>o.value=k),maxTracksNum:_p,currentTime:_.value,timelineDuration:Wt(m),onStopPlay:R,onTimeUpdate:T,onAddClip:C,onRefreshPlayer:M,onDeleteEmptyTrack:B,onActiveClip:A,onHandleExport:N},null,8,["tracks","currentTime","timelineDuration"])])])]))}});export{d4 as default};
