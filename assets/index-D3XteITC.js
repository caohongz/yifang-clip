var jU=Object.defineProperty;var Fy=s=>{throw TypeError(s)};var qU=(s,t,e)=>t in s?jU(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var lf=(s,t,e)=>qU(s,typeof t!="symbol"?t+"":t,e),hf=(s,t,e)=>t.has(s)||Fy("Cannot "+e);var xt=(s,t,e)=>(hf(s,t,"read from private field"),e?e.call(s):t.get(s)),Hn=(s,t,e)=>t.has(s)?Fy("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),$n=(s,t,e,n)=>(hf(s,t,"write to private field"),n?n.call(s,e):t.set(s,e),e),Es=(s,t,e)=>(hf(s,t,"access private method"),e);import{m as Cc,q as KU,d as hi,s as My,x as qr,y as ZU,r as Tt,z as De,o as So,A as Nl,B as ls,C as JU,i as Wt,c as Ft,a as $,D as Er,t as li,b as lt,G as Pi,H as Uc,n as Il,I as uf,E as Zs,J as QU,g as St,f as le,w as he,F as $i,e as In,j as Ii,K as be,p as fp,L as tI,M as Qn,N as Y0,h as eI,O as Ly}from"./index-CgFalpuM.js";import{t as iI,J as P_,d as Ke,a as cf,c as rI,_ as ar,g as nI,y as Pl,b as sI}from"./_plugin-vue_export-helper-DvwDhwqA.js";var j0={};(function(s){var t=function(){var r=new Date,a=4,u=3,f=2,g=1,x=a,S={setLogLevel:function(A){A==this.debug?x=g:A==this.info?x=f:A==this.warn?x=u:(A==this.error,x=a)},debug:function(A,C){console.debug===void 0&&(console.debug=console.log),g>=x&&console.debug("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},log:function(A,C){this.debug(A.msg)},info:function(A,C){f>=x&&console.info("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},warn:function(A,C){u>=x&&console.warn("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},error:function(A,C){a>=x&&console.error("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)}};return S}();t.getDurationString=function(r,a){var u;function f(B,R){for(var M=""+B,N=M.split(".");N[0].length<R;)N[0]="0"+N[0];return N.join(".")}r<0?(u=!0,r=-r):u=!1;var g=a||1,x=r/g,S=Math.floor(x/3600);x-=S*3600;var A=Math.floor(x/60);x-=A*60;var C=x*1e3;return x=Math.floor(x),C-=x*1e3,C=Math.floor(C),(u?"-":"")+S+":"+f(A,2)+":"+f(x,2)+"."+f(C,3)},t.printRanges=function(r){var a=r.length;if(a>0){for(var u="",f=0;f<a;f++)f>0&&(u+=","),u+="["+t.getDurationString(r.start(f))+","+t.getDurationString(r.end(f))+"]";return u}else return"(empty)"},s.Log=t;var e=function(r){if(r instanceof ArrayBuffer)this.buffer=r,this.dataview=new DataView(r);else throw"Needs an array buffer";this.position=0};e.prototype.getPosition=function(){return this.position},e.prototype.getEndPosition=function(){return this.buffer.byteLength},e.prototype.getLength=function(){return this.buffer.byteLength},e.prototype.seek=function(r){var a=Math.max(0,Math.min(this.buffer.byteLength,r));return this.position=isNaN(a)||!isFinite(a)?0:a,!0},e.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},e.prototype.readAnyInt=function(r,a){var u=0;if(this.position+r<=this.buffer.byteLength){switch(r){case 1:a?u=this.dataview.getInt8(this.position):u=this.dataview.getUint8(this.position);break;case 2:a?u=this.dataview.getInt16(this.position):u=this.dataview.getUint16(this.position);break;case 3:if(a)throw"No method for reading signed 24 bits values";u=this.dataview.getUint8(this.position)<<16,u|=this.dataview.getUint8(this.position+1)<<8,u|=this.dataview.getUint8(this.position+2);break;case 4:a?u=this.dataview.getInt32(this.position):u=this.dataview.getUint32(this.position);break;case 8:if(a)throw"No method for reading signed 64 bits values";u=this.dataview.getUint32(this.position)<<32,u|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+r}return this.position+=r,u}else throw"Not enough bytes in buffer"},e.prototype.readUint8=function(){return this.readAnyInt(1,!1)},e.prototype.readUint16=function(){return this.readAnyInt(2,!1)},e.prototype.readUint24=function(){return this.readAnyInt(3,!1)},e.prototype.readUint32=function(){return this.readAnyInt(4,!1)},e.prototype.readUint64=function(){return this.readAnyInt(8,!1)},e.prototype.readString=function(r){if(this.position+r<=this.buffer.byteLength){for(var a="",u=0;u<r;u++)a+=String.fromCharCode(this.readUint8());return a}else throw"Not enough bytes in buffer"},e.prototype.readCString=function(){for(var r=[];;){var a=this.readUint8();if(a!==0)r.push(a);else break}return String.fromCharCode.apply(null,r)},e.prototype.readInt8=function(){return this.readAnyInt(1,!0)},e.prototype.readInt16=function(){return this.readAnyInt(2,!0)},e.prototype.readInt32=function(){return this.readAnyInt(4,!0)},e.prototype.readInt64=function(){return this.readAnyInt(8,!1)},e.prototype.readUint8Array=function(r){for(var a=new Uint8Array(r),u=0;u<r;u++)a[u]=this.readUint8();return a},e.prototype.readInt16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readInt16();return a},e.prototype.readUint16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readUint16();return a},e.prototype.readUint32Array=function(r){for(var a=new Uint32Array(r),u=0;u<r;u++)a[u]=this.readUint32();return a},e.prototype.readInt32Array=function(r){for(var a=new Int32Array(r),u=0;u<r;u++)a[u]=this.readInt32();return a},s.MP4BoxStream=e;var n=function(r,a,u){this._byteOffset=a||0,r instanceof ArrayBuffer?this.buffer=r:typeof r=="object"?(this.dataView=r,a&&(this._byteOffset+=a)):this.buffer=new ArrayBuffer(r||0),this.position=0,this.endianness=u??n.LITTLE_ENDIAN};n.prototype={},n.prototype.getPosition=function(){return this.position},n.prototype._realloc=function(r){if(this._dynamicSize){var a=this._byteOffset+this.position+r,u=this._buffer.byteLength;if(a<=u){a>this._byteLength&&(this._byteLength=a);return}for(u<1&&(u=1);a>u;)u*=2;var f=new ArrayBuffer(u),g=new Uint8Array(this._buffer),x=new Uint8Array(f,0,g.length);x.set(g),this.buffer=f,this._byteLength=a}},n.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var r=new ArrayBuffer(this._byteLength),a=new Uint8Array(r),u=new Uint8Array(this._buffer,0,a.length);a.set(u),this.buffer=r}},n.BIG_ENDIAN=!1,n.LITTLE_ENDIAN=!0,n.prototype._byteLength=0,Object.defineProperty(n.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(r){this._buffer=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(r){this._byteOffset=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"dataView",{get:function(){return this._dataView},set:function(r){this._byteOffset=r.byteOffset,this._buffer=r.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+r.byteLength}}),n.prototype.seek=function(r){var a=Math.max(0,Math.min(this.byteLength,r));this.position=isNaN(a)||!isFinite(a)?0:a},n.prototype.isEof=function(){return this.position>=this._byteLength},n.prototype.mapUint8Array=function(r){this._realloc(r*1);var a=new Uint8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.readInt32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Int32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Int16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt8Array=function(r){r=r??this.byteLength-this.position;var a=new Int8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readUint32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Uint32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Uint16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint8Array=function(r){r=r??this.byteLength-this.position;var a=new Uint8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readFloat64Array=function(r,a){r=r??this.byteLength-this.position/8;var u=new Float64Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readFloat32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Float32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt32=function(r){var a=this._dataView.getInt32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readInt16=function(r){var a=this._dataView.getInt16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readInt8=function(){var r=this._dataView.getInt8(this.position);return this.position+=1,r},n.prototype.readUint32=function(r){var a=this._dataView.getUint32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readUint16=function(r){var a=this._dataView.getUint16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readUint8=function(){var r=this._dataView.getUint8(this.position);return this.position+=1,r},n.prototype.readFloat32=function(r){var a=this._dataView.getFloat32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readFloat64=function(r){var a=this._dataView.getFloat64(this.position,r??this.endianness);return this.position+=8,a},n.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,n.memcpy=function(r,a,u,f,g){var x=new Uint8Array(r,a,g),S=new Uint8Array(u,f,g);x.set(S)},n.arrayToNative=function(r,a){return a==this.endianness?r:this.flipArrayEndianness(r)},n.nativeToEndian=function(r,a){return this.endianness==a?r:this.flipArrayEndianness(r)},n.flipArrayEndianness=function(r){for(var a=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),u=0;u<r.byteLength;u+=r.BYTES_PER_ELEMENT)for(var f=u+r.BYTES_PER_ELEMENT-1,g=u;f>g;f--,g++){var x=a[g];a[g]=a[f],a[f]=x}return r},n.prototype.failurePosition=0,String.fromCharCodeUint8=function(r){for(var a=[],u=0;u<r.length;u++)a[u]=r[u];return String.fromCharCode.apply(null,a)},n.prototype.readString=function(r,a){return a==null||a=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(r??this.byteLength-this.position)]):new TextDecoder(a).decode(this.mapUint8Array(r))},n.prototype.readCString=function(r){var a=this.byteLength-this.position,u=new Uint8Array(this._buffer,this._byteOffset+this.position),f=a;r!=null&&(f=Math.min(r,a));for(var g=0;g<f&&u[g]!==0;g++);var x=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(g)]);return r!=null?this.position+=f-g:g!=a&&(this.position+=1),x};var o=Math.pow(2,32);n.prototype.readInt64=function(){return this.readInt32()*o+this.readUint32()},n.prototype.readUint64=function(){return this.readUint32()*o+this.readUint32()},n.prototype.readInt64=function(){return this.readUint32()*o+this.readUint32()},n.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},s.DataStream=n,n.prototype.save=function(r){var a=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var u=window.URL.createObjectURL(a),f=document.createElement("a");document.body.appendChild(f),f.setAttribute("href",u),f.setAttribute("download",r),f.setAttribute("target","_self"),f.click(),window.URL.revokeObjectURL(u)}else throw"DataStream.save: Can't create object URL."},n.prototype._dynamicSize=!0,Object.defineProperty(n.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(r){r||this._trimAlloc(),this._dynamicSize=r}}),n.prototype.shift=function(r){var a=new ArrayBuffer(this._byteLength-r),u=new Uint8Array(a),f=new Uint8Array(this._buffer,r,u.length);u.set(f),this.buffer=a,this.position-=r},n.prototype.writeInt32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Int32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt32(r[u],a)},n.prototype.writeInt16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Int16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt16(r[u],a)},n.prototype.writeInt8Array=function(r){if(this._realloc(r.length*1),r instanceof Int8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt8Array(r.length);else for(var a=0;a<r.length;a++)this.writeInt8(r[a])},n.prototype.writeUint32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Uint32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint32(r[u],a)},n.prototype.writeUint16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Uint16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint16(r[u],a)},n.prototype.writeUint8Array=function(r){if(this._realloc(r.length*1),r instanceof Uint8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint8Array(r.length);else for(var a=0;a<r.length;a++)this.writeUint8(r[a])},n.prototype.writeFloat64Array=function(r,a){if(this._realloc(r.length*8),r instanceof Float64Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat64Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat64(r[u],a)},n.prototype.writeFloat32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Float32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat32(r[u],a)},n.prototype.writeInt32=function(r,a){this._realloc(4),this._dataView.setInt32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeInt16=function(r,a){this._realloc(2),this._dataView.setInt16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeInt8=function(r){this._realloc(1),this._dataView.setInt8(this.position,r),this.position+=1},n.prototype.writeUint32=function(r,a){this._realloc(4),this._dataView.setUint32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeUint16=function(r,a){this._realloc(2),this._dataView.setUint16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeUint8=function(r){this._realloc(1),this._dataView.setUint8(this.position,r),this.position+=1},n.prototype.writeFloat32=function(r,a){this._realloc(4),this._dataView.setFloat32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeFloat64=function(r,a){this._realloc(8),this._dataView.setFloat64(this.position,r,a??this.endianness),this.position+=8},n.prototype.writeUCS2String=function(r,a,u){u==null&&(u=r.length);for(var f=0;f<r.length&&f<u;f++)this.writeUint16(r.charCodeAt(f),a);for(;f<u;f++)this.writeUint16(0)},n.prototype.writeString=function(r,a,u){var f=0;if(a==null||a=="ASCII")if(u!=null){var g=Math.min(r.length,u);for(f=0;f<g;f++)this.writeUint8(r.charCodeAt(f));for(;f<u;f++)this.writeUint8(0)}else for(f=0;f<r.length;f++)this.writeUint8(r.charCodeAt(f));else this.writeUint8Array(new TextEncoder(a).encode(r.substring(0,u)))},n.prototype.writeCString=function(r,a){var u=0;if(a!=null){var f=Math.min(r.length,a);for(u=0;u<f;u++)this.writeUint8(r.charCodeAt(u));for(;u<a;u++)this.writeUint8(0)}else{for(u=0;u<r.length;u++)this.writeUint8(r.charCodeAt(u));this.writeUint8(0)}},n.prototype.writeStruct=function(r,a){for(var u=0;u<r.length;u+=2){var f=r[u+1];this.writeType(f,a[r[u]],a)}},n.prototype.writeType=function(r,a,u){var f;if(typeof r=="function")return r(this,a);if(typeof r=="object"&&!(r instanceof Array))return r.set(this,a,u);var g=null,x="ASCII",S=this.position;switch(typeof r=="string"&&/:/.test(r)&&(f=r.split(":"),r=f[0],g=parseInt(f[1])),typeof r=="string"&&/,/.test(r)&&(f=r.split(","),r=f[0],x=parseInt(f[1])),r){case"uint8":this.writeUint8(a);break;case"int8":this.writeInt8(a);break;case"uint16":this.writeUint16(a,this.endianness);break;case"int16":this.writeInt16(a,this.endianness);break;case"uint32":this.writeUint32(a,this.endianness);break;case"int32":this.writeInt32(a,this.endianness);break;case"float32":this.writeFloat32(a,this.endianness);break;case"float64":this.writeFloat64(a,this.endianness);break;case"uint16be":this.writeUint16(a,n.BIG_ENDIAN);break;case"int16be":this.writeInt16(a,n.BIG_ENDIAN);break;case"uint32be":this.writeUint32(a,n.BIG_ENDIAN);break;case"int32be":this.writeInt32(a,n.BIG_ENDIAN);break;case"float32be":this.writeFloat32(a,n.BIG_ENDIAN);break;case"float64be":this.writeFloat64(a,n.BIG_ENDIAN);break;case"uint16le":this.writeUint16(a,n.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(a,n.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(a,n.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(a,n.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(a,n.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(a,n.LITTLE_ENDIAN);break;case"cstring":this.writeCString(a,g);break;case"string":this.writeString(a,x,g);break;case"u16string":this.writeUCS2String(a,this.endianness,g);break;case"u16stringle":this.writeUCS2String(a,n.LITTLE_ENDIAN,g);break;case"u16stringbe":this.writeUCS2String(a,n.BIG_ENDIAN,g);break;default:if(r.length==3){for(var A=r[1],C=0;C<a.length;C++)this.writeType(A,a[C]);break}else{this.writeStruct(r,a);break}}g!=null&&(this.position=S,this._realloc(g),this.position=S+g)},n.prototype.writeUint64=function(r){var a=Math.floor(r/o);this.writeUint32(a),this.writeUint32(r&4294967295)},n.prototype.writeUint24=function(r){this.writeUint8((r&16711680)>>16),this.writeUint8((r&65280)>>8),this.writeUint8(r&255)},n.prototype.adjustUint32=function(r,a){var u=this.position;this.seek(r),this.writeUint32(a),this.seek(u)},n.prototype.mapInt32Array=function(r,a){this._realloc(r*4);var u=new Int32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapInt16Array=function(r,a){this._realloc(r*2);var u=new Int16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapInt8Array=function(r){this._realloc(r*1);var a=new Int8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.mapUint32Array=function(r,a){this._realloc(r*4);var u=new Uint32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapUint16Array=function(r,a){this._realloc(r*2);var u=new Uint16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapFloat64Array=function(r,a){this._realloc(r*8);var u=new Float64Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*8,u},n.prototype.mapFloat32Array=function(r,a){this._realloc(r*4);var u=new Float32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u};var h=function(r){this.buffers=[],this.bufferIndex=-1,r&&(this.insertBuffer(r),this.bufferIndex=0)};h.prototype=new n(new ArrayBuffer,0,n.BIG_ENDIAN),h.prototype.initialized=function(){var r;return this.bufferIndex>-1?!0:this.buffers.length>0?(r=this.buffers[0],r.fileStart===0?(this.buffer=r,this.bufferIndex=0,t.debug("MultiBufferStream","Stream ready for parsing"),!0):(t.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(t.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(r,a){t.debug("ArrayBuffer","Trying to create a new buffer of size: "+(r.byteLength+a.byteLength));var u=new Uint8Array(r.byteLength+a.byteLength);return u.set(new Uint8Array(r),0),u.set(new Uint8Array(a),r.byteLength),u.buffer},h.prototype.reduceBuffer=function(r,a,u){var f;return f=new Uint8Array(u),f.set(new Uint8Array(r,a,u)),f.buffer.fileStart=r.fileStart+a,f.buffer.usedBytes=0,f.buffer},h.prototype.insertBuffer=function(r){for(var a=!0,u=0;u<this.buffers.length;u++){var f=this.buffers[u];if(r.fileStart<=f.fileStart){if(r.fileStart===f.fileStart)if(r.byteLength>f.byteLength){this.buffers.splice(u,1),u--;continue}else t.warn("MultiBufferStream","Buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+") already appended, ignoring");else r.fileStart+r.byteLength<=f.fileStart||(r=this.reduceBuffer(r,0,f.fileStart-r.fileStart)),t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.splice(u,0,r),u===0&&(this.buffer=r);a=!1;break}else if(r.fileStart<f.fileStart+f.byteLength){var g=f.fileStart+f.byteLength-r.fileStart,x=r.byteLength-g;if(x>0)r=this.reduceBuffer(r,g,x);else{a=!1;break}}}a&&(t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.push(r),u===0&&(this.buffer=r))},h.prototype.logBufferLevel=function(r){var a,u,f,g,x=[],S,A="";for(f=0,g=0,a=0;a<this.buffers.length;a++)u=this.buffers[a],a===0?(S={},x.push(S),S.start=u.fileStart,S.end=u.fileStart+u.byteLength,A+="["+S.start+"-"):S.end===u.fileStart?S.end=u.fileStart+u.byteLength:(S={},S.start=u.fileStart,A+=x[x.length-1].end-1+"], ["+S.start+"-",S.end=u.fileStart+u.byteLength,x.push(S)),f+=u.usedBytes,g+=u.byteLength;x.length>0&&(A+=S.end-1+"]");var C=r?t.info:t.debug;this.buffers.length===0?C("MultiBufferStream","No more buffer in memory"):C("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+f+"/"+g+" bytes), continuous ranges: "+A)},h.prototype.cleanBuffers=function(){var r,a;for(r=0;r<this.buffers.length;r++)a=this.buffers[r],a.usedBytes===a.byteLength&&(t.debug("MultiBufferStream","Removing buffer #"+r),this.buffers.splice(r,1),r--)},h.prototype.mergeNextBuffer=function(){var r;if(this.bufferIndex+1<this.buffers.length)if(r=this.buffers[this.bufferIndex+1],r.fileStart===this.buffer.fileStart+this.buffer.byteLength){var a=this.buffer.byteLength,u=this.buffer.usedBytes,f=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,r),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=u,this.buffer.fileStart=f,t.debug("ISOFile","Concatenating buffer for box parsing (length: "+a+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},h.prototype.findPosition=function(r,a,u){var f,g=null,x=-1;for(r===!0?f=0:f=this.bufferIndex;f<this.buffers.length&&(g=this.buffers[f],g.fileStart<=a);){x=f,u&&(g.fileStart+g.byteLength<=a?g.usedBytes=g.byteLength:g.usedBytes=a-g.fileStart,this.logBufferLevel());f++}return x!==-1?(g=this.buffers[x],g.fileStart+g.byteLength>=a?(t.debug("MultiBufferStream","Found position in existing buffer #"+x),x):-1):-1},h.prototype.findEndContiguousBuf=function(r){var a,u,f,g=r!==void 0?r:this.bufferIndex;if(u=this.buffers[g],this.buffers.length>g+1)for(a=g+1;a<this.buffers.length&&(f=this.buffers[a],f.fileStart===u.fileStart+u.byteLength);a++)u=f;return u.fileStart+u.byteLength},h.prototype.getEndFilePositionAfter=function(r){var a=this.findPosition(!0,r,!1);return a!==-1?this.findEndContiguousBuf(a):r},h.prototype.addUsedBytes=function(r){this.buffer.usedBytes+=r,this.logBufferLevel()},h.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},h.prototype.seek=function(r,a,u){var f;return f=this.findPosition(a,r,u),f!==-1?(this.buffer=this.buffers[f],this.bufferIndex=f,this.position=r-this.buffer.fileStart,t.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(t.debug("MultiBufferStream","Position "+r+" not found in buffered data"),!1)},h.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},h.prototype.getLength=function(){return this.byteLength},h.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},s.MultiBufferStream=h;var d=function(){var r=3,a=4,u=5,f=6,g=[];g[r]="ES_Descriptor",g[a]="DecoderConfigDescriptor",g[u]="DecoderSpecificInfo",g[f]="SLConfigDescriptor",this.getDescriptorName=function(A){return g[A]};var x=this,S={};return this.parseOneDescriptor=function(A){var C=0,B,R,M;for(B=A.readUint8(),M=A.readUint8();M&128;)C=(M&127)<<7,M=A.readUint8();return C+=M&127,t.debug("MPEG4DescriptorParser","Found "+(g[B]||"Descriptor "+B)+", size "+C+" at position "+A.getPosition()),g[B]?R=new S[g[B]](C):R=new S.Descriptor(C),R.parse(A),R},S.Descriptor=function(A,C){this.tag=A,this.size=C,this.descs=[]},S.Descriptor.prototype.parse=function(A){this.data=A.readUint8Array(this.size)},S.Descriptor.prototype.findDescriptor=function(A){for(var C=0;C<this.descs.length;C++)if(this.descs[C].tag==A)return this.descs[C];return null},S.Descriptor.prototype.parseRemainingDescriptors=function(A){for(var C=A.position;A.position<C+this.size;){var B=x.parseOneDescriptor(A);this.descs.push(B)}},S.ES_Descriptor=function(A){S.Descriptor.call(this,r,A)},S.ES_Descriptor.prototype=new S.Descriptor,S.ES_Descriptor.prototype.parse=function(A){if(this.ES_ID=A.readUint16(),this.flags=A.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=A.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var C=A.readUint8();this.URL=A.readString(C),this.size-=C+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=A.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(A)},S.ES_Descriptor.prototype.getOTI=function(A){var C=this.findDescriptor(a);return C?C.oti:0},S.ES_Descriptor.prototype.getAudioConfig=function(A){var C=this.findDescriptor(a);if(!C)return null;var B=C.findDescriptor(u);if(B&&B.data){var R=(B.data[0]&248)>>3;return R===31&&B.data.length>=2&&(R=32+((B.data[0]&7)<<3)+((B.data[1]&224)>>5)),R}else return null},S.DecoderConfigDescriptor=function(A){S.Descriptor.call(this,a,A)},S.DecoderConfigDescriptor.prototype=new S.Descriptor,S.DecoderConfigDescriptor.prototype.parse=function(A){this.oti=A.readUint8(),this.streamType=A.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=A.readUint24(),this.maxBitrate=A.readUint32(),this.avgBitrate=A.readUint32(),this.size-=13,this.parseRemainingDescriptors(A)},S.DecoderSpecificInfo=function(A){S.Descriptor.call(this,u,A)},S.DecoderSpecificInfo.prototype=new S.Descriptor,S.SLConfigDescriptor=function(A){S.Descriptor.call(this,f,A)},S.SLConfigDescriptor.prototype=new S.Descriptor,this};s.MPEG4DescriptorParser=d;var l={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"],["grpl"],["j2kH"],["etyp",["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){l.FullBox.prototype=new l.Box,l.ContainerBox.prototype=new l.Box,l.SampleEntry.prototype=new l.Box,l.TrackGroupTypeBox.prototype=new l.FullBox,l.BASIC_BOXES.forEach(function(r){l.createBoxCtor(r)}),l.FULL_BOXES.forEach(function(r){l.createFullBoxCtor(r)}),l.CONTAINER_BOXES.forEach(function(r){l.createContainerBoxCtor(r[0],null,r[1])})},Box:function(r,a,u){this.type=r,this.size=a,this.uuid=u},FullBox:function(r,a,u){l.Box.call(this,r,a,u),this.flags=0,this.version=0},ContainerBox:function(r,a,u){l.Box.call(this,r,a,u),this.boxes=[]},SampleEntry:function(r,a,u,f){l.ContainerBox.call(this,r,a),this.hdr_size=u,this.start=f},SampleGroupEntry:function(r){this.grouping_type=r},TrackGroupTypeBox:function(r,a){l.FullBox.call(this,r,a)},createBoxCtor:function(r,a){l.boxCodes.push(r),l[r+"Box"]=function(u){l.Box.call(this,r,u)},l[r+"Box"].prototype=new l.Box,a&&(l[r+"Box"].prototype.parse=a)},createFullBoxCtor:function(r,a){l[r+"Box"]=function(u){l.FullBox.call(this,r,u)},l[r+"Box"].prototype=new l.FullBox,l[r+"Box"].prototype.parse=function(u){this.parseFullHeader(u),a&&a.call(this,u)}},addSubBoxArrays:function(r){if(r){this.subBoxNames=r;for(var a=r.length,u=0;u<a;u++)this[r[u]+"s"]=[]}},createContainerBoxCtor:function(r,a,u){l[r+"Box"]=function(f){l.ContainerBox.call(this,r,f),l.addSubBoxArrays.call(this,u)},l[r+"Box"].prototype=new l.ContainerBox,a&&(l[r+"Box"].prototype.parse=a)},createMediaSampleEntryCtor:function(r,a,u){l.sampleEntryCodes[r]=[],l[r+"SampleEntry"]=function(f,g){l.SampleEntry.call(this,f,g),l.addSubBoxArrays.call(this,u)},l[r+"SampleEntry"].prototype=new l.SampleEntry,a&&(l[r+"SampleEntry"].prototype.parse=a)},createSampleEntryCtor:function(r,a,u,f){l.sampleEntryCodes[r].push(a),l[a+"SampleEntry"]=function(g){l[r+"SampleEntry"].call(this,a,g),l.addSubBoxArrays.call(this,f)},l[a+"SampleEntry"].prototype=new l[r+"SampleEntry"],u&&(l[a+"SampleEntry"].prototype.parse=u)},createEncryptedSampleEntryCtor:function(r,a,u){l.createSampleEntryCtor.call(this,r,a,u,["sinf"])},createSampleGroupCtor:function(r,a){l[r+"SampleGroupEntry"]=function(u){l.SampleGroupEntry.call(this,r,u)},l[r+"SampleGroupEntry"].prototype=new l.SampleGroupEntry,a&&(l[r+"SampleGroupEntry"].prototype.parse=a)},createTrackGroupCtor:function(r,a){l[r+"TrackGroupTypeBox"]=function(u){l.TrackGroupTypeBox.call(this,r,u)},l[r+"TrackGroupTypeBox"].prototype=new l.TrackGroupTypeBox,a&&(l[r+"TrackGroupTypeBox"].prototype.parse=a)},createUUIDBox:function(r,a,u,f){l.UUIDs.push(r),l.UUIDBoxes[r]=function(g){a?l.FullBox.call(this,"uuid",g,r):u?l.ContainerBox.call(this,"uuid",g,r):l.Box.call(this,"uuid",g,r)},l.UUIDBoxes[r].prototype=a?new l.FullBox:u?new l.ContainerBox:new l.Box,f&&(a?l.UUIDBoxes[r].prototype.parse=function(g){this.parseFullHeader(g),f&&f.call(this,g)}:l.UUIDBoxes[r].prototype.parse=f)}};l.initialize(),l.TKHD_FLAG_ENABLED=1,l.TKHD_FLAG_IN_MOVIE=2,l.TKHD_FLAG_IN_PREVIEW=4,l.TFHD_FLAG_BASE_DATA_OFFSET=1,l.TFHD_FLAG_SAMPLE_DESC=2,l.TFHD_FLAG_SAMPLE_DUR=8,l.TFHD_FLAG_SAMPLE_SIZE=16,l.TFHD_FLAG_SAMPLE_FLAGS=32,l.TFHD_FLAG_DUR_EMPTY=65536,l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,l.TRUN_FLAGS_DATA_OFFSET=1,l.TRUN_FLAGS_FIRST_FLAG=4,l.TRUN_FLAGS_DURATION=256,l.TRUN_FLAGS_SIZE=512,l.TRUN_FLAGS_FLAGS=1024,l.TRUN_FLAGS_CTS_OFFSET=2048,l.Box.prototype.add=function(r){return this.addBox(new l[r+"Box"])},l.Box.prototype.addBox=function(r){return this.boxes.push(r),this[r.type+"s"]?this[r.type+"s"].push(r):this[r.type]=r,r},l.Box.prototype.set=function(r,a){return this[r]=a,this},l.Box.prototype.addEntry=function(r,a){var u=a||"entries";return this[u]||(this[u]=[]),this[u].push(r),this},s.BoxParser=l,l.parseUUID=function(r){return l.parseHex16(r)},l.parseHex16=function(r){for(var a="",u=0;u<16;u++){var f=r.readUint8().toString(16);a+=f.length===1?"0"+f:f}return a},l.parseOneBox=function(r,a,u){var f,g=r.getPosition(),x=0,S,A;if(r.getEndPosition()-g<8)return t.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:l.ERR_NOT_ENOUGH_DATA};if(u&&u<8)return t.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:l.ERR_NOT_ENOUGH_DATA};var C=r.readUint32(),B=r.readString(4),R=B;if(t.debug("BoxParser","Found box of type '"+B+"' and size "+C+" at position "+g),x=8,B=="uuid"){if(r.getEndPosition()-r.getPosition()<16||u-x<16)return r.seek(g),t.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:l.ERR_NOT_ENOUGH_DATA};A=l.parseUUID(r),x+=16,R=A}if(C==1){if(r.getEndPosition()-r.getPosition()<8||u&&u-x<8)return r.seek(g),t.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+B+'" box'),{code:l.ERR_NOT_ENOUGH_DATA};C=r.readUint64(),x+=8}else if(C===0){if(u)C=u;else if(B!=="mdat")return t.error("BoxParser","Unlimited box size not supported for type: '"+B+"'"),f=new l.Box(B,C),{code:l.OK,box:f,size:f.size}}return C!==0&&C<x?(t.error("BoxParser","Box of type "+B+" has an invalid size "+C+" (too small to be a box)"),{code:l.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:x,start:g}):C!==0&&u&&C>u?(t.error("BoxParser","Box of type '"+B+"' has a size "+C+" greater than its container size "+u),{code:l.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:x,start:g}):C!==0&&g+C>r.getEndPosition()?(r.seek(g),t.info("BoxParser","Not enough data in stream to parse the entire '"+B+"' box"),{code:l.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:x,start:g}):a?{code:l.OK,type:B,size:C,hdr_size:x,start:g}:(l[B+"Box"]?f=new l[B+"Box"](C):B!=="uuid"?(t.warn("BoxParser","Unknown box type: '"+B+"'"),f=new l.Box(B,C),f.has_unparsed_data=!0):l.UUIDBoxes[A]?f=new l.UUIDBoxes[A](C):(t.warn("BoxParser","Unknown uuid type: '"+A+"'"),f=new l.Box(B,C),f.uuid=A,f.has_unparsed_data=!0),f.hdr_size=x,f.start=g,f.write===l.Box.prototype.write&&f.type!=="mdat"&&(t.info("BoxParser","'"+R+"' box writing not yet implemented, keeping unparsed data in memory for later write"),f.parseDataAndRewind(r)),f.parse(r),S=r.getPosition()-(f.start+f.size),S<0?(t.warn("BoxParser","Parsing of box '"+R+"' did not read the entire indicated box data size (missing "+-S+" bytes), seeking forward"),r.seek(f.start+f.size)):S>0&&(t.error("BoxParser","Parsing of box '"+R+"' read "+S+" more bytes than the indicated box data size, seeking backwards"),f.size!==0&&r.seek(f.start+f.size)),{code:l.OK,box:f,size:f.size})},l.Box.prototype.parse=function(r){this.type!="mdat"?this.data=r.readUint8Array(this.size-this.hdr_size):this.size===0?r.seek(r.getEndPosition()):r.seek(this.start+this.size)},l.Box.prototype.parseDataAndRewind=function(r){this.data=r.readUint8Array(this.size-this.hdr_size),r.position-=this.size-this.hdr_size},l.FullBox.prototype.parseDataAndRewind=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,r.position-=this.size-this.hdr_size},l.FullBox.prototype.parseFullHeader=function(r){this.version=r.readUint8(),this.flags=r.readUint24(),this.hdr_size+=4},l.FullBox.prototype.parse=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},l.ContainerBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===l.OK)if(u=a.box,this.boxes.push(u),this.subBoxNames&&this.subBoxNames.indexOf(u.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(u.type)]+"s"].push(u);else{var f=u.type!=="uuid"?u.type:u.uuid;this[f]?t.warn("Box of type "+f+" already stored in field of this type"):this[f]=u}else return},l.Box.prototype.parseLanguage=function(r){this.language=r.readUint16();var a=[];a[0]=this.language>>10&31,a[1]=this.language>>5&31,a[2]=this.language&31,this.languageString=String.fromCharCode(a[0]+96,a[1]+96,a[2]+96)},l.SAMPLE_ENTRY_TYPE_VISUAL="Visual",l.SAMPLE_ENTRY_TYPE_AUDIO="Audio",l.SAMPLE_ENTRY_TYPE_HINT="Hint",l.SAMPLE_ENTRY_TYPE_METADATA="Metadata",l.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",l.SAMPLE_ENTRY_TYPE_SYSTEM="System",l.SAMPLE_ENTRY_TYPE_TEXT="Text",l.SampleEntry.prototype.parseHeader=function(r){r.readUint8Array(6),this.data_reference_index=r.readUint16(),this.hdr_size+=8},l.SampleEntry.prototype.parse=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},l.SampleEntry.prototype.parseDataAndRewind=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,r.position-=this.size-this.hdr_size},l.SampleEntry.prototype.parseFooter=function(r){l.ContainerBox.prototype.parse.call(this,r)},l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_HINT),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SYSTEM),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_TEXT),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,function(r){var a;this.parseHeader(r),r.readUint16(),r.readUint16(),r.readUint32Array(3),this.width=r.readUint16(),this.height=r.readUint16(),this.horizresolution=r.readUint32(),this.vertresolution=r.readUint32(),r.readUint32(),this.frame_count=r.readUint16(),a=Math.min(31,r.readUint8()),this.compressorname=r.readString(a),a<31&&r.readString(31-a),this.depth=r.readUint16(),r.readUint16(),this.parseFooter(r)}),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,function(r){this.parseHeader(r),r.readUint32Array(2),this.channel_count=r.readUint16(),this.samplesize=r.readUint16(),r.readUint16(),r.readUint16(),this.samplerate=r.readUint32()/65536,this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_TEXT,"enct"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"encm"),l.createBoxCtor("a1lx",function(r){var a=r.readUint8()&1,u=((a&1)+1)*16;this.layer_size=[];for(var f=0;f<3;f++)u==16?this.layer_size[f]=r.readUint16():this.layer_size[f]=r.readUint32()}),l.createBoxCtor("a1op",function(r){this.op_index=r.readUint8()}),l.createFullBoxCtor("auxC",function(r){this.aux_type=r.readCString();var a=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=r.readUint8Array(a)}),l.createBoxCtor("av1C",function(r){var a=r.readUint8();if(a>>7&!1){t.error("av1C marker problem");return}if(this.version=a&127,this.version!==1){t.error("av1C version "+this.version+" not supported");return}if(a=r.readUint8(),this.seq_profile=a>>5&7,this.seq_level_idx_0=a&31,a=r.readUint8(),this.seq_tier_0=a>>7&1,this.high_bitdepth=a>>6&1,this.twelve_bit=a>>5&1,this.monochrome=a>>4&1,this.chroma_subsampling_x=a>>3&1,this.chroma_subsampling_y=a>>2&1,this.chroma_sample_position=a&3,a=r.readUint8(),this.reserved_1=a>>5&7,this.reserved_1!==0){t.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=a>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=a&15;else if(this.reserved_2=a&15,this.reserved_2!==0){t.error("av1C reserved_2 parsing problem");return}var u=this.size-this.hdr_size-4;this.configOBUs=r.readUint8Array(u)}),l.createBoxCtor("avcC",function(r){var a,u;for(this.configurationVersion=r.readUint8(),this.AVCProfileIndication=r.readUint8(),this.profile_compatibility=r.readUint8(),this.AVCLevelIndication=r.readUint8(),this.lengthSizeMinusOne=r.readUint8()&3,this.nb_SPS_nalus=r.readUint8()&31,u=this.size-this.hdr_size-6,this.SPS=[],a=0;a<this.nb_SPS_nalus;a++)this.SPS[a]={},this.SPS[a].length=r.readUint16(),this.SPS[a].nalu=r.readUint8Array(this.SPS[a].length),u-=2+this.SPS[a].length;for(this.nb_PPS_nalus=r.readUint8(),u--,this.PPS=[],a=0;a<this.nb_PPS_nalus;a++)this.PPS[a]={},this.PPS[a].length=r.readUint16(),this.PPS[a].nalu=r.readUint8Array(this.PPS[a].length),u-=2+this.PPS[a].length;u>0&&(this.ext=r.readUint8Array(u))}),l.createBoxCtor("btrt",function(r){this.bufferSizeDB=r.readUint32(),this.maxBitrate=r.readUint32(),this.avgBitrate=r.readUint32()}),l.createFullBoxCtor("ccst",function(r){var a=r.readUint8();this.all_ref_pics_intra=(a&128)==128,this.intra_pred_used=(a&64)==64,this.max_ref_per_pic=(a&63)>>2,r.readUint24()}),l.createBoxCtor("cdef",function(r){var a;for(this.channel_count=r.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],a=0;a<this.channel_count;a++)this.channel_indexes.push(r.readUint16()),this.channel_types.push(r.readUint16()),this.channel_associations.push(r.readUint16())}),l.createBoxCtor("clap",function(r){this.cleanApertureWidthN=r.readUint32(),this.cleanApertureWidthD=r.readUint32(),this.cleanApertureHeightN=r.readUint32(),this.cleanApertureHeightD=r.readUint32(),this.horizOffN=r.readUint32(),this.horizOffD=r.readUint32(),this.vertOffN=r.readUint32(),this.vertOffD=r.readUint32()}),l.createBoxCtor("clli",function(r){this.max_content_light_level=r.readUint16(),this.max_pic_average_light_level=r.readUint16()}),l.createFullBoxCtor("cmex",function(r){this.flags&1&&(this.pos_x=r.readInt32()),this.flags&2&&(this.pos_y=r.readInt32()),this.flags&4&&(this.pos_z=r.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=r.readInt32(),this.quat_y=r.readInt32(),this.quat_z=r.readInt32()):(this.quat_x=r.readInt16(),this.quat_y=r.readInt16(),this.quat_z=r.readInt16()):this.version==1),this.flags&32&&(this.id=r.readUint32())}),l.createFullBoxCtor("cmin",function(r){this.focal_length_x=r.readInt32(),this.principal_point_x=r.readInt32(),this.principal_point_y=r.readInt32(),this.flags&1&&(this.focal_length_y=r.readInt32(),this.skew_factor=r.readInt32())}),l.createBoxCtor("cmpd",function(r){for(this.component_count=r.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var a=r.readUint16();this.component_types.push(a),a>=32768&&this.component_type_urls.push(r.readCString())}}),l.createFullBoxCtor("co64",function(r){var a,u;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(u=0;u<a;u++)this.chunk_offsets.push(r.readUint64())}),l.createFullBoxCtor("CoLL",function(r){this.maxCLL=r.readUint16(),this.maxFALL=r.readUint16()}),l.createBoxCtor("colr",function(r){if(this.colour_type=r.readString(4),this.colour_type==="nclx"){this.colour_primaries=r.readUint16(),this.transfer_characteristics=r.readUint16(),this.matrix_coefficients=r.readUint16();var a=r.readUint8();this.full_range_flag=a>>7}else this.colour_type==="rICC"?this.ICC_profile=r.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=r.readUint8Array(this.size-4))}),l.createFullBoxCtor("cprt",function(r){this.parseLanguage(r),this.notice=r.readCString()}),l.createFullBoxCtor("cslg",function(r){this.version===0&&(this.compositionToDTSShift=r.readInt32(),this.leastDecodeToDisplayDelta=r.readInt32(),this.greatestDecodeToDisplayDelta=r.readInt32(),this.compositionStartTime=r.readInt32(),this.compositionEndTime=r.readInt32())}),l.createFullBoxCtor("ctts",function(r){var a,u;if(a=r.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(u=0;u<a;u++){this.sample_counts.push(r.readUint32());var f=r.readInt32();f<0&&t.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(f)}else if(this.version==1)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),this.sample_offsets.push(r.readInt32())}),l.createBoxCtor("dac3",function(r){var a=r.readUint8(),u=r.readUint8(),f=r.readUint8();this.fscod=a>>6,this.bsid=a>>1&31,this.bsmod=(a&1)<<2|u>>6&3,this.acmod=u>>3&7,this.lfeon=u>>2&1,this.bit_rate_code=u&3|f>>5&7}),l.createBoxCtor("dec3",function(r){var a=r.readUint16();this.data_rate=a>>3,this.num_ind_sub=a&7,this.ind_subs=[];for(var u=0;u<this.num_ind_sub+1;u++){var f={};this.ind_subs.push(f);var g=r.readUint8(),x=r.readUint8(),S=r.readUint8();f.fscod=g>>6,f.bsid=g>>1&31,f.bsmod=(g&1)<<4|x>>4&15,f.acmod=x>>1&7,f.lfeon=x&1,f.num_dep_sub=S>>1&15,f.num_dep_sub>0&&(f.chan_loc=(S&1)<<8|r.readUint8())}}),l.createFullBoxCtor("dfLa",function(r){var a=127,u=128,f=[],g=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var x=r.readUint8(),S=Math.min(x&a,g.length-1);if(S?r.readUint8Array(r.readUint24()):(r.readUint8Array(13),this.samplerate=r.readUint32()>>12,r.readUint8Array(20)),f.push(g[S]),x&u)break}while(!0);this.numMetadataBlocks=f.length+" ("+f.join(", ")+")"}),l.createBoxCtor("dimm",function(r){this.bytessent=r.readUint64()}),l.createBoxCtor("dmax",function(r){this.time=r.readUint32()}),l.createBoxCtor("dmed",function(r){this.bytessent=r.readUint64()}),l.createBoxCtor("dOps",function(r){if(this.Version=r.readUint8(),this.OutputChannelCount=r.readUint8(),this.PreSkip=r.readUint16(),this.InputSampleRate=r.readUint32(),this.OutputGain=r.readInt16(),this.ChannelMappingFamily=r.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=r.readUint8(),this.CoupledCount=r.readUint8(),this.ChannelMapping=[];for(var a=0;a<this.OutputChannelCount;a++)this.ChannelMapping[a]=r.readUint8()}}),l.createFullBoxCtor("dref",function(r){var a,u;this.entries=[];for(var f=r.readUint32(),g=0;g<f;g++)if(a=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===l.OK)u=a.box,this.entries.push(u);else return}),l.createBoxCtor("drep",function(r){this.bytessent=r.readUint64()}),l.createFullBoxCtor("elng",function(r){this.extended_language=r.readString(this.size-this.hdr_size)}),l.createFullBoxCtor("elst",function(r){this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),this.version===1?(f.segment_duration=r.readUint64(),f.media_time=r.readInt64()):(f.segment_duration=r.readUint32(),f.media_time=r.readInt32()),f.media_rate_integer=r.readInt16(),f.media_rate_fraction=r.readInt16()}}),l.createFullBoxCtor("emsg",function(r){this.version==1?(this.timescale=r.readUint32(),this.presentation_time=r.readUint64(),this.event_duration=r.readUint32(),this.id=r.readUint32(),this.scheme_id_uri=r.readCString(),this.value=r.readCString()):(this.scheme_id_uri=r.readCString(),this.value=r.readCString(),this.timescale=r.readUint32(),this.presentation_time_delta=r.readUint32(),this.event_duration=r.readUint32(),this.id=r.readUint32());var a=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(a-=4),this.message_data=r.readUint8Array(a)}),l.createEntityToGroupCtor=function(r,a){l[r+"Box"]=function(u){l.FullBox.call(this,r,u)},l[r+"Box"].prototype=new l.FullBox,l[r+"Box"].prototype.parse=function(u){if(this.parseFullHeader(u),a)a.call(this,u);else for(this.group_id=u.readUint32(),this.num_entities_in_group=u.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var f=u.readUint32();this.entity_ids.push(f)}}},l.createEntityToGroupCtor("aebr"),l.createEntityToGroupCtor("afbr"),l.createEntityToGroupCtor("albc"),l.createEntityToGroupCtor("altr"),l.createEntityToGroupCtor("brst"),l.createEntityToGroupCtor("dobr"),l.createEntityToGroupCtor("eqiv"),l.createEntityToGroupCtor("favc"),l.createEntityToGroupCtor("fobr"),l.createEntityToGroupCtor("iaug"),l.createEntityToGroupCtor("pano"),l.createEntityToGroupCtor("slid"),l.createEntityToGroupCtor("ster"),l.createEntityToGroupCtor("tsyn"),l.createEntityToGroupCtor("wbbr"),l.createEntityToGroupCtor("prgr"),l.createEntityToGroupCtor("pymd",function(r){this.group_id=r.readUint32(),this.num_entities_in_group=r.readUint32(),this.entity_ids=[];for(var a=0;a<this.num_entities_in_group;a++){var u=r.readUint32();this.entity_ids.push(u)}for(this.tile_size_x=r.readUint16(),this.tile_size_y=r.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],a=0;a<this.num_entities_in_group;a++)this.layer_binning[a]=r.readUint16(),this.tiles_in_layer_row_minus1[a]=r.readUint16(),this.tiles_in_layer_column_minus1[a]=r.readUint16()}),l.createFullBoxCtor("esds",function(r){var a=r.readUint8Array(this.size-this.hdr_size);if(this.data=a,typeof d<"u"){var u=new d;this.esd=u.parseOneDescriptor(new n(a.buffer,0,n.BIG_ENDIAN))}}),l.createBoxCtor("fiel",function(r){this.fieldCount=r.readUint8(),this.fieldOrdering=r.readUint8()}),l.createBoxCtor("frma",function(r){this.data_format=r.readString(4)}),l.createBoxCtor("ftyp",function(r){var a=this.size-this.hdr_size;this.major_brand=r.readString(4),this.minor_version=r.readUint32(),a-=8,this.compatible_brands=[];for(var u=0;a>=4;)this.compatible_brands[u]=r.readString(4),a-=4,u++}),l.createFullBoxCtor("hdlr",function(r){this.version===0&&(r.readUint32(),this.handler=r.readString(4),r.readUint32Array(3),this.name=r.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),l.createBoxCtor("hvcC",function(r){var a,u,f,g;this.configurationVersion=r.readUint8(),g=r.readUint8(),this.general_profile_space=g>>6,this.general_tier_flag=(g&32)>>5,this.general_profile_idc=g&31,this.general_profile_compatibility=r.readUint32(),this.general_constraint_indicator=r.readUint8Array(6),this.general_level_idc=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,this.chroma_format_idc=r.readUint8()&3,this.bit_depth_luma_minus8=r.readUint8()&7,this.bit_depth_chroma_minus8=r.readUint8()&7,this.avgFrameRate=r.readUint16(),g=r.readUint8(),this.constantFrameRate=g>>6,this.numTemporalLayers=(g&13)>>3,this.temporalIdNested=(g&4)>>2,this.lengthSizeMinusOne=g&3,this.nalu_arrays=[];var x=r.readUint8();for(a=0;a<x;a++){var S=[];this.nalu_arrays.push(S),g=r.readUint8(),S.completeness=(g&128)>>7,S.nalu_type=g&63;var A=r.readUint16();for(u=0;u<A;u++){var C={};S.push(C),f=r.readUint16(),C.data=r.readUint8Array(f)}}}),l.createFullBoxCtor("iinf",function(r){var a;this.version===0?this.entry_count=r.readUint16():this.entry_count=r.readUint32(),this.item_infos=[];for(var u=0;u<this.entry_count;u++)if(a=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===l.OK)a.box.type!=="infe"&&t.error("BoxParser","Expected 'infe' box, got "+a.box.type),this.item_infos[u]=a.box;else return}),l.createFullBoxCtor("iloc",function(r){var a;a=r.readUint8(),this.offset_size=a>>4&15,this.length_size=a&15,a=r.readUint8(),this.base_offset_size=a>>4&15,this.version===1||this.version===2?this.index_size=a&15:this.index_size=0,this.items=[];var u=0;if(this.version<2)u=r.readUint16();else if(this.version===2)u=r.readUint32();else throw"version of iloc box not supported";for(var f=0;f<u;f++){var g={};if(this.items.push(g),this.version<2)g.item_ID=r.readUint16();else if(this.version===2)g.item_ID=r.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?g.construction_method=r.readUint16()&15:g.construction_method=0,g.data_reference_index=r.readUint16(),this.base_offset_size){case 0:g.base_offset=0;break;case 4:g.base_offset=r.readUint32();break;case 8:g.base_offset=r.readUint64();break;default:throw"Error reading base offset size"}var x=r.readUint16();g.extents=[];for(var S=0;S<x;S++){var A={};if(g.extents.push(A),this.version===1||this.version===2)switch(this.index_size){case 0:A.extent_index=0;break;case 4:A.extent_index=r.readUint32();break;case 8:A.extent_index=r.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:A.extent_offset=0;break;case 4:A.extent_offset=r.readUint32();break;case 8:A.extent_offset=r.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:A.extent_length=0;break;case 4:A.extent_length=r.readUint32();break;case 8:A.extent_length=r.readUint64();break;default:throw"Error reading extent index"}}}}),l.createBoxCtor("imir",function(r){var a=r.readUint8();this.reserved=a>>7,this.axis=a&1}),l.createFullBoxCtor("infe",function(r){if((this.version===0||this.version===1)&&(this.item_ID=r.readUint16(),this.item_protection_index=r.readUint16(),this.item_name=r.readCString(),this.content_type=r.readCString(),this.content_encoding=r.readCString()),this.version===1){this.extension_type=r.readString(4),t.warn("BoxParser","Cannot parse extension type"),r.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=r.readUint16():this.version===3&&(this.item_ID=r.readUint32()),this.item_protection_index=r.readUint16(),this.item_type=r.readString(4),this.item_name=r.readCString(),this.item_type==="mime"?(this.content_type=r.readCString(),this.content_encoding=r.readCString()):this.item_type==="uri "&&(this.item_uri_type=r.readCString()))}),l.createFullBoxCtor("ipma",function(r){var a,u;for(entry_count=r.readUint32(),this.associations=[],a=0;a<entry_count;a++){var f={};this.associations.push(f),this.version<1?f.id=r.readUint16():f.id=r.readUint32();var g=r.readUint8();for(f.props=[],u=0;u<g;u++){var x=r.readUint8(),S={};f.props.push(S),S.essential=(x&128)>>7===1,this.flags&1?S.property_index=(x&127)<<8|r.readUint8():S.property_index=x&127}}}),l.createFullBoxCtor("iref",function(r){var a,u;for(this.references=[];r.getPosition()<this.start+this.size;)if(a=l.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===l.OK)this.version===0?u=new l.SingleItemTypeReferenceBox(a.type,a.size,a.hdr_size,a.start):u=new l.SingleItemTypeReferenceBoxLarge(a.type,a.size,a.hdr_size,a.start),u.write===l.Box.prototype.write&&u.type!=="mdat"&&(t.warn("BoxParser",u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.references.push(u);else return}),l.createBoxCtor("irot",function(r){this.angle=r.readUint8()&3}),l.createFullBoxCtor("ispe",function(r){this.image_width=r.readUint32(),this.image_height=r.readUint32()}),l.createFullBoxCtor("kind",function(r){this.schemeURI=r.readCString(),this.value=r.readCString()}),l.createFullBoxCtor("leva",function(r){var a=r.readUint8();this.levels=[];for(var u=0;u<a;u++){var f={};this.levels[u]=f,f.track_ID=r.readUint32();var g=r.readUint8();switch(f.padding_flag=g>>7,f.assignment_type=g&127,f.assignment_type){case 0:f.grouping_type=r.readString(4);break;case 1:f.grouping_type=r.readString(4),f.grouping_type_parameter=r.readUint32();break;case 2:break;case 3:break;case 4:f.sub_track_id=r.readUint32();break;default:t.warn("BoxParser","Unknown leva assignement type")}}}),l.createBoxCtor("lhvC",function(r){var a,u,f;this.configurationVersion=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,f=r.readUint8(),this.numTemporalLayers=(f&13)>>3,this.temporalIdNested=(f&4)>>2,this.lengthSizeMinusOne=f&3,this.nalu_arrays=[];var g=r.readUint8();for(a=0;a<g;a++){var x=[];this.nalu_arrays.push(x),f=r.readUint8(),x.completeness=(f&128)>>7,x.nalu_type=f&63;var S=r.readUint16();for(u=0;u<S;u++){var A={};x.push(A);var C=r.readUint16();A.data=r.readUint8Array(C)}}}),l.createBoxCtor("lsel",function(r){this.layer_id=r.readUint16()}),l.createBoxCtor("maxr",function(r){this.period=r.readUint32(),this.bytes=r.readUint32()});function _(r,a){this.x=r,this.y=a}_.prototype.toString=function(){return"("+this.x+","+this.y+")"},l.createBoxCtor("mdcv",function(r){this.display_primaries=[],this.display_primaries[0]=new _(r.readUint16(),r.readUint16()),this.display_primaries[1]=new _(r.readUint16(),r.readUint16()),this.display_primaries[2]=new _(r.readUint16(),r.readUint16()),this.white_point=new _(r.readUint16(),r.readUint16()),this.max_display_mastering_luminance=r.readUint32(),this.min_display_mastering_luminance=r.readUint32()}),l.createFullBoxCtor("mdhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.parseLanguage(r),r.readUint16()}),l.createFullBoxCtor("mehd",function(r){this.flags&1&&(t.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=r.readUint64():this.fragment_duration=r.readUint32()}),l.createFullBoxCtor("meta",function(r){this.boxes=[],l.ContainerBox.prototype.parse.call(this,r)}),l.createFullBoxCtor("mfhd",function(r){this.sequence_number=r.readUint32()}),l.createFullBoxCtor("mfro",function(r){this._size=r.readUint32()}),l.createFullBoxCtor("mskC",function(r){this.bits_per_pixel=r.readUint8()}),l.createFullBoxCtor("mvhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.rate=r.readUint32(),this.volume=r.readUint16()>>8,r.readUint16(),r.readUint32Array(2),this.matrix=r.readUint32Array(9),r.readUint32Array(6),this.next_track_id=r.readUint32()}),l.createBoxCtor("npck",function(r){this.packetssent=r.readUint32()}),l.createBoxCtor("nump",function(r){this.packetssent=r.readUint64()}),l.createFullBoxCtor("padb",function(r){var a=r.readUint32();this.padbits=[];for(var u=0;u<Math.floor((a+1)/2);u++)this.padbits=r.readUint8()}),l.createBoxCtor("pasp",function(r){this.hSpacing=r.readUint32(),this.vSpacing=r.readUint32()}),l.createBoxCtor("payl",function(r){this.text=r.readString(this.size-this.hdr_size)}),l.createBoxCtor("payt",function(r){this.payloadID=r.readUint32();var a=r.readUint8();this.rtpmap_string=r.readString(a)}),l.createFullBoxCtor("pdin",function(r){var a=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var u=0;u<a;u++)this.rate[u]=r.readUint32(),this.initial_delay[u]=r.readUint32()}),l.createFullBoxCtor("pitm",function(r){this.version===0?this.item_id=r.readUint16():this.item_id=r.readUint32()}),l.createFullBoxCtor("pixi",function(r){var a;for(this.num_channels=r.readUint8(),this.bits_per_channels=[],a=0;a<this.num_channels;a++)this.bits_per_channels[a]=r.readUint8()}),l.createBoxCtor("pmax",function(r){this.bytes=r.readUint32()}),l.createFullBoxCtor("prdi",function(r){if(this.step_count=r.readUint16(),this.item_count=[],this.flags&2)for(var a=0;a<this.step_count;a++)this.item_count[a]=r.readUint16()}),l.createFullBoxCtor("prft",function(r){this.ref_track_id=r.readUint32(),this.ntp_timestamp=r.readUint64(),this.version===0?this.media_time=r.readUint32():this.media_time=r.readUint64()}),l.createFullBoxCtor("pssh",function(r){if(this.system_id=l.parseHex16(r),this.version>0){var a=r.readUint32();this.kid=[];for(var u=0;u<a;u++)this.kid[u]=l.parseHex16(r)}var f=r.readUint32();f>0&&(this.data=r.readUint8Array(f))}),l.createFullBoxCtor("clef",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),l.createFullBoxCtor("enof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),l.createFullBoxCtor("prof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),l.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),l.createBoxCtor("rtp ",function(r){this.descriptionformat=r.readString(4),this.sdptext=r.readString(this.size-this.hdr_size-4)}),l.createFullBoxCtor("saio",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32());var a=r.readUint32();this.offset=[];for(var u=0;u<a;u++)this.version===0?this.offset[u]=r.readUint32():this.offset[u]=r.readUint64()}),l.createFullBoxCtor("saiz",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32()),this.default_sample_info_size=r.readUint8();var a=r.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var u=0;u<a;u++)this.sample_info_size[u]=r.readUint8()}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(r){this.parseHeader(r),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.auxiliary_mime_types=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(r){this.parseHeader(r),this.displayFlags=r.readUint32(),this.horizontal_justification=r.readInt8(),this.vertical_justification=r.readInt8(),this.bg_color_rgba=r.readUint8Array(4),this.box_record=r.readInt16Array(4),this.style_record=r.readUint8Array(12),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(r){this.parseHeader(r),this.parseFooter(r)}),l.createSampleGroupCtor("alst",function(r){var a,u=r.readUint16();for(this.first_output_sample=r.readUint16(),this.sample_offset=[],a=0;a<u;a++)this.sample_offset[a]=r.readUint32();var f=this.description_length-4-4*u;for(this.num_output_samples=[],this.num_total_samples=[],a=0;a<f/4;a++)this.num_output_samples[a]=r.readUint16(),this.num_total_samples[a]=r.readUint16()}),l.createSampleGroupCtor("avll",function(r){this.layerNumber=r.readUint8(),this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()}),l.createSampleGroupCtor("avss",function(r){this.subSequenceIdentifier=r.readUint16(),this.layerNumber=r.readUint8();var a=r.readUint8();this.durationFlag=a>>7,this.avgRateFlag=a>>6&1,this.durationFlag&&(this.duration=r.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()),this.dependency=[];for(var u=r.readUint8(),f=0;f<u;f++){var g={};this.dependency.push(g),g.subSeqDirectionFlag=r.readUint8(),g.layerNumber=r.readUint8(),g.subSequenceIdentifier=r.readUint16()}}),l.createSampleGroupCtor("dtrt",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("mvif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("prol",function(r){this.roll_distance=r.readInt16()}),l.createSampleGroupCtor("rap ",function(r){var a=r.readUint8();this.num_leading_samples_known=a>>7,this.num_leading_samples=a&127}),l.createSampleGroupCtor("rash",function(r){if(this.operation_point_count=r.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)t.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=r.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=r.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var a=0;a<this.operation_point_count;a++)this.available_bitrate[a]=r.readUint32(),this.target_rate_share[a]=r.readUint16()}this.maximum_bitrate=r.readUint32(),this.minimum_bitrate=r.readUint32(),this.discard_priority=r.readUint8()}}),l.createSampleGroupCtor("roll",function(r){this.roll_distance=r.readInt16()}),l.SampleGroupEntry.prototype.parse=function(r){t.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=r.readUint8Array(this.description_length)},l.createSampleGroupCtor("scif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("scnm",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("seig",function(r){this.reserved=r.readUint8();var a=r.readUint8();this.crypt_byte_block=a>>4,this.skip_byte_block=a&15,this.isProtected=r.readUint8(),this.Per_Sample_IV_Size=r.readUint8(),this.KID=l.parseHex16(r),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=r.readUint8(),this.constant_IV=r.readUint8Array(this.constant_IV_size))}),l.createSampleGroupCtor("stsa",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("sync",function(r){var a=r.readUint8();this.NAL_unit_type=a&63}),l.createSampleGroupCtor("tele",function(r){var a=r.readUint8();this.level_independently_decodable=a>>7}),l.createSampleGroupCtor("tsas",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("tscl",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("vipr",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createFullBoxCtor("sbgp",function(r){this.grouping_type=r.readString(4),this.version===1?this.grouping_type_parameter=r.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),f.sample_count=r.readInt32(),f.group_description_index=r.readInt32()}});function m(r,a){this.bad_pixel_row=r,this.bad_pixel_column=a}m.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},l.createFullBoxCtor("sbpm",function(r){var a;for(this.component_count=r.readUint16(),this.component_index=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16());var u=r.readUint8();for(this.correction_applied=(u&128)==128,this.num_bad_rows=r.readUint32(),this.num_bad_cols=r.readUint32(),this.num_bad_pixels=r.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],a=0;a<this.num_bad_rows;a++)this.bad_rows.push(r.readUint32());for(a=0;a<this.num_bad_cols;a++)this.bad_columns.push(r.readUint32());for(a=0;a<this.num_bad_pixels;a++){var f=r.readUint32(),g=r.readUint32();this.bad_pixels.push(new m(f,g))}}),l.createFullBoxCtor("schm",function(r){this.scheme_type=r.readString(4),this.scheme_version=r.readUint32(),this.flags&1&&(this.scheme_uri=r.readString(this.size-this.hdr_size-8))}),l.createBoxCtor("sdp ",function(r){this.sdptext=r.readString(this.size-this.hdr_size)}),l.createFullBoxCtor("sdtp",function(r){var a,u=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var f=0;f<u;f++)a=r.readUint8(),this.is_leading[f]=a>>6,this.sample_depends_on[f]=a>>4&3,this.sample_is_depended_on[f]=a>>2&3,this.sample_has_redundancy[f]=a&3}),l.createFullBoxCtor("senc"),l.createFullBoxCtor("sgpd",function(r){this.grouping_type=r.readString(4),t.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=r.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=r.readUint32()),this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f;l[this.grouping_type+"SampleGroupEntry"]?f=new l[this.grouping_type+"SampleGroupEntry"](this.grouping_type):f=new l.SampleGroupEntry(this.grouping_type),this.entries.push(f),this.version===1?this.default_length===0?f.description_length=r.readUint32():f.description_length=this.default_length:f.description_length=this.default_length,f.write===l.SampleGroupEntry.prototype.write&&(t.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),f.data=r.readUint8Array(f.description_length),r.position-=f.description_length),f.parse(r)}}),l.createFullBoxCtor("sidx",function(r){this.reference_ID=r.readUint32(),this.timescale=r.readUint32(),this.version===0?(this.earliest_presentation_time=r.readUint32(),this.first_offset=r.readUint32()):(this.earliest_presentation_time=r.readUint64(),this.first_offset=r.readUint64()),r.readUint16(),this.references=[];for(var a=r.readUint16(),u=0;u<a;u++){var f={};this.references.push(f);var g=r.readUint32();f.reference_type=g>>31&1,f.referenced_size=g&2147483647,f.subsegment_duration=r.readUint32(),g=r.readUint32(),f.starts_with_SAP=g>>31&1,f.SAP_type=g>>28&7,f.SAP_delta_time=g&268435455}}),l.SingleItemTypeReferenceBox=function(r,a,u,f){l.Box.call(this,r,a),this.hdr_size=u,this.start=f},l.SingleItemTypeReferenceBox.prototype=new l.Box,l.SingleItemTypeReferenceBox.prototype.parse=function(r){this.from_item_ID=r.readUint16();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint16()},l.SingleItemTypeReferenceBoxLarge=function(r,a,u,f){l.Box.call(this,r,a),this.hdr_size=u,this.start=f},l.SingleItemTypeReferenceBoxLarge.prototype=new l.Box,l.SingleItemTypeReferenceBoxLarge.prototype.parse=function(r){this.from_item_ID=r.readUint32();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint32()},l.createFullBoxCtor("SmDm",function(r){this.primaryRChromaticity_x=r.readUint16(),this.primaryRChromaticity_y=r.readUint16(),this.primaryGChromaticity_x=r.readUint16(),this.primaryGChromaticity_y=r.readUint16(),this.primaryBChromaticity_x=r.readUint16(),this.primaryBChromaticity_y=r.readUint16(),this.whitePointChromaticity_x=r.readUint16(),this.whitePointChromaticity_y=r.readUint16(),this.luminanceMax=r.readUint32(),this.luminanceMin=r.readUint32()}),l.createFullBoxCtor("smhd",function(r){this.balance=r.readUint16(),r.readUint16()}),l.createFullBoxCtor("ssix",function(r){this.subsegments=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.subsegments.push(f),f.ranges=[];for(var g=r.readUint32(),x=0;x<g;x++){var S={};f.ranges.push(S),S.level=r.readUint8(),S.range_size=r.readUint24()}}}),l.createFullBoxCtor("stco",function(r){var a;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(var u=0;u<a;u++)this.chunk_offsets.push(r.readUint32())}),l.createFullBoxCtor("stdp",function(r){var a=(this.size-this.hdr_size)/2;this.priority=[];for(var u=0;u<a;u++)this.priority[u]=r.readUint16()}),l.createFullBoxCtor("sthd"),l.createFullBoxCtor("stri",function(r){this.switch_group=r.readUint16(),this.alternate_group=r.readUint16(),this.sub_track_id=r.readUint32();var a=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),l.createFullBoxCtor("stsc",function(r){var a,u;if(a=r.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(u=0;u<a;u++)this.first_chunk.push(r.readUint32()),this.samples_per_chunk.push(r.readUint32()),this.sample_description_index.push(r.readUint32())}),l.createFullBoxCtor("stsd",function(r){var a,u,f,g;for(this.entries=[],f=r.readUint32(),a=1;a<=f;a++)if(u=l.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),u.code===l.OK)l[u.type+"SampleEntry"]?(g=new l[u.type+"SampleEntry"](u.size),g.hdr_size=u.hdr_size,g.start=u.start):(t.warn("BoxParser","Unknown sample entry type: "+u.type),g=new l.SampleEntry(u.type,u.size,u.hdr_size,u.start)),g.write===l.SampleEntry.prototype.write&&(t.info("BoxParser","SampleEntry "+g.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),g.parseDataAndRewind(r)),g.parse(r),this.entries.push(g);else return}),l.createFullBoxCtor("stsg",function(r){this.grouping_type=r.readUint32();var a=r.readUint16();this.group_description_index=[];for(var u=0;u<a;u++)this.group_description_index[u]=r.readUint32()}),l.createFullBoxCtor("stsh",function(r){var a,u;if(a=r.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(u=0;u<a;u++)this.shadowed_sample_numbers.push(r.readUint32()),this.sync_sample_numbers.push(r.readUint32())}),l.createFullBoxCtor("stss",function(r){var a,u;if(u=r.readUint32(),this.version===0)for(this.sample_numbers=[],a=0;a<u;a++)this.sample_numbers.push(r.readUint32())}),l.createFullBoxCtor("stsz",function(r){var a;if(this.sample_sizes=[],this.version===0)for(this.sample_size=r.readUint32(),this.sample_count=r.readUint32(),a=0;a<this.sample_count;a++)this.sample_size===0?this.sample_sizes.push(r.readUint32()):this.sample_sizes[a]=this.sample_size}),l.createFullBoxCtor("stts",function(r){var a,u,f;if(a=r.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),f=r.readInt32(),f<0&&(t.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),f=1),this.sample_deltas.push(f)}),l.createFullBoxCtor("stvi",function(r){var a=r.readUint32();this.single_view_allowed=a&3,this.stereo_scheme=r.readUint32();var u=r.readUint32();this.stereo_indication_type=r.readString(u);var f,g;for(this.boxes=[];r.getPosition()<this.start+this.size;)if(f=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),f.code===l.OK)g=f.box,this.boxes.push(g),this[g.type]=g;else return}),l.createBoxCtor("styp",function(r){l.ftypBox.prototype.parse.call(this,r)}),l.createFullBoxCtor("stz2",function(r){var a,u;if(this.sample_sizes=[],this.version===0)if(this.reserved=r.readUint24(),this.field_size=r.readUint8(),u=r.readUint32(),this.field_size===4)for(a=0;a<u;a+=2){var f=r.readUint8();this.sample_sizes[a]=f>>4&15,this.sample_sizes[a+1]=f&15}else if(this.field_size===8)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint8();else if(this.field_size===16)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint16();else t.error("BoxParser","Error in length field in stz2 box")}),l.createFullBoxCtor("subs",function(r){var a,u,f,g;for(f=r.readUint32(),this.entries=[],a=0;a<f;a++){var x={};if(this.entries[a]=x,x.sample_delta=r.readUint32(),x.subsamples=[],g=r.readUint16(),g>0)for(u=0;u<g;u++){var S={};x.subsamples.push(S),this.version==1?S.size=r.readUint32():S.size=r.readUint16(),S.priority=r.readUint8(),S.discardable=r.readUint8(),S.codec_specific_parameters=r.readUint32()}}}),l.createFullBoxCtor("tenc",function(r){if(r.readUint8(),this.version===0)r.readUint8();else{var a=r.readUint8();this.default_crypt_byte_block=a>>4&15,this.default_skip_byte_block=a&15}this.default_isProtected=r.readUint8(),this.default_Per_Sample_IV_Size=r.readUint8(),this.default_KID=l.parseHex16(r),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=r.readUint8(),this.default_constant_IV=r.readUint8Array(this.default_constant_IV_size))}),l.createFullBoxCtor("tfdt",function(r){this.version==1?this.baseMediaDecodeTime=r.readUint64():this.baseMediaDecodeTime=r.readUint32()}),l.createFullBoxCtor("tfhd",function(r){var a=0;this.track_id=r.readUint32(),this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=r.readUint64(),a+=8):this.base_data_offset=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=r.readUint32(),a+=4):this.default_sample_description_index=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=r.readUint32(),a+=4):this.default_sample_duration=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=r.readUint32(),a+=4):this.default_sample_size=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=r.readUint32(),a+=4):this.default_sample_flags=0}),l.createFullBoxCtor("tfra",function(r){this.track_ID=r.readUint32(),r.readUint24();var a=r.readUint8();this.length_size_of_traf_num=a>>4&3,this.length_size_of_trun_num=a>>2&3,this.length_size_of_sample_num=a&3,this.entries=[];for(var u=r.readUint32(),f=0;f<u;f++)this.version===1?(this.time=r.readUint64(),this.moof_offset=r.readUint64()):(this.time=r.readUint32(),this.moof_offset=r.readUint32()),this.traf_number=r["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=r["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=r["readUint"+8*(this.length_size_of_sample_num+1)]()}),l.createFullBoxCtor("tkhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint32()),r.readUint32Array(2),this.layer=r.readInt16(),this.alternate_group=r.readInt16(),this.volume=r.readInt16()>>8,r.readUint16(),this.matrix=r.readInt32Array(9),this.width=r.readUint32(),this.height=r.readUint32()}),l.createBoxCtor("tmax",function(r){this.time=r.readUint32()}),l.createBoxCtor("tmin",function(r){this.time=r.readUint32()}),l.createBoxCtor("totl",function(r){this.bytessent=r.readUint32()}),l.createBoxCtor("tpay",function(r){this.bytessent=r.readUint32()}),l.createBoxCtor("tpyl",function(r){this.bytessent=r.readUint64()}),l.TrackGroupTypeBox.prototype.parse=function(r){this.parseFullHeader(r),this.track_group_id=r.readUint32()},l.createTrackGroupCtor("msrc"),l.TrackReferenceTypeBox=function(r,a,u,f){l.Box.call(this,r,a),this.hdr_size=u,this.start=f},l.TrackReferenceTypeBox.prototype=new l.Box,l.TrackReferenceTypeBox.prototype.parse=function(r){this.track_ids=r.readUint32Array((this.size-this.hdr_size)/4)},l.trefBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=l.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===l.OK)u=new l.TrackReferenceTypeBox(a.type,a.size,a.hdr_size,a.start),u.write===l.Box.prototype.write&&u.type!=="mdat"&&(t.info("BoxParser","TrackReference "+u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.boxes.push(u);else return},l.createFullBoxCtor("trep",function(r){for(this.track_ID=r.readUint32(),this.boxes=[];r.getPosition()<this.start+this.size;)if(ret=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),ret.code===l.OK)box=ret.box,this.boxes.push(box);else return}),l.createFullBoxCtor("trex",function(r){this.track_id=r.readUint32(),this.default_sample_description_index=r.readUint32(),this.default_sample_duration=r.readUint32(),this.default_sample_size=r.readUint32(),this.default_sample_flags=r.readUint32()}),l.createBoxCtor("trpy",function(r){this.bytessent=r.readUint64()}),l.createFullBoxCtor("trun",function(r){var a=0;if(this.sample_count=r.readUint32(),a+=4,this.size-this.hdr_size>a&&this.flags&l.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=r.readInt32(),a+=4):this.data_offset=0,this.size-this.hdr_size>a&&this.flags&l.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=r.readUint32(),a+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>a)for(var u=0;u<this.sample_count;u++)this.flags&l.TRUN_FLAGS_DURATION&&(this.sample_duration[u]=r.readUint32()),this.flags&l.TRUN_FLAGS_SIZE&&(this.sample_size[u]=r.readUint32()),this.flags&l.TRUN_FLAGS_FLAGS&&(this.sample_flags[u]=r.readUint32()),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[u]=r.readUint32():this.sample_composition_time_offset[u]=r.readInt32())}),l.createFullBoxCtor("tsel",function(r){this.switch_group=r.readUint32();var a=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),l.createFullBoxCtor("txtC",function(r){this.config=r.readCString()}),l.createBoxCtor("tyco",function(r){var a=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var u=0;u<a;u++)this.compatible_brands[u]=r.readString(4)}),l.createFullBoxCtor("udes",function(r){this.lang=r.readCString(),this.name=r.readCString(),this.description=r.readCString(),this.tags=r.readCString()}),l.createFullBoxCtor("uncC",function(r){var a;if(this.profile=r.readUint32(),this.version!=1){if(this.version==0){for(this.component_count=r.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16()),this.component_bit_depth_minus_one.push(r.readUint8()),this.component_format.push(r.readUint8()),this.component_align_size.push(r.readUint8());this.sampling_type=r.readUint8(),this.interleave_type=r.readUint8(),this.block_size=r.readUint8();var u=r.readUint8();this.component_little_endian=u>>7&1,this.block_pad_lsb=u>>6&1,this.block_little_endian=u>>5&1,this.block_reversed=u>>4&1,this.pad_unknown=u>>3&1,this.pixel_size=r.readUint32(),this.row_align_size=r.readUint32(),this.tile_align_size=r.readUint32(),this.num_tile_cols_minus_one=r.readUint32(),this.num_tile_rows_minus_one=r.readUint32()}}}),l.createFullBoxCtor("url ",function(r){this.flags!==1&&(this.location=r.readCString())}),l.createFullBoxCtor("urn ",function(r){this.name=r.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=r.readCString())}),l.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(r){this.LiveServerManifest=r.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),l.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(r){this.system_id=l.parseHex16(r);var a=r.readUint32();a>0&&(this.data=r.readUint8Array(a))}),l.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),l.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(r){this.default_AlgorithmID=r.readUint24(),this.default_IV_size=r.readUint8(),this.default_KID=l.parseHex16(r)}),l.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(r){this.fragment_count=r.readUint8(),this.entries=[];for(var a=0;a<this.fragment_count;a++){var u={},f=0,g=0;this.version===1?(f=r.readUint64(),g=r.readUint64()):(f=r.readUint32(),g=r.readUint32()),u.absolute_time=f,u.absolute_duration=g,this.entries.push(u)}}),l.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(r){this.version===1?(this.absolute_time=r.readUint64(),this.duration=r.readUint64()):(this.absolute_time=r.readUint32(),this.duration=r.readUint32())}),l.createFullBoxCtor("vmhd",function(r){this.graphicsmode=r.readUint16(),this.opcolor=r.readUint16Array(3)}),l.createFullBoxCtor("vpcC",function(r){var a;this.version===1?(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4,this.chromaSubsampling=a>>1&7,this.videoFullRangeFlag=a&1,this.colourPrimaries=r.readUint8(),this.transferCharacteristics=r.readUint8(),this.matrixCoefficients=r.readUint8(),this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize)):(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4&15,this.colorSpace=a&15,a=r.readUint8(),this.chromaSubsampling=a>>4&15,this.transferFunction=a>>1&7,this.videoFullRangeFlag=a&1,this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize))}),l.createBoxCtor("vttC",function(r){this.text=r.readString(this.size-this.hdr_size)}),l.createFullBoxCtor("vvcC",function(r){var a,u,f={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(L){this.held_bits=L.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(L){this.held_bits=L.readUint16(),this.num_held_bits=16},extract_bits:function(L){var W=this.held_bits>>this.num_held_bits-L&(1<<L)-1;return this.num_held_bits-=L,W}};if(f.stream_read_1_bytes(r),f.extract_bits(5),this.lengthSizeMinusOne=f.extract_bits(2),this.ptl_present_flag=f.extract_bits(1),this.ptl_present_flag){f.stream_read_2_bytes(r),this.ols_idx=f.extract_bits(9),this.num_sublayers=f.extract_bits(3),this.constant_frame_rate=f.extract_bits(2),this.chroma_format_idc=f.extract_bits(2),f.stream_read_1_bytes(r),this.bit_depth_minus8=f.extract_bits(3),f.extract_bits(5);{if(f.stream_read_2_bytes(r),f.extract_bits(2),this.num_bytes_constraint_info=f.extract_bits(6),this.general_profile_idc=f.extract_bits(7),this.general_tier_flag=f.extract_bits(1),this.general_level_idc=r.readUint8(),f.stream_read_1_bytes(r),this.ptl_frame_only_constraint_flag=f.extract_bits(1),this.ptl_multilayer_enabled_flag=f.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(a=0;a<this.num_bytes_constraint_info-1;a++){var g=f.extract_bits(6);f.stream_read_1_bytes(r);var x=f.extract_bits(2);this.general_constraint_info[a]=g<<2|x}this.general_constraint_info[this.num_bytes_constraint_info-1]=f.extract_bits(6)}else f.extract_bits(6);if(this.num_sublayers>1){for(f.stream_read_1_bytes(r),this.ptl_sublayer_present_mask=0,u=this.num_sublayers-2;u>=0;--u){var S=f.extract_bits(1);this.ptl_sublayer_present_mask|=S<<u}for(u=this.num_sublayers;u<=8&&this.num_sublayers>1;++u)f.extract_bits(1);for(this.sublayer_level_idc=[],u=this.num_sublayers-2;u>=0;--u)this.ptl_sublayer_present_mask&1<<u&&(this.sublayer_level_idc[u]=r.readUint8())}if(this.ptl_num_sub_profiles=r.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(a=0;a<this.ptl_num_sub_profiles;a++)this.general_sub_profile_idc.push(r.readUint32())}this.max_picture_width=r.readUint16(),this.max_picture_height=r.readUint16(),this.avg_frame_rate=r.readUint16()}var A=12,C=13;this.nalu_arrays=[];var B=r.readUint8();for(a=0;a<B;a++){var R=[];this.nalu_arrays.push(R),f.stream_read_1_bytes(r),R.completeness=f.extract_bits(1),f.extract_bits(2),R.nalu_type=f.extract_bits(5);var M=1;for(R.nalu_type!=C&&R.nalu_type!=A&&(M=r.readUint16()),u=0;u<M;u++){var N=r.readUint16();R.push({data:r.readUint8Array(N),length:N})}}}),l.createFullBoxCtor("vvnC",function(r){var a=strm.readUint8();this.lengthSizeMinusOne=a&3}),l.SampleEntry.prototype.isVideo=function(){return!1},l.SampleEntry.prototype.isAudio=function(){return!1},l.SampleEntry.prototype.isSubtitle=function(){return!1},l.SampleEntry.prototype.isMetadata=function(){return!1},l.SampleEntry.prototype.isHint=function(){return!1},l.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},l.SampleEntry.prototype.getWidth=function(){return""},l.SampleEntry.prototype.getHeight=function(){return""},l.SampleEntry.prototype.getChannelCount=function(){return""},l.SampleEntry.prototype.getSampleRate=function(){return""},l.SampleEntry.prototype.getSampleSize=function(){return""},l.VisualSampleEntry.prototype.isVideo=function(){return!0},l.VisualSampleEntry.prototype.getWidth=function(){return this.width},l.VisualSampleEntry.prototype.getHeight=function(){return this.height},l.AudioSampleEntry.prototype.isAudio=function(){return!0},l.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},l.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},l.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},l.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},l.MetadataSampleEntry.prototype.isMetadata=function(){return!0},l.decimalToHex=function(r,a){var u=Number(r).toString(16);for(a=typeof a>"u"||a===null?a=2:a;u.length<a;)u="0"+u;return u},l.avc1SampleEntry.prototype.getCodec=l.avc2SampleEntry.prototype.getCodec=l.avc3SampleEntry.prototype.getCodec=l.avc4SampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this);return this.avcC?r+"."+l.decimalToHex(this.avcC.AVCProfileIndication)+l.decimalToHex(this.avcC.profile_compatibility)+l.decimalToHex(this.avcC.AVCLevelIndication):r},l.hev1SampleEntry.prototype.getCodec=l.hvc1SampleEntry.prototype.getCodec=function(){var r,a=l.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(a+=".",this.hvcC.general_profile_space){case 0:a+="";break;case 1:a+="A";break;case 2:a+="B";break;case 3:a+="C";break}a+=this.hvcC.general_profile_idc,a+=".";var u=this.hvcC.general_profile_compatibility,f=0;for(r=0;r<32&&(f|=u&1,r!=31);r++)f<<=1,u>>=1;a+=l.decimalToHex(f,0),a+=".",this.hvcC.general_tier_flag===0?a+="L":a+="H",a+=this.hvcC.general_level_idc;var g=!1,x="";for(r=5;r>=0;r--)(this.hvcC.general_constraint_indicator[r]||g)&&(x="."+l.decimalToHex(this.hvcC.general_constraint_indicator[r],0)+x,g=!0);a+=x}return a},l.vvc1SampleEntry.prototype.getCodec=l.vvi1SampleEntry.prototype.getCodec=function(){var r,a=l.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){a+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?a+=".H":a+=".L",a+=this.vvcC.general_level_idc;var u="";if(this.vvcC.general_constraint_info){var f=[],g=0;g|=this.vvcC.ptl_frame_only_constraint<<7,g|=this.vvcC.ptl_multilayer_enabled<<6;var x;for(r=0;r<this.vvcC.general_constraint_info.length;++r)g|=this.vvcC.general_constraint_info[r]>>2&63,f.push(g),g&&(x=r),g=this.vvcC.general_constraint_info[r]>>2&3;if(x===void 0)u=".CA";else{u=".C";var S="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",A=0,C=0;for(r=0;r<=x;++r)for(A=A<<8|f[r],C+=8;C>=5;){var B=A>>C-5&31;u+=S[B],C-=5,A&=(1<<C)-1}C&&(A<<=5-C,u+=S[A&31])}}a+=u}return a},l.mp4aSampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var a=this.esds.esd.getOTI(),u=this.esds.esd.getAudioConfig();return r+"."+l.decimalToHex(a)+(u?"."+u:"")}else return r},l.stxtSampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this);return this.mime_format?r+"."+this.mime_format:r},l.vp08SampleEntry.prototype.getCodec=l.vp09SampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this),a=this.vpcC.level;a==0&&(a="00");var u=this.vpcC.bitDepth;return u==8&&(u="08"),r+".0"+this.vpcC.profile+"."+a+"."+u},l.av01SampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this),a=this.av1C.seq_level_idx_0;a<10&&(a="0"+a);var u;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?u=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(u=this.av1C.high_bitdepth===1?"10":"08"),r+"."+this.av1C.seq_profile+"."+a+(this.av1C.seq_tier_0?"H":"M")+"."+u},l.Box.prototype.writeHeader=function(r,a){this.size+=8,this.size>o&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+r.getPosition()+(a||"")),this.size>o?r.writeUint32(1):(this.sizePosition=r.getPosition(),r.writeUint32(this.size)),r.writeString(this.type,null,4),this.type==="uuid"&&r.writeUint8Array(this.uuid),this.size>o&&r.writeUint64(this.size)},l.FullBox.prototype.writeHeader=function(r){this.size+=4,l.Box.prototype.writeHeader.call(this,r," v="+this.version+" f="+this.flags),r.writeUint8(this.version),r.writeUint24(this.flags)},l.Box.prototype.write=function(r){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(r),r.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(r),this.data&&r.writeUint8Array(this.data))},l.ContainerBox.prototype.write=function(r){this.size=0,this.writeHeader(r);for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&(this.boxes[a].write(r),this.size+=this.boxes[a].size);t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.TrackReferenceTypeBox.prototype.write=function(r){this.size=this.track_ids.length*4,this.writeHeader(r),r.writeUint32Array(this.track_ids)},l.avcCBox.prototype.write=function(r){var a;for(this.size=7,a=0;a<this.SPS.length;a++)this.size+=2+this.SPS[a].length;for(a=0;a<this.PPS.length;a++)this.size+=2+this.PPS[a].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8(this.AVCProfileIndication),r.writeUint8(this.profile_compatibility),r.writeUint8(this.AVCLevelIndication),r.writeUint8(this.lengthSizeMinusOne+252),r.writeUint8(this.SPS.length+224),a=0;a<this.SPS.length;a++)r.writeUint16(this.SPS[a].length),r.writeUint8Array(this.SPS[a].nalu);for(r.writeUint8(this.PPS.length),a=0;a<this.PPS.length;a++)r.writeUint16(this.PPS[a].length),r.writeUint8Array(this.PPS[a].nalu);this.ext&&r.writeUint8Array(this.ext)},l.co64Box.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),a=0;a<this.chunk_offsets.length;a++)r.writeUint64(this.chunk_offsets[a])},l.cslgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeInt32(this.compositionToDTSShift),r.writeInt32(this.leastDecodeToDisplayDelta),r.writeInt32(this.greatestDecodeToDisplayDelta),r.writeInt32(this.compositionStartTime),r.writeInt32(this.compositionEndTime)},l.cttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),this.version===1?r.writeInt32(this.sample_offsets[a]):r.writeUint32(this.sample_offsets[a])},l.drefBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.elngBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(r),r.writeString(this.extended_language)},l.elstBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeUint32(u.segment_duration),r.writeInt32(u.media_time),r.writeInt16(u.media_rate_integer),r.writeInt16(u.media_rate_fraction)}},l.emsgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(r),r.writeCString(this.scheme_id_uri),r.writeCString(this.value),r.writeUint32(this.timescale),r.writeUint32(this.presentation_time_delta),r.writeUint32(this.event_duration),r.writeUint32(this.id),r.writeUint8Array(this.message_data)},l.ftypBox.prototype.write=function(r){this.size=8+4*this.compatible_brands.length,this.writeHeader(r),r.writeString(this.major_brand,null,4),r.writeUint32(this.minor_version);for(var a=0;a<this.compatible_brands.length;a++)r.writeString(this.compatible_brands[a],null,4)},l.hdlrBox.prototype.write=function(r){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(r),r.writeUint32(0),r.writeString(this.handler,null,4),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeCString(this.name)},l.hvcCBox.prototype.write=function(r){var a,u;for(this.size=23,a=0;a<this.nalu_arrays.length;a++)for(this.size+=3,u=0;u<this.nalu_arrays[a].length;u++)this.size+=2+this.nalu_arrays[a][u].data.length;for(this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),r.writeUint32(this.general_profile_compatibility),r.writeUint8Array(this.general_constraint_indicator),r.writeUint8(this.general_level_idc),r.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),r.writeUint8(this.parallelismType+252),r.writeUint8(this.chroma_format_idc+252),r.writeUint8(this.bit_depth_luma_minus8+248),r.writeUint8(this.bit_depth_chroma_minus8+248),r.writeUint16(this.avgFrameRate),r.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),r.writeUint8(this.nalu_arrays.length),a=0;a<this.nalu_arrays.length;a++)for(r.writeUint8((this.nalu_arrays[a].completeness<<7)+this.nalu_arrays[a].nalu_type),r.writeUint16(this.nalu_arrays[a].length),u=0;u<this.nalu_arrays[a].length;u++)r.writeUint16(this.nalu_arrays[a][u].data.length),r.writeUint8Array(this.nalu_arrays[a][u].data)},l.kindBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(r),r.writeCString(this.schemeURI),r.writeCString(this.value)},l.mdhdBox.prototype.write=function(r){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint16(this.language),r.writeUint16(0)},l.mehdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.fragment_duration)},l.mfhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.sequence_number)},l.mvhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint32(this.rate),r.writeUint16(this.volume<<8),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32Array(this.matrix),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(this.next_track_id)},l.SampleEntry.prototype.writeHeader=function(r){this.size=8,l.Box.prototype.writeHeader.call(this,r),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint16(this.data_reference_index)},l.SampleEntry.prototype.writeFooter=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r),this.size+=this.boxes[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.SampleEntry.prototype.write=function(r){this.writeHeader(r),r.writeUint8Array(this.data),this.size+=this.data.length,t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.VisualSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*7+6*4+32,r.writeUint16(0),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.width),r.writeUint16(this.height),r.writeUint32(this.horizresolution),r.writeUint32(this.vertresolution),r.writeUint32(0),r.writeUint16(this.frame_count),r.writeUint8(Math.min(31,this.compressorname.length)),r.writeString(this.compressorname,null,31),r.writeUint16(this.depth),r.writeInt16(-1),this.writeFooter(r)},l.AudioSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*4+3*4,r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.channel_count),r.writeUint16(this.samplesize),r.writeUint16(0),r.writeUint16(0),r.writeUint32(this.samplerate<<16),this.writeFooter(r)},l.stppSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,r.writeCString(this.namespace),r.writeCString(this.schema_location),r.writeCString(this.auxiliary_mime_types),this.writeFooter(r)},l.SampleGroupEntry.prototype.write=function(r){r.writeUint8Array(this.data)},l.sbgpBox.prototype.write=function(r){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(r),r.writeString(this.grouping_type,null,4),r.writeUint32(this.grouping_type_parameter),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeInt32(u.sample_count),r.writeInt32(u.group_description_index)}},l.sgpdBox.prototype.write=function(r){var a,u;for(this.flags=0,this.size=12,a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=u.data.length);for(this.writeHeader(r),r.writeString(this.grouping_type,null,4),this.version===1&&r.writeUint32(this.default_length),this.version>=2&&r.writeUint32(this.default_sample_description_index),r.writeUint32(this.entries.length),a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&this.default_length===0&&r.writeUint32(u.description_length),u.write(r)},l.sidxBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(r),r.writeUint32(this.reference_ID),r.writeUint32(this.timescale),r.writeUint32(this.earliest_presentation_time),r.writeUint32(this.first_offset),r.writeUint16(0),r.writeUint16(this.references.length);for(var a=0;a<this.references.length;a++){var u=this.references[a];r.writeUint32(u.reference_type<<31|u.referenced_size),r.writeUint32(u.subsegment_duration),r.writeUint32(u.starts_with_SAP<<31|u.SAP_type<<28|u.SAP_delta_time)}},l.smhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=4,this.writeHeader(r),r.writeUint16(this.balance),r.writeUint16(0)},l.stcoBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),r.writeUint32Array(this.chunk_offsets)},l.stscBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(r),r.writeUint32(this.first_chunk.length),a=0;a<this.first_chunk.length;a++)r.writeUint32(this.first_chunk[a]),r.writeUint32(this.samples_per_chunk[a]),r.writeUint32(this.sample_description_index[a])},l.stsdBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(r),r.writeUint32(this.entries.length),this.size+=4,a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.stshBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(r),r.writeUint32(this.shadowed_sample_numbers.length),a=0;a<this.shadowed_sample_numbers.length;a++)r.writeUint32(this.shadowed_sample_numbers[a]),r.writeUint32(this.sync_sample_numbers[a])},l.stssBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(r),r.writeUint32(this.sample_numbers.length),r.writeUint32Array(this.sample_numbers)},l.stszBox.prototype.write=function(r){var a,u=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(a=0;a+1<this.sample_sizes.length;)if(this.sample_sizes[a+1]!==this.sample_sizes[0]){u=!1;break}else a++;else u=!1;this.size=8,u||(this.size+=4*this.sample_sizes.length),this.writeHeader(r),u?r.writeUint32(this.sample_sizes[0]):r.writeUint32(0),r.writeUint32(this.sample_sizes.length),u||r.writeUint32Array(this.sample_sizes)},l.sttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),r.writeUint32(this.sample_deltas[a])},l.tfdtBox.prototype.write=function(r){var a=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>a?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(r),this.version===1?r.writeUint64(this.baseMediaDecodeTime):r.writeUint32(this.baseMediaDecodeTime)},l.tfhdBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(r),r.writeUint32(this.track_id),this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&r.writeUint64(this.base_data_offset),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&r.writeUint32(this.default_sample_description_index),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&r.writeUint32(this.default_sample_duration),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&r.writeUint32(this.default_sample_size),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&r.writeUint32(this.default_sample_flags)},l.tkhdBox.prototype.write=function(r){this.version=0,this.size=4*18+2*4,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.track_id),r.writeUint32(0),r.writeUint32(this.duration),r.writeUint32(0),r.writeUint32(0),r.writeInt16(this.layer),r.writeInt16(this.alternate_group),r.writeInt16(this.volume<<8),r.writeUint16(0),r.writeInt32Array(this.matrix),r.writeUint32(this.width),r.writeUint32(this.height)},l.trexBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeUint32(this.track_id),r.writeUint32(this.default_sample_description_index),r.writeUint32(this.default_sample_duration),r.writeUint32(this.default_sample_size),r.writeUint32(this.default_sample_flags)},l.trunBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&l.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&l.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&l.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(r),r.writeUint32(this.sample_count),this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=r.getPosition(),r.writeInt32(this.data_offset)),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&r.writeUint32(this.first_sample_flags);for(var a=0;a<this.sample_count;a++)this.flags&l.TRUN_FLAGS_DURATION&&r.writeUint32(this.sample_duration[a]),this.flags&l.TRUN_FLAGS_SIZE&&r.writeUint32(this.sample_size[a]),this.flags&l.TRUN_FLAGS_FLAGS&&r.writeUint32(this.sample_flags[a]),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?r.writeUint32(this.sample_composition_time_offset[a]):r.writeInt32(this.sample_composition_time_offset[a]))},l["url Box"].prototype.write=function(r){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(r),this.location&&r.writeCString(this.location)},l["urn Box"].prototype.write=function(r){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(r),r.writeCString(this.name),this.location&&r.writeCString(this.location)},l.vmhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=8,this.writeHeader(r),r.writeUint16(this.graphicsmode),r.writeUint16Array(this.opcolor)},l.cttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)r[f].pts=r[f].dts+this.sample_offsets[a],f++},l.sttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)f===0?r[f].dts=0:r[f].dts=r[f-1].dts+this.sample_deltas[a],f++},l.stcoBox.prototype.unpack=function(r){var a;for(a=0;a<this.chunk_offsets.length;a++)r[a].offset=this.chunk_offsets[a]},l.stscBox.prototype.unpack=function(r){var a,u,f,g,x;for(g=0,x=0,a=0;a<this.first_chunk.length;a++)for(u=0;u<(a+1<this.first_chunk.length?this.first_chunk[a+1]:1/0);u++)for(x++,f=0;f<this.samples_per_chunk[a];f++){if(r[g])r[g].description_index=this.sample_description_index[a],r[g].chunk_index=x;else return;g++}},l.stszBox.prototype.unpack=function(r){var a;for(a=0;a<this.sample_sizes.length;a++)r[a].size=this.sample_sizes[a]},l.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],l.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],l.boxEqualFields=function(r,a){if(r&&!a)return!1;var u;for(u in r)if(!(l.DIFF_BOXES_PROP_NAMES.indexOf(u)>-1)){if(r[u]instanceof l.Box||a[u]instanceof l.Box)continue;if(typeof r[u]>"u"||typeof a[u]>"u")continue;if(typeof r[u]=="function"||typeof a[u]=="function")continue;if(r.subBoxNames&&r.subBoxNames.indexOf(u.slice(0,4))>-1||a.subBoxNames&&a.subBoxNames.indexOf(u.slice(0,4))>-1)continue;if(u==="data"||u==="start"||u==="size"||u==="creation_time"||u==="modification_time")continue;if(l.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(u)>-1)continue;if(r[u]!==a[u])return!1}return!0},l.boxEqual=function(r,a){if(!l.boxEqualFields(r,a))return!1;for(var u=0;u<l.DIFF_BOXES_PROP_NAMES.length;u++){var f=l.DIFF_BOXES_PROP_NAMES[u];if(r[f]&&a[f]&&!l.boxEqual(r[f],a[f]))return!1}return!0};var v=function(){};v.prototype.parseSample=function(r){var a={},u;a.resources=[];var f=new e(r.data.buffer);if(!r.subsamples||r.subsamples.length===0)a.documentString=f.readString(r.data.length);else if(a.documentString=f.readString(r.subsamples[0].size),r.subsamples.length>1)for(u=1;u<r.subsamples.length;u++)a.resources[u]=f.readUint8Array(r.subsamples[u].size);return typeof DOMParser<"u"&&(a.document=new DOMParser().parseFromString(a.documentString,"application/xml")),a};var w=function(){};w.prototype.parseSample=function(r){var a,u=new e(r.data.buffer);return a=u.readString(r.data.length),a},w.prototype.parseConfig=function(r){var a,u=new e(r.buffer);return u.readUint32(),a=u.readCString(),a},s.XMLSubtitlein4Parser=v,s.Textin4Parser=w;var b=function(r){this.stream=r||new h,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};b.prototype.setSegmentOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.fragmentedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.segmentStream=null,g.nb_samples=1e3,g.rapAlignement=!0,u&&(u.nbSamples&&(g.nb_samples=u.nbSamples),u.rapAlignement&&(g.rapAlignement=u.rapAlignement))}},b.prototype.unsetSegmentOptions=function(r){for(var a=-1,u=0;u<this.fragmentedTracks.length;u++){var f=this.fragmentedTracks[u];f.id==r&&(a=u)}a>-1&&this.fragmentedTracks.splice(a,1)},b.prototype.setExtractionOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.extractedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.nb_samples=1e3,g.samples=[],u&&u.nbSamples&&(g.nb_samples=u.nbSamples)}},b.prototype.unsetExtractionOptions=function(r){for(var a=-1,u=0;u<this.extractedTracks.length;u++){var f=this.extractedTracks[u];f.id==r&&(a=u)}a>-1&&this.extractedTracks.splice(a,1)},b.prototype.parse=function(){var r,a,u=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),r=l.parseOneBox(this.stream,u),r.code===l.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(r))continue;return}else return;else{var f;switch(a=r.box,f=a.type!=="uuid"?a.type:a.uuid,this.boxes.push(a),f){case"mdat":this.mdats.push(a);break;case"moof":this.moofs.push(a);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[f]!==void 0&&t.warn("ISOFile","Duplicate Box of type: "+f+", overriding previous occurrence"),this[f]=a;break}this.updateUsedBytes&&this.updateUsedBytes(a,r)}},b.prototype.checkBuffer=function(r){if(r==null)throw"Buffer must be defined and non empty";if(r.fileStart===void 0)throw"Buffer must have a fileStart property";return r.byteLength===0?(t.warn("ISOFile","Ignoring empty buffer (fileStart: "+r.fileStart+")"),this.stream.logBufferLevel(),!1):(t.info("ISOFile","Processing buffer (fileStart: "+r.fileStart+")"),r.usedBytes=0,this.stream.insertBuffer(r),this.stream.logBufferLevel(),this.stream.initialized()?!0:(t.warn("ISOFile","Not ready to start parsing"),!1))},b.prototype.appendBuffer=function(r,a){var u;if(this.checkBuffer(r))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(a),this.nextSeekPosition?(u=this.nextSeekPosition,this.nextSeekPosition=void 0):u=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(u=this.stream.getEndFilePositionAfter(u))):this.nextParsePosition?u=this.nextParsePosition:u=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(t.info("ISOFile","Done processing buffer (fileStart: "+r.fileStart+") - next buffer to fetch should have a fileStart position of "+u),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),u},b.prototype.getInfo=function(){var r,a,u={},f,g,x,S,A=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(u.hasMoov=!0,u.duration=this.moov.mvhd.duration,u.timescale=this.moov.mvhd.timescale,u.isFragmented=this.moov.mvex!=null,u.isFragmented&&this.moov.mvex.mehd&&(u.fragment_duration=this.moov.mvex.mehd.fragment_duration),u.isProgressive=this.isProgressive,u.hasIOD=this.moov.iods!=null,u.brands=[],u.brands.push(this.ftyp.major_brand),u.brands=u.brands.concat(this.ftyp.compatible_brands),u.created=new Date(A+this.moov.mvhd.creation_time*1e3),u.modified=new Date(A+this.moov.mvhd.modification_time*1e3),u.tracks=[],u.audioTracks=[],u.videoTracks=[],u.subtitleTracks=[],u.metadataTracks=[],u.hintTracks=[],u.otherTracks=[],r=0;r<this.moov.traks.length;r++){if(f=this.moov.traks[r],S=f.mdia.minf.stbl.stsd.entries[0],g={},u.tracks.push(g),g.id=f.tkhd.track_id,g.name=f.mdia.hdlr.name,g.references=[],f.tref)for(a=0;a<f.tref.boxes.length;a++)x={},g.references.push(x),x.type=f.tref.boxes[a].type,x.track_ids=f.tref.boxes[a].track_ids;f.edts&&(g.edits=f.edts.elst.entries),g.created=new Date(A+f.tkhd.creation_time*1e3),g.modified=new Date(A+f.tkhd.modification_time*1e3),g.movie_duration=f.tkhd.duration,g.movie_timescale=u.timescale,g.layer=f.tkhd.layer,g.alternate_group=f.tkhd.alternate_group,g.volume=f.tkhd.volume,g.matrix=f.tkhd.matrix,g.track_width=f.tkhd.width/65536,g.track_height=f.tkhd.height/65536,g.timescale=f.mdia.mdhd.timescale,g.cts_shift=f.mdia.minf.stbl.cslg,g.duration=f.mdia.mdhd.duration,g.samples_duration=f.samples_duration,g.codec=S.getCodec(),g.kind=f.udta&&f.udta.kinds.length?f.udta.kinds[0]:{schemeURI:"",value:""},g.language=f.mdia.elng?f.mdia.elng.extended_language:f.mdia.mdhd.languageString,g.nb_samples=f.samples.length,g.size=f.samples_size,g.bitrate=g.size*8*g.timescale/g.samples_duration,S.isAudio()?(g.type="audio",u.audioTracks.push(g),g.audio={},g.audio.sample_rate=S.getSampleRate(),g.audio.channel_count=S.getChannelCount(),g.audio.sample_size=S.getSampleSize()):S.isVideo()?(g.type="video",u.videoTracks.push(g),g.video={},g.video.width=S.getWidth(),g.video.height=S.getHeight()):S.isSubtitle()?(g.type="subtitles",u.subtitleTracks.push(g)):S.isHint()?(g.type="metadata",u.hintTracks.push(g)):S.isMetadata()?(g.type="metadata",u.metadataTracks.push(g)):(g.type="metadata",u.otherTracks.push(g))}else u.hasMoov=!1;if(u.mime="",u.hasMoov&&u.tracks){for(u.videoTracks&&u.videoTracks.length>0?u.mime+='video/mp4; codecs="':u.audioTracks&&u.audioTracks.length>0?u.mime+='audio/mp4; codecs="':u.mime+='application/mp4; codecs="',r=0;r<u.tracks.length;r++)r!==0&&(u.mime+=","),u.mime+=u.tracks[r].codec;u.mime+='"; profiles="',u.mime+=this.ftyp.compatible_brands.join(),u.mime+='"'}return u},b.prototype.setNextSeekPositionFromSample=function(r){r&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(r.offset+r.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=r.offset+r.alreadyRead)},b.prototype.processSamples=function(r){var a,u;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(a=0;a<this.fragmentedTracks.length;a++){var f=this.fragmentedTracks[a];for(u=f.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Creating media fragment on track #"+f.id+" for sample "+u.nextSample);var g=this.createFragment(f.id,u.nextSample,f.segmentStream);if(g)f.segmentStream=g,u.nextSample++;else break;if((u.nextSample%f.nb_samples===0||r||u.nextSample>=u.samples.length)&&(t.info("ISOFile","Sending fragmented data on track #"+f.id+" for samples ["+Math.max(0,u.nextSample-f.nb_samples)+","+(u.nextSample-1)+"]"),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(f.id,f.user,f.segmentStream.buffer,u.nextSample,r||u.nextSample>=u.samples.length),f.segmentStream=null,f!==this.fragmentedTracks[a]))break}}if(this.onSamples!==null)for(a=0;a<this.extractedTracks.length;a++){var x=this.extractedTracks[a];for(u=x.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Exporting on track #"+x.id+" sample #"+u.nextSample);var S=this.getSample(u,u.nextSample);if(S)u.nextSample++,x.samples.push(S);else{this.setNextSeekPositionFromSample(u.samples[u.nextSample]);break}if((u.nextSample%x.nb_samples===0||u.nextSample>=u.samples.length)&&(t.debug("ISOFile","Sending samples on track #"+x.id+" for sample "+u.nextSample),this.onSamples&&this.onSamples(x.id,x.user,x.samples),x.samples=[],x!==this.extractedTracks[a]))break}}}},b.prototype.getBox=function(r){var a=this.getBoxes(r,!0);return a.length?a[0]:null},b.prototype.getBoxes=function(r,a){var u=[];return b._sweep.call(this,r,u,a),u},b._sweep=function(r,a,u){this.type&&this.type==r&&a.push(this);for(var f in this.boxes){if(a.length&&u)return;b._sweep.call(this.boxes[f],r,a,u)}},b.prototype.getTrackSamplesInfo=function(r){var a=this.getTrackById(r);if(a)return a.samples},b.prototype.getTrackSample=function(r,a){var u=this.getTrackById(r),f=this.getSample(u,a);return f},b.prototype.releaseUsedSamples=function(r,a){var u=0,f=this.getTrackById(r);f.lastValidSample||(f.lastValidSample=0);for(var g=f.lastValidSample;g<a;g++)u+=this.releaseSample(f,g);t.info("ISOFile","Track #"+r+" released samples up to "+a+" (released size: "+u+", remaining: "+this.samplesDataSize+")"),f.lastValidSample=a},b.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},b.prototype.stop=function(){this.sampleProcessingStarted=!1},b.prototype.flush=function(){t.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},b.prototype.seekTrack=function(r,a,u){var f,g,x=1/0,S=0,A=0,C;if(u.samples.length===0)return t.info("ISOFile","No sample in track, cannot seek! Using time "+t.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(f=0;f<u.samples.length;f++){if(g=u.samples[f],f===0)A=0,C=g.timescale;else if(g.cts>r*g.timescale){A=f-1;break}a&&g.is_sync&&(S=f)}for(a&&(A=S),r=u.samples[A].cts,u.nextSample=A;u.samples[A].alreadyRead===u.samples[A].size&&u.samples[A+1];)A++;return x=u.samples[A].offset+u.samples[A].alreadyRead,t.info("ISOFile","Seeking to "+(a?"RAP":"")+" sample #"+u.nextSample+" on track "+u.tkhd.track_id+", time "+t.getDurationString(r,C)+" and offset: "+x),{offset:x,time:r/C}},b.prototype.getTrackDuration=function(r){var a;return r.samples?(a=r.samples[r.samples.length-1],(a.cts+a.duration)/a.timescale):1/0},b.prototype.seek=function(r,a){var u=this.moov,f,g,x,S={offset:1/0,time:1/0};if(this.moov){for(x=0;x<u.traks.length;x++)f=u.traks[x],!(r>this.getTrackDuration(f))&&(g=this.seekTrack(r,a,f),g.offset<S.offset&&(S.offset=g.offset),g.time<S.time&&(S.time=g.time));return t.info("ISOFile","Seeking at time "+t.getDurationString(S.time,1)+" needs a buffer with a fileStart position of "+S.offset),S.offset===1/0?S={offset:this.nextParsePosition,time:0}:S.offset=this.stream.getEndFilePositionAfter(S.offset),t.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+S.offset),S}else throw"Cannot seek: moov not received!"},b.prototype.equal=function(r){for(var a=0;a<this.boxes.length&&a<r.boxes.length;){var u=this.boxes[a],f=r.boxes[a];if(!l.boxEqual(u,f))return!1;a++}return!0},s.ISOFile=b,b.prototype.lastBoxStartPosition=0,b.prototype.parsingMdat=null,b.prototype.nextParsePosition=0,b.prototype.discardMdatData=!1,b.prototype.processIncompleteBox=function(r){var a,u,f;return r.type==="mdat"?(a=new l[r.type+"Box"](r.size),this.parsingMdat=a,this.boxes.push(a),this.mdats.push(a),a.start=r.start,a.hdr_size=r.hdr_size,this.stream.addUsedBytes(a.hdr_size),this.lastBoxStartPosition=a.start+a.size,f=this.stream.seek(a.start+a.size,!1,this.discardMdatData),f?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=a.start+a.size,!1)):(r.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),u=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,u?(this.nextParsePosition=this.stream.getEndPosition(),!0):(r.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+r.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},b.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},b.prototype.processIncompleteMdat=function(){var r,a;return r=this.parsingMdat,a=this.stream.seek(r.start+r.size,!1,this.discardMdatData),a?(t.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},b.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},b.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},b.prototype.updateUsedBytes=function(r,a){this.stream.addUsedBytes&&(r.type==="mdat"?(this.stream.addUsedBytes(r.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(r.size-r.hdr_size)):this.stream.addUsedBytes(r.size))},b.prototype.add=l.Box.prototype.add,b.prototype.addBox=l.Box.prototype.addBox,b.prototype.init=function(r){var a=r||{};this.add("ftyp").set("major_brand",a.brands&&a.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",a.brands||["iso4"]);var u=this.add("moov");return u.add("mvhd").set("timescale",a.timescale||600).set("rate",a.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",a.duration||0).set("volume",a.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),u.add("mvex"),this},b.prototype.addTrack=function(r){this.moov||this.init(r);var a=r||{};a.width=a.width||320,a.height=a.height||320,a.id=a.id||this.moov.mvhd.next_track_id,a.type=a.type||"avc1";var u=this.moov.add("trak");this.moov.mvhd.next_track_id=a.id+1,u.add("tkhd").set("flags",l.TKHD_FLAG_ENABLED|l.TKHD_FLAG_IN_MOVIE|l.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",a.id).set("duration",a.duration||0).set("layer",a.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",a.width<<16).set("height",a.height<<16);var f=u.add("mdia");f.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",a.timescale||1).set("duration",a.media_duration||0).set("language",a.language||"und"),f.add("hdlr").set("handler",a.hdlr||"vide").set("name",a.name||"Track created with MP4Box.js"),f.add("elng").set("extended_language",a.language||"fr-FR");var g=f.add("minf");if(l[a.type+"SampleEntry"]!==void 0){var x=new l[a.type+"SampleEntry"];x.data_reference_index=1;var S="";for(var A in l.sampleEntryCodes)for(var C=l.sampleEntryCodes[A],B=0;B<C.length;B++)if(C.indexOf(a.type)>-1){S=A;break}switch(S){case"Visual":if(g.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),x.set("width",a.width).set("height",a.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",a.type+" Compressor").set("depth",24),a.avcDecoderConfigRecord){var R=new l.avcCBox;R.parse(new e(a.avcDecoderConfigRecord)),x.addBox(R)}else if(a.hevcDecoderConfigRecord){var M=new l.hvcCBox;M.parse(new e(a.hevcDecoderConfigRecord)),x.addBox(M)}break;case"Audio":g.add("smhd").set("balance",a.balance||0),x.set("channel_count",a.channel_count||2).set("samplesize",a.samplesize||16).set("samplerate",a.samplerate||65536);break;case"Hint":g.add("hmhd");break;case"Subtitle":switch(g.add("sthd"),a.type){case"stpp":x.set("namespace",a.namespace||"nonamespace").set("schema_location",a.schema_location||"").set("auxiliary_mime_types",a.auxiliary_mime_types||"");break}break;case"Metadata":g.add("nmhd");break;case"System":g.add("nmhd");break;default:g.add("nmhd");break}a.description&&x.addBox(a.description),a.description_boxes&&a.description_boxes.forEach(function(L){x.addBox(L)}),g.add("dinf").add("dref").addEntry(new l["url Box"]().set("flags",1));var N=g.add("stbl");return N.add("stsd").addEntry(x),N.add("stts").set("sample_counts",[]).set("sample_deltas",[]),N.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),N.add("stco").set("chunk_offsets",[]),N.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",a.id).set("default_sample_description_index",a.default_sample_description_index||1).set("default_sample_duration",a.default_sample_duration||0).set("default_sample_size",a.default_sample_size||0).set("default_sample_flags",a.default_sample_flags||0),this.buildTrakSampleLists(u),a.id}},l.Box.prototype.computeSize=function(r){var a=r||new n;a.endianness=n.BIG_ENDIAN,this.write(a)},b.prototype.addSample=function(r,a,u){var f=u||{},g={},x=this.getTrackById(r);if(x!==null){g.number=x.samples.length,g.track_id=x.tkhd.track_id,g.timescale=x.mdia.mdhd.timescale,g.description_index=f.sample_description_index?f.sample_description_index-1:0,g.description=x.mdia.minf.stbl.stsd.entries[g.description_index],g.data=a,g.size=a.byteLength,g.alreadyRead=g.size,g.duration=f.duration||1,g.cts=f.cts||0,g.dts=f.dts||0,g.is_sync=f.is_sync||!1,g.is_leading=f.is_leading||0,g.depends_on=f.depends_on||0,g.is_depended_on=f.is_depended_on||0,g.has_redundancy=f.has_redundancy||0,g.degradation_priority=f.degradation_priority||0,g.offset=0,g.subsamples=f.subsamples,x.samples.push(g),x.samples_size+=g.size,x.samples_duration+=g.duration,x.first_dts===void 0&&(x.first_dts=f.dts),this.processSamples();var S=this.createSingleSampleMoof(g);return this.addBox(S),S.computeSize(),S.trafs[0].truns[0].data_offset=S.size+8,this.add("mdat").data=new Uint8Array(a),g}},b.prototype.createSingleSampleMoof=function(r){var a=0;r.is_sync?a=1<<25:a=65536;var u=new l.moofBox;u.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var f=u.add("traf"),g=this.getTrackById(r.track_id);return f.add("tfhd").set("track_id",r.track_id).set("flags",l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),f.add("tfdt").set("baseMediaDecodeTime",r.dts-(g.first_dts||0)),f.add("trun").set("flags",l.TRUN_FLAGS_DATA_OFFSET|l.TRUN_FLAGS_DURATION|l.TRUN_FLAGS_SIZE|l.TRUN_FLAGS_FLAGS|l.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[r.duration]).set("sample_size",[r.size]).set("sample_flags",[a]).set("sample_composition_time_offset",[r.cts-r.dts]),u},b.prototype.lastMoofIndex=0,b.prototype.samplesDataSize=0,b.prototype.resetTables=function(){var r,a,u,f,g,x,S,A;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,r=0;r<this.moov.traks.length;r++){a=this.moov.traks[r],a.tkhd.duration=0,a.mdia.mdhd.duration=0,u=a.mdia.minf.stbl.stco||a.mdia.minf.stbl.co64,u.chunk_offsets=[],f=a.mdia.minf.stbl.stsc,f.first_chunk=[],f.samples_per_chunk=[],f.sample_description_index=[],g=a.mdia.minf.stbl.stsz||a.mdia.minf.stbl.stz2,g.sample_sizes=[],x=a.mdia.minf.stbl.stts,x.sample_counts=[],x.sample_deltas=[],S=a.mdia.minf.stbl.ctts,S&&(S.sample_counts=[],S.sample_offsets=[]),A=a.mdia.minf.stbl.stss;var C=a.mdia.minf.stbl.boxes.indexOf(A);C!=-1&&(a.mdia.minf.stbl.boxes[C]=null)}},b.initSampleGroups=function(r,a,u,f,g){var x,S,A,C;function B(R,M,N){this.grouping_type=R,this.grouping_type_parameter=M,this.sbgp=N,this.last_sample_in_run=-1,this.entry_index=-1}for(a&&(a.sample_groups_info=[]),r.sample_groups_info||(r.sample_groups_info=[]),S=0;S<u.length;S++){for(C=u[S].grouping_type+"/"+u[S].grouping_type_parameter,A=new B(u[S].grouping_type,u[S].grouping_type_parameter,u[S]),a&&(a.sample_groups_info[C]=A),r.sample_groups_info[C]||(r.sample_groups_info[C]=A),x=0;x<f.length;x++)f[x].grouping_type===u[S].grouping_type&&(A.description=f[x],A.description.used=!0);if(g)for(x=0;x<g.length;x++)g[x].grouping_type===u[S].grouping_type&&(A.fragment_description=g[x],A.fragment_description.used=!0,A.is_fragment=!0)}if(a){if(g)for(S=0;S<g.length;S++)!g[S].used&&g[S].version>=2&&(C=g[S].grouping_type+"/0",A=new B(g[S].grouping_type,0),A.is_fragment=!0,a.sample_groups_info[C]||(a.sample_groups_info[C]=A))}else for(S=0;S<f.length;S++)!f[S].used&&f[S].version>=2&&(C=f[S].grouping_type+"/0",A=new B(f[S].grouping_type,0),r.sample_groups_info[C]||(r.sample_groups_info[C]=A))},b.setSampleGroupProperties=function(r,a,u,f){var g,x;a.sample_groups=[];for(g in f)if(a.sample_groups[g]={},a.sample_groups[g].grouping_type=f[g].grouping_type,a.sample_groups[g].grouping_type_parameter=f[g].grouping_type_parameter,u>=f[g].last_sample_in_run&&(f[g].last_sample_in_run<0&&(f[g].last_sample_in_run=0),f[g].entry_index++,f[g].entry_index<=f[g].sbgp.entries.length-1&&(f[g].last_sample_in_run+=f[g].sbgp.entries[f[g].entry_index].sample_count)),f[g].entry_index<=f[g].sbgp.entries.length-1?a.sample_groups[g].group_description_index=f[g].sbgp.entries[f[g].entry_index].group_description_index:a.sample_groups[g].group_description_index=-1,a.sample_groups[g].group_description_index!==0){var S;f[g].fragment_description?S=f[g].fragment_description:S=f[g].description,a.sample_groups[g].group_description_index>0?(a.sample_groups[g].group_description_index>65535?x=(a.sample_groups[g].group_description_index>>16)-1:x=a.sample_groups[g].group_description_index-1,S&&x>=0&&(a.sample_groups[g].description=S.entries[x])):S&&S.version>=2&&S.default_group_description_index>0&&(a.sample_groups[g].description=S.entries[S.default_group_description_index-1])}},b.process_sdtp=function(r,a,u){a&&(r?(a.is_leading=r.is_leading[u],a.depends_on=r.sample_depends_on[u],a.is_depended_on=r.sample_is_depended_on[u],a.has_redundancy=r.sample_has_redundancy[u]):(a.is_leading=0,a.depends_on=0,a.is_depended_on=0,a.has_redundancy=0))},b.prototype.buildSampleLists=function(){var r,a;for(r=0;r<this.moov.traks.length;r++)a=this.moov.traks[r],this.buildTrakSampleLists(a)},b.prototype.buildTrakSampleLists=function(r){var a,u,f,g,x,S,A,C,B,R,M,N,L,W,k,j,Y,ut,it,gt,Q,rt,Z,H;if(r.samples=[],r.samples_duration=0,r.samples_size=0,u=r.mdia.minf.stbl.stco||r.mdia.minf.stbl.co64,f=r.mdia.minf.stbl.stsc,g=r.mdia.minf.stbl.stsz||r.mdia.minf.stbl.stz2,x=r.mdia.minf.stbl.stts,S=r.mdia.minf.stbl.ctts,A=r.mdia.minf.stbl.stss,C=r.mdia.minf.stbl.stsd,B=r.mdia.minf.stbl.subs,N=r.mdia.minf.stbl.stdp,R=r.mdia.minf.stbl.sbgps,M=r.mdia.minf.stbl.sgpds,ut=-1,it=-1,gt=-1,Q=-1,rt=0,Z=0,H=0,b.initSampleGroups(r,null,R,M),!(typeof g>"u")){for(a=0;a<g.sample_sizes.length;a++){var G={};G.number=a,G.track_id=r.tkhd.track_id,G.timescale=r.mdia.mdhd.timescale,G.alreadyRead=0,r.samples[a]=G,G.size=g.sample_sizes[a],r.samples_size+=G.size,a===0?(W=1,L=0,G.chunk_index=W,G.chunk_run_index=L,Y=f.samples_per_chunk[L],j=0,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0):a<Y?(G.chunk_index=W,G.chunk_run_index=L):(W++,G.chunk_index=W,j=0,W<=k||(L++,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0),G.chunk_run_index=L,Y+=f.samples_per_chunk[L]),G.description_index=f.sample_description_index[G.chunk_run_index]-1,G.description=C.entries[G.description_index],G.offset=u.chunk_offsets[G.chunk_index-1]+j,j+=G.size,a>ut&&(it++,ut<0&&(ut=0),ut+=x.sample_counts[it]),a>0?(r.samples[a-1].duration=x.sample_deltas[it],r.samples_duration+=r.samples[a-1].duration,G.dts=r.samples[a-1].dts+r.samples[a-1].duration):G.dts=0,S?(a>=gt&&(Q++,gt<0&&(gt=0),gt+=S.sample_counts[Q]),G.cts=r.samples[a].dts+S.sample_offsets[Q]):G.cts=G.dts,A?(a==A.sample_numbers[rt]-1?(G.is_sync=!0,rt++):(G.is_sync=!1,G.degradation_priority=0),B&&B.entries[Z].sample_delta+H==a+1&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta,Z++)):G.is_sync=!0,b.process_sdtp(r.mdia.minf.stbl.sdtp,G,G.number),N?G.degradation_priority=N.priority[a]:G.degradation_priority=0,B&&B.entries[Z].sample_delta+H==a&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta),(R.length>0||M.length>0)&&b.setSampleGroupProperties(r,G,a,r.sample_groups_info)}a>0&&(r.samples[a-1].duration=Math.max(r.mdia.mdhd.duration-r.samples[a-1].dts,0),r.samples_duration+=r.samples[a-1].duration)}},b.prototype.updateSampleLists=function(){var r,a,u,f,g,x,S,A,C,B,R,M,N,L,W;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(C=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,C.type=="moof")for(B=C,r=0;r<B.trafs.length;r++){for(R=B.trafs[r],M=this.getTrackById(R.tfhd.track_id),N=this.getTrexById(R.tfhd.track_id),R.tfhd.flags&l.TFHD_FLAG_SAMPLE_DESC?f=R.tfhd.default_sample_description_index:f=N?N.default_sample_description_index:1,R.tfhd.flags&l.TFHD_FLAG_SAMPLE_DUR?g=R.tfhd.default_sample_duration:g=N?N.default_sample_duration:0,R.tfhd.flags&l.TFHD_FLAG_SAMPLE_SIZE?x=R.tfhd.default_sample_size:x=N?N.default_sample_size:0,R.tfhd.flags&l.TFHD_FLAG_SAMPLE_FLAGS?S=R.tfhd.default_sample_flags:S=N?N.default_sample_flags:0,R.sample_number=0,R.sbgps.length>0&&b.initSampleGroups(M,R,R.sbgps,M.mdia.minf.stbl.sgpds,R.sgpds),a=0;a<R.truns.length;a++){var k=R.truns[a];for(u=0;u<k.sample_count;u++){L={},L.moof_number=this.lastMoofIndex,L.number_in_traf=R.sample_number,R.sample_number++,L.number=M.samples.length,R.first_sample_index=M.samples.length,M.samples.push(L),L.track_id=M.tkhd.track_id,L.timescale=M.mdia.mdhd.timescale,L.description_index=f-1,L.description=M.mdia.minf.stbl.stsd.entries[L.description_index],L.size=x,k.flags&l.TRUN_FLAGS_SIZE&&(L.size=k.sample_size[u]),M.samples_size+=L.size,L.duration=g,k.flags&l.TRUN_FLAGS_DURATION&&(L.duration=k.sample_duration[u]),M.samples_duration+=L.duration,M.first_traf_merged||u>0?L.dts=M.samples[M.samples.length-2].dts+M.samples[M.samples.length-2].duration:(R.tfdt?L.dts=R.tfdt.baseMediaDecodeTime:L.dts=0,M.first_traf_merged=!0),L.cts=L.dts,k.flags&l.TRUN_FLAGS_CTS_OFFSET&&(L.cts=L.dts+k.sample_composition_time_offset[u]),W=S,k.flags&l.TRUN_FLAGS_FLAGS?W=k.sample_flags[u]:u===0&&k.flags&l.TRUN_FLAGS_FIRST_FLAG&&(W=k.first_sample_flags),L.is_sync=!(W>>16&1),L.is_leading=W>>26&3,L.depends_on=W>>24&3,L.is_depended_on=W>>22&3,L.has_redundancy=W>>20&3,L.degradation_priority=W&65535;var j=!!(R.tfhd.flags&l.TFHD_FLAG_BASE_DATA_OFFSET),Y=!!(R.tfhd.flags&l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),ut=!!(k.flags&l.TRUN_FLAGS_DATA_OFFSET),it=0;j?it=R.tfhd.base_data_offset:Y||a===0?it=B.start:it=A,a===0&&u===0?ut?L.offset=it+k.data_offset:L.offset=it:L.offset=A,A=L.offset+L.size,(R.sbgps.length>0||R.sgpds.length>0||M.mdia.minf.stbl.sbgps.length>0||M.mdia.minf.stbl.sgpds.length>0)&&b.setSampleGroupProperties(M,L,L.number_in_traf,R.sample_groups_info)}}if(R.subs){M.has_fragment_subsamples=!0;var gt=R.first_sample_index;for(a=0;a<R.subs.entries.length;a++)gt+=R.subs.entries[a].sample_delta,L=M.samples[gt-1],L.subsamples=R.subs.entries[a].subsamples}}}},b.prototype.getSample=function(r,a){var u,f=r.samples[a];if(!this.moov)return null;if(!f.data)f.data=new Uint8Array(f.size),f.alreadyRead=0,this.samplesDataSize+=f.size,t.debug("ISOFile","Allocating sample #"+a+" on track #"+r.tkhd.track_id+" of size "+f.size+" (total: "+this.samplesDataSize+")");else if(f.alreadyRead==f.size)return f;for(;;){var g=this.stream.findPosition(!0,f.offset+f.alreadyRead,!1);if(g>-1){u=this.stream.buffers[g];var x=u.byteLength-(f.offset+f.alreadyRead-u.fileStart);if(f.size-f.alreadyRead<=x)return t.debug("ISOFile","Getting sample #"+a+" data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+(f.size-f.alreadyRead)+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,f.size-f.alreadyRead),u.usedBytes+=f.size-f.alreadyRead,this.stream.logBufferLevel(),f.alreadyRead=f.size,f;if(x===0)return null;t.debug("ISOFile","Getting sample #"+a+" partial data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+x+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,x),f.alreadyRead+=x,u.usedBytes+=x,this.stream.logBufferLevel()}else return null}},b.prototype.releaseSample=function(r,a){var u=r.samples[a];return u.data?(this.samplesDataSize-=u.size,u.data=null,u.alreadyRead=0,u.size):0},b.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},b.prototype.getCodecs=function(){var r,a="";for(r=0;r<this.moov.traks.length;r++){var u=this.moov.traks[r];r>0&&(a+=","),a+=u.mdia.minf.stbl.stsd.entries[0].getCodec()}return a},b.prototype.getTrexById=function(r){var a;if(!this.moov||!this.moov.mvex)return null;for(a=0;a<this.moov.mvex.trexs.length;a++){var u=this.moov.mvex.trexs[a];if(u.track_id==r)return u}return null},b.prototype.getTrackById=function(r){if(this.moov===void 0)return null;for(var a=0;a<this.moov.traks.length;a++){var u=this.moov.traks[a];if(u.tkhd.track_id==r)return u}return null},b.prototype.items=[],b.prototype.entity_groups=[],b.prototype.itemsDataSize=0,b.prototype.flattenItemInfo=function(){var r=this.items,a=this.entity_groups,u,f,g,x=this.meta;if(x!=null&&x.hdlr!==void 0&&x.iinf!==void 0){for(u=0;u<x.iinf.item_infos.length;u++)g={},g.id=x.iinf.item_infos[u].item_ID,r[g.id]=g,g.ref_to=[],g.name=x.iinf.item_infos[u].item_name,x.iinf.item_infos[u].protection_index>0&&(g.protection=x.ipro.protections[x.iinf.item_infos[u].protection_index-1]),x.iinf.item_infos[u].item_type?g.type=x.iinf.item_infos[u].item_type:g.type="mime",g.content_type=x.iinf.item_infos[u].content_type,g.content_encoding=x.iinf.item_infos[u].content_encoding;if(x.grpl)for(u=0;u<x.grpl.boxes.length;u++)entity_group={},entity_group.id=x.grpl.boxes[u].group_id,entity_group.entity_ids=x.grpl.boxes[u].entity_ids,entity_group.type=x.grpl.boxes[u].type,a[entity_group.id]=entity_group;if(x.iloc)for(u=0;u<x.iloc.items.length;u++){var S=x.iloc.items[u];switch(g=r[S.item_ID],S.data_reference_index!==0&&(t.warn("Item storage with reference to other files: not supported"),g.source=x.dinf.boxes[S.data_reference_index-1]),S.construction_method){case 0:break;case 1:t.warn("Item storage with construction_method : not supported");break;case 2:t.warn("Item storage with construction_method : not supported");break}for(g.extents=[],g.size=0,f=0;f<S.extents.length;f++)g.extents[f]={},g.extents[f].offset=S.extents[f].extent_offset+S.base_offset,g.extents[f].length=S.extents[f].extent_length,g.extents[f].alreadyRead=0,g.size+=g.extents[f].length}if(x.pitm&&(r[x.pitm.item_id].primary=!0),x.iref)for(u=0;u<x.iref.references.length;u++){var A=x.iref.references[u];for(f=0;f<A.references.length;f++)r[A.from_item_ID].ref_to.push({type:A.type,id:A.references[f]})}if(x.iprp)for(var C=0;C<x.iprp.ipmas.length;C++){var B=x.iprp.ipmas[C];for(u=0;u<B.associations.length;u++){var R=B.associations[u];if(g=r[R.id],g||(g=a[R.id]),g)for(g.properties===void 0&&(g.properties={},g.properties.boxes=[]),f=0;f<R.props.length;f++){var M=R.props[f];if(M.property_index>0&&M.property_index-1<x.iprp.ipco.boxes.length){var N=x.iprp.ipco.boxes[M.property_index-1];g.properties[N.type]=N,g.properties.boxes.push(N)}}}}}},b.prototype.getItem=function(r){var a,u;if(!this.meta)return null;if(u=this.items[r],!u.data&&u.size)u.data=new Uint8Array(u.size),u.alreadyRead=0,this.itemsDataSize+=u.size,t.debug("ISOFile","Allocating item #"+r+" of size "+u.size+" (total: "+this.itemsDataSize+")");else if(u.alreadyRead===u.size)return u;for(var f=0;f<u.extents.length;f++){var g=u.extents[f];if(g.alreadyRead!==g.length){var x=this.stream.findPosition(!0,g.offset+g.alreadyRead,!1);if(x>-1){a=this.stream.buffers[x];var S=a.byteLength-(g.offset+g.alreadyRead-a.fileStart);if(g.length-g.alreadyRead<=S)t.debug("ISOFile","Getting item #"+r+" extent #"+f+" data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+(g.length-g.alreadyRead)+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,g.length-g.alreadyRead),a.usedBytes+=g.length-g.alreadyRead,this.stream.logBufferLevel(),u.alreadyRead+=g.length-g.alreadyRead,g.alreadyRead=g.length;else return t.debug("ISOFile","Getting item #"+r+" extent #"+f+" partial data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+S+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,S),g.alreadyRead+=S,u.alreadyRead+=S,a.usedBytes+=S,this.stream.logBufferLevel(),null}else return null}}return u.alreadyRead===u.size?u:null},b.prototype.releaseItem=function(r){var a=this.items[r];if(a.data){this.itemsDataSize-=a.size,a.data=null,a.alreadyRead=0;for(var u=0;u<a.extents.length;u++){var f=a.extents[u];f.alreadyRead=0}return a.size}else return 0},b.prototype.processItems=function(r){for(var a in this.items){var u=this.items[a];this.getItem(u.id),r&&!u.sent&&(r(u),u.sent=!0,u.data=null)}},b.prototype.hasItem=function(r){for(var a in this.items){var u=this.items[a];if(u.name===r)return u.id}return-1},b.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},b.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},b.prototype.itemToFragmentedTrackFile=function(r){var a=r||{},u=null;if(a.itemId?u=this.getItem(a.itemId):u=this.getPrimaryItem(),u==null)return null;var f=new b;f.discardMdatData=!1;var g={type:u.type,description_boxes:u.properties.boxes};u.properties.ispe&&(g.width=u.properties.ispe.image_width,g.height=u.properties.ispe.image_height);var x=f.addTrack(g);return x?(f.addSample(x,u.data),f):null},b.prototype.write=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r)},b.prototype.createFragment=function(r,a,u){var f=this.getTrackById(r),g=this.getSample(f,a);if(g==null)return this.setNextSeekPositionFromSample(f.samples[a]),null;var x=u||new n;x.endianness=n.BIG_ENDIAN;var S=this.createSingleSampleMoof(g);S.write(x),S.trafs[0].truns[0].data_offset=S.size+8,t.debug("MP4Box","Adjusting data_offset with new value "+S.trafs[0].truns[0].data_offset),x.adjustUint32(S.trafs[0].truns[0].data_offset_position,S.trafs[0].truns[0].data_offset);var A=new l.mdatBox;return A.data=g.data,A.write(x),x},b.writeInitializationSegment=function(r,a,u,f){var g;t.debug("ISOFile","Generating initialization segment");var x=new n;x.endianness=n.BIG_ENDIAN,r.write(x);var S=a.add("mvex");for(u&&S.add("mehd").set("fragment_duration",u),g=0;g<a.traks.length;g++)S.add("trex").set("track_id",a.traks[g].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",f).set("default_sample_size",0).set("default_sample_flags",65536);return a.write(x),x.buffer},b.prototype.save=function(r){var a=new n;a.endianness=n.BIG_ENDIAN,this.write(a),a.save(r)},b.prototype.getBuffer=function(){var r=new n;return r.endianness=n.BIG_ENDIAN,this.write(r),r.buffer},b.prototype.initializeSegmentation=function(){var r,a,u,f;for(this.onSegment===null&&t.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),a=[],r=0;r<this.fragmentedTracks.length;r++){var g=new l.moovBox;g.mvhd=this.moov.mvhd,g.boxes.push(g.mvhd),u=this.getTrackById(this.fragmentedTracks[r].id),g.boxes.push(u),g.traks.push(u),f={},f.id=u.tkhd.track_id,f.user=this.fragmentedTracks[r].user,f.buffer=b.writeInitializationSegment(this.ftyp,g,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[r].samples.length>0?this.moov.traks[r].samples[0].duration:0),a.push(f)}return a},l.Box.prototype.printHeader=function(r){this.size+=8,this.size>o&&(this.size+=8),this.type==="uuid"&&(this.size+=16),r.log(r.indent+"size:"+this.size),r.log(r.indent+"type:"+this.type)},l.FullBox.prototype.printHeader=function(r){this.size+=4,l.Box.prototype.printHeader.call(this,r),r.log(r.indent+"version:"+this.version),r.log(r.indent+"flags:"+this.flags)},l.Box.prototype.print=function(r){this.printHeader(r)},l.ContainerBox.prototype.print=function(r){this.printHeader(r);for(var a=0;a<this.boxes.length;a++)if(this.boxes[a]){var u=r.indent;r.indent+=" ",this.boxes[a].print(r),r.indent=u}},b.prototype.print=function(r){r.indent="";for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&this.boxes[a].print(r)},l.mvhdBox.prototype.print=function(r){l.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"timescale: "+this.timescale),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"rate: "+this.rate),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"next_track_id: "+this.next_track_id)},l.tkhdBox.prototype.print=function(r){l.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"track_id: "+this.track_id),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"layer: "+this.layer),r.log(r.indent+"alternate_group: "+this.alternate_group),r.log(r.indent+"width: "+this.width),r.log(r.indent+"height: "+this.height)};var T={};T.createFile=function(r,a){var u=r!==void 0?r:!0,f=new b(a);return f.discardMdatData=!u,f},s.createFile=T.createFile})(j0);const pp=Cc(j0);var q0={};(function(s){var t=function(){var r=new Date,a=4,u=3,f=2,g=1,x=a,S={setLogLevel:function(A){A==this.debug?x=g:A==this.info?x=f:A==this.warn?x=u:(A==this.error,x=a)},debug:function(A,C){console.debug===void 0&&(console.debug=console.log),g>=x&&console.debug("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},log:function(A,C){this.debug(A.msg)},info:function(A,C){f>=x&&console.info("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},warn:function(A,C){u>=x&&console.warn("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)},error:function(A,C){a>=x&&console.error("["+t.getDurationString(new Date-r,1e3)+"]","["+A+"]",C)}};return S}();t.getDurationString=function(r,a){var u;function f(B,R){for(var M=""+B,N=M.split(".");N[0].length<R;)N[0]="0"+N[0];return N.join(".")}r<0?(u=!0,r=-r):u=!1;var g=a||1,x=r/g,S=Math.floor(x/3600);x-=S*3600;var A=Math.floor(x/60);x-=A*60;var C=x*1e3;return x=Math.floor(x),C-=x*1e3,C=Math.floor(C),(u?"-":"")+S+":"+f(A,2)+":"+f(x,2)+"."+f(C,3)},t.printRanges=function(r){var a=r.length;if(a>0){for(var u="",f=0;f<a;f++)f>0&&(u+=","),u+="["+t.getDurationString(r.start(f))+","+t.getDurationString(r.end(f))+"]";return u}else return"(empty)"},s.Log=t;var e=function(r){if(r instanceof ArrayBuffer)this.buffer=r,this.dataview=new DataView(r);else throw"Needs an array buffer";this.position=0};e.prototype.getPosition=function(){return this.position},e.prototype.getEndPosition=function(){return this.buffer.byteLength},e.prototype.getLength=function(){return this.buffer.byteLength},e.prototype.seek=function(r){var a=Math.max(0,Math.min(this.buffer.byteLength,r));return this.position=isNaN(a)||!isFinite(a)?0:a,!0},e.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},e.prototype.readAnyInt=function(r,a){var u=0;if(this.position+r<=this.buffer.byteLength){switch(r){case 1:a?u=this.dataview.getInt8(this.position):u=this.dataview.getUint8(this.position);break;case 2:a?u=this.dataview.getInt16(this.position):u=this.dataview.getUint16(this.position);break;case 3:if(a)throw"No method for reading signed 24 bits values";u=this.dataview.getUint8(this.position)<<16,u|=this.dataview.getUint8(this.position+1)<<8,u|=this.dataview.getUint8(this.position+2);break;case 4:a?u=this.dataview.getInt32(this.position):u=this.dataview.getUint32(this.position);break;case 8:if(a)throw"No method for reading signed 64 bits values";u=this.dataview.getUint32(this.position)<<32,u|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+r}return this.position+=r,u}else throw"Not enough bytes in buffer"},e.prototype.readUint8=function(){return this.readAnyInt(1,!1)},e.prototype.readUint16=function(){return this.readAnyInt(2,!1)},e.prototype.readUint24=function(){return this.readAnyInt(3,!1)},e.prototype.readUint32=function(){return this.readAnyInt(4,!1)},e.prototype.readUint64=function(){return this.readAnyInt(8,!1)},e.prototype.readString=function(r){if(this.position+r<=this.buffer.byteLength){for(var a="",u=0;u<r;u++)a+=String.fromCharCode(this.readUint8());return a}else throw"Not enough bytes in buffer"},e.prototype.readCString=function(){for(var r=[];;){var a=this.readUint8();if(a!==0)r.push(a);else break}return String.fromCharCode.apply(null,r)},e.prototype.readInt8=function(){return this.readAnyInt(1,!0)},e.prototype.readInt16=function(){return this.readAnyInt(2,!0)},e.prototype.readInt32=function(){return this.readAnyInt(4,!0)},e.prototype.readInt64=function(){return this.readAnyInt(8,!1)},e.prototype.readUint8Array=function(r){for(var a=new Uint8Array(r),u=0;u<r;u++)a[u]=this.readUint8();return a},e.prototype.readInt16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readInt16();return a},e.prototype.readUint16Array=function(r){for(var a=new Int16Array(r),u=0;u<r;u++)a[u]=this.readUint16();return a},e.prototype.readUint32Array=function(r){for(var a=new Uint32Array(r),u=0;u<r;u++)a[u]=this.readUint32();return a},e.prototype.readInt32Array=function(r){for(var a=new Int32Array(r),u=0;u<r;u++)a[u]=this.readInt32();return a},s.MP4BoxStream=e;var n=function(r,a,u){this._byteOffset=a||0,r instanceof ArrayBuffer?this.buffer=r:typeof r=="object"?(this.dataView=r,a&&(this._byteOffset+=a)):this.buffer=new ArrayBuffer(r||0),this.position=0,this.endianness=u??n.LITTLE_ENDIAN};n.prototype={},n.prototype.getPosition=function(){return this.position},n.prototype._realloc=function(r){if(this._dynamicSize){var a=this._byteOffset+this.position+r,u=this._buffer.byteLength;if(a<=u){a>this._byteLength&&(this._byteLength=a);return}for(u<1&&(u=1);a>u;)u*=2;var f=new ArrayBuffer(u),g=new Uint8Array(this._buffer),x=new Uint8Array(f,0,g.length);x.set(g),this.buffer=f,this._byteLength=a}},n.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var r=new ArrayBuffer(this._byteLength),a=new Uint8Array(r),u=new Uint8Array(this._buffer,0,a.length);a.set(u),this.buffer=r}},n.BIG_ENDIAN=!1,n.LITTLE_ENDIAN=!0,n.prototype._byteLength=0,Object.defineProperty(n.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(n.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(r){this._buffer=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(r){this._byteOffset=r,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(n.prototype,"dataView",{get:function(){return this._dataView},set:function(r){this._byteOffset=r.byteOffset,this._buffer=r.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+r.byteLength}}),n.prototype.seek=function(r){var a=Math.max(0,Math.min(this.byteLength,r));this.position=isNaN(a)||!isFinite(a)?0:a},n.prototype.isEof=function(){return this.position>=this._byteLength},n.prototype.mapUint8Array=function(r){this._realloc(r*1);var a=new Uint8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.readInt32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Int32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Int16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt8Array=function(r){r=r??this.byteLength-this.position;var a=new Int8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readUint32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Uint32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint16Array=function(r,a){r=r??this.byteLength-this.position/2;var u=new Uint16Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readUint8Array=function(r){r=r??this.byteLength-this.position;var a=new Uint8Array(r);return n.memcpy(a.buffer,0,this.buffer,this.byteOffset+this.position,r*a.BYTES_PER_ELEMENT),this.position+=a.byteLength,a},n.prototype.readFloat64Array=function(r,a){r=r??this.byteLength-this.position/8;var u=new Float64Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readFloat32Array=function(r,a){r=r??this.byteLength-this.position/4;var u=new Float32Array(r);return n.memcpy(u.buffer,0,this.buffer,this.byteOffset+this.position,r*u.BYTES_PER_ELEMENT),n.arrayToNative(u,a??this.endianness),this.position+=u.byteLength,u},n.prototype.readInt32=function(r){var a=this._dataView.getInt32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readInt16=function(r){var a=this._dataView.getInt16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readInt8=function(){var r=this._dataView.getInt8(this.position);return this.position+=1,r},n.prototype.readUint32=function(r){var a=this._dataView.getUint32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readUint16=function(r){var a=this._dataView.getUint16(this.position,r??this.endianness);return this.position+=2,a},n.prototype.readUint8=function(){var r=this._dataView.getUint8(this.position);return this.position+=1,r},n.prototype.readFloat32=function(r){var a=this._dataView.getFloat32(this.position,r??this.endianness);return this.position+=4,a},n.prototype.readFloat64=function(r){var a=this._dataView.getFloat64(this.position,r??this.endianness);return this.position+=8,a},n.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,n.memcpy=function(r,a,u,f,g){var x=new Uint8Array(r,a,g),S=new Uint8Array(u,f,g);x.set(S)},n.arrayToNative=function(r,a){return a==this.endianness?r:this.flipArrayEndianness(r)},n.nativeToEndian=function(r,a){return this.endianness==a?r:this.flipArrayEndianness(r)},n.flipArrayEndianness=function(r){for(var a=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),u=0;u<r.byteLength;u+=r.BYTES_PER_ELEMENT)for(var f=u+r.BYTES_PER_ELEMENT-1,g=u;f>g;f--,g++){var x=a[g];a[g]=a[f],a[f]=x}return r},n.prototype.failurePosition=0,String.fromCharCodeUint8=function(r){for(var a=[],u=0;u<r.length;u++)a[u]=r[u];return String.fromCharCode.apply(null,a)},n.prototype.readString=function(r,a){return a==null||a=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(r??this.byteLength-this.position)]):new TextDecoder(a).decode(this.mapUint8Array(r))},n.prototype.readCString=function(r){var a=this.byteLength-this.position,u=new Uint8Array(this._buffer,this._byteOffset+this.position),f=a;r!=null&&(f=Math.min(r,a));for(var g=0;g<f&&u[g]!==0;g++);var x=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(g)]);return r!=null?this.position+=f-g:g!=a&&(this.position+=1),x};var o=Math.pow(2,32);n.prototype.readInt64=function(){return this.readInt32()*o+this.readUint32()},n.prototype.readUint64=function(){return this.readUint32()*o+this.readUint32()},n.prototype.readInt64=function(){return this.readUint32()*o+this.readUint32()},n.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},s.DataStream=n,n.prototype.save=function(r){var a=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var u=window.URL.createObjectURL(a),f=document.createElement("a");document.body.appendChild(f),f.setAttribute("href",u),f.setAttribute("download",r),f.setAttribute("target","_self"),f.click(),window.URL.revokeObjectURL(u)}else throw"DataStream.save: Can't create object URL."},n.prototype._dynamicSize=!0,Object.defineProperty(n.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(r){r||this._trimAlloc(),this._dynamicSize=r}}),n.prototype.shift=function(r){var a=new ArrayBuffer(this._byteLength-r),u=new Uint8Array(a),f=new Uint8Array(this._buffer,r,u.length);u.set(f),this.buffer=a,this.position-=r},n.prototype.writeInt32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Int32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt32(r[u],a)},n.prototype.writeInt16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Int16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeInt16(r[u],a)},n.prototype.writeInt8Array=function(r){if(this._realloc(r.length*1),r instanceof Int8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapInt8Array(r.length);else for(var a=0;a<r.length;a++)this.writeInt8(r[a])},n.prototype.writeUint32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Uint32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint32(r[u],a)},n.prototype.writeUint16Array=function(r,a){if(this._realloc(r.length*2),r instanceof Uint16Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint16Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeUint16(r[u],a)},n.prototype.writeUint8Array=function(r){if(this._realloc(r.length*1),r instanceof Uint8Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapUint8Array(r.length);else for(var a=0;a<r.length;a++)this.writeUint8(r[a])},n.prototype.writeFloat64Array=function(r,a){if(this._realloc(r.length*8),r instanceof Float64Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat64Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat64(r[u],a)},n.prototype.writeFloat32Array=function(r,a){if(this._realloc(r.length*4),r instanceof Float32Array&&this.byteOffset+this.position%r.BYTES_PER_ELEMENT===0)n.memcpy(this._buffer,this.byteOffset+this.position,r.buffer,0,r.byteLength),this.mapFloat32Array(r.length,a);else for(var u=0;u<r.length;u++)this.writeFloat32(r[u],a)},n.prototype.writeInt32=function(r,a){this._realloc(4),this._dataView.setInt32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeInt16=function(r,a){this._realloc(2),this._dataView.setInt16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeInt8=function(r){this._realloc(1),this._dataView.setInt8(this.position,r),this.position+=1},n.prototype.writeUint32=function(r,a){this._realloc(4),this._dataView.setUint32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeUint16=function(r,a){this._realloc(2),this._dataView.setUint16(this.position,r,a??this.endianness),this.position+=2},n.prototype.writeUint8=function(r){this._realloc(1),this._dataView.setUint8(this.position,r),this.position+=1},n.prototype.writeFloat32=function(r,a){this._realloc(4),this._dataView.setFloat32(this.position,r,a??this.endianness),this.position+=4},n.prototype.writeFloat64=function(r,a){this._realloc(8),this._dataView.setFloat64(this.position,r,a??this.endianness),this.position+=8},n.prototype.writeUCS2String=function(r,a,u){u==null&&(u=r.length);for(var f=0;f<r.length&&f<u;f++)this.writeUint16(r.charCodeAt(f),a);for(;f<u;f++)this.writeUint16(0)},n.prototype.writeString=function(r,a,u){var f=0;if(a==null||a=="ASCII")if(u!=null){var g=Math.min(r.length,u);for(f=0;f<g;f++)this.writeUint8(r.charCodeAt(f));for(;f<u;f++)this.writeUint8(0)}else for(f=0;f<r.length;f++)this.writeUint8(r.charCodeAt(f));else this.writeUint8Array(new TextEncoder(a).encode(r.substring(0,u)))},n.prototype.writeCString=function(r,a){var u=0;if(a!=null){var f=Math.min(r.length,a);for(u=0;u<f;u++)this.writeUint8(r.charCodeAt(u));for(;u<a;u++)this.writeUint8(0)}else{for(u=0;u<r.length;u++)this.writeUint8(r.charCodeAt(u));this.writeUint8(0)}},n.prototype.writeStruct=function(r,a){for(var u=0;u<r.length;u+=2){var f=r[u+1];this.writeType(f,a[r[u]],a)}},n.prototype.writeType=function(r,a,u){var f;if(typeof r=="function")return r(this,a);if(typeof r=="object"&&!(r instanceof Array))return r.set(this,a,u);var g=null,x="ASCII",S=this.position;switch(typeof r=="string"&&/:/.test(r)&&(f=r.split(":"),r=f[0],g=parseInt(f[1])),typeof r=="string"&&/,/.test(r)&&(f=r.split(","),r=f[0],x=parseInt(f[1])),r){case"uint8":this.writeUint8(a);break;case"int8":this.writeInt8(a);break;case"uint16":this.writeUint16(a,this.endianness);break;case"int16":this.writeInt16(a,this.endianness);break;case"uint32":this.writeUint32(a,this.endianness);break;case"int32":this.writeInt32(a,this.endianness);break;case"float32":this.writeFloat32(a,this.endianness);break;case"float64":this.writeFloat64(a,this.endianness);break;case"uint16be":this.writeUint16(a,n.BIG_ENDIAN);break;case"int16be":this.writeInt16(a,n.BIG_ENDIAN);break;case"uint32be":this.writeUint32(a,n.BIG_ENDIAN);break;case"int32be":this.writeInt32(a,n.BIG_ENDIAN);break;case"float32be":this.writeFloat32(a,n.BIG_ENDIAN);break;case"float64be":this.writeFloat64(a,n.BIG_ENDIAN);break;case"uint16le":this.writeUint16(a,n.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(a,n.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(a,n.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(a,n.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(a,n.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(a,n.LITTLE_ENDIAN);break;case"cstring":this.writeCString(a,g);break;case"string":this.writeString(a,x,g);break;case"u16string":this.writeUCS2String(a,this.endianness,g);break;case"u16stringle":this.writeUCS2String(a,n.LITTLE_ENDIAN,g);break;case"u16stringbe":this.writeUCS2String(a,n.BIG_ENDIAN,g);break;default:if(r.length==3){for(var A=r[1],C=0;C<a.length;C++)this.writeType(A,a[C]);break}else{this.writeStruct(r,a);break}}g!=null&&(this.position=S,this._realloc(g),this.position=S+g)},n.prototype.writeUint64=function(r){var a=Math.floor(r/o);this.writeUint32(a),this.writeUint32(r&4294967295)},n.prototype.writeUint24=function(r){this.writeUint8((r&16711680)>>16),this.writeUint8((r&65280)>>8),this.writeUint8(r&255)},n.prototype.adjustUint32=function(r,a){var u=this.position;this.seek(r),this.writeUint32(a),this.seek(u)},n.prototype.mapInt32Array=function(r,a){this._realloc(r*4);var u=new Int32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapInt16Array=function(r,a){this._realloc(r*2);var u=new Int16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapInt8Array=function(r){this._realloc(r*1);var a=new Int8Array(this._buffer,this.byteOffset+this.position,r);return this.position+=r*1,a},n.prototype.mapUint32Array=function(r,a){this._realloc(r*4);var u=new Uint32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u},n.prototype.mapUint16Array=function(r,a){this._realloc(r*2);var u=new Uint16Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*2,u},n.prototype.mapFloat64Array=function(r,a){this._realloc(r*8);var u=new Float64Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*8,u},n.prototype.mapFloat32Array=function(r,a){this._realloc(r*4);var u=new Float32Array(this._buffer,this.byteOffset+this.position,r);return n.arrayToNative(u,a??this.endianness),this.position+=r*4,u};var h=function(r){this.buffers=[],this.bufferIndex=-1,r&&(this.insertBuffer(r),this.bufferIndex=0)};h.prototype=new n(new ArrayBuffer,0,n.BIG_ENDIAN),h.prototype.initialized=function(){var r;return this.bufferIndex>-1?!0:this.buffers.length>0?(r=this.buffers[0],r.fileStart===0?(this.buffer=r,this.bufferIndex=0,t.debug("MultiBufferStream","Stream ready for parsing"),!0):(t.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(t.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)},ArrayBuffer.concat=function(r,a){t.debug("ArrayBuffer","Trying to create a new buffer of size: "+(r.byteLength+a.byteLength));var u=new Uint8Array(r.byteLength+a.byteLength);return u.set(new Uint8Array(r),0),u.set(new Uint8Array(a),r.byteLength),u.buffer},h.prototype.reduceBuffer=function(r,a,u){var f;return f=new Uint8Array(u),f.set(new Uint8Array(r,a,u)),f.buffer.fileStart=r.fileStart+a,f.buffer.usedBytes=0,f.buffer},h.prototype.insertBuffer=function(r){for(var a=!0,u=0;u<this.buffers.length;u++){var f=this.buffers[u];if(r.fileStart<=f.fileStart){if(r.fileStart===f.fileStart)if(r.byteLength>f.byteLength){this.buffers.splice(u,1),u--;continue}else t.warn("MultiBufferStream","Buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+") already appended, ignoring");else r.fileStart+r.byteLength<=f.fileStart||(r=this.reduceBuffer(r,0,f.fileStart-r.fileStart)),t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.splice(u,0,r),u===0&&(this.buffer=r);a=!1;break}else if(r.fileStart<f.fileStart+f.byteLength){var g=f.fileStart+f.byteLength-r.fileStart,x=r.byteLength-g;if(x>0)r=this.reduceBuffer(r,g,x);else{a=!1;break}}}a&&(t.debug("MultiBufferStream","Appending new buffer (fileStart: "+r.fileStart+" - Length: "+r.byteLength+")"),this.buffers.push(r),u===0&&(this.buffer=r))},h.prototype.logBufferLevel=function(r){var a,u,f,g,x=[],S,A="";for(f=0,g=0,a=0;a<this.buffers.length;a++)u=this.buffers[a],a===0?(S={},x.push(S),S.start=u.fileStart,S.end=u.fileStart+u.byteLength,A+="["+S.start+"-"):S.end===u.fileStart?S.end=u.fileStart+u.byteLength:(S={},S.start=u.fileStart,A+=x[x.length-1].end-1+"], ["+S.start+"-",S.end=u.fileStart+u.byteLength,x.push(S)),f+=u.usedBytes,g+=u.byteLength;x.length>0&&(A+=S.end-1+"]");var C=r?t.info:t.debug;this.buffers.length===0?C("MultiBufferStream","No more buffer in memory"):C("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+f+"/"+g+" bytes), continuous ranges: "+A)},h.prototype.cleanBuffers=function(){var r,a;for(r=0;r<this.buffers.length;r++)a=this.buffers[r],a.usedBytes===a.byteLength&&(t.debug("MultiBufferStream","Removing buffer #"+r),this.buffers.splice(r,1),r--)},h.prototype.mergeNextBuffer=function(){var r;if(this.bufferIndex+1<this.buffers.length)if(r=this.buffers[this.bufferIndex+1],r.fileStart===this.buffer.fileStart+this.buffer.byteLength){var a=this.buffer.byteLength,u=this.buffer.usedBytes,f=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,r),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=u,this.buffer.fileStart=f,t.debug("ISOFile","Concatenating buffer for box parsing (length: "+a+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1},h.prototype.findPosition=function(r,a,u){var f,g=null,x=-1;for(r===!0?f=0:f=this.bufferIndex;f<this.buffers.length&&(g=this.buffers[f],g.fileStart<=a);){x=f,u&&(g.fileStart+g.byteLength<=a?g.usedBytes=g.byteLength:g.usedBytes=a-g.fileStart,this.logBufferLevel());f++}return x!==-1?(g=this.buffers[x],g.fileStart+g.byteLength>=a?(t.debug("MultiBufferStream","Found position in existing buffer #"+x),x):-1):-1},h.prototype.findEndContiguousBuf=function(r){var a,u,f,g=r!==void 0?r:this.bufferIndex;if(u=this.buffers[g],this.buffers.length>g+1)for(a=g+1;a<this.buffers.length&&(f=this.buffers[a],f.fileStart===u.fileStart+u.byteLength);a++)u=f;return u.fileStart+u.byteLength},h.prototype.getEndFilePositionAfter=function(r){var a=this.findPosition(!0,r,!1);return a!==-1?this.findEndContiguousBuf(a):r},h.prototype.addUsedBytes=function(r){this.buffer.usedBytes+=r,this.logBufferLevel()},h.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},h.prototype.seek=function(r,a,u){var f;return f=this.findPosition(a,r,u),f!==-1?(this.buffer=this.buffers[f],this.bufferIndex=f,this.position=r-this.buffer.fileStart,t.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(t.debug("MultiBufferStream","Position "+r+" not found in buffered data"),!1)},h.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},h.prototype.getLength=function(){return this.byteLength},h.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},s.MultiBufferStream=h;var d=function(){var r=3,a=4,u=5,f=6,g=[];g[r]="ES_Descriptor",g[a]="DecoderConfigDescriptor",g[u]="DecoderSpecificInfo",g[f]="SLConfigDescriptor",this.getDescriptorName=function(A){return g[A]};var x=this,S={};return this.parseOneDescriptor=function(A){var C=0,B,R,M;for(B=A.readUint8(),M=A.readUint8();M&128;)C=(M&127)<<7,M=A.readUint8();return C+=M&127,t.debug("MPEG4DescriptorParser","Found "+(g[B]||"Descriptor "+B)+", size "+C+" at position "+A.getPosition()),g[B]?R=new S[g[B]](C):R=new S.Descriptor(C),R.parse(A),R},S.Descriptor=function(A,C){this.tag=A,this.size=C,this.descs=[]},S.Descriptor.prototype.parse=function(A){this.data=A.readUint8Array(this.size)},S.Descriptor.prototype.findDescriptor=function(A){for(var C=0;C<this.descs.length;C++)if(this.descs[C].tag==A)return this.descs[C];return null},S.Descriptor.prototype.parseRemainingDescriptors=function(A){for(var C=A.position;A.position<C+this.size;){var B=x.parseOneDescriptor(A);this.descs.push(B)}},S.ES_Descriptor=function(A){S.Descriptor.call(this,r,A)},S.ES_Descriptor.prototype=new S.Descriptor,S.ES_Descriptor.prototype.parse=function(A){if(this.ES_ID=A.readUint16(),this.flags=A.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=A.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var C=A.readUint8();this.URL=A.readString(C),this.size-=C+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=A.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(A)},S.ES_Descriptor.prototype.getOTI=function(A){var C=this.findDescriptor(a);return C?C.oti:0},S.ES_Descriptor.prototype.getAudioConfig=function(A){var C=this.findDescriptor(a);if(!C)return null;var B=C.findDescriptor(u);if(B&&B.data){var R=(B.data[0]&248)>>3;return R===31&&B.data.length>=2&&(R=32+((B.data[0]&7)<<3)+((B.data[1]&224)>>5)),R}else return null},S.DecoderConfigDescriptor=function(A){S.Descriptor.call(this,a,A)},S.DecoderConfigDescriptor.prototype=new S.Descriptor,S.DecoderConfigDescriptor.prototype.parse=function(A){this.oti=A.readUint8(),this.streamType=A.readUint8(),this.upStream=(this.streamType>>1&1)!==0,this.streamType=this.streamType>>>2,this.bufferSize=A.readUint24(),this.maxBitrate=A.readUint32(),this.avgBitrate=A.readUint32(),this.size-=13,this.parseRemainingDescriptors(A)},S.DecoderSpecificInfo=function(A){S.Descriptor.call(this,u,A)},S.DecoderSpecificInfo.prototype=new S.Descriptor,S.SLConfigDescriptor=function(A){S.Descriptor.call(this,f,A)},S.SLConfigDescriptor.prototype=new S.Descriptor,this};s.MPEG4DescriptorParser=d;var l={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"],["grpl"],["j2kH"],["etyp",["tyco"]]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){l.FullBox.prototype=new l.Box,l.ContainerBox.prototype=new l.Box,l.SampleEntry.prototype=new l.Box,l.TrackGroupTypeBox.prototype=new l.FullBox,l.BASIC_BOXES.forEach(function(r){l.createBoxCtor(r)}),l.FULL_BOXES.forEach(function(r){l.createFullBoxCtor(r)}),l.CONTAINER_BOXES.forEach(function(r){l.createContainerBoxCtor(r[0],null,r[1])})},Box:function(r,a,u){this.type=r,this.size=a,this.uuid=u},FullBox:function(r,a,u){l.Box.call(this,r,a,u),this.flags=0,this.version=0},ContainerBox:function(r,a,u){l.Box.call(this,r,a,u),this.boxes=[]},SampleEntry:function(r,a,u,f){l.ContainerBox.call(this,r,a),this.hdr_size=u,this.start=f},SampleGroupEntry:function(r){this.grouping_type=r},TrackGroupTypeBox:function(r,a){l.FullBox.call(this,r,a)},createBoxCtor:function(r,a){l.boxCodes.push(r),l[r+"Box"]=function(u){l.Box.call(this,r,u)},l[r+"Box"].prototype=new l.Box,a&&(l[r+"Box"].prototype.parse=a)},createFullBoxCtor:function(r,a){l[r+"Box"]=function(u){l.FullBox.call(this,r,u)},l[r+"Box"].prototype=new l.FullBox,l[r+"Box"].prototype.parse=function(u){this.parseFullHeader(u),a&&a.call(this,u)}},addSubBoxArrays:function(r){if(r){this.subBoxNames=r;for(var a=r.length,u=0;u<a;u++)this[r[u]+"s"]=[]}},createContainerBoxCtor:function(r,a,u){l[r+"Box"]=function(f){l.ContainerBox.call(this,r,f),l.addSubBoxArrays.call(this,u)},l[r+"Box"].prototype=new l.ContainerBox,a&&(l[r+"Box"].prototype.parse=a)},createMediaSampleEntryCtor:function(r,a,u){l.sampleEntryCodes[r]=[],l[r+"SampleEntry"]=function(f,g){l.SampleEntry.call(this,f,g),l.addSubBoxArrays.call(this,u)},l[r+"SampleEntry"].prototype=new l.SampleEntry,a&&(l[r+"SampleEntry"].prototype.parse=a)},createSampleEntryCtor:function(r,a,u,f){l.sampleEntryCodes[r].push(a),l[a+"SampleEntry"]=function(g){l[r+"SampleEntry"].call(this,a,g),l.addSubBoxArrays.call(this,f)},l[a+"SampleEntry"].prototype=new l[r+"SampleEntry"],u&&(l[a+"SampleEntry"].prototype.parse=u)},createEncryptedSampleEntryCtor:function(r,a,u){l.createSampleEntryCtor.call(this,r,a,u,["sinf"])},createSampleGroupCtor:function(r,a){l[r+"SampleGroupEntry"]=function(u){l.SampleGroupEntry.call(this,r,u)},l[r+"SampleGroupEntry"].prototype=new l.SampleGroupEntry,a&&(l[r+"SampleGroupEntry"].prototype.parse=a)},createTrackGroupCtor:function(r,a){l[r+"TrackGroupTypeBox"]=function(u){l.TrackGroupTypeBox.call(this,r,u)},l[r+"TrackGroupTypeBox"].prototype=new l.TrackGroupTypeBox,a&&(l[r+"TrackGroupTypeBox"].prototype.parse=a)},createUUIDBox:function(r,a,u,f){l.UUIDs.push(r),l.UUIDBoxes[r]=function(g){a?l.FullBox.call(this,"uuid",g,r):u?l.ContainerBox.call(this,"uuid",g,r):l.Box.call(this,"uuid",g,r)},l.UUIDBoxes[r].prototype=a?new l.FullBox:u?new l.ContainerBox:new l.Box,f&&(a?l.UUIDBoxes[r].prototype.parse=function(g){this.parseFullHeader(g),f&&f.call(this,g)}:l.UUIDBoxes[r].prototype.parse=f)}};l.initialize(),l.TKHD_FLAG_ENABLED=1,l.TKHD_FLAG_IN_MOVIE=2,l.TKHD_FLAG_IN_PREVIEW=4,l.TFHD_FLAG_BASE_DATA_OFFSET=1,l.TFHD_FLAG_SAMPLE_DESC=2,l.TFHD_FLAG_SAMPLE_DUR=8,l.TFHD_FLAG_SAMPLE_SIZE=16,l.TFHD_FLAG_SAMPLE_FLAGS=32,l.TFHD_FLAG_DUR_EMPTY=65536,l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,l.TRUN_FLAGS_DATA_OFFSET=1,l.TRUN_FLAGS_FIRST_FLAG=4,l.TRUN_FLAGS_DURATION=256,l.TRUN_FLAGS_SIZE=512,l.TRUN_FLAGS_FLAGS=1024,l.TRUN_FLAGS_CTS_OFFSET=2048,l.Box.prototype.add=function(r){return this.addBox(new l[r+"Box"])},l.Box.prototype.addBox=function(r){return this.boxes.push(r),this[r.type+"s"]?this[r.type+"s"].push(r):this[r.type]=r,r},l.Box.prototype.set=function(r,a){return this[r]=a,this},l.Box.prototype.addEntry=function(r,a){var u=a||"entries";return this[u]||(this[u]=[]),this[u].push(r),this},s.BoxParser=l,l.parseUUID=function(r){return l.parseHex16(r)},l.parseHex16=function(r){for(var a="",u=0;u<16;u++){var f=r.readUint8().toString(16);a+=f.length===1?"0"+f:f}return a},l.parseOneBox=function(r,a,u){var f,g=r.getPosition(),x=0,S,A;if(r.getEndPosition()-g<8)return t.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:l.ERR_NOT_ENOUGH_DATA};if(u&&u<8)return t.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:l.ERR_NOT_ENOUGH_DATA};var C=r.readUint32(),B=r.readString(4),R=B;if(t.debug("BoxParser","Found box of type '"+B+"' and size "+C+" at position "+g),x=8,B=="uuid"){if(r.getEndPosition()-r.getPosition()<16||u-x<16)return r.seek(g),t.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:l.ERR_NOT_ENOUGH_DATA};A=l.parseUUID(r),x+=16,R=A}if(C==1){if(r.getEndPosition()-r.getPosition()<8||u&&u-x<8)return r.seek(g),t.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+B+'" box'),{code:l.ERR_NOT_ENOUGH_DATA};C=r.readUint64(),x+=8}else if(C===0){if(u)C=u;else if(B!=="mdat")return t.error("BoxParser","Unlimited box size not supported for type: '"+B+"'"),f=new l.Box(B,C),{code:l.OK,box:f,size:f.size}}return C!==0&&C<x?(t.error("BoxParser","Box of type "+B+" has an invalid size "+C+" (too small to be a box)"),{code:l.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:x,start:g}):C!==0&&u&&C>u?(t.error("BoxParser","Box of type '"+B+"' has a size "+C+" greater than its container size "+u),{code:l.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:x,start:g}):C!==0&&g+C>r.getEndPosition()?(r.seek(g),t.info("BoxParser","Not enough data in stream to parse the entire '"+B+"' box"),{code:l.ERR_NOT_ENOUGH_DATA,type:B,size:C,hdr_size:x,start:g}):a?{code:l.OK,type:B,size:C,hdr_size:x,start:g}:(l[B+"Box"]?f=new l[B+"Box"](C):B!=="uuid"?(t.warn("BoxParser","Unknown box type: '"+B+"'"),f=new l.Box(B,C),f.has_unparsed_data=!0):l.UUIDBoxes[A]?f=new l.UUIDBoxes[A](C):(t.warn("BoxParser","Unknown uuid type: '"+A+"'"),f=new l.Box(B,C),f.uuid=A,f.has_unparsed_data=!0),f.hdr_size=x,f.start=g,f.write===l.Box.prototype.write&&f.type!=="mdat"&&(t.info("BoxParser","'"+R+"' box writing not yet implemented, keeping unparsed data in memory for later write"),f.parseDataAndRewind(r)),f.parse(r),S=r.getPosition()-(f.start+f.size),S<0?(t.warn("BoxParser","Parsing of box '"+R+"' did not read the entire indicated box data size (missing "+-S+" bytes), seeking forward"),r.seek(f.start+f.size)):S>0&&(t.error("BoxParser","Parsing of box '"+R+"' read "+S+" more bytes than the indicated box data size, seeking backwards"),f.size!==0&&r.seek(f.start+f.size)),{code:l.OK,box:f,size:f.size})},l.Box.prototype.parse=function(r){this.type!="mdat"?this.data=r.readUint8Array(this.size-this.hdr_size):this.size===0?r.seek(r.getEndPosition()):r.seek(this.start+this.size)},l.Box.prototype.parseDataAndRewind=function(r){this.data=r.readUint8Array(this.size-this.hdr_size),r.position-=this.size-this.hdr_size},l.FullBox.prototype.parseDataAndRewind=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,r.position-=this.size-this.hdr_size},l.FullBox.prototype.parseFullHeader=function(r){this.version=r.readUint8(),this.flags=r.readUint24(),this.hdr_size+=4},l.FullBox.prototype.parse=function(r){this.parseFullHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},l.ContainerBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===l.OK)if(u=a.box,this.boxes.push(u),this.subBoxNames&&this.subBoxNames.indexOf(u.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(u.type)]+"s"].push(u);else{var f=u.type!=="uuid"?u.type:u.uuid;this[f]?t.warn("Box of type "+f+" already stored in field of this type"):this[f]=u}else return},l.Box.prototype.parseLanguage=function(r){this.language=r.readUint16();var a=[];a[0]=this.language>>10&31,a[1]=this.language>>5&31,a[2]=this.language&31,this.languageString=String.fromCharCode(a[0]+96,a[1]+96,a[2]+96)},l.SAMPLE_ENTRY_TYPE_VISUAL="Visual",l.SAMPLE_ENTRY_TYPE_AUDIO="Audio",l.SAMPLE_ENTRY_TYPE_HINT="Hint",l.SAMPLE_ENTRY_TYPE_METADATA="Metadata",l.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle",l.SAMPLE_ENTRY_TYPE_SYSTEM="System",l.SAMPLE_ENTRY_TYPE_TEXT="Text",l.SampleEntry.prototype.parseHeader=function(r){r.readUint8Array(6),this.data_reference_index=r.readUint16(),this.hdr_size+=8},l.SampleEntry.prototype.parse=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size)},l.SampleEntry.prototype.parseDataAndRewind=function(r){this.parseHeader(r),this.data=r.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,r.position-=this.size-this.hdr_size},l.SampleEntry.prototype.parseFooter=function(r){l.ContainerBox.prototype.parse.call(this,r)},l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_HINT),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SYSTEM),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_TEXT),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,function(r){var a;this.parseHeader(r),r.readUint16(),r.readUint16(),r.readUint32Array(3),this.width=r.readUint16(),this.height=r.readUint16(),this.horizresolution=r.readUint32(),this.vertresolution=r.readUint32(),r.readUint32(),this.frame_count=r.readUint16(),a=Math.min(31,r.readUint8()),this.compressorname=r.readString(a),a<31&&r.readString(31-a),this.depth=r.readUint16(),r.readUint16(),this.parseFooter(r)}),l.createMediaSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,function(r){this.parseHeader(r),r.readUint32Array(2),this.channel_count=r.readUint16(),this.samplesize=r.readUint16(),r.readUint16(),r.readUint16(),this.samplerate=r.readUint32()/65536,this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avc4"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"av01"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"dav1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hev1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"hvt1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"lhe1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"dvh1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"dvhe"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vp08"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"vp09"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"avs3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"j2ki"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"mjp2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"mjpg"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"uncv"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ac-4"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"Opus"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mha1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mha2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mhm1"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"mhm2"),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"fLaC"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_VISUAL,"encv"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_AUDIO,"enca"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SYSTEM,"encs"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_TEXT,"enct"),l.createEncryptedSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"encm"),l.createBoxCtor("a1lx",function(r){var a=r.readUint8()&1,u=((a&1)+1)*16;this.layer_size=[];for(var f=0;f<3;f++)u==16?this.layer_size[f]=r.readUint16():this.layer_size[f]=r.readUint32()}),l.createBoxCtor("a1op",function(r){this.op_index=r.readUint8()}),l.createFullBoxCtor("auxC",function(r){this.aux_type=r.readCString();var a=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=r.readUint8Array(a)}),l.createBoxCtor("av1C",function(r){var a=r.readUint8();if(a>>7&!1){t.error("av1C marker problem");return}if(this.version=a&127,this.version!==1){t.error("av1C version "+this.version+" not supported");return}if(a=r.readUint8(),this.seq_profile=a>>5&7,this.seq_level_idx_0=a&31,a=r.readUint8(),this.seq_tier_0=a>>7&1,this.high_bitdepth=a>>6&1,this.twelve_bit=a>>5&1,this.monochrome=a>>4&1,this.chroma_subsampling_x=a>>3&1,this.chroma_subsampling_y=a>>2&1,this.chroma_sample_position=a&3,a=r.readUint8(),this.reserved_1=a>>5&7,this.reserved_1!==0){t.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=a>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=a&15;else if(this.reserved_2=a&15,this.reserved_2!==0){t.error("av1C reserved_2 parsing problem");return}var u=this.size-this.hdr_size-4;this.configOBUs=r.readUint8Array(u)}),l.createBoxCtor("avcC",function(r){var a,u;for(this.configurationVersion=r.readUint8(),this.AVCProfileIndication=r.readUint8(),this.profile_compatibility=r.readUint8(),this.AVCLevelIndication=r.readUint8(),this.lengthSizeMinusOne=r.readUint8()&3,this.nb_SPS_nalus=r.readUint8()&31,u=this.size-this.hdr_size-6,this.SPS=[],a=0;a<this.nb_SPS_nalus;a++)this.SPS[a]={},this.SPS[a].length=r.readUint16(),this.SPS[a].nalu=r.readUint8Array(this.SPS[a].length),u-=2+this.SPS[a].length;for(this.nb_PPS_nalus=r.readUint8(),u--,this.PPS=[],a=0;a<this.nb_PPS_nalus;a++)this.PPS[a]={},this.PPS[a].length=r.readUint16(),this.PPS[a].nalu=r.readUint8Array(this.PPS[a].length),u-=2+this.PPS[a].length;u>0&&(this.ext=r.readUint8Array(u))}),l.createBoxCtor("btrt",function(r){this.bufferSizeDB=r.readUint32(),this.maxBitrate=r.readUint32(),this.avgBitrate=r.readUint32()}),l.createFullBoxCtor("ccst",function(r){var a=r.readUint8();this.all_ref_pics_intra=(a&128)==128,this.intra_pred_used=(a&64)==64,this.max_ref_per_pic=(a&63)>>2,r.readUint24()}),l.createBoxCtor("cdef",function(r){var a;for(this.channel_count=r.readUint16(),this.channel_indexes=[],this.channel_types=[],this.channel_associations=[],a=0;a<this.channel_count;a++)this.channel_indexes.push(r.readUint16()),this.channel_types.push(r.readUint16()),this.channel_associations.push(r.readUint16())}),l.createBoxCtor("clap",function(r){this.cleanApertureWidthN=r.readUint32(),this.cleanApertureWidthD=r.readUint32(),this.cleanApertureHeightN=r.readUint32(),this.cleanApertureHeightD=r.readUint32(),this.horizOffN=r.readUint32(),this.horizOffD=r.readUint32(),this.vertOffN=r.readUint32(),this.vertOffD=r.readUint32()}),l.createBoxCtor("clli",function(r){this.max_content_light_level=r.readUint16(),this.max_pic_average_light_level=r.readUint16()}),l.createFullBoxCtor("cmex",function(r){this.flags&1&&(this.pos_x=r.readInt32()),this.flags&2&&(this.pos_y=r.readInt32()),this.flags&4&&(this.pos_z=r.readInt32()),this.flags&8&&(this.version==0?this.flags&16?(this.quat_x=r.readInt32(),this.quat_y=r.readInt32(),this.quat_z=r.readInt32()):(this.quat_x=r.readInt16(),this.quat_y=r.readInt16(),this.quat_z=r.readInt16()):this.version==1),this.flags&32&&(this.id=r.readUint32())}),l.createFullBoxCtor("cmin",function(r){this.focal_length_x=r.readInt32(),this.principal_point_x=r.readInt32(),this.principal_point_y=r.readInt32(),this.flags&1&&(this.focal_length_y=r.readInt32(),this.skew_factor=r.readInt32())}),l.createBoxCtor("cmpd",function(r){for(this.component_count=r.readUint32(),this.component_types=[],this.component_type_urls=[],i=0;i<this.component_count;i++){var a=r.readUint16();this.component_types.push(a),a>=32768&&this.component_type_urls.push(r.readCString())}}),l.createFullBoxCtor("co64",function(r){var a,u;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(u=0;u<a;u++)this.chunk_offsets.push(r.readUint64())}),l.createFullBoxCtor("CoLL",function(r){this.maxCLL=r.readUint16(),this.maxFALL=r.readUint16()}),l.createBoxCtor("colr",function(r){if(this.colour_type=r.readString(4),this.colour_type==="nclx"){this.colour_primaries=r.readUint16(),this.transfer_characteristics=r.readUint16(),this.matrix_coefficients=r.readUint16();var a=r.readUint8();this.full_range_flag=a>>7}else this.colour_type==="rICC"?this.ICC_profile=r.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=r.readUint8Array(this.size-4))}),l.createFullBoxCtor("cprt",function(r){this.parseLanguage(r),this.notice=r.readCString()}),l.createFullBoxCtor("cslg",function(r){this.version===0&&(this.compositionToDTSShift=r.readInt32(),this.leastDecodeToDisplayDelta=r.readInt32(),this.greatestDecodeToDisplayDelta=r.readInt32(),this.compositionStartTime=r.readInt32(),this.compositionEndTime=r.readInt32())}),l.createFullBoxCtor("ctts",function(r){var a,u;if(a=r.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(u=0;u<a;u++){this.sample_counts.push(r.readUint32());var f=r.readInt32();f<0&&t.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(f)}else if(this.version==1)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),this.sample_offsets.push(r.readInt32())}),l.createBoxCtor("dac3",function(r){var a=r.readUint8(),u=r.readUint8(),f=r.readUint8();this.fscod=a>>6,this.bsid=a>>1&31,this.bsmod=(a&1)<<2|u>>6&3,this.acmod=u>>3&7,this.lfeon=u>>2&1,this.bit_rate_code=u&3|f>>5&7}),l.createBoxCtor("dec3",function(r){var a=r.readUint16();this.data_rate=a>>3,this.num_ind_sub=a&7,this.ind_subs=[];for(var u=0;u<this.num_ind_sub+1;u++){var f={};this.ind_subs.push(f);var g=r.readUint8(),x=r.readUint8(),S=r.readUint8();f.fscod=g>>6,f.bsid=g>>1&31,f.bsmod=(g&1)<<4|x>>4&15,f.acmod=x>>1&7,f.lfeon=x&1,f.num_dep_sub=S>>1&15,f.num_dep_sub>0&&(f.chan_loc=(S&1)<<8|r.readUint8())}}),l.createFullBoxCtor("dfLa",function(r){var a=127,u=128,f=[],g=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];do{var x=r.readUint8(),S=Math.min(x&a,g.length-1);if(S?r.readUint8Array(r.readUint24()):(r.readUint8Array(13),this.samplerate=r.readUint32()>>12,r.readUint8Array(20)),f.push(g[S]),x&u)break}while(!0);this.numMetadataBlocks=f.length+" ("+f.join(", ")+")"}),l.createBoxCtor("dimm",function(r){this.bytessent=r.readUint64()}),l.createBoxCtor("dmax",function(r){this.time=r.readUint32()}),l.createBoxCtor("dmed",function(r){this.bytessent=r.readUint64()}),l.createBoxCtor("dOps",function(r){if(this.Version=r.readUint8(),this.OutputChannelCount=r.readUint8(),this.PreSkip=r.readUint16(),this.InputSampleRate=r.readUint32(),this.OutputGain=r.readInt16(),this.ChannelMappingFamily=r.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=r.readUint8(),this.CoupledCount=r.readUint8(),this.ChannelMapping=[];for(var a=0;a<this.OutputChannelCount;a++)this.ChannelMapping[a]=r.readUint8()}}),l.createFullBoxCtor("dref",function(r){var a,u;this.entries=[];for(var f=r.readUint32(),g=0;g<f;g++)if(a=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===l.OK)u=a.box,this.entries.push(u);else return}),l.createBoxCtor("drep",function(r){this.bytessent=r.readUint64()}),l.createFullBoxCtor("elng",function(r){this.extended_language=r.readString(this.size-this.hdr_size)}),l.createFullBoxCtor("elst",function(r){this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),this.version===1?(f.segment_duration=r.readUint64(),f.media_time=r.readInt64()):(f.segment_duration=r.readUint32(),f.media_time=r.readInt32()),f.media_rate_integer=r.readInt16(),f.media_rate_fraction=r.readInt16()}}),l.createFullBoxCtor("emsg",function(r){this.version==1?(this.timescale=r.readUint32(),this.presentation_time=r.readUint64(),this.event_duration=r.readUint32(),this.id=r.readUint32(),this.scheme_id_uri=r.readCString(),this.value=r.readCString()):(this.scheme_id_uri=r.readCString(),this.value=r.readCString(),this.timescale=r.readUint32(),this.presentation_time_delta=r.readUint32(),this.event_duration=r.readUint32(),this.id=r.readUint32());var a=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(a-=4),this.message_data=r.readUint8Array(a)}),l.createEntityToGroupCtor=function(r,a){l[r+"Box"]=function(u){l.FullBox.call(this,r,u)},l[r+"Box"].prototype=new l.FullBox,l[r+"Box"].prototype.parse=function(u){if(this.parseFullHeader(u),a)a.call(this,u);else for(this.group_id=u.readUint32(),this.num_entities_in_group=u.readUint32(),this.entity_ids=[],i=0;i<this.num_entities_in_group;i++){var f=u.readUint32();this.entity_ids.push(f)}}},l.createEntityToGroupCtor("aebr"),l.createEntityToGroupCtor("afbr"),l.createEntityToGroupCtor("albc"),l.createEntityToGroupCtor("altr"),l.createEntityToGroupCtor("brst"),l.createEntityToGroupCtor("dobr"),l.createEntityToGroupCtor("eqiv"),l.createEntityToGroupCtor("favc"),l.createEntityToGroupCtor("fobr"),l.createEntityToGroupCtor("iaug"),l.createEntityToGroupCtor("pano"),l.createEntityToGroupCtor("slid"),l.createEntityToGroupCtor("ster"),l.createEntityToGroupCtor("tsyn"),l.createEntityToGroupCtor("wbbr"),l.createEntityToGroupCtor("prgr"),l.createEntityToGroupCtor("pymd",function(r){this.group_id=r.readUint32(),this.num_entities_in_group=r.readUint32(),this.entity_ids=[];for(var a=0;a<this.num_entities_in_group;a++){var u=r.readUint32();this.entity_ids.push(u)}for(this.tile_size_x=r.readUint16(),this.tile_size_y=r.readUint16(),this.layer_binning=[],this.tiles_in_layer_column_minus1=[],this.tiles_in_layer_row_minus1=[],a=0;a<this.num_entities_in_group;a++)this.layer_binning[a]=r.readUint16(),this.tiles_in_layer_row_minus1[a]=r.readUint16(),this.tiles_in_layer_column_minus1[a]=r.readUint16()}),l.createFullBoxCtor("esds",function(r){var a=r.readUint8Array(this.size-this.hdr_size);if(this.data=a,typeof d<"u"){var u=new d;this.esd=u.parseOneDescriptor(new n(a.buffer,0,n.BIG_ENDIAN))}}),l.createBoxCtor("fiel",function(r){this.fieldCount=r.readUint8(),this.fieldOrdering=r.readUint8()}),l.createBoxCtor("frma",function(r){this.data_format=r.readString(4)}),l.createBoxCtor("ftyp",function(r){var a=this.size-this.hdr_size;this.major_brand=r.readString(4),this.minor_version=r.readUint32(),a-=8,this.compatible_brands=[];for(var u=0;a>=4;)this.compatible_brands[u]=r.readString(4),a-=4,u++}),l.createFullBoxCtor("hdlr",function(r){this.version===0&&(r.readUint32(),this.handler=r.readString(4),r.readUint32Array(3),this.name=r.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))}),l.createBoxCtor("hvcC",function(r){var a,u,f,g;this.configurationVersion=r.readUint8(),g=r.readUint8(),this.general_profile_space=g>>6,this.general_tier_flag=(g&32)>>5,this.general_profile_idc=g&31,this.general_profile_compatibility=r.readUint32(),this.general_constraint_indicator=r.readUint8Array(6),this.general_level_idc=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,this.chroma_format_idc=r.readUint8()&3,this.bit_depth_luma_minus8=r.readUint8()&7,this.bit_depth_chroma_minus8=r.readUint8()&7,this.avgFrameRate=r.readUint16(),g=r.readUint8(),this.constantFrameRate=g>>6,this.numTemporalLayers=(g&13)>>3,this.temporalIdNested=(g&4)>>2,this.lengthSizeMinusOne=g&3,this.nalu_arrays=[];var x=r.readUint8();for(a=0;a<x;a++){var S=[];this.nalu_arrays.push(S),g=r.readUint8(),S.completeness=(g&128)>>7,S.nalu_type=g&63;var A=r.readUint16();for(u=0;u<A;u++){var C={};S.push(C),f=r.readUint16(),C.data=r.readUint8Array(f)}}}),l.createFullBoxCtor("iinf",function(r){var a;this.version===0?this.entry_count=r.readUint16():this.entry_count=r.readUint32(),this.item_infos=[];for(var u=0;u<this.entry_count;u++)if(a=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),a.code===l.OK)a.box.type!=="infe"&&t.error("BoxParser","Expected 'infe' box, got "+a.box.type),this.item_infos[u]=a.box;else return}),l.createFullBoxCtor("iloc",function(r){var a;a=r.readUint8(),this.offset_size=a>>4&15,this.length_size=a&15,a=r.readUint8(),this.base_offset_size=a>>4&15,this.version===1||this.version===2?this.index_size=a&15:this.index_size=0,this.items=[];var u=0;if(this.version<2)u=r.readUint16();else if(this.version===2)u=r.readUint32();else throw"version of iloc box not supported";for(var f=0;f<u;f++){var g={};if(this.items.push(g),this.version<2)g.item_ID=r.readUint16();else if(this.version===2)g.item_ID=r.readUint32();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?g.construction_method=r.readUint16()&15:g.construction_method=0,g.data_reference_index=r.readUint16(),this.base_offset_size){case 0:g.base_offset=0;break;case 4:g.base_offset=r.readUint32();break;case 8:g.base_offset=r.readUint64();break;default:throw"Error reading base offset size"}var x=r.readUint16();g.extents=[];for(var S=0;S<x;S++){var A={};if(g.extents.push(A),this.version===1||this.version===2)switch(this.index_size){case 0:A.extent_index=0;break;case 4:A.extent_index=r.readUint32();break;case 8:A.extent_index=r.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:A.extent_offset=0;break;case 4:A.extent_offset=r.readUint32();break;case 8:A.extent_offset=r.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:A.extent_length=0;break;case 4:A.extent_length=r.readUint32();break;case 8:A.extent_length=r.readUint64();break;default:throw"Error reading extent index"}}}}),l.createBoxCtor("imir",function(r){var a=r.readUint8();this.reserved=a>>7,this.axis=a&1}),l.createFullBoxCtor("infe",function(r){if((this.version===0||this.version===1)&&(this.item_ID=r.readUint16(),this.item_protection_index=r.readUint16(),this.item_name=r.readCString(),this.content_type=r.readCString(),this.content_encoding=r.readCString()),this.version===1){this.extension_type=r.readString(4),t.warn("BoxParser","Cannot parse extension type"),r.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=r.readUint16():this.version===3&&(this.item_ID=r.readUint32()),this.item_protection_index=r.readUint16(),this.item_type=r.readString(4),this.item_name=r.readCString(),this.item_type==="mime"?(this.content_type=r.readCString(),this.content_encoding=r.readCString()):this.item_type==="uri "&&(this.item_uri_type=r.readCString()))}),l.createFullBoxCtor("ipma",function(r){var a,u;for(entry_count=r.readUint32(),this.associations=[],a=0;a<entry_count;a++){var f={};this.associations.push(f),this.version<1?f.id=r.readUint16():f.id=r.readUint32();var g=r.readUint8();for(f.props=[],u=0;u<g;u++){var x=r.readUint8(),S={};f.props.push(S),S.essential=(x&128)>>7===1,this.flags&1?S.property_index=(x&127)<<8|r.readUint8():S.property_index=x&127}}}),l.createFullBoxCtor("iref",function(r){var a,u;for(this.references=[];r.getPosition()<this.start+this.size;)if(a=l.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===l.OK)this.version===0?u=new l.SingleItemTypeReferenceBox(a.type,a.size,a.hdr_size,a.start):u=new l.SingleItemTypeReferenceBoxLarge(a.type,a.size,a.hdr_size,a.start),u.write===l.Box.prototype.write&&u.type!=="mdat"&&(t.warn("BoxParser",u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.references.push(u);else return}),l.createBoxCtor("irot",function(r){this.angle=r.readUint8()&3}),l.createFullBoxCtor("ispe",function(r){this.image_width=r.readUint32(),this.image_height=r.readUint32()}),l.createFullBoxCtor("kind",function(r){this.schemeURI=r.readCString(),this.value=r.readCString()}),l.createFullBoxCtor("leva",function(r){var a=r.readUint8();this.levels=[];for(var u=0;u<a;u++){var f={};this.levels[u]=f,f.track_ID=r.readUint32();var g=r.readUint8();switch(f.padding_flag=g>>7,f.assignment_type=g&127,f.assignment_type){case 0:f.grouping_type=r.readString(4);break;case 1:f.grouping_type=r.readString(4),f.grouping_type_parameter=r.readUint32();break;case 2:break;case 3:break;case 4:f.sub_track_id=r.readUint32();break;default:t.warn("BoxParser","Unknown leva assignement type")}}}),l.createBoxCtor("lhvC",function(r){var a,u,f;this.configurationVersion=r.readUint8(),this.min_spatial_segmentation_idc=r.readUint16()&4095,this.parallelismType=r.readUint8()&3,f=r.readUint8(),this.numTemporalLayers=(f&13)>>3,this.temporalIdNested=(f&4)>>2,this.lengthSizeMinusOne=f&3,this.nalu_arrays=[];var g=r.readUint8();for(a=0;a<g;a++){var x=[];this.nalu_arrays.push(x),f=r.readUint8(),x.completeness=(f&128)>>7,x.nalu_type=f&63;var S=r.readUint16();for(u=0;u<S;u++){var A={};x.push(A);var C=r.readUint16();A.data=r.readUint8Array(C)}}}),l.createBoxCtor("lsel",function(r){this.layer_id=r.readUint16()}),l.createBoxCtor("maxr",function(r){this.period=r.readUint32(),this.bytes=r.readUint32()});function _(r,a){this.x=r,this.y=a}_.prototype.toString=function(){return"("+this.x+","+this.y+")"},l.createBoxCtor("mdcv",function(r){this.display_primaries=[],this.display_primaries[0]=new _(r.readUint16(),r.readUint16()),this.display_primaries[1]=new _(r.readUint16(),r.readUint16()),this.display_primaries[2]=new _(r.readUint16(),r.readUint16()),this.white_point=new _(r.readUint16(),r.readUint16()),this.max_display_mastering_luminance=r.readUint32(),this.min_display_mastering_luminance=r.readUint32()}),l.createFullBoxCtor("mdhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.parseLanguage(r),r.readUint16()}),l.createFullBoxCtor("mehd",function(r){this.flags&1&&(t.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=r.readUint64():this.fragment_duration=r.readUint32()}),l.createFullBoxCtor("meta",function(r){this.boxes=[],l.ContainerBox.prototype.parse.call(this,r)}),l.createFullBoxCtor("mfhd",function(r){this.sequence_number=r.readUint32()}),l.createFullBoxCtor("mfro",function(r){this._size=r.readUint32()}),l.createFullBoxCtor("mskC",function(r){this.bits_per_pixel=r.readUint8()}),l.createFullBoxCtor("mvhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.timescale=r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.timescale=r.readUint32(),this.duration=r.readUint32()),this.rate=r.readUint32(),this.volume=r.readUint16()>>8,r.readUint16(),r.readUint32Array(2),this.matrix=r.readUint32Array(9),r.readUint32Array(6),this.next_track_id=r.readUint32()}),l.createBoxCtor("npck",function(r){this.packetssent=r.readUint32()}),l.createBoxCtor("nump",function(r){this.packetssent=r.readUint64()}),l.createFullBoxCtor("padb",function(r){var a=r.readUint32();this.padbits=[];for(var u=0;u<Math.floor((a+1)/2);u++)this.padbits=r.readUint8()}),l.createBoxCtor("pasp",function(r){this.hSpacing=r.readUint32(),this.vSpacing=r.readUint32()}),l.createBoxCtor("payl",function(r){this.text=r.readString(this.size-this.hdr_size)}),l.createBoxCtor("payt",function(r){this.payloadID=r.readUint32();var a=r.readUint8();this.rtpmap_string=r.readString(a)}),l.createFullBoxCtor("pdin",function(r){var a=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var u=0;u<a;u++)this.rate[u]=r.readUint32(),this.initial_delay[u]=r.readUint32()}),l.createFullBoxCtor("pitm",function(r){this.version===0?this.item_id=r.readUint16():this.item_id=r.readUint32()}),l.createFullBoxCtor("pixi",function(r){var a;for(this.num_channels=r.readUint8(),this.bits_per_channels=[],a=0;a<this.num_channels;a++)this.bits_per_channels[a]=r.readUint8()}),l.createBoxCtor("pmax",function(r){this.bytes=r.readUint32()}),l.createFullBoxCtor("prdi",function(r){if(this.step_count=r.readUint16(),this.item_count=[],this.flags&2)for(var a=0;a<this.step_count;a++)this.item_count[a]=r.readUint16()}),l.createFullBoxCtor("prft",function(r){this.ref_track_id=r.readUint32(),this.ntp_timestamp=r.readUint64(),this.version===0?this.media_time=r.readUint32():this.media_time=r.readUint64()}),l.createFullBoxCtor("pssh",function(r){if(this.system_id=l.parseHex16(r),this.version>0){var a=r.readUint32();this.kid=[];for(var u=0;u<a;u++)this.kid[u]=l.parseHex16(r)}var f=r.readUint32();f>0&&(this.data=r.readUint8Array(f))}),l.createFullBoxCtor("clef",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),l.createFullBoxCtor("enof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),l.createFullBoxCtor("prof",function(r){this.width=r.readUint32(),this.height=r.readUint32()}),l.createContainerBoxCtor("tapt",null,["clef","prof","enof"]),l.createBoxCtor("rtp ",function(r){this.descriptionformat=r.readString(4),this.sdptext=r.readString(this.size-this.hdr_size-4)}),l.createFullBoxCtor("saio",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32());var a=r.readUint32();this.offset=[];for(var u=0;u<a;u++)this.version===0?this.offset[u]=r.readUint32():this.offset[u]=r.readUint64()}),l.createFullBoxCtor("saiz",function(r){this.flags&1&&(this.aux_info_type=r.readUint32(),this.aux_info_type_parameter=r.readUint32()),this.default_sample_info_size=r.readUint8();var a=r.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var u=0;u<a;u++)this.sample_info_size[u]=r.readUint8()}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(r){this.parseHeader(r),this.namespace=r.readCString(),this.schema_location=r.readCString(),this.auxiliary_mime_types=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(r){this.parseHeader(r),this.content_encoding=r.readCString(),this.mime_format=r.readCString(),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(r){this.parseHeader(r),this.displayFlags=r.readUint32(),this.horizontal_justification=r.readInt8(),this.vertical_justification=r.readInt8(),this.bg_color_rgba=r.readUint8Array(4),this.box_record=r.readInt16Array(4),this.style_record=r.readUint8Array(12),this.parseFooter(r)}),l.createSampleEntryCtor(l.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(r){this.parseHeader(r),this.parseFooter(r)}),l.createSampleGroupCtor("alst",function(r){var a,u=r.readUint16();for(this.first_output_sample=r.readUint16(),this.sample_offset=[],a=0;a<u;a++)this.sample_offset[a]=r.readUint32();var f=this.description_length-4-4*u;for(this.num_output_samples=[],this.num_total_samples=[],a=0;a<f/4;a++)this.num_output_samples[a]=r.readUint16(),this.num_total_samples[a]=r.readUint16()}),l.createSampleGroupCtor("avll",function(r){this.layerNumber=r.readUint8(),this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()}),l.createSampleGroupCtor("avss",function(r){this.subSequenceIdentifier=r.readUint16(),this.layerNumber=r.readUint8();var a=r.readUint8();this.durationFlag=a>>7,this.avgRateFlag=a>>6&1,this.durationFlag&&(this.duration=r.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=r.readUint8(),this.avgBitRate=r.readUint16(),this.avgFrameRate=r.readUint16()),this.dependency=[];for(var u=r.readUint8(),f=0;f<u;f++){var g={};this.dependency.push(g),g.subSeqDirectionFlag=r.readUint8(),g.layerNumber=r.readUint8(),g.subSequenceIdentifier=r.readUint16()}}),l.createSampleGroupCtor("dtrt",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("mvif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("prol",function(r){this.roll_distance=r.readInt16()}),l.createSampleGroupCtor("rap ",function(r){var a=r.readUint8();this.num_leading_samples_known=a>>7,this.num_leading_samples=a&127}),l.createSampleGroupCtor("rash",function(r){if(this.operation_point_count=r.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)t.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=r.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=r.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var a=0;a<this.operation_point_count;a++)this.available_bitrate[a]=r.readUint32(),this.target_rate_share[a]=r.readUint16()}this.maximum_bitrate=r.readUint32(),this.minimum_bitrate=r.readUint32(),this.discard_priority=r.readUint8()}}),l.createSampleGroupCtor("roll",function(r){this.roll_distance=r.readInt16()}),l.SampleGroupEntry.prototype.parse=function(r){t.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=r.readUint8Array(this.description_length)},l.createSampleGroupCtor("scif",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("scnm",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("seig",function(r){this.reserved=r.readUint8();var a=r.readUint8();this.crypt_byte_block=a>>4,this.skip_byte_block=a&15,this.isProtected=r.readUint8(),this.Per_Sample_IV_Size=r.readUint8(),this.KID=l.parseHex16(r),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=r.readUint8(),this.constant_IV=r.readUint8Array(this.constant_IV_size))}),l.createSampleGroupCtor("stsa",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("sync",function(r){var a=r.readUint8();this.NAL_unit_type=a&63}),l.createSampleGroupCtor("tele",function(r){var a=r.readUint8();this.level_independently_decodable=a>>7}),l.createSampleGroupCtor("tsas",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("tscl",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createSampleGroupCtor("vipr",function(r){t.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")}),l.createFullBoxCtor("sbgp",function(r){this.grouping_type=r.readString(4),this.version===1?this.grouping_type_parameter=r.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.entries.push(f),f.sample_count=r.readInt32(),f.group_description_index=r.readInt32()}});function m(r,a){this.bad_pixel_row=r,this.bad_pixel_column=a}m.prototype.toString=function(){return"[row: "+this.bad_pixel_row+", column: "+this.bad_pixel_column+"]"},l.createFullBoxCtor("sbpm",function(r){var a;for(this.component_count=r.readUint16(),this.component_index=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16());var u=r.readUint8();for(this.correction_applied=(u&128)==128,this.num_bad_rows=r.readUint32(),this.num_bad_cols=r.readUint32(),this.num_bad_pixels=r.readUint32(),this.bad_rows=[],this.bad_columns=[],this.bad_pixels=[],a=0;a<this.num_bad_rows;a++)this.bad_rows.push(r.readUint32());for(a=0;a<this.num_bad_cols;a++)this.bad_columns.push(r.readUint32());for(a=0;a<this.num_bad_pixels;a++){var f=r.readUint32(),g=r.readUint32();this.bad_pixels.push(new m(f,g))}}),l.createFullBoxCtor("schm",function(r){this.scheme_type=r.readString(4),this.scheme_version=r.readUint32(),this.flags&1&&(this.scheme_uri=r.readString(this.size-this.hdr_size-8))}),l.createBoxCtor("sdp ",function(r){this.sdptext=r.readString(this.size-this.hdr_size)}),l.createFullBoxCtor("sdtp",function(r){var a,u=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var f=0;f<u;f++)a=r.readUint8(),this.is_leading[f]=a>>6,this.sample_depends_on[f]=a>>4&3,this.sample_is_depended_on[f]=a>>2&3,this.sample_has_redundancy[f]=a&3}),l.createFullBoxCtor("senc"),l.createFullBoxCtor("sgpd",function(r){this.grouping_type=r.readString(4),t.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=r.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=r.readUint32()),this.entries=[];for(var a=r.readUint32(),u=0;u<a;u++){var f;l[this.grouping_type+"SampleGroupEntry"]?f=new l[this.grouping_type+"SampleGroupEntry"](this.grouping_type):f=new l.SampleGroupEntry(this.grouping_type),this.entries.push(f),this.version===1?this.default_length===0?f.description_length=r.readUint32():f.description_length=this.default_length:f.description_length=this.default_length,f.write===l.SampleGroupEntry.prototype.write&&(t.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),f.data=r.readUint8Array(f.description_length),r.position-=f.description_length),f.parse(r)}}),l.createFullBoxCtor("sidx",function(r){this.reference_ID=r.readUint32(),this.timescale=r.readUint32(),this.version===0?(this.earliest_presentation_time=r.readUint32(),this.first_offset=r.readUint32()):(this.earliest_presentation_time=r.readUint64(),this.first_offset=r.readUint64()),r.readUint16(),this.references=[];for(var a=r.readUint16(),u=0;u<a;u++){var f={};this.references.push(f);var g=r.readUint32();f.reference_type=g>>31&1,f.referenced_size=g&2147483647,f.subsegment_duration=r.readUint32(),g=r.readUint32(),f.starts_with_SAP=g>>31&1,f.SAP_type=g>>28&7,f.SAP_delta_time=g&268435455}}),l.SingleItemTypeReferenceBox=function(r,a,u,f){l.Box.call(this,r,a),this.hdr_size=u,this.start=f},l.SingleItemTypeReferenceBox.prototype=new l.Box,l.SingleItemTypeReferenceBox.prototype.parse=function(r){this.from_item_ID=r.readUint16();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint16()},l.SingleItemTypeReferenceBoxLarge=function(r,a,u,f){l.Box.call(this,r,a),this.hdr_size=u,this.start=f},l.SingleItemTypeReferenceBoxLarge.prototype=new l.Box,l.SingleItemTypeReferenceBoxLarge.prototype.parse=function(r){this.from_item_ID=r.readUint32();var a=r.readUint16();this.references=[];for(var u=0;u<a;u++)this.references[u]={},this.references[u].to_item_ID=r.readUint32()},l.createFullBoxCtor("SmDm",function(r){this.primaryRChromaticity_x=r.readUint16(),this.primaryRChromaticity_y=r.readUint16(),this.primaryGChromaticity_x=r.readUint16(),this.primaryGChromaticity_y=r.readUint16(),this.primaryBChromaticity_x=r.readUint16(),this.primaryBChromaticity_y=r.readUint16(),this.whitePointChromaticity_x=r.readUint16(),this.whitePointChromaticity_y=r.readUint16(),this.luminanceMax=r.readUint32(),this.luminanceMin=r.readUint32()}),l.createFullBoxCtor("smhd",function(r){this.balance=r.readUint16(),r.readUint16()}),l.createFullBoxCtor("ssix",function(r){this.subsegments=[];for(var a=r.readUint32(),u=0;u<a;u++){var f={};this.subsegments.push(f),f.ranges=[];for(var g=r.readUint32(),x=0;x<g;x++){var S={};f.ranges.push(S),S.level=r.readUint8(),S.range_size=r.readUint24()}}}),l.createFullBoxCtor("stco",function(r){var a;if(a=r.readUint32(),this.chunk_offsets=[],this.version===0)for(var u=0;u<a;u++)this.chunk_offsets.push(r.readUint32())}),l.createFullBoxCtor("stdp",function(r){var a=(this.size-this.hdr_size)/2;this.priority=[];for(var u=0;u<a;u++)this.priority[u]=r.readUint16()}),l.createFullBoxCtor("sthd"),l.createFullBoxCtor("stri",function(r){this.switch_group=r.readUint16(),this.alternate_group=r.readUint16(),this.sub_track_id=r.readUint32();var a=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),l.createFullBoxCtor("stsc",function(r){var a,u;if(a=r.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(u=0;u<a;u++)this.first_chunk.push(r.readUint32()),this.samples_per_chunk.push(r.readUint32()),this.sample_description_index.push(r.readUint32())}),l.createFullBoxCtor("stsd",function(r){var a,u,f,g;for(this.entries=[],f=r.readUint32(),a=1;a<=f;a++)if(u=l.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),u.code===l.OK)l[u.type+"SampleEntry"]?(g=new l[u.type+"SampleEntry"](u.size),g.hdr_size=u.hdr_size,g.start=u.start):(t.warn("BoxParser","Unknown sample entry type: "+u.type),g=new l.SampleEntry(u.type,u.size,u.hdr_size,u.start)),g.write===l.SampleEntry.prototype.write&&(t.info("BoxParser","SampleEntry "+g.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),g.parseDataAndRewind(r)),g.parse(r),this.entries.push(g);else return}),l.createFullBoxCtor("stsg",function(r){this.grouping_type=r.readUint32();var a=r.readUint16();this.group_description_index=[];for(var u=0;u<a;u++)this.group_description_index[u]=r.readUint32()}),l.createFullBoxCtor("stsh",function(r){var a,u;if(a=r.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(u=0;u<a;u++)this.shadowed_sample_numbers.push(r.readUint32()),this.sync_sample_numbers.push(r.readUint32())}),l.createFullBoxCtor("stss",function(r){var a,u;if(u=r.readUint32(),this.version===0)for(this.sample_numbers=[],a=0;a<u;a++)this.sample_numbers.push(r.readUint32())}),l.createFullBoxCtor("stsz",function(r){var a;if(this.sample_sizes=[],this.version===0)for(this.sample_size=r.readUint32(),this.sample_count=r.readUint32(),a=0;a<this.sample_count;a++)this.sample_size===0?this.sample_sizes.push(r.readUint32()):this.sample_sizes[a]=this.sample_size}),l.createFullBoxCtor("stts",function(r){var a,u,f;if(a=r.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(u=0;u<a;u++)this.sample_counts.push(r.readUint32()),f=r.readInt32(),f<0&&(t.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),f=1),this.sample_deltas.push(f)}),l.createFullBoxCtor("stvi",function(r){var a=r.readUint32();this.single_view_allowed=a&3,this.stereo_scheme=r.readUint32();var u=r.readUint32();this.stereo_indication_type=r.readString(u);var f,g;for(this.boxes=[];r.getPosition()<this.start+this.size;)if(f=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),f.code===l.OK)g=f.box,this.boxes.push(g),this[g.type]=g;else return}),l.createBoxCtor("styp",function(r){l.ftypBox.prototype.parse.call(this,r)}),l.createFullBoxCtor("stz2",function(r){var a,u;if(this.sample_sizes=[],this.version===0)if(this.reserved=r.readUint24(),this.field_size=r.readUint8(),u=r.readUint32(),this.field_size===4)for(a=0;a<u;a+=2){var f=r.readUint8();this.sample_sizes[a]=f>>4&15,this.sample_sizes[a+1]=f&15}else if(this.field_size===8)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint8();else if(this.field_size===16)for(a=0;a<u;a++)this.sample_sizes[a]=r.readUint16();else t.error("BoxParser","Error in length field in stz2 box")}),l.createFullBoxCtor("subs",function(r){var a,u,f,g;for(f=r.readUint32(),this.entries=[],a=0;a<f;a++){var x={};if(this.entries[a]=x,x.sample_delta=r.readUint32(),x.subsamples=[],g=r.readUint16(),g>0)for(u=0;u<g;u++){var S={};x.subsamples.push(S),this.version==1?S.size=r.readUint32():S.size=r.readUint16(),S.priority=r.readUint8(),S.discardable=r.readUint8(),S.codec_specific_parameters=r.readUint32()}}}),l.createFullBoxCtor("tenc",function(r){if(r.readUint8(),this.version===0)r.readUint8();else{var a=r.readUint8();this.default_crypt_byte_block=a>>4&15,this.default_skip_byte_block=a&15}this.default_isProtected=r.readUint8(),this.default_Per_Sample_IV_Size=r.readUint8(),this.default_KID=l.parseHex16(r),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=r.readUint8(),this.default_constant_IV=r.readUint8Array(this.default_constant_IV_size))}),l.createFullBoxCtor("tfdt",function(r){this.version==1?this.baseMediaDecodeTime=r.readUint64():this.baseMediaDecodeTime=r.readUint32()}),l.createFullBoxCtor("tfhd",function(r){var a=0;this.track_id=r.readUint32(),this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=r.readUint64(),a+=8):this.base_data_offset=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=r.readUint32(),a+=4):this.default_sample_description_index=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=r.readUint32(),a+=4):this.default_sample_duration=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=r.readUint32(),a+=4):this.default_sample_size=0,this.size-this.hdr_size>a&&this.flags&l.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=r.readUint32(),a+=4):this.default_sample_flags=0}),l.createFullBoxCtor("tfra",function(r){this.track_ID=r.readUint32(),r.readUint24();var a=r.readUint8();this.length_size_of_traf_num=a>>4&3,this.length_size_of_trun_num=a>>2&3,this.length_size_of_sample_num=a&3,this.entries=[];for(var u=r.readUint32(),f=0;f<u;f++)this.version===1?(this.time=r.readUint64(),this.moof_offset=r.readUint64()):(this.time=r.readUint32(),this.moof_offset=r.readUint32()),this.traf_number=r["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=r["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=r["readUint"+8*(this.length_size_of_sample_num+1)]()}),l.createFullBoxCtor("tkhd",function(r){this.version==1?(this.creation_time=r.readUint64(),this.modification_time=r.readUint64(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint64()):(this.creation_time=r.readUint32(),this.modification_time=r.readUint32(),this.track_id=r.readUint32(),r.readUint32(),this.duration=r.readUint32()),r.readUint32Array(2),this.layer=r.readInt16(),this.alternate_group=r.readInt16(),this.volume=r.readInt16()>>8,r.readUint16(),this.matrix=r.readInt32Array(9),this.width=r.readUint32(),this.height=r.readUint32()}),l.createBoxCtor("tmax",function(r){this.time=r.readUint32()}),l.createBoxCtor("tmin",function(r){this.time=r.readUint32()}),l.createBoxCtor("totl",function(r){this.bytessent=r.readUint32()}),l.createBoxCtor("tpay",function(r){this.bytessent=r.readUint32()}),l.createBoxCtor("tpyl",function(r){this.bytessent=r.readUint64()}),l.TrackGroupTypeBox.prototype.parse=function(r){this.parseFullHeader(r),this.track_group_id=r.readUint32()},l.createTrackGroupCtor("msrc"),l.TrackReferenceTypeBox=function(r,a,u,f){l.Box.call(this,r,a),this.hdr_size=u,this.start=f},l.TrackReferenceTypeBox.prototype=new l.Box,l.TrackReferenceTypeBox.prototype.parse=function(r){this.track_ids=r.readUint32Array((this.size-this.hdr_size)/4)},l.trefBox.prototype.parse=function(r){for(var a,u;r.getPosition()<this.start+this.size;)if(a=l.parseOneBox(r,!0,this.size-(r.getPosition()-this.start)),a.code===l.OK)u=new l.TrackReferenceTypeBox(a.type,a.size,a.hdr_size,a.start),u.write===l.Box.prototype.write&&u.type!=="mdat"&&(t.info("BoxParser","TrackReference "+u.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),u.parseDataAndRewind(r)),u.parse(r),this.boxes.push(u);else return},l.createFullBoxCtor("trep",function(r){for(this.track_ID=r.readUint32(),this.boxes=[];r.getPosition()<this.start+this.size;)if(ret=l.parseOneBox(r,!1,this.size-(r.getPosition()-this.start)),ret.code===l.OK)box=ret.box,this.boxes.push(box);else return}),l.createFullBoxCtor("trex",function(r){this.track_id=r.readUint32(),this.default_sample_description_index=r.readUint32(),this.default_sample_duration=r.readUint32(),this.default_sample_size=r.readUint32(),this.default_sample_flags=r.readUint32()}),l.createBoxCtor("trpy",function(r){this.bytessent=r.readUint64()}),l.createFullBoxCtor("trun",function(r){var a=0;if(this.sample_count=r.readUint32(),a+=4,this.size-this.hdr_size>a&&this.flags&l.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=r.readInt32(),a+=4):this.data_offset=0,this.size-this.hdr_size>a&&this.flags&l.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=r.readUint32(),a+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>a)for(var u=0;u<this.sample_count;u++)this.flags&l.TRUN_FLAGS_DURATION&&(this.sample_duration[u]=r.readUint32()),this.flags&l.TRUN_FLAGS_SIZE&&(this.sample_size[u]=r.readUint32()),this.flags&l.TRUN_FLAGS_FLAGS&&(this.sample_flags[u]=r.readUint32()),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[u]=r.readUint32():this.sample_composition_time_offset[u]=r.readInt32())}),l.createFullBoxCtor("tsel",function(r){this.switch_group=r.readUint32();var a=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var u=0;u<a;u++)this.attribute_list[u]=r.readUint32()}),l.createFullBoxCtor("txtC",function(r){this.config=r.readCString()}),l.createBoxCtor("tyco",function(r){var a=(this.size-this.hdr_size)/4;this.compatible_brands=[];for(var u=0;u<a;u++)this.compatible_brands[u]=r.readString(4)}),l.createFullBoxCtor("udes",function(r){this.lang=r.readCString(),this.name=r.readCString(),this.description=r.readCString(),this.tags=r.readCString()}),l.createFullBoxCtor("uncC",function(r){var a;if(this.profile=r.readUint32(),this.version!=1){if(this.version==0){for(this.component_count=r.readUint32(),this.component_index=[],this.component_bit_depth_minus_one=[],this.component_format=[],this.component_align_size=[],a=0;a<this.component_count;a++)this.component_index.push(r.readUint16()),this.component_bit_depth_minus_one.push(r.readUint8()),this.component_format.push(r.readUint8()),this.component_align_size.push(r.readUint8());this.sampling_type=r.readUint8(),this.interleave_type=r.readUint8(),this.block_size=r.readUint8();var u=r.readUint8();this.component_little_endian=u>>7&1,this.block_pad_lsb=u>>6&1,this.block_little_endian=u>>5&1,this.block_reversed=u>>4&1,this.pad_unknown=u>>3&1,this.pixel_size=r.readUint32(),this.row_align_size=r.readUint32(),this.tile_align_size=r.readUint32(),this.num_tile_cols_minus_one=r.readUint32(),this.num_tile_rows_minus_one=r.readUint32()}}}),l.createFullBoxCtor("url ",function(r){this.flags!==1&&(this.location=r.readCString())}),l.createFullBoxCtor("urn ",function(r){this.name=r.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=r.readCString())}),l.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(r){this.LiveServerManifest=r.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}),l.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(r){this.system_id=l.parseHex16(r);var a=r.readUint32();a>0&&(this.data=r.readUint8Array(a))}),l.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1),l.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(r){this.default_AlgorithmID=r.readUint24(),this.default_IV_size=r.readUint8(),this.default_KID=l.parseHex16(r)}),l.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(r){this.fragment_count=r.readUint8(),this.entries=[];for(var a=0;a<this.fragment_count;a++){var u={},f=0,g=0;this.version===1?(f=r.readUint64(),g=r.readUint64()):(f=r.readUint32(),g=r.readUint32()),u.absolute_time=f,u.absolute_duration=g,this.entries.push(u)}}),l.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(r){this.version===1?(this.absolute_time=r.readUint64(),this.duration=r.readUint64()):(this.absolute_time=r.readUint32(),this.duration=r.readUint32())}),l.createFullBoxCtor("vmhd",function(r){this.graphicsmode=r.readUint16(),this.opcolor=r.readUint16Array(3)}),l.createFullBoxCtor("vpcC",function(r){var a;this.version===1?(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4,this.chromaSubsampling=a>>1&7,this.videoFullRangeFlag=a&1,this.colourPrimaries=r.readUint8(),this.transferCharacteristics=r.readUint8(),this.matrixCoefficients=r.readUint8(),this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize)):(this.profile=r.readUint8(),this.level=r.readUint8(),a=r.readUint8(),this.bitDepth=a>>4&15,this.colorSpace=a&15,a=r.readUint8(),this.chromaSubsampling=a>>4&15,this.transferFunction=a>>1&7,this.videoFullRangeFlag=a&1,this.codecIntializationDataSize=r.readUint16(),this.codecIntializationData=r.readUint8Array(this.codecIntializationDataSize))}),l.createBoxCtor("vttC",function(r){this.text=r.readString(this.size-this.hdr_size)}),l.createFullBoxCtor("vvcC",function(r){var a,u,f={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(L){this.held_bits=L.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(L){this.held_bits=L.readUint16(),this.num_held_bits=16},extract_bits:function(L){var W=this.held_bits>>this.num_held_bits-L&(1<<L)-1;return this.num_held_bits-=L,W}};if(f.stream_read_1_bytes(r),f.extract_bits(5),this.lengthSizeMinusOne=f.extract_bits(2),this.ptl_present_flag=f.extract_bits(1),this.ptl_present_flag){f.stream_read_2_bytes(r),this.ols_idx=f.extract_bits(9),this.num_sublayers=f.extract_bits(3),this.constant_frame_rate=f.extract_bits(2),this.chroma_format_idc=f.extract_bits(2),f.stream_read_1_bytes(r),this.bit_depth_minus8=f.extract_bits(3),f.extract_bits(5);{if(f.stream_read_2_bytes(r),f.extract_bits(2),this.num_bytes_constraint_info=f.extract_bits(6),this.general_profile_idc=f.extract_bits(7),this.general_tier_flag=f.extract_bits(1),this.general_level_idc=r.readUint8(),f.stream_read_1_bytes(r),this.ptl_frame_only_constraint_flag=f.extract_bits(1),this.ptl_multilayer_enabled_flag=f.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(a=0;a<this.num_bytes_constraint_info-1;a++){var g=f.extract_bits(6);f.stream_read_1_bytes(r);var x=f.extract_bits(2);this.general_constraint_info[a]=g<<2|x}this.general_constraint_info[this.num_bytes_constraint_info-1]=f.extract_bits(6)}else f.extract_bits(6);if(this.num_sublayers>1){for(f.stream_read_1_bytes(r),this.ptl_sublayer_present_mask=0,u=this.num_sublayers-2;u>=0;--u){var S=f.extract_bits(1);this.ptl_sublayer_present_mask|=S<<u}for(u=this.num_sublayers;u<=8&&this.num_sublayers>1;++u)f.extract_bits(1);for(this.sublayer_level_idc=[],u=this.num_sublayers-2;u>=0;--u)this.ptl_sublayer_present_mask&1<<u&&(this.sublayer_level_idc[u]=r.readUint8())}if(this.ptl_num_sub_profiles=r.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(a=0;a<this.ptl_num_sub_profiles;a++)this.general_sub_profile_idc.push(r.readUint32())}this.max_picture_width=r.readUint16(),this.max_picture_height=r.readUint16(),this.avg_frame_rate=r.readUint16()}var A=12,C=13;this.nalu_arrays=[];var B=r.readUint8();for(a=0;a<B;a++){var R=[];this.nalu_arrays.push(R),f.stream_read_1_bytes(r),R.completeness=f.extract_bits(1),f.extract_bits(2),R.nalu_type=f.extract_bits(5);var M=1;for(R.nalu_type!=C&&R.nalu_type!=A&&(M=r.readUint16()),u=0;u<M;u++){var N=r.readUint16();R.push({data:r.readUint8Array(N),length:N})}}}),l.createFullBoxCtor("vvnC",function(r){var a=strm.readUint8();this.lengthSizeMinusOne=a&3}),l.SampleEntry.prototype.isVideo=function(){return!1},l.SampleEntry.prototype.isAudio=function(){return!1},l.SampleEntry.prototype.isSubtitle=function(){return!1},l.SampleEntry.prototype.isMetadata=function(){return!1},l.SampleEntry.prototype.isHint=function(){return!1},l.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},l.SampleEntry.prototype.getWidth=function(){return""},l.SampleEntry.prototype.getHeight=function(){return""},l.SampleEntry.prototype.getChannelCount=function(){return""},l.SampleEntry.prototype.getSampleRate=function(){return""},l.SampleEntry.prototype.getSampleSize=function(){return""},l.VisualSampleEntry.prototype.isVideo=function(){return!0},l.VisualSampleEntry.prototype.getWidth=function(){return this.width},l.VisualSampleEntry.prototype.getHeight=function(){return this.height},l.AudioSampleEntry.prototype.isAudio=function(){return!0},l.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},l.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},l.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},l.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},l.MetadataSampleEntry.prototype.isMetadata=function(){return!0},l.decimalToHex=function(r,a){var u=Number(r).toString(16);for(a=typeof a>"u"||a===null?a=2:a;u.length<a;)u="0"+u;return u},l.avc1SampleEntry.prototype.getCodec=l.avc2SampleEntry.prototype.getCodec=l.avc3SampleEntry.prototype.getCodec=l.avc4SampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this);return this.avcC?r+"."+l.decimalToHex(this.avcC.AVCProfileIndication)+l.decimalToHex(this.avcC.profile_compatibility)+l.decimalToHex(this.avcC.AVCLevelIndication):r},l.hev1SampleEntry.prototype.getCodec=l.hvc1SampleEntry.prototype.getCodec=function(){var r,a=l.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(a+=".",this.hvcC.general_profile_space){case 0:a+="";break;case 1:a+="A";break;case 2:a+="B";break;case 3:a+="C";break}a+=this.hvcC.general_profile_idc,a+=".";var u=this.hvcC.general_profile_compatibility,f=0;for(r=0;r<32&&(f|=u&1,r!=31);r++)f<<=1,u>>=1;a+=l.decimalToHex(f,0),a+=".",this.hvcC.general_tier_flag===0?a+="L":a+="H",a+=this.hvcC.general_level_idc;var g=!1,x="";for(r=5;r>=0;r--)(this.hvcC.general_constraint_indicator[r]||g)&&(x="."+l.decimalToHex(this.hvcC.general_constraint_indicator[r],0)+x,g=!0);a+=x}return a},l.vvc1SampleEntry.prototype.getCodec=l.vvi1SampleEntry.prototype.getCodec=function(){var r,a=l.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){a+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?a+=".H":a+=".L",a+=this.vvcC.general_level_idc;var u="";if(this.vvcC.general_constraint_info){var f=[],g=0;g|=this.vvcC.ptl_frame_only_constraint<<7,g|=this.vvcC.ptl_multilayer_enabled<<6;var x;for(r=0;r<this.vvcC.general_constraint_info.length;++r)g|=this.vvcC.general_constraint_info[r]>>2&63,f.push(g),g&&(x=r),g=this.vvcC.general_constraint_info[r]>>2&3;if(x===void 0)u=".CA";else{u=".C";var S="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",A=0,C=0;for(r=0;r<=x;++r)for(A=A<<8|f[r],C+=8;C>=5;){var B=A>>C-5&31;u+=S[B],C-=5,A&=(1<<C)-1}C&&(A<<=5-C,u+=S[A&31])}}a+=u}return a},l.mp4aSampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var a=this.esds.esd.getOTI(),u=this.esds.esd.getAudioConfig();return r+"."+l.decimalToHex(a)+(u?"."+u:"")}else return r},l.stxtSampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this);return this.mime_format?r+"."+this.mime_format:r},l.vp08SampleEntry.prototype.getCodec=l.vp09SampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this),a=this.vpcC.level;a==0&&(a="00");var u=this.vpcC.bitDepth;return u==8&&(u="08"),r+".0"+this.vpcC.profile+"."+a+"."+u},l.av01SampleEntry.prototype.getCodec=function(){var r=l.SampleEntry.prototype.getCodec.call(this),a=this.av1C.seq_level_idx_0;a<10&&(a="0"+a);var u;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?u=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(u=this.av1C.high_bitdepth===1?"10":"08"),r+"."+this.av1C.seq_profile+"."+a+(this.av1C.seq_tier_0?"H":"M")+"."+u},l.Box.prototype.writeHeader=function(r,a){this.size+=8,this.size>o&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+r.getPosition()+(a||"")),this.size>o?r.writeUint32(1):(this.sizePosition=r.getPosition(),r.writeUint32(this.size)),r.writeString(this.type,null,4),this.type==="uuid"&&r.writeUint8Array(this.uuid),this.size>o&&r.writeUint64(this.size)},l.FullBox.prototype.writeHeader=function(r){this.size+=4,l.Box.prototype.writeHeader.call(this,r," v="+this.version+" f="+this.flags),r.writeUint8(this.version),r.writeUint24(this.flags)},l.Box.prototype.write=function(r){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(r),r.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(r),this.data&&r.writeUint8Array(this.data))},l.ContainerBox.prototype.write=function(r){this.size=0,this.writeHeader(r);for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&(this.boxes[a].write(r),this.size+=this.boxes[a].size);t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.TrackReferenceTypeBox.prototype.write=function(r){this.size=this.track_ids.length*4,this.writeHeader(r),r.writeUint32Array(this.track_ids)},l.avcCBox.prototype.write=function(r){var a;for(this.size=7,a=0;a<this.SPS.length;a++)this.size+=2+this.SPS[a].length;for(a=0;a<this.PPS.length;a++)this.size+=2+this.PPS[a].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8(this.AVCProfileIndication),r.writeUint8(this.profile_compatibility),r.writeUint8(this.AVCLevelIndication),r.writeUint8(this.lengthSizeMinusOne+252),r.writeUint8(this.SPS.length+224),a=0;a<this.SPS.length;a++)r.writeUint16(this.SPS[a].length),r.writeUint8Array(this.SPS[a].nalu);for(r.writeUint8(this.PPS.length),a=0;a<this.PPS.length;a++)r.writeUint16(this.PPS[a].length),r.writeUint8Array(this.PPS[a].nalu);this.ext&&r.writeUint8Array(this.ext)},l.co64Box.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),a=0;a<this.chunk_offsets.length;a++)r.writeUint64(this.chunk_offsets[a])},l.cslgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeInt32(this.compositionToDTSShift),r.writeInt32(this.leastDecodeToDisplayDelta),r.writeInt32(this.greatestDecodeToDisplayDelta),r.writeInt32(this.compositionStartTime),r.writeInt32(this.compositionEndTime)},l.cttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),this.version===1?r.writeInt32(this.sample_offsets[a]):r.writeUint32(this.sample_offsets[a])},l.drefBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.elngBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(r),r.writeString(this.extended_language)},l.elstBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(r),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeUint32(u.segment_duration),r.writeInt32(u.media_time),r.writeInt16(u.media_rate_integer),r.writeInt16(u.media_rate_fraction)}},l.emsgBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(r),r.writeCString(this.scheme_id_uri),r.writeCString(this.value),r.writeUint32(this.timescale),r.writeUint32(this.presentation_time_delta),r.writeUint32(this.event_duration),r.writeUint32(this.id),r.writeUint8Array(this.message_data)},l.ftypBox.prototype.write=function(r){this.size=8+4*this.compatible_brands.length,this.writeHeader(r),r.writeString(this.major_brand,null,4),r.writeUint32(this.minor_version);for(var a=0;a<this.compatible_brands.length;a++)r.writeString(this.compatible_brands[a],null,4)},l.hdlrBox.prototype.write=function(r){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(r),r.writeUint32(0),r.writeString(this.handler,null,4),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeCString(this.name)},l.hvcCBox.prototype.write=function(r){var a,u;for(this.size=23,a=0;a<this.nalu_arrays.length;a++)for(this.size+=3,u=0;u<this.nalu_arrays[a].length;u++)this.size+=2+this.nalu_arrays[a][u].data.length;for(this.writeHeader(r),r.writeUint8(this.configurationVersion),r.writeUint8((this.general_profile_space<<6)+(this.general_tier_flag<<5)+this.general_profile_idc),r.writeUint32(this.general_profile_compatibility),r.writeUint8Array(this.general_constraint_indicator),r.writeUint8(this.general_level_idc),r.writeUint16(this.min_spatial_segmentation_idc+(15<<24)),r.writeUint8(this.parallelismType+252),r.writeUint8(this.chroma_format_idc+252),r.writeUint8(this.bit_depth_luma_minus8+248),r.writeUint8(this.bit_depth_chroma_minus8+248),r.writeUint16(this.avgFrameRate),r.writeUint8((this.constantFrameRate<<6)+(this.numTemporalLayers<<3)+(this.temporalIdNested<<2)+this.lengthSizeMinusOne),r.writeUint8(this.nalu_arrays.length),a=0;a<this.nalu_arrays.length;a++)for(r.writeUint8((this.nalu_arrays[a].completeness<<7)+this.nalu_arrays[a].nalu_type),r.writeUint16(this.nalu_arrays[a].length),u=0;u<this.nalu_arrays[a].length;u++)r.writeUint16(this.nalu_arrays[a][u].data.length),r.writeUint8Array(this.nalu_arrays[a][u].data)},l.kindBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(r),r.writeCString(this.schemeURI),r.writeCString(this.value)},l.mdhdBox.prototype.write=function(r){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint16(this.language),r.writeUint16(0)},l.mehdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.fragment_duration)},l.mfhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4,this.writeHeader(r),r.writeUint32(this.sequence_number)},l.mvhdBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.timescale),r.writeUint32(this.duration),r.writeUint32(this.rate),r.writeUint16(this.volume<<8),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32Array(this.matrix),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(this.next_track_id)},l.SampleEntry.prototype.writeHeader=function(r){this.size=8,l.Box.prototype.writeHeader.call(this,r),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint8(0),r.writeUint16(this.data_reference_index)},l.SampleEntry.prototype.writeFooter=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r),this.size+=this.boxes[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.SampleEntry.prototype.write=function(r){this.writeHeader(r),r.writeUint8Array(this.data),this.size+=this.data.length,t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.VisualSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*7+6*4+32,r.writeUint16(0),r.writeUint16(0),r.writeUint32(0),r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.width),r.writeUint16(this.height),r.writeUint32(this.horizresolution),r.writeUint32(this.vertresolution),r.writeUint32(0),r.writeUint16(this.frame_count),r.writeUint8(Math.min(31,this.compressorname.length)),r.writeString(this.compressorname,null,31),r.writeUint16(this.depth),r.writeInt16(-1),this.writeFooter(r)},l.AudioSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=2*4+3*4,r.writeUint32(0),r.writeUint32(0),r.writeUint16(this.channel_count),r.writeUint16(this.samplesize),r.writeUint16(0),r.writeUint16(0),r.writeUint32(this.samplerate<<16),this.writeFooter(r)},l.stppSampleEntry.prototype.write=function(r){this.writeHeader(r),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,r.writeCString(this.namespace),r.writeCString(this.schema_location),r.writeCString(this.auxiliary_mime_types),this.writeFooter(r)},l.SampleGroupEntry.prototype.write=function(r){r.writeUint8Array(this.data)},l.sbgpBox.prototype.write=function(r){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(r),r.writeString(this.grouping_type,null,4),r.writeUint32(this.grouping_type_parameter),r.writeUint32(this.entries.length);for(var a=0;a<this.entries.length;a++){var u=this.entries[a];r.writeInt32(u.sample_count),r.writeInt32(u.group_description_index)}},l.sgpdBox.prototype.write=function(r){var a,u;for(this.flags=0,this.size=12,a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=u.data.length);for(this.writeHeader(r),r.writeString(this.grouping_type,null,4),this.version===1&&r.writeUint32(this.default_length),this.version>=2&&r.writeUint32(this.default_sample_description_index),r.writeUint32(this.entries.length),a=0;a<this.entries.length;a++)u=this.entries[a],this.version===1&&this.default_length===0&&r.writeUint32(u.description_length),u.write(r)},l.sidxBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(r),r.writeUint32(this.reference_ID),r.writeUint32(this.timescale),r.writeUint32(this.earliest_presentation_time),r.writeUint32(this.first_offset),r.writeUint16(0),r.writeUint16(this.references.length);for(var a=0;a<this.references.length;a++){var u=this.references[a];r.writeUint32(u.reference_type<<31|u.referenced_size),r.writeUint32(u.subsegment_duration),r.writeUint32(u.starts_with_SAP<<31|u.SAP_type<<28|u.SAP_delta_time)}},l.smhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=4,this.writeHeader(r),r.writeUint16(this.balance),r.writeUint16(0)},l.stcoBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(r),r.writeUint32(this.chunk_offsets.length),r.writeUint32Array(this.chunk_offsets)},l.stscBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(r),r.writeUint32(this.first_chunk.length),a=0;a<this.first_chunk.length;a++)r.writeUint32(this.first_chunk[a]),r.writeUint32(this.samples_per_chunk[a]),r.writeUint32(this.sample_description_index[a])},l.stsdBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(r),r.writeUint32(this.entries.length),this.size+=4,a=0;a<this.entries.length;a++)this.entries[a].write(r),this.size+=this.entries[a].size;t.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),r.adjustUint32(this.sizePosition,this.size)},l.stshBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(r),r.writeUint32(this.shadowed_sample_numbers.length),a=0;a<this.shadowed_sample_numbers.length;a++)r.writeUint32(this.shadowed_sample_numbers[a]),r.writeUint32(this.sync_sample_numbers[a])},l.stssBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(r),r.writeUint32(this.sample_numbers.length),r.writeUint32Array(this.sample_numbers)},l.stszBox.prototype.write=function(r){var a,u=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(a=0;a+1<this.sample_sizes.length;)if(this.sample_sizes[a+1]!==this.sample_sizes[0]){u=!1;break}else a++;else u=!1;this.size=8,u||(this.size+=4*this.sample_sizes.length),this.writeHeader(r),u?r.writeUint32(this.sample_sizes[0]):r.writeUint32(0),r.writeUint32(this.sample_sizes.length),u||r.writeUint32Array(this.sample_sizes)},l.sttsBox.prototype.write=function(r){var a;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(r),r.writeUint32(this.sample_counts.length),a=0;a<this.sample_counts.length;a++)r.writeUint32(this.sample_counts[a]),r.writeUint32(this.sample_deltas[a])},l.tfdtBox.prototype.write=function(r){var a=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>a?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(r),this.version===1?r.writeUint64(this.baseMediaDecodeTime):r.writeUint32(this.baseMediaDecodeTime)},l.tfhdBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(r),r.writeUint32(this.track_id),this.flags&l.TFHD_FLAG_BASE_DATA_OFFSET&&r.writeUint64(this.base_data_offset),this.flags&l.TFHD_FLAG_SAMPLE_DESC&&r.writeUint32(this.default_sample_description_index),this.flags&l.TFHD_FLAG_SAMPLE_DUR&&r.writeUint32(this.default_sample_duration),this.flags&l.TFHD_FLAG_SAMPLE_SIZE&&r.writeUint32(this.default_sample_size),this.flags&l.TFHD_FLAG_SAMPLE_FLAGS&&r.writeUint32(this.default_sample_flags)},l.tkhdBox.prototype.write=function(r){this.version=0,this.size=4*18+2*4,this.writeHeader(r),r.writeUint32(this.creation_time),r.writeUint32(this.modification_time),r.writeUint32(this.track_id),r.writeUint32(0),r.writeUint32(this.duration),r.writeUint32(0),r.writeUint32(0),r.writeInt16(this.layer),r.writeInt16(this.alternate_group),r.writeInt16(this.volume<<8),r.writeUint16(0),r.writeInt32Array(this.matrix),r.writeUint32(this.width),r.writeUint32(this.height)},l.trexBox.prototype.write=function(r){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(r),r.writeUint32(this.track_id),r.writeUint32(this.default_sample_description_index),r.writeUint32(this.default_sample_duration),r.writeUint32(this.default_sample_size),r.writeUint32(this.default_sample_flags)},l.trunBox.prototype.write=function(r){this.version=0,this.size=4,this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&l.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&l.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&l.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(r),r.writeUint32(this.sample_count),this.flags&l.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=r.getPosition(),r.writeInt32(this.data_offset)),this.flags&l.TRUN_FLAGS_FIRST_FLAG&&r.writeUint32(this.first_sample_flags);for(var a=0;a<this.sample_count;a++)this.flags&l.TRUN_FLAGS_DURATION&&r.writeUint32(this.sample_duration[a]),this.flags&l.TRUN_FLAGS_SIZE&&r.writeUint32(this.sample_size[a]),this.flags&l.TRUN_FLAGS_FLAGS&&r.writeUint32(this.sample_flags[a]),this.flags&l.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?r.writeUint32(this.sample_composition_time_offset[a]):r.writeInt32(this.sample_composition_time_offset[a]))},l["url Box"].prototype.write=function(r){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(r),this.location&&r.writeCString(this.location)},l["urn Box"].prototype.write=function(r){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(r),r.writeCString(this.name),this.location&&r.writeCString(this.location)},l.vmhdBox.prototype.write=function(r){this.version=0,this.flags=1,this.size=8,this.writeHeader(r),r.writeUint16(this.graphicsmode),r.writeUint16Array(this.opcolor)},l.cttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)r[f].pts=r[f].dts+this.sample_offsets[a],f++},l.sttsBox.prototype.unpack=function(r){var a,u,f;for(f=0,a=0;a<this.sample_counts.length;a++)for(u=0;u<this.sample_counts[a];u++)f===0?r[f].dts=0:r[f].dts=r[f-1].dts+this.sample_deltas[a],f++},l.stcoBox.prototype.unpack=function(r){var a;for(a=0;a<this.chunk_offsets.length;a++)r[a].offset=this.chunk_offsets[a]},l.stscBox.prototype.unpack=function(r){var a,u,f,g,x;for(g=0,x=0,a=0;a<this.first_chunk.length;a++)for(u=0;u<(a+1<this.first_chunk.length?this.first_chunk[a+1]:1/0);u++)for(x++,f=0;f<this.samples_per_chunk[a];f++){if(r[g])r[g].description_index=this.sample_description_index[a],r[g].chunk_index=x;else return;g++}},l.stszBox.prototype.unpack=function(r){var a;for(a=0;a<this.sample_sizes.length;a++)r[a].size=this.sample_sizes[a]},l.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"],l.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"],l.boxEqualFields=function(r,a){if(r&&!a)return!1;var u;for(u in r)if(!(l.DIFF_BOXES_PROP_NAMES.indexOf(u)>-1)){if(r[u]instanceof l.Box||a[u]instanceof l.Box)continue;if(typeof r[u]>"u"||typeof a[u]>"u")continue;if(typeof r[u]=="function"||typeof a[u]=="function")continue;if(r.subBoxNames&&r.subBoxNames.indexOf(u.slice(0,4))>-1||a.subBoxNames&&a.subBoxNames.indexOf(u.slice(0,4))>-1)continue;if(u==="data"||u==="start"||u==="size"||u==="creation_time"||u==="modification_time")continue;if(l.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(u)>-1)continue;if(r[u]!==a[u])return!1}return!0},l.boxEqual=function(r,a){if(!l.boxEqualFields(r,a))return!1;for(var u=0;u<l.DIFF_BOXES_PROP_NAMES.length;u++){var f=l.DIFF_BOXES_PROP_NAMES[u];if(r[f]&&a[f]&&!l.boxEqual(r[f],a[f]))return!1}return!0};var v=function(){};v.prototype.parseSample=function(r){var a={},u;a.resources=[];var f=new e(r.data.buffer);if(!r.subsamples||r.subsamples.length===0)a.documentString=f.readString(r.data.length);else if(a.documentString=f.readString(r.subsamples[0].size),r.subsamples.length>1)for(u=1;u<r.subsamples.length;u++)a.resources[u]=f.readUint8Array(r.subsamples[u].size);return typeof DOMParser<"u"&&(a.document=new DOMParser().parseFromString(a.documentString,"application/xml")),a};var w=function(){};w.prototype.parseSample=function(r){var a,u=new e(r.data.buffer);return a=u.readString(r.data.length),a},w.prototype.parseConfig=function(r){var a,u=new e(r.buffer);return u.readUint32(),a=u.readCString(),a},s.XMLSubtitlein4Parser=v,s.Textin4Parser=w;var b=function(r){this.stream=r||new h,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};b.prototype.setSegmentOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.fragmentedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.segmentStream=null,g.nb_samples=1e3,g.rapAlignement=!0,u&&(u.nbSamples&&(g.nb_samples=u.nbSamples),u.rapAlignement&&(g.rapAlignement=u.rapAlignement))}},b.prototype.unsetSegmentOptions=function(r){for(var a=-1,u=0;u<this.fragmentedTracks.length;u++){var f=this.fragmentedTracks[u];f.id==r&&(a=u)}a>-1&&this.fragmentedTracks.splice(a,1)},b.prototype.setExtractionOptions=function(r,a,u){var f=this.getTrackById(r);if(f){var g={};this.extractedTracks.push(g),g.id=r,g.user=a,g.trak=f,f.nextSample=0,g.nb_samples=1e3,g.samples=[],u&&u.nbSamples&&(g.nb_samples=u.nbSamples)}},b.prototype.unsetExtractionOptions=function(r){for(var a=-1,u=0;u<this.extractedTracks.length;u++){var f=this.extractedTracks[u];f.id==r&&(a=u)}a>-1&&this.extractedTracks.splice(a,1)},b.prototype.parse=function(){var r,a,u=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),r=l.parseOneBox(this.stream,u),r.code===l.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(r))continue;return}else return;else{var f;switch(a=r.box,f=a.type!=="uuid"?a.type:a.uuid,this.boxes.push(a),f){case"mdat":this.mdats.push(a);break;case"moof":this.moofs.push(a);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[f]!==void 0&&t.warn("ISOFile","Duplicate Box of type: "+f+", overriding previous occurrence"),this[f]=a;break}this.updateUsedBytes&&this.updateUsedBytes(a,r)}},b.prototype.checkBuffer=function(r){if(r==null)throw"Buffer must be defined and non empty";if(r.fileStart===void 0)throw"Buffer must have a fileStart property";return r.byteLength===0?(t.warn("ISOFile","Ignoring empty buffer (fileStart: "+r.fileStart+")"),this.stream.logBufferLevel(),!1):(t.info("ISOFile","Processing buffer (fileStart: "+r.fileStart+")"),r.usedBytes=0,this.stream.insertBuffer(r),this.stream.logBufferLevel(),this.stream.initialized()?!0:(t.warn("ISOFile","Not ready to start parsing"),!1))},b.prototype.appendBuffer=function(r,a){var u;if(this.checkBuffer(r))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(a),this.nextSeekPosition?(u=this.nextSeekPosition,this.nextSeekPosition=void 0):u=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(u=this.stream.getEndFilePositionAfter(u))):this.nextParsePosition?u=this.nextParsePosition:u=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(t.info("ISOFile","Done processing buffer (fileStart: "+r.fileStart+") - next buffer to fetch should have a fileStart position of "+u),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),u},b.prototype.getInfo=function(){var r,a,u={},f,g,x,S,A=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(u.hasMoov=!0,u.duration=this.moov.mvhd.duration,u.timescale=this.moov.mvhd.timescale,u.isFragmented=this.moov.mvex!=null,u.isFragmented&&this.moov.mvex.mehd&&(u.fragment_duration=this.moov.mvex.mehd.fragment_duration),u.isProgressive=this.isProgressive,u.hasIOD=this.moov.iods!=null,u.brands=[],u.brands.push(this.ftyp.major_brand),u.brands=u.brands.concat(this.ftyp.compatible_brands),u.created=new Date(A+this.moov.mvhd.creation_time*1e3),u.modified=new Date(A+this.moov.mvhd.modification_time*1e3),u.tracks=[],u.audioTracks=[],u.videoTracks=[],u.subtitleTracks=[],u.metadataTracks=[],u.hintTracks=[],u.otherTracks=[],r=0;r<this.moov.traks.length;r++){if(f=this.moov.traks[r],S=f.mdia.minf.stbl.stsd.entries[0],g={},u.tracks.push(g),g.id=f.tkhd.track_id,g.name=f.mdia.hdlr.name,g.references=[],f.tref)for(a=0;a<f.tref.boxes.length;a++)x={},g.references.push(x),x.type=f.tref.boxes[a].type,x.track_ids=f.tref.boxes[a].track_ids;f.edts&&(g.edits=f.edts.elst.entries),g.created=new Date(A+f.tkhd.creation_time*1e3),g.modified=new Date(A+f.tkhd.modification_time*1e3),g.movie_duration=f.tkhd.duration,g.movie_timescale=u.timescale,g.layer=f.tkhd.layer,g.alternate_group=f.tkhd.alternate_group,g.volume=f.tkhd.volume,g.matrix=f.tkhd.matrix,g.track_width=f.tkhd.width/65536,g.track_height=f.tkhd.height/65536,g.timescale=f.mdia.mdhd.timescale,g.cts_shift=f.mdia.minf.stbl.cslg,g.duration=f.mdia.mdhd.duration,g.samples_duration=f.samples_duration,g.codec=S.getCodec(),g.kind=f.udta&&f.udta.kinds.length?f.udta.kinds[0]:{schemeURI:"",value:""},g.language=f.mdia.elng?f.mdia.elng.extended_language:f.mdia.mdhd.languageString,g.nb_samples=f.samples.length,g.size=f.samples_size,g.bitrate=g.size*8*g.timescale/g.samples_duration,S.isAudio()?(g.type="audio",u.audioTracks.push(g),g.audio={},g.audio.sample_rate=S.getSampleRate(),g.audio.channel_count=S.getChannelCount(),g.audio.sample_size=S.getSampleSize()):S.isVideo()?(g.type="video",u.videoTracks.push(g),g.video={},g.video.width=S.getWidth(),g.video.height=S.getHeight()):S.isSubtitle()?(g.type="subtitles",u.subtitleTracks.push(g)):S.isHint()?(g.type="metadata",u.hintTracks.push(g)):S.isMetadata()?(g.type="metadata",u.metadataTracks.push(g)):(g.type="metadata",u.otherTracks.push(g))}else u.hasMoov=!1;if(u.mime="",u.hasMoov&&u.tracks){for(u.videoTracks&&u.videoTracks.length>0?u.mime+='video/mp4; codecs="':u.audioTracks&&u.audioTracks.length>0?u.mime+='audio/mp4; codecs="':u.mime+='application/mp4; codecs="',r=0;r<u.tracks.length;r++)r!==0&&(u.mime+=","),u.mime+=u.tracks[r].codec;u.mime+='"; profiles="',u.mime+=this.ftyp.compatible_brands.join(),u.mime+='"'}return u},b.prototype.setNextSeekPositionFromSample=function(r){r&&(this.nextSeekPosition?this.nextSeekPosition=Math.min(r.offset+r.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=r.offset+r.alreadyRead)},b.prototype.processSamples=function(r){var a,u;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(a=0;a<this.fragmentedTracks.length;a++){var f=this.fragmentedTracks[a];for(u=f.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Creating media fragment on track #"+f.id+" for sample "+u.nextSample);var g=this.createFragment(f.id,u.nextSample,f.segmentStream);if(g)f.segmentStream=g,u.nextSample++;else break;if((u.nextSample%f.nb_samples===0||r||u.nextSample>=u.samples.length)&&(t.info("ISOFile","Sending fragmented data on track #"+f.id+" for samples ["+Math.max(0,u.nextSample-f.nb_samples)+","+(u.nextSample-1)+"]"),t.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(f.id,f.user,f.segmentStream.buffer,u.nextSample,r||u.nextSample>=u.samples.length),f.segmentStream=null,f!==this.fragmentedTracks[a]))break}}if(this.onSamples!==null)for(a=0;a<this.extractedTracks.length;a++){var x=this.extractedTracks[a];for(u=x.trak;u.nextSample<u.samples.length&&this.sampleProcessingStarted;){t.debug("ISOFile","Exporting on track #"+x.id+" sample #"+u.nextSample);var S=this.getSample(u,u.nextSample);if(S)u.nextSample++,x.samples.push(S);else{this.setNextSeekPositionFromSample(u.samples[u.nextSample]);break}if((u.nextSample%x.nb_samples===0||u.nextSample>=u.samples.length)&&(t.debug("ISOFile","Sending samples on track #"+x.id+" for sample "+u.nextSample),this.onSamples&&this.onSamples(x.id,x.user,x.samples),x.samples=[],x!==this.extractedTracks[a]))break}}}},b.prototype.getBox=function(r){var a=this.getBoxes(r,!0);return a.length?a[0]:null},b.prototype.getBoxes=function(r,a){var u=[];return b._sweep.call(this,r,u,a),u},b._sweep=function(r,a,u){this.type&&this.type==r&&a.push(this);for(var f in this.boxes){if(a.length&&u)return;b._sweep.call(this.boxes[f],r,a,u)}},b.prototype.getTrackSamplesInfo=function(r){var a=this.getTrackById(r);if(a)return a.samples},b.prototype.getTrackSample=function(r,a){var u=this.getTrackById(r),f=this.getSample(u,a);return f},b.prototype.releaseUsedSamples=function(r,a){var u=0,f=this.getTrackById(r);f.lastValidSample||(f.lastValidSample=0);for(var g=f.lastValidSample;g<a;g++)u+=this.releaseSample(f,g);t.info("ISOFile","Track #"+r+" released samples up to "+a+" (released size: "+u+", remaining: "+this.samplesDataSize+")"),f.lastValidSample=a},b.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)},b.prototype.stop=function(){this.sampleProcessingStarted=!1},b.prototype.flush=function(){t.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)},b.prototype.seekTrack=function(r,a,u){var f,g,x=1/0,S=0,A=0,C;if(u.samples.length===0)return t.info("ISOFile","No sample in track, cannot seek! Using time "+t.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(f=0;f<u.samples.length;f++){if(g=u.samples[f],f===0)A=0,C=g.timescale;else if(g.cts>r*g.timescale){A=f-1;break}a&&g.is_sync&&(S=f)}for(a&&(A=S),r=u.samples[A].cts,u.nextSample=A;u.samples[A].alreadyRead===u.samples[A].size&&u.samples[A+1];)A++;return x=u.samples[A].offset+u.samples[A].alreadyRead,t.info("ISOFile","Seeking to "+(a?"RAP":"")+" sample #"+u.nextSample+" on track "+u.tkhd.track_id+", time "+t.getDurationString(r,C)+" and offset: "+x),{offset:x,time:r/C}},b.prototype.getTrackDuration=function(r){var a;return r.samples?(a=r.samples[r.samples.length-1],(a.cts+a.duration)/a.timescale):1/0},b.prototype.seek=function(r,a){var u=this.moov,f,g,x,S={offset:1/0,time:1/0};if(this.moov){for(x=0;x<u.traks.length;x++)f=u.traks[x],!(r>this.getTrackDuration(f))&&(g=this.seekTrack(r,a,f),g.offset<S.offset&&(S.offset=g.offset),g.time<S.time&&(S.time=g.time));return t.info("ISOFile","Seeking at time "+t.getDurationString(S.time,1)+" needs a buffer with a fileStart position of "+S.offset),S.offset===1/0?S={offset:this.nextParsePosition,time:0}:S.offset=this.stream.getEndFilePositionAfter(S.offset),t.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+S.offset),S}else throw"Cannot seek: moov not received!"},b.prototype.equal=function(r){for(var a=0;a<this.boxes.length&&a<r.boxes.length;){var u=this.boxes[a],f=r.boxes[a];if(!l.boxEqual(u,f))return!1;a++}return!0},s.ISOFile=b,b.prototype.lastBoxStartPosition=0,b.prototype.parsingMdat=null,b.prototype.nextParsePosition=0,b.prototype.discardMdatData=!1,b.prototype.processIncompleteBox=function(r){var a,u,f;return r.type==="mdat"?(a=new l[r.type+"Box"](r.size),this.parsingMdat=a,this.boxes.push(a),this.mdats.push(a),a.start=r.start,a.hdr_size=r.hdr_size,this.stream.addUsedBytes(a.hdr_size),this.lastBoxStartPosition=a.start+a.size,f=this.stream.seek(a.start+a.size,!1,this.discardMdatData),f?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=a.start+a.size,!1)):(r.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),u=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,u?(this.nextParsePosition=this.stream.getEndPosition(),!0):(r.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+r.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},b.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null},b.prototype.processIncompleteMdat=function(){var r,a;return r=this.parsingMdat,a=this.stream.seek(r.start+r.size,!1,this.discardMdatData),a?(t.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},b.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},b.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},b.prototype.updateUsedBytes=function(r,a){this.stream.addUsedBytes&&(r.type==="mdat"?(this.stream.addUsedBytes(r.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(r.size-r.hdr_size)):this.stream.addUsedBytes(r.size))},b.prototype.add=l.Box.prototype.add,b.prototype.addBox=l.Box.prototype.addBox,b.prototype.init=function(r){var a=r||{};this.add("ftyp").set("major_brand",a.brands&&a.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",a.brands||["iso4"]);var u=this.add("moov");return u.add("mvhd").set("timescale",a.timescale||600).set("rate",a.rate||65536).set("creation_time",0).set("modification_time",0).set("duration",a.duration||0).set("volume",a.width?0:256).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("next_track_id",1),u.add("mvex"),this},b.prototype.addTrack=function(r){this.moov||this.init(r);var a=r||{};a.width=a.width||320,a.height=a.height||320,a.id=a.id||this.moov.mvhd.next_track_id,a.type=a.type||"avc1";var u=this.moov.add("trak");this.moov.mvhd.next_track_id=a.id+1,u.add("tkhd").set("flags",l.TKHD_FLAG_ENABLED|l.TKHD_FLAG_IN_MOVIE|l.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",a.id).set("duration",a.duration||0).set("layer",a.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[65536,0,0,0,65536,0,0,0,1073741824]).set("width",a.width<<16).set("height",a.height<<16);var f=u.add("mdia");f.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",a.timescale||1).set("duration",a.media_duration||0).set("language",a.language||"und"),f.add("hdlr").set("handler",a.hdlr||"vide").set("name",a.name||"Track created with MP4Box.js"),f.add("elng").set("extended_language",a.language||"fr-FR");var g=f.add("minf");if(l[a.type+"SampleEntry"]!==void 0){var x=new l[a.type+"SampleEntry"];x.data_reference_index=1;var S="";for(var A in l.sampleEntryCodes)for(var C=l.sampleEntryCodes[A],B=0;B<C.length;B++)if(C.indexOf(a.type)>-1){S=A;break}switch(S){case"Visual":if(g.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),x.set("width",a.width).set("height",a.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",a.type+" Compressor").set("depth",24),a.avcDecoderConfigRecord){var R=new l.avcCBox;R.parse(new e(a.avcDecoderConfigRecord)),x.addBox(R)}else if(a.hevcDecoderConfigRecord){var M=new l.hvcCBox;M.parse(new e(a.hevcDecoderConfigRecord)),x.addBox(M)}break;case"Audio":g.add("smhd").set("balance",a.balance||0),x.set("channel_count",a.channel_count||2).set("samplesize",a.samplesize||16).set("samplerate",a.samplerate||65536);break;case"Hint":g.add("hmhd");break;case"Subtitle":switch(g.add("sthd"),a.type){case"stpp":x.set("namespace",a.namespace||"nonamespace").set("schema_location",a.schema_location||"").set("auxiliary_mime_types",a.auxiliary_mime_types||"");break}break;case"Metadata":g.add("nmhd");break;case"System":g.add("nmhd");break;default:g.add("nmhd");break}a.description&&x.addBox(a.description),a.description_boxes&&a.description_boxes.forEach(function(L){x.addBox(L)}),g.add("dinf").add("dref").addEntry(new l["url Box"]().set("flags",1));var N=g.add("stbl");return N.add("stsd").addEntry(x),N.add("stts").set("sample_counts",[]).set("sample_deltas",[]),N.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),N.add("stco").set("chunk_offsets",[]),N.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",a.id).set("default_sample_description_index",a.default_sample_description_index||1).set("default_sample_duration",a.default_sample_duration||0).set("default_sample_size",a.default_sample_size||0).set("default_sample_flags",a.default_sample_flags||0),this.buildTrakSampleLists(u),a.id}},l.Box.prototype.computeSize=function(r){var a=r||new n;a.endianness=n.BIG_ENDIAN,this.write(a)},b.prototype.addSample=function(r,a,u){var f=u||{},g={},x=this.getTrackById(r);if(x!==null){g.number=x.samples.length,g.track_id=x.tkhd.track_id,g.timescale=x.mdia.mdhd.timescale,g.description_index=f.sample_description_index?f.sample_description_index-1:0,g.description=x.mdia.minf.stbl.stsd.entries[g.description_index],g.data=a,g.size=a.byteLength,g.alreadyRead=g.size,g.duration=f.duration||1,g.cts=f.cts||0,g.dts=f.dts||0,g.is_sync=f.is_sync||!1,g.is_leading=f.is_leading||0,g.depends_on=f.depends_on||0,g.is_depended_on=f.is_depended_on||0,g.has_redundancy=f.has_redundancy||0,g.degradation_priority=f.degradation_priority||0,g.offset=0,g.subsamples=f.subsamples,x.samples.push(g),x.samples_size+=g.size,x.samples_duration+=g.duration,x.first_dts===void 0&&(x.first_dts=f.dts),this.processSamples();var S=this.createSingleSampleMoof(g);return this.addBox(S),S.computeSize(),S.trafs[0].truns[0].data_offset=S.size+8,this.add("mdat").data=new Uint8Array(a),g}},b.prototype.createSingleSampleMoof=function(r){var a=0;r.is_sync?a=1<<25:a=65536;var u=new l.moofBox;u.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var f=u.add("traf"),g=this.getTrackById(r.track_id);return f.add("tfhd").set("track_id",r.track_id).set("flags",l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),f.add("tfdt").set("baseMediaDecodeTime",r.dts-(g.first_dts||0)),f.add("trun").set("flags",l.TRUN_FLAGS_DATA_OFFSET|l.TRUN_FLAGS_DURATION|l.TRUN_FLAGS_SIZE|l.TRUN_FLAGS_FLAGS|l.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[r.duration]).set("sample_size",[r.size]).set("sample_flags",[a]).set("sample_composition_time_offset",[r.cts-r.dts]),u},b.prototype.lastMoofIndex=0,b.prototype.samplesDataSize=0,b.prototype.resetTables=function(){var r,a,u,f,g,x,S,A;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,r=0;r<this.moov.traks.length;r++){a=this.moov.traks[r],a.tkhd.duration=0,a.mdia.mdhd.duration=0,u=a.mdia.minf.stbl.stco||a.mdia.minf.stbl.co64,u.chunk_offsets=[],f=a.mdia.minf.stbl.stsc,f.first_chunk=[],f.samples_per_chunk=[],f.sample_description_index=[],g=a.mdia.minf.stbl.stsz||a.mdia.minf.stbl.stz2,g.sample_sizes=[],x=a.mdia.minf.stbl.stts,x.sample_counts=[],x.sample_deltas=[],S=a.mdia.minf.stbl.ctts,S&&(S.sample_counts=[],S.sample_offsets=[]),A=a.mdia.minf.stbl.stss;var C=a.mdia.minf.stbl.boxes.indexOf(A);C!=-1&&(a.mdia.minf.stbl.boxes[C]=null)}},b.initSampleGroups=function(r,a,u,f,g){var x,S,A,C;function B(R,M,N){this.grouping_type=R,this.grouping_type_parameter=M,this.sbgp=N,this.last_sample_in_run=-1,this.entry_index=-1}for(a&&(a.sample_groups_info=[]),r.sample_groups_info||(r.sample_groups_info=[]),S=0;S<u.length;S++){for(C=u[S].grouping_type+"/"+u[S].grouping_type_parameter,A=new B(u[S].grouping_type,u[S].grouping_type_parameter,u[S]),a&&(a.sample_groups_info[C]=A),r.sample_groups_info[C]||(r.sample_groups_info[C]=A),x=0;x<f.length;x++)f[x].grouping_type===u[S].grouping_type&&(A.description=f[x],A.description.used=!0);if(g)for(x=0;x<g.length;x++)g[x].grouping_type===u[S].grouping_type&&(A.fragment_description=g[x],A.fragment_description.used=!0,A.is_fragment=!0)}if(a){if(g)for(S=0;S<g.length;S++)!g[S].used&&g[S].version>=2&&(C=g[S].grouping_type+"/0",A=new B(g[S].grouping_type,0),A.is_fragment=!0,a.sample_groups_info[C]||(a.sample_groups_info[C]=A))}else for(S=0;S<f.length;S++)!f[S].used&&f[S].version>=2&&(C=f[S].grouping_type+"/0",A=new B(f[S].grouping_type,0),r.sample_groups_info[C]||(r.sample_groups_info[C]=A))},b.setSampleGroupProperties=function(r,a,u,f){var g,x;a.sample_groups=[];for(g in f)if(a.sample_groups[g]={},a.sample_groups[g].grouping_type=f[g].grouping_type,a.sample_groups[g].grouping_type_parameter=f[g].grouping_type_parameter,u>=f[g].last_sample_in_run&&(f[g].last_sample_in_run<0&&(f[g].last_sample_in_run=0),f[g].entry_index++,f[g].entry_index<=f[g].sbgp.entries.length-1&&(f[g].last_sample_in_run+=f[g].sbgp.entries[f[g].entry_index].sample_count)),f[g].entry_index<=f[g].sbgp.entries.length-1?a.sample_groups[g].group_description_index=f[g].sbgp.entries[f[g].entry_index].group_description_index:a.sample_groups[g].group_description_index=-1,a.sample_groups[g].group_description_index!==0){var S;f[g].fragment_description?S=f[g].fragment_description:S=f[g].description,a.sample_groups[g].group_description_index>0?(a.sample_groups[g].group_description_index>65535?x=(a.sample_groups[g].group_description_index>>16)-1:x=a.sample_groups[g].group_description_index-1,S&&x>=0&&(a.sample_groups[g].description=S.entries[x])):S&&S.version>=2&&S.default_group_description_index>0&&(a.sample_groups[g].description=S.entries[S.default_group_description_index-1])}},b.process_sdtp=function(r,a,u){a&&(r?(a.is_leading=r.is_leading[u],a.depends_on=r.sample_depends_on[u],a.is_depended_on=r.sample_is_depended_on[u],a.has_redundancy=r.sample_has_redundancy[u]):(a.is_leading=0,a.depends_on=0,a.is_depended_on=0,a.has_redundancy=0))},b.prototype.buildSampleLists=function(){var r,a;for(r=0;r<this.moov.traks.length;r++)a=this.moov.traks[r],this.buildTrakSampleLists(a)},b.prototype.buildTrakSampleLists=function(r){var a,u,f,g,x,S,A,C,B,R,M,N,L,W,k,j,Y,ut,it,gt,Q,rt,Z,H;if(r.samples=[],r.samples_duration=0,r.samples_size=0,u=r.mdia.minf.stbl.stco||r.mdia.minf.stbl.co64,f=r.mdia.minf.stbl.stsc,g=r.mdia.minf.stbl.stsz||r.mdia.minf.stbl.stz2,x=r.mdia.minf.stbl.stts,S=r.mdia.minf.stbl.ctts,A=r.mdia.minf.stbl.stss,C=r.mdia.minf.stbl.stsd,B=r.mdia.minf.stbl.subs,N=r.mdia.minf.stbl.stdp,R=r.mdia.minf.stbl.sbgps,M=r.mdia.minf.stbl.sgpds,ut=-1,it=-1,gt=-1,Q=-1,rt=0,Z=0,H=0,b.initSampleGroups(r,null,R,M),!(typeof g>"u")){for(a=0;a<g.sample_sizes.length;a++){var G={};G.number=a,G.track_id=r.tkhd.track_id,G.timescale=r.mdia.mdhd.timescale,G.alreadyRead=0,r.samples[a]=G,G.size=g.sample_sizes[a],r.samples_size+=G.size,a===0?(W=1,L=0,G.chunk_index=W,G.chunk_run_index=L,Y=f.samples_per_chunk[L],j=0,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0):a<Y?(G.chunk_index=W,G.chunk_run_index=L):(W++,G.chunk_index=W,j=0,W<=k||(L++,L+1<f.first_chunk.length?k=f.first_chunk[L+1]-1:k=1/0),G.chunk_run_index=L,Y+=f.samples_per_chunk[L]),G.description_index=f.sample_description_index[G.chunk_run_index]-1,G.description=C.entries[G.description_index],G.offset=u.chunk_offsets[G.chunk_index-1]+j,j+=G.size,a>ut&&(it++,ut<0&&(ut=0),ut+=x.sample_counts[it]),a>0?(r.samples[a-1].duration=x.sample_deltas[it],r.samples_duration+=r.samples[a-1].duration,G.dts=r.samples[a-1].dts+r.samples[a-1].duration):G.dts=0,S?(a>=gt&&(Q++,gt<0&&(gt=0),gt+=S.sample_counts[Q]),G.cts=r.samples[a].dts+S.sample_offsets[Q]):G.cts=G.dts,A?(a==A.sample_numbers[rt]-1?(G.is_sync=!0,rt++):(G.is_sync=!1,G.degradation_priority=0),B&&B.entries[Z].sample_delta+H==a+1&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta,Z++)):G.is_sync=!0,b.process_sdtp(r.mdia.minf.stbl.sdtp,G,G.number),N?G.degradation_priority=N.priority[a]:G.degradation_priority=0,B&&B.entries[Z].sample_delta+H==a&&(G.subsamples=B.entries[Z].subsamples,H+=B.entries[Z].sample_delta),(R.length>0||M.length>0)&&b.setSampleGroupProperties(r,G,a,r.sample_groups_info)}a>0&&(r.samples[a-1].duration=Math.max(r.mdia.mdhd.duration-r.samples[a-1].dts,0),r.samples_duration+=r.samples[a-1].duration)}},b.prototype.updateSampleLists=function(){var r,a,u,f,g,x,S,A,C,B,R,M,N,L,W;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(C=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,C.type=="moof")for(B=C,r=0;r<B.trafs.length;r++){for(R=B.trafs[r],M=this.getTrackById(R.tfhd.track_id),N=this.getTrexById(R.tfhd.track_id),R.tfhd.flags&l.TFHD_FLAG_SAMPLE_DESC?f=R.tfhd.default_sample_description_index:f=N?N.default_sample_description_index:1,R.tfhd.flags&l.TFHD_FLAG_SAMPLE_DUR?g=R.tfhd.default_sample_duration:g=N?N.default_sample_duration:0,R.tfhd.flags&l.TFHD_FLAG_SAMPLE_SIZE?x=R.tfhd.default_sample_size:x=N?N.default_sample_size:0,R.tfhd.flags&l.TFHD_FLAG_SAMPLE_FLAGS?S=R.tfhd.default_sample_flags:S=N?N.default_sample_flags:0,R.sample_number=0,R.sbgps.length>0&&b.initSampleGroups(M,R,R.sbgps,M.mdia.minf.stbl.sgpds,R.sgpds),a=0;a<R.truns.length;a++){var k=R.truns[a];for(u=0;u<k.sample_count;u++){L={},L.moof_number=this.lastMoofIndex,L.number_in_traf=R.sample_number,R.sample_number++,L.number=M.samples.length,R.first_sample_index=M.samples.length,M.samples.push(L),L.track_id=M.tkhd.track_id,L.timescale=M.mdia.mdhd.timescale,L.description_index=f-1,L.description=M.mdia.minf.stbl.stsd.entries[L.description_index],L.size=x,k.flags&l.TRUN_FLAGS_SIZE&&(L.size=k.sample_size[u]),M.samples_size+=L.size,L.duration=g,k.flags&l.TRUN_FLAGS_DURATION&&(L.duration=k.sample_duration[u]),M.samples_duration+=L.duration,M.first_traf_merged||u>0?L.dts=M.samples[M.samples.length-2].dts+M.samples[M.samples.length-2].duration:(R.tfdt?L.dts=R.tfdt.baseMediaDecodeTime:L.dts=0,M.first_traf_merged=!0),L.cts=L.dts,k.flags&l.TRUN_FLAGS_CTS_OFFSET&&(L.cts=L.dts+k.sample_composition_time_offset[u]),W=S,k.flags&l.TRUN_FLAGS_FLAGS?W=k.sample_flags[u]:u===0&&k.flags&l.TRUN_FLAGS_FIRST_FLAG&&(W=k.first_sample_flags),L.is_sync=!(W>>16&1),L.is_leading=W>>26&3,L.depends_on=W>>24&3,L.is_depended_on=W>>22&3,L.has_redundancy=W>>20&3,L.degradation_priority=W&65535;var j=!!(R.tfhd.flags&l.TFHD_FLAG_BASE_DATA_OFFSET),Y=!!(R.tfhd.flags&l.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),ut=!!(k.flags&l.TRUN_FLAGS_DATA_OFFSET),it=0;j?it=R.tfhd.base_data_offset:Y||a===0?it=B.start:it=A,a===0&&u===0?ut?L.offset=it+k.data_offset:L.offset=it:L.offset=A,A=L.offset+L.size,(R.sbgps.length>0||R.sgpds.length>0||M.mdia.minf.stbl.sbgps.length>0||M.mdia.minf.stbl.sgpds.length>0)&&b.setSampleGroupProperties(M,L,L.number_in_traf,R.sample_groups_info)}}if(R.subs){M.has_fragment_subsamples=!0;var gt=R.first_sample_index;for(a=0;a<R.subs.entries.length;a++)gt+=R.subs.entries[a].sample_delta,L=M.samples[gt-1],L.subsamples=R.subs.entries[a].subsamples}}}},b.prototype.getSample=function(r,a){var u,f=r.samples[a];if(!this.moov)return null;if(!f.data)f.data=new Uint8Array(f.size),f.alreadyRead=0,this.samplesDataSize+=f.size,t.debug("ISOFile","Allocating sample #"+a+" on track #"+r.tkhd.track_id+" of size "+f.size+" (total: "+this.samplesDataSize+")");else if(f.alreadyRead==f.size)return f;for(;;){var g=this.stream.findPosition(!0,f.offset+f.alreadyRead,!1);if(g>-1){u=this.stream.buffers[g];var x=u.byteLength-(f.offset+f.alreadyRead-u.fileStart);if(f.size-f.alreadyRead<=x)return t.debug("ISOFile","Getting sample #"+a+" data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+(f.size-f.alreadyRead)+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,f.size-f.alreadyRead),u.usedBytes+=f.size-f.alreadyRead,this.stream.logBufferLevel(),f.alreadyRead=f.size,f;if(x===0)return null;t.debug("ISOFile","Getting sample #"+a+" partial data (alreadyRead: "+f.alreadyRead+" offset: "+(f.offset+f.alreadyRead-u.fileStart)+" read size: "+x+" full size: "+f.size+")"),n.memcpy(f.data.buffer,f.alreadyRead,u,f.offset+f.alreadyRead-u.fileStart,x),f.alreadyRead+=x,u.usedBytes+=x,this.stream.logBufferLevel()}else return null}},b.prototype.releaseSample=function(r,a){var u=r.samples[a];return u.data?(this.samplesDataSize-=u.size,u.data=null,u.alreadyRead=0,u.size):0},b.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},b.prototype.getCodecs=function(){var r,a="";for(r=0;r<this.moov.traks.length;r++){var u=this.moov.traks[r];r>0&&(a+=","),a+=u.mdia.minf.stbl.stsd.entries[0].getCodec()}return a},b.prototype.getTrexById=function(r){var a;if(!this.moov||!this.moov.mvex)return null;for(a=0;a<this.moov.mvex.trexs.length;a++){var u=this.moov.mvex.trexs[a];if(u.track_id==r)return u}return null},b.prototype.getTrackById=function(r){if(this.moov===void 0)return null;for(var a=0;a<this.moov.traks.length;a++){var u=this.moov.traks[a];if(u.tkhd.track_id==r)return u}return null},b.prototype.items=[],b.prototype.entity_groups=[],b.prototype.itemsDataSize=0,b.prototype.flattenItemInfo=function(){var r=this.items,a=this.entity_groups,u,f,g,x=this.meta;if(x!=null&&x.hdlr!==void 0&&x.iinf!==void 0){for(u=0;u<x.iinf.item_infos.length;u++)g={},g.id=x.iinf.item_infos[u].item_ID,r[g.id]=g,g.ref_to=[],g.name=x.iinf.item_infos[u].item_name,x.iinf.item_infos[u].protection_index>0&&(g.protection=x.ipro.protections[x.iinf.item_infos[u].protection_index-1]),x.iinf.item_infos[u].item_type?g.type=x.iinf.item_infos[u].item_type:g.type="mime",g.content_type=x.iinf.item_infos[u].content_type,g.content_encoding=x.iinf.item_infos[u].content_encoding;if(x.grpl)for(u=0;u<x.grpl.boxes.length;u++)entity_group={},entity_group.id=x.grpl.boxes[u].group_id,entity_group.entity_ids=x.grpl.boxes[u].entity_ids,entity_group.type=x.grpl.boxes[u].type,a[entity_group.id]=entity_group;if(x.iloc)for(u=0;u<x.iloc.items.length;u++){var S=x.iloc.items[u];switch(g=r[S.item_ID],S.data_reference_index!==0&&(t.warn("Item storage with reference to other files: not supported"),g.source=x.dinf.boxes[S.data_reference_index-1]),S.construction_method){case 0:break;case 1:t.warn("Item storage with construction_method : not supported");break;case 2:t.warn("Item storage with construction_method : not supported");break}for(g.extents=[],g.size=0,f=0;f<S.extents.length;f++)g.extents[f]={},g.extents[f].offset=S.extents[f].extent_offset+S.base_offset,g.extents[f].length=S.extents[f].extent_length,g.extents[f].alreadyRead=0,g.size+=g.extents[f].length}if(x.pitm&&(r[x.pitm.item_id].primary=!0),x.iref)for(u=0;u<x.iref.references.length;u++){var A=x.iref.references[u];for(f=0;f<A.references.length;f++)r[A.from_item_ID].ref_to.push({type:A.type,id:A.references[f]})}if(x.iprp)for(var C=0;C<x.iprp.ipmas.length;C++){var B=x.iprp.ipmas[C];for(u=0;u<B.associations.length;u++){var R=B.associations[u];if(g=r[R.id],g||(g=a[R.id]),g)for(g.properties===void 0&&(g.properties={},g.properties.boxes=[]),f=0;f<R.props.length;f++){var M=R.props[f];if(M.property_index>0&&M.property_index-1<x.iprp.ipco.boxes.length){var N=x.iprp.ipco.boxes[M.property_index-1];g.properties[N.type]=N,g.properties.boxes.push(N)}}}}}},b.prototype.getItem=function(r){var a,u;if(!this.meta)return null;if(u=this.items[r],!u.data&&u.size)u.data=new Uint8Array(u.size),u.alreadyRead=0,this.itemsDataSize+=u.size,t.debug("ISOFile","Allocating item #"+r+" of size "+u.size+" (total: "+this.itemsDataSize+")");else if(u.alreadyRead===u.size)return u;for(var f=0;f<u.extents.length;f++){var g=u.extents[f];if(g.alreadyRead!==g.length){var x=this.stream.findPosition(!0,g.offset+g.alreadyRead,!1);if(x>-1){a=this.stream.buffers[x];var S=a.byteLength-(g.offset+g.alreadyRead-a.fileStart);if(g.length-g.alreadyRead<=S)t.debug("ISOFile","Getting item #"+r+" extent #"+f+" data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+(g.length-g.alreadyRead)+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,g.length-g.alreadyRead),a.usedBytes+=g.length-g.alreadyRead,this.stream.logBufferLevel(),u.alreadyRead+=g.length-g.alreadyRead,g.alreadyRead=g.length;else return t.debug("ISOFile","Getting item #"+r+" extent #"+f+" partial data (alreadyRead: "+g.alreadyRead+" offset: "+(g.offset+g.alreadyRead-a.fileStart)+" read size: "+S+" full extent size: "+g.length+" full item size: "+u.size+")"),n.memcpy(u.data.buffer,u.alreadyRead,a,g.offset+g.alreadyRead-a.fileStart,S),g.alreadyRead+=S,u.alreadyRead+=S,a.usedBytes+=S,this.stream.logBufferLevel(),null}else return null}}return u.alreadyRead===u.size?u:null},b.prototype.releaseItem=function(r){var a=this.items[r];if(a.data){this.itemsDataSize-=a.size,a.data=null,a.alreadyRead=0;for(var u=0;u<a.extents.length;u++){var f=a.extents[u];f.alreadyRead=0}return a.size}else return 0},b.prototype.processItems=function(r){for(var a in this.items){var u=this.items[a];this.getItem(u.id),r&&!u.sent&&(r(u),u.sent=!0,u.data=null)}},b.prototype.hasItem=function(r){for(var a in this.items){var u=this.items[a];if(u.name===r)return u.id}return-1},b.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},b.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)},b.prototype.itemToFragmentedTrackFile=function(r){var a=r||{},u=null;if(a.itemId?u=this.getItem(a.itemId):u=this.getPrimaryItem(),u==null)return null;var f=new b;f.discardMdatData=!1;var g={type:u.type,description_boxes:u.properties.boxes};u.properties.ispe&&(g.width=u.properties.ispe.image_width,g.height=u.properties.ispe.image_height);var x=f.addTrack(g);return x?(f.addSample(x,u.data),f):null},b.prototype.write=function(r){for(var a=0;a<this.boxes.length;a++)this.boxes[a].write(r)},b.prototype.createFragment=function(r,a,u){var f=this.getTrackById(r),g=this.getSample(f,a);if(g==null)return this.setNextSeekPositionFromSample(f.samples[a]),null;var x=u||new n;x.endianness=n.BIG_ENDIAN;var S=this.createSingleSampleMoof(g);S.write(x),S.trafs[0].truns[0].data_offset=S.size+8,t.debug("MP4Box","Adjusting data_offset with new value "+S.trafs[0].truns[0].data_offset),x.adjustUint32(S.trafs[0].truns[0].data_offset_position,S.trafs[0].truns[0].data_offset);var A=new l.mdatBox;return A.data=g.data,A.write(x),x},b.writeInitializationSegment=function(r,a,u,f){var g;t.debug("ISOFile","Generating initialization segment");var x=new n;x.endianness=n.BIG_ENDIAN,r.write(x);var S=a.add("mvex");for(u&&S.add("mehd").set("fragment_duration",u),g=0;g<a.traks.length;g++)S.add("trex").set("track_id",a.traks[g].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",f).set("default_sample_size",0).set("default_sample_flags",65536);return a.write(x),x.buffer},b.prototype.save=function(r){var a=new n;a.endianness=n.BIG_ENDIAN,this.write(a),a.save(r)},b.prototype.getBuffer=function(){var r=new n;return r.endianness=n.BIG_ENDIAN,this.write(r),r.buffer},b.prototype.initializeSegmentation=function(){var r,a,u,f;for(this.onSegment===null&&t.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),a=[],r=0;r<this.fragmentedTracks.length;r++){var g=new l.moovBox;g.mvhd=this.moov.mvhd,g.boxes.push(g.mvhd),u=this.getTrackById(this.fragmentedTracks[r].id),g.boxes.push(u),g.traks.push(u),f={},f.id=u.tkhd.track_id,f.user=this.fragmentedTracks[r].user,f.buffer=b.writeInitializationSegment(this.ftyp,g,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[r].samples.length>0?this.moov.traks[r].samples[0].duration:0),a.push(f)}return a},l.Box.prototype.printHeader=function(r){this.size+=8,this.size>o&&(this.size+=8),this.type==="uuid"&&(this.size+=16),r.log(r.indent+"size:"+this.size),r.log(r.indent+"type:"+this.type)},l.FullBox.prototype.printHeader=function(r){this.size+=4,l.Box.prototype.printHeader.call(this,r),r.log(r.indent+"version:"+this.version),r.log(r.indent+"flags:"+this.flags)},l.Box.prototype.print=function(r){this.printHeader(r)},l.ContainerBox.prototype.print=function(r){this.printHeader(r);for(var a=0;a<this.boxes.length;a++)if(this.boxes[a]){var u=r.indent;r.indent+=" ",this.boxes[a].print(r),r.indent=u}},b.prototype.print=function(r){r.indent="";for(var a=0;a<this.boxes.length;a++)this.boxes[a]&&this.boxes[a].print(r)},l.mvhdBox.prototype.print=function(r){l.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"timescale: "+this.timescale),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"rate: "+this.rate),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"next_track_id: "+this.next_track_id)},l.tkhdBox.prototype.print=function(r){l.FullBox.prototype.printHeader.call(this,r),r.log(r.indent+"creation_time: "+this.creation_time),r.log(r.indent+"modification_time: "+this.modification_time),r.log(r.indent+"track_id: "+this.track_id),r.log(r.indent+"duration: "+this.duration),r.log(r.indent+"volume: "+(this.volume>>8)),r.log(r.indent+"matrix: "+this.matrix.join(", ")),r.log(r.indent+"layer: "+this.layer),r.log(r.indent+"alternate_group: "+this.alternate_group),r.log(r.indent+"width: "+this.width),r.log(r.indent+"height: "+this.height)};var T={};T.createFile=function(r,a){var u=r!==void 0?r:!0,f=new b(a);return f.discardMdatData=!u,f},s.createFile=T.createFile})(q0);const uo=Cc(q0);var aI=Object.defineProperty,K0=s=>{throw TypeError(s)},oI=(s,t,e)=>t in s?aI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,df=(s,t,e)=>oI(s,typeof t!="symbol"?t+"":t,e),lI=(s,t,e)=>t.has(s)||K0("Cannot "+e),Ta=(s,t,e)=>(lI(s,t,"read from private field"),e?e.call(s):t.get(s)),hI=(s,t,e)=>t.has(s)?K0("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),Xn;let ea=class{constructor(){hI(this,Xn,new Map),df(this,"on",(t,e)=>{const n=Ta(this,Xn).get(t)??new Set;return n.add(e),Ta(this,Xn).has(t)||Ta(this,Xn).set(t,n),()=>{n.delete(e),n.size===0&&Ta(this,Xn).delete(t)}}),df(this,"once",(t,e)=>{const n=this.on(t,(...o)=>{n(),e(...o)});return n}),df(this,"emit",(t,...e)=>{const n=Ta(this,Xn).get(t);n!=null&&n.forEach(o=>o(...e))})}static forwardEvent(t,e,n){const o=n.map(h=>{const[d,l]=Array.isArray(h)?h:[h,h];return t.on(d,(..._)=>{e.emit(l,..._)})});return()=>{o.forEach(h=>h())}}destroy(){Ta(this,Xn).clear()}};Xn=new WeakMap;const uI=()=>{let s,t=16.6;self.onmessage=e=>{e.data.event==="start"&&(self.clearInterval(s),s=self.setInterval(()=>{self.postMessage({})},t)),e.data.event==="stop"&&self.clearInterval(s)}},cI=()=>{const s=new Blob([`(${uI.toString()})()`]),t=URL.createObjectURL(s);return new Worker(t)},Ba=new Map;let _p=1,ro=null;globalThis.Worker!=null&&(ro=cI(),ro.onmessage=()=>{_p+=1;for(const[s,t]of Ba)if(_p%s===0)for(const e of t)e()});const R_=(s,t)=>{const e=Math.round(t/16.6),n=Ba.get(e)??new Set;return n.add(s),Ba.set(e,n),Ba.size===1&&n.size===1&&(ro==null||ro.postMessage({event:"start"})),()=>{n.delete(s),n.size===0&&Ba.delete(e),Ba.size===0&&(_p=0,ro==null||ro.postMessage({event:"stop"}))}};function dI(s,t){let e=!1;async function n(){const o=s.getReader();for(;!e;){const{value:h,done:d}=await o.read();if(d){t.onDone();return}await t.onChunk(h)}o.releaseLock(),await s.cancel()}return n().catch(console.error),()=>{e=!0}}function fI(s,t,e){let n=0,o=0;const h=s.boxes;let d=!1;const l=()=>{var w;if(!d)if(h.find(r=>r.type==="moof")!=null)d=!0;else return null;if(o>=h.length)return null;const b=new uo.DataStream;b.endianness=uo.DataStream.BIG_ENDIAN;let T=o;try{for(;T<h.length;)h[T].write(b),delete h[T],T+=1}catch(r){const a=h[T];throw r instanceof Error&&a!=null?Error(`${r.message} | deltaBuf( boxType: ${a.type}, boxSize: ${a.size}, boxDataLen: ${((w=a.data)==null?void 0:w.length)??-1})`):r}return pI(s),o=h.length,new Uint8Array(b.buffer)};let _=!1,m=!1,v=null;return{stream:new ReadableStream({start(w){n=self.setInterval(()=>{const b=l();b!=null&&!m&&w.enqueue(b)},t),v=b=>{if(clearInterval(n),s.flush(),b!=null){w.error(b);return}const T=l();T!=null&&!m&&w.enqueue(T),m||w.close()},_&&v()},cancel(){m=!0,clearInterval(n),e==null||e()}}),stop:w=>{_||(_=!0,v==null||v(w))}}}function pI(s){if(s.moov!=null){for(var t=0;t<s.moov.traks.length;t++)s.moov.traks[t].samples=[];s.mdats=[],s.moofs=[]}}const B_=(s,t)=>{const e=new Uint8Array(8);new DataView(e.buffer).setUint32(0,t);for(let n=0;n<4;n++)e[4+n]=s.charCodeAt(n);return e},_I=()=>{const s=new TextEncoder,t=s.encode("mdta"),e=s.encode("mp4 handler"),n=32+e.byteLength+1,o=new Uint8Array(n),h=new DataView(o.buffer);return o.set(B_("hdlr",n),0),h.setUint32(8,0),o.set(t,16),o.set(e,32),o},gI=s=>{const t=new TextEncoder,e=t.encode("mdta"),n=s.map(_=>{const m=t.encode(_),v=8+m.byteLength,w=new Uint8Array(v);return new DataView(w.buffer).setUint32(0,v),w.set(e,4),w.set(m,4+e.byteLength),w}),o=16+n.reduce((_,m)=>_+m.byteLength,0),h=new Uint8Array(o),d=new DataView(h.buffer);h.set(B_("keys",o),0),d.setUint32(8,0),d.setUint32(12,s.length);let l=16;for(const _ of n)h.set(_,l),l+=_.byteLength;return h},mI=s=>{const t=new TextEncoder,e=t.encode("data"),n=Object.entries(s).map(([l,_],m)=>{const v=m+1,w=t.encode(_),b=24+w.byteLength,T=new Uint8Array(b),r=new DataView(T.buffer);return r.setUint32(0,b),r.setUint32(4,v),r.setUint32(8,16+w.byteLength),T.set(e,12),r.setUint32(16,1),T.set(w,24),T}),o=8+n.reduce((l,_)=>l+_.byteLength,0),h=new Uint8Array(o);h.set(B_("ilst",o),0);let d=8;for(const l of n)h.set(l,d),d+=l.byteLength;return h},yI=s=>{const t=_I(),e=gI(Object.keys(s)),n=mI(s),o=t.length+e.length+n.length,h=new Uint8Array(o);return h.set(t,0),h.set(e,t.length),h.set(n,t.length+e.length),h};function vI(s){return s instanceof Error?String(s):typeof s=="object"?JSON.stringify(s,(t,e)=>e instanceof Error?String(e):e):String(s)}function xI(){const s=new Date;return`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}.${s.getMilliseconds()}`}let Z0=1;const J0=[],Dy=["debug","info","warn","error"].reduce((s,t,e)=>Object.assign(s,{[t]:(...n)=>{Z0<=e&&(console[t](...n),J0.push({lvName:t,timeStr:xI(),args:n}))}}),{}),zl=new Map,Zt={setLogLevel:s=>{Z0=zl.get(s)??1},...Dy,create:s=>Object.fromEntries(Object.entries(Dy).map(([t,e])=>[t,(...n)=>e(s,...n)])),async dump(){return J0.reduce((s,{lvName:t,timeStr:e,args:n})=>s+`[${t}][${e}]  ${n.map(o=>vI(o)).join(" ")}
`,"")}};zl.set(Zt.debug,0);zl.set(Zt.info,1);zl.set(Zt.warn,2);zl.set(Zt.error,3);(async function(){await Promise.resolve(),!(globalThis.navigator==null||globalThis.document==null)&&(Zt.info(`@webav version: 1.0.11, date: ${new Date().toLocaleDateString()}`),Zt.info(globalThis.navigator.userAgent),document.addEventListener("visibilitychange",()=>{Zt.info(`visibilitychange: ${document.visibilityState}`)}),"PressureObserver"in globalThis&&new PressureObserver(s=>{Zt.info(`cpu state change: ${JSON.stringify(s.map(t=>t.state))}`)}).observe("cpu"))})();function bI(s){Zt.info("recodemux opts:",s);const t=uo.createFile(),e=new ea,n=(_,m)=>{const v=_.add("udta").add("meta");v.data=yI(m),v.size=v.data.byteLength};let o=!1;const h=()=>{t.moov==null||o||(o=!0,s.metaDataTags!=null&&n(t.moov,s.metaDataTags),s.duration!=null&&(t.moov.mvhd.duration=s.duration))};e.once("VideoReady",h),e.once("AudioReady",h);let d=s.video!=null?wI(s.video,t,e):null,l=s.audio!=null?EI(s.audio,t,e):null;return s.video==null&&e.emit("VideoReady"),s.audio==null&&e.emit("AudioReady"),{encodeVideo:(_,m)=>{d==null||d.encode(_,m),_.close()},encodeAudio:_=>{if(l!=null)try{l.encode(_),_.close()}catch(m){const v=`encode audio chunk error: ${m.message}, state: ${JSON.stringify({qSize:l.encodeQueueSize,state:l.state})}`;throw Zt.error(v),Error(v)}},getEncodeQueueSize:()=>(d==null?void 0:d.encodeQueueSize)??(l==null?void 0:l.encodeQueueSize)??0,flush:async()=>{await Promise.all([d==null?void 0:d.flush(),(l==null?void 0:l.state)==="configured"?l.flush():null])},close:()=>{e.destroy(),d==null||d.close(),(l==null?void 0:l.state)==="configured"&&l.close()},mp4file:t}}function wI(s,t,e){const n={timescale:1e6,width:s.width,height:s.height,brands:["isom","iso2","avc1","mp42","mp41"],avcDecoderConfigRecord:null,name:"Track created with WebAV"};let o=-1,h=!1;e.once("AudioReady",()=>{h=!0});const d={encoder0:[],encoder1:[]},l=(f,g,x)=>{var S;if(o===-1&&x!=null){const A=(S=x.decoderConfig)==null?void 0:S.description;SI(A),n.avcDecoderConfigRecord=A,o=t.addTrack(n),e.emit("VideoReady"),Zt.info("VideoEncoder, video track ready, trackId:",o)}d[f].push(gp(g))};let _="encoder1",m=0;const v=Math.floor(1e3/s.expectFPS*1e3);function w(){if(!h)return;const f=_==="encoder1"?"encoder0":"encoder1",g=d[_],x=d[f];if(g.length===0&&x.length===0)return;let S=g[0];if(S!=null&&(!S.is_sync||S.cts-m<v)){const C=b(g);C>m&&(m=C)}const A=x[0];if(A!=null&&A.is_sync&&A.cts-m<v){_=f,w();return}if(S!=null&&S.is_sync&&A!=null&&A.is_sync)if(S.cts<=A.cts){const C=b(g);C>m&&(m=C)}else{_=f,w();return}}function b(f){let g=-1,x=0;for(;x<f.length;x++){const S=f[x];if(x>0&&S.is_sync)break;t.addSample(o,S.data,S),g=S.cts+S.duration}return f.splice(0,x),g}const T=R_(w,15),r=ky(s,(f,g)=>l("encoder0",f,g)),a=ky(s,(f,g)=>l("encoder1",f,g));let u=0;return{get encodeQueueSize(){return r.encodeQueueSize+a.encodeQueueSize},encode:(f,g)=>{try{g.keyFrame&&(u+=1),(u%2===0?r:a).encode(f,g)}catch(x){const S=`encode video frame error: ${x.message}, state: ${JSON.stringify({ts:f.timestamp,keyFrame:g.keyFrame,duration:f.duration,gopId:u})}`;throw Zt.error(S),Error(S)}},flush:async()=>{await Promise.all([r.state==="configured"?await r.flush():null,a.state==="configured"?await a.flush():null]),T(),w()},close:()=>{r.state==="configured"&&r.close(),a.state==="configured"&&a.close()}}}function SI(s){const t=new Uint8Array(s);t[2].toString(2).slice(-2).includes("1")&&(t[2]=0)}function ky(s,t){const e={codec:s.codec,framerate:s.expectFPS,hardwareAcceleration:s.__unsafe_hardwareAcceleration__,bitrate:s.bitrate,width:s.width,height:s.height,alpha:"discard",avc:{format:"avc"}},n=new VideoEncoder({error:o=>{const h=`VideoEncoder error: ${o.message}, config: ${JSON.stringify(e)}, state: ${JSON.stringify({qSize:n.encodeQueueSize,state:n.state})}`;throw Zt.error(h),Error(h)},output:t});return n.configure(e),n}function EI(s,t,e){const n={timescale:1e6,samplerate:s.sampleRate,channel_count:s.channelCount,hdlr:"soun",type:s.codec==="aac"?"mp4a":"Opus",name:"Track created with WebAV"};let o=-1,h=[],d=!1;e.once("VideoReady",()=>{d=!0,h.forEach(m=>{const v=gp(m);t.addSample(o,v.data,v)}),h=[]});const l={codec:s.codec==="aac"?"mp4a.40.2":"opus",sampleRate:s.sampleRate,numberOfChannels:s.channelCount,bitrate:128e3},_=new AudioEncoder({error:m=>{const v=`AudioEncoder error: ${m.message}, config: ${JSON.stringify(l)}, state: ${JSON.stringify({qSize:_.encodeQueueSize,state:_.state})}`;throw Zt.error(v),Error(v)},output:(m,v)=>{var w;if(o===-1){const b=(w=v.decoderConfig)==null?void 0:w.description;o=t.addTrack({...n,description:b==null?void 0:TI(b)}),e.emit("AudioReady"),Zt.info("AudioEncoder, audio track ready, trackId:",o)}if(d){const b=gp(m);t.addSample(o,b.data,b)}else h.push(m)}});return _.configure(l),_}function TI(s){const t=s.byteLength,e=new Uint8Array([0,0,0,0,3,23+t,0,2,0,4,18+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5,t,...new Uint8Array(s instanceof ArrayBuffer?s:s.buffer),6,1,2]),n=new uo.BoxParser.esdsBox(e.byteLength);return n.hdr_size=0,n.parse(new uo.DataStream(e,0,uo.DataStream.BIG_ENDIAN)),n}function gp(s){const t=new ArrayBuffer(s.byteLength);s.copyTo(t);const e=s.timestamp;return{duration:s.duration??0,dts:e,cts:e,is_sync:s.type==="key",data:t}}class AI{constructor(t,e,n){this.length_=t,this.scaleFactor_=(t-1)/e,this.interpolate=this.cubic,n.method==="point"?this.interpolate=this.point:n.method==="linear"?this.interpolate=this.linear:n.method==="sinc"&&(this.interpolate=this.sinc),this.tangentFactor_=1-Math.max(0,Math.min(1,n.tension||0)),this.sincFilterSize_=n.sincFilterSize||1,this.kernel_=UI(n.sincWindow||CI)}point(t,e){return this.getClippedInput_(Math.round(this.scaleFactor_*t),e)}linear(t,e){t=this.scaleFactor_*t;let n=Math.floor(t);return t-=n,(1-t)*this.getClippedInput_(n,e)+t*this.getClippedInput_(n+1,e)}cubic(t,e){t=this.scaleFactor_*t;let n=Math.floor(t),o=[this.getTangent_(n,e),this.getTangent_(n+1,e)],h=[this.getClippedInput_(n,e),this.getClippedInput_(n+1,e)];t-=n;let d=t*t,l=t*d;return(2*l-3*d+1)*h[0]+(l-2*d+t)*o[0]+(-2*l+3*d)*h[1]+(l-d)*o[1]}sinc(t,e){t=this.scaleFactor_*t;let n=Math.floor(t),o=n-this.sincFilterSize_+1,h=n+this.sincFilterSize_,d=0;for(let l=o;l<=h;l++)d+=this.kernel_(t-l)*this.getClippedInput_(l,e);return d}getTangent_(t,e){return this.tangentFactor_*(this.getClippedInput_(t+1,e)-this.getClippedInput_(t-1,e))/2}getClippedInput_(t,e){return 0<=t&&t<this.length_?e[t]:0}}function CI(s){return Math.exp(-s/2*s/2)}function UI(s){return function(t){return II(t)*s(t)}}function II(s){return s===0?1:Math.sin(Math.PI*s)/(Math.PI*s)}class PI{constructor(t,e,n){let o=2*Math.PI*n/e,h=0;this.filters=[];for(let d=0;d<=t;d++)d-t/2===0?this.filters[d]=o:(this.filters[d]=Math.sin(o*(d-t/2))/(d-t/2),this.filters[d]*=.54-.46*Math.cos(2*Math.PI*d/t)),h=h+this.filters[d];for(let d=0;d<=t;d++)this.filters[d]/=h;this.z=this.initZ_()}filter(t){this.z.buf[this.z.pointer]=t;let e=0;for(let n=0,o=this.z.buf.length;n<o;n++)e+=this.filters[n]*this.z.buf[(this.z.pointer+n)%this.z.buf.length];return this.z.pointer=(this.z.pointer+1)%this.z.buf.length,e}reset(){this.z=this.initZ_()}initZ_(){let t=[];for(let e=0;e<this.filters.length-1;e++)t.push(0);return{buf:t,pointer:0}}}class RI{constructor(t,e,n){let o=[];for(let h=0;h<t;h++)o.push(this.getCoeffs_({Fs:e,Fc:n,Q:.5/Math.sin(Math.PI/(t*2)*(h+.5))}));this.stages=[];for(let h=0;h<o.length;h++)this.stages[h]={b0:o[h].b[0],b1:o[h].b[1],b2:o[h].b[2],a1:o[h].a[0],a2:o[h].a[1],k:o[h].k,z:[0,0]}}filter(t){let e=t;for(let n=0,o=this.stages.length;n<o;n++)e=this.runStage_(n,e);return e}getCoeffs_(t){let e={};e.z=[0,0],e.a=[],e.b=[];let n=this.preCalc_(t,e);return e.k=1,e.b.push((1-n.cw)/(2*n.a0)),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e}preCalc_(t,e){let n={},o=2*Math.PI*t.Fc/t.Fs;return n.alpha=Math.sin(o)/(2*t.Q),n.cw=Math.cos(o),n.a0=1+n.alpha,e.a0=n.a0,e.a.push(-2*n.cw/n.a0),e.k=1,e.a.push((1-n.alpha)/n.a0),n}runStage_(t,e){let n=e*this.stages[t].k-this.stages[t].a1*this.stages[t].z[0]-this.stages[t].a2*this.stages[t].z[1],o=this.stages[t].b0*n+this.stages[t].b1*this.stages[t].z[0]+this.stages[t].b2*this.stages[t].z[1];return this.stages[t].z[1]=this.stages[t].z[0],this.stages[t].z[0]=n,o}reset(){for(let t=0;t<this.stages.length;t++)this.stages[t].z=[0,0]}}const BI={point:!1,linear:!1,cubic:!0,sinc:!0},Oy={IIR:16,FIR:71},FI={IIR:RI,FIR:PI};function MI(s,t,e,n={}){let o=(e-t)/t+1,h=new Float64Array(s.length*o);n.method=n.method||"cubic";let d=new AI(s.length,h.length,{method:n.method,tension:n.tension||0,sincFilterSize:n.sincFilterSize||6,sincWindow:n.sincWindow||void 0});if(n.LPF===void 0&&(n.LPF=BI[n.method]),n.LPF){n.LPFType=n.LPFType||"IIR";const l=FI[n.LPFType];if(e>t){let _=new l(n.LPFOrder||Oy[n.LPFType],e,t/2);LI(s,h,d,_)}else{let _=new l(n.LPFOrder||Oy[n.LPFType],t,e/2);DI(s,h,d,_)}}else Q0(s,h,d);return h}function Q0(s,t,e){for(let n=0,o=t.length;n<o;n++)t[n]=e.interpolate(n,s)}function LI(s,t,e,n){for(let o=0,h=t.length;o<h;o++)t[o]=n.filter(e.interpolate(o,s));n.reset();for(let o=t.length-1;o>=0;o--)t[o]=n.filter(t[o])}function DI(s,t,e,n){for(let o=0,h=s.length;o<h;o++)s[o]=n.filter(s[o]);n.reset();for(let o=s.length-1;o>=0;o--)s[o]=n.filter(s[o]);Q0(s,t,e)}var kI=Object.defineProperty,tx=s=>{throw TypeError(s)},OI=(s,t,e)=>t in s?kI(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Le=(s,t,e)=>OI(s,typeof t!="symbol"?t+"":t,e),F_=(s,t,e)=>t.has(s)||tx("Cannot "+e),F=(s,t,e)=>(F_(s,t,"read from private field"),e?e.call(s):t.get(s)),_t=(s,t,e)=>t.has(s)?tx("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),ct=(s,t,e,n)=>(F_(s,t,"write to private field"),t.set(s,e),e),wr=(s,t,e)=>(F_(s,t,"access private method"),e);function NI(s){if(s.format==="f32-planar"){const t=[];for(let e=0;e<s.numberOfChannels;e+=1){const n=s.allocationSize({planeIndex:e}),o=new ArrayBuffer(n);s.copyTo(o,{planeIndex:e}),t.push(new Float32Array(o))}return t}else if(s.format==="f32"){const t=new ArrayBuffer(s.allocationSize({planeIndex:0}));return s.copyTo(t,{planeIndex:0}),GI(new Float32Array(t),s.numberOfChannels)}else if(s.format==="s16"){const t=new ArrayBuffer(s.allocationSize({planeIndex:0}));return s.copyTo(t,{planeIndex:0}),zI(new Int16Array(t),s.numberOfChannels)}throw Error("Unsupported audio data format")}function zI(s,t){const e=s.length/t,n=Array.from({length:t},()=>new Float32Array(e));for(let o=0;o<e;o++)for(let h=0;h<t;h++){const d=s[o*t+h];n[h][o]=d/32768}return n}function GI(s,t){const e=s.length/t,n=Array.from({length:t},()=>new Float32Array(e));for(let o=0;o<e;o++)for(let h=0;h<t;h++)n[h][o]=s[o*t+h];return n}function ex(s){return Array(s.numberOfChannels).fill(0).map((t,e)=>s.getChannelData(e))}async function HI(s,t){var e;const n={type:t,data:s},o=new ImageDecoder(n);await Promise.all([o.completed,o.tracks.ready]);let h=((e=o.tracks.selectedTrack)==null?void 0:e.frameCount)??1;const d=[];for(let l=0;l<h;l+=1)d.push((await o.decode({frameIndex:l})).image);return d}async function $I(s,t,e){const n=s.length,o=Array(e.chanCount).fill(0).map(()=>new Float32Array(0));if(n===0)return o;const h=Math.max(...s.map(m=>m.length));if(h===0)return o;if(globalThis.OfflineAudioContext==null)return s.map(m=>new Float32Array(MI(m,t,e.rate,{method:"sinc",LPF:!1})));const d=new globalThis.OfflineAudioContext(e.chanCount,h*e.rate/t,e.rate),l=d.createBufferSource(),_=d.createBuffer(n,h,t);return s.forEach((m,v)=>_.copyToChannel(m,v)),l.buffer=_,l.connect(d.destination),l.start(),ex(await d.startRendering())}function M_(s){return new Promise(t=>{const e=R_(()=>{e(),t()},s)})}function Ny(s,t,e){const n=e-t,o=new Float32Array(n);let h=0;for(;h<n;)o[h]=s[(t+h)%s.length],h+=1;return o}function ix(s,t){const e=Math.floor(s.length/t),n=new Float32Array(e);for(let o=0;o<e;o++){const h=o*t,d=Math.floor(h),l=h-d;d+1<s.length?n[o]=s[d]*(1-l)+s[d+1]*l:n[o]=s[d]}return n}const Ie={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2"};function VI(s,t){const e=t.videoTracks[0],n={};if(e!=null){const h=WI(s.getTrackById(e.id)).buffer,{descKey:d,type:l}=e.codec.startsWith("avc1")?{descKey:"avcDecoderConfigRecord",type:"avc1"}:e.codec.startsWith("hvc1")?{descKey:"hevcDecoderConfigRecord",type:"hvc1"}:{descKey:"",type:""};d!==""&&(n.videoTrackConf={timescale:e.timescale,duration:e.duration,width:e.video.width,height:e.video.height,brands:t.brands,type:l,[d]:h}),n.videoDecoderConf={codec:e.codec,codedHeight:e.video.height,codedWidth:e.video.width,description:h}}const o=t.audioTracks[0];if(o!=null){const h=zy(s);n.audioTrackConf={timescale:o.timescale,samplerate:o.audio.sample_rate,channel_count:o.audio.channel_count,hdlr:"soun",type:o.codec.startsWith("mp4a")?"mp4a":o.codec,description:zy(s)},n.audioDecoderConf={codec:o.codec.startsWith("mp4a")?Ie.codec:o.codec,numberOfChannels:o.audio.channel_count,sampleRate:o.audio.sample_rate,...h==null?{}:XI(h)}}return n}function WI(s){for(const t of s.mdia.minf.stbl.stsd.entries){const e=t.avcC??t.hvcC??t.av1C??t.vpcC;if(e!=null){const n=new pp.DataStream(void 0,0,pp.DataStream.BIG_ENDIAN);return e.write(n),new Uint8Array(n.buffer.slice(8))}}throw Error("avcC, hvcC, av1C or VPX not found")}function zy(s,t="mp4a"){var e;const n=(e=s.moov)==null?void 0:e.traks.map(o=>o.mdia.minf.stbl.stsd.entries).flat().find(({type:o})=>o===t);return n==null?void 0:n.esds}function XI(s){var t;const e=(t=s.esd.descs[0])==null?void 0:t.descs[0];if(e==null)return{};const[n,o]=e.data,h=((n&7)<<1)+(o>>7),d=(o&127)>>3;return{sampleRate:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][h],numberOfChannels:d}}async function YI(s,t,e){const n=pp.createFile(!1);n.onReady=h=>{var d,l;t({mp4boxFile:n,info:h});const _=(d=h.videoTracks[0])==null?void 0:d.id;_!=null&&n.setExtractionOptions(_,"video",{nbSamples:100});const m=(l=h.audioTracks[0])==null?void 0:l.id;m!=null&&n.setExtractionOptions(m,"audio",{nbSamples:100}),n.start()},n.onSamples=e,await o();async function o(){let h=0;const d=30*1024*1024;for(;;){const l=await s.read(d,{at:h});if(l.byteLength===0)break;l.fileStart=h;const _=n.appendBuffer(l);if(_==null)break;h=_}n.stop()}}let L_=0;function ff(s){return s.kind==="file"&&s.createReader instanceof Function}var mp,uu,cu,Dr,Oi,du,kr,Cs,ll,Fa,_n,Ni,hl;const jI=class Ma{constructor(t,e={}){if(_t(this,mp,L_++),_t(this,uu,Zt.create(`MP4Clip id:${F(this,mp)},`)),Le(this,"ready"),_t(this,cu,!1),_t(this,Dr,{duration:0,width:0,height:0,audioSampleRate:0,audioChanCount:0}),_t(this,Oi),_t(this,du,1),_t(this,kr,[]),_t(this,Cs,[]),_t(this,ll,null),_t(this,Fa,null),_t(this,_n,{video:null,audio:null}),_t(this,Ni,{audio:!0}),Le(this,"tickInterceptor",async(o,h)=>h),_t(this,hl,new AbortController),!(t instanceof ReadableStream)&&!ff(t)&&!Array.isArray(t.videoSamples))throw Error("Illegal argument");ct(this,Ni,{audio:!0,...e}),ct(this,du,typeof e.audio=="object"&&"volume"in e.audio?e.audio.volume:1);const n=async o=>(await P_(F(this,Oi),o),F(this,Oi));ct(this,Oi,ff(t)?t:"localFile"in t?t.localFile:iI()),this.ready=(t instanceof ReadableStream?n(t).then(o=>Gy(o,F(this,Ni))):ff(t)?Gy(t,F(this,Ni)):Promise.resolve(t)).then(async({videoSamples:o,audioSamples:h,decoderConf:d})=>{ct(this,kr,o),ct(this,Cs,h),ct(this,_n,d);const{videoFrameFinder:l,audioFrameFinder:_}=KI({video:d.video==null?null:{...d.video,hardwareAcceleration:F(this,Ni).__unsafe_hardwareAcceleration__},audio:d.audio},await F(this,Oi).createReader(),o,h,F(this,Ni).audio!==!1?F(this,du):0);return ct(this,ll,l),ct(this,Fa,_),ct(this,Dr,qI(d,o,h)),F(this,uu).info("MP4Clip meta:",F(this,Dr)),{...F(this,Dr)}})}get meta(){return{...F(this,Dr)}}async tick(t){var e,n,o;if(t>=F(this,Dr).duration)return await this.tickInterceptor(t,{audio:await((e=F(this,Fa))==null?void 0:e.find(t))??[],state:"done"});const[h,d]=await Promise.all([((n=F(this,Fa))==null?void 0:n.find(t))??[],(o=F(this,ll))==null?void 0:o.find(t)]);return d==null?await this.tickInterceptor(t,{audio:h,state:"success"}):await this.tickInterceptor(t,{video:d,audio:h,state:"success"})}async thumbnails(t=100,e){F(this,hl).abort(),ct(this,hl,new AbortController);const n=F(this,hl).signal;await this.ready;const o="generate thumbnails aborted";if(n.aborted)throw Error(o);const{width:h,height:d}=F(this,Dr),l=e2(t,Math.round(d*(t/h)),{quality:.1,type:"image/png"});return new Promise(async(_,m)=>{let v=[];const w=F(this,_n).video;if(w==null||F(this,kr).length===0){b();return}n.addEventListener("abort",()=>{m(Error(o))});async function b(){n.aborted||_(await Promise.all(v.map(async f=>({ts:f.ts,img:await f.img}))))}function T(f){v.push({ts:f.timestamp,img:l(f)})}const{start:r=0,end:a=F(this,Dr).duration,step:u}=e??{};if(u){let f=r;const g=new rx(await F(this,Oi).createReader(),F(this,kr),{...w,hardwareAcceleration:F(this,Ni).__unsafe_hardwareAcceleration__});for(;f<=a&&!n.aborted;){const x=await g.find(f);x&&T(x),f+=u}g.destroy(),b()}else await a2(F(this,kr),F(this,Oi),w,n,{start:r,end:a},(f,g)=>{f!=null&&T(f),g&&b()})})}async split(t){if(await this.ready,t<=0||t>=F(this,Dr).duration)throw Error('"time" out of bounds');const[e,n]=i2(F(this,kr),t),[o,h]=r2(F(this,Cs),t),d=new Ma({localFile:F(this,Oi),videoSamples:e??[],audioSamples:o??[],decoderConf:F(this,_n)},F(this,Ni)),l=new Ma({localFile:F(this,Oi),videoSamples:n??[],audioSamples:h??[],decoderConf:F(this,_n)},F(this,Ni));return await Promise.all([d.ready,l.ready]),[d,l]}async clone(){await this.ready;const t=new Ma({localFile:F(this,Oi),videoSamples:[...F(this,kr)],audioSamples:[...F(this,Cs)],decoderConf:F(this,_n)},F(this,Ni));return await t.ready,t.tickInterceptor=this.tickInterceptor,t}async splitTrack(){await this.ready;const t=[];if(F(this,kr).length>0){const e=new Ma({localFile:F(this,Oi),videoSamples:[...F(this,kr)],audioSamples:[],decoderConf:{video:F(this,_n).video,audio:null}},F(this,Ni));await e.ready,e.tickInterceptor=this.tickInterceptor,t.push(e)}if(F(this,Cs).length>0){const e=new Ma({localFile:F(this,Oi),videoSamples:[],audioSamples:[...F(this,Cs)],decoderConf:{audio:F(this,_n).audio,video:null}},F(this,Ni));await e.ready,e.tickInterceptor=this.tickInterceptor,t.push(e)}return t}destroy(){var t,e;F(this,cu)||(F(this,uu).info("MP4Clip destroy"),ct(this,cu,!0),(t=F(this,ll))==null||t.destroy(),(e=F(this,Fa))==null||e.destroy())}};mp=new WeakMap,uu=new WeakMap,cu=new WeakMap,Dr=new WeakMap,Oi=new WeakMap,du=new WeakMap,kr=new WeakMap,Cs=new WeakMap,ll=new WeakMap,Fa=new WeakMap,_n=new WeakMap,Ni=new WeakMap,hl=new WeakMap;let D_=jI;function qI(s,t,e){const n={duration:0,width:0,height:0,audioSampleRate:0,audioChanCount:0};s.video!=null&&t.length>0&&(n.width=s.video.codedWidth??0,n.height=s.video.codedHeight??0),s.audio!=null&&e.length>0&&(n.audioSampleRate=Ie.sampleRate,n.audioChanCount=Ie.channelCount);let o=0,h=0;if(t.length>0)for(let d=t.length-1;d>=0;d--){const l=t[d];if(!l.deleted){o=l.cts+l.duration;break}}if(e.length>0){const d=e.at(-1);h=d.cts+d.duration}return n.duration=Math.max(o,h),n}function KI(s,t,e,n,o){return{audioFrameFinder:o===0||s.audio==null||n.length===0?null:new JI(t,n,s.audio,{volume:o,targetSampleRate:Ie.sampleRate}),videoFrameFinder:s.video==null||e.length===0?null:new rx(t,e,s.video)}}async function Gy(s,t={}){let e=null;const n={video:null,audio:null};let o=[],h=[],d=-1,l=-1;const _=await s.createReader();await YI(_,w=>{e=w.info;let{videoDecoderConf:b,audioDecoderConf:T}=VI(w.mp4boxFile,w.info);n.video=b??null,n.audio=T??null,b==null&&T==null&&Zt.error("MP4Clip no video and audio track"),Zt.info("mp4BoxFile moov ready",{...w.info,tracks:null,videoTracks:null,audioTracks:null},n)},(w,b,T)=>{if(b==="video"){d===-1&&(d=T[0].dts);for(const r of T)o.push(v(r,d,"video"))}else if(b==="audio"&&t.audio){l===-1&&(l=T[0].dts);for(const r of T)h.push(v(r,l,"audio"))}}),await _.close();const m=o.at(-1)??h.at(-1);if(e==null)throw Error("MP4Clip stream is done, but not emit ready");if(m==null)throw Error("MP4Clip stream not contain any sample");return bp(o),Zt.info("mp4 stream parsed"),{videoSamples:o,audioSamples:h,decoderConf:n};function v(w,b=0,T){const r=T==="video"&&w.is_sync&&s2(w.data,w.description.type);let a=w.offset,u=w.size;if(r){const f=n2(w.data,w.description.type);a+=f,u-=f}return{...w,is_idr:r,offset:a,size:u,cts:(w.cts-b)/w.timescale*1e6,dts:(w.dts-b)/w.timescale*1e6,duration:w.duration/w.timescale*1e6,timescale:1e6,data:T==="video"?null:w.data}}}var bi,La,Da,fu,ka,gn,tr,Yn,Us,Oa,ul,Is,pu,Na,_u;class rx{constructor(t,e,n){_t(this,bi,null),_t(this,La,0),_t(this,Da,{abort:!1,st:performance.now()}),Le(this,"find",async o=>{(F(this,bi)==null||F(this,bi).state==="closed"||o<=F(this,La)||o-F(this,La)>3e6)&&F(this,Na).call(this,o),F(this,Da).abort=!0,ct(this,La,o),ct(this,Da,{abort:!1,st:performance.now()});const h=await F(this,ul).call(this,o,F(this,bi),F(this,Da));return ct(this,Oa,0),h}),_t(this,fu,0),_t(this,ka,!1),_t(this,gn,0),_t(this,tr,[]),_t(this,Yn,0),_t(this,Us,0),_t(this,Oa,0),_t(this,ul,async(o,h,d)=>{if(h==null||h.state==="closed"||d.abort)return null;if(F(this,tr).length>0){const l=F(this,tr)[0];return o<l.timestamp?null:(F(this,tr).shift(),o>l.timestamp+(l.duration??0)?(l.close(),await F(this,ul).call(this,o,h,d)):(F(this,tr).length<10&&F(this,pu).call(this,h).catch(_=>{throw F(this,Na).call(this,o),_}),l))}if(F(this,Is)||F(this,Yn)<F(this,Us)&&h.decodeQueueSize>0){if(performance.now()-d.st>6e3)throw Error(`MP4Clip.tick video timeout, ${JSON.stringify(F(this,_u).call(this))}`);ct(this,Oa,F(this,Oa)+1),await M_(15)}else{if(F(this,gn)>=this.samples.length)return null;try{await F(this,pu).call(this,h)}catch(l){throw F(this,Na).call(this,o),l}}return await F(this,ul).call(this,o,h,d)}),_t(this,Is,!1),_t(this,pu,async o=>{var h,d;if(F(this,Is)||o.decodeQueueSize>600)return;let l=F(this,gn)+1;if(l>this.samples.length)return;ct(this,Is,!0);let _=!1;for(;l<this.samples.length;l++){const m=this.samples[l];if(!_&&!m.deleted&&(_=!0),m.is_idr)break}if(_){const m=this.samples.slice(F(this,gn),l);if(((h=m[0])==null?void 0:h.is_idr)!==!0)Zt.warn("First sample not idr frame");else{const v=performance.now(),w=await nx(m,this.localFileReader),b=performance.now()-v;if(b>1e3){const T=m[0],r=m.at(-1),a=r.offset+r.size-T.offset;Zt.warn(`Read video samples time cost: ${Math.round(b)}ms, file chunk size: ${a}`)}if(o.state==="closed")return;ct(this,fu,((d=w[0])==null?void 0:d.duration)??0),xp(o,w,{onDecodingError:T=>{if(F(this,ka))throw T;F(this,Yn)===0&&(ct(this,ka,!0),Zt.warn("Downgrade to software decode"),F(this,Na).call(this))}}),ct(this,Us,F(this,Us)+w.length)}}ct(this,gn,l),ct(this,Is,!1)}),_t(this,Na,o=>{var h,d;if(ct(this,Is,!1),F(this,tr).forEach(_=>_.close()),ct(this,tr,[]),o==null||o===0)ct(this,gn,0);else{let _=0;for(let m=0;m<this.samples.length;m++){const v=this.samples[m];if(v.is_idr&&(_=m),!(v.cts<o)){ct(this,gn,_);break}}}ct(this,Us,0),ct(this,Yn,0),((h=F(this,bi))==null?void 0:h.state)!=="closed"&&((d=F(this,bi))==null||d.close());const l={...this.conf,...F(this,ka)?{hardwareAcceleration:"prefer-software"}:{}};ct(this,bi,new VideoDecoder({output:_=>{if(ct(this,Yn,F(this,Yn)+1),_.timestamp===-1){_.close();return}let m=_;_.duration==null&&(m=new VideoFrame(_,{duration:F(this,fu)}),_.close()),F(this,tr).push(m)},error:_=>{if(_.message.includes("Codec reclaimed due to inactivity")){ct(this,bi,null);return}const m=`VideoFinder VideoDecoder err: ${_.message}, config: ${JSON.stringify(l)}, state: ${JSON.stringify(F(this,_u).call(this))}`;throw Zt.error(m),Error(m)}})),F(this,bi).configure(l)}),_t(this,_u,()=>{var o,h;return{time:F(this,La),decState:(o=F(this,bi))==null?void 0:o.state,decQSize:(h=F(this,bi))==null?void 0:h.decodeQueueSize,decCusorIdx:F(this,gn),sampleLen:this.samples.length,inputCnt:F(this,Us),outputCnt:F(this,Yn),cacheFrameLen:F(this,tr).length,softDeocde:F(this,ka),clipIdCnt:L_,sleepCnt:F(this,Oa),memInfo:sx()}}),Le(this,"destroy",()=>{var o,h;((o=F(this,bi))==null?void 0:o.state)!=="closed"&&((h=F(this,bi))==null||h.close()),ct(this,bi,null),F(this,Da).abort=!0,F(this,tr).forEach(d=>d.close()),ct(this,tr,[]),this.localFileReader.close()}),this.localFileReader=t,this.samples=e,this.conf=n}}bi=new WeakMap,La=new WeakMap,Da=new WeakMap,fu=new WeakMap,ka=new WeakMap,gn=new WeakMap,tr=new WeakMap,Yn=new WeakMap,Us=new WeakMap,Oa=new WeakMap,ul=new WeakMap,Is=new WeakMap,pu=new WeakMap,Na=new WeakMap,_u=new WeakMap;function ZI(s,t){for(let e=0;e<t.length;e++){const n=t[e];if(s>=n.cts&&s<n.cts+n.duration)return e;if(n.cts>s)break}return 0}var gu,mu,Or,za,mn,jn,mr,Ga,yu,vu,yp,vp;class JI{constructor(t,e,n,o){_t(this,gu,1),_t(this,mu),_t(this,Or,null),_t(this,za,{abort:!1,st:performance.now()}),Le(this,"find",async h=>{const d=h<=F(this,mn)||h-F(this,mn)>1e5;(F(this,Or)==null||F(this,Or).state==="closed"||d)&&F(this,yp).call(this),d&&(ct(this,mn,h),ct(this,jn,ZI(h,this.samples))),F(this,za).abort=!0;const l=h-F(this,mn);ct(this,mn,h),ct(this,za,{abort:!1,st:performance.now()});const _=await F(this,yu).call(this,Math.ceil(l*(F(this,mu)/1e6)),F(this,Or),F(this,za));return ct(this,Ga,0),_}),_t(this,mn,0),_t(this,jn,0),_t(this,mr,{frameCnt:0,data:[]}),_t(this,Ga,0),_t(this,yu,async(h,d=null,l)=>{if(d==null||l.abort||d.state==="closed"||h===0)return[];const _=F(this,mr).frameCnt-h;if(_>0)return _<Ie.sampleRate/10&&F(this,vu).call(this,d),Hy(F(this,mr),h);if(d.decoding){if(performance.now()-l.st>3e3)throw l.abort=!0,Error(`MP4Clip.tick audio timeout, ${JSON.stringify(F(this,vp).call(this))}`);ct(this,Ga,F(this,Ga)+1),await M_(15)}else{if(F(this,jn)>=this.samples.length-1)return Hy(F(this,mr),F(this,mr).frameCnt);F(this,vu).call(this,d)}return F(this,yu).call(this,h,d,l)}),_t(this,vu,h=>{if(h.decodeQueueSize>10)return;const d=[];let l=F(this,jn);for(;l<this.samples.length;){const _=this.samples[l];if(l+=1,!_.deleted&&(d.push(_),d.length>=10))break}ct(this,jn,l),h.decode(d.map(_=>new EncodedAudioChunk({type:"key",timestamp:_.cts,duration:_.duration,data:_.data})))}),_t(this,yp,()=>{var h;ct(this,mn,0),ct(this,jn,0),ct(this,mr,{frameCnt:0,data:[]}),(h=F(this,Or))==null||h.close(),ct(this,Or,QI(this.conf,{resampleRate:Ie.sampleRate,volume:F(this,gu)},d=>{F(this,mr).data.push(d),F(this,mr).frameCnt+=d[0].length}))}),_t(this,vp,()=>{var h,d;return{time:F(this,mn),decState:(h=F(this,Or))==null?void 0:h.state,decQSize:(d=F(this,Or))==null?void 0:d.decodeQueueSize,decCusorIdx:F(this,jn),sampleLen:this.samples.length,pcmLen:F(this,mr).frameCnt,clipIdCnt:L_,sleepCnt:F(this,Ga),memInfo:sx()}}),Le(this,"destroy",()=>{ct(this,Or,null),F(this,za).abort=!0,ct(this,mr,{frameCnt:0,data:[]}),this.localFileReader.close()}),this.localFileReader=t,this.samples=e,this.conf=n,ct(this,gu,o.volume),ct(this,mu,o.targetSampleRate)}}gu=new WeakMap,mu=new WeakMap,Or=new WeakMap,za=new WeakMap,mn=new WeakMap,jn=new WeakMap,mr=new WeakMap,Ga=new WeakMap,yu=new WeakMap,vu=new WeakMap,yp=new WeakMap,vp=new WeakMap;function QI(s,t,e){let n=0,o=0;const h=v=>{if(o+=1,v.length!==0){if(t.volume!==1)for(const w of v)for(let b=0;b<w.length;b++)w[b]*=t.volume;v.length===1&&(v=[v[0],v[0]]),e(v)}},d=t2(h),l=t.resampleRate!==s.sampleRate;let _=new AudioDecoder({output:v=>{const w=NI(v);l?d(()=>$I(w,v.sampleRate,{rate:t.resampleRate,chanCount:v.numberOfChannels})):h(w),v.close()},error:v=>{v.message.includes("Codec reclaimed due to inactivity")||m("MP4Clip AudioDecoder err",v)}});_.configure(s);function m(v,w){const b=`${v}: ${w.message}, state: ${JSON.stringify({qSize:_.decodeQueueSize,state:_.state,inputCnt:n,outputCnt:o})}`;throw Zt.error(b),Error(b)}return{decode(v){n+=v.length;try{for(const w of v)_.decode(w)}catch(w){m("decode audio chunk error",w)}},close(){_.state!=="closed"&&_.close()},get decoding(){return n>o&&_.decodeQueueSize>0},get state(){return _.state},get decodeQueueSize(){return _.decodeQueueSize}}}function t2(s){const t=[];let e=0;function n(d,l){t[l]=d,o()}function o(){const d=t[e];d!=null&&(s(d),e+=1,o())}let h=0;return d=>{const l=h;h+=1,d().then(_=>n(_,l)).catch(_=>n(_,l))}}function Hy(s,t){const e=[new Float32Array(t),new Float32Array(t)];let n=0,o=0;for(;o<s.data.length;){const[h,d]=s.data[o];if(n+h.length>t){const l=t-n;e[0].set(h.subarray(0,l),n),e[1].set(d.subarray(0,l),n),s.data[o][0]=h.subarray(l,h.length),s.data[o][1]=d.subarray(l,d.length);break}else e[0].set(h,n),e[1].set(d,n),n+=h.length,o++}return s.data=s.data.slice(o),s.frameCnt-=t,e}async function nx(s,t){const e=s[0],n=s.at(-1);if(n==null)return[];const o=n.offset+n.size-e.offset;if(o<3e7){const h=new Uint8Array(await t.read(o,{at:e.offset}));return s.map(d=>{const l=d.offset-e.offset;return new EncodedVideoChunk({type:d.is_sync?"key":"delta",timestamp:d.cts,duration:d.duration,data:h.subarray(l,l+d.size)})})}return await Promise.all(s.map(async h=>new EncodedVideoChunk({type:h.is_sync?"key":"delta",timestamp:h.cts,duration:h.duration,data:await t.read(h.size,{at:h.offset})})))}function e2(s,t,e){const n=new OffscreenCanvas(s,t),o=n.getContext("2d");return async h=>(o.drawImage(h,0,0,s,t),h.close(),await n.convertToBlob(e))}function i2(s,t){if(s.length===0)return[];let e=0,n=0,o=-1;for(let _=0;_<s.length;_++){const m=s[_];if(o===-1&&t<m.cts&&(o=_-1),m.is_idr)if(o===-1)e=_;else{n=_;break}}const h=s[o];if(h==null)throw Error("Not found video sample by time");const d=s.slice(0,n===0?s.length:n).map(_=>({..._}));for(let _=e;_<d.length;_++){const m=d[_];t<m.cts&&(m.deleted=!0,m.cts=-1)}bp(d);const l=s.slice(h.is_idr?o:e).map(_=>({..._,cts:_.cts-t}));for(const _ of l)_.cts<0&&(_.deleted=!0,_.cts=-1);return bp(l),[d,l]}function r2(s,t){if(s.length===0)return[];let e=-1;for(let h=0;h<s.length;h++){const d=s[h];if(!(t>d.cts)){e=h;break}}if(e===-1)throw Error("Not found audio sample by time");const n=s.slice(0,e).map(h=>({...h})),o=s.slice(e).map(h=>({...h,cts:h.cts-t}));return[n,o]}function xp(s,t,e){let n=0;if(s.state==="configured"){for(;n<t.length;n++)s.decode(t[n]);s.flush().catch(o=>{if(!(o instanceof Error))throw o;if(o.message.includes("Decoding error")&&e.onDecodingError!=null){e.onDecodingError(o);return}if(!o.message.includes("Aborted due to close"))throw o})}}function n2(s,t){if(t!=="avc1"&&t!=="hvc1")return 0;const e=new DataView(s.buffer);if(t==="avc1"&&(e.getUint8(4)&31)===6)return e.getUint32(0)+4;if(t==="hvc1"){const n=e.getUint8(4)>>1&63;if(n===39||n===40)return e.getUint32(0)+4}return 0}function s2(s,t){if(t!=="avc1"&&t!=="hvc1")return!0;const e=new DataView(s.buffer);let n=0;for(;n<s.byteLength-4;){if(t==="avc1"&&(e.getUint8(n+4)&31)===5)return!0;if(t==="hvc1"){const o=e.getUint8(n+4)>>1&63;if(o===19||o===20)return!0}n+=e.getUint32(n)+4}return!1}async function a2(s,t,e,n,o,h){const d=await t.createReader(),l=await nx(s.filter(v=>!v.deleted&&v.is_sync&&v.cts>=o.start&&v.cts<=o.end),d);if(l.length===0||n.aborted)return;let _=0;xp(m(),l,{onDecodingError:v=>{Zt.warn("thumbnailsByKeyFrame",v),_===0?xp(m(!0),l,{onDecodingError:w=>{d.close(),Zt.error("thumbnailsByKeyFrame retry soft deocde",w)}}):(h(null,!0),d.close())}});function m(v=!1){const w={...e,...v?{hardwareAcceleration:"prefer-software"}:{}},b=new VideoDecoder({output:T=>{_+=1;const r=_===l.length;h(T,r),r&&(d.close(),b.state!=="closed"&&b.close())},error:T=>{const r=`thumbnails decoder error: ${T.message}, config: ${JSON.stringify(w)}, state: ${JSON.stringify({qSize:b.decodeQueueSize,state:b.state,outputCnt:_,inputCnt:l.length})}`;throw Zt.error(r),Error(r)}});return n.addEventListener("abort",()=>{d.close(),b.state!=="closed"&&b.close()}),b.configure(w),b}}function bp(s){let t=0,e=null;for(const n of s)if(!n.deleted){if(n.is_sync&&(t+=1),t>=2)break;(e==null||n.cts<e.cts)&&(e=n)}e!=null&&e.cts<2e5&&(e.duration+=e.cts,e.cts=0)}function sx(){try{const s=performance.memory;return{jsHeapSizeLimit:s.jsHeapSizeLimit,totalJSHeapSize:s.totalJSHeapSize,usedJSHeapSize:s.usedJSHeapSize,percentUsed:(s.usedJSHeapSize/s.jsHeapSizeLimit).toFixed(3),percentTotal:(s.totalJSHeapSize/s.jsHeapSizeLimit).toFixed(3)}}catch{return{}}}var Ui,yr,pi,wp,ax;const o2=class Ha{constructor(t){_t(this,wp),Le(this,"ready"),_t(this,Ui,{duration:0,width:0,height:0}),_t(this,yr,null),_t(this,pi,[]);const e=n=>(ct(this,yr,n),F(this,Ui).width=n.width,F(this,Ui).height=n.height,F(this,Ui).duration=1/0,{...F(this,Ui)});if(t instanceof ReadableStream)this.ready=new Response(t).blob().then(n=>createImageBitmap(n)).then(e);else if(t instanceof ImageBitmap)this.ready=Promise.resolve(e(t));else if(Array.isArray(t)&&t.every(n=>n instanceof VideoFrame)){ct(this,pi,t);const n=F(this,pi)[0];if(n==null)throw Error("The frame count must be greater than 0");ct(this,Ui,{width:n.displayWidth,height:n.displayHeight,duration:F(this,pi).reduce((o,h)=>o+(h.duration??0),0)}),this.ready=Promise.resolve({...F(this,Ui),duration:1/0})}else if("type"in t)this.ready=wr(this,wp,ax).call(this,t.stream,t.type).then(()=>({width:F(this,Ui).width,height:F(this,Ui).height,duration:1/0}));else throw Error("Illegal arguments")}get meta(){return{...F(this,Ui)}}async tick(t){if(F(this,yr)!=null)return{video:await createImageBitmap(F(this,yr)),state:"success"};const e=t%F(this,Ui).duration;return{video:(F(this,pi).find(n=>e>=n.timestamp&&e<=n.timestamp+(n.duration??0))??F(this,pi)[0]).clone(),state:"success"}}async split(t){if(await this.ready,F(this,yr)!=null)return[new Ha(await createImageBitmap(F(this,yr))),new Ha(await createImageBitmap(F(this,yr)))];let e=-1;for(let h=0;h<F(this,pi).length;h++){const d=F(this,pi)[h];if(!(t>d.timestamp)){e=h;break}}if(e===-1)throw Error("Not found frame by time");const n=F(this,pi).slice(0,e).map(h=>new VideoFrame(h)),o=F(this,pi).slice(e).map(h=>new VideoFrame(h,{timestamp:h.timestamp-t}));return[new Ha(n),new Ha(o)]}async clone(){await this.ready;const t=F(this,yr)==null?F(this,pi).map(e=>e.clone()):await createImageBitmap(F(this,yr));return new Ha(t)}destroy(){var t;Zt.info("ImgClip destroy"),(t=F(this,yr))==null||t.close(),F(this,pi).forEach(e=>e.close())}};Ui=new WeakMap,yr=new WeakMap,pi=new WeakMap,wp=new WeakSet,ax=async function(s,t){ct(this,pi,await HI(s,t));const e=F(this,pi)[0];if(e==null)throw Error("No frame available in gif");ct(this,Ui,{duration:F(this,pi).reduce((n,o)=>n+(o.duration??0),0),width:e.codedWidth,height:e.codedHeight}),Zt.info("ImgClip ready:",F(this,Ui))};let Ku=o2;var no,ts,Hs,xn,Sp,ox,Ps,yn;const cl=class xu{constructor(t,e={}){_t(this,Sp),Le(this,"ready"),_t(this,no,{duration:0,width:0,height:0}),_t(this,ts,new Float32Array),_t(this,Hs,new Float32Array),_t(this,xn),_t(this,Ps,0),_t(this,yn,0),ct(this,xn,{loop:!1,volume:1,...e}),this.ready=wr(this,Sp,ox).call(this,t).then(()=>({width:0,height:0,duration:e.loop?1/0:F(this,no).duration}))}get meta(){return{...F(this,no),sampleRate:Ie.sampleRate,chanCount:2}}getPCMData(){return[F(this,ts),F(this,Hs)]}async tick(t){if(!F(this,xn).loop&&t>=F(this,no).duration)return{audio:[],state:"done"};const e=t-F(this,Ps);if(t<F(this,Ps)||e>3e6)return ct(this,Ps,t),ct(this,yn,Math.ceil(F(this,Ps)/1e6*Ie.sampleRate)),{audio:[new Float32Array(0),new Float32Array(0)],state:"success"};ct(this,Ps,t);const n=Math.ceil(e/1e6*Ie.sampleRate),o=F(this,yn)+n,h=F(this,xn).loop?[Ny(F(this,ts),F(this,yn),o),Ny(F(this,Hs),F(this,yn),o)]:[F(this,ts).slice(F(this,yn),o),F(this,Hs).slice(F(this,yn),o)];return ct(this,yn,o),{audio:h,state:"success"}}async split(t){await this.ready;const e=Math.ceil(t/1e6*Ie.sampleRate),n=new xu(this.getPCMData().map(h=>h.slice(0,e)),F(this,xn)),o=new xu(this.getPCMData().map(h=>h.slice(e)),F(this,xn));return[n,o]}async clone(){await this.ready;const t=new xu(this.getPCMData(),F(this,xn));return await t.ready,t}destroy(){ct(this,ts,new Float32Array(0)),ct(this,Hs,new Float32Array(0)),Zt.info("---- audioclip destroy ----")}};no=new WeakMap,ts=new WeakMap,Hs=new WeakMap,xn=new WeakMap,Sp=new WeakSet,ox=async function(s){cl.ctx==null&&(cl.ctx=new AudioContext({sampleRate:Ie.sampleRate}));const t=performance.now(),e=s instanceof ReadableStream?await l2(s,cl.ctx):s;Zt.info("Audio clip decoded complete:",performance.now()-t);const n=F(this,xn).volume;if(n!==1)for(const o of e)for(let h=0;h<o.length;h+=1)o[h]*=n;F(this,no).duration=e[0].length/Ie.sampleRate*1e6,ct(this,ts,e[0]),ct(this,Hs,e[1]??F(this,ts)),Zt.info("Audio clip convert to AudioData, time:",performance.now()-t)},Ps=new WeakMap,yn=new WeakMap,Le(cl,"ctx",null);let k_=cl;async function l2(s,t){const e=await new Response(s).arrayBuffer();return ex(await t.decodeAudioData(e))}var $a,bu,Va,dl;const lx=class hx{constructor(t){Le(this,"ready"),_t(this,$a,{duration:0,width:0,height:0}),_t(this,bu,()=>{}),Le(this,"audioTrack"),_t(this,Va,null),_t(this,dl),ct(this,dl,t);const e=t.getVideoTracks()[0];if(e!=null){const{width:n,height:o}=e.getSettings();e.contentHint="motion",F(this,$a).width=n??0,F(this,$a).height=o??0,ct(this,Va,new OffscreenCanvas(n??0,o??0)),ct(this,bu,u2(F(this,Va).getContext("2d"),e))}this.audioTrack=t.getAudioTracks()[0]??null,F(this,$a).duration=1/0,this.ready=Promise.resolve(this.meta)}get meta(){return{...F(this,$a)}}async tick(){return{video:F(this,Va)==null?null:await createImageBitmap(F(this,Va)),audio:[],state:"success"}}async split(){return[await this.clone(),await this.clone()]}async clone(){return new hx(F(this,dl).clone())}destroy(){F(this,dl).getTracks().forEach(t=>t.stop()),F(this,bu).call(this)}};$a=new WeakMap,bu=new WeakMap,Va=new WeakMap,dl=new WeakMap,Le(lx,"ctx",null);let h2=lx;function u2(s,t){return dI(new MediaStreamTrackProcessor({track:t}).readable,{onChunk:async e=>{s.drawImage(e,0,0),e.close()},onDone:async()=>{}})}var Zu,Ju,Qu,tc,ec,ic,Rs,Wa,Bs;const c2=class ux{constructor(t,e,n,o,h){_t(this,Rs),_t(this,Zu,new ea),Le(this,"on",F(this,Zu).on),_t(this,Ju,0),_t(this,Qu,0),_t(this,tc,0),_t(this,ec,0),_t(this,ic,0),_t(this,Bs,null),Le(this,"fixedAspectRatio",!1),Le(this,"fixedScaleCenter",!1),this.x=t??0,this.y=e??0,this.w=n??0,this.h=o??0,ct(this,Bs,h??null)}get x(){return F(this,Ju)}set x(t){wr(this,Rs,Wa).call(this,"x",t)}get y(){return F(this,Qu)}set y(t){wr(this,Rs,Wa).call(this,"y",t)}get w(){return F(this,tc)}set w(t){wr(this,Rs,Wa).call(this,"w",t)}get h(){return F(this,ec)}set h(t){wr(this,Rs,Wa).call(this,"h",t)}get angle(){return F(this,ic)}set angle(t){wr(this,Rs,Wa).call(this,"angle",t)}get center(){const{x:t,y:e,w:n,h:o}=this;return{x:t+n/2,y:e+o/2}}clone(){const{x:t,y:e,w:n,h:o}=this,h=new ux(t,e,n,o,F(this,Bs));return h.angle=this.angle,h.fixedAspectRatio=this.fixedAspectRatio,h.fixedScaleCenter=this.fixedScaleCenter,h}checkHit(t,e){var n,o;let{angle:h,center:d,x:l,y:_,w:m,h:v}=this;const w=((n=F(this,Bs))==null?void 0:n.center)??d,b=((o=F(this,Bs))==null?void 0:o.angle)??h;F(this,Bs)==null&&(l=l-w.x,_=_-w.y);const T=t-w.x,r=e-w.y;let a=T,u=r;return b!==0&&(a=T*Math.cos(b)+r*Math.sin(b),u=r*Math.cos(b)-T*Math.sin(b)),!(a<l||a>l+m||u<_||u>_+v)}};Zu=new WeakMap,Ju=new WeakMap,Qu=new WeakMap,tc=new WeakMap,ec=new WeakMap,ic=new WeakMap,Rs=new WeakSet,Wa=function(s,t){const e=this[s]!==t;switch(s){case"x":ct(this,Ju,t);break;case"y":ct(this,Qu,t);break;case"w":ct(this,tc,t);break;case"h":ct(this,ec,t);break;case"angle":ct(this,ic,t);break}e&&F(this,Zu).emit("propsChange",{[s]:t})},Bs=new WeakMap;let Nr=c2;var wu,Xa,fl,Fs,vn;class cx{constructor(){Le(this,"rect",new Nr),_t(this,wu,{offset:0,duration:0,playbackRate:1}),_t(this,Xa,new ea),Le(this,"on",F(this,Xa).on),_t(this,fl,0),Le(this,"opacity",1),Le(this,"flip",null),_t(this,Fs,null),_t(this,vn,null),Le(this,"ready",Promise.resolve()),this.rect.on("propsChange",t=>{F(this,Xa).emit("propsChange",{rect:t})})}get time(){return F(this,wu)}set time(t){Object.assign(F(this,wu),t)}get zIndex(){return F(this,fl)}set zIndex(t){const e=F(this,fl)!==t;ct(this,fl,t),e&&F(this,Xa).emit("propsChange",{zIndex:t})}_render(t){const{rect:{center:e,angle:n}}=this;t.setTransform(this.flip==="horizontal"?-1:1,0,0,this.flip==="vertical"?-1:1,e.x,e.y),t.rotate((this.flip==null?1:-1)*n),t.globalAlpha=this.opacity}setAnimation(t,e){ct(this,Fs,Object.entries(t).map(([n,o])=>{const h={from:0,to:100}[n]??Number(n.slice(0,-1));if(isNaN(h)||h>100||h<0)throw Error("keyFrame must between 0~100");return[h/100,o]})),ct(this,vn,Object.assign({},F(this,vn),{duration:e.duration,delay:e.delay??0,iterCount:e.iterCount??1/0}))}animate(t){if(F(this,Fs)==null||F(this,vn)==null||t<F(this,vn).delay)return;const e=d2(t,F(this,Fs),F(this,vn));for(const n in e)switch(n){case"opacity":this.opacity=e[n];break;case"x":case"y":case"w":case"h":case"angle":this.rect[n]=e[n];break}}copyStateTo(t){ct(t,Fs,F(this,Fs)),ct(t,vn,F(this,vn)),t.zIndex=this.zIndex,t.opacity=this.opacity,t.flip=this.flip,t.rect=this.rect.clone(),t.time={...this.time}}destroy(){F(this,Xa).destroy()}}wu=new WeakMap,Xa=new WeakMap,fl=new WeakMap,Fs=new WeakMap,vn=new WeakMap;function d2(s,t,e){const n=s-e.delay;if(n/e.duration>=e.iterCount)return{};const o=n%e.duration,h=n===e.duration?1:o/e.duration,d=t.findIndex(T=>T[0]>=h);if(d===-1)return{};const l=t[d-1],_=t[d],m=_[1];if(l==null)return m;const v=l[1],w={},b=(h-l[0])/(_[0]-l[0]);for(const T in m){const r=T;v[r]!=null&&(w[r]=(m[r]-v[r])*b+v[r])}return w}var Ya,Ms,Su;const f2=class dx extends cx{constructor(t){super(),_t(this,Ya),_t(this,Ms,null),_t(this,Su,!1),ct(this,Ya,t),this.ready=t.ready.then(({width:e,height:n,duration:o})=>{this.rect.w=this.rect.w===0?e:this.rect.w,this.rect.h=this.rect.h===0?n:this.rect.h,this.time.duration=this.time.duration===0?o:this.time.duration})}async offscreenRender(t,e){var n;const o=e*this.time.playbackRate;this.animate(o),super._render(t);const{w:h,h:d}=this.rect,{video:l,audio:_,state:m}=await F(this,Ya).tick(o);let v=_??[];if(_!=null&&this.time.playbackRate!==1&&(v=_.map(b=>ix(b,this.time.playbackRate))),m==="done")return{audio:v,done:!0};const w=l??F(this,Ms);return w!=null&&t.drawImage(w,-h/2,-d/2,h,d),l!=null&&((n=F(this,Ms))==null||n.close(),ct(this,Ms,l)),{audio:v,done:!1}}async clone(){const t=new dx(await F(this,Ya).clone());return await t.ready,this.copyStateTo(t),t}destroy(){var t;F(this,Su)||(ct(this,Su,!0),Zt.info("OffscreenSprite destroy"),super.destroy(),(t=F(this,Ms))==null||t.close(),ct(this,Ms,null),F(this,Ya).destroy())}};Ya=new WeakMap,Ms=new WeakMap,Su=new WeakMap;let p2=f2;var so,js,co,pl,Eu,Ep,Tu,Au;const _2=class fx extends cx{constructor(t){super(),_t(this,Eu),_t(this,so),Le(this,"visible",!0),_t(this,js,null),_t(this,co,[]),_t(this,pl,!1),_t(this,Tu,-1),_t(this,Au,!1),ct(this,so,t),this.ready=t.ready.then(({width:e,height:n,duration:o})=>{this.rect.w=this.rect.w===0?e:this.rect.w,this.rect.h=this.rect.h===0?n:this.rect.h,this.time.duration=this.time.duration===0?o:this.time.duration})}getClip(){return F(this,so)}preFrame(t){wr(this,Eu,Ep).call(this,t)}render(t,e){this.animate(e),super._render(t);const{w:n,h:o}=this.rect;F(this,Tu)!==e&&wr(this,Eu,Ep).call(this,e),ct(this,Tu,e);const h=F(this,co);ct(this,co,[]);const d=F(this,js);return d!=null&&t.drawImage(d,-n/2,-o/2,n,o),{audio:h}}copyStateTo(t){super.copyStateTo(t),t instanceof fx&&(t.visible=this.visible)}destroy(){var t;F(this,Au)||(ct(this,Au,!0),Zt.info("VisibleSprite destroy"),super.destroy(),(t=F(this,js))==null||t.close(),ct(this,js,null),F(this,so).destroy())}};so=new WeakMap,js=new WeakMap,co=new WeakMap,pl=new WeakMap,Eu=new WeakSet,Ep=function(s){F(this,pl)||(ct(this,pl,!0),F(this,so).tick(s*this.time.playbackRate).then(({video:t,audio:e})=>{var n;t!=null&&((n=F(this,js))==null||n.close(),ct(this,js,t??null)),ct(this,co,e??[]),e!=null&&this.time.playbackRate!==1&&ct(this,co,e.map(o=>ix(o,this.time.playbackRate)))}).finally(()=>{ct(this,pl,!1)}))},Tu=new WeakMap,Au=new WeakMap;let Jo=_2,g2=0;async function px(s){s()>50&&(await M_(15),await px(s))}var bn,Cu,Xr,Sl,rc,Uu,ao,El,Ls,Iu,_x,gx;class m2{constructor(t={}){_t(this,Iu),_t(this,bn,Zt.create(`id:${g2++},`)),_t(this,Cu,!1),_t(this,Xr,[]),_t(this,Sl),_t(this,rc),_t(this,Uu,null),_t(this,ao),_t(this,El),_t(this,Ls,new ea),Le(this,"on",F(this,Ls).on);const{width:e=0,height:n=0}=t;ct(this,Sl,new OffscreenCanvas(e,n));const o=F(this,Sl).getContext("2d",{alpha:!1});if(o==null)throw Error("Can not create 2d offscreen context");ct(this,rc,o),ct(this,ao,Object.assign({bgColor:"#000",width:0,height:0,videoCodec:"avc1.42E032",audio:!0,bitrate:5e6,fps:30,metaDataTags:null},t)),ct(this,El,e*n>0)}static async isSupported(t={}){return(self.OffscreenCanvas!=null&&self.VideoEncoder!=null&&self.VideoDecoder!=null&&self.VideoFrame!=null&&self.AudioEncoder!=null&&self.AudioDecoder!=null&&self.AudioData!=null&&((await self.VideoEncoder.isConfigSupported({codec:t.videoCodec??"avc1.42E032",width:t.width??1920,height:t.height??1080,bitrate:t.bitrate??7e6})).supported??!1)&&(await self.AudioEncoder.isConfigSupported({codec:Ie.codec,sampleRate:Ie.sampleRate,numberOfChannels:Ie.channelCount})).supported)??!1}async addSprite(t,e={}){const n={rect:b2(["x","y","w","h"],t.rect),time:{...t.time},zIndex:t.zIndex};F(this,bn).info("Combinator add sprite",n);const o=await t.clone();F(this,bn).info("Combinator add sprite ready"),F(this,Xr).push(Object.assign(o,{main:e.main??!1,expired:!1})),F(this,Xr).sort((h,d)=>h.zIndex-d.zIndex)}output(){if(F(this,Xr).length===0)throw Error("No sprite added");const t=F(this,Xr).find(_=>_.main),e=t!=null?t.time.offset+t.time.duration:Math.max(...F(this,Xr).map(_=>_.time.offset+_.time.duration));if(e===1/0)throw Error("Unable to determine the end time, please specify a main sprite, or limit the duration of ImgClip, AudioCli");e===-1&&F(this,bn).warn("Unable to determine the end time, process value don't update"),F(this,bn).info(`start combinate video, maxTime:${e}`);const n=wr(this,Iu,_x).call(this,e);let o=performance.now();const h=wr(this,Iu,gx).call(this,n,e,{onProgress:_=>{F(this,bn).debug("OutputProgress:",_),F(this,Ls).emit("OutputProgress",_)},onEnded:async()=>{await n.flush(),F(this,bn).info("===== output ended =====, cost:",performance.now()-o),F(this,Ls).emit("OutputProgress",1),this.destroy()},onError:_=>{F(this,Ls).emit("error",_),l(_),this.destroy()}});ct(this,Uu,()=>{h(),n.close(),l()});const{stream:d,stop:l}=fI(n.mp4file,500,this.destroy);return d}destroy(){var t;F(this,Cu)||(ct(this,Cu,!0),(t=F(this,Uu))==null||t.call(this),F(this,Ls).destroy())}}bn=new WeakMap,Cu=new WeakMap,Xr=new WeakMap,Sl=new WeakMap,rc=new WeakMap,Uu=new WeakMap,ao=new WeakMap,El=new WeakMap,Ls=new WeakMap,Iu=new WeakSet,_x=function(s){const{fps:t,width:e,height:n,videoCodec:o,bitrate:h,audio:d,metaDataTags:l}=F(this,ao);return bI({video:F(this,El)?{width:e,height:n,expectFPS:t,codec:o,bitrate:h,__unsafe_hardwareAcceleration__:F(this,ao).__unsafe_hardwareAcceleration__}:null,audio:d===!1?null:{codec:"aac",sampleRate:Ie.sampleRate,channelCount:Ie.channelCount},duration:s,metaDataTags:l})},gx=function(s,t,{onProgress:e,onEnded:n,onError:o}){let h=0;const d={aborted:!1};let l=null;(async()=>{const{fps:v,bgColor:w,audio:b}=F(this,ao),T=Math.round(1e6/v),r=F(this,rc),a=y2({ctx:r,bgColor:w,sprites:F(this,Xr),aborter:d}),u=v2({remux:s,ctx:r,cvs:F(this,Sl),outputAudio:b,hasVideoTrack:F(this,El),timeSlice:T});let f=0;for(;;){if(l!=null)return;if(d.aborted||t!==-1&&f>t||F(this,Xr).length===0){m(),await n();return}h=f/t;const{audios:g,mainSprDone:x}=await a(f);if(x){m(),await n();return}if(d.aborted)return;u(f,g),f+=T,await px(s.getEncodeQueueSize)}})().catch(v=>{l=v,F(this,bn).error(v),m(),o(v)});const _=setInterval(()=>{e(h)},500),m=()=>{d.aborted||(d.aborted=!0,clearInterval(_),F(this,Xr).forEach(v=>v.destroy()))};return m};function y2(s){const{ctx:t,bgColor:e,sprites:n,aborter:o}=s,{width:h,height:d}=t.canvas;return async l=>{t.fillStyle=e,t.fillRect(0,0,h,d);const _=[];let m=!1;for(const v of n){if(o.aborted)break;if(l<v.time.offset||v.expired)continue;t.save();const{audio:w,done:b}=await v.offscreenRender(t,l-v.time.offset);_.push(w),t.restore(),(v.time.duration>0&&l>v.time.offset+v.time.duration||b)&&(v.main&&(m=!0),v.destroy(),v.expired=!0)}return{audios:_,mainSprDone:m}}}function v2(s){const{ctx:t,cvs:e,outputAudio:n,remux:o,hasVideoTrack:h,timeSlice:d}=s,{width:l,height:_}=e;let m=0;const v=x2(1024);return(w,b)=>{if(n!==!1)for(const T of v(w,b))o.encodeAudio(T);if(h){const T=new VideoFrame(e,{duration:d,timestamp:w});o.encodeVideo(T,{keyFrame:m%150===0}),t.resetTransform(),t.clearRect(0,0,l,_),m+=1}}}function x2(s){const t=s*Ie.channelCount,e=new Float32Array(t*3);let n=0,o=0;const h=s/Ie.sampleRate*1e6,d=new Float32Array(t),l=_=>{let m=0;const v=Math.floor(n/t),w=[];for(let b=0;b<v;b++)w.push(new AudioData({timestamp:o,numberOfChannels:Ie.channelCount,numberOfFrames:s,sampleRate:Ie.sampleRate,format:"f32",data:e.subarray(m,m+t)})),m+=t,o+=h;for(e.set(e.subarray(m,n),0),n-=m;_-o>h;)w.push(new AudioData({timestamp:o,numberOfChannels:Ie.channelCount,numberOfFrames:s,sampleRate:Ie.sampleRate,format:"f32",data:d})),o+=h;return w};return(_,m)=>{var v,w;const b=Math.max(...m.map(T=>{var r;return((r=T[0])==null?void 0:r.length)??0}));for(let T=0;T<b;T++){let r=0,a=0;for(let u=0;u<m.length;u++){const f=((v=m[u][0])==null?void 0:v[T])??0,g=((w=m[u][1])==null?void 0:w[T])??f;r+=f,a+=g}e[n]=r,e[n+1]=a,n+=2}return l(_)}}function b2(s,t){return s.reduce((e,n)=>(e[n]=t[n],e),{})}var w2=Object.defineProperty,mx=s=>{throw TypeError(s)},S2=(s,t,e)=>t in s?w2(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Pu=(s,t,e)=>S2(s,typeof t!="symbol"?t+"":t,e),O_=(s,t,e)=>t.has(s)||mx("Cannot "+e),ot=(s,t,e)=>(O_(s,t,"read from private field"),e?e.call(s):t.get(s)),je=(s,t,e)=>t.has(s)?mx("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),Gi=(s,t,e,n)=>(O_(s,t,"write to private field"),t.set(s,e),e),$s=(s,t,e)=>(O_(s,t,"access private method"),e);const E2=["t","b","l","r","lt","lb","rt","rb","rotate"];function Eo(s){return document.createElement(s)}function T2(s){let t=16;const e=new ResizeObserver(o=>{const h=o[0];h!=null&&(t=10/(h.contentRect.width/s.width))});e.observe(s);function n(o){const{w:h,h:d}=o,l=t,_=l/2,m=h/2,v=d/2,w=l*1.5,b=w/2;return{...o.fixedAspectRatio?{}:{t:new Nr(-_,-v-_,l,l,o),b:new Nr(-_,v-_,l,l,o),l:new Nr(-m-_,-_,l,l,o),r:new Nr(m-_,-_,l,l,o)},lt:new Nr(-m-_,-v-_,l,l,o),lb:new Nr(-m-_,v-_,l,l,o),rt:new Nr(m-_,-v-_,l,l,o),rb:new Nr(m-_,v-_,l,l,o),rotate:new Nr(-b,-v-l*2-b,w,w,o)}}return{rectCtrlsGetter:n,destroy:()=>{e.disconnect()}}}var Rl=(s=>(s.ActiveSpriteChange="activeSpriteChange",s.AddSprite="addSprite",s))(Rl||{}),er,ja,qa,_l;class A2{constructor(){je(this,er,[]),je(this,ja,null),je(this,qa,new ea),Pu(this,"on",ot(this,qa).on),je(this,_l,0)}get activeSprite(){return ot(this,ja)}set activeSprite(t){t!==ot(this,ja)&&(Gi(this,ja,t),ot(this,qa).emit("activeSpriteChange",t))}async addSprite(t){await t.ready,ot(this,er).push(t),Gi(this,er,ot(this,er).sort((e,n)=>e.zIndex-n.zIndex)),t.on("propsChange",e=>{e.zIndex!=null&&Gi(this,er,ot(this,er).sort((n,o)=>n.zIndex-o.zIndex))}),ot(this,qa).emit("addSprite",t)}removeSprite(t){ot(this,ja)===t&&(this.activeSprite=null),Gi(this,er,ot(this,er).filter(e=>e!==t)),t.destroy()}getSprites(t={time:!0}){return ot(this,er).filter(e=>e.visible&&(t.time?ot(this,_l)>=e.time.offset&&ot(this,_l)<=e.time.offset+e.time.duration:!0))}updateRenderTime(t){Gi(this,_l,t);const e=this.activeSprite;e!=null&&(t<e.time.offset||t>e.time.offset+e.time.duration)&&(this.activeSprite=null)}destroy(){ot(this,qa).destroy(),ot(this,er).forEach(t=>t.destroy()),Gi(this,er,[])}}er=new WeakMap,ja=new WeakMap,qa=new WeakMap,_l=new WeakMap;function C2(s,t,e,n){const o={w:t.clientWidth/t.width,h:t.clientHeight/t.height},h=new ResizeObserver(()=>{o.w=t.clientWidth/t.width,o.h=t.clientHeight/t.height,e.activeSprite!=null&&pf(e.activeSprite,d,l,o,n)});h.observe(t);const{rectEl:d,ctrlsEl:l}=U2(s),_=e.on(Rl.ActiveSpriteChange,T=>{if(T==null){d.style.display="none";return}pf(T,d,l,o,n),d.style.display=""});let m=!1;const v=T=>{T.button===0&&(m=!0)},w=()=>{m=!1},b=()=>{!m||e.activeSprite==null||pf(e.activeSprite,d,l,o,n)};return t.addEventListener("mousedown",v),window.addEventListener("mouseup",w),window.addEventListener("mousemove",b),()=>{h.disconnect(),_(),d.remove(),t.removeEventListener("mousedown",v),window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",b)}}function U2(s){const t=Eo("div");t.style.cssText=`
    position: absolute;
    pointer-events: none;
    border: 1px solid #eee;
    box-sizing: border-box;
    display: none;
  `;const e=Object.fromEntries(E2.map(n=>{const o=Eo("div");return o.style.cssText=`
        display: none;
        position: absolute;
        border: 1px solid #3ee; border-radius: 50%;
        box-sizing: border-box;
        background-color: #fff;
      `,[n,o]}));return Object.values(e).forEach(n=>t.appendChild(n)),s.appendChild(t),{rectEl:t,ctrlsEl:e}}function pf(s,t,e,n,o){const{x:h,y:d,w:l,h:_,angle:m}=s.rect;Object.assign(t.style,{left:`${h*n.w}px`,top:`${d*n.h}px`,width:`${l*n.w}px`,height:`${_*n.h}px`,rotate:`${m}rad`}),Object.entries(o(s.rect)).forEach(([v,{x:w,y:b,w:T,h:r}])=>{Object.assign(e[v].style,{display:"block",left:"50%",top:"50%",width:`${T*n.w}px`,height:`${r*n.h}px`,transform:`translate(${w*n.w}px, ${b*n.h}px)`})})}function I2(s,t,e){const n={w:s.clientWidth/s.width,h:s.clientHeight/s.height},o=new ResizeObserver(()=>{n.w=s.clientWidth/s.width,n.h=s.clientHeight/s.height});o.observe(s);const h=d=>{if(d.button!==0)return;const{offsetX:l,offsetY:_}=d,m=l/n.w,v=_/n.h;if(t.activeSprite!=null){const[w]=Object.entries(e(t.activeSprite.rect)).find(([,b])=>b.checkHit(m,v))??[];if(w!=null)return}t.activeSprite=t.getSprites().reverse().find(w=>w.visible&&w.rect.checkHit(m,v))??null};return s.addEventListener("mousedown",h),()=>{o.disconnect(),s.removeEventListener("mousedown",h)}}function P2(s,t,e,n){const o={w:s.clientWidth/s.width,h:s.clientHeight/s.height},h=new ResizeObserver(()=>{o.w=s.clientWidth/s.width,o.h=s.clientHeight/s.height});h.observe(s);let d=0,l=0,_=null;const m=k2(s,e);let v=null;const w=r=>{if(r.button!==0||t.activeSprite==null)return;v=t.activeSprite;const{offsetX:a,offsetY:u,clientX:f,clientY:g}=r;M2({rect:v.rect,offsetX:a,offsetY:u,clientX:f,clientY:g,cvsRatio:o,cvsEl:s,rectCtrlsGetter:n})||(_=v.rect.clone(),m.magneticEffect(v.rect.x,v.rect.y,v.rect),d=f,l=g,window.addEventListener("mousemove",b),window.addEventListener("mouseup",T))},b=r=>{if(v==null||_==null)return;const{clientX:a,clientY:u}=r;let f=_.x+(a-d)/o.w,g=_.y+(u-l)/o.h;yx(v.rect,s,m.magneticEffect(f,g,v.rect))};s.addEventListener("mousedown",w);const T=()=>{m.hide(),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",T)};return()=>{h.disconnect(),m.destroy(),T(),s.removeEventListener("mousedown",w)}}function R2({sprRect:s,startX:t,startY:e,ctrlKey:n,cvsRatio:o,cvsEl:h}){const d=s.clone(),l=m=>{const{clientX:v,clientY:w}=m,b=(v-t)/o.w,T=(w-e)/o.h,r=n.length===1?B2:F2,{x:a,y:u,w:f,h:g}=d,x=Math.atan2(g,f),{incW:S,incH:A,incS:C,rotateAngle:B}=r({deltaX:b,deltaY:T,angle:s.angle,ctrlKey:n,diagonalAngle:x}),R=10;let M=f,N=g,L=d.fixedScaleCenter?S*2:S,W=d.fixedScaleCenter?A*2:A,k=C;const j=Math.sqrt(g**2+f**2),Y=Math.sqrt((R*(g/f))**2+R**2);switch(n){case"l":M=Math.max(f+L,R),k=Math.min(C,f-R);break;case"r":M=Math.max(f+L,R),k=Math.max(C,R-f);break;case"b":N=Math.max(g+W,R),k=Math.min(C,g-R);break;case"t":N=Math.max(g+W,R),k=Math.max(C,R-g);break;case"lt":case"lb":M=Math.max(f+L,R),N=M===R?g/f*M:g+W,k=Math.min(C,j-Y);break;case"rt":case"rb":M=Math.max(f+L,R),N=M===R?g/f*M:g+W,k=Math.max(C,Y-j);break}let ut=a,it=u;if(d.fixedScaleCenter)ut=a+f/2-M/2,it=u+g/2-N/2;else{const gt=k/2*Math.cos(B)+a+f/2,Q=k/2*Math.sin(B)+u+g/2;ut=gt-M/2,it=Q-N/2}yx(s,h,{x:ut,y:it,w:M,h:N})},_=()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",_)};window.addEventListener("mousemove",l),window.addEventListener("mouseup",_)}function B2({deltaX:s,deltaY:t,angle:e,ctrlKey:n}){let o=0,h=0,d=0,l=e;return n==="l"||n==="r"?(o=s*Math.cos(e)+t*Math.sin(e),h=o*(n==="l"?-1:1)):(n==="t"||n==="b")&&(l=e-Math.PI/2,o=s*Math.cos(l)+t*Math.sin(l),d=o*(n==="b"?-1:1)),{incW:h,incH:d,incS:o,rotateAngle:l}}function F2({deltaX:s,deltaY:t,angle:e,ctrlKey:n,diagonalAngle:o}){const h=(n==="lt"||n==="rb"?1:-1)*o+e,d=s*Math.cos(h)+t*Math.sin(h),l=n==="lt"||n==="lb"?-1:1,_=d*Math.cos(o)*l,m=d*Math.sin(o)*l;return{incW:_,incH:m,incS:d,rotateAngle:h}}function M2({rect:s,cvsRatio:t,offsetX:e,offsetY:n,clientX:o,clientY:h,cvsEl:d,rectCtrlsGetter:l}){const _=e/t.w,m=n/t.h,[v]=Object.entries(l(s)).find(([,w])=>w.checkHit(_,m))??[];return v==null?!1:(v==="rotate"?L2(s,D2(s.center,t,d)):R2({sprRect:s,ctrlKey:v,startX:o,startY:h,cvsRatio:t,cvsEl:d}),!0)}function L2(s,t){const e=({clientX:o,clientY:h})=>{const d=o-t.x,l=h-t.y,_=Math.atan2(l,d)+Math.PI/2;s.angle=_},n=()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)};window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)}function D2(s,t,e){const n=s.x*t.w,o=s.y*t.h,{left:h,top:d}=e.getBoundingClientRect();return{x:n+h,y:o+d}}function yx(s,t,e){const n={x:s.x,y:s.y,w:s.w,h:s.h,...e},o=t.width*.05,h=t.height*.05;n.x<-n.w+o?n.x=-n.w+o:n.x>t.width-o&&(n.x=t.width-o),n.y<-n.h+h?n.y=-n.h+h:n.y>t.height-h&&(n.y=t.height-h),s.x=n.x,s.y=n.y,s.w=n.w,s.h=n.h}function k2(s,t){const e="display: none; position: absolute;",n={w:0,h:0,x:0,y:0},o={vertMiddle:{...n,h:100,x:50,ref:{prop:"x",val:({w:_})=>(s.width-_)/2}},horMiddle:{...n,w:100,y:50,ref:{prop:"y",val:({h:_})=>(s.height-_)/2}},top:{...n,w:100,ref:{prop:"y",val:()=>0}},bottom:{...n,w:100,y:100,ref:{prop:"y",val:({h:_})=>s.height-_}},left:{...n,h:100,ref:{prop:"x",val:()=>0}},right:{...n,h:100,x:100,ref:{prop:"x",val:({w:_})=>s.width-_}}},h=Eo("div");h.style.cssText=`
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    box-sizing: border-box;
  `;const d=Object.fromEntries(Object.entries(o).map(([_,{w:m,h:v,x:w,y:b}])=>{const T=Eo("div");return T.style.cssText=`
        ${e}
        border-${m>0?"top":"left"}: 1px solid #3ee;
        top: ${b}%; left: ${w}%;
        ${w===100?"margin-left: -1px":""};
        ${b===100?"margin-top: -1px":""};
        width: ${m}%; height: ${v}%;
      `,h.appendChild(T),[_,T]}));t.appendChild(h);const l=6/(900/s.width);return{magneticEffect(_,m,v){const w={x:_,y:m};let b,T={x:!1,y:!1};for(b in o){const{prop:r,val:a}=o[b].ref;if(T[r])continue;const u=a(v);Math.abs(v[r]-u)<=l&&Math.abs(v[r]-(r==="x"?_:m))<=l?(w[r]=u,d[b].style.display="block",T[r]=!0):d[b].style.display="none"}return w},hide(){Object.values(d).forEach(_=>_.style.display="none")},destroy(){h.remove()}}}function O2(s,t,e){const n={w:s.clientWidth/s.width,h:s.clientHeight/s.height},o=new ResizeObserver(()=>{n.w=s.clientWidth/s.width,n.h=s.clientHeight/s.height});o.observe(s);const h=s.style;let d=t.activeSprite;t.on(Rl.ActiveSpriteChange,T=>{d=T,T==null&&(h.cursor="")});let l=!1;const _=({offsetX:T,offsetY:r})=>{l=!0;const a=T/n.w,u=r/n.h;(d==null?void 0:d.rect.checkHit(a,u))===!0&&h.cursor===""&&(h.cursor="move")},m=()=>{l=!1},v=["ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize"],w={t:0,rt:1,r:2,rb:3,b:4,lb:5,l:6,lt:7},b=T=>{if(d==null||l)return;const{offsetX:r,offsetY:a}=T,u=r/n.w,f=a/n.h,[g]=Object.entries(e(d.rect)).find(([,x])=>x.checkHit(u,f))??[];if(g!=null){if(g==="rotate"){h.cursor="crosshair";return}const x=d.rect.angle,S=x<0?x+2*Math.PI:x,A=(w[g]+Math.floor((S+Math.PI/8)/(Math.PI/4)))%8;h.cursor=v[A];return}if(d.rect.checkHit(u,f)){h.cursor="move";return}h.cursor=""};return s.addEventListener("mousemove",b),s.addEventListener("mousedown",_),window.addEventListener("mouseup",m),()=>{o.disconnect(),s.removeEventListener("mousemove",b),s.removeEventListener("mousedown",_),window.removeEventListener("mouseup",m)}}const N2={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2"};function z2(s){const t=Eo("canvas");return t.style.cssText=`
    width: 100%;
    height: 100%;
    display: block;
  `,t.width=s.width,t.height=s.height,t}var ni,We,oo,Ru,Bu,Fu,Zn,Mu,es,Sn,nc,sc,wi,Vs,Ws,vx,br,Lu;class G2{constructor(t,e){je(this,Sn),je(this,ni),je(this,We),je(this,oo),je(this,Ru,!1),je(this,Bu,[]),je(this,Fu),je(this,Zn,new ea),Pu(this,"on",ot(this,Zn).on),je(this,Mu),je(this,es,0),je(this,wi,new AudioContext),je(this,Vs,ot(this,wi).createMediaStreamDestination()),je(this,Ws,new Set),je(this,br,{start:0,end:0,step:0,audioPlayAt:0}),je(this,Lu,new WeakMap),Pu(this,"addSprite",async w=>{ot(this,wi).state==="suspended"&&ot(this,wi).resume().catch(Zt.error);const b=w.getClip();if(b instanceof h2&&b.audioTrack!=null){const T=ot(this,wi).createMediaStreamSource(new MediaStream([b.audioTrack]));T.connect(ot(this,Vs)),ot(this,Lu).set(w,T)}await ot(this,We).addSprite(w)}),Pu(this,"removeSprite",w=>{var b;(b=ot(this,Lu).get(w))==null||b.disconnect(),ot(this,We).removeSprite(w)}),Gi(this,Mu,e),Gi(this,ni,z2(e));const n=ot(this,ni).getContext("2d",{alpha:!1});if(n==null)throw Error("canvas context is null");Gi(this,oo,n);const o=Eo("div");o.style.cssText="width: 100%; height: 100%; position: relative; overflow: hidden;",o.appendChild(ot(this,ni)),t.appendChild(o),$2(ot(this,wi)).connect(ot(this,Vs)),Gi(this,We,new A2);const{rectCtrlsGetter:h,destroy:d}=T2(ot(this,ni));ot(this,Bu).push(d,I2(ot(this,ni),ot(this,We),h),O2(ot(this,ni),ot(this,We),h),P2(ot(this,ni),ot(this,We),o,h),C2(o,ot(this,ni),ot(this,We),h),ot(this,We).on(Rl.AddSprite,w=>{const{rect:b}=w;b.x===0&&b.y===0&&(b.x=(ot(this,ni).width-b.w)/2,b.y=(ot(this,ni).height-b.h)/2)}),ea.forwardEvent(ot(this,We),ot(this,Zn),[Rl.ActiveSpriteChange]));let l=ot(this,es),_=performance.now(),m=0;const v=1e3/30;Gi(this,Fu,R_(()=>{(performance.now()-_)/(v*m)<1||(m+=1,ot(this,oo).fillStyle=e.bgColor,ot(this,oo).fillRect(0,0,ot(this,ni).width,ot(this,ni).height),$s(this,Sn,vx).call(this),l!==ot(this,es)&&(l=ot(this,es),ot(this,Zn).emit("timeupdate",Math.round(l))))},v))}play(t){const e=ot(this,We).getSprites({time:!1}).map(o=>o.time.offset+o.time.duration),n=t.end??(e.length>0?Math.max(...e):1/0);if(t.start>=n||t.start<0)throw Error(`Invalid time parameter, ${JSON.stringify({start:t.start,end:n})}`);$s(this,Sn,nc).call(this,t.start),ot(this,We).getSprites({time:!1}).forEach(o=>{const{offset:h,duration:d}=o.time,l=ot(this,es)-h;o.preFrame(l>0&&l<d?l:0)}),ot(this,br).start=t.start,ot(this,br).end=n,ot(this,br).step=(t.playbackRate??1)*(1e3/30)*1e3,ot(this,wi).resume(),ot(this,br).audioPlayAt=0,ot(this,Zn).emit("playing"),Zt.info("AVCanvs play by:",ot(this,br))}pause(){$s(this,Sn,sc).call(this)}previewFrame(t){$s(this,Sn,nc).call(this,t),$s(this,Sn,sc).call(this)}captureImage(){return ot(this,ni).toDataURL()}get activeSprite(){return ot(this,We).activeSprite}set activeSprite(t){ot(this,We).activeSprite=t}destroy(){var t;ot(this,Ru)||(Gi(this,Ru,!0),ot(this,wi).close(),ot(this,Vs).disconnect(),ot(this,Zn).destroy(),ot(this,Fu).call(this),(t=ot(this,ni).parentElement)==null||t.remove(),ot(this,Bu).forEach(e=>e()),ot(this,Ws).clear(),ot(this,We).destroy())}captureStream(){ot(this,wi).state==="suspended"&&ot(this,wi).resume().catch(Zt.error);const t=new MediaStream(ot(this,ni).captureStream().getTracks().concat(ot(this,Vs).stream.getTracks()));return Zt.info("AVCanvas.captureStream, tracks:",t.getTracks().map(e=>e.kind)),t}async createCombinator(t={}){Zt.info("AVCanvas.createCombinator, opts:",t);const e=new m2({...ot(this,Mu),...t}),n=ot(this,We).getSprites({time:!1});if(n.length===0)throw Error("No sprite added");for(const o of n){const h=new p2(o.getClip());h.time={...o.time},o.copyStateTo(h),await e.addSprite(h)}return e}}ni=new WeakMap,We=new WeakMap,oo=new WeakMap,Ru=new WeakMap,Bu=new WeakMap,Fu=new WeakMap,Zn=new WeakMap,Mu=new WeakMap,es=new WeakMap,Sn=new WeakSet,nc=function(s){Gi(this,es,s),ot(this,We).updateRenderTime(s)},sc=function(){const s=ot(this,br).step!==0;ot(this,br).step=0,s&&(ot(this,Zn).emit("paused"),ot(this,wi).suspend());for(const t of ot(this,Ws))t.stop(),t.disconnect();ot(this,Ws).clear()},wi=new WeakMap,Vs=new WeakMap,Ws=new WeakMap,vx=function(){var s;const t=ot(this,oo);let e=ot(this,es);const{start:n,end:o,step:h,audioPlayAt:d}=ot(this,br);h!==0&&e>=n&&e<o?e+=h:$s(this,Sn,sc).call(this),$s(this,Sn,nc).call(this,e);const l=[];for(const _ of ot(this,We).getSprites()){t.save();const{audio:m}=_.render(t,e-_.time.offset);t.restore(),l.push(m)}if(t.resetTransform(),h!==0){const _=Math.max(ot(this,wi).currentTime,d),m=H2(l,ot(this,wi));let v=0;for(const w of m)w.start(_),w.connect(ot(this,wi).destination),w.connect(ot(this,Vs)),ot(this,Ws).add(w),w.onended=()=>{w.disconnect(),ot(this,Ws).delete(w)},v=Math.max(v,((s=w.buffer)==null?void 0:s.duration)??0);ot(this,br).audioPlayAt=_+v}},br=new WeakMap,Lu=new WeakMap;function H2(s,t){const e=[];if(s.length===0)return e;for(const[n,o]of s){if(n==null||n.length<=0)continue;const h=t.createBuffer(2,n.length,N2.sampleRate);h.copyToChannel(n,0),h.copyToChannel(o??n,1);const d=t.createBufferSource();d.buffer=h,e.push(d)}return e}function $2(s){const t=s.createOscillator(),e=new Float32Array([0,0]),n=new Float32Array([0,0]),o=s.createPeriodicWave(e,n,{disableNormalization:!0});return t.setPeriodicWave(o),t.start(),t}const sa=KU("track",{state:()=>({showContextMenu:!1,contextMenuPosition:{x:0,y:0},dragData:null,canvasSize:{width:0,height:0},currentHistoryIndex:-1,maxHistoryIndex:-1,maxHistorySize:50,clipUpdateSubscribers:new Map,activeClip:null}),getters:{getShowContextMenu:s=>s.showContextMenu,getContextMenuPosition:s=>s.contextMenuPosition,getDragData:s=>s.dragData,getCanvasSize:s=>s.canvasSize,canUndo:s=>s.currentHistoryIndex>0},actions:{subscribeToClipUpdates(s,t){this.clipUpdateSubscribers.set(s,t)},unsubscribeFromClipUpdates(s){this.clipUpdateSubscribers.delete(s)},publishClipUpdate(s,t="default"){const e=this.clipUpdateSubscribers.get(s.id);e&&e(s,t)},setShowContextMenu(s){this.showContextMenu=s},setContextMenuPosition(s){this.contextMenuPosition=s},setDragData(s){this.dragData=s},clearDragData(){this.dragData=null},setCanvasSize(s){this.canvasSize=s},async saveHistoryState(s,t){if(await Ke.history.where("projectId").equals(s).and(n=>n.index>this.currentHistoryIndex).delete(),this.currentHistoryIndex++,this.maxHistoryIndex=this.currentHistoryIndex,await Ke.history.add({projectId:s,tracks:JSON.parse(JSON.stringify(t)),index:this.currentHistoryIndex,timestamp:Date.now()}),await Ke.history.where("projectId").equals(s).count()>this.maxHistorySize){const n=await Ke.history.where("projectId").equals(s).and(o=>o.index===0).toArray();n.length>0&&(await Ke.history.delete(n[0].id),this.currentHistoryIndex--,this.maxHistoryIndex--)}},async undo(s){if(!this.canUndo)return null;const t=await Ke.history.where("projectId").equals(s).and(e=>e.index===this.currentHistoryIndex-1).first();return t?(this.currentHistoryIndex--,t.tracks):null},async redo(s){const t=await Ke.history.where("projectId").equals(s).and(e=>e.index===this.currentHistoryIndex+1).first();return t?(this.currentHistoryIndex++,t.tracks):null},async getCanRedo(s){const t=await Ke.history.where("projectId").equals(s).count();return this.currentHistoryIndex<t-1},async clearHistory(s){await Ke.history.where("projectId").equals(s).delete(),this.currentHistoryIndex=-1,this.maxHistoryIndex=-1},setActiveClip(s){this.activeClip=s}}}),xx=/^[a-z0-9]+(-[a-z0-9]+)*$/,Ic=(s,t,e,n="")=>{const o=s.split(":");if(s.slice(0,1)==="@"){if(o.length<2||o.length>3)return null;n=o.shift().slice(1)}if(o.length>3||!o.length)return null;if(o.length>1){const l=o.pop(),_=o.pop(),m={provider:o.length>0?o[0]:n,prefix:_,name:l};return t&&!Du(m)?null:m}const h=o[0],d=h.split("-");if(d.length>1){const l={provider:n,prefix:d.shift(),name:d.join("-")};return t&&!Du(l)?null:l}if(e&&n===""){const l={provider:n,prefix:"",name:h};return t&&!Du(l,e)?null:l}return null},Du=(s,t)=>s?!!((t&&s.prefix===""||s.prefix)&&s.name):!1,bx=Object.freeze({left:0,top:0,width:16,height:16}),ac=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),Pc=Object.freeze({...bx,...ac}),Tp=Object.freeze({...Pc,body:"",hidden:!1});function V2(s,t){const e={};!s.hFlip!=!t.hFlip&&(e.hFlip=!0),!s.vFlip!=!t.vFlip&&(e.vFlip=!0);const n=((s.rotate||0)+(t.rotate||0))%4;return n&&(e.rotate=n),e}function $y(s,t){const e=V2(s,t);for(const n in Tp)n in ac?n in s&&!(n in e)&&(e[n]=ac[n]):n in t?e[n]=t[n]:n in s&&(e[n]=s[n]);return e}function W2(s,t){const e=s.icons,n=s.aliases||Object.create(null),o=Object.create(null);function h(d){if(e[d])return o[d]=[];if(!(d in o)){o[d]=null;const l=n[d]&&n[d].parent,_=l&&h(l);_&&(o[d]=[l].concat(_))}return o[d]}return Object.keys(e).concat(Object.keys(n)).forEach(h),o}function X2(s,t,e){const n=s.icons,o=s.aliases||Object.create(null);let h={};function d(l){h=$y(n[l]||o[l],h)}return d(t),e.forEach(d),$y(s,h)}function wx(s,t){const e=[];if(typeof s!="object"||typeof s.icons!="object")return e;s.not_found instanceof Array&&s.not_found.forEach(o=>{t(o,null),e.push(o)});const n=W2(s);for(const o in n){const h=n[o];h&&(t(o,X2(s,o,h)),e.push(o))}return e}const Y2={provider:"",aliases:{},not_found:{},...bx};function _f(s,t){for(const e in t)if(e in s&&typeof s[e]!=typeof t[e])return!1;return!0}function Sx(s){if(typeof s!="object"||s===null)return null;const t=s;if(typeof t.prefix!="string"||!s.icons||typeof s.icons!="object"||!_f(s,Y2))return null;const e=t.icons;for(const o in e){const h=e[o];if(!o||typeof h.body!="string"||!_f(h,Tp))return null}const n=t.aliases||Object.create(null);for(const o in n){const h=n[o],d=h.parent;if(!o||typeof d!="string"||!e[d]&&!n[d]||!_f(h,Tp))return null}return t}const Vy=Object.create(null);function j2(s,t){return{provider:s,prefix:t,icons:Object.create(null),missing:new Set}}function To(s,t){const e=Vy[s]||(Vy[s]=Object.create(null));return e[t]||(e[t]=j2(s,t))}function Ex(s,t){return Sx(t)?wx(t,(e,n)=>{n?s.icons[e]=n:s.missing.add(e)}):[]}function q2(s,t,e){try{if(typeof e.body=="string")return s.icons[t]={...e},!0}catch{}return!1}let Bl=!1;function Tx(s){return typeof s=="boolean"&&(Bl=s),Bl}function K2(s){const t=typeof s=="string"?Ic(s,!0,Bl):s;if(t){const e=To(t.provider,t.prefix),n=t.name;return e.icons[n]||(e.missing.has(n)?null:void 0)}}function Z2(s,t){const e=Ic(s,!0,Bl);if(!e)return!1;const n=To(e.provider,e.prefix);return t?q2(n,e.name,t):(n.missing.add(e.name),!0)}function J2(s,t){if(typeof s!="object")return!1;if(typeof t!="string"&&(t=s.provider||""),Bl&&!t&&!s.prefix){let o=!1;return Sx(s)&&(s.prefix="",wx(s,(h,d)=>{Z2(h,d)&&(o=!0)})),o}const e=s.prefix;if(!Du({provider:t,prefix:e,name:"a"}))return!1;const n=To(t,e);return!!Ex(n,s)}const Ax=Object.freeze({width:null,height:null}),Cx=Object.freeze({...Ax,...ac}),Q2=/(-?[0-9.]*[0-9]+[0-9.]*)/g,tP=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function Wy(s,t,e){if(t===1)return s;if(e=e||100,typeof s=="number")return Math.ceil(s*t*e)/e;if(typeof s!="string")return s;const n=s.split(Q2);if(n===null||!n.length)return s;const o=[];let h=n.shift(),d=tP.test(h);for(;;){if(d){const l=parseFloat(h);isNaN(l)?o.push(h):o.push(Math.ceil(l*t*e)/e)}else o.push(h);if(h=n.shift(),h===void 0)return o.join("");d=!d}}function eP(s,t="defs"){let e="";const n=s.indexOf("<"+t);for(;n>=0;){const o=s.indexOf(">",n),h=s.indexOf("</"+t);if(o===-1||h===-1)break;const d=s.indexOf(">",h);if(d===-1)break;e+=s.slice(o+1,h).trim(),s=s.slice(0,n).trim()+s.slice(d+1)}return{defs:e,content:s}}function iP(s,t){return s?"<defs>"+s+"</defs>"+t:t}function rP(s,t,e){const n=eP(s);return iP(n.defs,t+n.content+e)}const nP=s=>s==="unset"||s==="undefined"||s==="none";function sP(s,t){const e={...Pc,...s},n={...Cx,...t},o={left:e.left,top:e.top,width:e.width,height:e.height};let h=e.body;[e,n].forEach(a=>{const u=[],f=a.hFlip,g=a.vFlip;let x=a.rotate;f?g?x+=2:(u.push("translate("+(o.width+o.left).toString()+" "+(0-o.top).toString()+")"),u.push("scale(-1 1)"),o.top=o.left=0):g&&(u.push("translate("+(0-o.left).toString()+" "+(o.height+o.top).toString()+")"),u.push("scale(1 -1)"),o.top=o.left=0);let S;switch(x<0&&(x-=Math.floor(x/4)*4),x=x%4,x){case 1:S=o.height/2+o.top,u.unshift("rotate(90 "+S.toString()+" "+S.toString()+")");break;case 2:u.unshift("rotate(180 "+(o.width/2+o.left).toString()+" "+(o.height/2+o.top).toString()+")");break;case 3:S=o.width/2+o.left,u.unshift("rotate(-90 "+S.toString()+" "+S.toString()+")");break}x%2===1&&(o.left!==o.top&&(S=o.left,o.left=o.top,o.top=S),o.width!==o.height&&(S=o.width,o.width=o.height,o.height=S)),u.length&&(h=rP(h,'<g transform="'+u.join(" ")+'">',"</g>"))});const d=n.width,l=n.height,_=o.width,m=o.height;let v,w;d===null?(w=l===null?"1em":l==="auto"?m:l,v=Wy(w,_/m)):(v=d==="auto"?_:d,w=l===null?Wy(v,m/_):l==="auto"?m:l);const b={},T=(a,u)=>{nP(u)||(b[a]=u.toString())};T("width",v),T("height",w);const r=[o.left,o.top,_,m];return b.viewBox=r.join(" "),{attributes:b,viewBox:r,body:h}}const aP=/\sid="(\S+)"/g,oP="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let lP=0;function hP(s,t=oP){const e=[];let n;for(;n=aP.exec(s);)e.push(n[1]);if(!e.length)return s;const o="suffix"+(Math.random()*16777216|Date.now()).toString(16);return e.forEach(h=>{const d=typeof t=="function"?t(h):t+(lP++).toString(),l=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s=s.replace(new RegExp('([#;"])('+l+')([")]|\\.[a-z])',"g"),"$1"+d+o+"$3")}),s=s.replace(new RegExp(o,"g"),""),s}const Ap=Object.create(null);function uP(s,t){Ap[s]=t}function Cp(s){return Ap[s]||Ap[""]}function N_(s){let t;if(typeof s.resources=="string")t=[s.resources];else if(t=s.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}const z_=Object.create(null),Qo=["https://api.simplesvg.com","https://api.unisvg.com"],ku=[];for(;Qo.length>0;)Qo.length===1||Math.random()>.5?ku.push(Qo.shift()):ku.push(Qo.pop());z_[""]=N_({resources:["https://api.iconify.design"].concat(ku)});function cP(s,t){const e=N_(t);return e===null?!1:(z_[s]=e,!0)}function G_(s){return z_[s]}const dP=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}};let Xy=dP();function fP(s,t){const e=G_(s);if(!e)return 0;let n;if(!e.maxURL)n=0;else{let o=0;e.resources.forEach(d=>{o=Math.max(o,d.length)});const h=t+".json?icons=";n=e.maxURL-o-e.path.length-h.length}return n}function pP(s){return s===404}const _P=(s,t,e)=>{const n=[],o=fP(s,t),h="icons";let d={type:h,provider:s,prefix:t,icons:[]},l=0;return e.forEach((_,m)=>{l+=_.length+1,l>=o&&m>0&&(n.push(d),d={type:h,provider:s,prefix:t,icons:[]},l=_.length),d.icons.push(_)}),n.push(d),n};function gP(s){if(typeof s=="string"){const t=G_(s);if(t)return t.path}return"/"}const mP=(s,t,e)=>{if(!Xy){e("abort",424);return}let n=gP(t.provider);switch(t.type){case"icons":{const h=t.prefix,l=t.icons.join(","),_=new URLSearchParams({icons:l});n+=h+".json?"+_.toString();break}case"custom":{const h=t.uri;n+=h.slice(0,1)==="/"?h.slice(1):h;break}default:e("abort",400);return}let o=503;Xy(s+n).then(h=>{const d=h.status;if(d!==200){setTimeout(()=>{e(pP(d)?"abort":"next",d)});return}return o=501,h.json()}).then(h=>{if(typeof h!="object"||h===null){setTimeout(()=>{h===404?e("abort",h):e("next",o)});return}setTimeout(()=>{e("success",h)})}).catch(()=>{e("next",o)})},yP={prepare:_P,send:mP};function vP(s){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);s.sort((o,h)=>o.provider!==h.provider?o.provider.localeCompare(h.provider):o.prefix!==h.prefix?o.prefix.localeCompare(h.prefix):o.name.localeCompare(h.name));let n={provider:"",prefix:"",name:""};return s.forEach(o=>{if(n.name===o.name&&n.prefix===o.prefix&&n.provider===o.provider)return;n=o;const h=o.provider,d=o.prefix,l=o.name,_=e[h]||(e[h]=Object.create(null)),m=_[d]||(_[d]=To(h,d));let v;l in m.icons?v=t.loaded:d===""||m.missing.has(l)?v=t.missing:v=t.pending;const w={provider:h,prefix:d,name:l};v.push(w)}),t}function Ux(s,t){s.forEach(e=>{const n=e.loaderCallbacks;n&&(e.loaderCallbacks=n.filter(o=>o.id!==t))})}function xP(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;const t=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const n=s.provider,o=s.prefix;t.forEach(h=>{const d=h.icons,l=d.pending.length;d.pending=d.pending.filter(_=>{if(_.prefix!==o)return!0;const m=_.name;if(s.icons[m])d.loaded.push({provider:n,prefix:o,name:m});else if(s.missing.has(m))d.missing.push({provider:n,prefix:o,name:m});else return e=!0,!0;return!1}),d.pending.length!==l&&(e||Ux([s],h.id),h.callback(d.loaded.slice(0),d.missing.slice(0),d.pending.slice(0),h.abort))})}))}let bP=0;function wP(s,t,e){const n=bP++,o=Ux.bind(null,e,n);if(!t.pending.length)return o;const h={id:n,icons:t,callback:s,abort:o};return e.forEach(d=>{(d.loaderCallbacks||(d.loaderCallbacks=[])).push(h)}),o}function SP(s,t=!0,e=!1){const n=[];return s.forEach(o=>{const h=typeof o=="string"?Ic(o,t,e):o;h&&n.push(h)}),n}var EP={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function TP(s,t,e,n){const o=s.resources.length,h=s.random?Math.floor(Math.random()*o):s.index;let d;if(s.random){let C=s.resources.slice(0);for(d=[];C.length>1;){const B=Math.floor(Math.random()*C.length);d.push(C[B]),C=C.slice(0,B).concat(C.slice(B+1))}d=d.concat(C)}else d=s.resources.slice(h).concat(s.resources.slice(0,h));const l=Date.now();let _="pending",m=0,v,w=null,b=[],T=[];typeof n=="function"&&T.push(n);function r(){w&&(clearTimeout(w),w=null)}function a(){_==="pending"&&(_="aborted"),r(),b.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),b=[]}function u(C,B){B&&(T=[]),typeof C=="function"&&T.push(C)}function f(){return{startTime:l,payload:t,status:_,queriesSent:m,queriesPending:b.length,subscribe:u,abort:a}}function g(){_="failed",T.forEach(C=>{C(void 0,v)})}function x(){b.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),b=[]}function S(C,B,R){const M=B!=="success";switch(b=b.filter(N=>N!==C),_){case"pending":break;case"failed":if(M||!s.dataAfterTimeout)return;break;default:return}if(B==="abort"){v=R,g();return}if(M){v=R,b.length||(d.length?A():g());return}if(r(),x(),!s.random){const N=s.resources.indexOf(C.resource);N!==-1&&N!==s.index&&(s.index=N)}_="completed",T.forEach(N=>{N(R)})}function A(){if(_!=="pending")return;r();const C=d.shift();if(C===void 0){if(b.length){w=setTimeout(()=>{r(),_==="pending"&&(x(),g())},s.timeout);return}g();return}const B={status:"pending",resource:C,callback:(R,M)=>{S(B,R,M)}};b.push(B),m++,w=setTimeout(A,s.rotate),e(C,t,B.callback)}return setTimeout(A),f}function Ix(s){const t={...EP,...s};let e=[];function n(){e=e.filter(l=>l().status==="pending")}function o(l,_,m){const v=TP(t,l,_,(w,b)=>{n(),m&&m(w,b)});return e.push(v),v}function h(l){return e.find(_=>l(_))||null}return{query:o,find:h,setIndex:l=>{t.index=l},getIndex:()=>t.index,cleanup:n}}function Yy(){}const gf=Object.create(null);function AP(s){if(!gf[s]){const t=G_(s);if(!t)return;const e=Ix(t),n={config:t,redundancy:e};gf[s]=n}return gf[s]}function CP(s,t,e){let n,o;if(typeof s=="string"){const h=Cp(s);if(!h)return e(void 0,424),Yy;o=h.send;const d=AP(s);d&&(n=d.redundancy)}else{const h=N_(s);if(h){n=Ix(h);const d=s.resources?s.resources[0]:"",l=Cp(d);l&&(o=l.send)}}return!n||!o?(e(void 0,424),Yy):n.query(t,o,e)().abort}function jy(){}function UP(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,xP(s)}))}function IP(s){const t=[],e=[];return s.forEach(n=>{(n.match(xx)?t:e).push(n)}),{valid:t,invalid:e}}function tl(s,t,e){function n(){const o=s.pendingIcons;t.forEach(h=>{o&&o.delete(h),s.icons[h]||s.missing.add(h)})}if(e&&typeof e=="object")try{if(!Ex(s,e).length){n();return}}catch(o){console.error(o)}n(),UP(s)}function qy(s,t){s instanceof Promise?s.then(e=>{t(e)}).catch(()=>{t(null)}):t(s)}function PP(s,t){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(t).sort():s.iconsToLoad=t,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;const{provider:e,prefix:n}=s,o=s.iconsToLoad;if(delete s.iconsToLoad,!o||!o.length)return;const h=s.loadIcon;if(s.loadIcons&&(o.length>1||!h)){qy(s.loadIcons(o,n,e),v=>{tl(s,o,v)});return}if(h){o.forEach(v=>{const w=h(v,n,e);qy(w,b=>{const T=b?{prefix:n,icons:{[v]:b}}:null;tl(s,[v],T)})});return}const{valid:d,invalid:l}=IP(o);if(l.length&&tl(s,l,null),!d.length)return;const _=n.match(xx)?Cp(e):null;if(!_){tl(s,d,null);return}_.prepare(e,n,d).forEach(v=>{CP(e,v,w=>{tl(s,v.icons,w)})})}))}const RP=(s,t)=>{const e=SP(s,!0,Tx()),n=vP(e);if(!n.pending.length){let _=!0;return t&&setTimeout(()=>{_&&t(n.loaded,n.missing,n.pending,jy)}),()=>{_=!1}}const o=Object.create(null),h=[];let d,l;return n.pending.forEach(_=>{const{provider:m,prefix:v}=_;if(v===l&&m===d)return;d=m,l=v,h.push(To(m,v));const w=o[m]||(o[m]=Object.create(null));w[v]||(w[v]=[])}),n.pending.forEach(_=>{const{provider:m,prefix:v,name:w}=_,b=To(m,v),T=b.pendingIcons||(b.pendingIcons=new Set);T.has(w)||(T.add(w),o[m][v].push(w))}),h.forEach(_=>{const m=o[_.provider][_.prefix];m.length&&PP(_,m)}),t?wP(t,n,h):jy};function BP(s,t){const e={...s};for(const n in t){const o=t[n],h=typeof o;n in Ax?(o===null||o&&(h==="string"||h==="number"))&&(e[n]=o):h===typeof e[n]&&(e[n]=n==="rotate"?o%4:o)}return e}const FP=/[\s,]+/;function MP(s,t){t.split(FP).forEach(e=>{switch(e.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}function LP(s,t=0){const e=s.replace(/^-?[0-9.]*/,"");function n(o){for(;o<0;)o+=4;return o%4}if(e===""){const o=parseInt(s);return isNaN(o)?0:n(o)}else if(e!==s){let o=0;switch(e){case"%":o=25;break;case"deg":o=90}if(o){let h=parseFloat(s.slice(0,s.length-e.length));return isNaN(h)?0:(h=h/o,h%1===0?n(h):0)}}return t}function DP(s,t){let e=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const n in t)e+=" "+n+'="'+t[n]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+s+"</svg>"}function kP(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function OP(s){return"data:image/svg+xml,"+kP(s)}function NP(s){return'url("'+OP(s)+'")'}const Ky={...Cx,inline:!1},zP={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},GP={display:"inline-block"},Up={backgroundColor:"currentColor"},Px={backgroundColor:"transparent"},Zy={Image:"var(--svg)",Repeat:"no-repeat",Size:"100% 100%"},Jy={webkitMask:Up,mask:Up,background:Px};for(const s in Jy){const t=Jy[s];for(const e in Zy)t[s+e]=Zy[e]}const Ou={};["horizontal","vertical"].forEach(s=>{const t=s.slice(0,1)+"Flip";Ou[s+"-flip"]=t,Ou[s.slice(0,1)+"-flip"]=t,Ou[s+"Flip"]=t});function Qy(s){return s+(s.match(/^[-0-9.]+$/)?"px":"")}const tv=(s,t)=>{const e=BP(Ky,t),n={...zP},o=t.mode||"svg",h={},d=t.style,l=typeof d=="object"&&!(d instanceof Array)?d:{};for(let a in t){const u=t[a];if(u!==void 0)switch(a){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":e[a]=u===!0||u==="true"||u===1;break;case"flip":typeof u=="string"&&MP(e,u);break;case"color":h.color=u;break;case"rotate":typeof u=="string"?e[a]=LP(u):typeof u=="number"&&(e[a]=u);break;case"ariaHidden":case"aria-hidden":u!==!0&&u!=="true"&&delete n["aria-hidden"];break;default:{const f=Ou[a];f?(u===!0||u==="true"||u===1)&&(e[f]=!0):Ky[a]===void 0&&(n[a]=u)}}}const _=sP(s,e),m=_.attributes;if(e.inline&&(h.verticalAlign="-0.125em"),o==="svg"){n.style={...h,...l},Object.assign(n,m);let a=0,u=t.id;return typeof u=="string"&&(u=u.replace(/-/g,"_")),n.innerHTML=hP(_.body,u?()=>u+"ID"+a++:"iconifyVue"),My("svg",n)}const{body:v,width:w,height:b}=s,T=o==="mask"||(o==="bg"?!1:v.indexOf("currentColor")!==-1),r=DP(v,{...m,width:w+"",height:b+""});return n.style={...h,"--svg":NP(r),width:Qy(m.width),height:Qy(m.height),...GP,...T?Up:Px,...l},My("span",n)};Tx(!0);uP("",yP);if(typeof document<"u"&&typeof window<"u"){const s=window;if(s.IconifyPreload!==void 0){const t=s.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(n=>{try{(typeof n!="object"||n===null||n instanceof Array||typeof n.icons!="object"||typeof n.prefix!="string"||!J2(n))&&console.error(e)}catch{console.error(e)}})}if(s.IconifyProviders!==void 0){const t=s.IconifyProviders;if(typeof t=="object"&&t!==null)for(let e in t){const n="IconifyProviders["+e+"] is invalid.";try{const o=t[e];if(typeof o!="object"||!o||o.resources===void 0)continue;cP(e,o)||console.error(n)}catch{console.error(n)}}}}const HP={...Pc,body:""},ye=hi({inheritAttrs:!1,data(){return{_name:"",_loadingIcon:null,iconMounted:!1,counter:0}},mounted(){this.iconMounted=!0},unmounted(){this.abortLoading()},methods:{abortLoading(){this._loadingIcon&&(this._loadingIcon.abort(),this._loadingIcon=null)},getIcon(s,t,e){if(typeof s=="object"&&s!==null&&typeof s.body=="string")return this._name="",this.abortLoading(),{data:s};let n;if(typeof s!="string"||(n=Ic(s,!1,!0))===null)return this.abortLoading(),null;let o=K2(n);if(!o)return(!this._loadingIcon||this._loadingIcon.name!==s)&&(this.abortLoading(),this._name="",o!==null&&(this._loadingIcon={name:s,abort:RP([n],()=>{this.counter++})})),null;if(this.abortLoading(),this._name!==s&&(this._name=s,t&&t(s)),e){o=Object.assign({},o);const d=e(o.body,n.name,n.prefix,n.provider);typeof d=="string"&&(o.body=d)}const h=["iconify"];return n.prefix!==""&&h.push("iconify--"+n.prefix),n.provider!==""&&h.push("iconify--"+n.provider),{data:o,classes:h}}},render(){this.counter;const s=this.$attrs,t=this.iconMounted||s.ssr?this.getIcon(s.icon,s.onLoad,s.customise):null;if(!t)return tv(HP,s);let e=s;return t.classes&&(e={...s,class:(typeof s.class=="string"?s.class+" ":"")+t.classes.join(" ")}),tv({...Pc,...t.data},e)}});var Ye,Je,bo,ee,Ks,Ur,Pp,Rp,Bp;const ng=class ng{constructor(t,e){Hn(this,Ur);Hn(this,Ye);Hn(this,Je);Hn(this,bo);lf(this,"ready");Hn(this,ee);Hn(this,Ks,{width:0,height:0,duration:1/0});$n(this,Ye,document.createElement("canvas")),$n(this,ee,t),$n(this,bo,e),$n(this,Je,xt(this,Ye).getContext("2d"));const n=xt(this,ee).content.split(`
`),{xPadding:o,yPadding:h}=Es(this,Ur,Pp).call(this);xt(this,Ye).width=Es(this,Ur,Rp).call(this,n)+o*2,xt(this,Ye).height=Es(this,Ur,Bp).call(this,n)+h*2,this.ready=Promise.resolve({width:xt(this,Ye).width,height:xt(this,Ye).height,duration:1/0}),xt(this,Je).font=`${xt(this,ee).fontSize}px ${xt(this,ee).fontFamily}`}get textConfig(){return xt(this,ee)}set textConfig(t){$n(this,ee,t)}get meta(){return xt(this,Ks)}set meta(t){$n(this,Ks,t)}async tick(t){const e=xt(this,ee).content.split(`
`),{xPadding:n,yPadding:o}=Es(this,Ur,Pp).call(this),h=Es(this,Ur,Rp).call(this,e),d=Es(this,Ur,Bp).call(this,e);xt(this,Ye).width=h+n*2,xt(this,Ye).height=d+o*2,xt(this,Ks).width=xt(this,Ye).width,xt(this,Ks).height=xt(this,Ye).height,xt(this,bo).call(this,h+n*2,d+o*2),xt(this,Je).clearRect(0,0,xt(this,Ye).width,xt(this,Ye).height),xt(this,Je).fillStyle=xt(this,ee).color,xt(this,Je).font=`${xt(this,ee).bold?"bold":""} ${xt(this,ee).italic?"italic":""} ${xt(this,ee).fontSize}px ${xt(this,ee).fontFamily}`,xt(this,Je).textBaseline="hanging",xt(this,ee).showShadow&&(xt(this,Je).shadowColor=xt(this,ee).shadowColor,xt(this,Je).shadowBlur=xt(this,ee).shadowBlur,xt(this,Je).shadowOffsetX=xt(this,ee).shadowOffsetX,xt(this,Je).shadowOffsetY=xt(this,ee).shadowOffsetY);let l=0,_=0;for(let m=0;m<e.length;m++){let v=xt(this,ee).fontSize*e[m].length+xt(this,ee).letterSpacing*(e[m].length-1);switch(xt(this,ee).align){case"left":l=0;break;case"center":l=(xt(this,Ye).width-v)/2;break;case"right":l=xt(this,Ye).width-v;break}for(let w=0;w<e[m].length;w++)xt(this,ee).showStroke&&(xt(this,Je).lineJoin="round",xt(this,Je).strokeStyle=xt(this,ee).strokeColor,xt(this,Je).lineWidth=xt(this,ee).strokeWidth,xt(this,Je).strokeText(e[m][w],l+w*xt(this,ee).fontSize+xt(this,ee).letterSpacing*w,m*xt(this,ee).fontSize+xt(this,ee).lineSpacing*m+_)),xt(this,Je).fillText(e[m][w],w*xt(this,ee).fontSize+xt(this,ee).letterSpacing*w+l,m*xt(this,ee).fontSize+xt(this,ee).lineSpacing*m+_)}return{state:"success",video:new VideoFrame(xt(this,Ye),{timestamp:t})}}async generateImage(){const{video:t}=await this.tick(0),e=new OffscreenCanvas(t.codedWidth,t.codedHeight);e.getContext("2d").drawImage(t,0,0,t.codedWidth,t.codedHeight);const o=await e.convertToBlob(),h=document.createElement("a");h.href=URL.createObjectURL(o),h.download="text.png",h.click()}async clone(){return new ng(xt(this,ee),xt(this,bo))}destroy(){xt(this,Ye).remove()}};Ye=new WeakMap,Je=new WeakMap,bo=new WeakMap,ee=new WeakMap,Ks=new WeakMap,Ur=new WeakSet,Pp=function(){let t=0,e=0;const n=xt(this,ee);return t=Math.max(n.showStroke?n.strokeWidth:0,n.showShadow?Math.max(n.shadowBlur,n.shadowOffsetX):0),e=Math.max(n.showStroke?n.strokeWidth:0,n.showShadow?Math.max(n.shadowBlur,n.shadowOffsetY):0),{xPadding:t,yPadding:e}},Rp=function(t){return Math.max(...t.map(e=>xt(this,ee).fontSize*e.length+xt(this,ee).letterSpacing*(e.length-1)))},Bp=function(t){return xt(this,ee).fontSize*t.length+xt(this,ee).lineSpacing*(t.length-1)};let Ip=ng;var wo;const sg=class sg{constructor(t){lf(this,"ready");Hn(this,wo,{width:0,height:0,duration:0});this.ready=Promise.resolve({width:0,height:0,duration:t})}get meta(){return xt(this,wo)}set meta(t){$n(this,wo,t)}async tick(t){return{state:"success"}}async clone(){return new sg(xt(this,wo).duration)}destroy(){}};wo=new WeakMap;let Fp=sg;var aa=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(aa||{}),Rx=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(Rx||{}),Mp=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(Mp||{}),Vt=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(Vt||{}),Kr=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(Kr||{}),ft=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(ft||{}),fo=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(fo||{}),Bt=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(Bt||{}),bt=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(bt||{}),En=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(En||{}),os=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(os||{}),Qr=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(Qr||{}),Ri=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Ri||{}),Yr=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(Yr||{}),H_=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(H_||{}),nr=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(nr||{}),qe=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(qe||{}),Ge=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(Ge||{}),Zr=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(Zr||{});const $P={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},wt={ADAPTER:$P,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var mf=/iPhone/i,ev=/iPod/i,iv=/iPad/i,rv=/\biOS-universal(?:.+)Mac\b/i,yf=/\bAndroid(?:.+)Mobile\b/i,nv=/Android/i,Aa=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,kh=/Silk/i,dn=/Windows Phone/i,sv=/\bWindows(?:.+)ARM\b/i,av=/BlackBerry/i,ov=/BB10/i,lv=/Opera Mini/i,hv=/\b(CriOS|Chrome)(?:.+)Mobile/i,uv=/Mobile(?:.+)Firefox\b/i,cv=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function VP(s){return function(t){return t.test(s)}}function dv(s){var t={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?t.userAgent=s:s&&s.userAgent&&(t={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var e=t.userAgent,n=e.split("[FBAN");typeof n[1]<"u"&&(e=n[0]),n=e.split("Twitter"),typeof n[1]<"u"&&(e=n[0]);var o=VP(e),h={apple:{phone:o(mf)&&!o(dn),ipod:o(ev),tablet:!o(mf)&&(o(iv)||cv(t))&&!o(dn),universal:o(rv),device:(o(mf)||o(ev)||o(iv)||o(rv)||cv(t))&&!o(dn)},amazon:{phone:o(Aa),tablet:!o(Aa)&&o(kh),device:o(Aa)||o(kh)},android:{phone:!o(dn)&&o(Aa)||!o(dn)&&o(yf),tablet:!o(dn)&&!o(Aa)&&!o(yf)&&(o(kh)||o(nv)),device:!o(dn)&&(o(Aa)||o(kh)||o(yf)||o(nv))||o(/\bokhttp\b/i)},windows:{phone:o(dn),tablet:o(sv),device:o(dn)||o(sv)},other:{blackberry:o(av),blackberry10:o(ov),opera:o(lv),firefox:o(uv),chrome:o(hv),device:o(av)||o(ov)||o(lv)||o(uv)||o(hv)},any:!1,phone:!1,tablet:!1};return h.any=h.apple.device||h.android.device||h.windows.device||h.other.device,h.phone=h.apple.phone||h.android.phone||h.windows.phone,h.tablet=h.apple.tablet||h.android.tablet||h.windows.tablet,h}const WP=dv.default??dv,Tn=WP(globalThis.navigator);wt.RETINA_PREFIX=/@([0-9\.]+)x/;wt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Bx={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function o(_,m,v){this.fn=_,this.context=m,this.once=v||!1}function h(_,m,v,w,b){if(typeof v!="function")throw new TypeError("The listener must be a function");var T=new o(v,w||_,b),r=e?e+m:m;return _._events[r]?_._events[r].fn?_._events[r]=[_._events[r],T]:_._events[r].push(T):(_._events[r]=T,_._eventsCount++),_}function d(_,m){--_._eventsCount===0?_._events=new n:delete _._events[m]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var m=[],v,w;if(this._eventsCount===0)return m;for(w in v=this._events)t.call(v,w)&&m.push(e?w.slice(1):w);return Object.getOwnPropertySymbols?m.concat(Object.getOwnPropertySymbols(v)):m},l.prototype.listeners=function(m){var v=e?e+m:m,w=this._events[v];if(!w)return[];if(w.fn)return[w.fn];for(var b=0,T=w.length,r=new Array(T);b<T;b++)r[b]=w[b].fn;return r},l.prototype.listenerCount=function(m){var v=e?e+m:m,w=this._events[v];return w?w.fn?1:w.length:0},l.prototype.emit=function(m,v,w,b,T,r){var a=e?e+m:m;if(!this._events[a])return!1;var u=this._events[a],f=arguments.length,g,x;if(u.fn){switch(u.once&&this.removeListener(m,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,v),!0;case 3:return u.fn.call(u.context,v,w),!0;case 4:return u.fn.call(u.context,v,w,b),!0;case 5:return u.fn.call(u.context,v,w,b,T),!0;case 6:return u.fn.call(u.context,v,w,b,T,r),!0}for(x=1,g=new Array(f-1);x<f;x++)g[x-1]=arguments[x];u.fn.apply(u.context,g)}else{var S=u.length,A;for(x=0;x<S;x++)switch(u[x].once&&this.removeListener(m,u[x].fn,void 0,!0),f){case 1:u[x].fn.call(u[x].context);break;case 2:u[x].fn.call(u[x].context,v);break;case 3:u[x].fn.call(u[x].context,v,w);break;case 4:u[x].fn.call(u[x].context,v,w,b);break;default:if(!g)for(A=1,g=new Array(f-1);A<f;A++)g[A-1]=arguments[A];u[x].fn.apply(u[x].context,g)}}return!0},l.prototype.on=function(m,v,w){return h(this,m,v,w,!1)},l.prototype.once=function(m,v,w){return h(this,m,v,w,!0)},l.prototype.removeListener=function(m,v,w,b){var T=e?e+m:m;if(!this._events[T])return this;if(!v)return d(this,T),this;var r=this._events[T];if(r.fn)r.fn===v&&(!b||r.once)&&(!w||r.context===w)&&d(this,T);else{for(var a=0,u=[],f=r.length;a<f;a++)(r[a].fn!==v||b&&!r[a].once||w&&r[a].context!==w)&&u.push(r[a]);u.length?this._events[T]=u.length===1?u[0]:u:d(this,T)}return this},l.prototype.removeAllListeners=function(m){var v;return m?(v=e?e+m:m,this._events[v]&&d(this,v)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=e,l.EventEmitter=l,s.exports=l})(Bx);var XP=Bx.exports;const Gl=Cc(XP);var $_={exports:{}};$_.exports=Rc;$_.exports.default=Rc;function Rc(s,t,e){e=e||2;var n=t&&t.length,o=n?t[0]*e:s.length,h=Fx(s,0,o,e,!0),d=[];if(!h||h.next===h.prev)return d;var l,_,m,v,w,b,T;if(n&&(h=ZP(s,t,h,e)),s.length>80*e){l=m=s[0],_=v=s[1];for(var r=e;r<o;r+=e)w=s[r],b=s[r+1],w<l&&(l=w),b<_&&(_=b),w>m&&(m=w),b>v&&(v=b);T=Math.max(m-l,v-_),T=T!==0?32767/T:0}return Fl(h,d,e,l,_,T,0),d}function Fx(s,t,e,n,o){var h,d;if(o===kp(s,t,e,n)>0)for(h=t;h<e;h+=n)d=fv(h,s[h],s[h+1],d);else for(h=e-n;h>=t;h-=n)d=fv(h,s[h],s[h+1],d);return d&&Bc(d,d.next)&&(Ll(d),d=d.next),d}function ia(s,t){if(!s)return s;t||(t=s);var e=s,n;do if(n=!1,!e.steiner&&(Bc(e,e.next)||Pe(e.prev,e,e.next)===0)){if(Ll(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Fl(s,t,e,n,o,h,d){if(s){!d&&h&&iR(s,n,o,h);for(var l=s,_,m;s.prev!==s.next;){if(_=s.prev,m=s.next,h?jP(s,n,o,h):YP(s)){t.push(_.i/e|0),t.push(s.i/e|0),t.push(m.i/e|0),Ll(s),s=m.next,l=m.next;continue}if(s=m,s===l){d?d===1?(s=qP(ia(s),t,e),Fl(s,t,e,n,o,h,2)):d===2&&KP(s,t,e,n,o,h):Fl(ia(s),t,e,n,o,h,1);break}}}}function YP(s){var t=s.prev,e=s,n=s.next;if(Pe(t,e,n)>=0)return!1;for(var o=t.x,h=e.x,d=n.x,l=t.y,_=e.y,m=n.y,v=o<h?o<d?o:d:h<d?h:d,w=l<_?l<m?l:m:_<m?_:m,b=o>h?o>d?o:d:h>d?h:d,T=l>_?l>m?l:m:_>m?_:m,r=n.next;r!==t;){if(r.x>=v&&r.x<=b&&r.y>=w&&r.y<=T&&lo(o,l,h,_,d,m,r.x,r.y)&&Pe(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function jP(s,t,e,n){var o=s.prev,h=s,d=s.next;if(Pe(o,h,d)>=0)return!1;for(var l=o.x,_=h.x,m=d.x,v=o.y,w=h.y,b=d.y,T=l<_?l<m?l:m:_<m?_:m,r=v<w?v<b?v:b:w<b?w:b,a=l>_?l>m?l:m:_>m?_:m,u=v>w?v>b?v:b:w>b?w:b,f=Lp(T,r,t,e,n),g=Lp(a,u,t,e,n),x=s.prevZ,S=s.nextZ;x&&x.z>=f&&S&&S.z<=g;){if(x.x>=T&&x.x<=a&&x.y>=r&&x.y<=u&&x!==o&&x!==d&&lo(l,v,_,w,m,b,x.x,x.y)&&Pe(x.prev,x,x.next)>=0||(x=x.prevZ,S.x>=T&&S.x<=a&&S.y>=r&&S.y<=u&&S!==o&&S!==d&&lo(l,v,_,w,m,b,S.x,S.y)&&Pe(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;x&&x.z>=f;){if(x.x>=T&&x.x<=a&&x.y>=r&&x.y<=u&&x!==o&&x!==d&&lo(l,v,_,w,m,b,x.x,x.y)&&Pe(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;S&&S.z<=g;){if(S.x>=T&&S.x<=a&&S.y>=r&&S.y<=u&&S!==o&&S!==d&&lo(l,v,_,w,m,b,S.x,S.y)&&Pe(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function qP(s,t,e){var n=s;do{var o=n.prev,h=n.next.next;!Bc(o,h)&&Mx(o,n,n.next,h)&&Ml(o,h)&&Ml(h,o)&&(t.push(o.i/e|0),t.push(n.i/e|0),t.push(h.i/e|0),Ll(n),Ll(n.next),n=s=h),n=n.next}while(n!==s);return ia(n)}function KP(s,t,e,n,o,h){var d=s;do{for(var l=d.next.next;l!==d.prev;){if(d.i!==l.i&&sR(d,l)){var _=Lx(d,l);d=ia(d,d.next),_=ia(_,_.next),Fl(d,t,e,n,o,h,0),Fl(_,t,e,n,o,h,0);return}l=l.next}d=d.next}while(d!==s)}function ZP(s,t,e,n){var o=[],h,d,l,_,m;for(h=0,d=t.length;h<d;h++)l=t[h]*n,_=h<d-1?t[h+1]*n:s.length,m=Fx(s,l,_,n,!1),m===m.next&&(m.steiner=!0),o.push(nR(m));for(o.sort(JP),h=0;h<o.length;h++)e=QP(o[h],e);return e}function JP(s,t){return s.x-t.x}function QP(s,t){var e=tR(s,t);if(!e)return t;var n=Lx(e,s);return ia(n,n.next),ia(e,e.next)}function tR(s,t){var e=t,n=s.x,o=s.y,h=-1/0,d;do{if(o<=e.y&&o>=e.next.y&&e.next.y!==e.y){var l=e.x+(o-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(l<=n&&l>h&&(h=l,d=e.x<e.next.x?e:e.next,l===n))return d}e=e.next}while(e!==t);if(!d)return null;var _=d,m=d.x,v=d.y,w=1/0,b;e=d;do n>=e.x&&e.x>=m&&n!==e.x&&lo(o<v?n:h,o,m,v,o<v?h:n,o,e.x,e.y)&&(b=Math.abs(o-e.y)/(n-e.x),Ml(e,s)&&(b<w||b===w&&(e.x>d.x||e.x===d.x&&eR(d,e)))&&(d=e,w=b)),e=e.next;while(e!==_);return d}function eR(s,t){return Pe(s.prev,s,t.prev)<0&&Pe(t.next,s,s.next)<0}function iR(s,t,e,n){var o=s;do o.z===0&&(o.z=Lp(o.x,o.y,t,e,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==s);o.prevZ.nextZ=null,o.prevZ=null,rR(o)}function rR(s){var t,e,n,o,h,d,l,_,m=1;do{for(e=s,s=null,h=null,d=0;e;){for(d++,n=e,l=0,t=0;t<m&&(l++,n=n.nextZ,!!n);t++);for(_=m;l>0||_>0&&n;)l!==0&&(_===0||!n||e.z<=n.z)?(o=e,e=e.nextZ,l--):(o=n,n=n.nextZ,_--),h?h.nextZ=o:s=o,o.prevZ=h,h=o;e=n}h.nextZ=null,m*=2}while(d>1);return s}function Lp(s,t,e,n,o){return s=(s-e)*o|0,t=(t-n)*o|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function nR(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function lo(s,t,e,n,o,h,d,l){return(o-d)*(t-l)>=(s-d)*(h-l)&&(s-d)*(n-l)>=(e-d)*(t-l)&&(e-d)*(h-l)>=(o-d)*(n-l)}function sR(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!aR(s,t)&&(Ml(s,t)&&Ml(t,s)&&oR(s,t)&&(Pe(s.prev,s,t.prev)||Pe(s,t.prev,t))||Bc(s,t)&&Pe(s.prev,s,s.next)>0&&Pe(t.prev,t,t.next)>0)}function Pe(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Bc(s,t){return s.x===t.x&&s.y===t.y}function Mx(s,t,e,n){var o=Nh(Pe(s,t,e)),h=Nh(Pe(s,t,n)),d=Nh(Pe(e,n,s)),l=Nh(Pe(e,n,t));return!!(o!==h&&d!==l||o===0&&Oh(s,e,t)||h===0&&Oh(s,n,t)||d===0&&Oh(e,s,n)||l===0&&Oh(e,t,n))}function Oh(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function Nh(s){return s>0?1:s<0?-1:0}function aR(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Mx(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Ml(s,t){return Pe(s.prev,s,s.next)<0?Pe(s,t,s.next)>=0&&Pe(s,s.prev,t)>=0:Pe(s,t,s.prev)<0||Pe(s,s.next,t)<0}function oR(s,t){var e=s,n=!1,o=(s.x+t.x)/2,h=(s.y+t.y)/2;do e.y>h!=e.next.y>h&&e.next.y!==e.y&&o<(e.next.x-e.x)*(h-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==s);return n}function Lx(s,t){var e=new Dp(s.i,s.x,s.y),n=new Dp(t.i,t.x,t.y),o=s.next,h=t.prev;return s.next=t,t.prev=s,e.next=o,o.prev=e,n.next=e,e.prev=n,h.next=n,n.prev=h,n}function fv(s,t,e,n){var o=new Dp(s,t,e);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Ll(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Dp(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Rc.deviation=function(s,t,e,n){var o=t&&t.length,h=o?t[0]*e:s.length,d=Math.abs(kp(s,0,h,e));if(o)for(var l=0,_=t.length;l<_;l++){var m=t[l]*e,v=l<_-1?t[l+1]*e:s.length;d-=Math.abs(kp(s,m,v,e))}var w=0;for(l=0;l<n.length;l+=3){var b=n[l]*e,T=n[l+1]*e,r=n[l+2]*e;w+=Math.abs((s[b]-s[r])*(s[T+1]-s[b+1])-(s[b]-s[T])*(s[r+1]-s[b+1]))}return d===0&&w===0?0:Math.abs((w-d)/d)};function kp(s,t,e,n){for(var o=0,h=t,d=e-n;h<e;h+=n)o+=(s[d]-s[h])*(s[h+1]+s[d+1]),d=h;return o}Rc.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,o=0;o<s.length;o++){for(var h=0;h<s[o].length;h++)for(var d=0;d<t;d++)e.vertices.push(s[o][h][d]);o>0&&(n+=s[o-1].length,e.holes.push(n))}return e};var lR=$_.exports;const hR=Cc(lR);var oc={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */oc.exports;(function(s,t){(function(e){var n=t&&!t.nodeType&&t,o=!s.nodeType&&s,h=typeof qr=="object"&&qr;(h.global===h||h.window===h||h.self===h)&&(e=h);var d,l=2147483647,_=36,m=1,v=26,w=38,b=700,T=72,r=128,a="-",u=/^xn--/,f=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=_-m,A=Math.floor,C=String.fromCharCode,B;function R(rt){throw new RangeError(x[rt])}function M(rt,Z){for(var H=rt.length,G=[];H--;)G[H]=Z(rt[H]);return G}function N(rt,Z){var H=rt.split("@"),G="";H.length>1&&(G=H[0]+"@",rt=H[1]),rt=rt.replace(g,".");var at=rt.split("."),vt=M(at,Z).join(".");return G+vt}function L(rt){for(var Z=[],H=0,G=rt.length,at,vt;H<G;)at=rt.charCodeAt(H++),at>=55296&&at<=56319&&H<G?(vt=rt.charCodeAt(H++),(vt&64512)==56320?Z.push(((at&1023)<<10)+(vt&1023)+65536):(Z.push(at),H--)):Z.push(at);return Z}function W(rt){return M(rt,function(Z){var H="";return Z>65535&&(Z-=65536,H+=C(Z>>>10&1023|55296),Z=56320|Z&1023),H+=C(Z),H}).join("")}function k(rt){return rt-48<10?rt-22:rt-65<26?rt-65:rt-97<26?rt-97:_}function j(rt,Z){return rt+22+75*(rt<26)-((Z!=0)<<5)}function Y(rt,Z,H){var G=0;for(rt=H?A(rt/b):rt>>1,rt+=A(rt/Z);rt>S*v>>1;G+=_)rt=A(rt/S);return A(G+(S+1)*rt/(rt+w))}function ut(rt){var Z=[],H=rt.length,G,at=0,vt=r,At=T,kt,ht,q,nt,dt,Xt,Ot,Nt,Lt;for(kt=rt.lastIndexOf(a),kt<0&&(kt=0),ht=0;ht<kt;++ht)rt.charCodeAt(ht)>=128&&R("not-basic"),Z.push(rt.charCodeAt(ht));for(q=kt>0?kt+1:0;q<H;){for(nt=at,dt=1,Xt=_;q>=H&&R("invalid-input"),Ot=k(rt.charCodeAt(q++)),(Ot>=_||Ot>A((l-at)/dt))&&R("overflow"),at+=Ot*dt,Nt=Xt<=At?m:Xt>=At+v?v:Xt-At,!(Ot<Nt);Xt+=_)Lt=_-Nt,dt>A(l/Lt)&&R("overflow"),dt*=Lt;G=Z.length+1,At=Y(at-nt,G,nt==0),A(at/G)>l-vt&&R("overflow"),vt+=A(at/G),at%=G,Z.splice(at++,0,vt)}return W(Z)}function it(rt){var Z,H,G,at,vt,At,kt,ht,q,nt,dt,Xt=[],Ot,Nt,Lt,ce;for(rt=L(rt),Ot=rt.length,Z=r,H=0,vt=T,At=0;At<Ot;++At)dt=rt[At],dt<128&&Xt.push(C(dt));for(G=at=Xt.length,at&&Xt.push(a);G<Ot;){for(kt=l,At=0;At<Ot;++At)dt=rt[At],dt>=Z&&dt<kt&&(kt=dt);for(Nt=G+1,kt-Z>A((l-H)/Nt)&&R("overflow"),H+=(kt-Z)*Nt,Z=kt,At=0;At<Ot;++At)if(dt=rt[At],dt<Z&&++H>l&&R("overflow"),dt==Z){for(ht=H,q=_;nt=q<=vt?m:q>=vt+v?v:q-vt,!(ht<nt);q+=_)ce=ht-nt,Lt=_-nt,Xt.push(C(j(nt+ce%Lt,0))),ht=A(ce/Lt);Xt.push(C(j(ht,0))),vt=Y(H,Nt,G==at),H=0,++G}++H,++Z}return Xt.join("")}function gt(rt){return N(rt,function(Z){return u.test(Z)?ut(Z.slice(4).toLowerCase()):Z})}function Q(rt){return N(rt,function(Z){return f.test(Z)?"xn--"+it(Z):Z})}if(d={version:"1.4.1",ucs2:{decode:L,encode:W},decode:ut,encode:it,toASCII:Q,toUnicode:gt},n&&o)if(s.exports==n)o.exports=d;else for(B in d)d.hasOwnProperty(B)&&(n[B]=d[B]);else e.punycode=d})(qr)})(oc,oc.exports);var uR=oc.exports,Po=TypeError;const cR={},dR=Object.freeze(Object.defineProperty({__proto__:null,default:cR},Symbol.toStringTag,{value:"Module"})),fR=ZU(dR);var V_=typeof Map=="function"&&Map.prototype,vf=Object.getOwnPropertyDescriptor&&V_?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,lc=V_&&vf&&typeof vf.get=="function"?vf.get:null,pv=V_&&Map.prototype.forEach,W_=typeof Set=="function"&&Set.prototype,xf=Object.getOwnPropertyDescriptor&&W_?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,hc=W_&&xf&&typeof xf.get=="function"?xf.get:null,_v=W_&&Set.prototype.forEach,pR=typeof WeakMap=="function"&&WeakMap.prototype,Tl=pR?WeakMap.prototype.has:null,_R=typeof WeakSet=="function"&&WeakSet.prototype,Al=_R?WeakSet.prototype.has:null,gR=typeof WeakRef=="function"&&WeakRef.prototype,gv=gR?WeakRef.prototype.deref:null,mR=Boolean.prototype.valueOf,yR=Object.prototype.toString,vR=Function.prototype.toString,xR=String.prototype.match,X_=String.prototype.slice,rs=String.prototype.replace,bR=String.prototype.toUpperCase,mv=String.prototype.toLowerCase,Dx=RegExp.prototype.test,yv=Array.prototype.concat,jr=Array.prototype.join,wR=Array.prototype.slice,vv=Math.floor,Op=typeof BigInt=="function"?BigInt.prototype.valueOf:null,bf=Object.getOwnPropertySymbols,Np=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="object",_i=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ao||!0)?Symbol.toStringTag:null,kx=Object.prototype.propertyIsEnumerable,xv=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(s){return s.__proto__}:null);function bv(s,t){if(s===1/0||s===-1/0||s!==s||s&&s>-1e3&&s<1e3||Dx.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof s=="number"){var n=s<0?-vv(-s):vv(s);if(n!==s){var o=String(n),h=X_.call(t,o.length+1);return rs.call(o,e,"$&_")+"."+rs.call(rs.call(h,/([0-9]{3})/g,"$&_"),/_$/,"")}}return rs.call(t,e,"$&_")}var zp=fR,wv=zp.custom,Sv=zx(wv)?wv:null,Ox={__proto__:null,double:'"',single:"'"},SR={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Fc=function s(t,e,n,o){var h=e||{};if(wn(h,"quoteStyle")&&!wn(Ox,h.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(wn(h,"maxStringLength")&&(typeof h.maxStringLength=="number"?h.maxStringLength<0&&h.maxStringLength!==1/0:h.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var d=wn(h,"customInspect")?h.customInspect:!0;if(typeof d!="boolean"&&d!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(wn(h,"indent")&&h.indent!==null&&h.indent!=="	"&&!(parseInt(h.indent,10)===h.indent&&h.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(wn(h,"numericSeparator")&&typeof h.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=h.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Hx(t,h);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var _=String(t);return l?bv(t,_):_}if(typeof t=="bigint"){var m=String(t)+"n";return l?bv(t,m):m}var v=typeof h.depth>"u"?5:h.depth;if(typeof n>"u"&&(n=0),n>=v&&v>0&&typeof t=="object")return Gp(t)?"[Array]":"[Object]";var w=GR(h,n);if(typeof o>"u")o=[];else if(Gx(o,t)>=0)return"[Circular]";function b(k,j,Y){if(j&&(o=wR.call(o),o.push(j)),Y){var ut={depth:h.depth};return wn(h,"quoteStyle")&&(ut.quoteStyle=h.quoteStyle),s(k,ut,n+1,o)}return s(k,h,n+1,o)}if(typeof t=="function"&&!Ev(t)){var T=BR(t),r=zh(t,b);return"[Function"+(T?": "+T:" (anonymous)")+"]"+(r.length>0?" { "+jr.call(r,", ")+" }":"")}if(zx(t)){var a=Ao?rs.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Np.call(t);return typeof t=="object"&&!Ao?el(a):a}if(OR(t)){for(var u="<"+mv.call(String(t.nodeName)),f=t.attributes||[],g=0;g<f.length;g++)u+=" "+f[g].name+"="+Nx(ER(f[g].value),"double",h);return u+=">",t.childNodes&&t.childNodes.length&&(u+="..."),u+="</"+mv.call(String(t.nodeName))+">",u}if(Gp(t)){if(t.length===0)return"[]";var x=zh(t,b);return w&&!zR(x)?"["+Hp(x,w)+"]":"[ "+jr.call(x,", ")+" ]"}if(AR(t)){var S=zh(t,b);return!("cause"in Error.prototype)&&"cause"in t&&!kx.call(t,"cause")?"{ ["+String(t)+"] "+jr.call(yv.call("[cause]: "+b(t.cause),S),", ")+" }":S.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+jr.call(S,", ")+" }"}if(typeof t=="object"&&d){if(Sv&&typeof t[Sv]=="function"&&zp)return zp(t,{depth:v-n});if(d!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(FR(t)){var A=[];return pv&&pv.call(t,function(k,j){A.push(b(j,t,!0)+" => "+b(k,t))}),Tv("Map",lc.call(t),A,w)}if(DR(t)){var C=[];return _v&&_v.call(t,function(k){C.push(b(k,t))}),Tv("Set",hc.call(t),C,w)}if(MR(t))return wf("WeakMap");if(kR(t))return wf("WeakSet");if(LR(t))return wf("WeakRef");if(UR(t))return el(b(Number(t)));if(PR(t))return el(b(Op.call(t)));if(IR(t))return el(mR.call(t));if(CR(t))return el(b(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof qr<"u"&&t===qr)return"{ [object globalThis] }";if(!TR(t)&&!Ev(t)){var B=zh(t,b),R=xv?xv(t)===Object.prototype:t instanceof Object||t.constructor===Object,M=t instanceof Object?"":"null prototype",N=!R&&_i&&Object(t)===t&&_i in t?X_.call(cs(t),8,-1):M?"Object":"",L=R||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",W=L+(N||M?"["+jr.call(yv.call([],N||[],M||[]),": ")+"] ":"");return B.length===0?W+"{}":w?W+"{"+Hp(B,w)+"}":W+"{ "+jr.call(B,", ")+" }"}return String(t)};function Nx(s,t,e){var n=e.quoteStyle||t,o=Ox[n];return o+s+o}function ER(s){return rs.call(String(s),/"/g,"&quot;")}function Gp(s){return cs(s)==="[object Array]"&&(!_i||!(typeof s=="object"&&_i in s))}function TR(s){return cs(s)==="[object Date]"&&(!_i||!(typeof s=="object"&&_i in s))}function Ev(s){return cs(s)==="[object RegExp]"&&(!_i||!(typeof s=="object"&&_i in s))}function AR(s){return cs(s)==="[object Error]"&&(!_i||!(typeof s=="object"&&_i in s))}function CR(s){return cs(s)==="[object String]"&&(!_i||!(typeof s=="object"&&_i in s))}function UR(s){return cs(s)==="[object Number]"&&(!_i||!(typeof s=="object"&&_i in s))}function IR(s){return cs(s)==="[object Boolean]"&&(!_i||!(typeof s=="object"&&_i in s))}function zx(s){if(Ao)return s&&typeof s=="object"&&s instanceof Symbol;if(typeof s=="symbol")return!0;if(!s||typeof s!="object"||!Np)return!1;try{return Np.call(s),!0}catch{}return!1}function PR(s){if(!s||typeof s!="object"||!Op)return!1;try{return Op.call(s),!0}catch{}return!1}var RR=Object.prototype.hasOwnProperty||function(s){return s in this};function wn(s,t){return RR.call(s,t)}function cs(s){return yR.call(s)}function BR(s){if(s.name)return s.name;var t=xR.call(vR.call(s),/^function\s*([\w$]+)/);return t?t[1]:null}function Gx(s,t){if(s.indexOf)return s.indexOf(t);for(var e=0,n=s.length;e<n;e++)if(s[e]===t)return e;return-1}function FR(s){if(!lc||!s||typeof s!="object")return!1;try{lc.call(s);try{hc.call(s)}catch{return!0}return s instanceof Map}catch{}return!1}function MR(s){if(!Tl||!s||typeof s!="object")return!1;try{Tl.call(s,Tl);try{Al.call(s,Al)}catch{return!0}return s instanceof WeakMap}catch{}return!1}function LR(s){if(!gv||!s||typeof s!="object")return!1;try{return gv.call(s),!0}catch{}return!1}function DR(s){if(!hc||!s||typeof s!="object")return!1;try{hc.call(s);try{lc.call(s)}catch{return!0}return s instanceof Set}catch{}return!1}function kR(s){if(!Al||!s||typeof s!="object")return!1;try{Al.call(s,Al);try{Tl.call(s,Tl)}catch{return!0}return s instanceof WeakSet}catch{}return!1}function OR(s){return!s||typeof s!="object"?!1:typeof HTMLElement<"u"&&s instanceof HTMLElement?!0:typeof s.nodeName=="string"&&typeof s.getAttribute=="function"}function Hx(s,t){if(s.length>t.maxStringLength){var e=s.length-t.maxStringLength,n="... "+e+" more character"+(e>1?"s":"");return Hx(X_.call(s,0,t.maxStringLength),t)+n}var o=SR[t.quoteStyle||"single"];o.lastIndex=0;var h=rs.call(rs.call(s,o,"\\$1"),/[\x00-\x1f]/g,NR);return Nx(h,"single",t)}function NR(s){var t=s.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+bR.call(t.toString(16))}function el(s){return"Object("+s+")"}function wf(s){return s+" { ? }"}function Tv(s,t,e,n){var o=n?Hp(e,n):jr.call(e,", ");return s+" ("+t+") {"+o+"}"}function zR(s){for(var t=0;t<s.length;t++)if(Gx(s[t],`
`)>=0)return!1;return!0}function GR(s,t){var e;if(s.indent==="	")e="	";else if(typeof s.indent=="number"&&s.indent>0)e=jr.call(Array(s.indent+1)," ");else return null;return{base:e,prev:jr.call(Array(t+1),e)}}function Hp(s,t){if(s.length===0)return"";var e=`
`+t.prev+t.base;return e+jr.call(s,","+e)+`
`+t.prev}function zh(s,t){var e=Gp(s),n=[];if(e){n.length=s.length;for(var o=0;o<s.length;o++)n[o]=wn(s,o)?t(s[o],s):""}var h=typeof bf=="function"?bf(s):[],d;if(Ao){d={};for(var l=0;l<h.length;l++)d["$"+h[l]]=h[l]}for(var _ in s)wn(s,_)&&(e&&String(Number(_))===_&&_<s.length||Ao&&d["$"+_]instanceof Symbol||(Dx.call(/[^\w$]/,_)?n.push(t(_,s)+": "+t(s[_],s)):n.push(_+": "+t(s[_],s))));if(typeof bf=="function")for(var m=0;m<h.length;m++)kx.call(s,h[m])&&n.push("["+t(h[m])+"]: "+t(s[h[m]],s));return n}var HR=Fc,$R=Po,Mc=function(s,t,e){for(var n=s,o;(o=n.next)!=null;n=o)if(o.key===t)return n.next=o.next,e||(o.next=s.next,s.next=o),o},VR=function(s,t){if(s){var e=Mc(s,t);return e&&e.value}},WR=function(s,t,e){var n=Mc(s,t);n?n.value=e:s.next={key:t,next:s.next,value:e}},XR=function(s,t){return s?!!Mc(s,t):!1},YR=function(s,t){if(s)return Mc(s,t,!0)},jR=function(){var t,e={assert:function(n){if(!e.has(n))throw new $R("Side channel does not contain "+HR(n))},delete:function(n){var o=t&&t.next,h=YR(t,n);return h&&o&&o===h&&(t=void 0),!!h},get:function(n){return VR(t,n)},has:function(n){return XR(t,n)},set:function(n,o){t||(t={next:void 0}),WR(t,n,o)}};return e},$x=Object,qR=Error,KR=EvalError,ZR=RangeError,JR=ReferenceError,QR=SyntaxError,tB=URIError,eB=Math.abs,iB=Math.floor,rB=Math.max,nB=Math.min,sB=Math.pow,aB=Math.round,oB=Number.isNaN||function(t){return t!==t},lB=oB,hB=function(t){return lB(t)||t===0?t:t<0?-1:1},uB=Object.getOwnPropertyDescriptor,Nu=uB;if(Nu)try{Nu([],"length")}catch{Nu=null}var Vx=Nu,zu=Object.defineProperty||!1;if(zu)try{zu({},"a",{value:1})}catch{zu=!1}var cB=zu,Sf,Av;function dB(){return Av||(Av=1,Sf=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),n=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var o=42;t[e]=o;for(var h in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var d=Object.getOwnPropertySymbols(t);if(d.length!==1||d[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(t,e);if(l.value!==o||l.enumerable!==!0)return!1}return!0}),Sf}var Ef,Cv;function fB(){if(Cv)return Ef;Cv=1;var s=typeof Symbol<"u"&&Symbol,t=dB();return Ef=function(){return typeof s!="function"||typeof Symbol!="function"||typeof s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Ef}var Tf,Uv;function Wx(){return Uv||(Uv=1,Tf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Tf}var Af,Iv;function Xx(){if(Iv)return Af;Iv=1;var s=$x;return Af=s.getPrototypeOf||null,Af}var pB="Function.prototype.bind called on incompatible ",_B=Object.prototype.toString,gB=Math.max,mB="[object Function]",Pv=function(t,e){for(var n=[],o=0;o<t.length;o+=1)n[o]=t[o];for(var h=0;h<e.length;h+=1)n[h+t.length]=e[h];return n},yB=function(t,e){for(var n=[],o=e,h=0;o<t.length;o+=1,h+=1)n[h]=t[o];return n},vB=function(s,t){for(var e="",n=0;n<s.length;n+=1)e+=s[n],n+1<s.length&&(e+=t);return e},xB=function(t){var e=this;if(typeof e!="function"||_B.apply(e)!==mB)throw new TypeError(pB+e);for(var n=yB(arguments,1),o,h=function(){if(this instanceof o){var v=e.apply(this,Pv(n,arguments));return Object(v)===v?v:this}return e.apply(t,Pv(n,arguments))},d=gB(0,e.length-n.length),l=[],_=0;_<d;_++)l[_]="$"+_;if(o=Function("binder","return function ("+vB(l,",")+"){ return binder.apply(this,arguments); }")(h),e.prototype){var m=function(){};m.prototype=e.prototype,o.prototype=new m,m.prototype=null}return o},bB=xB,Lc=Function.prototype.bind||bB,Y_=Function.prototype.call,Cf,Rv;function Yx(){return Rv||(Rv=1,Cf=Function.prototype.apply),Cf}var wB=typeof Reflect<"u"&&Reflect&&Reflect.apply,SB=Lc,EB=Yx(),TB=Y_,AB=wB,CB=AB||SB.call(TB,EB),UB=Lc,IB=Po,PB=Y_,RB=CB,jx=function(t){if(t.length<1||typeof t[0]!="function")throw new IB("a function is required");return RB(UB,PB,t)},Uf,Bv;function BB(){if(Bv)return Uf;Bv=1;var s=jx,t=Vx,e;try{e=[].__proto__===Array.prototype}catch(d){if(!d||typeof d!="object"||!("code"in d)||d.code!=="ERR_PROTO_ACCESS")throw d}var n=!!e&&t&&t(Object.prototype,"__proto__"),o=Object,h=o.getPrototypeOf;return Uf=n&&typeof n.get=="function"?s([n.get]):typeof h=="function"?function(l){return h(l==null?l:o(l))}:!1,Uf}var If,Fv;function FB(){if(Fv)return If;Fv=1;var s=Wx(),t=Xx(),e=BB();return If=s?function(o){return s(o)}:t?function(o){if(!o||typeof o!="object"&&typeof o!="function")throw new TypeError("getProto: not an object");return t(o)}:e?function(o){return e(o)}:null,If}var Pf,Mv;function MB(){if(Mv)return Pf;Mv=1;var s=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Lc;return Pf=e.call(s,t),Pf}var oe,LB=$x,DB=qR,kB=KR,OB=ZR,NB=JR,Co=QR,po=Po,zB=tB,GB=eB,HB=iB,$B=rB,VB=nB,WB=sB,XB=aB,YB=hB,qx=Function,Rf=function(s){try{return qx('"use strict"; return ('+s+").constructor;")()}catch{}},Dl=Vx,jB=cB,Bf=function(){throw new po},qB=Dl?function(){try{return arguments.callee,Bf}catch{try{return Dl(arguments,"callee").get}catch{return Bf}}}():Bf,Ca=fB()(),Qe=FB(),KB=Xx(),ZB=Wx(),Kx=Yx(),Hl=Y_,Ka={},JB=typeof Uint8Array>"u"||!Qe?oe:Qe(Uint8Array),Js={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?oe:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?oe:ArrayBuffer,"%ArrayIteratorPrototype%":Ca&&Qe?Qe([][Symbol.iterator]()):oe,"%AsyncFromSyncIteratorPrototype%":oe,"%AsyncFunction%":Ka,"%AsyncGenerator%":Ka,"%AsyncGeneratorFunction%":Ka,"%AsyncIteratorPrototype%":Ka,"%Atomics%":typeof Atomics>"u"?oe:Atomics,"%BigInt%":typeof BigInt>"u"?oe:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?oe:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?oe:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?oe:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":DB,"%eval%":eval,"%EvalError%":kB,"%Float32Array%":typeof Float32Array>"u"?oe:Float32Array,"%Float64Array%":typeof Float64Array>"u"?oe:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?oe:FinalizationRegistry,"%Function%":qx,"%GeneratorFunction%":Ka,"%Int8Array%":typeof Int8Array>"u"?oe:Int8Array,"%Int16Array%":typeof Int16Array>"u"?oe:Int16Array,"%Int32Array%":typeof Int32Array>"u"?oe:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ca&&Qe?Qe(Qe([][Symbol.iterator]())):oe,"%JSON%":typeof JSON=="object"?JSON:oe,"%Map%":typeof Map>"u"?oe:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ca||!Qe?oe:Qe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":LB,"%Object.getOwnPropertyDescriptor%":Dl,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?oe:Promise,"%Proxy%":typeof Proxy>"u"?oe:Proxy,"%RangeError%":OB,"%ReferenceError%":NB,"%Reflect%":typeof Reflect>"u"?oe:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?oe:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ca||!Qe?oe:Qe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?oe:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ca&&Qe?Qe(""[Symbol.iterator]()):oe,"%Symbol%":Ca?Symbol:oe,"%SyntaxError%":Co,"%ThrowTypeError%":qB,"%TypedArray%":JB,"%TypeError%":po,"%Uint8Array%":typeof Uint8Array>"u"?oe:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?oe:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?oe:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?oe:Uint32Array,"%URIError%":zB,"%WeakMap%":typeof WeakMap>"u"?oe:WeakMap,"%WeakRef%":typeof WeakRef>"u"?oe:WeakRef,"%WeakSet%":typeof WeakSet>"u"?oe:WeakSet,"%Function.prototype.call%":Hl,"%Function.prototype.apply%":Kx,"%Object.defineProperty%":jB,"%Object.getPrototypeOf%":KB,"%Math.abs%":GB,"%Math.floor%":HB,"%Math.max%":$B,"%Math.min%":VB,"%Math.pow%":WB,"%Math.round%":XB,"%Math.sign%":YB,"%Reflect.getPrototypeOf%":ZB};if(Qe)try{null.error}catch(s){var QB=Qe(Qe(s));Js["%Error.prototype%"]=QB}var tF=function s(t){var e;if(t==="%AsyncFunction%")e=Rf("async function () {}");else if(t==="%GeneratorFunction%")e=Rf("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Rf("async function* () {}");else if(t==="%AsyncGenerator%"){var n=s("%AsyncGeneratorFunction%");n&&(e=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var o=s("%AsyncGenerator%");o&&Qe&&(e=Qe(o.prototype))}return Js[t]=e,e},Lv={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$l=Lc,uc=MB(),eF=$l.call(Hl,Array.prototype.concat),iF=$l.call(Kx,Array.prototype.splice),Dv=$l.call(Hl,String.prototype.replace),cc=$l.call(Hl,String.prototype.slice),rF=$l.call(Hl,RegExp.prototype.exec),nF=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,sF=/\\(\\)?/g,aF=function(t){var e=cc(t,0,1),n=cc(t,-1);if(e==="%"&&n!=="%")throw new Co("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&e!=="%")throw new Co("invalid intrinsic syntax, expected opening `%`");var o=[];return Dv(t,nF,function(h,d,l,_){o[o.length]=l?Dv(_,sF,"$1"):d||h}),o},oF=function(t,e){var n=t,o;if(uc(Lv,n)&&(o=Lv[n],n="%"+o[0]+"%"),uc(Js,n)){var h=Js[n];if(h===Ka&&(h=tF(n)),typeof h>"u"&&!e)throw new po("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:o,name:n,value:h}}throw new Co("intrinsic "+t+" does not exist!")},j_=function(t,e){if(typeof t!="string"||t.length===0)throw new po("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new po('"allowMissing" argument must be a boolean');if(rF(/^%?[^%]*%?$/,t)===null)throw new Co("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=aF(t),o=n.length>0?n[0]:"",h=oF("%"+o+"%",e),d=h.name,l=h.value,_=!1,m=h.alias;m&&(o=m[0],iF(n,eF([0,1],m)));for(var v=1,w=!0;v<n.length;v+=1){var b=n[v],T=cc(b,0,1),r=cc(b,-1);if((T==='"'||T==="'"||T==="`"||r==='"'||r==="'"||r==="`")&&T!==r)throw new Co("property names with quotes must have matching quotes");if((b==="constructor"||!w)&&(_=!0),o+="."+b,d="%"+o+"%",uc(Js,d))l=Js[d];else if(l!=null){if(!(b in l)){if(!e)throw new po("base intrinsic for "+t+" exists, but the property is not available.");return}if(Dl&&v+1>=n.length){var a=Dl(l,b);w=!!a,w&&"get"in a&&!("originalValue"in a.get)?l=a.get:l=l[b]}else w=uc(l,b),l=l[b];w&&!_&&(Js[d]=l)}}return l},Zx=j_,Jx=jx,lF=Jx([Zx("%String.prototype.indexOf%")]),Qx=function(t,e){var n=Zx(t,!!e);return typeof n=="function"&&lF(t,".prototype.")>-1?Jx([n]):n},hF=j_,Vl=Qx,uF=Fc,cF=Po,kv=hF("%Map%",!0),dF=Vl("Map.prototype.get",!0),fF=Vl("Map.prototype.set",!0),pF=Vl("Map.prototype.has",!0),_F=Vl("Map.prototype.delete",!0),gF=Vl("Map.prototype.size",!0),tb=!!kv&&function(){var t,e={assert:function(n){if(!e.has(n))throw new cF("Side channel does not contain "+uF(n))},delete:function(n){if(t){var o=_F(t,n);return gF(t)===0&&(t=void 0),o}return!1},get:function(n){if(t)return dF(t,n)},has:function(n){return t?pF(t,n):!1},set:function(n,o){t||(t=new kv),fF(t,n,o)}};return e},mF=j_,Dc=Qx,yF=Fc,Gh=tb,vF=Po,Ua=mF("%WeakMap%",!0),xF=Dc("WeakMap.prototype.get",!0),bF=Dc("WeakMap.prototype.set",!0),wF=Dc("WeakMap.prototype.has",!0),SF=Dc("WeakMap.prototype.delete",!0),EF=Ua?function(){var t,e,n={assert:function(o){if(!n.has(o))throw new vF("Side channel does not contain "+yF(o))},delete:function(o){if(Ua&&o&&(typeof o=="object"||typeof o=="function")){if(t)return SF(t,o)}else if(Gh&&e)return e.delete(o);return!1},get:function(o){return Ua&&o&&(typeof o=="object"||typeof o=="function")&&t?xF(t,o):e&&e.get(o)},has:function(o){return Ua&&o&&(typeof o=="object"||typeof o=="function")&&t?wF(t,o):!!e&&e.has(o)},set:function(o,h){Ua&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new Ua),bF(t,o,h)):Gh&&(e||(e=Gh()),e.set(o,h))}};return n}:Gh,TF=Po,AF=Fc,CF=jR,UF=tb,IF=EF,PF=IF||UF||CF,RF=function(){var t,e={assert:function(n){if(!e.has(n))throw new TF("Side channel does not contain "+AF(n))},delete:function(n){return!!t&&t.delete(n)},get:function(n){return t&&t.get(n)},has:function(n){return!!t&&t.has(n)},set:function(n,o){t||(t=PF()),t.set(n,o)}};return e},BF=String.prototype.replace,FF=/%20/g,Ff={RFC1738:"RFC1738",RFC3986:"RFC3986"},q_={default:Ff.RFC3986,formatters:{RFC1738:function(s){return BF.call(s,FF,"+")},RFC3986:function(s){return String(s)}},RFC1738:Ff.RFC1738,RFC3986:Ff.RFC3986},MF=q_,Mf=Object.prototype.hasOwnProperty,Xs=Array.isArray,Lr=function(){for(var s=[],t=0;t<256;++t)s.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return s}(),LF=function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(Xs(n)){for(var o=[],h=0;h<n.length;++h)typeof n[h]<"u"&&o.push(n[h]);e.obj[e.prop]=o}}},eb=function(t,e){for(var n=e&&e.plainObjects?{__proto__:null}:{},o=0;o<t.length;++o)typeof t[o]<"u"&&(n[o]=t[o]);return n},DF=function s(t,e,n){if(!e)return t;if(typeof e!="object"&&typeof e!="function"){if(Xs(t))t.push(e);else if(t&&typeof t=="object")(n&&(n.plainObjects||n.allowPrototypes)||!Mf.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var o=t;return Xs(t)&&!Xs(e)&&(o=eb(t,n)),Xs(t)&&Xs(e)?(e.forEach(function(h,d){if(Mf.call(t,d)){var l=t[d];l&&typeof l=="object"&&h&&typeof h=="object"?t[d]=s(l,h,n):t.push(h)}else t[d]=h}),t):Object.keys(e).reduce(function(h,d){var l=e[d];return Mf.call(h,d)?h[d]=s(h[d],l,n):h[d]=l,h},o)},kF=function(t,e){return Object.keys(e).reduce(function(n,o){return n[o]=e[o],n},t)},OF=function(s,t,e){var n=s.replace(/\+/g," ");if(e==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},Lf=1024,NF=function(t,e,n,o,h){if(t.length===0)return t;var d=t;if(typeof t=="symbol"?d=Symbol.prototype.toString.call(t):typeof t!="string"&&(d=String(t)),n==="iso-8859-1")return escape(d).replace(/%u[0-9a-f]{4}/gi,function(T){return"%26%23"+parseInt(T.slice(2),16)+"%3B"});for(var l="",_=0;_<d.length;_+=Lf){for(var m=d.length>=Lf?d.slice(_,_+Lf):d,v=[],w=0;w<m.length;++w){var b=m.charCodeAt(w);if(b===45||b===46||b===95||b===126||b>=48&&b<=57||b>=65&&b<=90||b>=97&&b<=122||h===MF.RFC1738&&(b===40||b===41)){v[v.length]=m.charAt(w);continue}if(b<128){v[v.length]=Lr[b];continue}if(b<2048){v[v.length]=Lr[192|b>>6]+Lr[128|b&63];continue}if(b<55296||b>=57344){v[v.length]=Lr[224|b>>12]+Lr[128|b>>6&63]+Lr[128|b&63];continue}w+=1,b=65536+((b&1023)<<10|m.charCodeAt(w)&1023),v[v.length]=Lr[240|b>>18]+Lr[128|b>>12&63]+Lr[128|b>>6&63]+Lr[128|b&63]}l+=v.join("")}return l},zF=function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],o=0;o<e.length;++o)for(var h=e[o],d=h.obj[h.prop],l=Object.keys(d),_=0;_<l.length;++_){var m=l[_],v=d[m];typeof v=="object"&&v!==null&&n.indexOf(v)===-1&&(e.push({obj:d,prop:m}),n.push(v))}return LF(e),t},GF=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},HF=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},$F=function(t,e){return[].concat(t,e)},VF=function(t,e){if(Xs(t)){for(var n=[],o=0;o<t.length;o+=1)n.push(e(t[o]));return n}return e(t)},ib={arrayToObject:eb,assign:kF,combine:$F,compact:zF,decode:OF,encode:NF,isBuffer:HF,isRegExp:GF,maybeMap:VF,merge:DF},rb=RF,Gu=ib,Cl=q_,WF=Object.prototype.hasOwnProperty,nb={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Wr=Array.isArray,XF=Array.prototype.push,sb=function(s,t){XF.apply(s,Wr(t)?t:[t])},YF=Date.prototype.toISOString,Ov=Cl.default,Xe={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Gu.encode,encodeValuesOnly:!1,filter:void 0,format:Ov,formatter:Cl.formatters[Ov],indices:!1,serializeDate:function(t){return YF.call(t)},skipNulls:!1,strictNullHandling:!1},jF=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Df={},qF=function s(t,e,n,o,h,d,l,_,m,v,w,b,T,r,a,u,f,g){for(var x=t,S=g,A=0,C=!1;(S=S.get(Df))!==void 0&&!C;){var B=S.get(t);if(A+=1,typeof B<"u"){if(B===A)throw new RangeError("Cyclic object value");C=!0}typeof S.get(Df)>"u"&&(A=0)}if(typeof v=="function"?x=v(e,x):x instanceof Date?x=T(x):n==="comma"&&Wr(x)&&(x=Gu.maybeMap(x,function(rt){return rt instanceof Date?T(rt):rt})),x===null){if(d)return m&&!u?m(e,Xe.encoder,f,"key",r):e;x=""}if(jF(x)||Gu.isBuffer(x)){if(m){var R=u?e:m(e,Xe.encoder,f,"key",r);return[a(R)+"="+a(m(x,Xe.encoder,f,"value",r))]}return[a(e)+"="+a(String(x))]}var M=[];if(typeof x>"u")return M;var N;if(n==="comma"&&Wr(x))u&&m&&(x=Gu.maybeMap(x,m)),N=[{value:x.length>0?x.join(",")||null:void 0}];else if(Wr(v))N=v;else{var L=Object.keys(x);N=w?L.sort(w):L}var W=_?String(e).replace(/\./g,"%2E"):String(e),k=o&&Wr(x)&&x.length===1?W+"[]":W;if(h&&Wr(x)&&x.length===0)return k+"[]";for(var j=0;j<N.length;++j){var Y=N[j],ut=typeof Y=="object"&&Y&&typeof Y.value<"u"?Y.value:x[Y];if(!(l&&ut===null)){var it=b&&_?String(Y).replace(/\./g,"%2E"):String(Y),gt=Wr(x)?typeof n=="function"?n(k,it):k:k+(b?"."+it:"["+it+"]");g.set(t,A);var Q=rb();Q.set(Df,g),sb(M,s(ut,gt,n,o,h,d,l,_,n==="comma"&&u&&Wr(x)?null:m,v,w,b,T,r,a,u,f,Q))}}return M},KF=function(t){if(!t)return Xe;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||Xe.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Cl.default;if(typeof t.format<"u"){if(!WF.call(Cl.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var o=Cl.formatters[n],h=Xe.filter;(typeof t.filter=="function"||Wr(t.filter))&&(h=t.filter);var d;if(t.arrayFormat in nb?d=t.arrayFormat:"indices"in t?d=t.indices?"indices":"repeat":d=Xe.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:Xe.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Xe.addQueryPrefix,allowDots:l,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Xe.allowEmptyArrays,arrayFormat:d,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Xe.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Xe.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Xe.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Xe.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Xe.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Xe.encodeValuesOnly,filter:h,format:n,formatter:o,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Xe.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Xe.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Xe.strictNullHandling}},ZF=function(s,t){var e=s,n=KF(t),o,h;typeof n.filter=="function"?(h=n.filter,e=h("",e)):Wr(n.filter)&&(h=n.filter,o=h);var d=[];if(typeof e!="object"||e===null)return"";var l=nb[n.arrayFormat],_=l==="comma"&&n.commaRoundTrip;o||(o=Object.keys(e)),n.sort&&o.sort(n.sort);for(var m=rb(),v=0;v<o.length;++v){var w=o[v],b=e[w];n.skipNulls&&b===null||sb(d,qF(b,w,l,_,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,m))}var T=d.join(n.delimiter),r=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?r+="utf8=%26%2310003%3B&":r+="utf8=%E2%9C%93&"),T.length>0?r+T:""},Uo=ib,$p=Object.prototype.hasOwnProperty,JF=Array.isArray,Me={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:Uo.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},QF=function(s){return s.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},ab=function(s,t){return s&&typeof s=="string"&&t.comma&&s.indexOf(",")>-1?s.split(","):s},t3="utf8=%26%2310003%3B",e3="utf8=%E2%9C%93",i3=function(t,e){var n={__proto__:null},o=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;o=o.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var h=e.parameterLimit===1/0?void 0:e.parameterLimit,d=o.split(e.delimiter,h),l=-1,_,m=e.charset;if(e.charsetSentinel)for(_=0;_<d.length;++_)d[_].indexOf("utf8=")===0&&(d[_]===e3?m="utf-8":d[_]===t3&&(m="iso-8859-1"),l=_,_=d.length);for(_=0;_<d.length;++_)if(_!==l){var v=d[_],w=v.indexOf("]="),b=w===-1?v.indexOf("="):w+1,T,r;b===-1?(T=e.decoder(v,Me.decoder,m,"key"),r=e.strictNullHandling?null:""):(T=e.decoder(v.slice(0,b),Me.decoder,m,"key"),r=Uo.maybeMap(ab(v.slice(b+1),e),function(u){return e.decoder(u,Me.decoder,m,"value")})),r&&e.interpretNumericEntities&&m==="iso-8859-1"&&(r=QF(String(r))),v.indexOf("[]=")>-1&&(r=JF(r)?[r]:r);var a=$p.call(n,T);a&&e.duplicates==="combine"?n[T]=Uo.combine(n[T],r):(!a||e.duplicates==="last")&&(n[T]=r)}return n},r3=function(s,t,e,n){for(var o=n?t:ab(t,e),h=s.length-1;h>=0;--h){var d,l=s[h];if(l==="[]"&&e.parseArrays)d=e.allowEmptyArrays&&(o===""||e.strictNullHandling&&o===null)?[]:[].concat(o);else{d=e.plainObjects?{__proto__:null}:{};var _=l.charAt(0)==="["&&l.charAt(l.length-1)==="]"?l.slice(1,-1):l,m=e.decodeDotInKeys?_.replace(/%2E/g,"."):_,v=parseInt(m,10);!e.parseArrays&&m===""?d={0:o}:!isNaN(v)&&l!==m&&String(v)===m&&v>=0&&e.parseArrays&&v<=e.arrayLimit?(d=[],d[v]=o):m!=="__proto__"&&(d[m]=o)}o=d}return o},n3=function(t,e,n,o){if(t){var h=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,d=/(\[[^[\]]*])/,l=/(\[[^[\]]*])/g,_=n.depth>0&&d.exec(h),m=_?h.slice(0,_.index):h,v=[];if(m){if(!n.plainObjects&&$p.call(Object.prototype,m)&&!n.allowPrototypes)return;v.push(m)}for(var w=0;n.depth>0&&(_=l.exec(h))!==null&&w<n.depth;){if(w+=1,!n.plainObjects&&$p.call(Object.prototype,_[1].slice(1,-1))&&!n.allowPrototypes)return;v.push(_[1])}if(_){if(n.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");v.push("["+h.slice(_.index)+"]")}return r3(v,e,n,o)}},s3=function(t){if(!t)return Me;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Me.charset:t.charset,n=typeof t.duplicates>"u"?Me.duplicates:t.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var o=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:Me.allowDots:!!t.allowDots;return{allowDots:o,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Me.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Me.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Me.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Me.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Me.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Me.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:Me.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:Me.decoder,delimiter:typeof t.delimiter=="string"||Uo.isRegExp(t.delimiter)?t.delimiter:Me.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Me.depth,duplicates:n,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Me.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Me.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Me.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:Me.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Me.strictNullHandling}},a3=function(s,t){var e=s3(t);if(s===""||s===null||typeof s>"u")return e.plainObjects?{__proto__:null}:{};for(var n=typeof s=="string"?i3(s,e):s,o=e.plainObjects?{__proto__:null}:{},h=Object.keys(n),d=0;d<h.length;++d){var l=h[d],_=n3(l,n[l],e,typeof s=="string");o=Uo.merge(o,_,e)}return e.allowSparse===!0?o:Uo.compact(o)},o3=ZF,l3=a3,h3=q_,u3={formats:h3,parse:l3,stringify:o3},c3=uR;function Un(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var d3=/^([a-z0-9.+-]+:)/i,f3=/:[0-9]*$/,p3=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,_3=["<",">",'"',"`"," ","\r",`
`,"	"],g3=["{","}","|","\\","^","`"].concat(_3),Vp=["'"].concat(g3),Nv=["%","/","?",";","#"].concat(Vp),zv=["/","?","#"],m3=255,Gv=/^[+a-z0-9A-Z_-]{0,63}$/,y3=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v3={javascript:!0,"javascript:":!0},Wp={javascript:!0,"javascript:":!0},_o={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Xp=u3;function x3(s,t,e){if(s&&typeof s=="object"&&s instanceof Un)return s;var n=new Un;return n.parse(s,t,e),n}Un.prototype.parse=function(s,t,e){if(typeof s!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var n=s.indexOf("?"),o=n!==-1&&n<s.indexOf("#")?"?":"#",h=s.split(o),d=/\\/g;h[0]=h[0].replace(d,"/"),s=h.join(o);var l=s;if(l=l.trim(),!e&&s.split("#").length===1){var _=p3.exec(l);if(_)return this.path=l,this.href=l,this.pathname=_[1],_[2]?(this.search=_[2],t?this.query=Xp.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var m=d3.exec(l);if(m){m=m[0];var v=m.toLowerCase();this.protocol=v,l=l.substr(m.length)}if(e||m||l.match(/^\/\/[^@/]+@[^@/]+/)){var w=l.substr(0,2)==="//";w&&!(m&&Wp[m])&&(l=l.substr(2),this.slashes=!0)}if(!Wp[m]&&(w||m&&!_o[m])){for(var b=-1,T=0;T<zv.length;T++){var r=l.indexOf(zv[T]);r!==-1&&(b===-1||r<b)&&(b=r)}var a,u;b===-1?u=l.lastIndexOf("@"):u=l.lastIndexOf("@",b),u!==-1&&(a=l.slice(0,u),l=l.slice(u+1),this.auth=decodeURIComponent(a)),b=-1;for(var T=0;T<Nv.length;T++){var r=l.indexOf(Nv[T]);r!==-1&&(b===-1||r<b)&&(b=r)}b===-1&&(b=l.length),this.host=l.slice(0,b),l=l.slice(b),this.parseHost(),this.hostname=this.hostname||"";var f=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!f)for(var g=this.hostname.split(/\./),T=0,x=g.length;T<x;T++){var S=g[T];if(S&&!S.match(Gv)){for(var A="",C=0,B=S.length;C<B;C++)S.charCodeAt(C)>127?A+="x":A+=S[C];if(!A.match(Gv)){var R=g.slice(0,T),M=g.slice(T+1),N=S.match(y3);N&&(R.push(N[1]),M.unshift(N[2])),M.length&&(l="/"+M.join(".")+l),this.hostname=R.join(".");break}}}this.hostname.length>m3?this.hostname="":this.hostname=this.hostname.toLowerCase(),f||(this.hostname=c3.toASCII(this.hostname));var L=this.port?":"+this.port:"",W=this.hostname||"";this.host=W+L,this.href+=this.host,f&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),l[0]!=="/"&&(l="/"+l))}if(!v3[v])for(var T=0,x=Vp.length;T<x;T++){var k=Vp[T];if(l.indexOf(k)!==-1){var j=encodeURIComponent(k);j===k&&(j=escape(k)),l=l.split(k).join(j)}}var Y=l.indexOf("#");Y!==-1&&(this.hash=l.substr(Y),l=l.slice(0,Y));var ut=l.indexOf("?");if(ut!==-1?(this.search=l.substr(ut),this.query=l.substr(ut+1),t&&(this.query=Xp.parse(this.query)),l=l.slice(0,ut)):t&&(this.search="",this.query={}),l&&(this.pathname=l),_o[v]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var L=this.pathname||"",it=this.search||"";this.path=L+it}return this.href=this.format(),this};Un.prototype.format=function(){var s=this.auth||"";s&&(s=encodeURIComponent(s),s=s.replace(/%3A/i,":"),s+="@");var t=this.protocol||"",e=this.pathname||"",n=this.hash||"",o=!1,h="";this.host?o=s+this.host:this.hostname&&(o=s+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(h=Xp.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var d=this.search||h&&"?"+h||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||_o[t])&&o!==!1?(o="//"+(o||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):o||(o=""),n&&n.charAt(0)!=="#"&&(n="#"+n),d&&d.charAt(0)!=="?"&&(d="?"+d),e=e.replace(/[?#]/g,function(l){return encodeURIComponent(l)}),d=d.replace("#","%23"),t+o+e+d+n};Un.prototype.resolve=function(s){return this.resolveObject(x3(s,!1,!0)).format()};Un.prototype.resolveObject=function(s){if(typeof s=="string"){var t=new Un;t.parse(s,!1,!0),s=t}for(var e=new Un,n=Object.keys(this),o=0;o<n.length;o++){var h=n[o];e[h]=this[h]}if(e.hash=s.hash,s.href==="")return e.href=e.format(),e;if(s.slashes&&!s.protocol){for(var d=Object.keys(s),l=0;l<d.length;l++){var _=d[l];_!=="protocol"&&(e[_]=s[_])}return _o[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(s.protocol&&s.protocol!==e.protocol){if(!_o[s.protocol]){for(var m=Object.keys(s),v=0;v<m.length;v++){var w=m[v];e[w]=s[w]}return e.href=e.format(),e}if(e.protocol=s.protocol,!s.host&&!Wp[s.protocol]){for(var x=(s.pathname||"").split("/");x.length&&!(s.host=x.shift()););s.host||(s.host=""),s.hostname||(s.hostname=""),x[0]!==""&&x.unshift(""),x.length<2&&x.unshift(""),e.pathname=x.join("/")}else e.pathname=s.pathname;if(e.search=s.search,e.query=s.query,e.host=s.host||"",e.auth=s.auth,e.hostname=s.hostname||s.host,e.port=s.port,e.pathname||e.search){var b=e.pathname||"",T=e.search||"";e.path=b+T}return e.slashes=e.slashes||s.slashes,e.href=e.format(),e}var r=e.pathname&&e.pathname.charAt(0)==="/",a=s.host||s.pathname&&s.pathname.charAt(0)==="/",u=a||r||e.host&&s.pathname,f=u,g=e.pathname&&e.pathname.split("/")||[],x=s.pathname&&s.pathname.split("/")||[],S=e.protocol&&!_o[e.protocol];if(S&&(e.hostname="",e.port=null,e.host&&(g[0]===""?g[0]=e.host:g.unshift(e.host)),e.host="",s.protocol&&(s.hostname=null,s.port=null,s.host&&(x[0]===""?x[0]=s.host:x.unshift(s.host)),s.host=null),u=u&&(x[0]===""||g[0]==="")),a)e.host=s.host||s.host===""?s.host:e.host,e.hostname=s.hostname||s.hostname===""?s.hostname:e.hostname,e.search=s.search,e.query=s.query,g=x;else if(x.length)g||(g=[]),g.pop(),g=g.concat(x),e.search=s.search,e.query=s.query;else if(s.search!=null){if(S){e.host=g.shift(),e.hostname=e.host;var A=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;A&&(e.auth=A.shift(),e.hostname=A.shift(),e.host=e.hostname)}return e.search=s.search,e.query=s.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!g.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var C=g.slice(-1)[0],B=(e.host||s.host||g.length>1)&&(C==="."||C==="..")||C==="",R=0,M=g.length;M>=0;M--)C=g[M],C==="."?g.splice(M,1):C===".."?(g.splice(M,1),R++):R&&(g.splice(M,1),R--);if(!u&&!f)for(;R--;R)g.unshift("..");u&&g[0]!==""&&(!g[0]||g[0].charAt(0)!=="/")&&g.unshift(""),B&&g.join("/").substr(-1)!=="/"&&g.push("");var N=g[0]===""||g[0]&&g[0].charAt(0)==="/";if(S){e.hostname=N?"":g.length?g.shift():"",e.host=e.hostname;var A=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;A&&(e.auth=A.shift(),e.hostname=A.shift(),e.host=e.hostname)}return u=u||e.host&&g.length,u&&!N&&g.unshift(""),g.length>0?e.pathname=g.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=s.auth||e.auth,e.slashes=e.slashes||s.slashes,e.href=e.format(),e};Un.prototype.parseHost=function(){var s=this.host,t=f3.exec(s);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),s=s.substr(0,s.length-t.length)),s&&(this.hostname=s)};const Hv={};function ne(s,t,e=3){if(Hv[t])return;let n=new Error().stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`):(n=n.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(n))),Hv[t]=!0}function cr(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function il(s){return s.split("?")[0].split("#")[0]}function b3(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w3(s,t,e){return s.replace(new RegExp(b3(t),"g"),e)}function S3(s,t){let e="",n=0,o=-1,h=0,d=-1;for(let l=0;l<=s.length;++l){if(l<s.length)d=s.charCodeAt(l);else{if(d===47)break;d=47}if(d===47){if(!(o===l-1||h===1))if(o!==l-1&&h===2){if(e.length<2||n!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const _=e.lastIndexOf("/");if(_!==e.length-1){_===-1?(e="",n=0):(e=e.slice(0,_),n=e.length-1-e.lastIndexOf("/")),o=l,h=0;continue}}else if(e.length===2||e.length===1){e="",n=0,o=l,h=0;continue}}}else e.length>0?e+=`/${s.slice(o+1,l)}`:e=s.slice(o+1,l),n=l-o-1;o=l,h=0}else d===46&&h!==-1?++h:h=-1}return e}const ei={toPosix(s){return w3(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){cr(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(cr(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const n=il(this.toPosix(t??wt.ADAPTER.getBaseUrl())),o=il(this.toPosix(e??this.rootname(n)));return s=this.toPosix(s),s.startsWith("/")?ei.join(o,s.slice(1)):this.isAbsolute(s)?s:this.join(n,s)},normalize(s){if(cr(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const n=s.endsWith("/");return s=S3(s),s.length>0&&n&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return cr(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const n=s[e];if(cr(n),n.length>0)if(t===void 0)t=n;else{const o=s[e-1]??"";this.joinExtensions.includes(this.extname(o).toLowerCase())?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(cr(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let n=-1,o=!0;const h=this.getProtocol(s),d=s;s=s.slice(h.length);for(let l=s.length-1;l>=1;--l)if(t=s.charCodeAt(l),t===47){if(!o){n=l;break}}else o=!1;return n===-1?e?"/":this.isUrl(d)?h+s:h:e&&n===1?"//":h+s.slice(0,n)},rootname(s){cr(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){cr(s),t&&cr(t),s=il(this.toPosix(s));let e=0,n=-1,o=!0,h;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let d=t.length-1,l=-1;for(h=s.length-1;h>=0;--h){const _=s.charCodeAt(h);if(_===47){if(!o){e=h+1;break}}else l===-1&&(o=!1,l=h+1),d>=0&&(_===t.charCodeAt(d)?--d===-1&&(n=h):(d=-1,n=l))}return e===n?n=l:n===-1&&(n=s.length),s.slice(e,n)}for(h=s.length-1;h>=0;--h)if(s.charCodeAt(h)===47){if(!o){e=h+1;break}}else n===-1&&(o=!1,n=h+1);return n===-1?"":s.slice(e,n)},extname(s){cr(s),s=il(this.toPosix(s));let t=-1,e=0,n=-1,o=!0,h=0;for(let d=s.length-1;d>=0;--d){const l=s.charCodeAt(d);if(l===47){if(!o){e=d+1;break}continue}n===-1&&(o=!1,n=d+1),l===46?t===-1?t=d:h!==1&&(h=1):t!==-1&&(h=-1)}return t===-1||n===-1||h===0||h===1&&t===n-1&&t===e+1?"":s.slice(t,n)},parse(s){cr(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=il(this.toPosix(s));let e=s.charCodeAt(0);const n=this.isAbsolute(s);let o;t.root=this.rootname(s),n||this.hasProtocol(s)?o=1:o=0;let h=-1,d=0,l=-1,_=!0,m=s.length-1,v=0;for(;m>=o;--m){if(e=s.charCodeAt(m),e===47){if(!_){d=m+1;break}continue}l===-1&&(_=!1,l=m+1),e===46?h===-1?h=m:v!==1&&(v=1):h!==-1&&(v=-1)}return h===-1||l===-1||v===0||v===1&&h===l-1&&h===d+1?l!==-1&&(d===0&&n?t.base=t.name=s.slice(1,l):t.base=t.name=s.slice(d,l)):(d===0&&n?(t.name=s.slice(1,h),t.base=s.slice(1,l)):(t.name=s.slice(d,h),t.base=s.slice(d,l)),t.ext=s.slice(h,l)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let kf;async function E3(){return kf??(kf=(async()=>{var h;const s=document.createElement("canvas").getContext("webgl");if(!s)return Ri.UNPACK;const t=await new Promise(d=>{const l=document.createElement("video");l.onloadeddata=()=>d(l),l.onerror=()=>d(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!t)return Ri.UNPACK;const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);const n=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t);const o=new Uint8Array(4);return s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,o),s.deleteFramebuffer(n),s.deleteTexture(e),(h=s.getExtension("WEBGL_lose_context"))==null||h.loseContext(),o[0]<=o[3]?Ri.PMA:Ri.UNPACK})()),kf}let Of;function T3(){return typeof Of>"u"&&(Of=function(){var t;const s={stencil:!0,failIfMajorPerformanceCaveat:wt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!wt.ADAPTER.getWebGLRenderingContext())return!1;const e=wt.ADAPTER.createCanvas();let n=e.getContext("webgl",s)||e.getContext("experimental-webgl",s);const o=!!((t=n==null?void 0:n.getContextAttributes())!=null&&t.stencil);if(n){const h=n.getExtension("WEBGL_lose_context");h&&h.loseContext()}return n=null,o}catch{return!1}}()),Of}var A3={grad:.9,turn:360,rad:360/(2*Math.PI)},fn=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},ti=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},sr=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},ob=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},$v=function(s){return{r:sr(s.r,0,255),g:sr(s.g,0,255),b:sr(s.b,0,255),a:sr(s.a)}},Nf=function(s){return{r:ti(s.r),g:ti(s.g),b:ti(s.b),a:ti(s.a,3)}},C3=/^#([0-9a-f]{3,8})$/i,Hh=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},lb=function(s){var t=s.r,e=s.g,n=s.b,o=s.a,h=Math.max(t,e,n),d=h-Math.min(t,e,n),l=d?h===t?(e-n)/d:h===e?2+(n-t)/d:4+(t-e)/d:0;return{h:60*(l<0?l+6:l),s:h?d/h*100:0,v:h/255*100,a:o}},hb=function(s){var t=s.h,e=s.s,n=s.v,o=s.a;t=t/360*6,e/=100,n/=100;var h=Math.floor(t),d=n*(1-e),l=n*(1-(t-h)*e),_=n*(1-(1-t+h)*e),m=h%6;return{r:255*[n,l,d,d,_,n][m],g:255*[_,n,n,l,d,d][m],b:255*[d,d,_,n,n,l][m],a:o}},Vv=function(s){return{h:ob(s.h),s:sr(s.s,0,100),l:sr(s.l,0,100),a:sr(s.a)}},Wv=function(s){return{h:ti(s.h),s:ti(s.s),l:ti(s.l),a:ti(s.a,3)}},Xv=function(s){return hb((e=(t=s).s,{h:t.h,s:(e*=((n=t.l)<50?n:100-n)/100)>0?2*e/(n+e)*100:0,v:n+e,a:t.a}));var t,e,n},Ul=function(s){return{h:(t=lb(s)).h,s:(o=(200-(e=t.s))*(n=t.v)/100)>0&&o<200?e*n/100/(o<=100?o:200-o)*100:0,l:o/2,a:t.a};var t,e,n,o},U3=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,I3=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,P3=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,R3=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Yp={string:[[function(s){var t=C3.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?ti(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?ti(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=P3.exec(s)||R3.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:$v({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=U3.exec(s)||I3.exec(s);if(!t)return null;var e,n,o=Vv({h:(e=t[1],n=t[2],n===void 0&&(n="deg"),Number(e)*(A3[n]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Xv(o)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,n=s.b,o=s.a,h=o===void 0?1:o;return fn(t)&&fn(e)&&fn(n)?$v({r:Number(t),g:Number(e),b:Number(n),a:Number(h)}):null},"rgb"],[function(s){var t=s.h,e=s.s,n=s.l,o=s.a,h=o===void 0?1:o;if(!fn(t)||!fn(e)||!fn(n))return null;var d=Vv({h:Number(t),s:Number(e),l:Number(n),a:Number(h)});return Xv(d)},"hsl"],[function(s){var t=s.h,e=s.s,n=s.v,o=s.a,h=o===void 0?1:o;if(!fn(t)||!fn(e)||!fn(n))return null;var d=function(l){return{h:ob(l.h),s:sr(l.s,0,100),v:sr(l.v,0,100),a:sr(l.a)}}({h:Number(t),s:Number(e),v:Number(n),a:Number(h)});return hb(d)},"hsv"]]},Yv=function(s,t){for(var e=0;e<t.length;e++){var n=t[e][0](s);if(n)return[n,t[e][1]]}return[null,void 0]},B3=function(s){return typeof s=="string"?Yv(s.trim(),Yp.string):typeof s=="object"&&s!==null?Yv(s,Yp.object):[null,void 0]},zf=function(s,t){var e=Ul(s);return{h:e.h,s:sr(e.s+100*t,0,100),l:e.l,a:e.a}},Gf=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},jv=function(s,t){var e=Ul(s);return{h:e.h,s:e.s,l:sr(e.l+100*t,0,100),a:e.a}},jp=function(){function s(t){this.parsed=B3(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return ti(Gf(this.rgba),2)},s.prototype.isDark=function(){return Gf(this.rgba)<.5},s.prototype.isLight=function(){return Gf(this.rgba)>=.5},s.prototype.toHex=function(){return t=Nf(this.rgba),e=t.r,n=t.g,o=t.b,d=(h=t.a)<1?Hh(ti(255*h)):"","#"+Hh(e)+Hh(n)+Hh(o)+d;var t,e,n,o,h,d},s.prototype.toRgb=function(){return Nf(this.rgba)},s.prototype.toRgbString=function(){return t=Nf(this.rgba),e=t.r,n=t.g,o=t.b,(h=t.a)<1?"rgba("+e+", "+n+", "+o+", "+h+")":"rgb("+e+", "+n+", "+o+")";var t,e,n,o,h},s.prototype.toHsl=function(){return Wv(Ul(this.rgba))},s.prototype.toHslString=function(){return t=Wv(Ul(this.rgba)),e=t.h,n=t.s,o=t.l,(h=t.a)<1?"hsla("+e+", "+n+"%, "+o+"%, "+h+")":"hsl("+e+", "+n+"%, "+o+"%)";var t,e,n,o,h},s.prototype.toHsv=function(){return t=lb(this.rgba),{h:ti(t.h),s:ti(t.s),v:ti(t.v),a:ti(t.a,3)};var t},s.prototype.invert=function(){return zr({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),zr(zf(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),zr(zf(this.rgba,-t))},s.prototype.grayscale=function(){return zr(zf(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),zr(jv(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),zr(jv(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?zr({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ti(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=Ul(this.rgba);return typeof t=="number"?zr({h:t,s:e.s,l:e.l,a:e.a}):ti(e.h)},s.prototype.isEqual=function(t){return this.toHex()===zr(t).toHex()},s}(),zr=function(s){return s instanceof jp?s:new jp(s)},qv=[],F3=function(s){s.forEach(function(t){qv.indexOf(t)<0&&(t(jp,Yp),qv.push(t))})};function M3(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var o in e)n[e[o]]=o;var h={};s.prototype.toName=function(d){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var l,_,m=n[this.toHex()];if(m)return m;if(d!=null&&d.closest){var v=this.toRgb(),w=1/0,b="black";if(!h.length)for(var T in e)h[T]=new s(e[T]).toRgb();for(var r in e){var a=(l=v,_=h[r],Math.pow(l.r-_.r,2)+Math.pow(l.g-_.g,2)+Math.pow(l.b-_.b,2));a<w&&(w=a,b=r)}return b}},t.string.push([function(d){var l=d.toLowerCase(),_=l==="transparent"?"#0000":e[l];return _?new s(_).toRgb():null},"name"])}F3([M3]);const Za=class Hu{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Hu)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const n=typeof t;if(n!==typeof e)return!1;if(n==="number"||n==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((o,h)=>o===e[h]);if(t!==null&&e!==null){const o=Object.keys(t),h=Object.keys(e);return o.length!==h.length?!1:o.every(d=>t[d]===e[d])}return t===e}toRgba(){const[t,e,n,o]=this._components;return{r:t,g:e,b:n,a:o}}toRgb(){const[t,e,n]=this._components;return{r:t,g:e,b:n}}toRgbaString(){const[t,e,n]=this.toUint8RgbArray();return`rgba(${t},${e},${n},${this.alpha})`}toUint8RgbArray(t){const[e,n,o]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(n*255),t[2]=Math.round(o*255),t}toRgbArray(t){t=t??[];const[e,n,o]=this._components;return t[0]=e,t[1]=n,t[2]=o,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,n,o,h]=Hu.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=n,this._components[2]*=o,this._components[3]*=h,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let n=this._int>>16&255,o=this._int>>8&255,h=this._int&255;return e&&(n=n*t+.5|0,o=o*t+.5|0,h=h*t+.5|0),(t*255<<24)+(n<<16)+(o<<8)+h}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,n,o]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(n*t)/t,this._components[2]=Math.round(o*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,n,o,h]=this._components;return t[0]=e,t[1]=n,t[2]=o,t[3]=h,t}normalize(t){let e,n,o,h;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const d=t;e=(d>>16&255)/255,n=(d>>8&255)/255,o=(d&255)/255,h=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,n,o,h=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,n,o,h=255]=t,e/=255,n/=255,o/=255,h/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const l=Hu.HEX_PATTERN.exec(t);l&&(t=`#${l[2]}`)}const d=zr(t);d.isValid()&&({r:e,g:n,b:o,a:h}=d.rgba,e/=255,n/=255,o/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=n,this._components[2]=o,this._components[3]=h,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,n]=this._components;this._int=(t*255<<16)+(e*255<<8)+(n*255|0)}_clamp(t,e=0,n=1){return typeof t=="number"?Math.min(Math.max(t,e),n):(t.forEach((o,h)=>{t[h]=Math.min(Math.max(o,e),n)}),t)}};Za.shared=new Za,Za.temp=new Za,Za.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let we=Za;function L3(s){return ne("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),we.shared.setValue(s).toHex()}function D3(s){return ne("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),we.shared.setValue(s).toNumber()}function k3(){const s=[],t=[];for(let n=0;n<32;n++)s[n]=n,t[n]=n;s[Vt.NORMAL_NPM]=Vt.NORMAL,s[Vt.ADD_NPM]=Vt.ADD,s[Vt.SCREEN_NPM]=Vt.SCREEN,t[Vt.NORMAL]=Vt.NORMAL_NPM,t[Vt.ADD]=Vt.ADD_NPM,t[Vt.SCREEN]=Vt.SCREEN_NPM;const e=[];return e.push(t),e.push(s),e}const ub=k3();function cb(s,t){return ub[t?1:0][s]}function O3(s,t=null){const e=s*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let n=0,o=0;n<e;n+=6,o+=4)t[n+0]=o+0,t[n+1]=o+1,t[n+2]=o+2,t[n+3]=o+0,t[n+4]=o+2,t[n+5]=o+3;return t}function db(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function dc(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Kv(s){return!(s&s-1)&&!!s}function Zv(s){let t=(s>65535?1:0)<<4;s>>>=t;let e=(s>255?1:0)<<3;return s>>>=e,t|=e,e=(s>15?1:0)<<2,s>>>=e,t|=e,e=(s>3?1:0)<<1,s>>>=e,t|=e,t|s>>1}function go(s,t,e){const n=s.length;let o;if(t>=n||e===0)return;e=t+e>n?n-t:e;const h=n-e;for(o=t;o<h;++o)s[o]=s[o+e];s.length=h}function ns(s){return s===0?0:s<0?-1:1}let N3=0;function ra(){return++N3}const qp=class{constructor(s,t,e,n){this.left=s,this.top=t,this.right=e,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};qp.EMPTY=new qp(0,0,0,0);let Jv=qp;const Qv={},Gr=Object.create(null),Vn=Object.create(null);class z3{constructor(t,e,n){this._canvas=wt.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||wt.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function t0(s,t,e){for(let n=0,o=4*e*t;n<t;++n,o+=4)if(s[o+3]!==0)return!1;return!0}function e0(s,t,e,n,o){const h=4*t;for(let d=n,l=n*h+4*e;d<=o;++d,l+=h)if(s[l+3]!==0)return!1;return!0}function G3(s){const{width:t,height:e}=s,n=s.getContext("2d",{willReadFrequently:!0});if(n===null)throw new TypeError("Failed to get canvas 2D context");const o=n.getImageData(0,0,t,e).data;let h=0,d=0,l=t-1,_=e-1;for(;d<e&&t0(o,t,d);)++d;if(d===e)return Jv.EMPTY;for(;t0(o,t,_);)--_;for(;e0(o,t,h,d,_);)++h;for(;e0(o,t,l,d,_);)--l;return++l,++_,new Jv(h,d,l,_)}function H3(s){const t=G3(s),{width:e,height:n}=t;let o=null;if(!t.isEmpty()){const h=s.getContext("2d");if(h===null)throw new TypeError("Failed to get canvas 2D context");o=h.getImageData(t.left,t.top,e,n)}return{width:e,height:n,data:o}}function $3(s,t=globalThis.location){if(s.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Pn(s,t=1){var n;const e=(n=wt.RETINA_PREFIX)==null?void 0:n.exec(s);return e?parseFloat(e[1]):t}var yt=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(yt||{});const Kp=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},i0=(s,t)=>Kp(s).priority??t,Ut={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Kp).forEach(t=>{t.type.forEach(e=>{var n,o;return(o=(n=this._removeHandlers)[e])==null?void 0:o.call(n,t)})}),this},add(...s){return s.map(Kp).forEach(t=>{t.type.forEach(e=>{var h,d;const n=this._addHandlers,o=this._queue;n[e]?(h=n[e])==null||h.call(n,t):(o[e]=o[e]||[],(d=o[e])==null||d.push(t))})}),this},handle(s,t,e){var d;const n=this._addHandlers,o=this._removeHandlers;if(n[s]||o[s])throw new Error(`Extension type ${s} already has a handler`);n[s]=t,o[s]=e;const h=this._queue;return h[s]&&((d=h[s])==null||d.forEach(l=>t(l)),delete h[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(s,t,e=-1){return this.handle(s,n=>{t.includes(n.ref)||(t.push(n.ref),t.sort((o,h)=>i0(h,e)-i0(o,e)))},n=>{const o=t.indexOf(n.ref);o!==-1&&t.splice(o,1)})}};class Zp{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const V3=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function W3(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function X3(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const n=V3.replace(/%forloop%/gi,W3(s));if(t.shaderSource(e,n),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}return s}const Hf=0,$f=1,Vf=2,Wf=3,Xf=4,Yf=5;class tn{constructor(){this.data=0,this.blendMode=Vt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Hf)}set blend(t){!!(this.data&1<<Hf)!==t&&(this.data^=1<<Hf)}get offsets(){return!!(this.data&1<<$f)}set offsets(t){!!(this.data&1<<$f)!==t&&(this.data^=1<<$f)}get culling(){return!!(this.data&1<<Vf)}set culling(t){!!(this.data&1<<Vf)!==t&&(this.data^=1<<Vf)}get depthTest(){return!!(this.data&1<<Wf)}set depthTest(t){!!(this.data&1<<Wf)!==t&&(this.data^=1<<Wf)}get depthMask(){return!!(this.data&1<<Yf)}set depthMask(t){!!(this.data&1<<Yf)!==t&&(this.data^=1<<Yf)}get clockwiseFrontFace(){return!!(this.data&1<<Xf)}set clockwiseFrontFace(t){!!(this.data&1<<Xf)!==t&&(this.data^=1<<Xf)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Vt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new tn;return t.depthTest=!1,t.blend=!0,t}}tn.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Jp=[];function fb(s,t){if(!s)return null;let e="";if(typeof s=="string"){const n=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);n&&(e=n[1].toLowerCase())}for(let n=Jp.length-1;n>=0;--n){const o=Jp[n];if(o.test&&o.test(s,e))return new o(s,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Tr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,n,o,h,d,l,_){if(arguments.length>8)throw new Error("max arguments reached");const{name:m,items:v}=this;this._aliasCount++;for(let w=0,b=v.length;w<b;w++)v[w][m](t,e,n,o,h,d,l,_);return v===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Tr.prototype,{dispatch:{value:Tr.prototype.emit},run:{value:Tr.prototype.emit}});class kl{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Tr("setRealSize"),this.onUpdate=new Tr("update"),this.onError=new Tr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class kc extends kl{constructor(t,e){const{width:n,height:o}=e||{};if(!n||!o)throw new Error("BufferResource width or height invalid");super(n,o),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,n){const o=t.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,this.unpackAlignment),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ri.UNPACK);const h=e.realWidth,d=e.realHeight;return n.width===h&&n.height===d?o.texSubImage2D(e.target,0,0,0,h,d,e.format,n.type,this.data):(n.width=h,n.height=d,o.texImage2D(e.target,0,n.internalFormat,h,d,0,e.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const Y3={scaleMode:En.NEAREST,alphaMode:Ri.NPM},Qp=class Ja extends Gl{constructor(t=null,e=null){super(),e=Object.assign({},Ja.defaultOptions,e);const{alphaMode:n,mipmap:o,anisotropicLevel:h,scaleMode:d,width:l,height:_,wrapMode:m,format:v,type:w,target:b,resolution:T,resourceOptions:r}=e;t&&!(t instanceof kl)&&(t=fb(t,r),t.internal=!0),this.resolution=T||wt.RESOLUTION,this.width=Math.round((l||0)*this.resolution)/this.resolution,this.height=Math.round((_||0)*this.resolution)/this.resolution,this._mipmap=o,this.anisotropicLevel=h,this._wrapMode=m,this._scaleMode=d,this.format=v,this.type=w,this.target=b,this.alphaMode=n,this.uid=ra(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=l>0&&_>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let n;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this}setSize(t,e,n){return n=n||this.resolution,this.setRealSize(t*n,e*n,n)}setRealSize(t,e,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Kv(this.realWidth)&&Kv(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Vn[this.cacheId],delete Gr[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ja.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,n=wt.STRICT_TEXTURE_CACHE){const o=typeof t=="string";let h=null;if(o)h=t;else{if(!t._pixiId){const l=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${l}_${ra()}`}h=t._pixiId}let d=Vn[h];if(o&&n&&!d)throw new Error(`The cacheId "${h}" does not exist in BaseTextureCache.`);return d||(d=new Ja(t,e),d.cacheId=h,Ja.addToCache(d,h)),d}static fromBuffer(t,e,n,o){t=t||new Float32Array(e*n*4);const h=new kc(t,{width:e,height:n,...o==null?void 0:o.resourceOptions});let d,l;return t instanceof Float32Array?(d=ft.RGBA,l=Bt.FLOAT):t instanceof Int32Array?(d=ft.RGBA_INTEGER,l=Bt.INT):t instanceof Uint32Array?(d=ft.RGBA_INTEGER,l=Bt.UNSIGNED_INT):t instanceof Int16Array?(d=ft.RGBA_INTEGER,l=Bt.SHORT):t instanceof Uint16Array?(d=ft.RGBA_INTEGER,l=Bt.UNSIGNED_SHORT):t instanceof Int8Array?(d=ft.RGBA,l=Bt.BYTE):(d=ft.RGBA,l=Bt.UNSIGNED_BYTE),h.internal=!0,new Ja(h,Object.assign({},Y3,{type:l,format:d},o))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Vn[e]&&Vn[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Vn[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Vn[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Vn[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Vn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Qp.defaultOptions={mipmap:Qr.POW2,anisotropicLevel:0,scaleMode:En.LINEAR,wrapMode:os.CLAMP,alphaMode:Ri.UNPACK,target:fo.TEXTURE_2D,format:ft.RGBA,type:Bt.UNSIGNED_BYTE},Qp._globalBatch=0;let qt=Qp;class t_{constructor(){this.texArray=null,this.blend=0,this.type=Kr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let j3=0;class Ne{constructor(t,e=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=j3++,this.disposeRunner=new Tr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Zr.ELEMENT_ARRAY_BUFFER:Zr.ARRAY_BUFFER}get index(){return this.type===Zr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ne(t)}}class fc{constructor(t,e=0,n=!1,o=Bt.FLOAT,h,d,l,_=1){this.buffer=t,this.size=e,this.normalized=n,this.type=o,this.stride=h,this.start=d,this.instance=l,this.divisor=_}destroy(){this.buffer=null}static from(t,e,n,o,h){return new fc(t,e,n,o,h)}}const q3={Float32Array,Uint32Array,Int32Array,Uint8Array};function K3(s,t){let e=0,n=0;const o={};for(let _=0;_<s.length;_++)n+=t[_],e+=s[_].length;const h=new ArrayBuffer(e*4);let d=null,l=0;for(let _=0;_<s.length;_++){const m=t[_],v=s[_],w=db(v);o[w]||(o[w]=new q3[w](h)),d=o[w];for(let b=0;b<v.length;b++){const T=(b/m|0)*n+l,r=b%m;d[T+r]=v[b]}l+=m}return new Float32Array(h)}const r0={5126:4,5123:2,5121:1};let Z3=0;const J3={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class hs{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Z3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Tr("disposeGeometry"),this.refCount=0}addAttribute(t,e,n=0,o=!1,h,d,l,_=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ne||(e instanceof Array&&(e=new Float32Array(e)),e=new Ne(e));const m=t.split("|");if(m.length>1){for(let w=0;w<m.length;w++)this.addAttribute(m[w],e,n,o,h);return this}let v=this.buffers.indexOf(e);return v===-1&&(this.buffers.push(e),v=this.buffers.length-1),this.attributes[t]=new fc(v,n,o,h,d,l,_),this.instanced=this.instanced||_,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ne||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ne(t)),t.type=Zr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],n=new Ne;let o;for(o in this.attributes){const h=this.attributes[o],d=this.buffers[h.buffer];t.push(d.data),e.push(h.size*r0[h.type]/4),h.buffer=0}for(n.data=K3(t,e),o=0;o<this.buffers.length;o++)this.buffers[o]!==this.indexBuffer&&this.buffers[o].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new hs;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ne(this.buffers[e].data.slice(0));for(const e in this.attributes){const n=this.attributes[e];t.attributes[e]=new fc(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Zr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new hs,n=[],o=[],h=[];let d;for(let l=0;l<t.length;l++){d=t[l];for(let _=0;_<d.buffers.length;_++)o[_]=o[_]||0,o[_]+=d.buffers[_].data.length,h[_]=0}for(let l=0;l<d.buffers.length;l++)n[l]=new J3[db(d.buffers[l].data)](o[l]),e.buffers[l]=new Ne(n[l]);for(let l=0;l<t.length;l++){d=t[l];for(let _=0;_<d.buffers.length;_++)n[_].set(d.buffers[_].data,h[_]),h[_]+=d.buffers[_].data.length}if(e.attributes=d.attributes,d.indexBuffer){e.indexBuffer=e.buffers[d.buffers.indexOf(d.indexBuffer)],e.indexBuffer.type=Zr.ELEMENT_ARRAY_BUFFER;let l=0,_=0,m=0,v=0;for(let w=0;w<d.buffers.length;w++)if(d.buffers[w]!==d.indexBuffer){v=w;break}for(const w in d.attributes){const b=d.attributes[w];(b.buffer|0)===v&&(_+=b.size*r0[b.type]/4)}for(let w=0;w<t.length;w++){const b=t[w].indexBuffer.data;for(let T=0;T<b.length;T++)e.indexBuffer.data[T+m]+=l;l+=t[w].buffers[v].data.length/_,m+=b.length}}return e}}class pb extends hs{constructor(t=!1){super(),this._buffer=new Ne(null,t,!1),this._indexBuffer=new Ne(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Bt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Bt.FLOAT).addAttribute("aColor",this._buffer,4,!0,Bt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Bt.FLOAT).addIndex(this._indexBuffer)}}const pc=Math.PI*2,Q3=180/Math.PI,tM=Math.PI/180;var oi=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(oi||{});class ue{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ue(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}ue.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const $h=[new ue,new ue,new ue,new ue];class Jt{constructor(t=0,e=0,n=0,o=0){this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(o),this.type=oi.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Jt(0,0,0,0)}clone(){return new Jt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const R=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=R)return!1;const M=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>M}const n=this.left,o=this.right,h=this.top,d=this.bottom;if(o<=n||d<=h)return!1;const l=$h[0].set(t.left,t.top),_=$h[1].set(t.left,t.bottom),m=$h[2].set(t.right,t.top),v=$h[3].set(t.right,t.bottom);if(m.x<=l.x||_.y<=l.y)return!1;const w=Math.sign(e.a*e.d-e.b*e.c);if(w===0||(e.apply(l,l),e.apply(_,_),e.apply(m,m),e.apply(v,v),Math.max(l.x,_.x,m.x,v.x)<=n||Math.min(l.x,_.x,m.x,v.x)>=o||Math.max(l.y,_.y,m.y,v.y)<=h||Math.min(l.y,_.y,m.y,v.y)>=d))return!1;const b=w*(_.y-l.y),T=w*(l.x-_.x),r=b*n+T*h,a=b*o+T*h,u=b*n+T*d,f=b*o+T*d;if(Math.max(r,a,u,f)<=b*l.x+T*l.y||Math.min(r,a,u,f)>=b*v.x+T*v.y)return!1;const g=w*(l.y-m.y),x=w*(m.x-l.x),S=g*n+x*h,A=g*o+x*h,C=g*n+x*d,B=g*o+x*d;return!(Math.max(S,A,C,B)<=g*l.x+x*l.y||Math.min(S,A,C,B)>=g*v.x+x*v.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),o=Math.max(this.y,t.y),h=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=o,this.height=Math.max(h-o,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,o=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=o-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),o=Math.min(this.y,t.y),h=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=o,this.height=h-o,this}}Jt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Oc{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.radius=n,this.type=oi.CIRC}clone(){return new Oc(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let o=this.x-t,h=this.y-e;return o*=o,h*=h,o+h<=n}getBounds(){return new Jt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Oc.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Nc{constructor(t=0,e=0,n=0,o=0){this.x=t,this.y=e,this.width=n,this.height=o,this.type=oi.ELIP}clone(){return new Nc(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,o=(e-this.y)/this.height;return n*=n,o*=o,n+o<=1}getBounds(){return new Jt(this.x-this.width,this.y-this.height,this.width,this.height)}}Nc.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Qs{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const n=[];for(let o=0,h=e.length;o<h;o++)n.push(e[o].x,e[o].y);e=n}this.points=e,this.type=oi.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Qs(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let n=!1;const o=this.points.length/2;for(let h=0,d=o-1;h<o;d=h++){const l=this.points[h*2],_=this.points[h*2+1],m=this.points[d*2],v=this.points[d*2+1];_>e!=v>e&&t<(m-l)*((e-_)/(v-_))+l&&(n=!n)}return n}}Qs.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((s,t)=>`${s}, ${t}`,"")}]`};class zc{constructor(t=0,e=0,n=0,o=0,h=20){this.x=t,this.y=e,this.width=n,this.height=o,this.radius=h,this.type=oi.RREC}clone(){return new zc(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let o=t-(this.x+n),h=e-(this.y+n);const d=n*n;if(o*o+h*h<=d||(o=t-(this.x+this.width-n),o*o+h*h<=d)||(h=e-(this.y+this.height-n),o*o+h*h<=d)||(o=t-(this.x+n),o*o+h*h<=d))return!0}return!1}}zc.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Se{constructor(t=1,e=0,n=0,o=1,h=0,d=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=o,this.tx=h,this.ty=d}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,o,h,d){return this.a=t,this.b=e,this.c=n,this.d=o,this.tx=h,this.ty=d,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new ue;const n=t.x,o=t.y;return e.x=this.a*n+this.c*o+this.tx,e.y=this.b*n+this.d*o+this.ty,e}applyInverse(t,e){e=e||new ue;const n=1/(this.a*this.d+this.c*-this.b),o=t.x,h=t.y;return e.x=this.d*n*o+-this.c*n*h+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*h+-this.b*n*o+(-this.ty*this.a+this.tx*this.b)*n,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),o=this.a,h=this.c,d=this.tx;return this.a=o*e-this.b*n,this.b=o*n+this.b*e,this.c=h*e-this.d*n,this.d=h*n+this.d*e,this.tx=d*e-this.ty*n,this.ty=d*n+this.ty*e,this}append(t){const e=this.a,n=this.b,o=this.c,h=this.d;return this.a=t.a*e+t.b*o,this.b=t.a*n+t.b*h,this.c=t.c*e+t.d*o,this.d=t.c*n+t.d*h,this.tx=t.tx*e+t.ty*o+this.tx,this.ty=t.tx*n+t.ty*h+this.ty,this}setTransform(t,e,n,o,h,d,l,_,m){return this.a=Math.cos(l+m)*h,this.b=Math.sin(l+m)*h,this.c=-Math.sin(l-_)*d,this.d=Math.cos(l-_)*d,this.tx=t-(n*this.a+o*this.c),this.ty=e-(n*this.b+o*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const n=this.a,o=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=o*t.a+this.d*t.c,this.d=o*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,o=this.c,h=this.d,d=t.pivot,l=-Math.atan2(-o,h),_=Math.atan2(n,e),m=Math.abs(l+_);return m<1e-5||Math.abs(pc-m)<1e-5?(t.rotation=_,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=l,t.skew.y=_),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(o*o+h*h),t.position.x=this.tx+(d.x*e+d.y*o),t.position.y=this.ty+(d.x*n+d.y*h),t}invert(){const t=this.a,e=this.b,n=this.c,o=this.d,h=this.tx,d=t*o-e*n;return this.a=o/d,this.b=-e/d,this.c=-n/d,this.d=t/d,this.tx=(n*this.ty-o*h)/d,this.ty=-(t*this.ty-e*h)/d,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Se;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Se}static get TEMP_MATRIX(){return new Se}}Se.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Ds=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ks=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Os=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ns=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],e_=[],_b=[],Vh=Math.sign;function eM(){for(let s=0;s<16;s++){const t=[];e_.push(t);for(let e=0;e<16;e++){const n=Vh(Ds[s]*Ds[e]+Os[s]*ks[e]),o=Vh(ks[s]*Ds[e]+Ns[s]*ks[e]),h=Vh(Ds[s]*Os[e]+Os[s]*Ns[e]),d=Vh(ks[s]*Os[e]+Ns[s]*Ns[e]);for(let l=0;l<16;l++)if(Ds[l]===n&&ks[l]===o&&Os[l]===h&&Ns[l]===d){t.push(l);break}}}for(let s=0;s<16;s++){const t=new Se;t.set(Ds[s],ks[s],Os[s],Ns[s],0,0),_b.push(t)}}eM();const Ue={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Ds[s],uY:s=>ks[s],vX:s=>Os[s],vY:s=>Ns[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>e_[s][t],sub:(s,t)=>e_[s][Ue.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?Ue.S:Ue.N:Math.abs(t)*2<=Math.abs(s)?s>0?Ue.E:Ue.W:t>0?s>0?Ue.SE:Ue.SW:s>0?Ue.NE:Ue.NW,matrixAppendRotationInv:(s,t,e=0,n=0)=>{const o=_b[Ue.inv(t)];o.tx=e,o.ty=n,s.append(o)}};class An{constructor(t,e,n=0,o=0){this._x=n,this._y=o,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new An(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}An.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const i_=class{constructor(){this.worldTransform=new Se,this.localTransform=new Se,this.position=new An(this.onChange,this,0,0),this.scale=new An(this.onChange,this,1,1),this.pivot=new An(this.onChange,this,0,0),this.skew=new An(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const e=s.worldTransform,n=this.worldTransform;n.a=t.a*e.a+t.b*e.c,n.b=t.a*e.b+t.b*e.d,n.c=t.c*e.a+t.d*e.c,n.d=t.c*e.b+t.d*e.d,n.tx=t.tx*e.a+t.ty*e.c+e.tx,n.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};i_.IDENTITY=new i_;let K_=i_;K_.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var iM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,rM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function n0(s,t,e){const n=s.createShader(t);return s.shaderSource(n,e),s.compileShader(n),n}function jf(s){const t=new Array(s);for(let e=0;e<t.length;e++)t[e]=!1;return t}function gb(s,t){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return jf(2*t);case"bvec3":return jf(3*t);case"bvec4":return jf(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const mo=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,t)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(t==null||t.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,t)=>s.type==="mat3"&&s.size===1&&!s.isArray&&t.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,t)=>s.type==="vec2"&&s.size===1&&!s.isArray&&t.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,t)=>s.type==="vec4"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,t)=>s.type==="vec3"&&s.size===1&&!s.isArray&&t.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],nM={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},sM={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function aM(s,t){var n;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const o in s.uniforms){const h=t[o];if(!h){((n=s.uniforms[o])==null?void 0:n.group)===!0&&(s.uniforms[o].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${o}, '${o}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${o}, syncData);
                    `));continue}const d=s.uniforms[o];let l=!1;for(let _=0;_<mo.length;_++)if(mo[_].test(h,d)){e.push(mo[_].code(o,d)),l=!0;break}if(!l){const _=(h.size===1&&!h.isArray?nM:sM)[h.type].replace("location",`ud["${o}"].location`);e.push(`
            cu = ud["${o}"];
            cv = cu.value;
            v = uv["${o}"];
            ${_};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const mb={};let Ia=mb;function oM(){if(Ia===mb||Ia!=null&&Ia.isContextLost()){const s=wt.ADAPTER.createCanvas();let t;wt.PREFER_ENV>=aa.WEBGL2&&(t=s.getContext("webgl2",{})),t||(t=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Ia=t}return Ia}let Wh;function lM(){if(!Wh){Wh=nr.MEDIUM;const s=oM();if(s&&s.getShaderPrecisionFormat){const t=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);t&&(Wh=t.precision?nr.HIGH:nr.MEDIUM)}}return Wh}function s0(s,t){const e=s.getShaderSource(t).split(`
`).map((m,v)=>`${v}: ${m}`),n=s.getShaderInfoLog(t),o=n.split(`
`),h={},d=o.map(m=>parseFloat(m.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(m=>m&&!h[m]?(h[m]=!0,!0):!1),l=[""];d.forEach(m=>{e[m-1]=`%c${e[m-1]}%c`,l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const _=e.join(`
`);l[0]=_,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...l),console.groupEnd()}function hM(s,t,e,n){s.getProgramParameter(t,s.LINK_STATUS)||(s.getShaderParameter(e,s.COMPILE_STATUS)||s0(s,e),s.getShaderParameter(n,s.COMPILE_STATUS)||s0(s,n),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(t)))}const uM={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function yb(s){return uM[s]}let Xh=null;const a0={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function vb(s,t){if(!Xh){const e=Object.keys(a0);Xh={};for(let n=0;n<e.length;++n){const o=e[n];Xh[s[o]]=a0[o]}}return Xh[t]}function o0(s,t,e){if(s.substring(0,9)!=="precision"){let n=t;return t===nr.HIGH&&e!==nr.HIGH&&(n=nr.MEDIUM),`precision ${n} float;
${s}`}else if(e!==nr.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let rl;function cM(){if(typeof rl=="boolean")return rl;try{rl=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{rl=!1}return rl}let dM=0;const Yh={},r_=class Qa{constructor(t,e,n="pixi-shader",o={}){this.extra={},this.id=dM++,this.vertexSrc=t||Qa.defaultVertexSrc,this.fragmentSrc=e||Qa.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=o,this.vertexSrc.substring(0,8)!=="#version"&&(n=n.replace(/\s+/g,"-"),Yh[n]?(Yh[n]++,n+=`-${Yh[n]}`):Yh[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}
${this.fragmentSrc}`,this.vertexSrc=o0(this.vertexSrc,Qa.defaultVertexPrecision,nr.HIGH),this.fragmentSrc=o0(this.fragmentSrc,Qa.defaultFragmentPrecision,lM())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return rM}static get defaultFragmentSrc(){return iM}static from(t,e,n){const o=t+e;let h=Qv[o];return h||(Qv[o]=h=new Qa(t,e,n)),h}};r_.defaultVertexPrecision=nr.HIGH,r_.defaultFragmentPrecision=Tn.apple.device?nr.HIGH:nr.MEDIUM;let Cn=r_,fM=0;class Ar{constructor(t,e,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=fM++,this.static=!!e,this.ubo=!!n,t instanceof Ne?(this.buffer=t,this.buffer.type=Zr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ne(new Float32Array(1)),this.buffer.type=Zr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,n){if(!this.ubo)this.uniforms[t]=new Ar(e,n);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,n){return new Ar(t,e,n)}static uboFrom(t,e){return new Ar(t,e??!0,!0)}}class Jr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Ar?this.uniformGroup=e:this.uniformGroup=new Ar(e):this.uniformGroup=new Ar({}),this.disposeRunner=new Tr("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const n in e.uniforms){const o=e.uniforms[n];if(o.group===!0&&this.checkUniformExists(t,o))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,n){const o=Cn.from(t,e);return new Jr(o,n)}}class pM{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const n=new Int32Array(t);for(let h=0;h<t;h++)n[h]=h;this.defaultGroupCache[t]=Ar.from({uSamplers:n},!0);let o=this.fragTemplate;o=o.replace(/%count%/gi,`${t}`),o=o.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Cn(this.vertexSrc,o)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Se,default:this.defaultGroupCache[t]};return new Jr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let n=0;n<t;n++)n>0&&(e+=`
else `),n<t-1&&(e+=`if(vTextureId < ${n}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${n}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class n_{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function _M(){return!Tn.apple.device}function gM(s){let t=!0;const e=wt.ADAPTER.getNavigator();if(Tn.tablet||Tn.phone){if(Tn.apple.device){const n=e.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)<11&&(t=!1)}if(Tn.android.device){const n=e.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)<7&&(t=!1)}}return t?s:4}class Gc{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var mM=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,yM=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const gl=class vr extends Gc{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=pb,this.vertexSize=6,this.state=tn.for2d(),this.size=vr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??gM(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??_M(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return ne("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return yM}static get defaultFragmentTemplate(){return mM}setShaderGenerator({vertex:t=vr.defaultVertexSrc,fragment:e=vr.defaultFragmentTemplate}={}){this.shaderGenerator=new pM(t,e)}contextChange(){const t=this.renderer.gl;wt.PREFER_ENV===aa.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),vr.defaultMaxTextures),this.maxTextures=X3(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=vr,n=this.size/4,o=Math.floor(n/this.maxTextures)+1;for(;t.length<n;)t.push(new t_);for(;e.length<o;)e.push(new n_);for(let h=0;h<this.maxTextures;h++)this._tempBoundTextures[h]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,n=vr._textureArrayPool,o=this.renderer.batch,h=this._tempBoundTextures,d=this.renderer.textureGC.count;let l=++qt._globalBatch,_=0,m=n[0],v=0;o.copyBoundTextures(h,e);for(let w=0;w<this._bufferSize;++w){const b=t[w];t[w]=null,b._batchEnabled!==l&&(m.count>=e&&(o.boundArray(m,h,l,e),this.buildDrawCalls(m,v,w),v=w,m=n[++_],++l),b._batchEnabled=l,b.touched=d,m.elements[m.count++]=b)}m.count>0&&(o.boundArray(m,h,l,e),this.buildDrawCalls(m,v,this._bufferSize),++_,++l);for(let w=0;w<h.length;w++)h[w]=null;qt._globalBatch=l}buildDrawCalls(t,e,n){const{_bufferedElements:o,_attributeBuffer:h,_indexBuffer:d,vertexSize:l}=this,_=vr._drawCallPool;let m=this._dcIndex,v=this._aIndex,w=this._iIndex,b=_[m];b.start=this._iIndex,b.texArray=t;for(let T=e;T<n;++T){const r=o[T],a=r._texture.baseTexture,u=ub[a.alphaMode?1:0][r.blendMode];o[T]=null,e<T&&b.blend!==u&&(b.size=w-b.start,e=T,b=_[++m],b.texArray=t,b.start=w),this.packInterleavedGeometry(r,h,d,v,w),v+=r.vertexData.length/2*l,w+=r.indices.length,b.blend=u}e<n&&(b.size=w-b.start,++m),this._dcIndex=m,this._aIndex=v,this._iIndex=w}bindAndClearTexArray(t){const e=this.renderer.texture;for(let n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:n}=this;vr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:n}=this.renderer,o=vr._drawCallPool;let h=null;for(let d=0;d<t;d++){const{texArray:l,type:_,size:m,start:v,blend:w}=o[d];h!==l&&(h=l,this.bindAndClearTexArray(l)),this.state.blendMode=w,n.set(this.state),e.drawElements(_,m,e.UNSIGNED_SHORT,v*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),vr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=dc(Math.ceil(t/8)),n=Zv(e),o=e*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let h=this._aBuffers[o];return h||(this._aBuffers[o]=h=new Zp(o*this.vertexSize*4)),h}getIndexBuffer(t){const e=dc(Math.ceil(t/12)),n=Zv(e),o=e*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let h=this._iBuffers[n];return h||(this._iBuffers[n]=h=new Uint16Array(o)),h}packInterleavedGeometry(t,e,n,o,h){const{uint32View:d,float32View:l}=e,_=o/this.vertexSize,m=t.uvs,v=t.indices,w=t.vertexData,b=t._texture.baseTexture._batchLocation,T=Math.min(t.worldAlpha,1),r=we.shared.setValue(t._tintRGB).toPremultiplied(T,t._texture.baseTexture.alphaMode>0);for(let a=0;a<w.length;a+=2)l[o++]=w[a],l[o++]=w[a+1],l[o++]=m[a],l[o++]=m[a+1],d[o++]=r,l[o++]=b;for(let a=0;a<v.length;a++)n[h++]=_+v[a]}};gl.defaultBatchSize=4096,gl.extension={name:"batch",type:yt.RendererPlugin},gl._drawCallPool=[],gl._textureArrayPool=[];let zs=gl;Ut.add(zs);var vM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,xM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const s_=class ml extends Jr{constructor(t,e,n){const o=Cn.from(t||ml.defaultVertexSrc,e||ml.defaultFragmentSrc);super(o,n),this.padding=0,this.resolution=ml.defaultResolution,this.multisample=ml.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new tn}apply(t,e,n,o,h){t.applyFilter(this,e,n,o)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return xM}static get defaultFragmentSrc(){return vM}};s_.defaultResolution=1,s_.defaultMultisample=Ge.NONE;let Si=s_;class _c{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new we(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:n,backgroundAlpha:o}=t,h=n??e;h!==void 0&&(this.color=h),this.alpha=o}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}_c.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},_c.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"background"};Ut.add(_c);class xb{constructor(t){this.renderer=t,this.emptyRenderer=new Gc(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:n}=this.renderer.texture;for(let o=e-1;o>=0;--o)t[o]=n[o]||null,t[o]&&(t[o]._batchLocation=o)}boundArray(t,e,n,o){const{elements:h,ids:d,count:l}=t;let _=0;for(let m=0;m<l;m++){const v=h[m],w=v._batchLocation;if(w>=0&&w<o&&e[w]===v){d[m]=w;continue}for(;_<o;){const b=e[_];if(b&&b._batchEnabled===n&&b._batchLocation===_){_++;continue}d[m]=_,v._batchLocation=_,e[_]=v;break}}}destroy(){this.renderer=null}}xb.extension={type:yt.RendererSystem,name:"batch"};Ut.add(xb);let l0=0;class gc{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=l0++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=l0++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let n;if(wt.PREFER_ENV>=aa.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const o=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=o,o||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}gc.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},gc.extension={type:yt.RendererSystem,name:"context"};Ut.add(gc);class a_{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Tr("disposeFramebuffer"),this.multisample=Ge.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new qt(null,{scaleMode:En.NEAREST,resolution:1,mipmap:Qr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new qt(null,{scaleMode:En.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Qr.OFF,format:ft.DEPTH_COMPONENT,type:Bt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const o=this.colorTextures[n],h=o.resolution;o.setSize(t/h,e/h)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class bb extends qt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],n=arguments[1],o=arguments[2],h=arguments[3];t={width:e,height:n,scaleMode:o,resolution:h}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Ge.NONE),super(null,t),this.mipmap=Qr.OFF,this.valid=!0,this._clear=new we([0,0,0,0]),this.framebuffer=new a_(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Rn extends kl{constructor(t){const e=t,n=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,o=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(n,o),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,n){n===void 0&&!e.startsWith("data:")?t.crossOrigin=$3(e):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")}upload(t,e,n,o){const h=t.gl,d=e.realWidth,l=e.realHeight;if(o=o||this.source,typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement){if(!o.complete||o.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement&&o.readyState<=1)return!1;return h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Ri.UNPACK),!this.noSubImage&&e.target===h.TEXTURE_2D&&n.width===d&&n.height===l?h.texSubImage2D(h.TEXTURE_2D,0,0,0,e.format,n.type,o):(n.width=d,n.height=l,h.texImage2D(e.target,0,n.internalFormat,e.format,n.type,o)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(e,n),super.update()}dispose(){this.source=null}}class wb extends Rn{constructor(t,e){if(e=e||{},typeof t=="string"){const n=new Image;Rn.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??wt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,n)=>{const o=this.source;this.url=o.src;const h=()=>{this.destroyed||(o.onload=null,o.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};o.complete&&o.src?h():(o.onload=h,o.onerror=d=>{n(d),this.onError.emit(d)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,n=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then(o=>o.blob()).then(o=>e(o,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ri.UNPACK?"premultiply":"none"})).then(o=>this.destroyed?Promise.reject():(this.bitmap=o,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,n){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,n,this.bitmap),!this.preserveBitmap){let o=!0;const h=e._glTextures;for(const d in h){const l=h[d];if(l!==n&&l.dirtyId!==e.dirtyId){o=!1;break}}o&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Z_{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,n){const o=e.width,h=e.height;if(n){const d=t.width/2/o,l=t.height/2/h,_=t.x/o+d,m=t.y/h+l;n=Ue.add(n,Ue.NW),this.x0=_+d*Ue.uX(n),this.y0=m+l*Ue.uY(n),n=Ue.add(n,2),this.x1=_+d*Ue.uX(n),this.y1=m+l*Ue.uY(n),n=Ue.add(n,2),this.x2=_+d*Ue.uX(n),this.y2=m+l*Ue.uY(n),n=Ue.add(n,2),this.x3=_+d*Ue.uX(n),this.y3=m+l*Ue.uY(n)}else this.x0=t.x/o,this.y0=t.y/h,this.x1=(t.x+t.width)/o,this.y1=t.y/h,this.x2=(t.x+t.width)/o,this.y2=(t.y+t.height)/h,this.x3=t.x/o,this.y3=(t.y+t.height)/h;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Z_.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const h0=new Z_;function jh(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class Ct extends Gl{constructor(t,e,n,o,h,d,l){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Jt(0,0,1,1)),t instanceof Ct&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=o,this.valid=!1,this.destroyed=!1,this._uvs=h0,this.uvMatrix=null,this.orig=n||e,this._rotate=Number(h||0),h===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=d?new ue(d.x,d.y):new ue(0,0),this.defaultBorders=l,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&Gr[e.url]&&Ct.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ct.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var o;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),n=new Ct(this.baseTexture,!this.noFrame&&t,e,(o=this.trim)==null?void 0:o.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===h0&&(this._uvs=new Z_),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},n=wt.STRICT_TEXTURE_CACHE){const o=typeof t=="string";let h=null;if(o)h=t;else if(t instanceof qt){if(!t.cacheId){const l=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${l}-${ra()}`,qt.addToCache(t,t.cacheId)}h=t.cacheId}else{if(!t._pixiId){const l=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${l}_${ra()}`}h=t._pixiId}let d=Gr[h];if(o&&n&&!d)throw new Error(`The cacheId "${h}" does not exist in TextureCache.`);return!d&&!(t instanceof qt)?(e.resolution||(e.resolution=Pn(t)),d=new Ct(new qt(t,e)),d.baseTexture.cacheId=h,qt.addToCache(d.baseTexture,h),Ct.addToCache(d,h)):!d&&t instanceof qt&&(d=new Ct(t),Ct.addToCache(d,h)),d}static fromURL(t,e){const n=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),o=Ct.from(t,Object.assign({resourceOptions:n},e),!1),h=o.baseTexture.resource;return o.baseTexture.valid?Promise.resolve(o):h.load().then(()=>Promise.resolve(o))}static fromBuffer(t,e,n,o){return new Ct(qt.fromBuffer(t,e,n,o))}static fromLoader(t,e,n,o){const h=new qt(t,Object.assign({scaleMode:qt.defaultOptions.scaleMode,resolution:Pn(e)},o)),{resource:d}=h;d instanceof wb&&(d.url=e);const l=new Ct(h);return n||(n=e),qt.addToCache(l.baseTexture,n),Ct.addToCache(l,n),n!==e&&(qt.addToCache(l.baseTexture,e),Ct.addToCache(l,e)),l.baseTexture.valid?Promise.resolve(l):new Promise(_=>{l.baseTexture.once("loaded",()=>_(l))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Gr[e]&&Gr[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Gr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Gr[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Gr[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Gr[t.textureCacheIds[e]]===t&&delete Gr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:n,width:o,height:h}=t,d=e+o>this.baseTexture.width,l=n+h>this.baseTexture.height;if(d||l){const _=d&&l?"and":"or",m=`X: ${e} + ${o} = ${e+o} > ${this.baseTexture.width}`,v=`Y: ${n} + ${h} = ${n+h} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${m} ${_} ${v}`)}this.valid=o&&h&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ct._EMPTY||(Ct._EMPTY=new Ct(new qt),jh(Ct._EMPTY),jh(Ct._EMPTY.baseTexture)),Ct._EMPTY}static get WHITE(){if(!Ct._WHITE){const t=wt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ct._WHITE=new Ct(qt.from(t)),jh(Ct._WHITE),jh(Ct._WHITE.baseTexture)}return Ct._WHITE}}class oa extends Ct{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,n=!0){const o=this.baseTexture.resolution,h=Math.round(t*o)/o,d=Math.round(e*o)/o;this.valid=h>0&&d>0,this._frame.width=this.orig.width=h,this._frame.height=this.orig.height=d,n&&this.baseTexture.resize(h,d),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new oa(new bb(t))}}class Sb{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,n=Ge.NONE){const o=new bb(Object.assign({width:t,height:e,resolution:1,multisample:n},this.textureOptions));return new oa(o)}getOptimalTexture(t,e,n=1,o=Ge.NONE){let h;t=Math.max(Math.ceil(t*n-1e-6),1),e=Math.max(Math.ceil(e*n-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=dc(t),e=dc(e),h=((t&65535)<<16|e&65535)>>>0,o>1&&(h+=o*4294967296)):h=o>1?-o:-1,this.texturePool[h]||(this.texturePool[h]=[]);let d=this.texturePool[h].pop();return d||(d=this.createTexture(t,e,o)),d.filterPoolKey=h,d.setResolution(n),d}getFilterTexture(t,e,n){const o=this.getOptimalTexture(t.width,t.height,e||t.resolution,n||Ge.NONE);return o.filterFrame=t.filterFrame,o}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const n=this.texturePool[e];if(n)for(let o=0;o<n.length;o++)n[o].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const n=this.texturePool[e];if(n)for(let o=0;o<n.length;o++)n[o].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Sb.SCREEN_KEY=-1;class bM extends hs{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Eb extends hs{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ne(this.vertices),this.uvBuffer=new Ne(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let n=0,o=0;return this.uvs[0]=n,this.uvs[1]=o,this.uvs[2]=n+e.width/t.width,this.uvs[3]=o,this.uvs[4]=n+e.width/t.width,this.uvs[5]=o+e.height/t.height,this.uvs[6]=n,this.uvs[7]=o+e.height/t.height,n=e.x,o=e.y,this.vertices[0]=n,this.vertices[1]=o,this.vertices[2]=n+e.width,this.vertices[3]=o,this.vertices[4]=n+e.width,this.vertices[5]=o+e.height,this.vertices[6]=n,this.vertices[7]=o+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class wM{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Ge.NONE,this.sourceFrame=new Jt,this.destinationFrame=new Jt,this.bindingSourceFrame=new Jt,this.bindingDestinationFrame=new Jt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const qh=[new ue,new ue,new ue,new ue],qf=new Se;class Tb{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Sb,this.statePool=[],this.quad=new bM,this.quadUv=new Eb,this.tempRect=new Jt,this.activeState={},this.globalUniforms=new Ar({outputFrame:new Jt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const n=this.renderer,o=this.defaultFilterStack,h=this.statePool.pop()||new wM,d=n.renderTexture;let l,_;if(d.current){const u=d.current;l=u.resolution,_=u.multisample}else l=n.resolution,_=n.multisample;let m=e[0].resolution||l,v=e[0].multisample??_,w=e[0].padding,b=e[0].autoFit,T=e[0].legacy??!0;for(let u=1;u<e.length;u++){const f=e[u];m=Math.min(m,f.resolution||l),v=Math.min(v,f.multisample??_),w=this.useMaxPadding?Math.max(w,f.padding):w+f.padding,b=b&&f.autoFit,T=T||(f.legacy??!0)}o.length===1&&(this.defaultFilterStack[0].renderTexture=d.current),o.push(h),h.resolution=m,h.multisample=v,h.legacy=T,h.target=t,h.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),h.sourceFrame.pad(w);const r=this.tempRect.copyFrom(d.sourceFrame);n.projection.transform&&this.transformAABB(qf.copyFrom(n.projection.transform).invert(),r),b?(h.sourceFrame.fit(r),(h.sourceFrame.width<=0||h.sourceFrame.height<=0)&&(h.sourceFrame.width=0,h.sourceFrame.height=0)):h.sourceFrame.intersects(r)||(h.sourceFrame.width=0,h.sourceFrame.height=0),this.roundFrame(h.sourceFrame,d.current?d.current.resolution:n.resolution,d.sourceFrame,d.destinationFrame,n.projection.transform),h.renderTexture=this.getOptimalFilterTexture(h.sourceFrame.width,h.sourceFrame.height,m,v),h.filters=e,h.destinationFrame.width=h.renderTexture.width,h.destinationFrame.height=h.renderTexture.height;const a=this.tempRect;a.x=0,a.y=0,a.width=h.sourceFrame.width,a.height=h.sourceFrame.height,h.renderTexture.filterFrame=h.sourceFrame,h.bindingSourceFrame.copyFrom(d.sourceFrame),h.bindingDestinationFrame.copyFrom(d.destinationFrame),h.transform=n.projection.transform,n.projection.transform=null,d.bind(h.renderTexture,h.sourceFrame,a),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;const o=this.globalUniforms.uniforms;o.outputFrame=e.sourceFrame,o.resolution=e.resolution;const h=o.inputSize,d=o.inputPixel,l=o.inputClamp;if(h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=1/h[0],h[3]=1/h[1],d[0]=Math.round(h[0]*e.resolution),d[1]=Math.round(h[1]*e.resolution),d[2]=1/d[0],d[3]=1/d[1],l[0]=.5*d[2],l[1]=.5*d[3],l[2]=e.sourceFrame.width*h[2]-.5*d[2],l[3]=e.sourceFrame.height*h[3]-.5*d[3],e.legacy){const m=o.filterArea;m[0]=e.destinationFrame.width,m[1]=e.destinationFrame.height,m[2]=e.sourceFrame.x,m[3]=e.sourceFrame.y,o.filterClamp=o.inputClamp}this.globalUniforms.update();const _=t[t.length-1];if(this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,e.renderTexture,_.renderTexture,Yr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let m=e.renderTexture,v=this.getOptimalFilterTexture(m.width,m.height,e.resolution);v.filterFrame=m.filterFrame;let w=0;for(w=0;w<n.length-1;++w){w===1&&e.multisample>1&&(v=this.getOptimalFilterTexture(m.width,m.height,e.resolution),v.filterFrame=m.filterFrame),n[w].apply(this,m,v,Yr.CLEAR,e);const b=m;m=v,v=b}n[w].apply(this,m,_.renderTexture,Yr.BLEND,e),w>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(m),this.returnFilterTexture(v)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Yr.CLEAR){const{renderTexture:n,state:o}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const d=this.tempRect;d.x=0,d.y=0,d.width=t.filterFrame.width,d.height=t.filterFrame.height,n.bind(t,t.filterFrame,d)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const h=o.stateId&1||this.forceClear;(e===Yr.CLEAR||e===Yr.BLIT&&h)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,n,o){const h=this.renderer;h.state.set(t.state),this.bindAndClear(n,o),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,h.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),h.geometry.bind(this.quadUv),h.geometry.draw(Kr.TRIANGLES)):(h.geometry.bind(this.quad),h.geometry.draw(Kr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:n,destinationFrame:o}=this.activeState,{orig:h}=e._texture,d=t.set(o.width,0,0,o.height,n.x,n.y),l=e.worldTransform.copyTo(Se.TEMP_MATRIX);return l.invert(),d.prepend(l),d.scale(1/h.width,1/h.height),d.translate(e.anchor.x,e.anchor.y),d}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,n=1,o=Ge.NONE){return this.texturePool.getOptimalTexture(t,e,n,o)}getFilterTexture(t,e,n){if(typeof t=="number"){const h=t;t=e,e=h}t=t||this.activeState.renderTexture;const o=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,n||Ge.NONE);return o.filterFrame=t.filterFrame,o}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const n=qh[0],o=qh[1],h=qh[2],d=qh[3];n.set(e.left,e.top),o.set(e.left,e.bottom),h.set(e.right,e.top),d.set(e.right,e.bottom),t.apply(n,n),t.apply(o,o),t.apply(h,h),t.apply(d,d);const l=Math.min(n.x,o.x,h.x,d.x),_=Math.min(n.y,o.y,h.y,d.y),m=Math.max(n.x,o.x,h.x,d.x),v=Math.max(n.y,o.y,h.y,d.y);e.x=l,e.y=_,e.width=m-l,e.height=v-_}roundFrame(t,e,n,o,h){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(h){const{a:d,b:l,c:_,d:m}=h;if((Math.abs(l)>1e-4||Math.abs(_)>1e-4)&&(Math.abs(d)>1e-4||Math.abs(m)>1e-4))return}h=h?qf.copyFrom(h):qf.identity(),h.translate(-n.x,-n.y).scale(o.width/n.width,o.height/n.height).translate(o.x,o.y),this.transformAABB(h,t),t.ceil(e),this.transformAABB(h.invert(),t)}}}Tb.extension={type:yt.RendererSystem,name:"filter"};Ut.add(Tb);class SM{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Ge.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const EM=new Jt;class Ab{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new a_(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Jt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;wt.PREFER_ENV===aa.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=o=>e.drawBuffersWEBGL(o):(this.hasMRT=!1,t.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,n=0){const{gl:o}=this;if(t){const h=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,o.bindFramebuffer(o.FRAMEBUFFER,h.framebuffer)),h.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,h.mipLevel=n),h.dirtyId!==t.dirtyId&&(h.dirtyId=t.dirtyId,h.dirtyFormat!==t.dirtyFormat?(h.dirtyFormat=t.dirtyFormat,h.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):h.dirtySize!==t.dirtySize&&(h.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let d=0;d<t.colorTextures.length;d++){const l=t.colorTextures[d];this.renderer.texture.unbind(l.parentTextureArray||l)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const d=e.width>>n,l=e.height>>n,_=d/e.width;this.setViewport(e.x*_,e.y*_,d,l)}else{const d=t.width>>n,l=t.height>>n;this.setViewport(0,0,d,l)}}else this.current&&(this.current=null,o.bindFramebuffer(o.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,n,o){const h=this.viewport;t=Math.round(t),e=Math.round(e),n=Math.round(n),o=Math.round(o),(h.width!==n||h.height!==o||h.x!==t||h.y!==e)&&(h.x=t,h.y=e,h.width=n,h.height=o,this.gl.viewport(t,e,n,o))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,n,o,h=Mp.COLOR|Mp.DEPTH){const{gl:d}=this;d.clearColor(t,e,n,o),d.clear(h)}initFramebuffer(t){const{gl:e}=this,n=new SM(e.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:e}=this,n=t.glFramebuffers[this.CONTEXT_UID];if(n.stencil){e.bindRenderbuffer(e.RENDERBUFFER,n.stencil);let d;this.renderer.context.webGLVersion===1?d=e.DEPTH_STENCIL:t.depth&&t.stencil?d=e.DEPTH24_STENCIL8:t.depth?d=e.DEPTH_COMPONENT24:d=e.STENCIL_INDEX8,n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,d,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,d,t.width,t.height)}const o=t.colorTextures;let h=o.length;e.drawBuffers||(h=Math.min(h,1));for(let d=0;d<h;d++){const l=o[d],_=l.parentTextureArray||l;this.renderer.texture.bind(_,0),d===0&&n.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,n.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,_._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:n}=this,o=t.glFramebuffers[this.CONTEXT_UID],h=t.colorTextures;let d=h.length;n.drawBuffers||(d=Math.min(d,1)),o.multisample>1&&this.canMultisampleFramebuffer(t)?o.msaaBuffer=o.msaaBuffer||n.createRenderbuffer():o.msaaBuffer&&(n.deleteRenderbuffer(o.msaaBuffer),o.msaaBuffer=null,o.blitFramebuffer&&(o.blitFramebuffer.dispose(),o.blitFramebuffer=null));const l=[];for(let _=0;_<d;_++){const m=h[_],v=m.parentTextureArray||m;this.renderer.texture.bind(v,0),_===0&&o.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,o.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,o.multisample,v._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,o.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+_,m.target,v._glTextures[this.CONTEXT_UID].texture,e),l.push(n.COLOR_ATTACHMENT0+_))}if(l.length>1&&n.drawBuffers(l),t.depthTexture&&this.writeDepthTexture){const _=t.depthTexture;this.renderer.texture.bind(_,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,_._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){o.stencil=o.stencil||n.createRenderbuffer();let _,m;this.renderer.context.webGLVersion===1?(_=n.DEPTH_STENCIL_ATTACHMENT,m=n.DEPTH_STENCIL):t.depth&&t.stencil?(_=n.DEPTH_STENCIL_ATTACHMENT,m=n.DEPTH24_STENCIL8):t.depth?(_=n.DEPTH_ATTACHMENT,m=n.DEPTH_COMPONENT24):(_=n.STENCIL_ATTACHMENT,m=n.STENCIL_INDEX8),n.bindRenderbuffer(n.RENDERBUFFER,o.stencil),o.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,o.multisample,m,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,m,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,_,n.RENDERBUFFER,o.stencil)}else o.stencil&&(n.deleteRenderbuffer(o.stencil),o.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let n=Ge.NONE;if(t<=1||e===null)return n;for(let o=0;o<e.length;o++)if(e[o]<=t){n=e[o];break}return n===1&&(n=Ge.NONE),n}blit(t,e,n){const{current:o,renderer:h,gl:d,CONTEXT_UID:l}=this;if(h.context.webGLVersion!==2||!o)return;const _=o.glFramebuffers[l];if(!_)return;if(!t){if(!_.msaaBuffer)return;const v=o.colorTextures[0];if(!v)return;_.blitFramebuffer||(_.blitFramebuffer=new a_(o.width,o.height),_.blitFramebuffer.addColorTexture(0,v)),t=_.blitFramebuffer,t.colorTextures[0]!==v&&(t.colorTextures[0]=v,t.dirtyId++,t.dirtyFormat++),(t.width!==o.width||t.height!==o.height)&&(t.width=o.width,t.height=o.height,t.dirtyId++,t.dirtySize++)}e||(e=EM,e.width=o.width,e.height=o.height),n||(n=e);const m=e.width===n.width&&e.height===n.height;this.bind(t),d.bindFramebuffer(d.READ_FRAMEBUFFER,_.framebuffer),d.blitFramebuffer(e.left,e.top,e.right,e.bottom,n.left,n.top,n.right,n.bottom,d.COLOR_BUFFER_BIT,m?d.NEAREST:d.LINEAR),d.bindFramebuffer(d.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const n=t.glFramebuffers[this.CONTEXT_UID],o=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const h=this.managedFramebuffers.indexOf(t);h>=0&&this.managedFramebuffers.splice(h,1),t.disposeRunner.remove(this),e||(o.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&o.deleteRenderbuffer(n.msaaBuffer),n.stencil&&o.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&this.disposeFramebuffer(n.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const n=t.width,o=t.height,h=this.gl,d=e.stencil=h.createRenderbuffer();h.bindRenderbuffer(h.RENDERBUFFER,d);let l,_;this.renderer.context.webGLVersion===1?(l=h.DEPTH_STENCIL_ATTACHMENT,_=h.DEPTH_STENCIL):t.depth?(l=h.DEPTH_STENCIL_ATTACHMENT,_=h.DEPTH24_STENCIL8):(l=h.STENCIL_ATTACHMENT,_=h.STENCIL_INDEX8),e.msaaBuffer?h.renderbufferStorageMultisample(h.RENDERBUFFER,e.multisample,_,n,o):h.renderbufferStorage(h.RENDERBUFFER,_,n,o),h.framebufferRenderbuffer(h.FRAMEBUFFER,l,h.RENDERBUFFER,d)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Jt}destroy(){this.renderer=null}}Ab.extension={type:yt.RendererSystem,name:"framebuffer"};Ut.add(Ab);const Kf={5126:4,5123:2,5121:1};class Cb{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let n=this.renderer.context.extensions.vertexArrayObject;wt.PREFER_ENV===aa.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=()=>n.createVertexArrayOES(),t.bindVertexArray=o=>n.bindVertexArrayOES(o),t.deleteVertexArray=o=>n.deleteVertexArrayOES(o)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=(o,h)=>n.vertexAttribDivisorANGLE(o,h),t.drawElementsInstanced=(o,h,d,l,_)=>n.drawElementsInstancedANGLE(o,h,d,l,_),t.drawArraysInstanced=(o,h,d,l)=>n.drawArraysInstancedANGLE(o,h,d,l)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:n}=this;let o=t.glVertexArrayObjects[this.CONTEXT_UID],h=!1;o||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=o={},h=!0);const d=o[e.program.id]||this.initGeometryVao(t,e,h);this._activeGeometry=t,this._activeVao!==d&&(this._activeVao=d,this.hasVao?n.bindVertexArray(d):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const o=t.buffers[n];e.update(o)}}checkCompatibility(t,e){const n=t.attributes,o=e.attributeData;for(const h in o)if(!n[h])throw new Error(`shader and geometry incompatible, geometry missing the "${h}" attribute`)}getSignature(t,e){const n=t.attributes,o=e.attributeData,h=["g",t.id];for(const d in n)o[d]&&h.push(d,o[d].location);return h.join("-")}initGeometryVao(t,e,n=!0){const o=this.gl,h=this.CONTEXT_UID,d=this.renderer.buffer,l=e.program;l.glPrograms[h]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,l);const _=this.getSignature(t,l),m=t.glVertexArrayObjects[this.CONTEXT_UID];let v=m[_];if(v)return m[l.id]=v,v;const w=t.buffers,b=t.attributes,T={},r={};for(const a in w)T[a]=0,r[a]=0;for(const a in b)!b[a].size&&l.attributeData[a]?b[a].size=l.attributeData[a].size:b[a].size||console.warn(`PIXI Geometry attribute '${a}' size cannot be determined (likely the bound shader does not have the attribute)`),T[b[a].buffer]+=b[a].size*Kf[b[a].type];for(const a in b){const u=b[a],f=u.size;u.stride===void 0&&(T[u.buffer]===f*Kf[u.type]?u.stride=0:u.stride=T[u.buffer]),u.start===void 0&&(u.start=r[u.buffer],r[u.buffer]+=f*Kf[u.type])}v=o.createVertexArray(),o.bindVertexArray(v);for(let a=0;a<w.length;a++){const u=w[a];d.bind(u),n&&u._glBuffers[h].refCount++}return this.activateVao(t,l),m[l.id]=v,m[_]=v,o.bindVertexArray(null),d.unbind(Zr.ARRAY_BUFFER),v}disposeGeometry(t,e){var l;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],o=this.gl,h=t.buffers,d=(l=this.renderer)==null?void 0:l.buffer;if(t.disposeRunner.remove(this),!!n){if(d)for(let _=0;_<h.length;_++){const m=h[_]._glBuffers[this.CONTEXT_UID];m&&(m.refCount--,m.refCount===0&&!e&&d.dispose(h[_],e))}if(!e){for(const _ in n)if(_[0]==="g"){const m=n[_];this._activeVao===m&&this.unbind(),o.deleteVertexArray(m)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t)}activateVao(t,e){const n=this.gl,o=this.CONTEXT_UID,h=this.renderer.buffer,d=t.buffers,l=t.attributes;t.indexBuffer&&h.bind(t.indexBuffer);let _=null;for(const m in l){const v=l[m],w=d[v.buffer],b=w._glBuffers[o];if(e.attributeData[m]){_!==b&&(h.bind(w),_=b);const T=e.attributeData[m].location;if(n.enableVertexAttribArray(T),n.vertexAttribPointer(T,v.size,v.type||n.FLOAT,v.normalized,v.stride,v.start),v.instance)if(this.hasInstance)n.vertexAttribDivisor(T,v.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,n,o){const{gl:h}=this,d=this._activeGeometry;if(d.indexBuffer){const l=d.indexBuffer.data.BYTES_PER_ELEMENT,_=l===2?h.UNSIGNED_SHORT:h.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?d.instanced?h.drawElementsInstanced(t,e||d.indexBuffer.data.length,_,(n||0)*l,o||1):h.drawElements(t,e||d.indexBuffer.data.length,_,(n||0)*l):console.warn("unsupported index buffer type: uint32")}else d.instanced?h.drawArraysInstanced(t,n,e||d.getSize(),o||1):h.drawArrays(t,n,e||d.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Cb.extension={type:yt.RendererSystem,name:"geometry"};Ut.add(Cb);const u0=new Se;class Ub{constructor(t,e){this._texture=t,this.mapCoord=new Se,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const n=this.mapCoord;for(let o=0;o<t.length;o+=2){const h=t[o],d=t[o+1];e[o]=h*n.a+d*n.c+n.tx,e[o+1]=h*n.b+d*n.d+n.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const o=e.orig,h=e.trim;h&&(u0.set(o.width/h.width,0,0,o.height/h.height,-h.x/h.width,-h.y/h.height),this.mapCoord.append(u0));const d=e.baseTexture,l=this.uClampFrame,_=this.clampMargin/d.resolution,m=this.clampOffset;return l[0]=(e._frame.x+_+m)/d.width,l[1]=(e._frame.y+_+m)/d.height,l[2]=(e._frame.x+e._frame.width-_+m)/d.width,l[3]=(e._frame.y+e._frame.height-_+m)/d.height,this.uClampOffset[0]=m/d.realWidth,this.uClampOffset[1]=m/d.realHeight,this.isSimple=e._frame.width===d.width&&e._frame.height===d.height&&e.rotate===0,!0}}var TM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,AM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class CM extends Si{constructor(t,e,n){let o=null;typeof t!="string"&&e===void 0&&n===void 0&&(o=t,t=void 0,e=void 0,n=void 0),super(t||AM,e||TM,n),this.maskSprite=o,this.maskMatrix=new Se}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,n,o){const h=this._maskSprite,d=h._texture;d.valid&&(d.uvMatrix||(d.uvMatrix=new Ub(d,0)),d.uvMatrix.update(),this.uniforms.npmAlpha=d.baseTexture.alphaMode?0:1,this.uniforms.mask=d,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,h).prepend(d.uvMatrix.mapCoord),this.uniforms.alpha=h.worldAlpha,this.uniforms.maskClamp=d.uvMatrix.uClampFrame,t.applyFilter(this,e,n,o))}}class UM{constructor(t=null){this.type=qe.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Si.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=qe.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Ib{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let n=e;if(!n.isMaskData){const h=this.maskDataPool.pop()||new UM;h.pooled=!0,h.maskObject=e,n=h}const o=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(o),n._colorMask=o?o._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==qe.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case qe.SCISSOR:this.renderer.scissor.push(n);break;case qe.STENCIL:this.renderer.stencil.push(n);break;case qe.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case qe.COLOR:this.pushColorMask(n);break}n.type===qe.SPRITE&&this.maskStack.push(n)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case qe.SCISSOR:this.renderer.scissor.pop(e);break;case qe.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case qe.SPRITE:this.popSpriteMask(e);break;case qe.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const n=this.maskStack[this.maskStack.length-1];n.type===qe.SPRITE&&n._filters&&(n._filters[0].maskSprite=n.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=qe.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=qe.SCISSOR:t.type=qe.STENCIL:t.type=qe.COLOR}pushSpriteMask(t){const{maskObject:e}=t,n=t._target;let o=t._filters;o||(o=this.alphaMaskPool[this.alphaMaskIndex],o||(o=this.alphaMaskPool[this.alphaMaskIndex]=[new CM])),o[0].resolution=t.resolution,o[0].multisample=t.multisample,o[0].maskSprite=e;const h=n.filterArea;n.filterArea=e.getBounds(!0),this.renderer.filter.push(n,o),n.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,n=t._colorMask=e&t.colorMask;n!==e&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}popColorMask(t){const e=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==e&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}destroy(){this.renderer=null}}Ib.extension={type:yt.RendererSystem,name:"mask"};Ut.add(Ib);class Pb{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,n=this.getStackLength();this.maskStack=t;const o=this.getStackLength();o!==n&&(o===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const c0=new Se,d0=[],Rb=class $u extends Pb{constructor(t){super(t),this.glConst=wt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:n}=t,{renderer:o}=this,h=o.renderTexture,d=n.getBounds(!0,d0.pop()??new Jt);this.roundFrameToPixels(d,h.current?h.current.resolution:o.resolution,h.sourceFrame,h.destinationFrame,o.projection.transform),e&&d.fit(e),t._scissorRectLocal=d}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:n,c:o,d:h}=t;return(Math.abs(n)>1e-4||Math.abs(o)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(h)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||$u.isMatrixRotated(e.worldTransform)||$u.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const n=t._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(t,e,n,o,h){$u.isMatrixRotated(h)||(h=h?c0.copyFrom(h):c0.identity(),h.translate(-n.x,-n.y).scale(o.width/n.width,o.height/n.height).translate(o.x,o.y),this.renderer.filter.transformAABB(h,t),t.fit(o),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&d0.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Rb.extension={type:yt.RendererSystem,name:"scissor"};let IM=Rb;Ut.add(IM);class Bb extends Pb{constructor(t){super(t),this.glConst=wt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:n}=this.renderer,o=t._stencilCounter;o===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const h=t._colorMask;h!==0&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,o,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,h!==0&&(t._colorMask=h,n.colorMask((h&1)!==0,(h&2)!==0,(h&4)!==0,(h&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,o=n?n._colorMask:15;o!==0&&(n._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,o!==0&&(n._colorMask=o,e.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Bb.extension={type:yt.RendererSystem,name:"stencil"};Ut.add(Bb);class Fb{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return ne("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return ne("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return ne("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Fb.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"_plugin"};Ut.add(Fb);class Mb{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Se,this.transform=null}update(t,e,n,o){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,o),this.transform&&this.projectionMatrix.append(this.transform);const h=this.renderer;h.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,h.globalUniforms.update(),h.shader.shader&&h.shader.syncUniformGroup(h.shader.shader.uniforms.globals)}calculateProjection(t,e,n,o){const h=this.projectionMatrix,d=o?-1:1;h.identity(),h.a=1/e.width*2,h.d=d*(1/e.height*2),h.tx=-1-e.x*h.a,h.ty=-d-e.y*h.d}setTransform(t){}destroy(){this.renderer=null}}Mb.extension={type:yt.RendererSystem,name:"projection"};Ut.add(Mb);const PM=new K_,f0=new Jt;class Lb{constructor(t){this.renderer=t,this._tempMatrix=new Se}generateTexture(t,e){const{region:n,...o}=e||{},h=(n==null?void 0:n.copyTo(f0))||t.getLocalBounds(f0,!0),d=o.resolution||this.renderer.resolution;h.width=Math.max(h.width,1/d),h.height=Math.max(h.height,1/d),o.width=h.width,o.height=h.height,o.resolution=d,o.multisample??(o.multisample=this.renderer.multisample);const l=oa.create(o);this._tempMatrix.tx=-h.x,this._tempMatrix.ty=-h.y;const _=t.transform;return t.transform=PM,this.renderer.render(t,{renderTexture:l,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=_,l}destroy(){}}Lb.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"textureGenerator"};Ut.add(Lb);const Ts=new Jt,nl=new Jt;class Db{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Jt,this.destinationFrame=new Jt,this.viewportFrame=new Jt}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,n){const o=this.renderer;this.current=t;let h,d,l;t?(h=t.baseTexture,l=h.resolution,e||(Ts.width=t.frame.width,Ts.height=t.frame.height,e=Ts),n||(nl.x=t.frame.x,nl.y=t.frame.y,nl.width=e.width,nl.height=e.height,n=nl),d=h.framebuffer):(l=o.resolution,e||(Ts.width=o._view.screen.width,Ts.height=o._view.screen.height,e=Ts),n||(n=Ts,n.width=e.width,n.height=e.height));const _=this.viewportFrame;_.x=n.x*l,_.y=n.y*l,_.width=n.width*l,_.height=n.height*l,t||(_.y=o.view.height-(_.y+_.height)),_.ceil(),this.renderer.framebuffer.bind(d,_),this.renderer.projection.update(n,e,l,!d),t?this.renderer.mask.setMaskStack(h.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(n)}clear(t,e){const n=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,o=we.shared.setValue(t||n);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&o.premultiply(o.alpha);const h=this.destinationFrame,d=this.current?this.current.baseTexture:this.renderer._view.screen,l=h.width!==d.width||h.height!==d.height;if(l){let{x:_,y:m,width:v,height:w}=this.viewportFrame;_=Math.round(_),m=Math.round(m),v=Math.round(v),w=Math.round(w),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(_,m,v,w)}this.renderer.framebuffer.clear(o.red,o.green,o.blue,o.alpha,e),l&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Db.extension={type:yt.RendererSystem,name:"renderTexture"};Ut.add(Db);class RM{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function BM(s,t){const e={},n=t.getProgramParameter(s,t.ACTIVE_ATTRIBUTES);for(let o=0;o<n;o++){const h=t.getActiveAttrib(s,o);if(h.name.startsWith("gl_"))continue;const d=vb(t,h.type),l={type:d,name:h.name,size:yb(d),location:t.getAttribLocation(s,h.name)};e[h.name]=l}return e}function FM(s,t){const e={},n=t.getProgramParameter(s,t.ACTIVE_UNIFORMS);for(let o=0;o<n;o++){const h=t.getActiveUniform(s,o),d=h.name.replace(/\[.*?\]$/,""),l=!!h.name.match(/\[.*?\]$/),_=vb(t,h.type);e[d]={name:d,index:o,type:_,size:h.size,isArray:l,value:gb(_,h.size)}}return e}function MM(s,t){var l;const e=n0(s,s.VERTEX_SHADER,t.vertexSrc),n=n0(s,s.FRAGMENT_SHADER,t.fragmentSrc),o=s.createProgram();s.attachShader(o,e),s.attachShader(o,n);const h=(l=t.extra)==null?void 0:l.transformFeedbackVaryings;if(h&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(o,h.names,h.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(o),s.getProgramParameter(o,s.LINK_STATUS)||hM(s,o,e,n),t.attributeData=BM(o,s),t.uniformData=FM(o,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const _=Object.keys(t.attributeData);_.sort((m,v)=>m>v?1:-1);for(let m=0;m<_.length;m++)t.attributeData[_[m]].location=m,s.bindAttribLocation(o,m,_[m]);s.linkProgram(o)}s.deleteShader(e),s.deleteShader(n);const d={};for(const _ in t.uniformData){const m=t.uniformData[_];d[_]={location:s.getUniformLocation(o,_),value:gb(m.type,m.size)}}return new RM(o,d)}function LM(s,t,e,n,o){e.buffer.update(o)}const DM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},kb={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function kM(s){const t=s.map(h=>({data:h,offset:0,dataLen:0,dirty:0}));let e=0,n=0,o=0;for(let h=0;h<t.length;h++){const d=t[h];if(e=kb[d.data.type],d.data.size>1&&(e=Math.max(e,16)*d.data.size),d.dataLen=e,n%e!==0&&n<16){const l=n%e%16;n+=l,o+=l}n+e>16?(o=Math.ceil(o/16)*16,d.offset=o,o+=e,n=e):(d.offset=o,n+=e,o+=e)}return o=Math.ceil(o/16)*16,{uboElements:t,size:o}}function OM(s,t){const e=[];for(const n in s)t[n]&&e.push(t[n]);return e.sort((n,o)=>n.index-o.index),e}function NM(s,t){if(!s.autoManage)return{size:0,syncFunc:LM};const e=OM(s.uniforms,t),{uboElements:n,size:o}=kM(e),h=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let d=0;d<n.length;d++){const l=n[d],_=s.uniforms[l.data.name],m=l.data.name;let v=!1;for(let w=0;w<mo.length;w++){const b=mo[w];if(b.codeUbo&&b.test(l.data,_)){h.push(`offset = ${l.offset/4};`,mo[w].codeUbo(l.data.name,_)),v=!0;break}}if(!v)if(l.data.size>1){const w=yb(l.data.type),b=Math.max(kb[l.data.type]/16,1),T=w/b,r=(4-T%4)%4;h.push(`
                cv = ud.${m}.value;
                v = uv.${m};
                offset = ${l.offset/4};

                t = 0;

                for(var i=0; i < ${l.data.size*b}; i++)
                {
                    for(var j = 0; j < ${T}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${r};
                }

                `)}else{const w=DM[l.data.type];h.push(`
                cv = ud.${m}.value;
                v = uv.${m};
                offset = ${l.offset/4};
                ${w};
                `)}}return h.push(`
       renderer.buffer.update(buffer);
    `),{size:o,syncFunc:new Function("ud","uv","renderer","syncData","buffer",h.join(`
`))}}let zM=0;const Kh={textureCount:0,uboCount:0};class Ob{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=zM++}systemCheck(){if(!cM())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,o=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(o.program)),e||(Kh.textureCount=0,Kh.uboCount=0,this.syncUniformGroup(t.uniformGroup,Kh)),o}setUniforms(t){const e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,e){const n=this.getGlProgram();(!t.static||t.dirtyId!==n.uniformDirtyGroups[t.id])&&(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))}syncUniforms(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=aM(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const n=this.getGlProgram();if(!t.static||t.dirtyId!==0||!n.uniformGroups[t.id]){t.dirtyId=0;const o=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,e);t.buffer.update(),o(n.uniformData,t.uniforms,this.renderer,Kh,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[e])}createSyncBufferGroup(t,e,n){const{gl:o}=this.renderer;this.renderer.buffer.bind(t.buffer);const h=this.gl.getUniformBlockIndex(e.program,n);e.uniformBufferBindings[n]=this.shader.uniformBindCount,o.uniformBlockBinding(e.program,h,this.shader.uniformBindCount),this.shader.uniformBindCount++;const d=this.getSignature(t,this.shader.program.uniformData,"ubo");let l=this._uboCache[d];if(l||(l=this._uboCache[d]=NM(t,this.shader.program.uniformData)),t.autoManage){const _=new Float32Array(l.size/4);t.buffer.update(_)}return e.uniformGroups[t.id]=l.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,n){const o=t.uniforms,h=[`${n}-`];for(const d in o)h.push(d),e[d]&&h.push(e[d].type);return h.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,n=t.program,o=MM(e,n);return n.glPrograms[this.renderer.CONTEXT_UID]=o,o}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Ob.extension={type:yt.RendererSystem,name:"shader"};Ut.add(Ob);class mc{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}mc.defaultOptions={hello:!1},mc.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"startup"};Ut.add(mc);function GM(s,t=[]){return t[Vt.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.ADD]=[s.ONE,s.ONE],t[Vt.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.NONE]=[0,0],t[Vt.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],t[Vt.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],t[Vt.SRC_IN]=[s.DST_ALPHA,s.ZERO],t[Vt.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],t[Vt.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[Vt.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],t[Vt.DST_IN]=[s.ZERO,s.SRC_ALPHA],t[Vt.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],t[Vt.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],t[Vt.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],t[Vt.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],t}const HM=0,$M=1,VM=2,WM=3,XM=4,YM=5,Nb=class o_{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Vt.NONE,this._blendEq=!1,this.map=[],this.map[HM]=this.setBlend,this.map[$M]=this.setOffset,this.map[VM]=this.setCullFace,this.map[WM]=this.setDepthTest,this.map[XM]=this.setFrontFace,this.map[YM]=this.setDepthMask,this.checks=[],this.defaultState=new tn,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=GM(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,n=0;for(;e;)e&1&&this.map[n].call(this,!!(t.data&1<<n)),e=e>>1,n++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(o_.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(o_.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],n=this.gl;e.length===2?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const n=this.checks.indexOf(t);e&&n===-1?this.checks.push(t):!e&&n!==-1&&this.checks.splice(n,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Nb.extension={type:yt.RendererSystem,name:"state"};let jM=Nb;Ut.add(jM);class qM extends Gl{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(o=>t.systems[o]),n=[...e,...Object.keys(t.systems).filter(o=>!e.includes(o))];for(const o of n)this.addSystem(t.systems[o],o)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Tr(e)})}addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const o in this.runners)this.runners[o].add(n);return this}emitWithCustomOptions(t,e){const n=Object.keys(this._systemsHash);t.items.forEach(o=>{const h=n.find(d=>this._systemsHash[d]===o);o[t.name](e[h])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const yl=class Vu{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Vu.defaultMaxIdle,this.checkCountMax=Vu.defaultCheckCountMax,this.mode=Vu.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==H_.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let n=!1;for(let o=0;o<e.length;o++){const h=e[o];h.resource&&this.count-h.touched>this.maxIdle&&(t.destroyTexture(h,!0),e[o]=null,n=!0)}if(n){let o=0;for(let h=0;h<e.length;h++)e[h]!==null&&(e[o++]=e[h]);e.length=o}}unload(t){const e=this.renderer.texture,n=t._texture;n&&!n.framebuffer&&e.destroyTexture(n);for(let o=t.children.length-1;o>=0;o--)this.unload(t.children[o])}destroy(){this.renderer=null}};yl.defaultMode=H_.AUTO,yl.defaultMaxIdle=60*60,yl.defaultCheckCountMax=60*10,yl.extension={type:yt.RendererSystem,name:"textureGC"};let Gs=yl;Ut.add(Gs);class Zf{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Bt.UNSIGNED_BYTE,this.internalFormat=ft.RGBA,this.samplerType=0}}function KM(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[s.RGB]:bt.FLOAT,[s.RGBA]:bt.FLOAT,[s.ALPHA]:bt.FLOAT,[s.LUMINANCE]:bt.FLOAT,[s.LUMINANCE_ALPHA]:bt.FLOAT,[s.R8]:bt.FLOAT,[s.R8_SNORM]:bt.FLOAT,[s.RG8]:bt.FLOAT,[s.RG8_SNORM]:bt.FLOAT,[s.RGB8]:bt.FLOAT,[s.RGB8_SNORM]:bt.FLOAT,[s.RGB565]:bt.FLOAT,[s.RGBA4]:bt.FLOAT,[s.RGB5_A1]:bt.FLOAT,[s.RGBA8]:bt.FLOAT,[s.RGBA8_SNORM]:bt.FLOAT,[s.RGB10_A2]:bt.FLOAT,[s.RGB10_A2UI]:bt.FLOAT,[s.SRGB8]:bt.FLOAT,[s.SRGB8_ALPHA8]:bt.FLOAT,[s.R16F]:bt.FLOAT,[s.RG16F]:bt.FLOAT,[s.RGB16F]:bt.FLOAT,[s.RGBA16F]:bt.FLOAT,[s.R32F]:bt.FLOAT,[s.RG32F]:bt.FLOAT,[s.RGB32F]:bt.FLOAT,[s.RGBA32F]:bt.FLOAT,[s.R11F_G11F_B10F]:bt.FLOAT,[s.RGB9_E5]:bt.FLOAT,[s.R8I]:bt.INT,[s.R8UI]:bt.UINT,[s.R16I]:bt.INT,[s.R16UI]:bt.UINT,[s.R32I]:bt.INT,[s.R32UI]:bt.UINT,[s.RG8I]:bt.INT,[s.RG8UI]:bt.UINT,[s.RG16I]:bt.INT,[s.RG16UI]:bt.UINT,[s.RG32I]:bt.INT,[s.RG32UI]:bt.UINT,[s.RGB8I]:bt.INT,[s.RGB8UI]:bt.UINT,[s.RGB16I]:bt.INT,[s.RGB16UI]:bt.UINT,[s.RGB32I]:bt.INT,[s.RGB32UI]:bt.UINT,[s.RGBA8I]:bt.INT,[s.RGBA8UI]:bt.UINT,[s.RGBA16I]:bt.INT,[s.RGBA16UI]:bt.UINT,[s.RGBA32I]:bt.INT,[s.RGBA32UI]:bt.UINT,[s.DEPTH_COMPONENT16]:bt.FLOAT,[s.DEPTH_COMPONENT24]:bt.FLOAT,[s.DEPTH_COMPONENT32F]:bt.FLOAT,[s.DEPTH_STENCIL]:bt.FLOAT,[s.DEPTH24_STENCIL8]:bt.FLOAT,[s.DEPTH32F_STENCIL8]:bt.FLOAT}:t={[s.RGB]:bt.FLOAT,[s.RGBA]:bt.FLOAT,[s.ALPHA]:bt.FLOAT,[s.LUMINANCE]:bt.FLOAT,[s.LUMINANCE_ALPHA]:bt.FLOAT,[s.DEPTH_STENCIL]:bt.FLOAT},t}function ZM(s){let t;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?t={[Bt.UNSIGNED_BYTE]:{[ft.RGBA]:s.RGBA8,[ft.RGB]:s.RGB8,[ft.RG]:s.RG8,[ft.RED]:s.R8,[ft.RGBA_INTEGER]:s.RGBA8UI,[ft.RGB_INTEGER]:s.RGB8UI,[ft.RG_INTEGER]:s.RG8UI,[ft.RED_INTEGER]:s.R8UI,[ft.ALPHA]:s.ALPHA,[ft.LUMINANCE]:s.LUMINANCE,[ft.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[Bt.BYTE]:{[ft.RGBA]:s.RGBA8_SNORM,[ft.RGB]:s.RGB8_SNORM,[ft.RG]:s.RG8_SNORM,[ft.RED]:s.R8_SNORM,[ft.RGBA_INTEGER]:s.RGBA8I,[ft.RGB_INTEGER]:s.RGB8I,[ft.RG_INTEGER]:s.RG8I,[ft.RED_INTEGER]:s.R8I},[Bt.UNSIGNED_SHORT]:{[ft.RGBA_INTEGER]:s.RGBA16UI,[ft.RGB_INTEGER]:s.RGB16UI,[ft.RG_INTEGER]:s.RG16UI,[ft.RED_INTEGER]:s.R16UI,[ft.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[Bt.SHORT]:{[ft.RGBA_INTEGER]:s.RGBA16I,[ft.RGB_INTEGER]:s.RGB16I,[ft.RG_INTEGER]:s.RG16I,[ft.RED_INTEGER]:s.R16I},[Bt.UNSIGNED_INT]:{[ft.RGBA_INTEGER]:s.RGBA32UI,[ft.RGB_INTEGER]:s.RGB32UI,[ft.RG_INTEGER]:s.RG32UI,[ft.RED_INTEGER]:s.R32UI,[ft.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[Bt.INT]:{[ft.RGBA_INTEGER]:s.RGBA32I,[ft.RGB_INTEGER]:s.RGB32I,[ft.RG_INTEGER]:s.RG32I,[ft.RED_INTEGER]:s.R32I},[Bt.FLOAT]:{[ft.RGBA]:s.RGBA32F,[ft.RGB]:s.RGB32F,[ft.RG]:s.RG32F,[ft.RED]:s.R32F,[ft.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[Bt.HALF_FLOAT]:{[ft.RGBA]:s.RGBA16F,[ft.RGB]:s.RGB16F,[ft.RG]:s.RG16F,[ft.RED]:s.R16F},[Bt.UNSIGNED_SHORT_5_6_5]:{[ft.RGB]:s.RGB565},[Bt.UNSIGNED_SHORT_4_4_4_4]:{[ft.RGBA]:s.RGBA4},[Bt.UNSIGNED_SHORT_5_5_5_1]:{[ft.RGBA]:s.RGB5_A1},[Bt.UNSIGNED_INT_2_10_10_10_REV]:{[ft.RGBA]:s.RGB10_A2,[ft.RGBA_INTEGER]:s.RGB10_A2UI},[Bt.UNSIGNED_INT_10F_11F_11F_REV]:{[ft.RGB]:s.R11F_G11F_B10F},[Bt.UNSIGNED_INT_5_9_9_9_REV]:{[ft.RGB]:s.RGB9_E5},[Bt.UNSIGNED_INT_24_8]:{[ft.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[Bt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[ft.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:t={[Bt.UNSIGNED_BYTE]:{[ft.RGBA]:s.RGBA,[ft.RGB]:s.RGB,[ft.ALPHA]:s.ALPHA,[ft.LUMINANCE]:s.LUMINANCE,[ft.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[Bt.UNSIGNED_SHORT_5_6_5]:{[ft.RGB]:s.RGB},[Bt.UNSIGNED_SHORT_4_4_4_4]:{[ft.RGBA]:s.RGBA},[Bt.UNSIGNED_SHORT_5_5_5_1]:{[ft.RGBA]:s.RGBA}},t}class zb{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new qt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=ZM(t),this.samplerTypes=KM(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let o=0;o<e;o++)this.boundTextures[o]=null;this.emptyTextures={};const n=new Zf(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Zf(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let o=0;o<6;o++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let o=0;o<this.boundTextures.length;o++)this.bind(null,o)}bind(t,e=0){const{gl:n}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const o=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,o.texture)),o.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)):o.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let o=0;o<n.length;o++)n[o]===this.unknownTexture&&this.bind(null,o)}for(let o=0;o<n.length;o++)n[o]===t&&(this.currentLocation!==o&&(e.activeTexture(e.TEXTURE0+o),this.currentLocation=o),e.bindTexture(t.target,this.emptyTextures[t.target].texture),n[o]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:n,CONTEXT_UID:o}=this;if(n)for(let h=t-1;h>=0;--h){const d=e[h];d&&d._glTextures[o].samplerType!==bt.FLOAT&&this.renderer.texture.unbind(d)}}initTexture(t){const e=new Zf(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var n;e.internalFormat=((n=this.internalFormats[t.type])==null?void 0:n[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??bt.FLOAT,this.webGLVersion===2&&t.type===Bt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var o;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const n=this.renderer;if(this.initTextureType(t,e),(o=t.resource)==null?void 0:o.upload(n,t,e))e.samplerType!==bt.FLOAT&&(this.hasIntegerTextures=!0);else{const h=t.realWidth,d=t.realHeight,l=n.gl;(e.width!==h||e.height!==d||e.dirtyId<0)&&(e.width=h,e.height=d,l.texImage2D(t.target,0,e.internalFormat,h,d,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:n}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const o=this.managedTextures.indexOf(t);o!==-1&&go(this.managedTextures,o,1)}}updateTextureStyle(t){var n;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Qr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=os.CLAMP:e.wrapMode=t.wrapMode,(n=t.resource)!=null&&n.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const n=this.gl;if(e.mipmap&&t.mipmap!==Qr.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===En.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const o=this.renderer.context.extensions.anisotropicFiltering;if(o&&t.anisotropicLevel>0&&t.scaleMode===En.LINEAR){const h=Math.min(t.anisotropicLevel,n.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,o.TEXTURE_MAX_ANISOTROPY_EXT,h)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===En.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===En.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}zb.extension={type:yt.RendererSystem,name:"texture"};Ut.add(zb);class Gb{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,o=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:n,renderer:o}=this;e&&o.shader.bind(e),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:n,CONTEXT_UID:o}=this,h=e.createTransformFeedback();t._glTransformFeedbacks[o]=h,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,h);for(let d=0;d<t.buffers.length;d++){const l=t.buffers[d];l&&(n.buffer.update(l),l._glBuffers[o].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,d,l._glBuffers[o].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),h}disposeTransformFeedback(t,e){const n=t._glTransformFeedbacks[this.CONTEXT_UID],o=this.gl;t.disposeRunner.remove(this);const h=this.renderer.buffer;if(h)for(let d=0;d<t.buffers.length;d++){const l=t.buffers[d];if(!l)continue;const _=l._glBuffers[this.CONTEXT_UID];_&&(_.refCount--,_.refCount===0&&!e&&h.dispose(l,e))}n&&(e||o.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Gb.extension={type:yt.RendererSystem,name:"transformFeedback"};Ut.add(Gb);class yc{constructor(t){this.renderer=t}init(t){this.screen=new Jt(0,0,t.width,t.height),this.element=t.view||wt.ADAPTER.createCanvas(),this.resolution=t.resolution||wt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const n=this.element.width/this.resolution,o=this.element.height/this.resolution;this.screen.width=n,this.screen.height=o,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${o}px`),this.renderer.emit("resize",n,o),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}yc.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},yc.extension={type:[yt.RendererSystem,yt.CanvasRendererSystem],name:"_view"};Ut.add(yc);wt.PREFER_ENV=aa.WEBGL2;wt.STRICT_TEXTURE_CACHE=!1;wt.RENDER_OPTIONS={...gc.defaultOptions,..._c.defaultOptions,...yc.defaultOptions,...mc.defaultOptions};Object.defineProperties(wt,{WRAP_MODE:{get(){return qt.defaultOptions.wrapMode},set(s){ne("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),qt.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return qt.defaultOptions.scaleMode},set(s){ne("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),qt.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return qt.defaultOptions.mipmap},set(s){ne("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),qt.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return qt.defaultOptions.anisotropicLevel},set(s){ne("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),qt.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return ne("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Si.defaultResolution},set(s){Si.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return ne("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Si.defaultMultisample},set(s){Si.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return zs.defaultMaxTextures},set(s){ne("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),zs.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return zs.defaultBatchSize},set(s){ne("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),zs.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return zs.canUploadSameBuffer},set(s){ne("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),zs.canUploadSameBuffer=s}},GC_MODE:{get(){return Gs.defaultMode},set(s){ne("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Gs.defaultMode=s}},GC_MAX_IDLE:{get(){return Gs.defaultMaxIdle},set(s){ne("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Gs.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return Gs.defaultCheckCountMax},set(s){ne("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Gs.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return Cn.defaultVertexPrecision},set(s){ne("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Cn.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return Cn.defaultFragmentPrecision},set(s){ne("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Cn.defaultFragmentPrecision=s}}});var na=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(na||{});class Jf{constructor(t,e=null,n=0,o=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=n,this.once=o}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Hb=class zi{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Jf(null,null,1/0),this.deltaMS=1/zi.targetFPMS,this.elapsedMS=1/zi.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=na.NORMAL){return this._addListener(new Jf(t,e,n))}addOnce(t,e,n=na.NORMAL){return this._addListener(new Jf(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(!e)t.connect(n);else{for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n.match(t,e)?n=n.destroy():n=n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const h=t-this._lastFrame|0;if(h<this._minElapsedMS)return;this._lastFrame=t-h%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*zi.targetFPMS;const n=this._head;let o=n.next;for(;o;)o=o.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,zi.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!zi._shared){const t=zi._shared=new zi;t.autoStart=!0,t._protected=!0}return zi._shared}static get system(){if(!zi._system){const t=zi._system=new zi;t.autoStart=!0,t._protected=!0}return zi._system}};Hb.targetFPMS=.06;let Hi=Hb;Object.defineProperties(wt,{TARGET_FPMS:{get(){return Hi.targetFPMS},set(s){ne("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Hi.targetFPMS=s}}});class $b{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,na.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Hi.shared:new Hi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}$b.extension=yt.Application;Ut.add($b);const Vb=[];Ut.handleByList(yt.Renderer,Vb);function JM(s){for(const t of Vb)if(t.test(s))return new t(s);throw new Error("Unable to auto-detect a suitable renderer.")}var QM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,tL=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const eL=QM,Wb=tL;class Xb{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}e>=Ge.HIGH?this.multisample=Ge.HIGH:e>=Ge.MEDIUM?this.multisample=Ge.MEDIUM:e>=Ge.LOW?this.multisample=Ge.LOW:this.multisample=Ge.NONE}destroy(){}}Xb.extension={type:yt.RendererSystem,name:"_multisample"};Ut.add(Xb);class iL{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Yb{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,o=t._glBuffers[n]||this.createGLBuffer(t);e.bindBuffer(t.type,o.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:n,CONTEXT_UID:o}=this;if(this.boundBufferBases[e]!==t){const h=t._glBuffers[o]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,h.buffer)}}bindBufferRange(t,e,n){const{gl:o,CONTEXT_UID:h}=this;n=n||0;const d=t._glBuffers[h]||this.createGLBuffer(t);o.bindBufferRange(o.UNIFORM_BUFFER,e||0,d.buffer,n*256,256)}update(t){const{gl:e,CONTEXT_UID:n}=this,o=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==o.updateID)if(o.updateID=t._updateID,e.bindBuffer(t.type,o.buffer),o.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const h=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;o.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,h)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],o=this.gl;t.disposeRunner.remove(this),n&&(e||o.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let n=0;n<e.length;n++)this.dispose(this.managedBuffers[e[n]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:n}=this;return t._glBuffers[e]=new iL(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Yb.extension={type:yt.RendererSystem,name:"buffer"};Ut.add(Yb);class jb{constructor(t){this.renderer=t}render(t,e){const n=this.renderer;let o,h,d,l;if(e&&(o=e.renderTexture,h=e.clear,d=e.transform,l=e.skipUpdateTransform),this.renderingToScreen=!o,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=d,!n.context.isLost){if(o||(this.lastObjectRendered=t),!l){const _=t.enableTempParent();t.updateTransform(),t.disableTempParent(_)}n.renderTexture.bind(o),n.batch.currentRenderer.start(),(h??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),o&&(e.blit&&n.framebuffer.blit(),o.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}jb.extension={type:yt.RendererSystem,name:"objectRenderer"};Ut.add(jb);const Wu=class l_ extends qM{constructor(t){super(),this.type=Rx.WEBGL,t=Object.assign({},wt.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ar({projectionMatrix:new Se},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:l_.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(ne("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=l_.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:T3()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return ne("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return ne("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return ne("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return ne("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){ne("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return ne("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){ne("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return ne("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};Wu.extension={type:yt.Renderer,priority:1},Wu.__plugins={},Wu.__systems={};let J_=Wu;Ut.handleByMap(yt.RendererPlugin,J_.__plugins);Ut.handleByMap(yt.RendererSystem,J_.__systems);Ut.add(J_);class qb extends kl{constructor(t,e){const{width:n,height:o}=e||{};super(n,o),this.items=[],this.itemDirtyIds=[];for(let h=0;h<t;h++){const d=new qt;this.items.push(d),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof kl?this.addResourceAt(t[n],n):this.addResourceAt(fb(t[n],e),n))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:n}=this.items[0];return this.resize(e,n),this.update(),Promise.resolve(this)}),this._load}}class rL extends qb{constructor(t,e){const{width:n,height:o}=e||{};let h,d;Array.isArray(t)?(h=t,d=t.length):d=t,super(d,{width:n,height:o}),h&&this.initFromArray(h,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=fo.TEXTURE_2D_ARRAY}upload(t,e,n){const{length:o,itemDirtyIds:h,items:d}=this,{gl:l}=t;n.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,o,0,e.format,n.type,null);for(let _=0;_<o;_++){const m=d[_];h[_]<m.dirtyId&&(h[_]=m.dirtyId,m.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,_,m.resource.width,m.resource.height,1,e.format,n.type,m.resource.source))}return!0}}class nL extends Rn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Kb=class vl extends qb{constructor(t,e){const{width:n,height:o,autoLoad:h,linkBaseTexture:d}=e||{};if(t&&t.length!==vl.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:n,height:o});for(let l=0;l<vl.SIDES;l++)this.items[l].target=fo.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.linkBaseTexture=d!==!1,t&&this.initFromArray(t,e),h!==!1&&this.load()}bind(t){super.bind(t),t.target=fo.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,n){if(n===void 0&&(n=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=fo.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,n){const o=this.itemDirtyIds;for(let h=0;h<vl.SIDES;h++){const d=this.items[h];(o[h]<d.dirtyId||n.dirtyId<e.dirtyId)&&(d.valid&&d.resource?(d.resource.upload(t,d,n),o[h]=d.dirtyId):o[h]<-1&&(t.gl.texImage2D(d.target,0,n.internalFormat,e.realWidth,e.realHeight,0,e.format,n.type,null),o[h]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===vl.SIDES}};Kb.SIDES=6;let sL=Kb;class ho extends Rn{constructor(t,e){e=e||{};let n,o,h;typeof t=="string"?(n=ho.EMPTY,o=t,h=!0):(n=t,o=null,h=!1),super(n),this.url=o,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??h,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const n=await wt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const o=await n.blob();if(this.destroyed)return;const h=await createImageBitmap(o,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ri.UNPACK?"premultiply":"none"});if(this.destroyed){h.close();return}this.source=h,this.update(),t(this)}catch(n){if(this.destroyed)return;e(n),this.onError.emit(n)}}),this._load)}upload(t,e,n){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,n)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return ho._EMPTY=ho._EMPTY??wt.ADAPTER.createCanvas(0,0),ho._EMPTY}}const h_=class Xu extends Rn{constructor(t,e){e=e||{},super(wt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Xu.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;Rn.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,n=t.height;if(!e||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let o=e*this.scale,h=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(o=this._overrideWidth||this._overrideHeight/n*e,h=this._overrideHeight||this._overrideWidth/e*n),o=Math.round(o),h=Math.round(h);const d=this.source;d.width=o,d.height=h,d._pixiId=`canvas_${ra()}`,d.getContext("2d").drawImage(t,0,0,e,n,0,0,o,h),this._resolve(),this._resolve=null}}static getSize(t){const e=Xu.SVG_SIZE.exec(t),n={};return e&&(n[e[1]]=Math.round(parseFloat(e[3])),n[e[5]]=Math.round(parseFloat(e[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Xu.SVG_XML.test(t)}};h_.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,h_.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let u_=h_;class aL extends Rn{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const c_=class d_ extends Rn{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const n=document.createElement("video");e.autoLoad!==!1&&n.setAttribute("preload","auto"),e.playsinline!==!1&&(n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline","")),e.muted===!0&&(n.setAttribute("muted",""),n.muted=!0),e.loop===!0&&n.setAttribute("loop",""),e.autoPlay!==!1&&n.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const o=t[0].src||t[0];Rn.crossOrigin(n,o,e.crossorigin);for(let h=0;h<t.length;++h){const d=document.createElement("source");let{src:l,mime:_}=t[h];if(l=l||t[h],l.startsWith("data:"))_=l.slice(5,l.indexOf(";"));else if(!l.startsWith("blob:")){const m=l.split("?").shift().toLowerCase(),v=m.slice(m.lastIndexOf(".")+1);_=_||d_.MIME_TYPES[v]||`video/${v}`}d.src=l,_&&(d.type=_),n.appendChild(d)}t=n}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Hi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,n)=>{this.valid?e(this):(this._resolve=e,this._reject=n,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Hi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Hi.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Hi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||d_.TYPES.includes(e)}};c_.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],c_.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Zb=c_;Jp.push(ho,wb,nL,Zb,aL,u_,kc,sL,rL);class vc{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Jt.EMPTY:(t=t||new Jt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:n,b:o,c:h,d,tx:l,ty:_}=t,m=n*e.x+h*e.y+l,v=o*e.x+d*e.y+_;this.minX=Math.min(this.minX,m),this.maxX=Math.max(this.maxX,m),this.minY=Math.min(this.minY,v),this.maxY=Math.max(this.maxY,v)}addQuad(t){let e=this.minX,n=this.minY,o=this.maxX,h=this.maxY,d=t[0],l=t[1];e=d<e?d:e,n=l<n?l:n,o=d>o?d:o,h=l>h?l:h,d=t[2],l=t[3],e=d<e?d:e,n=l<n?l:n,o=d>o?d:o,h=l>h?l:h,d=t[4],l=t[5],e=d<e?d:e,n=l<n?l:n,o=d>o?d:o,h=l>h?l:h,d=t[6],l=t[7],e=d<e?d:e,n=l<n?l:n,o=d>o?d:o,h=l>h?l:h,this.minX=e,this.minY=n,this.maxX=o,this.maxY=h}addFrame(t,e,n,o,h){this.addFrameMatrix(t.worldTransform,e,n,o,h)}addFrameMatrix(t,e,n,o,h){const d=t.a,l=t.b,_=t.c,m=t.d,v=t.tx,w=t.ty;let b=this.minX,T=this.minY,r=this.maxX,a=this.maxY,u=d*e+_*n+v,f=l*e+m*n+w;b=u<b?u:b,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,u=d*o+_*n+v,f=l*o+m*n+w,b=u<b?u:b,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,u=d*e+_*h+v,f=l*e+m*h+w,b=u<b?u:b,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,u=d*o+_*h+v,f=l*o+m*h+w,b=u<b?u:b,T=f<T?f:T,r=u>r?u:r,a=f>a?f:a,this.minX=b,this.minY=T,this.maxX=r,this.maxY=a}addVertexData(t,e,n){let o=this.minX,h=this.minY,d=this.maxX,l=this.maxY;for(let _=e;_<n;_+=2){const m=t[_],v=t[_+1];o=m<o?m:o,h=v<h?v:h,d=m>d?m:d,l=v>l?v:l}this.minX=o,this.minY=h,this.maxX=d,this.maxY=l}addVertices(t,e,n,o){this.addVerticesMatrix(t.worldTransform,e,n,o)}addVerticesMatrix(t,e,n,o,h=0,d=h){const l=t.a,_=t.b,m=t.c,v=t.d,w=t.tx,b=t.ty;let T=this.minX,r=this.minY,a=this.maxX,u=this.maxY;for(let f=n;f<o;f+=2){const g=e[f],x=e[f+1],S=l*g+m*x+w,A=v*x+_*g+b;T=Math.min(T,S-h),a=Math.max(a,S+h),r=Math.min(r,A-d),u=Math.max(u,A+d)}this.minX=T,this.minY=r,this.maxX=a,this.maxY=u}addBounds(t){const e=this.minX,n=this.minY,o=this.maxX,h=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>o?t.maxX:o,this.maxY=t.maxY>h?t.maxY:h}addBoundsMask(t,e){const n=t.minX>e.minX?t.minX:e.minX,o=t.minY>e.minY?t.minY:e.minY,h=t.maxX<e.maxX?t.maxX:e.maxX,d=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=h&&o<=d){const l=this.minX,_=this.minY,m=this.maxX,v=this.maxY;this.minX=n<l?n:l,this.minY=o<_?o:_,this.maxX=h>m?h:m,this.maxY=d>v?d:v}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const n=t.minX>e.x?t.minX:e.x,o=t.minY>e.y?t.minY:e.y,h=t.maxX<e.x+e.width?t.maxX:e.x+e.width,d=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=h&&o<=d){const l=this.minX,_=this.minY,m=this.maxX,v=this.maxY;this.minX=n<l?n:l,this.minY=o<_?o:_,this.maxX=h>m?h:m,this.maxY=d>v?d:v}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,n,o,h,d){t-=h,e-=d,n+=h,o+=d,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>o?this.maxY:o}}class Re extends Gl{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new K_,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new vc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let n=0;n<e.length;++n){const o=e[n];Object.defineProperty(Re.prototype,o,Object.getOwnPropertyDescriptor(t,o))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Jt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Jt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new vc);const e=this.transform,n=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(n==null?void 0:n.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const o=this._bounds,h=this._boundsID;this._bounds=this._localBounds;const d=this.getBounds(!1,t);return this.parent=n,this.transform=e,this._bounds=o,this._bounds.updateID+=this._boundsID-h,d}toGlobal(t,e,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,n,o){return e&&(t=e.toGlobal(t,n,o)),o||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,n=1,o=1,h=0,d=0,l=0,_=0,m=0){return this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=o||1,this.rotation=h,this.skew.x=d,this.skew.y=l,this.pivot.x=_,this.pivot.y=m,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new oL),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Q3}set angle(t){this.transform.rotation=t*tM}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class oL extends Re{constructor(){super(...arguments),this.sortDirty=null}}Re.prototype.displayObjectUpdateTransform=Re.prototype.updateTransform;const lL=new Se;function hL(s,t){return s.zIndex===t.zIndex?s._lastSortedIndex-t._lastSortedIndex:s.zIndex-t.zIndex}const Jb=class f_ extends Re{constructor(){super(),this.children=[],this.sortableChildren=f_.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const n=this.getChildIndex(t),o=this.getChildIndex(e);this.children[n]=e,this.children[o]=t,this.onChildrenChange(n<o?n:o)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(t);go(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],n=this.children.indexOf(e);if(n===-1)return null;e.parent=null,e.transform._parentID=-1,go(this.children,n,1),this._boundsID++,this.onChildrenChange(n),e.emit("removed",this),this.emit("childRemoved",e,this,n)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,go(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const n=t,o=e,h=o-n;let d;if(h>0&&h<=o){d=this.children.splice(n,h);for(let l=0;l<d.length;++l)d[l].parent=null,d[l].transform&&(d[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let l=0;l<d.length;++l)d[l].emit("removed",this),this.emit("childRemoved",d[l],this,l);return d}else if(h===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,n=this.children.length;e<n;++e){const o=this.children[e];o._lastSortedIndex=e,!t&&o.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(hL),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const n=this.children[t];n.visible&&n.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;n?(n.calculateBounds(),this._bounds.addBoundsMask(e._bounds,n._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const n=super.getLocalBounds(t);if(!e)for(let o=0,h=this.children.length;o<h;++o){const d=this.children[o];d.visible&&d.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let n,o;this.cullArea?(n=this.cullArea,o=this.worldTransform):this._render!==f_.prototype._render&&(n=this.getBounds(!0));const h=t.projection.transform;if(h&&(o?(o=lL.copyFrom(o),o.prepend(h)):o=h),n&&e.intersects(n,o))this._render(t);else if(this.cullArea)return;for(let d=0,l=this.children.length;d<l;++d){const _=this.children[d],m=_.cullable;_.cullable=m||!this.cullArea,_.render(t),_.cullable=m}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,o=this.children.length;n<o;++n)this.children[n].render(t)}}renderAdvanced(t){var h,d,l;const e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let _=0;_<e.length;_++)e[_].enabled&&this._enabledFilters.push(e[_])}const o=e&&((h=this._enabledFilters)==null?void 0:h.length)||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==qe.NONE));if(o&&t.batch.flush(),e&&((d=this._enabledFilters)!=null&&d.length)&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let _=0,m=this.children.length;_<m;++_)this.children[_].render(t)}o&&t.batch.flush(),n&&t.mask.pop(this),e&&((l=this._enabledFilters)!=null&&l.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,n=this.removeChildren(0,this.children.length);if(e)for(let o=0;o<n.length;++o)n[o].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Jb.defaultSortableChildren=!1;let Cr=Jb;Cr.prototype.containerUpdateTransform=Cr.prototype.updateTransform;Object.defineProperties(wt,{SORTABLE_CHILDREN:{get(){return Cr.defaultSortableChildren},set(s){ne("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Cr.defaultSortableChildren=s}}});const sl=new ue,uL=new Uint16Array([0,1,2,0,2,3]);class la extends Cr{constructor(t){super(),this._anchor=new An(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new we(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Vt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ct.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=uL,this.pluginName="batch",this.isSprite=!0,this._roundPixels=wt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ns(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ns(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,n=e.a,o=e.b,h=e.c,d=e.d,l=e.tx,_=e.ty,m=this.vertexData,v=t.trim,w=t.orig,b=this._anchor;let T=0,r=0,a=0,u=0;if(v?(r=v.x-b._x*w.width,T=r+v.width,u=v.y-b._y*w.height,a=u+v.height):(r=-b._x*w.width,T=r+w.width,u=-b._y*w.height,a=u+w.height),m[0]=n*r+h*u+l,m[1]=d*u+o*r+_,m[2]=n*T+h*u+l,m[3]=d*u+o*T+_,m[4]=n*T+h*a+l,m[5]=d*a+o*T+_,m[6]=n*r+h*a+l,m[7]=d*a+o*r+_,this._roundPixels){const f=wt.RESOLUTION;for(let g=0;g<m.length;++g)m[g]=Math.round(m[g]*f)/f}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,n=t.orig,o=this._anchor,h=this.transform.worldTransform,d=h.a,l=h.b,_=h.c,m=h.d,v=h.tx,w=h.ty,b=-o._x*n.width,T=b+n.width,r=-o._y*n.height,a=r+n.height;if(e[0]=d*b+_*r+v,e[1]=m*r+l*b+w,e[2]=d*T+_*r+v,e[3]=m*r+l*T+w,e[4]=d*T+_*a+v,e[5]=m*a+l*T+w,e[6]=d*b+_*a+v,e[7]=m*a+l*b+w,this._roundPixels){const u=wt.RESOLUTION;for(let f=0;f<e.length;++f)e[f]=Math.round(e[f]*u)/u}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new vc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Jt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,sl);const e=this._texture.orig.width,n=this._texture.orig.height,o=-e*this.anchor.x;let h=0;return sl.x>=o&&sl.x<o+e&&(h=-n*this.anchor.y,sl.y>=h&&sl.y<h+n)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const n=t instanceof Ct?t:Ct.from(t,e);return new la(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=ns(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=ns(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ct.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Qb=new Se;Re.prototype._cacheAsBitmap=!1;Re.prototype._cacheData=null;Re.prototype._cacheAsBitmapResolution=null;Re.prototype._cacheAsBitmapMultisample=null;class cL{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Re.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(s){s!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(s){s!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(s){if(this._cacheAsBitmap===s)return;this._cacheAsBitmap=s;let t;s?(this._cacheData||(this._cacheData=new cL),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Re.prototype._renderCached=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(s),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(s))};Re.prototype._initCachedDisplayObject=function(s){var b,T;if((b=this._cacheData)!=null&&b.sprite)return;const t=this.alpha;this.alpha=1,s.batch.flush();const e=this.getLocalBounds(new Jt,!0);if((T=this.filters)!=null&&T.length){const r=this.filters[0].padding;e.pad(r)}const n=this.cacheAsBitmapResolution||s.resolution;e.ceil(n),e.width=Math.max(e.width,1/n),e.height=Math.max(e.height,1/n);const o=s.renderTexture.current,h=s.renderTexture.sourceFrame.clone(),d=s.renderTexture.destinationFrame.clone(),l=s.projection.transform,_=oa.create({width:e.width,height:e.height,resolution:n,multisample:this.cacheAsBitmapMultisample??s.multisample}),m=`cacheAsBitmap_${ra()}`;this._cacheData.textureCacheId=m,qt.addToCache(_.baseTexture,m),Ct.addToCache(_,m);const v=this.transform.localTransform.copyTo(Qb).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,s.render(this,{renderTexture:_,clear:!0,transform:v,skipUpdateTransform:!1}),s.framebuffer.blit(),s.projection.transform=l,s.renderTexture.bind(o,h,d),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const w=new la(_);w.transform.worldTransform=this.transform.worldTransform,w.anchor.x=-(e.x/e.width),w.anchor.y=-(e.y/e.height),w.alpha=t,w._bounds=this._bounds,this._cacheData.sprite=w,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=w.containsPoint.bind(w)};Re.prototype._renderCachedCanvas=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(s),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(s))};Re.prototype._initCachedDisplayObjectCanvas=function(s){var v;if((v=this._cacheData)!=null&&v.sprite)return;const t=this.getLocalBounds(new Jt,!0),e=this.alpha;this.alpha=1;const n=s.canvasContext.activeContext,o=s._projTransform,h=this.cacheAsBitmapResolution||s.resolution;t.ceil(h),t.width=Math.max(t.width,1/h),t.height=Math.max(t.height,1/h);const d=oa.create({width:t.width,height:t.height,resolution:h}),l=`cacheAsBitmap_${ra()}`;this._cacheData.textureCacheId=l,qt.addToCache(d.baseTexture,l),Ct.addToCache(d,l);const _=Qb;this.transform.localTransform.copyTo(_),_.invert(),_.tx-=t.x,_.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,s.render(this,{renderTexture:d,clear:!0,transform:_,skipUpdateTransform:!1}),s.canvasContext.activeContext=n,s._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const m=new la(d);m.transform.worldTransform=this.transform.worldTransform,m.anchor.x=-(t.x/t.width),m.anchor.y=-(t.y/t.height),m.alpha=e,m._bounds=this._bounds,this._cacheData.sprite=m,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=s._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=m.containsPoint.bind(m)};Re.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Re.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Re.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,qt.removeFromCache(this._cacheData.textureCacheId),Ct.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Re.prototype._cacheAsBitmapDestroy=function(s){this.cacheAsBitmap=!1,this.destroy(s)};Re.prototype.name=null;Cr.prototype.getChildByName=function(s,t){for(let e=0,n=this.children.length;e<n;e++)if(this.children[e].name===s)return this.children[e];if(t)for(let e=0,n=this.children.length;e<n;e++){const o=this.children[e];if(!o.getChildByName)continue;const h=o.getChildByName(s,!0);if(h)return h}return null};Re.prototype.getGlobalPosition=function(s=new ue,t=!1){return this.parent?this.parent.toGlobal(this.position,s,t):(s.x=this.position.x,s.y=this.position.y),s};var dL=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class fL extends Si{constructor(t=1){super(eL,dL,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const pL={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},_L=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function gL(s){const t=pL[s],e=t.length;let n=_L,o="";const h="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let d;for(let l=0;l<s;l++){let _=h.replace("%index%",l.toString());d=l,l>=e&&(d=s-l-1),_=_.replace("%value%",t[d].toString()),o+=_,o+=`
`}return n=n.replace("%blur%",o),n=n.replace("%size%",s.toString()),n}const mL=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function yL(s,t){const e=Math.ceil(s/2);let n=mL,o="",h;t?h="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":h="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let d=0;d<s;d++){let l=h.replace("%index%",d.toString());l=l.replace("%sampleIndex%",`${d-(e-1)}.0`),o+=l,o+=`
`}return n=n.replace("%blur%",o),n=n.replace("%size%",s.toString()),n}class p_ extends Si{constructor(t,e=8,n=4,o=Si.defaultResolution,h=5){const d=yL(h,t),l=gL(h);super(d,l),this.horizontal=t,this.resolution=o,this._quality=0,this.quality=n,this.blur=e}apply(t,e,n,o){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/e.width):this.uniforms.strength=1/n.height*(n.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,n,o);else{const h=t.getFilterTexture(),d=t.renderer;let l=e,_=h;this.state.blend=!1,t.applyFilter(this,l,_,Yr.CLEAR);for(let m=1;m<this.passes-1;m++){t.bindAndClear(l,Yr.BLIT),this.uniforms.uSampler=_;const v=_;_=l,l=v,d.shader.bind(this),d.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,_,n,o),t.returnFilterTexture(h)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class tw extends Si{constructor(t=8,e=4,n=Si.defaultResolution,o=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new p_(!0,t,e,n,o),this.blurYFilter=new p_(!1,t,e,n,o),this.resolution=n,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,n,o){const h=Math.abs(this.blurXFilter.strength),d=Math.abs(this.blurYFilter.strength);if(h&&d){const l=t.getFilterTexture();this.blurXFilter.apply(t,e,l,Yr.CLEAR),this.blurYFilter.apply(t,l,n,o),t.returnFilterTexture(l)}else d?this.blurYFilter.apply(t,e,n,o):this.blurXFilter.apply(t,e,n,o)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var vL=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class qs extends Si{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Wb,vL,t),this.alpha=1}_loadMatrix(t,e=!1){let n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}tint(t,e){const[n,o,h]=we.shared.setValue(t).toArray(),d=[n,0,0,0,0,0,o,0,0,0,0,0,h,0,0,0,0,0,1,0];this._loadMatrix(d,e)}greyscale(t,e){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const n=Math.cos(t),o=Math.sin(t),h=Math.sqrt,d=1/3,l=h(d),_=n+(1-n)*d,m=d*(1-n)-l*o,v=d*(1-n)+l*o,w=d*(1-n)+l*o,b=n+d*(1-n),T=d*(1-n)-l*o,r=d*(1-n)-l*o,a=d*(1-n)+l*o,u=n+d*(1-n),f=[_,m,v,0,0,w,b,T,0,0,r,a,u,0,0,0,0,0,1,0];this._loadMatrix(f,e)}contrast(t,e){const n=(t||0)+1,o=-.5*(n-1),h=[n,0,0,0,o,0,n,0,0,o,0,0,n,0,o,0,0,0,1,0];this._loadMatrix(h,e)}saturate(t=0,e){const n=t*2/3+1,o=(n-1)*-.5,h=[n,o,o,0,0,o,n,o,0,0,o,o,n,0,0,0,0,0,1,0];this._loadMatrix(h,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,n,o,h){t=t||.2,e=e||.15,n=n||16770432,o=o||3375104;const d=we.shared,[l,_,m]=d.setValue(n).toArray(),[v,w,b]=d.setValue(o).toArray(),T=[.3,.59,.11,0,0,l,_,m,t,0,v,w,b,e,0,l-v,_-w,m-b,0,0];this._loadMatrix(T,h)}night(t,e){t=t||.1;const n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,e)}predator(t,e){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}qs.prototype.grayscale=qs.prototype.greyscale;var xL=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,bL=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class wL extends Si{constructor(t,e){const n=new Se;t.renderable=!1,super(bL,xL,{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,e==null&&(e=20),this.scale=new ue(e,e)}apply(t,e,n,o){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const h=this.maskSprite.worldTransform,d=Math.sqrt(h.a*h.a+h.b*h.b),l=Math.sqrt(h.c*h.c+h.d*h.d);d!==0&&l!==0&&(this.uniforms.rotation[0]=h.a/d,this.uniforms.rotation[1]=h.b/d,this.uniforms.rotation[2]=h.c/l,this.uniforms.rotation[3]=h.d/l),t.applyFilter(this,e,n,o)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var SL=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,EL=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class TL extends Si{constructor(){super(EL,SL)}}var AL=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class CL extends Si{constructor(t=.5,e=Math.random()){super(Wb,AL,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const p0={AlphaFilter:fL,BlurFilter:tw,BlurFilterPass:p_,ColorMatrixFilter:qs,DisplacementFilter:wL,FXAAFilter:TL,NoiseFilter:CL};Object.entries(p0).forEach(([s,t])=>{Object.defineProperty(p0,s,{get(){return ne("7.1.0",`filters.${s} has moved to ${s}`),t}})});class UL{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Hi.system.add(this.tickerUpdate,this,na.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Hi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const is=new UL;class Wl{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Wl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ue,this.page=new ue,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,o,h){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class xc extends Wl{constructor(){super(...arguments),this.client=new ue,this.movement=new ue,this.offset=new ue,this.global=new ue,this.screen=new ue}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,o,h,d,l,_,m,v,w,b,T,r,a){throw new Error("Method not implemented.")}}class xr extends xc{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class yo extends xc{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}yo.DOM_DELTA_PIXEL=0,yo.DOM_DELTA_LINE=1,yo.DOM_DELTA_PAGE=2;const IL=2048,PL=new ue,Qf=new ue;class RL{constructor(t){this.dispatch=new Gl,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((n,o)=>n.priority-o.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,o=e.length;n<o;n++)e[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){is.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",o=this[n](this.rootTarget,this.rootTarget.eventMode,PL.set(t,e),this.hitTestFn,this.hitPruneFn);return o&&o[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let o=0,h=n.length-1;o<h;o++)if(t.currentTarget=n[o],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let o=n.length-2;o>=0;o--)if(t.currentTarget=n[o],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this._allInteractiveElements){if(n.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const o=Array.isArray(e)?e:[e];for(let h=n.length-1;h>=0;h--)o.forEach(d=>{t.currentTarget=n[h],this.notifyTarget(t,d)})}propagationPath(t){const e=[t];for(let n=0;n<IL&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,n,o,h,d=!1){let l=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(is.pauseUpdate=!1),t.interactiveChildren&&t.children){const v=t.children;for(let w=v.length-1;w>=0;w--){const b=v[w],T=this.hitTestMoveRecursive(b,this._isInteractive(e)?e:b.eventMode,n,o,h,d||h(t,n));if(T){if(T.length>0&&!T[T.length-1].parent)continue;const r=t.isInteractive();(T.length>0||r)&&(r&&this._allInteractiveElements.push(t),T.push(t)),this._hitElements.length===0&&(this._hitElements=T),l=!0}}}const _=this._isInteractive(e),m=t.isInteractive();return _&&m&&this._allInteractiveElements.push(t),d||this._hitElements.length>0?null:l?this._hitElements:_&&!h(t,n)&&o(t,n)?m?[t]:[]:null}hitTestRecursive(t,e,n,o,h){if(this._interactivePrune(t)||h(t,n))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(is.pauseUpdate=!1),t.interactiveChildren&&t.children){const _=t.children;for(let m=_.length-1;m>=0;m--){const v=_[m],w=this.hitTestRecursive(v,this._isInteractive(e)?e:v.eventMode,n,o,h);if(w){if(w.length>0&&!w[w.length-1].parent)continue;const b=t.isInteractive();return(w.length>0||b)&&w.push(t),w}}}const d=this._isInteractive(e),l=t.isInteractive();return d&&o(t,n)?l?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var n;if(t.hitArea&&(t.worldTransform.applyInverse(e,Qf),!t.hitArea.contains(Qf.x,Qf.y)))return!0;if(t._mask){const o=t._mask.isMaskData?t._mask.maskObject:t._mask;if(o&&!((n=o.containsPoint)!=null&&n.call(o,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var h,d;e=e??t.type;const n=`on${e}`;(d=(h=t.currentTarget)[n])==null||d.call(h,t);const o=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,o),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const o=e.button===2;this.dispatchEvent(e,o?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var _,m;if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n=e.pointerType==="mouse"||e.pointerType==="pen",o=this.trackingData(t.pointerId),h=this.findMountedTarget(o.overTargets);if(((_=o.overTargets)==null?void 0:_.length)>0&&h!==e.target){const v=t.type==="mousemove"?"mouseout":"pointerout",w=this.createPointerEvent(t,v,h);if(this.dispatchEvent(w,"pointerout"),n&&this.dispatchEvent(w,"mouseout"),!e.composedPath().includes(h)){const b=this.createPointerEvent(t,"pointerleave",h);for(b.eventPhase=b.AT_TARGET;b.target&&!e.composedPath().includes(b.target);)b.currentTarget=b.target,this.notifyTarget(b),n&&this.notifyTarget(b,"mouseleave"),b.target=b.target.parent;this.freeEvent(b)}this.freeEvent(w)}if(h!==e.target){const v=t.type==="mousemove"?"mouseover":"pointerover",w=this.clonePointerEvent(e,v);this.dispatchEvent(w,"pointerover"),n&&this.dispatchEvent(w,"mouseover");let b=h==null?void 0:h.parent;for(;b&&b!==this.rootTarget.parent&&b!==e.target;)b=b.parent;if(!b||b===this.rootTarget.parent){const T=this.clonePointerEvent(e,"pointerenter");for(T.eventPhase=T.AT_TARGET;T.target&&T.target!==h&&T.target!==this.rootTarget.parent;)T.currentTarget=T.target,this.notifyTarget(T),n&&this.notifyTarget(T,"mouseenter"),T.target=T.target.parent;this.freeEvent(T)}this.freeEvent(w)}const d=[],l=this.enableGlobalMoveEvents??!0;this.moveOnAll?d.push("pointermove"):this.dispatchEvent(e,"pointermove"),l&&d.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?d.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),l&&d.push("globaltouchmove")),n&&(this.moveOnAll?d.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),l&&d.push("globalmousemove"),this.cursor=(m=e.target)==null?void 0:m.cursor),d.length>0&&this.all(e,d),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var d;if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.createPointerEvent(t),o=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),o&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(d=n.target)==null?void 0:d.cursor);const h=this.clonePointerEvent(n,"pointerenter");for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),o&&this.notifyTarget(h,"mouseenter"),h.target=h.target.parent;e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(h)}mapPointerOut(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",o=this.findMountedTarget(e.overTargets),h=this.createPointerEvent(t,"pointerout",o);this.dispatchEvent(h),n&&this.dispatchEvent(h,"mouseout");const d=this.createPointerEvent(t,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;e.overTargets=null,this.freeEvent(h),this.freeEvent(d)}this.cursor=null}mapPointerUp(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const l=n.button===2;this.dispatchEvent(n,l?"rightup":"mouseup")}const o=this.trackingData(t.pointerId),h=this.findMountedTarget(o.pressTargetsByButton[t.button]);let d=h;if(h&&!n.composedPath().includes(h)){let l=h;for(;l&&!n.composedPath().includes(l);){if(n.currentTarget=l,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const _=n.button===2;this.notifyTarget(n,_?"rightupoutside":"mouseupoutside")}l=l.parent}delete o.pressTargetsByButton[t.button],d=l}if(d){const l=this.clonePointerEvent(n,"click");l.target=d,l.path=null,o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:l.target,timeStamp:e});const _=o.clicksByButton[t.button];if(_.target===l.target&&e-_.timeStamp<200?++_.clickCount:_.clickCount=1,_.target=l.target,_.timeStamp=e,l.detail=_.clickCount,l.pointerType==="mouse"){const m=l.button===2;this.dispatchEvent(l,m?"rightclick":"click")}else l.pointerType==="touch"&&this.dispatchEvent(l,"tap");this.dispatchEvent(l,"pointertap"),this.freeEvent(l)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof xr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),o=this.createPointerEvent(t);if(n){let h=n;for(;h;)o.currentTarget=h,this.notifyTarget(o,"pointerupoutside"),o.pointerType==="touch"?this.notifyTarget(o,"touchendoutside"):(o.pointerType==="mouse"||o.pointerType==="pen")&&this.notifyTarget(o,o.button===2?"rightupoutside":"mouseupoutside"),h=h.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(o)}mapWheel(t){if(!(t instanceof yo)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const o=this.allocateEvent(xr);return this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=n??this.hitTest(o.global.x,o.global.y)??this._hitElements[0],typeof e=="string"&&(o.type=e),o}createWheelEvent(t){const e=this.allocateEvent(yo);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(xr);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof xr&&e instanceof xr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof xc&&e instanceof xc&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const n=t.currentTarget._events[e];if(n&&t.currentTarget.isInteractive())if("fn"in n)n.once&&t.currentTarget.removeListener(e,n.fn,void 0,!0),n.fn.call(n.context,t);else for(let o=0,h=n.length;o<h&&!t.propagationImmediatelyStopped;o++)n[o].once&&t.currentTarget.removeListener(e,n[o].fn,void 0,!0),n[o].fn.call(n[o].context,t)}}const BL=1,FL={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},__=class g_{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new RL(null),is.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new xr(null),this.rootWheelEvent=new yo(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...g_.defaultEventFeatures},{set:(e,n,o)=>(n==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=o),e[n]=o,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:n}=this.renderer;this.setTargetElement(e),this.resolution=n,g_._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,o=e.length;n<o;n++){const h=e[n],d=this.bootstrapEvent(this.rootPointerEvent,h);this.rootBoundary.mapEvent(d)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,is.pointerMoved();const e=this.normalizeToPointerData(t);for(let n=0,o=e.length;n<o;n++){const h=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",o=this.normalizeToPointerData(t);for(let h=0,d=o.length;h<d;h++){const l=this.bootstrapEvent(this.rootPointerEvent,o[h]);l.type+=n,this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let n=0,o=e.length;n<o;n++){const h=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,is.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;is.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;is.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,n){const o=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},h=1/this.resolution;t.x=(e-o.left)*(this.domElement.width/o.width)*h,t.y=(n-o.top)*(this.domElement.height/o.height)*h}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,o=t.changedTouches.length;n<o;n++){const h=t.changedTouches[n];typeof h.button>"u"&&(h.button=0),typeof h.buttons>"u"&&(h.buttons=1),typeof h.isPrimary>"u"&&(h.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof h.width>"u"&&(h.width=h.radiusX||1),typeof h.height>"u"&&(h.height=h.radiusY||1),typeof h.tiltX>"u"&&(h.tiltX=0),typeof h.tiltY>"u"&&(h.tiltY=0),typeof h.pointerType>"u"&&(h.pointerType="touch"),typeof h.pointerId>"u"&&(h.pointerId=h.identifier||0),typeof h.pressure>"u"&&(h.pressure=h.force||.5),typeof h.twist>"u"&&(h.twist=0),typeof h.tangentialPressure>"u"&&(h.tangentialPressure=0),typeof h.layerX>"u"&&(h.layerX=h.offsetX=h.clientX),typeof h.layerY>"u"&&(h.layerY=h.offsetY=h.clientY),h.isNormalized=!0,h.type=t.type,e.push(h)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=BL),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=FL[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};__.extension={name:"events",type:[yt.RendererSystem,yt.CanvasRendererSystem]},__.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let m_=__;Ut.add(m_);function _0(s){return s==="dynamic"||s==="static"}const ML={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??_0(m_.defaultEventMode)},set interactive(s){ne("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=s,this.eventMode=s?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??m_.defaultEventMode},set eventMode(s){this._internalInteractive=_0(s),this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,o=typeof e=="object"?e.signal:void 0,h=typeof e=="object"?e.once===!0:!1,d=typeof t=="function"?void 0:t;s=n?`${s}capture`:s;const l=typeof t=="function"?t:t.handleEvent,_=this;o&&o.addEventListener("abort",()=>{_.off(s,l,d)}),h?_.once(s,l,d):_.on(s,l,d)},removeEventListener(s,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,o=typeof t=="function"?void 0:t;s=n?`${s}capture`:s,t=typeof t=="function"?t:t.handleEvent,this.off(s,t,o)},dispatchEvent(s){if(!(s instanceof Wl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};Re.mixin(ML);const LL={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Re.mixin(LL);const DL=9,Zh=100,kL=0,OL=0,g0=2,m0=1,NL=-1e3,zL=-1e3,GL=2;class ew{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Tn.tablet||Tn.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Zh}px`,e.style.height=`${Zh}px`,e.style.position="absolute",e.style.top=`${kL}px`,e.style.left=`${OL}px`,e.style.zIndex=g0.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${m0}px`,t.style.height=`${m0}px`,t.style.position="absolute",t.style.top=`${NL}px`,t.style.left=`${zL}px`,t.style.zIndex=GL.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}update(){const t=performance.now();if(Tn.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:n,width:o,height:h}=this.renderer.view.getBoundingClientRect(),{width:d,height:l,resolution:_}=this.renderer,m=o/d*_,v=h/l*_;let w=this.div;w.style.left=`${e}px`,w.style.top=`${n}px`,w.style.width=`${d}px`,w.style.height=`${l}px`;for(let b=0;b<this.children.length;b++){const T=this.children[b];if(T.renderId!==this.renderId)T._accessibleActive=!1,go(this.children,b,1),this.div.removeChild(T._accessibleDiv),this.pool.push(T._accessibleDiv),T._accessibleDiv=null,b--;else{w=T._accessibleDiv;let r=T.hitArea;const a=T.worldTransform;T.hitArea?(w.style.left=`${(a.tx+r.x*a.a)*m}px`,w.style.top=`${(a.ty+r.y*a.d)*v}px`,w.style.width=`${r.width*a.a*m}px`,w.style.height=`${r.height*a.d*v}px`):(r=T.getBounds(),this.capHitArea(r),w.style.left=`${r.x*m}px`,w.style.top=`${r.y*v}px`,w.style.width=`${r.width*m}px`,w.style.height=`${r.height*v}px`,w.title!==T.accessibleTitle&&T.accessibleTitle!==null&&(w.title=T.accessibleTitle),w.getAttribute("aria-label")!==T.accessibleHint&&T.accessibleHint!==null&&w.setAttribute("aria-label",T.accessibleHint)),(T.accessibleTitle!==w.title||T.tabIndex!==w.tabIndex)&&(w.title=T.accessibleTitle,w.tabIndex=T.tabIndex,this.debug&&this.updateDebugHTML(w))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:n}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Zh}px`,e.style.height=`${Zh}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=g0.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:n}=t.target,o=this.renderer.events.rootBoundary,h=Object.assign(new Wl(o),{target:n});o.rootTarget=this.renderer.lastObjectRendered,e.forEach(d=>o.dispatchEvent(h,d))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===DL&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}ew.extension={name:"accessibility",type:[yt.RendererPlugin,yt.CanvasRendererPlugin]};Ut.add(ew);const iw=class y_{constructor(t){this.stage=new Cr,t=Object.assign({forceCanvas:!1},t),this.renderer=JM(t),y_._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const n=y_._plugins.slice(0);n.reverse(),n.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};iw._plugins=[];let rw=iw;Ut.handleByList(yt.Application,rw._plugins);class nw{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,n;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:o,clientHeight:h}=this._resizeTo;e=o,n=h}this.renderer.resize(e,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}nw.extension=yt.Application;Ut.add(nw);const y0={loader:yt.LoadParser,resolver:yt.ResolveParser,cache:yt.CacheParser,detection:yt.DetectionParser};Ut.handle(yt.Asset,s=>{const t=s.ref;Object.entries(y0).filter(([e])=>!!t[e]).forEach(([e,n])=>Ut.add(Object.assign(t[e],{extension:t[e].extension??n})))},s=>{const t=s.ref;Object.keys(y0).filter(e=>!!t[e]).forEach(e=>Ut.remove(t[e]))});class HL{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ro(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function ds(s,t){const e=s.split("?")[0],n=ei.extname(e).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const Sr=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(n=>typeof n=="string"||e?t(n):n):s),v_=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s};function sw(s,t,e,n,o){const h=t[e];for(let d=0;d<h.length;d++){const l=h[d];e<t.length-1?sw(s.replace(n[e],l),t,e+1,n,o):o.push(s.replace(n[e],l))}}function $L(s){const t=/\{(.*?)\}/g,e=s.match(t),n=[];if(e){const o=[];e.forEach(h=>{const d=h.substring(1,h.length-1).split(",");o.push(d)}),sw(s,o,0,e,n)}else n.push(s);return n}const bc=s=>!Array.isArray(s);class VL{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const n=Sr(t);let o;for(let l=0;l<this.parsers.length;l++){const _=this.parsers[l];if(_.test(e)){o=_.getCacheableAssets(n,e);break}}o||(o={},n.forEach(l=>{o[l]=e}));const h=Object.keys(o),d={cacheKeys:h,keys:n};if(n.forEach(l=>{this._cacheMap.set(l,d)}),h.forEach(l=>{this._cache.has(l)&&this._cache.get(l)!==e&&console.warn("[Cache] already has key:",l),this._cache.set(l,o[l])}),e instanceof Ct){const l=e;n.forEach(_=>{l.baseTexture!==Ct.EMPTY.baseTexture&&qt.addToCache(l.baseTexture,_),Ct.addToCache(l,_)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Ys=new VL;class WL{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,n)=>(this._parsersValidated=!1,t[e]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{var d,l;let o=null,h=null;if(e.loadParser&&(h=this._parserHash[e.loadParser],h||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!h){for(let _=0;_<this.parsers.length;_++){const m=this.parsers[_];if(m.load&&((d=m.test)!=null&&d.call(m,t,e,this))){h=m;break}}if(!h)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await h.load(t,e,this),n.parser=h;for(let _=0;_<this.parsers.length;_++){const m=this.parsers[_];m.parse&&m.parse&&await((l=m.testParse)==null?void 0:l.call(m,o,e,this))&&(o=await m.parse(o,e,this)||o,n.parser=m)}return o})(),n}async load(t,e){this._parsersValidated||this._validateParsers();let n=0;const o={},h=bc(t),d=Sr(t,m=>({alias:[m],src:m})),l=d.length,_=d.map(async m=>{const v=ei.toAbsolute(m.src);if(!o[m.src])try{this.promiseCache[v]||(this.promiseCache[v]=this._getLoadPromiseAndParser(v,m)),o[m.src]=await this.promiseCache[v].promise,e&&e(++n/l)}catch(w){throw delete this.promiseCache[v],delete o[m.src],new Error(`[Loader.load] Failed to load ${v}.
${w}`)}});return await Promise.all(_),h?o[d[0].src]:o}async unload(t){const e=Sr(t,n=>({alias:[n],src:n})).map(async n=>{var d,l;const o=ei.toAbsolute(n.src),h=this.promiseCache[o];if(h){const _=await h.promise;delete this.promiseCache[o],(l=(d=h.parser)==null?void 0:d.unload)==null||l.call(d,_,n,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Ir=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(Ir||{});const XL=".json",YL="application/json",jL={extension:{type:yt.LoadParser,priority:Ir.Low},name:"loadJson",test(s){return Ro(s,YL)||ds(s,XL)},async load(s){return await(await wt.ADAPTER.fetch(s)).json()}};Ut.add(jL);const qL=".txt",KL="text/plain",ZL={name:"loadTxt",extension:{type:yt.LoadParser,priority:Ir.Low},test(s){return Ro(s,KL)||ds(s,qL)},async load(s){return await(await wt.ADAPTER.fetch(s)).text()}};Ut.add(ZL);const JL=["normal","bold","100","200","300","400","500","600","700","800","900"],QL=[".ttf",".otf",".woff",".woff2"],tD=["font/ttf","font/otf","font/woff","font/woff2"],eD=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function iD(s){const t=ei.extname(s),e=ei.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(h=>h.charAt(0).toUpperCase()+h.slice(1));let n=e.length>0;for(const h of e)if(!h.match(eD)){n=!1;break}let o=e.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const rD=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function nD(s){return rD.test(s)?s:encodeURI(s)}const sD={extension:{type:yt.LoadParser,priority:Ir.Low},name:"loadWebFont",test(s){return Ro(s,tD)||ds(s,QL)},async load(s,t){var n,o,h;const e=wt.ADAPTER.getFontFaceSet();if(e){const d=[],l=((n=t.data)==null?void 0:n.family)??iD(s),_=((h=(o=t.data)==null?void 0:o.weights)==null?void 0:h.filter(v=>JL.includes(v)))??["normal"],m=t.data??{};for(let v=0;v<_.length;v++){const w=_[v],b=new FontFace(l,`url(${nD(s)})`,{...m,weight:w});await b.load(),e.add(b),d.push(b)}return d.length===1?d[0]:d}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(t=>wt.ADAPTER.getFontFaceSet().delete(t))}};Ut.add(sD);const aD=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let vo=null,x_=class{constructor(){vo||(vo=URL.createObjectURL(new Blob([aD],{type:"application/javascript"}))),this.worker=new Worker(vo)}};x_.revokeObjectURL=function(){vo&&(URL.revokeObjectURL(vo),vo=null)};const oD=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let xo=null;class aw{constructor(){xo||(xo=URL.createObjectURL(new Blob([oD],{type:"application/javascript"}))),this.worker=new Worker(xo)}}aw.revokeObjectURL=function(){xo&&(URL.revokeObjectURL(xo),xo=null)};let v0=0,tp;class lD{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new x_;e.addEventListener("message",n=>{e.terminate(),x_.revokeObjectURL(),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){tp===void 0&&(tp=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<tp&&(this._createdWorkers++,t=new aw().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const n=new Promise((o,h)=>{this.queue.push({id:t,arguments:e,resolve:o,reject:h})});return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),n=e.id;this.resolveHash[v0]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:v0++,id:n})}}const x0=new lD;function Xl(s,t,e){s.resource.internal=!0;const n=new Ct(s),o=()=>{delete t.promiseCache[e],Ys.has(e)&&Ys.remove(e)};return n.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),o())}),n.once("destroyed",()=>{s.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),o())}),n}const hD=[".jpeg",".jpg",".png",".webp",".avif"],uD=["image/jpeg","image/png","image/webp","image/avif"];async function cD(s){const t=await wt.ADAPTER.fetch(s);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const Hc={name:"loadTextures",extension:{type:yt.LoadParser,priority:Ir.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return Ro(s,uD)||ds(s,hD)},async load(s,t,e){var l;const n=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let o;n?this.config.preferWorkers&&await x0.isImageBitmapSupported()?o=await x0.loadImageBitmap(s):o=await cD(s):o=await new Promise((_,m)=>{const v=new Image;v.crossOrigin=this.config.crossOrigin,v.src=s,v.complete?_(v):(v.onload=()=>_(v),v.onerror=w=>m(w))});const h={...t.data};h.resolution??(h.resolution=Pn(s)),n&&((l=h.resourceOptions)==null?void 0:l.ownsImageBitmap)===void 0&&(h.resourceOptions={...h.resourceOptions},h.resourceOptions.ownsImageBitmap=!0);const d=new qt(o,h);return d.resource.src=s,Xl(d,e,s)},unload(s){s.destroy(!0)}};Ut.add(Hc);const dD=".svg",fD="image/svg+xml",pD={extension:{type:yt.LoadParser,priority:Ir.High},name:"loadSVG",test(s){return Ro(s,fD)||ds(s,dD)},async testParse(s){return u_.test(s)},async parse(s,t,e){var h;const n=new u_(s,(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions);await n.load();const o=new qt(n,{resolution:Pn(s),...t==null?void 0:t.data});return o.resource.src=t.src,Xl(o,e,t.src)},async load(s,t){return(await wt.ADAPTER.fetch(s)).text()},unload:Hc.unload};Ut.add(pD);const _D=[".mp4",".m4v",".webm",".ogv"],gD=["video/mp4","video/webm","video/ogg"],mD={name:"loadVideo",extension:{type:yt.LoadParser,priority:Ir.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(s){return Ro(s,gD)||ds(s,_D)},async load(s,t,e){var d;let n;const o=await(await wt.ADAPTER.fetch(s)).blob(),h=URL.createObjectURL(o);try{const l={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(d=t==null?void 0:t.data)==null?void 0:d.resourceOptions,autoLoad:!0},_=new Zb(h,l);await _.load();const m=new qt(_,{alphaMode:await E3(),resolution:Pn(s),...t==null?void 0:t.data});m.resource.src=s,n=Xl(m,e,s),n.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(h)})}catch(l){throw URL.revokeObjectURL(h),l}return n},unload(s){s.destroy(!0)}};Ut.add(mD);class yD{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`).join("&")}}getAlias(t){const{alias:e,name:n,src:o,srcs:h}=t;return Sr(e||n||o||h,d=>typeof d=="string"?d:Array.isArray(d)?d.map(l=>(l==null?void 0:l.src)??(l==null?void 0:l.srcs)??l):d!=null&&d.src||d!=null&&d.srcs?d.src??d.srcs:d,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const n=[];Array.isArray(e)?e.forEach(o=>{const h=o.src??o.srcs,d=o.alias??o.name;let l;if(typeof d=="string"){const _=this._createBundleAssetId(t,d);n.push(_),l=[d,_]}else{const _=d.map(m=>this._createBundleAssetId(t,m));n.push(..._),l=[...d,..._]}this.add({...o,alias:l,src:h})}):Object.keys(e).forEach(o=>{const h=[o,this._createBundleAssetId(t,o)];if(typeof e[o]=="string")this.add({alias:h,src:e[o]});else if(Array.isArray(e[o]))this.add({alias:h,src:e[o]});else{const d=e[o],l=d.src??d.srcs;this.add({...d,alias:h,src:Array.isArray(l)?l:[l]})}n.push(...h)}),this._bundles[t]=n}add(t,e,n,o,h){const d=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(ne("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),d.push({alias:t,src:e,data:n,format:o,loadParser:h})):Array.isArray(t)?d.push(...t):d.push(t);let l;l=_=>{this.hasKey(_)&&console.warn(`[Resolver] already has key: ${_} overwriting`)},Sr(d).forEach(_=>{const{src:m,srcs:v}=_;let{data:w,format:b,loadParser:T}=_;const r=Sr(m||v).map(f=>typeof f=="string"?$L(f):Array.isArray(f)?f:[f]),a=this.getAlias(_);Array.isArray(a)?a.forEach(l):l(a);const u=[];r.forEach(f=>{f.forEach(g=>{let x={};if(typeof g!="object"){x.src=g;for(let S=0;S<this._parsers.length;S++){const A=this._parsers[S];if(A.test(g)){x=A.parse(g);break}}}else w=g.data??w,b=g.format??b,T=g.loadParser??T,x={...x,...g};if(!a)throw new Error(`[Resolver] alias is undefined for this asset: ${x.src}`);x=this.buildResolvedAsset(x,{aliases:a,data:w,format:b,loadParser:T}),u.push(x)})}),a.forEach(f=>{this._assetMap[f]=u})})}resolveBundle(t){const e=bc(t);t=Sr(t);const n={};return t.forEach(o=>{const h=this._bundles[o];if(h){const d=this.resolve(h),l={};for(const _ in d){const m=d[_];l[this._extractAssetIdFromBundle(o,_)]=m}n[o]=l}}),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const n={};for(const o in e)n[o]=e[o].src;return n}return e.src}resolve(t){const e=bc(t);t=Sr(t);const n={};return t.forEach(o=>{if(!this._resolverHash[o])if(this._assetMap[o]){let h=this._assetMap[o];const d=h[0],l=this._getPreferredOrder(h);l==null||l.priority.forEach(_=>{l.params[_].forEach(m=>{const v=h.filter(w=>w[_]?w[_]===m:!1);v.length&&(h=v)})}),this._resolverHash[o]=h[0]??d}else this._resolverHash[o]=this.buildResolvedAsset({alias:[o],src:o},{});n[o]=this._resolverHash[o]}),e?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const n=t[0],o=this._preferredOrder.find(h=>h.params.format.includes(n.format));if(o)return o}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:n,data:o,loadParser:h,format:d}=e;return(this._basePath||this._rootPath)&&(t.src=ei.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=n??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...o||{},...t.data},t.loadParser=h??t.loadParser,t.format=d??t.format??ei.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class vD{constructor(){this._detections=[],this._initialized=!1,this.resolver=new yD,this.loader=new WL,this.cache=Ys,this._backgroundLoader=new HL(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var h,d;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let l=t.manifest;typeof l=="string"&&(l=await this.load(l)),this.resolver.addManifest(l)}const e=((h=t.texturePreference)==null?void 0:h.resolution)??1,n=typeof e=="number"?[e]:e,o=await this._detectFormats({preferredFormats:(d=t.texturePreference)==null?void 0:d.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,n,o,h){this.resolver.add(t,e,n,o,h)}async load(t,e){this._initialized||await this.init();const n=bc(t),o=Sr(t).map(l=>{if(typeof l!="string"){const _=this.resolver.getAlias(l);return _.some(m=>!this.resolver.hasKey(m))&&this.add(l),Array.isArray(_)?_[0]:_}return this.resolver.hasKey(l)||this.add({alias:l,src:l}),l}),h=this.resolver.resolve(o),d=await this._mapLoadToResolve(h,e);return n?d[o[0]]:d}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;typeof t=="string"&&(n=!0,t=[t]);const o=this.resolver.resolveBundle(t),h={},d=Object.keys(o);let l=0,_=0;const m=()=>{e==null||e(++l/_)},v=d.map(w=>{const b=o[w];return _+=Object.keys(b).length,this._mapLoadToResolve(b,m).then(T=>{h[w]=T})});return await Promise.all(v),n?h[t[0]]:h}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ys.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=Ys.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=Object.values(t),o=Object.keys(t);this._backgroundLoader.active=!1;const h=await this.loader.load(n,e);this._backgroundLoader.active=!0;const d={};return n.forEach((l,_)=>{const m=h[l.src],v=[l.src];l.alias&&v.push(...l.alias),d[o[_]]=m,Ys.set(v,m)}),d}async unload(t){this._initialized||await this.init();const e=Sr(t).map(o=>typeof o!="string"?o.src:o),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=Sr(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map(o=>this._unloadFromResolved(e[o]));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(n=>{Ys.remove(n.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const n of t.detections)t.skipDetections||await n.test()?e=await n.add(e):t.skipDetections||(e=await n.remove(e));return e=e.filter((n,o)=>e.indexOf(n)===o),e}get detections(){return this._detections}get preferWorkers(){return Hc.config.preferWorkers}set preferWorkers(t){ne("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(n=>n in t).forEach(n=>{e.config[n]=t[n]})})}}const Jh=new vD;Ut.handleByList(yt.LoadParser,Jh.loader.parsers).handleByList(yt.ResolveParser,Jh.resolver.parsers).handleByList(yt.CacheParser,Jh.cache.parsers).handleByList(yt.DetectionParser,Jh.detections);const xD={extension:yt.CacheParser,test:s=>Array.isArray(s)&&s.every(t=>t instanceof Ct),getCacheableAssets:(s,t)=>{const e={};return s.forEach(n=>{t.forEach((o,h)=>{e[n+(h===0?"":h+1)]=o})}),e}};Ut.add(xD);async function ow(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const bD={extension:{type:yt.DetectionParser,priority:1},test:async()=>ow("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")};Ut.add(bD);const wD={extension:{type:yt.DetectionParser,priority:0},test:async()=>ow("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")};Ut.add(wD);const b0=["png","jpg","jpeg"],SD={extension:{type:yt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...b0],remove:async s=>s.filter(t=>!b0.includes(t))};Ut.add(SD);const ED="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Q_(s){return ED?!1:document.createElement("video").canPlayType(s)!==""}const TD={extension:{type:yt.DetectionParser,priority:0},test:async()=>Q_("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")};Ut.add(TD);const AD={extension:{type:yt.DetectionParser,priority:0},test:async()=>Q_("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")};Ut.add(AD);const CD={extension:{type:yt.DetectionParser,priority:0},test:async()=>Q_("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")};Ut.add(CD);const UD={extension:yt.ResolveParser,test:Hc.test,parse:s=>{var t;return{resolution:parseFloat(((t=wt.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:ei.extname(s).slice(1),src:s}}};Ut.add(UD);var ai=(s=>(s[s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",s[s.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",s[s.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",s[s.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",s[s.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",s[s.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",s[s.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",s[s.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",s[s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",s[s.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",s[s.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",s[s.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",s[s.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",s[s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",s[s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",s[s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",s))(ai||{});const wc={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Hr,to;function w0(){to={bptc:Hr.getExtension("EXT_texture_compression_bptc"),astc:Hr.getExtension("WEBGL_compressed_texture_astc"),etc:Hr.getExtension("WEBGL_compressed_texture_etc"),s3tc:Hr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Hr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Hr.getExtension("WEBGL_compressed_texture_pvrtc")||Hr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Hr.getExtension("WEBGL_compressed_texture_etc1"),atc:Hr.getExtension("WEBGL_compressed_texture_atc")}}const ID={extension:{type:yt.DetectionParser,priority:2},test:async()=>{const s=wt.ADAPTER.createCanvas().getContext("webgl");return s?(Hr=s,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async s=>{to||w0();const t=[];for(const e in to)to[e]&&t.push(e);return[...t,...s]},remove:async s=>(to||w0(),s.filter(t=>!(t in to)))};Ut.add(ID);class PD extends kc{constructor(t,e={width:1,height:1,autoLoad:!0}){let n,o;typeof t=="string"?(n=t,o=new Uint8Array):(n=null,o=t),super(o,e),this.origin=n,this.buffer=o?new Zp(o):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Zp(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class ta extends PD{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=ta._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||ta._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,n){const o=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;o.pixelStorei(o.UNPACK_ALIGNMENT,4);for(let h=0,d=this.levels;h<d;h++){const{levelID:l,levelWidth:_,levelHeight:m,levelBuffer:v}=this._levelBuffers[h];o.compressedTexImage2D(o.TEXTURE_2D,l,this.format,_,m,0,v)}return!0}onBlobLoaded(){this._levelBuffers=ta._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,n,o,h,d,l){const _=new Array(n);let m=t.byteOffset,v=d,w=l,b=v+o-1&~(o-1),T=w+h-1&~(h-1),r=b*T*wc[e];for(let a=0;a<n;a++)_[a]={levelID:a,levelWidth:n>1?v:b,levelHeight:n>1?w:T,levelBuffer:new Uint8Array(t.buffer,m,r)},m+=r,v=v>>1||1,w=w>>1||1,b=v+o-1&~(o-1),T=w+h-1&~(h-1),r=b*T*wc[e];return _}}const ep=4,Qh=124,RD=32,S0=20,BD=542327876,tu={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},FD={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},eu={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},MD=1,LD=2,DD=4,kD=64,OD=512,ND=131072,zD=827611204,GD=861165636,HD=894720068,$D=808540228,VD=4,WD={[zD]:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,[GD]:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,[HD]:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT},XD={70:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:ai.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:ai.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:ai.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:ai.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:ai.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:ai.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:ai.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:ai.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function YD(s){const t=new Uint32Array(s);if(t[0]!==BD)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(s,0,Qh/Uint32Array.BYTES_PER_ELEMENT),n=e[tu.HEIGHT],o=e[tu.WIDTH],h=e[tu.MIPMAP_COUNT],d=new Uint32Array(s,tu.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,RD/Uint32Array.BYTES_PER_ELEMENT),l=d[MD];if(l&DD){const _=d[FD.FOURCC];if(_!==$D){const g=WD[_],x=ep+Qh,S=new Uint8Array(s,x);return[new ta(S,{format:g,width:o,height:n,levels:h})]}const m=ep+Qh,v=new Uint32Array(t.buffer,m,S0/Uint32Array.BYTES_PER_ELEMENT),w=v[eu.DXGI_FORMAT],b=v[eu.RESOURCE_DIMENSION],T=v[eu.MISC_FLAG],r=v[eu.ARRAY_SIZE],a=XD[w];if(a===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${w}`);if(T===VD)throw new Error("DDSParser does not support cubemap textures");if(b===6)throw new Error("DDSParser does not supported 3D texture data");const u=new Array,f=ep+Qh+S0;if(r===1)u.push(new Uint8Array(s,f));else{const g=wc[a];let x=0,S=o,A=n;for(let B=0;B<h;B++){const R=Math.max(1,S+3&-4),M=Math.max(1,A+3&-4),N=R*M*g;x+=N,S=S>>>1,A=A>>>1}let C=f;for(let B=0;B<r;B++)u.push(new Uint8Array(s,C,x)),C+=x}return u.map(g=>new ta(g,{format:a,width:o,height:n,levels:h}))}throw l&kD?new Error("DDSParser does not support uncompressed texture data."):l&OD?new Error("DDSParser does not supported YUV uncompressed texture data."):l&ND?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&LD?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const E0=[171,75,84,88,32,49,49,187,13,10,26,10],jD=67305985,dr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},b_=64,T0={[Bt.UNSIGNED_BYTE]:1,[Bt.UNSIGNED_SHORT]:2,[Bt.INT]:4,[Bt.UNSIGNED_INT]:4,[Bt.FLOAT]:4,[Bt.HALF_FLOAT]:8},qD={[ft.RGBA]:4,[ft.RGB]:3,[ft.RG]:2,[ft.RED]:1,[ft.LUMINANCE]:1,[ft.LUMINANCE_ALPHA]:2,[ft.ALPHA]:1},KD={[Bt.UNSIGNED_SHORT_4_4_4_4]:2,[Bt.UNSIGNED_SHORT_5_5_5_1]:2,[Bt.UNSIGNED_SHORT_5_6_5]:2};function ZD(s,t,e=!1){const n=new DataView(t);if(!JD(s,n))return null;const o=n.getUint32(dr.ENDIANNESS,!0)===jD,h=n.getUint32(dr.GL_TYPE,o),d=n.getUint32(dr.GL_FORMAT,o),l=n.getUint32(dr.GL_INTERNAL_FORMAT,o),_=n.getUint32(dr.PIXEL_WIDTH,o),m=n.getUint32(dr.PIXEL_HEIGHT,o)||1,v=n.getUint32(dr.PIXEL_DEPTH,o)||1,w=n.getUint32(dr.NUMBER_OF_ARRAY_ELEMENTS,o)||1,b=n.getUint32(dr.NUMBER_OF_FACES,o),T=n.getUint32(dr.NUMBER_OF_MIPMAP_LEVELS,o),r=n.getUint32(dr.BYTES_OF_KEY_VALUE_DATA,o);if(m===0||v!==1)throw new Error("Only 2D textures are supported");if(b!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(w!==1)throw new Error("WebGL does not support array textures");const a=4,u=4,f=_+3&-4,g=m+3&-4,x=new Array(w);let S=_*m;h===0&&(S=f*g);let A;if(h!==0?T0[h]?A=T0[h]*qD[d]:A=KD[h]:A=wc[l],A===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=e?tk(n,r,o):null;let B=S*A,R=_,M=m,N=f,L=g,W=b_+r;for(let k=0;k<T;k++){const j=n.getUint32(W,o);let Y=W+4;for(let ut=0;ut<w;ut++){let it=x[ut];it||(it=x[ut]=new Array(T)),it[k]={levelID:k,levelWidth:T>1||h!==0?R:N,levelHeight:T>1||h!==0?M:L,levelBuffer:new Uint8Array(t,Y,B)},Y+=B}W+=j+4,W=W%4!==0?W+4-W%4:W,R=R>>1||1,M=M>>1||1,N=R+a-1&-4,L=M+u-1&-4,B=N*L*A}return h!==0?{uncompressed:x.map(k=>{let j=k[0].levelBuffer,Y=!1;return h===Bt.FLOAT?j=new Float32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4):h===Bt.UNSIGNED_INT?(Y=!0,j=new Uint32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)):h===Bt.INT&&(Y=!0,j=new Int32Array(k[0].levelBuffer.buffer,k[0].levelBuffer.byteOffset,k[0].levelBuffer.byteLength/4)),{resource:new kc(j,{width:k[0].levelWidth,height:k[0].levelHeight}),type:h,format:Y?QD(d):d}}),kvData:C}:{compressed:x.map(k=>new ta(null,{format:l,width:_,height:m,levels:T,levelBuffers:k})),kvData:C}}function JD(s,t){for(let e=0;e<E0.length;e++)if(t.getUint8(e)!==E0[e])return console.error(`${s} is not a valid *.ktx file!`),!1;return!0}function QD(s){switch(s){case ft.RGBA:return ft.RGBA_INTEGER;case ft.RGB:return ft.RGB_INTEGER;case ft.RG:return ft.RG_INTEGER;case ft.RED:return ft.RED_INTEGER;default:return s}}function tk(s,t,e){const n=new Map;let o=0;for(;o<t;){const h=s.getUint32(b_+o,e),d=b_+o+4,l=3-(h+3)%4;if(h===0||h>t-o){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let _=0;for(;_<h&&s.getUint8(d+_)!==0;_++);if(_===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const m=new TextDecoder().decode(new Uint8Array(s.buffer,d,_)),v=new DataView(s.buffer,d+_+1,h-_-1);n.set(m,v),o+=4+h+l}return n}const ek={extension:{type:yt.LoadParser,priority:Ir.High},name:"loadDDS",test(s){return ds(s,".dds")},async load(s,t,e){const n=await(await wt.ADAPTER.fetch(s)).arrayBuffer(),o=YD(n).map(h=>{const d=new qt(h,{mipmap:Qr.OFF,alphaMode:Ri.NO_PREMULTIPLIED_ALPHA,resolution:Pn(s),...t.data});return Xl(d,e,s)});return o.length===1?o[0]:o},unload(s){Array.isArray(s)?s.forEach(t=>t.destroy(!0)):s.destroy(!0)}};Ut.add(ek);const ik={extension:{type:yt.LoadParser,priority:Ir.High},name:"loadKTX",test(s){return ds(s,".ktx")},async load(s,t,e){const n=await(await wt.ADAPTER.fetch(s)).arrayBuffer(),{compressed:o,uncompressed:h,kvData:d}=ZD(s,n),l=o??h,_={mipmap:Qr.OFF,alphaMode:Ri.NO_PREMULTIPLIED_ALPHA,resolution:Pn(s),...t.data},m=l.map(v=>{l===h&&Object.assign(_,{type:v.type,format:v.format});const w=v.resource??v,b=new qt(w,_);return b.ktxKeyValueData=d,Xl(b,e,s)});return m.length===1?m[0]:m},unload(s){Array.isArray(s)?s.forEach(t=>t.destroy(!0)):s.destroy(!0)}};Ut.add(ik);const rk=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],nk={extension:yt.ResolveParser,test:s=>{const t=ei.extname(s).slice(1);return["basis","ktx","dds"].includes(t)},parse:s=>{var n,o;const t=s.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const h=t.pop();if(rk.includes(h))return{resolution:parseFloat(((n=wt.RETINA_PREFIX.exec(s))==null?void 0:n[1])??"1"),format:h,src:s}}return{resolution:parseFloat(((o=wt.RETINA_PREFIX.exec(s))==null?void 0:o[1])??"1"),format:e,src:s}}};Ut.add(nk);const iu=new Jt,sk=4,lw=class xl{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,n,o){const h=new Image;return h.src=await this.base64(t,e,n,o),h}async base64(t,e,n,o){const h=this.canvas(t,o);if(h.toBlob!==void 0)return new Promise((d,l)=>{h.toBlob(_=>{if(!_){l(new Error("ICanvas.toBlob failed!"));return}const m=new FileReader;m.onload=()=>d(m.result),m.onerror=l,m.readAsDataURL(_)},e,n)});if(h.toDataURL!==void 0)return h.toDataURL(e,n);if(h.convertToBlob!==void 0){const d=await h.convertToBlob({type:e,quality:n});return new Promise((l,_)=>{const m=new FileReader;m.onload=()=>l(m.result),m.onerror=_,m.readAsDataURL(d)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:n,width:o,height:h,flipY:d,premultipliedAlpha:l}=this._rawPixels(t,e);d&&xl._flipY(n,o,h),l&&xl._unpremultiplyAlpha(n);const _=new z3(o,h,1),m=new ImageData(new Uint8ClampedArray(n.buffer),o,h);return _.context.putImageData(m,0,0),_.canvas}pixels(t,e){const{pixels:n,width:o,height:h,flipY:d,premultipliedAlpha:l}=this._rawPixels(t,e);return d&&xl._flipY(n,o,h),l&&xl._unpremultiplyAlpha(n),n}_rawPixels(t,e){const n=this.renderer;if(!n)throw new Error("The Extract has already been destroyed");let o,h=!1,d=!1,l,_=!1;t&&(t instanceof oa?l=t:(l=n.generateTexture(t,{region:e,resolution:n.resolution,multisample:n.multisample}),_=!0,e&&(iu.width=e.width,iu.height=e.height,e=iu)));const m=n.gl;if(l){if(o=l.baseTexture.resolution,e=e??l.frame,h=!1,d=l.baseTexture.alphaMode>0&&l.baseTexture.format===ft.RGBA,!_){n.renderTexture.bind(l);const T=l.framebuffer.glFramebuffers[n.CONTEXT_UID];T.blitFramebuffer&&n.framebuffer.bind(T.blitFramebuffer)}}else o=n.resolution,e||(e=iu,e.width=n.width/o,e.height=n.height/o),h=!0,d=this._rendererPremultipliedAlpha,n.renderTexture.bind();const v=Math.max(Math.round(e.width*o),1),w=Math.max(Math.round(e.height*o),1),b=new Uint8Array(sk*v*w);return m.readPixels(Math.round(e.x*o),Math.round(e.y*o),v,w,m.RGBA,m.UNSIGNED_BYTE,b),_&&(l==null||l.destroy(!0)),{pixels:b,width:v,height:w,flipY:h,premultipliedAlpha:d}}destroy(){this.renderer=null}static _flipY(t,e,n){const o=e<<2,h=n>>1,d=new Uint8Array(o);for(let l=0;l<h;l++){const _=l*o,m=(n-l-1)*o;d.set(t.subarray(_,_+o)),t.copyWithin(_,m,m+o),t.set(d,m)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let n=0;n<e;n+=4){const o=t[n+3];if(o!==0){const h=255.001/o;t[n]=t[n]*h+.5,t[n+1]=t[n+1]*h+.5,t[n+2]=t[n+2]*h+.5}}}};lw.extension={name:"extract",type:yt.RendererSystem};let ak=lw;Ut.add(ak);const Sc={build(s){const t=s.points;let e,n,o,h,d,l;if(s.type===oi.CIRC){const r=s.shape;e=r.x,n=r.y,d=l=r.radius,o=h=0}else if(s.type===oi.ELIP){const r=s.shape;e=r.x,n=r.y,d=r.width,l=r.height,o=h=0}else{const r=s.shape,a=r.width/2,u=r.height/2;e=r.x+a,n=r.y+u,d=l=Math.max(0,Math.min(r.radius,Math.min(a,u))),o=a-d,h=u-l}if(!(d>=0&&l>=0&&o>=0&&h>=0)){t.length=0;return}const _=Math.ceil(2.3*Math.sqrt(d+l)),m=_*8+(o?4:0)+(h?4:0);if(t.length=m,m===0)return;if(_===0){t.length=8,t[0]=t[6]=e+o,t[1]=t[3]=n+h,t[2]=t[4]=e-o,t[5]=t[7]=n-h;return}let v=0,w=_*4+(o?2:0)+2,b=w,T=m;{const r=o+d,a=h,u=e+r,f=e-r,g=n+a;if(t[v++]=u,t[v++]=g,t[--w]=g,t[--w]=f,h){const x=n-a;t[b++]=f,t[b++]=x,t[--T]=x,t[--T]=u}}for(let r=1;r<_;r++){const a=Math.PI/2*(r/_),u=o+Math.cos(a)*d,f=h+Math.sin(a)*l,g=e+u,x=e-u,S=n+f,A=n-f;t[v++]=g,t[v++]=S,t[--w]=S,t[--w]=x,t[b++]=x,t[b++]=A,t[--T]=A,t[--T]=g}{const r=o,a=h+l,u=e+r,f=e-r,g=n+a,x=n-a;t[v++]=u,t[v++]=g,t[--T]=x,t[--T]=u,o&&(t[v++]=f,t[v++]=g,t[--T]=x,t[--T]=f)}},triangulate(s,t){const e=s.points,n=t.points,o=t.indices;if(e.length===0)return;let h=n.length/2;const d=h;let l,_;if(s.type!==oi.RREC){const v=s.shape;l=v.x,_=v.y}else{const v=s.shape;l=v.x+v.width/2,_=v.y+v.height/2}const m=s.matrix;n.push(s.matrix?m.a*l+m.c*_+m.tx:l,s.matrix?m.b*l+m.d*_+m.ty:_),h++,n.push(e[0],e[1]);for(let v=2;v<e.length;v+=2)n.push(e[v],e[v+1]),o.push(h++,d,h);o.push(d+1,d,h)}};function A0(s,t=!1){const e=s.length;if(e<6)return;let n=0;for(let o=0,h=s[e-2],d=s[e-1];o<e;o+=2){const l=s[o],_=s[o+1];n+=(l-h)*(_+d),h=l,d=_}if(!t&&n>0||t&&n<=0){const o=e/2;for(let h=o+o%2;h<e;h+=2){const d=e-h-2,l=e-h-1,_=h,m=h+1;[s[d],s[_]]=[s[_],s[d]],[s[l],s[m]]=[s[m],s[l]]}}}const hw={build(s){s.points=s.shape.points.slice()},triangulate(s,t){let e=s.points;const n=s.holes,o=t.points,h=t.indices;if(e.length>=6){A0(e,!1);const d=[];for(let m=0;m<n.length;m++){const v=n[m];A0(v.points,!0),d.push(e.length/2),e=e.concat(v.points)}const l=hR(e,d,2);if(!l)return;const _=o.length/2;for(let m=0;m<l.length;m+=3)h.push(l[m]+_),h.push(l[m+1]+_),h.push(l[m+2]+_);for(let m=0;m<e.length;m++)o.push(e[m])}}},ok={build(s){const t=s.shape,e=t.x,n=t.y,o=t.width,h=t.height,d=s.points;d.length=0,o>=0&&h>=0&&d.push(e,n,e+o,n,e+o,n+h,e,n+h)},triangulate(s,t){const e=s.points,n=t.points;if(e.length===0)return;const o=n.length/2;n.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(o,o+1,o+2,o+1,o+2,o+3)}},lk={build(s){Sc.build(s)},triangulate(s,t){Sc.triangulate(s,t)}};var rr=(s=>(s.MITER="miter",s.BEVEL="bevel",s.ROUND="round",s))(rr||{}),ss=(s=>(s.BUTT="butt",s.ROUND="round",s.SQUARE="square",s))(ss||{});const Io={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(s,t=20){if(!this.adaptive||!s||isNaN(s))return t;let e=Math.ceil(s/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class C0{static curveTo(t,e,n,o,h,d){const l=d[d.length-2],_=d[d.length-1]-e,m=l-t,v=o-e,w=n-t,b=Math.abs(_*w-m*v);if(b<1e-8||h===0)return(d[d.length-2]!==t||d[d.length-1]!==e)&&d.push(t,e),null;const T=_*_+m*m,r=v*v+w*w,a=_*v+m*w,u=h*Math.sqrt(T)/b,f=h*Math.sqrt(r)/b,g=u*a/T,x=f*a/r,S=u*w+f*m,A=u*v+f*_,C=m*(f+g),B=_*(f+g),R=w*(u+x),M=v*(u+x),N=Math.atan2(B-A,C-S),L=Math.atan2(M-A,R-S);return{cx:S+t,cy:A+e,radius:h,startAngle:N,endAngle:L,anticlockwise:m*v>w*_}}static arc(t,e,n,o,h,d,l,_,m){const v=l-d,w=Io._segmentsCount(Math.abs(v)*h,Math.ceil(Math.abs(v)/pc)*40),b=v/(w*2),T=b*2,r=Math.cos(b),a=Math.sin(b),u=w-1,f=u%1/u;for(let g=0;g<=u;++g){const x=g+f*g,S=b+d+T*x,A=Math.cos(S),C=-Math.sin(S);m.push((r*A+a*C)*h+n,(r*-C+a*A)*h+o)}}}class hk{constructor(){this.reset()}begin(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class tg{static curveLength(t,e,n,o,h,d,l,_){let m=0,v=0,w=0,b=0,T=0,r=0,a=0,u=0,f=0,g=0,x=0,S=t,A=e;for(let C=1;C<=10;++C)v=C/10,w=v*v,b=w*v,T=1-v,r=T*T,a=r*T,u=a*t+3*r*v*n+3*T*w*h+b*l,f=a*e+3*r*v*o+3*T*w*d+b*_,g=S-u,x=A-f,S=u,A=f,m+=Math.sqrt(g*g+x*x);return m}static curveTo(t,e,n,o,h,d,l){const _=l[l.length-2],m=l[l.length-1];l.length-=2;const v=Io._segmentsCount(tg.curveLength(_,m,t,e,n,o,h,d));let w=0,b=0,T=0,r=0,a=0;l.push(_,m);for(let u=1,f=0;u<=v;++u)f=u/v,w=1-f,b=w*w,T=b*w,r=f*f,a=r*f,l.push(T*_+3*b*f*t+3*w*r*n+a*h,T*m+3*b*f*e+3*w*r*o+a*d)}}function U0(s,t,e,n,o,h,d,l){const _=s-e*o,m=t-n*o,v=s+e*h,w=t+n*h;let b,T;d?(b=n,T=-e):(b=-n,T=e);const r=_+b,a=m+T,u=v+b,f=w+T;return l.push(r,a,u,f),2}function As(s,t,e,n,o,h,d,l){const _=e-s,m=n-t;let v=Math.atan2(_,m),w=Math.atan2(o-s,h-t);l&&v<w?v+=Math.PI*2:!l&&v>w&&(w+=Math.PI*2);let b=v;const T=w-v,r=Math.abs(T),a=Math.sqrt(_*_+m*m),u=(15*r*Math.sqrt(a)/Math.PI>>0)+1,f=T/u;if(b+=f,l){d.push(s,t,e,n);for(let g=1,x=b;g<u;g++,x+=f)d.push(s,t,s+Math.sin(x)*a,t+Math.cos(x)*a);d.push(s,t,o,h)}else{d.push(e,n,s,t);for(let g=1,x=b;g<u;g++,x+=f)d.push(s+Math.sin(x)*a,t+Math.cos(x)*a,s,t);d.push(o,h,s,t)}return u*2}function uk(s,t){const e=s.shape;let n=s.points||e.points.slice();const o=t.closePointEps;if(n.length===0)return;const h=s.lineStyle,d=new ue(n[0],n[1]),l=new ue(n[n.length-2],n[n.length-1]),_=e.type!==oi.POLY||e.closeStroke,m=Math.abs(d.x-l.x)<o&&Math.abs(d.y-l.y)<o;if(_){n=n.slice(),m&&(n.pop(),n.pop(),l.set(n[n.length-2],n[n.length-1]));const it=(d.x+l.x)*.5,gt=(l.y+d.y)*.5;n.unshift(it,gt),n.push(it,gt)}const v=t.points,w=n.length/2;let b=n.length;const T=v.length/2,r=h.width/2,a=r*r,u=h.miterLimit*h.miterLimit;let f=n[0],g=n[1],x=n[2],S=n[3],A=0,C=0,B=-(g-S),R=f-x,M=0,N=0,L=Math.sqrt(B*B+R*R);B/=L,R/=L,B*=r,R*=r;const W=h.alignment,k=(1-W)*2,j=W*2;_||(h.cap===ss.ROUND?b+=As(f-B*(k-j)*.5,g-R*(k-j)*.5,f-B*k,g-R*k,f+B*j,g+R*j,v,!0)+2:h.cap===ss.SQUARE&&(b+=U0(f,g,B,R,k,j,!0,v))),v.push(f-B*k,g-R*k,f+B*j,g+R*j);for(let it=1;it<w-1;++it){f=n[(it-1)*2],g=n[(it-1)*2+1],x=n[it*2],S=n[it*2+1],A=n[(it+1)*2],C=n[(it+1)*2+1],B=-(g-S),R=f-x,L=Math.sqrt(B*B+R*R),B/=L,R/=L,B*=r,R*=r,M=-(S-C),N=x-A,L=Math.sqrt(M*M+N*N),M/=L,N/=L,M*=r,N*=r;const gt=x-f,Q=g-S,rt=x-A,Z=C-S,H=gt*rt+Q*Z,G=Q*rt-Z*gt,at=G<0;if(Math.abs(G)<.001*Math.abs(H)){v.push(x-B*k,S-R*k,x+B*j,S+R*j),H>=0&&(h.join===rr.ROUND?b+=As(x,S,x-B*k,S-R*k,x-M*k,S-N*k,v,!1)+4:b+=2,v.push(x-M*j,S-N*j,x+M*k,S+N*k));continue}const vt=(-B+f)*(-R+S)-(-B+x)*(-R+g),At=(-M+A)*(-N+S)-(-M+x)*(-N+C),kt=(gt*At-rt*vt)/G,ht=(Z*vt-Q*At)/G,q=(kt-x)*(kt-x)+(ht-S)*(ht-S),nt=x+(kt-x)*k,dt=S+(ht-S)*k,Xt=x-(kt-x)*j,Ot=S-(ht-S)*j,Nt=Math.min(gt*gt+Q*Q,rt*rt+Z*Z),Lt=at?k:j,ce=Nt+Lt*Lt*a,Be=q<=ce;let gi=h.join;if(gi===rr.MITER&&q/a>u&&(gi=rr.BEVEL),Be)switch(gi){case rr.MITER:{v.push(nt,dt,Xt,Ot);break}case rr.BEVEL:{at?v.push(nt,dt,x+B*j,S+R*j,nt,dt,x+M*j,S+N*j):v.push(x-B*k,S-R*k,Xt,Ot,x-M*k,S-N*k,Xt,Ot),b+=2;break}case rr.ROUND:{at?(v.push(nt,dt,x+B*j,S+R*j),b+=As(x,S,x+B*j,S+R*j,x+M*j,S+N*j,v,!0)+4,v.push(nt,dt,x+M*j,S+N*j)):(v.push(x-B*k,S-R*k,Xt,Ot),b+=As(x,S,x-B*k,S-R*k,x-M*k,S-N*k,v,!1)+4,v.push(x-M*k,S-N*k,Xt,Ot));break}}else{switch(v.push(x-B*k,S-R*k,x+B*j,S+R*j),gi){case rr.MITER:{at?v.push(Xt,Ot,Xt,Ot):v.push(nt,dt,nt,dt),b+=2;break}case rr.ROUND:{at?b+=As(x,S,x+B*j,S+R*j,x+M*j,S+N*j,v,!0)+2:b+=As(x,S,x-B*k,S-R*k,x-M*k,S-N*k,v,!1)+2;break}}v.push(x-M*k,S-N*k,x+M*j,S+N*j),b+=2}}f=n[(w-2)*2],g=n[(w-2)*2+1],x=n[(w-1)*2],S=n[(w-1)*2+1],B=-(g-S),R=f-x,L=Math.sqrt(B*B+R*R),B/=L,R/=L,B*=r,R*=r,v.push(x-B*k,S-R*k,x+B*j,S+R*j),_||(h.cap===ss.ROUND?b+=As(x-B*(k-j)*.5,S-R*(k-j)*.5,x-B*k,S-R*k,x+B*j,S+R*j,v,!1)+2:h.cap===ss.SQUARE&&(b+=U0(x,S,B,R,k,j,!1,v)));const Y=t.indices,ut=Io.epsilon*Io.epsilon;for(let it=T;it<b+T-2;++it)f=v[it*2],g=v[it*2+1],x=v[(it+1)*2],S=v[(it+1)*2+1],A=v[(it+2)*2],C=v[(it+2)*2+1],!(Math.abs(f*(S-C)+x*(C-g)+A*(g-S))<ut)&&Y.push(it,it+1,it+2)}function ck(s,t){let e=0;const n=s.shape,o=s.points||n.points,h=n.type!==oi.POLY||n.closeStroke;if(o.length===0)return;const d=t.points,l=t.indices,_=o.length/2,m=d.length/2;let v=m;for(d.push(o[0],o[1]),e=1;e<_;e++)d.push(o[e*2],o[e*2+1]),l.push(v,v+1),v++;h&&l.push(v,m)}function I0(s,t){s.lineStyle.native?ck(s,t):uk(s,t)}class eg{static curveLength(t,e,n,o,h,d){const l=t-2*n+h,_=e-2*o+d,m=2*n-2*t,v=2*o-2*e,w=4*(l*l+_*_),b=4*(l*m+_*v),T=m*m+v*v,r=2*Math.sqrt(w+b+T),a=Math.sqrt(w),u=2*w*a,f=2*Math.sqrt(T),g=b/a;return(u*r+a*b*(r-f)+(4*T*w-b*b)*Math.log((2*a+g+r)/(g+f)))/(4*u)}static curveTo(t,e,n,o,h){const d=h[h.length-2],l=h[h.length-1],_=Io._segmentsCount(eg.curveLength(d,l,t,e,n,o));let m=0,v=0;for(let w=1;w<=_;++w){const b=w/_;m=d+(t-d)*b,v=l+(e-l)*b,h.push(m+(t+(n-t)*b-m)*b,v+(e+(o-e)*b-v)*b)}}}const ip={[oi.POLY]:hw,[oi.CIRC]:Sc,[oi.ELIP]:Sc,[oi.RECT]:ok,[oi.RREC]:lk},P0=[],ru=[];class Ec{constructor(t,e=null,n=null,o=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=o,this.type=t.type}clone(){return new Ec(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Pa=new ue,uw=class cw extends pb{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new vc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),ru.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),P0.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,n=null,o=null){const h=new Ec(t,e,n,o);return this.graphicsData.push(h),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const n=new Ec(t,null,null,e),o=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=o.lineStyle,o.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let n=0;n<e.length;++n){const o=e[n];if(o.fillStyle.visible&&o.shape&&(o.matrix?o.matrix.applyInverse(t,Pa):Pa.copyFrom(t),o.shape.contains(Pa.x,Pa.y))){let h=!1;if(o.holes){for(let d=0;d<o.holes.length;d++)if(o.holes[d].shape.contains(Pa.x,Pa.y)){h=!0;break}}if(!h)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let n=null,o=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],o=n.style);for(let _=this.shapeIndex;_<e.length;_++){this.shapeIndex++;const m=e[_],v=m.fillStyle,w=m.lineStyle;ip[m.type].build(m),m.matrix&&this.transformPoints(m.points,m.matrix),(v.visible||w.visible)&&this.processHoles(m.holes);for(let b=0;b<2;b++){const T=b===0?v:w;if(!T.visible)continue;const r=T.texture.baseTexture,a=this.indices.length,u=this.points.length/2;r.wrapMode=os.REPEAT,b===0?this.processFill(m):this.processLine(m);const f=this.points.length/2-u;f!==0&&(n&&!this._compareStyles(o,T)&&(n.end(a,u),n=null),n||(n=P0.pop()||new hk,n.begin(T,a,u),this.batches.push(n),o=T),this.addUvs(this.points,t,T.texture,u,f,T.matrix))}}const h=this.indices.length,d=this.points.length/2;if(n&&n.end(h,d),this.batches.length===0){this.batchable=!0;return}const l=d>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&l===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=l?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const n=this.graphicsData[t],o=n.fillStyle,h=n.lineStyle;if(o&&!o.texture.baseTexture.valid||h&&!h.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,n=t.length;e<n;e++){const o=t[e];for(let h=0;h<o.size;h++){const d=o.start+h;this.indicesUint16[d]=this.indicesUint16[d]-o.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<cw.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++qt._globalBatch;for(let w=0;w<this.drawCalls.length;w++)this.drawCalls[w].texArray.clear(),ru.push(this.drawCalls[w]);this.drawCalls.length=0;const e=this.colors,n=this.textureIds;let o=ru.pop();o||(o=new t_,o.texArray=new n_),o.texArray.count=0,o.start=0,o.size=0,o.type=Kr.TRIANGLES;let h=0,d=null,l=0,_=!1,m=Kr.TRIANGLES,v=0;this.drawCalls.push(o);for(let w=0;w<this.batches.length;w++){const b=this.batches[w],T=8,r=b.style,a=r.texture.baseTexture;_!==!!r.native&&(_=!!r.native,m=_?Kr.LINES:Kr.TRIANGLES,d=null,h=T,t++),d!==a&&(d=a,a._batchEnabled!==t&&(h===T&&(t++,h=0,o.size>0&&(o=ru.pop(),o||(o=new t_,o.texArray=new n_),this.drawCalls.push(o)),o.start=v,o.size=0,o.texArray.count=0,o.type=m),a.touched=1,a._batchEnabled=t,a._batchLocation=h,a.wrapMode=os.REPEAT,o.texArray.elements[o.texArray.count++]=a,h++)),o.size+=b.size,v+=b.size,l=a._batchLocation,this.addColors(e,r.color,r.alpha,b.attribSize,b.attribStart),this.addTextureIds(n,l,b.attribSize,b.attribStart)}qt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,n=this.colors,o=this.textureIds,h=new ArrayBuffer(t.length*3*4),d=new Float32Array(h),l=new Uint32Array(h);let _=0;for(let m=0;m<t.length/2;m++)d[_++]=t[m*2],d[_++]=t[m*2+1],d[_++]=e[m*2],d[_++]=e[m*2+1],l[_++]=n[m],d[_++]=o[m];this._buffer.update(h),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?hw.triangulate(t,this):ip[t.type].triangulate(t,this)}processLine(t){I0(t,this);for(let e=0;e<t.holes.length;e++)I0(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const n=t[e];ip[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let n=0;n<t.length/2;n++){const o=t[n*2],h=t[n*2+1];t[n*2]=e.a*o+e.c*h+e.tx,t[n*2+1]=e.b*o+e.d*h+e.ty}}addColors(t,e,n,o,h=0){const d=we.shared.setValue(e).toLittleEndianNumber(),l=we.shared.setValue(d).toPremultiplied(n);t.length=Math.max(t.length,h+o);for(let _=0;_<o;_++)t[h+_]=l}addTextureIds(t,e,n,o=0){t.length=Math.max(t.length,o+n);for(let h=0;h<n;h++)t[o+h]=e}addUvs(t,e,n,o,h,d=null){let l=0;const _=e.length,m=n.frame;for(;l<h;){let w=t[(o+l)*2],b=t[(o+l)*2+1];if(d){const T=d.a*w+d.c*b+d.tx;b=d.b*w+d.d*b+d.ty,w=T}l++,e.push(w/m.width,b/m.height)}const v=n.baseTexture;(m.width<v.width||m.height<v.height)&&this.adjustUvs(e,n,_,h)}adjustUvs(t,e,n,o){const h=e.baseTexture,d=1e-6,l=n+o*2,_=e.frame,m=_.width/h.width,v=_.height/h.height;let w=_.x/_.width,b=_.y/_.height,T=Math.floor(t[n]+d),r=Math.floor(t[n+1]+d);for(let a=n+2;a<l;a+=2)T=Math.min(T,Math.floor(t[a]+d)),r=Math.min(r,Math.floor(t[a+1]+d));w-=T,b-=r;for(let a=n;a<l;a+=2)t[a]=(t[a]+w)*m,t[a+1]=(t[a+1]+b)*v}};uw.BATCHABLE_SIZE=100;let dk=uw;class $c{constructor(){this.color=16777215,this.alpha=1,this.texture=Ct.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new $c;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ct.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class ig extends $c{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ss.BUTT,this.join=rr.MITER,this.miterLimit=10}clone(){const t=new ig;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ss.BUTT,this.join=rr.MITER,this.miterLimit=10}}const rp={},w_=class Yu extends Cr{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new $c,this._lineStyle=new ig,this._matrix=null,this._holeMode=!1,this.state=tn.for2d(),this._geometry=t||new dk,this._geometry.refCount++,this._transformID=-1,this._tintColor=new we(16777215),this.blendMode=Vt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Yu(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,n,o=.5,h=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:n,alignment:o,native:h}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:Ct.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ss.BUTT,join:rr.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.width>0&&t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:n},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Qs,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new Qs,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,o=n[n.length-2],h=n[n.length-1];return(o!==t||h!==e)&&n.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,n,o){this._initCurve();const h=this.currentPath.points;return h.length===0&&this.moveTo(0,0),eg.curveTo(t,e,n,o,h),this}bezierCurveTo(t,e,n,o,h,d){return this._initCurve(),tg.curveTo(t,e,n,o,h,d,this.currentPath.points),this}arcTo(t,e,n,o,h){this._initCurve(t,e);const d=this.currentPath.points,l=C0.curveTo(t,e,n,o,h,d);if(l){const{cx:_,cy:m,radius:v,startAngle:w,endAngle:b,anticlockwise:T}=l;this.arc(_,m,v,w,b,T)}return this}arc(t,e,n,o,h,d=!1){if(o===h)return this;if(!d&&h<=o?h+=pc:d&&o<=h&&(o+=pc),h-o===0)return this;const l=t+Math.cos(o)*n,_=e+Math.sin(o)*n,m=this._geometry.closePointEps;let v=this.currentPath?this.currentPath.points:null;if(v){const w=Math.abs(v[v.length-2]-l),b=Math.abs(v[v.length-1]-_);w<m&&b<m||v.push(l,_)}else this.moveTo(l,_),v=this.currentPath.points;return C0.arc(l,_,t,e,n,o,h,d,v),this}beginFill(t=0,e){return this.beginTextureFill({texture:Ct.WHITE,color:t,alpha:e})}normalizeColor(t){const e=we.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:Ct.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const n=t.alpha>0;return n?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:n},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,n,o){return this.drawShape(new Jt(t,e,n,o))}drawRoundedRect(t,e,n,o,h){return this.drawShape(new zc(t,e,n,o,h))}drawCircle(t,e,n){return this.drawShape(new Oc(t,e,n))}drawEllipse(t,e,n,o){return this.drawShape(new Nc(t,e,n,o))}drawPolygon(...t){let e,n=!0;const o=t[0];o.points?(n=o.closeStroke,e=o.points):Array.isArray(t[0])?e=t[0]:e=t;const h=new Qs(e);return h.closeStroke=n,this.drawShape(h),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===oi.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(let o=0;o<n;o++){const h=t.batches[o],d=h.style.color,l=new Float32Array(this.vertexData.buffer,h.attribStart*4*2,h.attribSize*2),_=new Float32Array(t.uvsFloat32.buffer,h.attribStart*4*2,h.attribSize*2),m=new Uint16Array(t.indicesUint16.buffer,h.start*2,h.size),v={vertexData:l,blendMode:e,indices:m,uvs:_,_batchRGB:we.shared.setValue(d).toRgbArray(),_tintRGB:d,_texture:h.style.texture,alpha:h.style.alpha,worldAlpha:1};this.batches[o]=v}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,n=this.batches.length;e<n;e++){const o=this.batches[e];o.worldAlpha=this.worldAlpha*o.alpha,t.plugins[this.pluginName].render(o)}}}_renderDirect(t){const e=this._resolveDirectShader(t),n=this._geometry,o=this.worldAlpha,h=e.uniforms,d=n.drawCalls;h.translationMatrix=this.transform.worldTransform,we.shared.setValue(this._tintColor).premultiply(o).toArray(h.tint),t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(let l=0,_=d.length;l<_;l++)this._renderDrawCallDirect(t,n.drawCalls[l])}_renderDrawCallDirect(t,e){const{texArray:n,type:o,size:h,start:d}=e,l=n.count;for(let _=0;_<l;_++)t.texture.bind(n.elements[_],_);t.geometry.draw(o,h,d)}_resolveDirectShader(t){let e=this.shader;const n=this.pluginName;if(!e){if(!rp[n]){const{maxTextures:o}=t.plugins[n],h=new Int32Array(o);for(let _=0;_<o;_++)h[_]=_;const d={tint:new Float32Array([1,1,1,1]),translationMatrix:new Se,default:Ar.from({uSamplers:h},!0)},l=t.plugins[n]._shader.program;rp[n]=new Jr(l,d)}e=rp[n]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:n,maxX:o,maxY:h}=t.bounds;this._bounds.addFrame(this.transform,e,n,o,h)}containsPoint(t){return this.worldTransform.applyInverse(t,Yu._TEMP_POINT),this._geometry.containsPoint(Yu._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=we.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,n=e.a,o=e.b,h=e.c,d=e.d,l=e.tx,_=e.ty,m=this._geometry.points,v=this.vertexData;let w=0;for(let b=0;b<m.length;b+=2){const T=m[b],r=m[b+1];v[w++]=n*T+h*r+l,v[w++]=d*r+o*T+_}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};w_.curves=Io,w_._TEMP_POINT=new ue;let dw=w_;class fk{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const np=new ue,R0=new Qs,fw=class pw extends Cr{constructor(t,e,n,o=Kr.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=n||tn.for2d(),this.drawMode=o,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=wt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Kr.TRIANGLES&&e.length<pw.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const o=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[o]),t.plugins[o].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const o=this.transform.worldTransform,h=o.a,d=o.b,l=o.c,_=o.d,m=o.tx,v=o.ty,w=this.vertexData;for(let b=0;b<w.length/2;b++){const T=e[b*2],r=e[b*2+1];w[b*2]=h*T+l*r+m,w[b*2+1]=d*T+_*r+v}if(this._roundPixels){const b=wt.RESOLUTION;for(let T=0;T<w.length;++T)w[T]=Math.round(w[T]*b)/b}this.vertexDirty=n}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new fk(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,np);const e=this.geometry.getBuffer("aVertexPosition").data,n=R0.points,o=this.geometry.getIndex().data,h=o.length,d=this.drawMode===4?3:1;for(let l=0;l+2<h;l+=d){const _=o[l]*2,m=o[l+1]*2,v=o[l+2]*2;if(n[0]=e[_],n[1]=e[_+1],n[2]=e[m],n[3]=e[m+1],n[4]=e[v],n[5]=e[v+1],R0.contains(np.x,np.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};fw.BATCHABLE_SIZE=100;let B0=fw;class pk extends hs{constructor(t,e,n){super();const o=new Ne(t),h=new Ne(e,!0),d=new Ne(n,!0,!0);this.addAttribute("aVertexPosition",o,2,!1,Bt.FLOAT).addAttribute("aTextureCoord",h,2,!1,Bt.FLOAT).addIndex(d),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var _k=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,gk=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class F0 extends Jr{constructor(t,e){const n={uSampler:t,alpha:1,uTextureMatrix:Se.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(n,e.uniforms),super(e.program||Cn.from(gk,_k),n),this._colorDirty=!1,this.uvMatrix=new Ub(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new we(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;we.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class M0{constructor(t,e,n){this.geometry=new hs,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let o=0;o<t.length;++o){let h=t[o];h={attributeName:h.attributeName,size:h.size,uploadFunction:h.uploadFunction,type:h.type||Bt.FLOAT,offset:h.offset},e[o]?this.dynamicProperties.push(h):this.staticProperties.push(h)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Ne(O3(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let d=0;d<this.dynamicProperties.length;++d){const l=this.dynamicProperties[d];l.offset=e,e+=l.size,this.dynamicStride+=l.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new Ne(this.dynamicData,!1,!1);let o=0;this.staticStride=0;for(let d=0;d<this.staticProperties.length;++d){const l=this.staticProperties[d];l.offset=o,o+=l.size,this.staticStride+=l.size}const h=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(h),this.staticDataUint32=new Uint32Array(h),this.staticBuffer=new Ne(this.staticData,!0,!1);for(let d=0;d<this.dynamicProperties.length;++d){const l=this.dynamicProperties[d];t.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===Bt.UNSIGNED_BYTE,l.type,this.dynamicStride*4,l.offset*4)}for(let d=0;d<this.staticProperties.length;++d){const l=this.staticProperties[d];t.addAttribute(l.attributeName,this.staticBuffer,0,l.type===Bt.UNSIGNED_BYTE,l.type,this.staticStride*4,l.offset*4)}}uploadDynamic(t,e,n){for(let o=0;o<this.dynamicProperties.length;o++){const h=this.dynamicProperties[o];h.uploadFunction(t,e,n,h.type===Bt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,h.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,n){for(let o=0;o<this.staticProperties.length;o++){const h=this.staticProperties[o];h.uploadFunction(t,e,n,h.type===Bt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,h.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var mk=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,yk=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class _w extends Gc{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Se,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Bt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Jr.from(yk,mk,{}),this.state=tn.for2d()}render(t){const e=t.children,n=t._maxSize,o=t._batchSize,h=this.renderer;let d=e.length;if(d===0)return;d>n&&!t.autoResize&&(d=n);let l=t._buffers;l||(l=t._buffers=this.generateBuffers(t));const _=e[0]._texture.baseTexture,m=_.alphaMode>0;this.state.blendMode=cb(t.blendMode,m),h.state.set(this.state);const v=h.gl,w=t.worldTransform.copyTo(this.tempMatrix);w.prepend(h.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=w.toArray(!0),this.shader.uniforms.uColor=we.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,m).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=_,this.renderer.shader.bind(this.shader);let b=!1;for(let T=0,r=0;T<d;T+=o,r+=1){let a=d-T;a>o&&(a=o),r>=l.length&&l.push(this._generateOneMoreBuffer(t));const u=l[r];u.uploadDynamic(e,T,a);const f=t._bufferUpdateIDs[r]||0;b=b||u._updateID<f,b&&(u._updateID=t._updateID,u.uploadStatic(e,T,a)),h.geometry.bind(u.geometry),v.drawElements(v.TRIANGLES,a*6,v.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],n=t._maxSize,o=t._batchSize,h=t._properties;for(let d=0;d<n;d+=o)e.push(new M0(this.properties,h,o));return e}_generateOneMoreBuffer(t){const e=t._batchSize,n=t._properties;return new M0(this.properties,n,e)}uploadVertices(t,e,n,o,h,d){let l=0,_=0,m=0,v=0;for(let w=0;w<n;++w){const b=t[e+w],T=b._texture,r=b.scale.x,a=b.scale.y,u=T.trim,f=T.orig;u?(_=u.x-b.anchor.x*f.width,l=_+u.width,v=u.y-b.anchor.y*f.height,m=v+u.height):(l=f.width*(1-b.anchor.x),_=f.width*-b.anchor.x,m=f.height*(1-b.anchor.y),v=f.height*-b.anchor.y),o[d]=_*r,o[d+1]=v*a,o[d+h]=l*r,o[d+h+1]=v*a,o[d+h*2]=l*r,o[d+h*2+1]=m*a,o[d+h*3]=_*r,o[d+h*3+1]=m*a,d+=h*4}}uploadPosition(t,e,n,o,h,d){for(let l=0;l<n;l++){const _=t[e+l].position;o[d]=_.x,o[d+1]=_.y,o[d+h]=_.x,o[d+h+1]=_.y,o[d+h*2]=_.x,o[d+h*2+1]=_.y,o[d+h*3]=_.x,o[d+h*3+1]=_.y,d+=h*4}}uploadRotation(t,e,n,o,h,d){for(let l=0;l<n;l++){const _=t[e+l].rotation;o[d]=_,o[d+h]=_,o[d+h*2]=_,o[d+h*3]=_,d+=h*4}}uploadUvs(t,e,n,o,h,d){for(let l=0;l<n;++l){const _=t[e+l]._texture._uvs;_?(o[d]=_.x0,o[d+1]=_.y0,o[d+h]=_.x1,o[d+h+1]=_.y1,o[d+h*2]=_.x2,o[d+h*2+1]=_.y2,o[d+h*3]=_.x3,o[d+h*3+1]=_.y3,d+=h*4):(o[d]=0,o[d+1]=0,o[d+h]=0,o[d+h+1]=0,o[d+h*2]=0,o[d+h*2+1]=0,o[d+h*3]=0,o[d+h*3+1]=0,d+=h*4)}}uploadTint(t,e,n,o,h,d){for(let l=0;l<n;++l){const _=t[e+l],m=we.shared.setValue(_._tintRGB).toPremultiplied(_.alpha,_.texture.baseTexture.alphaMode>0);o[d]=m,o[d+h]=m,o[d+h*2]=m,o[d+h*3]=m,d+=h*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}_w.extension={name:"particle",type:yt.RendererPlugin};Ut.add(_w);var Vc=(s=>(s[s.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",s[s.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",s))(Vc||{});const nu={willReadFrequently:!0},$r=class Rt{static get experimentalLetterSpacingSupported(){let t=Rt._experimentalLetterSpacingSupported;if(t!==void 0){const e=wt.ADAPTER.getCanvasRenderingContext2D().prototype;t=Rt._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,n,o,h,d,l,_,m){this.text=t,this.style=e,this.width=n,this.height=o,this.lines=h,this.lineWidths=d,this.lineHeight=l,this.maxLineWidth=_,this.fontProperties=m}static measureText(t,e,n,o=Rt._canvas){n=n??e.wordWrap;const h=e.toFontString(),d=Rt.measureFont(h);d.fontSize===0&&(d.fontSize=e.fontSize,d.ascent=e.fontSize);const l=o.getContext("2d",nu);l.font=h;const _=(n?Rt.wordWrap(t,e,o):t).split(/(?:\r\n|\r|\n)/),m=new Array(_.length);let v=0;for(let r=0;r<_.length;r++){const a=Rt._measureText(_[r],e.letterSpacing,l);m[r]=a,v=Math.max(v,a)}let w=v+e.strokeThickness;e.dropShadow&&(w+=e.dropShadowDistance);const b=e.lineHeight||d.fontSize+e.strokeThickness;let T=Math.max(b,d.fontSize+e.strokeThickness*2)+e.leading+(_.length-1)*(b+e.leading);return e.dropShadow&&(T+=e.dropShadowDistance),new Rt(t,e,w,T,_,m,b+e.leading,v,d)}static _measureText(t,e,n){let o=!1;Rt.experimentalLetterSpacingSupported&&(Rt.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,o=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let h=n.measureText(t).width;return h>0&&(o?h-=e:h+=(Rt.graphemeSegmenter(t).length-1)*e),h}static wordWrap(t,e,n=Rt._canvas){const o=n.getContext("2d",nu);let h=0,d="",l="";const _=Object.create(null),{letterSpacing:m,whiteSpace:v}=e,w=Rt.collapseSpaces(v),b=Rt.collapseNewlines(v);let T=!w;const r=e.wordWrapWidth+m,a=Rt.tokenize(t);for(let u=0;u<a.length;u++){let f=a[u];if(Rt.isNewline(f)){if(!b){l+=Rt.addLine(d),T=!w,d="",h=0;continue}f=" "}if(w){const x=Rt.isBreakingSpace(f),S=Rt.isBreakingSpace(d[d.length-1]);if(x&&S)continue}const g=Rt.getFromCache(f,m,_,o);if(g>r)if(d!==""&&(l+=Rt.addLine(d),d="",h=0),Rt.canBreakWords(f,e.breakWords)){const x=Rt.wordWrapSplit(f);for(let S=0;S<x.length;S++){let A=x[S],C=A,B=1;for(;x[S+B];){const M=x[S+B];if(!Rt.canBreakChars(C,M,f,S,e.breakWords))A+=M;else break;C=M,B++}S+=B-1;const R=Rt.getFromCache(A,m,_,o);R+h>r&&(l+=Rt.addLine(d),T=!1,d="",h=0),d+=A,h+=R}}else{d.length>0&&(l+=Rt.addLine(d),d="",h=0);const x=u===a.length-1;l+=Rt.addLine(f,!x),T=!1,d="",h=0}else g+h>r&&(T=!1,l+=Rt.addLine(d),d="",h=0),(d.length>0||!Rt.isBreakingSpace(f)||T)&&(d+=f,h+=g)}return l+=Rt.addLine(d,!1),l}static addLine(t,e=!0){return t=Rt.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,n,o){let h=n[t];return typeof h!="number"&&(h=Rt._measureText(t,e,o)+e,n[t]=h),h}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const n=t[e];if(!Rt.isBreakingSpace(n))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Rt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:Rt._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let n="";if(typeof t!="string")return e;for(let o=0;o<t.length;o++){const h=t[o],d=t[o+1];if(Rt.isBreakingSpace(h,d)||Rt.isNewline(h)){n!==""&&(e.push(n),n=""),e.push(h);continue}n+=h}return n!==""&&e.push(n),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,o,h){return!0}static wordWrapSplit(t){return Rt.graphemeSegmenter(t)}static measureFont(t){if(Rt._fonts[t])return Rt._fonts[t];const e={ascent:0,descent:0,fontSize:0},n=Rt._canvas,o=Rt._context;o.font=t;const h=Rt.METRICS_STRING+Rt.BASELINE_SYMBOL,d=Math.ceil(o.measureText(h).width);let l=Math.ceil(o.measureText(Rt.BASELINE_SYMBOL).width);const _=Math.ceil(Rt.HEIGHT_MULTIPLIER*l);if(l=l*Rt.BASELINE_MULTIPLIER|0,d===0||_===0)return Rt._fonts[t]=e,e;n.width=d,n.height=_,o.fillStyle="#f00",o.fillRect(0,0,d,_),o.font=t,o.textBaseline="alphabetic",o.fillStyle="#000",o.fillText(h,0,l);const m=o.getImageData(0,0,d,_).data,v=m.length,w=d*4;let b=0,T=0,r=!1;for(b=0;b<l;++b){for(let a=0;a<w;a+=4)if(m[T+a]!==255){r=!0;break}if(!r)T+=w;else break}for(e.ascent=l-b,T=v-w,r=!1,b=_;b>l;--b){for(let a=0;a<w;a+=4)if(m[T+a]!==255){r=!0;break}if(!r)T-=w;else break}return e.descent=b-l,e.fontSize=e.ascent+e.descent,Rt._fonts[t]=e,e}static clearMetrics(t=""){t?delete Rt._fonts[t]:Rt._fonts={}}static get _canvas(){var t;if(!Rt.__canvas){let e;try{const n=new OffscreenCanvas(0,0);if((t=n.getContext("2d",nu))!=null&&t.measureText)return Rt.__canvas=n,n;e=wt.ADAPTER.createCanvas()}catch{e=wt.ADAPTER.createCanvas()}e.width=e.height=10,Rt.__canvas=e}return Rt.__canvas}static get _context(){return Rt.__context||(Rt.__context=Rt._canvas.getContext("2d",nu)),Rt.__context}};$r.METRICS_STRING="|ÉqÅ",$r.BASELINE_SYMBOL="M",$r.BASELINE_MULTIPLIER=1.4,$r.HEIGHT_MULTIPLIER=2,$r.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>[...s.segment(t)].map(e=>e.segment)}return s=>[...s]})(),$r.experimentalLetterSpacing=!1,$r._fonts={},$r._newlines=[10,13],$r._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Jn=$r;const vk=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],gw=class bl{constructor(t){this.styleID=0,this.reset(),ap(this,t,t)}clone(){const t={};return ap(t,this,bl.defaultStyle),new bl(t)}reset(){ap(this,bl.defaultStyle,bl.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=sp(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=sp(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){xk(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=sp(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let o=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(o)&&!vk.includes(o)&&(o=`"${o}"`),e[n]=o}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};gw.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Vc.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let us=gw;function sp(s){const t=we.shared,e=n=>{const o=t.setValue(n);return o.alpha===1?o.toHex():o.toRgbaString()};return Array.isArray(s)?s.map(e):e(s)}function xk(s,t){if(!Array.isArray(s)||!Array.isArray(t)||s.length!==t.length)return!1;for(let e=0;e<s.length;++e)if(s[e]!==t[e])return!1;return!0}function ap(s,t,e){for(const n in e)Array.isArray(t[n])?s[n]=t[n].slice():s[n]=t[n]}const bk={texture:!0,children:!1,baseTexture:!0},mw=class S_ extends la{constructor(t,e,n){let o=!1;n||(n=wt.ADAPTER.createCanvas(),o=!0),n.width=3,n.height=3;const h=Ct.from(n);h.orig=new Jt,h.trim=new Jt,super(h),this._ownCanvas=o,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=S_.defaultResolution??wt.RESOLUTION,this._autoResolution=S_.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Jn.experimentalLetterSpacing}static set experimentalLetterSpacing(t){ne("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Jn.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const n=this.context,o=Jn.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),h=o.width,d=o.height,l=o.lines,_=o.lineHeight,m=o.lineWidths,v=o.maxLineWidth,w=o.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,h)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,d)+e.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;let b,T;const r=e.dropShadow?2:1;for(let a=0;a<r;++a){const u=e.dropShadow&&a===0,f=u?Math.ceil(Math.max(1,d)+e.padding*2):0,g=f*this._resolution;if(u){n.fillStyle="black",n.strokeStyle="black";const S=e.dropShadowColor,A=e.dropShadowBlur*this._resolution,C=e.dropShadowDistance*this._resolution;n.shadowColor=we.shared.setValue(S).setAlpha(e.dropShadowAlpha).toRgbaString(),n.shadowBlur=A,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*C,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*C+g}else n.fillStyle=this._generateFillStyle(e,l,o),n.strokeStyle=e.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let x=(_-w.fontSize)/2;_-w.fontSize<0&&(x=0);for(let S=0;S<l.length;S++)b=e.strokeThickness/2,T=e.strokeThickness/2+S*_+w.ascent+x,e.align==="right"?b+=v-m[S]:e.align==="center"&&(b+=(v-m[S])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(l[S],b+e.padding,T+e.padding-f,!0),e.fill&&this.drawLetterSpacing(l[S],b+e.padding,T+e.padding-f)}this.updateTexture()}drawLetterSpacing(t,e,n,o=!1){const h=this._style.letterSpacing;let d=!1;if(Jn.experimentalLetterSpacingSupported&&(Jn.experimentalLetterSpacing?(this.context.letterSpacing=`${h}px`,this.context.textLetterSpacing=`${h}px`,d=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),h===0||d){o?this.context.strokeText(t,e,n):this.context.fillText(t,e,n);return}let l=e;const _=Jn.graphemeSegmenter(t);let m=this.context.measureText(t).width,v=0;for(let w=0;w<_.length;++w){const b=_[w];o?this.context.strokeText(b,l,n):this.context.fillText(b,l,n);let T="";for(let r=w+1;r<_.length;++r)T+=_[r];v=this.context.measureText(T).width,l+=m-v+h,m=v}}updateTexture(){const t=this.canvas;if(this._style.trim){const d=H3(t);d.data&&(t.width=d.width,t.height=d.height,this.context.putImageData(d.data,0,0))}const e=this._texture,n=this._style,o=n.trim?0:n.padding,h=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-o,e.trim.y=-o,e.orig.width=e._frame.width-o*2,e.orig.height=e._frame.height-o*2,this._onTextureUpdate(),h.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,n){const o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let h;const d=t.dropShadow?t.dropShadowDistance:0,l=t.padding||0,_=this.canvas.width/this._resolution-d-l*2,m=this.canvas.height/this._resolution-d-l*2,v=o.slice(),w=t.fillGradientStops.slice();if(!w.length){const b=v.length+1;for(let T=1;T<b;++T)w.push(T/b)}if(v.unshift(o[0]),w.unshift(0),v.push(o[o.length-1]),w.push(1),t.fillGradientType===Vc.LINEAR_VERTICAL){h=this.context.createLinearGradient(_/2,l,_/2,m+l);const b=n.fontProperties.fontSize+t.strokeThickness;for(let T=0;T<e.length;T++){const r=n.lineHeight*(T-1)+b,a=n.lineHeight*T;let u=a;T>0&&r>a&&(u=(a+r)/2);const f=a+b,g=n.lineHeight*(T+1);let x=f;T+1<e.length&&g<f&&(x=(f+g)/2);const S=(x-u)/m;for(let A=0;A<v.length;A++){let C=0;typeof w[A]=="number"?C=w[A]:C=A/v.length;let B=Math.min(1,Math.max(0,u/m+C*S));B=Number(B.toFixed(5)),h.addColorStop(B,v[A])}}}else{h=this.context.createLinearGradient(l,m/2,_+l,m/2);const b=v.length+1;let T=1;for(let r=0;r<v.length;r++){let a;typeof w[r]=="number"?a=w[r]:a=T/b,h.addColorStop(a,v[r]),T++}}return h}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},bk,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=ns(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=ns(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof us?this._style=t:this._style=new us(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};mw.defaultAutoResolution=!0;let yw=mw;class wk{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Sk(s,t){var n;let e=!1;if((n=s==null?void 0:s._textures)!=null&&n.length){for(let o=0;o<s._textures.length;o++)if(s._textures[o]instanceof Ct){const h=s._textures[o].baseTexture;t.includes(h)||(t.push(h),e=!0)}}return e}function Ek(s,t){if(s.baseTexture instanceof qt){const e=s.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Tk(s,t){if(s._texture&&s._texture instanceof Ct){const e=s._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Ak(s,t){return t instanceof yw?(t.updateText(!0),!0):!1}function Ck(s,t){if(t instanceof us){const e=t.toFontString();return Jn.measureFont(e),!0}return!1}function Uk(s,t){if(s instanceof yw){t.includes(s.style)||t.push(s.style),t.includes(s)||t.push(s);const e=s._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function Ik(s,t){return s instanceof us?(t.includes(s)||t.push(s),!0):!1}const vw=class xw{constructor(t){this.limiter=new wk(xw.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Uk),this.registerFindHook(Ik),this.registerFindHook(Sk),this.registerFindHook(Ek),this.registerFindHook(Tk),this.registerUploadHook(Ak),this.registerUploadHook(Ck)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Hi.system.addOnce(this.tick,this,na.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let n=0,o=this.uploadHooks.length;n<o;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Hi.system.addOnce(this.tick,this,na.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,n=t.length;e<n;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Cr)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Hi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};vw.uploadsPerFrame=4;let E_=vw;Object.defineProperties(wt,{UPLOADS_PER_FRAME:{get(){return E_.uploadsPerFrame},set(s){ne("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),E_.uploadsPerFrame=s}}});function bw(s,t){return t instanceof qt?(t._glTextures[s.CONTEXT_UID]||s.texture.bind(t),!0):!1}function Pk(s,t){if(!(t instanceof dw))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:n}=e;for(let o=0;o<n.length;o++){const{texture:h}=n[o].style;h&&bw(s,h.baseTexture)}return e.batchable||s.geometry.bind(e,t._resolveDirectShader(s)),!0}function Rk(s,t){return s instanceof dw?(t.push(s),!0):!1}class ww extends E_{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Rk),this.registerUploadHook(bw),this.registerUploadHook(Pk)}}ww.extension={name:"prepare",type:yt.RendererSystem};Ut.add(ww);var Bk=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Fk=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Mk=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,L0=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Lk=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const su=new Se;class Sw extends Gc{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Eb,this.state=tn.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Jr.from(L0,Lk,e),this.shader=t.context.webGLVersion>1?Jr.from(Fk,Bk,e):Jr.from(L0,Mk,e)}render(t){const e=this.renderer,n=this.quad;let o=n.vertices;o[0]=o[6]=t._width*-t.anchor.x,o[1]=o[3]=t._height*-t.anchor.y,o[2]=o[4]=t._width*(1-t.anchor.x),o[5]=o[7]=t._height*(1-t.anchor.y);const h=t.uvRespectAnchor?t.anchor.x:0,d=t.uvRespectAnchor?t.anchor.y:0;o=n.uvs,o[0]=o[6]=-h,o[1]=o[3]=-d,o[2]=o[4]=1-h,o[5]=o[7]=1-d,n.invalidate();const l=t._texture,_=l.baseTexture,m=_.alphaMode>0,v=t.tileTransform.localTransform,w=t.uvMatrix;let b=_.isPowerOfTwo&&l.frame.width===_.width&&l.frame.height===_.height;b&&(_._glTextures[e.CONTEXT_UID]?b=_.wrapMode!==os.CLAMP:_.wrapMode===os.CLAMP&&(_.wrapMode=os.REPEAT));const T=b?this.simpleShader:this.shader,r=l.width,a=l.height,u=t._width,f=t._height;su.set(v.a*r/u,v.b*r/f,v.c*a/u,v.d*a/f,v.tx/u,v.ty/f),su.invert(),b?su.prepend(w.mapCoord):(T.uniforms.uMapCoord=w.mapCoord.toArray(!0),T.uniforms.uClampFrame=w.uClampFrame,T.uniforms.uClampOffset=w.uClampOffset),T.uniforms.uTransform=su.toArray(!0),T.uniforms.uColor=we.shared.setValue(t.tint).premultiply(t.worldAlpha,m).toArray(T.uniforms.uColor),T.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),T.uniforms.uSampler=l,e.shader.bind(T),e.geometry.bind(n),this.state.blendMode=cb(t.blendMode,m),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Sw.extension={name:"tilingSprite",type:yt.RendererPlugin};Ut.add(Sw);const Ew=class wl{constructor(t,e,n){this.linkedSheets=[],(t instanceof qt||t instanceof Ct)&&(t={texture:t,data:e,resolutionFilename:n});const{texture:o,data:h,resolutionFilename:d=null,cachePrefix:l=""}=t;this.cachePrefix=l,this._texture=o instanceof Ct?o:null,this.baseTexture=o instanceof qt?o:this._texture.baseTexture,this.textures={},this.animations={},this.data=h;const _=this.baseTexture.resource;this.resolution=this._updateResolution(d||(_?_.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let n=Pn(t,null);return n===null&&(n=typeof e=="number"?e:parseFloat(e??"1")),n!==1&&this.baseTexture.setResolution(n),n}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=wl.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const n=wl.BATCH_SIZE;for(;e-t<n&&e<this._frameKeys.length;){const o=this._frameKeys[e],h=this._frames[o],d=h.frame;if(d){let l=null,_=null;const m=h.trimmed!==!1&&h.sourceSize?h.sourceSize:h.frame,v=new Jt(0,0,Math.floor(m.w)/this.resolution,Math.floor(m.h)/this.resolution);h.rotated?l=new Jt(Math.floor(d.x)/this.resolution,Math.floor(d.y)/this.resolution,Math.floor(d.h)/this.resolution,Math.floor(d.w)/this.resolution):l=new Jt(Math.floor(d.x)/this.resolution,Math.floor(d.y)/this.resolution,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution),h.trimmed!==!1&&h.spriteSourceSize&&(_=new Jt(Math.floor(h.spriteSourceSize.x)/this.resolution,Math.floor(h.spriteSourceSize.y)/this.resolution,Math.floor(d.w)/this.resolution,Math.floor(d.h)/this.resolution)),this.textures[o]=new Ct(this.baseTexture,l,v,_,h.rotated?2:0,h.anchor,h.borders),Ct.addToCache(this.textures[o],this.cachePrefix+o.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++){const o=t[e][n];this.animations[e].push(this.textures[o])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*wl.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*wl.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const n in this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Ew.BATCH_SIZE=1e3;let D0=Ew;const Dk=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Tw(s,t,e){const n={};if(s.forEach(o=>{n[o]=t}),Object.keys(t.textures).forEach(o=>{n[`${t.cachePrefix}${o}`]=t.textures[o]}),!e){const o=ei.dirname(s[0]);t.linkedSheets.forEach((h,d)=>{Object.assign(n,Tw([`${o}/${t.data.meta.related_multi_packs[d]}`],h,!0))})}return n}const kk={extension:yt.Asset,cache:{test:s=>s instanceof D0,getCacheableAssets:(s,t)=>Tw(s,t,!1)},resolver:{test:s=>{const t=s.split("?")[0].split("."),e=t.pop(),n=t.pop();return e==="json"&&Dk.includes(n)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=wt.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:yt.LoadParser,priority:Ir.Normal},async testParse(s,t){return ei.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var v,w;const{texture:n,imageFilename:o,cachePrefix:h}=(t==null?void 0:t.data)??{};let d=ei.dirname(t.src);d&&d.lastIndexOf("/")!==d.length-1&&(d+="/");let l;if(n&&n.baseTexture)l=n;else{const b=v_(d+(o??s.meta.image),t.src);l=(await e.load([b]))[b]}const _=new D0({texture:l.baseTexture,data:s,resolutionFilename:t.src,cachePrefix:h});await _.parse();const m=(v=s==null?void 0:s.meta)==null?void 0:v.related_multi_packs;if(Array.isArray(m)){const b=[];for(const r of m){if(typeof r!="string")continue;let a=d+r;(w=t.data)!=null&&w.ignoreMultiPack||(a=v_(a,t.src),b.push(e.load({src:a,data:{ignoreMultiPack:!0}})))}const T=await Promise.all(b);_.linkedSheets=T,T.forEach(r=>{r.linkedSheets=[_].concat(_.linkedSheets.filter(a=>a!==r))})}return _},unload(s){s.destroy(!0)}}};Ut.add(kk);class Tc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ju{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const h in e){const d=e[h].match(/^[a-z]+/gm)[0],l=e[h].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),_={};for(const m in l){const v=l[m].split("="),w=v[0],b=v[1].replace(/"/gm,""),T=parseFloat(b),r=isNaN(T)?b:T;_[w]=r}n[d].push(_)}const o=new Tc;return n.info.forEach(h=>o.info.push({face:h.face,size:parseInt(h.size,10)})),n.common.forEach(h=>o.common.push({lineHeight:parseInt(h.lineHeight,10)})),n.page.forEach(h=>o.page.push({id:parseInt(h.id,10),file:h.file})),n.char.forEach(h=>o.char.push({id:parseInt(h.id,10),page:parseInt(h.page,10),x:parseInt(h.x,10),y:parseInt(h.y,10),width:parseInt(h.width,10),height:parseInt(h.height,10),xoffset:parseInt(h.xoffset,10),yoffset:parseInt(h.yoffset,10),xadvance:parseInt(h.xadvance,10)})),n.kerning.forEach(h=>o.kerning.push({first:parseInt(h.first,10),second:parseInt(h.second,10),amount:parseInt(h.amount,10)})),n.distanceField.forEach(h=>o.distanceField.push({distanceRange:parseInt(h.distanceRange,10),fieldType:h.fieldType})),o}}class T_{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new Tc,n=t.getElementsByTagName("info"),o=t.getElementsByTagName("common"),h=t.getElementsByTagName("page"),d=t.getElementsByTagName("char"),l=t.getElementsByTagName("kerning"),_=t.getElementsByTagName("distanceField");for(let m=0;m<n.length;m++)e.info.push({face:n[m].getAttribute("face"),size:parseInt(n[m].getAttribute("size"),10)});for(let m=0;m<o.length;m++)e.common.push({lineHeight:parseInt(o[m].getAttribute("lineHeight"),10)});for(let m=0;m<h.length;m++)e.page.push({id:parseInt(h[m].getAttribute("id"),10)||0,file:h[m].getAttribute("file")});for(let m=0;m<d.length;m++){const v=d[m];e.char.push({id:parseInt(v.getAttribute("id"),10),page:parseInt(v.getAttribute("page"),10)||0,x:parseInt(v.getAttribute("x"),10),y:parseInt(v.getAttribute("y"),10),width:parseInt(v.getAttribute("width"),10),height:parseInt(v.getAttribute("height"),10),xoffset:parseInt(v.getAttribute("xoffset"),10),yoffset:parseInt(v.getAttribute("yoffset"),10),xadvance:parseInt(v.getAttribute("xadvance"),10)})}for(let m=0;m<l.length;m++)e.kerning.push({first:parseInt(l[m].getAttribute("first"),10),second:parseInt(l[m].getAttribute("second"),10),amount:parseInt(l[m].getAttribute("amount"),10)});for(let m=0;m<_.length;m++)e.distanceField.push({fieldType:_[m].getAttribute("fieldType"),distanceRange:parseInt(_[m].getAttribute("distanceRange"),10)});return e}}class A_{static test(t){return typeof t=="string"&&t.includes("<font>")?T_.test(wt.ADAPTER.parseXML(t)):!1}static parse(t){return T_.parse(wt.ADAPTER.parseXML(t))}}const op=[ju,T_,A_];function Ok(s){for(let t=0;t<op.length;t++)if(op[t].test(s))return op[t];return null}function Nk(s,t,e,n,o,h){const d=e.fill;if(Array.isArray(d)){if(d.length===1)return d[0]}else return d;let l;const _=e.dropShadow?e.dropShadowDistance:0,m=e.padding||0,v=s.width/n-_-m*2,w=s.height/n-_-m*2,b=d.slice(),T=e.fillGradientStops.slice();if(!T.length){const r=b.length+1;for(let a=1;a<r;++a)T.push(a/r)}if(b.unshift(d[0]),T.unshift(0),b.push(d[d.length-1]),T.push(1),e.fillGradientType===Vc.LINEAR_VERTICAL){l=t.createLinearGradient(v/2,m,v/2,w+m);let r=0;const a=(h.fontProperties.fontSize+e.strokeThickness)/w;for(let u=0;u<o.length;u++){const f=h.lineHeight*u;for(let g=0;g<b.length;g++){let x=0;typeof T[g]=="number"?x=T[g]:x=g/b.length;const S=f/w+x*a;let A=Math.max(r,S);A=Math.min(A,1),l.addColorStop(A,b[g]),r=A}}}else{l=t.createLinearGradient(m,w/2,v+m,w/2);const r=b.length+1;let a=1;for(let u=0;u<b.length;u++){let f;typeof T[u]=="number"?f=T[u]:f=a/r,l.addColorStop(f,b[u]),a++}}return l}function zk(s,t,e,n,o,h,d){const l=e.text,_=e.fontProperties;t.translate(n,o),t.scale(h,h);const m=d.strokeThickness/2,v=-(d.strokeThickness/2);if(t.font=d.toFontString(),t.lineWidth=d.strokeThickness,t.textBaseline=d.textBaseline,t.lineJoin=d.lineJoin,t.miterLimit=d.miterLimit,t.fillStyle=Nk(s,t,d,h,[l],e),t.strokeStyle=d.stroke,d.dropShadow){const w=d.dropShadowColor,b=d.dropShadowBlur*h,T=d.dropShadowDistance*h;t.shadowColor=we.shared.setValue(w).setAlpha(d.dropShadowAlpha).toRgbaString(),t.shadowBlur=b,t.shadowOffsetX=Math.cos(d.dropShadowAngle)*T,t.shadowOffsetY=Math.sin(d.dropShadowAngle)*T}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;d.stroke&&d.strokeThickness&&t.strokeText(l,m,v+e.lineHeight-_.descent),d.fill&&t.fillText(l,m,v+e.lineHeight-_.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function qu(s){return s.codePointAt?s.codePointAt(0):s.charCodeAt(0)}function Aw(s){return Array.from?Array.from(s):s.split("")}function Gk(s){typeof s=="string"&&(s=[s]);const t=[];for(let e=0,n=s.length;e<n;e++){const o=s[e];if(Array.isArray(o)){if(o.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${o.length}.`);const h=o[0].charCodeAt(0),d=o[1].charCodeAt(0);if(d<h)throw new Error("[BitmapFont]: Invalid character range.");for(let l=h,_=d;l<=_;l++)t.push(String.fromCharCode(l))}else t.push(...Aw(o))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const qn=class Vr{constructor(t,e,n){var v;const[o]=t.info,[h]=t.common,[d]=t.page,[l]=t.distanceField,_=Pn(d.file),m={};this._ownsTextures=n,this.font=o.face,this.size=o.size,this.lineHeight=h.lineHeight/_,this.chars={},this.pageTextures=m;for(let w=0;w<t.page.length;w++){const{id:b,file:T}=t.page[w];m[b]=e instanceof Array?e[w]:e[T],l!=null&&l.fieldType&&l.fieldType!=="none"&&(m[b].baseTexture.alphaMode=Ri.NO_PREMULTIPLIED_ALPHA,m[b].baseTexture.mipmap=Qr.OFF)}for(let w=0;w<t.char.length;w++){const{id:b,page:T}=t.char[w];let{x:r,y:a,width:u,height:f,xoffset:g,yoffset:x,xadvance:S}=t.char[w];r/=_,a/=_,u/=_,f/=_,g/=_,x/=_,S/=_;const A=new Jt(r+m[T].frame.x/_,a+m[T].frame.y/_,u,f);this.chars[b]={xOffset:g,yOffset:x,xAdvance:S,kerning:{},texture:new Ct(m[T].baseTexture,A),page:T}}for(let w=0;w<t.kerning.length;w++){let{first:b,second:T,amount:r}=t.kerning[w];b/=_,T/=_,r/=_,this.chars[T]&&(this.chars[T].kerning[b]=r)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((v=l==null?void 0:l.fieldType)==null?void 0:v.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,n){let o;if(t instanceof Tc)o=t;else{const d=Ok(t);if(!d)throw new Error("Unrecognized data format for font.");o=d.parse(t)}e instanceof Ct&&(e=[e]);const h=new Vr(o,e,n);return Vr.available[h.font]=h,h}static uninstall(t){const e=Vr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Vr.available[t]}static from(t,e,n){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:o,padding:h,resolution:d,textureWidth:l,textureHeight:_,...m}=Object.assign({},Vr.defaultOptions,n),v=Gk(o),w=e instanceof us?e:new us(e),b=l,T=new Tc;T.info[0]={face:w.fontFamily,size:w.fontSize},T.common[0]={lineHeight:w.fontSize};let r=0,a=0,u,f,g,x=0;const S=[];for(let C=0;C<v.length;C++){u||(u=wt.ADAPTER.createCanvas(),u.width=l,u.height=_,f=u.getContext("2d"),g=new qt(u,{resolution:d,...m}),S.push(new Ct(g)),T.page.push({id:S.length-1,file:""}));const B=v[C],R=Jn.measureText(B,w,!1,u),M=R.width,N=Math.ceil(R.height),L=Math.ceil((w.fontStyle==="italic"?2:1)*M);if(a>=_-N*d){if(a===0)throw new Error(`[BitmapFont] textureHeight ${_}px is too small (fontFamily: '${w.fontFamily}', fontSize: ${w.fontSize}px, char: '${B}')`);--C,u=null,f=null,g=null,a=0,r=0,x=0;continue}if(x=Math.max(N+R.fontProperties.descent,x),L*d+r>=b){if(r===0)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${w.fontFamily}', fontSize: ${w.fontSize}px, char: '${B}')`);--C,a+=x*d,a=Math.ceil(a),r=0,x=0;continue}zk(u,f,R,r,a,d,w);const W=qu(R.text);T.char.push({id:W,page:S.length-1,x:r/d,y:a/d,width:L,height:N,xoffset:0,yoffset:0,xadvance:M-(w.dropShadow?w.dropShadowDistance:0)-(w.stroke?w.strokeThickness:0)}),r+=(L+2*h)*d,r=Math.ceil(r)}if(!(n!=null&&n.skipKerning))for(let C=0,B=v.length;C<B;C++){const R=v[C];for(let M=0;M<B;M++){const N=v[M],L=f.measureText(R).width,W=f.measureText(N).width,k=f.measureText(R+N).width-(L+W);k&&T.kerning.push({first:qu(R),second:qu(N),amount:k})}}const A=new Vr(T,S,!0);return Vr.available[t]!==void 0&&Vr.uninstall(t),Vr.available[t]=A,A}};qn.ALPHA=[["a","z"],["A","Z"]," "],qn.NUMERIC=[["0","9"]],qn.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],qn.ASCII=[[" ","~"]],qn.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:qn.ALPHANUMERIC},qn.available={};let Kn=qn;var Hk=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,$k=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const k0=[],O0=[],N0=[],Vk=class Cw extends Cr{constructor(t,e={}){super();const{align:n,tint:o,maxWidth:h,letterSpacing:d,fontName:l,fontSize:_}=Object.assign({},Cw.styleDefaults,e);if(!Kn.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tintColor=new we(o),this._font=void 0,this._fontName=l,this._fontSize=_,this.text=t,this._maxWidth=h,this._maxLineHeight=0,this._letterSpacing=d,this._anchor=new An(()=>{this.dirty=!0},this,0,0),this._roundPixels=wt.ROUND_PIXELS,this.dirty=!0,this._resolution=wt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var L;const t=Kn.available[this._fontName],e=this.fontSize,n=e/t.size,o=new ue,h=[],d=[],l=[],_=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",m=Aw(_),v=this._maxWidth*t.size/e,w=t.distanceFieldType==="none"?k0:O0;let b=null,T=0,r=0,a=0,u=-1,f=0,g=0,x=0,S=0;for(let W=0;W<m.length;W++){const k=m[W],j=qu(k);if(/(?:\s)/.test(k)&&(u=W,f=T,S++),k==="\r"||k===`
`){d.push(T),l.push(-1),r=Math.max(r,T),++a,++g,o.x=0,o.y+=t.lineHeight,b=null,S=0;continue}const Y=t.chars[j];if(!Y)continue;b&&Y.kerning[b]&&(o.x+=Y.kerning[b]);const ut=N0.pop()||{texture:Ct.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ue};ut.texture=Y.texture,ut.line=a,ut.charCode=j,ut.position.x=Math.round(o.x+Y.xOffset+this._letterSpacing/2),ut.position.y=Math.round(o.y+Y.yOffset),ut.prevSpaces=S,h.push(ut),T=ut.position.x+Math.max(Y.xAdvance-Y.xOffset,Y.texture.orig.width),o.x+=Y.xAdvance+this._letterSpacing,x=Math.max(x,Y.yOffset+Y.texture.height),b=j,u!==-1&&v>0&&o.x>v&&(++g,go(h,1+u-g,1+W-u),W=u,u=-1,d.push(f),l.push(h.length>0?h[h.length-1].prevSpaces:0),r=Math.max(r,f),a++,o.x=0,o.y+=t.lineHeight,b=null,S=0)}const A=m[m.length-1];A!=="\r"&&A!==`
`&&(/(?:\s)/.test(A)&&(T=f),d.push(T),r=Math.max(r,T),l.push(-1));const C=[];for(let W=0;W<=a;W++){let k=0;this._align==="right"?k=r-d[W]:this._align==="center"?k=(r-d[W])/2:this._align==="justify"&&(k=l[W]<0?0:(r-d[W])/l[W]),C.push(k)}const B=h.length,R={},M=[],N=this._activePagesMeshData;w.push(...N);for(let W=0;W<B;W++){const k=h[W].texture,j=k.baseTexture.uid;if(!R[j]){let Y=w.pop();if(!Y){const it=new pk;let gt,Q;t.distanceFieldType==="none"?(gt=new F0(Ct.EMPTY),Q=Vt.NORMAL):(gt=new F0(Ct.EMPTY,{program:Cn.from($k,Hk),uniforms:{uFWidth:0}}),Q=Vt.NORMAL_NPM);const rt=new B0(it,gt);rt.blendMode=Q,Y={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:rt,vertices:null,uvs:null,indices:null}}Y.index=0,Y.indexCount=0,Y.vertexCount=0,Y.uvsCount=0,Y.total=0;const{_textureCache:ut}=this;ut[j]=ut[j]||new Ct(k.baseTexture),Y.mesh.texture=ut[j],Y.mesh.tint=this._tintColor.value,M.push(Y),R[j]=Y}R[j].total++}for(let W=0;W<N.length;W++)M.includes(N[W])||this.removeChild(N[W].mesh);for(let W=0;W<M.length;W++)M[W].mesh.parent!==this&&this.addChild(M[W].mesh);this._activePagesMeshData=M;for(const W in R){const k=R[W],j=k.total;if(!(((L=k.indices)==null?void 0:L.length)>6*j)||k.vertices.length<B0.BATCHABLE_SIZE*2)k.vertices=new Float32Array(4*2*j),k.uvs=new Float32Array(4*2*j),k.indices=new Uint16Array(6*j);else{const Y=k.total,ut=k.vertices;for(let it=Y*4*2;it<ut.length;it++)ut[it]=0}k.mesh.size=6*j}for(let W=0;W<B;W++){const k=h[W];let j=k.position.x+C[k.line]*(this._align==="justify"?k.prevSpaces:1);this._roundPixels&&(j=Math.round(j));const Y=j*n,ut=k.position.y*n,it=k.texture,gt=R[it.baseTexture.uid],Q=it.frame,rt=it._uvs,Z=gt.index++;gt.indices[Z*6+0]=0+Z*4,gt.indices[Z*6+1]=1+Z*4,gt.indices[Z*6+2]=2+Z*4,gt.indices[Z*6+3]=0+Z*4,gt.indices[Z*6+4]=2+Z*4,gt.indices[Z*6+5]=3+Z*4,gt.vertices[Z*8+0]=Y,gt.vertices[Z*8+1]=ut,gt.vertices[Z*8+2]=Y+Q.width*n,gt.vertices[Z*8+3]=ut,gt.vertices[Z*8+4]=Y+Q.width*n,gt.vertices[Z*8+5]=ut+Q.height*n,gt.vertices[Z*8+6]=Y,gt.vertices[Z*8+7]=ut+Q.height*n,gt.uvs[Z*8+0]=rt.x0,gt.uvs[Z*8+1]=rt.y0,gt.uvs[Z*8+2]=rt.x1,gt.uvs[Z*8+3]=rt.y1,gt.uvs[Z*8+4]=rt.x2,gt.uvs[Z*8+5]=rt.y2,gt.uvs[Z*8+6]=rt.x3,gt.uvs[Z*8+7]=rt.y3}this._textWidth=r*n,this._textHeight=(o.y+t.lineHeight)*n;for(const W in R){const k=R[W];if(this.anchor.x!==0||this.anchor.y!==0){let it=0;const gt=this._textWidth*this.anchor.x,Q=this._textHeight*this.anchor.y;for(let rt=0;rt<k.total;rt++)k.vertices[it++]-=gt,k.vertices[it++]-=Q,k.vertices[it++]-=gt,k.vertices[it++]-=Q,k.vertices[it++]-=gt,k.vertices[it++]-=Q,k.vertices[it++]-=gt,k.vertices[it++]-=Q}this._maxLineHeight=x*n;const j=k.mesh.geometry.getBuffer("aVertexPosition"),Y=k.mesh.geometry.getBuffer("aTextureCoord"),ut=k.mesh.geometry.getIndex();j.data=k.vertices,Y.data=k.uvs,ut.data=k.indices,j.update(),Y.update(),ut.update()}for(let W=0;W<h.length;W++)N0.push(h[W]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:n,size:o}=Kn.available[this._fontName];if(n!=="none"){const{a:h,b:d,c:l,d:_}=this.worldTransform,m=Math.sqrt(h*h+d*d),v=Math.sqrt(l*l+_*_),w=(Math.abs(m)+Math.abs(v))/2,b=this.fontSize/o,T=t._view.resolution;for(const r of this._activePagesMeshData)r.mesh.shader.uniforms.uFWidth=w*e*b*T}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Kn.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Kn.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Kn.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,n=Kn.available[this._fontName].distanceFieldType==="none"?k0:O0;n.push(...this._activePagesMeshData);for(const o of this._activePagesMeshData)this.removeChild(o.mesh);this._activePagesMeshData=[],n.filter(o=>e[o.mesh.texture.baseTexture.uid]).forEach(o=>{o.mesh.texture=Ct.EMPTY});for(const o in e)e[o].destroy(),delete e[o];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Vk.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Wk=[".xml",".fnt"],Xk={extension:{type:yt.LoadParser,priority:Ir.Normal},name:"loadBitmapFont",test(s){return Wk.includes(ei.extname(s).toLowerCase())},async testParse(s){return ju.test(s)||A_.test(s)},async parse(s,t,e){const n=ju.test(s)?ju.parse(s):A_.parse(s),{src:o}=t,{page:h}=n,d=[];for(let m=0;m<h.length;++m){const v=h[m].file;let w=ei.join(ei.dirname(o),v);w=v_(w,o),d.push(w)}const l=await e.load(d),_=d.map(m=>l[m]);return Kn.install(n,_,!0)},async load(s,t){return(await wt.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}};Ut.add(Xk);const C_=class eo extends us{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new eo(Object.keys(eo.defaultOptions).reduce((e,n)=>({...e,[n]:t[n]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete eo.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:n}=eo;if(n[t]){const o=n[t];return this._fonts.push(o),o.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return wt.ADAPTER.fetch(t).then(o=>o.blob()).then(async o=>new Promise((h,d)=>{const l=URL.createObjectURL(o),_=new FileReader;_.onload=()=>h([l,_.result]),_.onerror=d,_.readAsDataURL(o)})).then(async([o,h])=>{const d=Object.assign({family:ei.basename(t,ei.extname(t)),weight:"normal",style:"normal",display:"auto",src:o,dataSrc:h,refs:1,originalUrl:t,fontFace:null},e);n[t]=d,this._fonts.push(d),this.styleID++;const l=new FontFace(d.family,`url(${d.src})`,{weight:d.weight,style:d.style,display:d.display});d.fontFace=l,await l.load(),document.fonts.add(l),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(n=>!this._overrides.includes(n));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(n=>this._overrides.includes(n));e.length>0&&(this._overrides=this._overrides.filter(n=>!e.includes(n)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=D3(t)),typeof t=="number"?L3(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,n=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),o=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const h=`${n}px ${o}px`;return this.dropShadowBlur>0?`text-shadow: ${h} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${h} ${t}`}reset(){Object.assign(this,eo.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=wt.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};C_.availableFonts={},C_.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let lp=C_;const au=class io extends la{constructor(t="",e={}){super(Ct.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const n=new Image,o=Ct.from(n,{scaleMode:wt.SCALE_MODE,resourceOptions:{autoLoad:!1}});o.orig=new Jt,o.trim=new Jt,this.texture=o;const h="http://www.w3.org/2000/svg",d="http://www.w3.org/1999/xhtml",l=document.createElementNS(h,"svg"),_=document.createElementNS(h,"foreignObject"),m=document.createElementNS(d,"div"),v=document.createElementNS(d,"style");_.setAttribute("width","10000"),_.setAttribute("height","10000"),_.style.overflow="hidden",l.appendChild(_),this.maxWidth=io.defaultMaxWidth,this.maxHeight=io.defaultMaxHeight,this._domElement=m,this._styleElement=v,this._svgRoot=l,this._foreignObject=_,this._foreignObject.appendChild(v),this._foreignObject.appendChild(m),this._image=n,this._loadImage=new Image,this._autoResolution=io.defaultAutoResolution,this._resolution=io.defaultResolution??wt.RESOLUTION,this.text=t,this.style=e}measureText(t){var v,w;const{text:e,style:n,resolution:o}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:n.toCSS(o)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const h=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:d,height:l}=h;(d>this.maxWidth||l>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const _=Math.min(this.maxWidth,Math.ceil(d)),m=Math.min(this.maxHeight,Math.ceil(l));return this._svgRoot.setAttribute("width",_.toString()),this._svgRoot.setAttribute("height",m.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:(v=this._style)==null?void 0:v.toCSS(o)}),this._styleElement.textContent=(w=this._style)==null?void 0:w.toGlobalCSS()),{width:_+n.padding*2,height:m+n.padding*2}}async updateText(t=!0){const{style:e,_image:n,_loadImage:o}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:h,height:d}=this.measureText();n.width=o.width=Math.ceil(Math.max(1,h)),n.height=o.height=Math.ceil(Math.max(1,d)),this._updateID++;const l=this._updateID;await new Promise(_=>{o.onload=async()=>{if(l<this._updateID){_();return}await e.onBeforeDraw(),n.src=o.src,o.onload=null,o.src="",this.updateTexture(),_()};const m=new XMLSerializer().serializeToString(this._svgRoot);o.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(m)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:n,resolution:o}=this,{padding:h}=t,{baseTexture:d}=e;e.trim.width=e._frame.width=n.width/o,e.trim.height=e._frame.height=n.height/o,e.trim.x=-h,e.trim.y=-h,e.orig.width=e._frame.width-h*2,e.orig.height=e._frame.height-h*2,this._onTextureUpdate(),d.setRealSize(n.width,n.height,o),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var n,o,h,d,l;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},io.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((n=this._style)==null||n.cleanFonts()),this._style=e,(o=this._svgRoot)==null||o.remove(),this._svgRoot=e,(h=this._domElement)==null||h.remove(),this._domElement=e,(d=this._foreignObject)==null||d.remove(),this._foreignObject=e,(l=this._styleElement)==null||l.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=ns(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=ns(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof lp?(this.ownsStyle=!1,this._style=t):t instanceof us?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=lp.from(t)):(this.ownsStyle=!0,this._style=new lp(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};au.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},au.defaultMaxWidth=2024,au.defaultMaxHeight=2024,au.defaultAutoResolution=!0;const Yk={class:"flex-1 flex items-center justify-center"},jk={class:"control-bar w-full px-4 py-4 flex items-center gap-4"},qk={class:"text-white text-base"},Kk={class:"text-white text-base"},Zk={class:"flex w-full items-center justify-center gap-6"},Jk={class:"text-white hover:text-purple-500 transition-colors"},Qk={class:"ml-auto flex items-center gap-4"},tO=hi({__name:"Player",props:{tracks:{},currentTime:{},playerDuration:{}},emits:["prevFrame","nextFrame","timeUpdate","captureImage","fullscreenChange","updateClipProps"],setup(s,{expose:t,emit:e}){const n=s,o=e,h=sa(),d=Uc("activeClip"),l=Tt(!1),_=Tt(!1),m=Tt(100),v=Tt(!1),w=Tt(!1),b=Tt(null),T=Tt(null),r=Tt(0);let a=null;De(()=>v.value||m.value===0?"fa-volume-mute":m.value<30?"fa:volume-off":m.value<70?"fa-volume-down":"fa-volume-up");const u=De(()=>h.getCanvasSize),f=De(()=>{let H=0;return n.tracks.forEach(G=>{G.clips.forEach(at=>{H++})}),H}),g=H=>{H?(a.play({start:n.currentTime*1e6}),_.value=!0):(a.pause(),_.value=!1)},x=()=>{a.pause(),_.value=!1},S=()=>{_.value&&g(!1),o("timeUpdate",n.currentTime-1/30),a.previewFrame(n.currentTime*1e6)},A=()=>{_.value&&g(!1),o("timeUpdate",n.currentTime+1/30),a.previewFrame(n.currentTime*1e6)},C=()=>{w.value=!w.value,w.value?T.value&&T.value.requestFullscreen():document.exitFullscreen()},B=H=>{const G=document.activeElement;if(!(G instanceof HTMLInputElement||G instanceof HTMLTextAreaElement||(G==null?void 0:G.getAttribute("contenteditable"))==="true"))switch(H.code){case"Space":H.preventDefault(),g(!_.value);break;case"ArrowLeft":H.preventDefault(),S();break;case"ArrowRight":H.preventDefault(),A();break}},R=()=>{a=new G2(b.value,{bgColor:"#000",width:1920,height:1080}),console.log(a),N(),a.previewFrame(0),a.on("timeupdate",H=>{o("timeUpdate",H/1e6)}),a.on("playing",()=>{console.log("playing")}),a.on("paused",()=>{console.log("paused"),n.currentTime>=n.playerDuration&&(_.value=!1,o("timeUpdate",0))}),a.on("activeSpriteChange",H=>{for(const[G,at]of M.entries())Object.is(at,H)&&d(G)})},M=new Map,N=()=>{n.tracks.forEach(H=>{H.clips.forEach(G=>{k(G)})})},L=H=>{k(H)},W=H=>{if(!H)return a.activeSprite=null;const G=M.get(H.id);a&&(G!=null&&G.visible)&&(a.activeSprite=G)},k=async H=>{if(M.has(H.id))return;let G=null;switch(H.type){case"video":{let at=await cf(H.path),vt=await new D_(await at.stream());vt.tickInterceptor=async(At,kt)=>{let ht=[];for(const q of kt.audio)ht.push(q.map(nt=>nt=nt*(H.volume/100)));return kt.audio=ht,kt.video=await j(kt.video),kt},Number(H.sourceStartTime)>0&&(vt=(await vt.split(Number(H.sourceStartTime)*1e6))[1]),G=new Jo(vt);break}case"audio":{const at=await cf(H.path);let vt=await new k_(await at.stream());if(Number(H.sourceStartTime)>0){const At=await vt.split(Number(H.sourceStartTime)*1e6);Number(H.sourceEndTime)?vt=(await At[1].split((Number(H.originalDuration)-Number(H.sourceEndTime)-Number(H.sourceStartTime))*1e6))[0]:vt=At[1]}G=new Jo(vt),G.visible=!1;break}case"image":{const at=await cf(H.path);let vt=null;if(H.isAnimateImg){const At=at.name.split(".").pop();vt=new Ku({type:`image/${At}`,stream:await at.stream()})}else vt=new Ku(await at.stream());G=new Jo(vt);break}case"text":{const at=new Ip(H.textConfig,(vt,At)=>{o("updateClipProps",H.id,{w:vt,h:At})});G=new Jo(at);break}case"filter":{const at=new Fp(Number(H.duration)*1e6);G=new Jo(at),G.visible=!1;break}}h.unsubscribeFromClipUpdates(H.id),h.subscribeToClipUpdates(H.id,async(at,vt)=>{ut(at,vt)}),G&&(G.time.offset=Number(H.startTime)*1e6,G.time.duration=Number(H.duration)*1e6,G.opacity=Number((H.opacity/100).toFixed(2)),G.rect.fixedScaleCenter=!0,G.rect.fixedAspectRatio=!0,M.set(H.id,G),await(a==null?void 0:a.addSprite(G)),r.value++,H.type!=="audio"&&(H.w?(G.rect.x=H.x,G.rect.y=H.y,G.rect.w=H.w,G.rect.h=H.h,G.rect.angle=H.angle):H.type==="text"?o("updateClipProps",H.id,{x:G.rect.x,y:G.rect.y,w:H.textConfig.width,h:H.textConfig.height,angle:G.rect.angle}):o("updateClipProps",H.id,{x:G.rect.x,y:G.rect.y,w:G.rect.w,h:G.rect.h,angle:G.rect.angle})),G.rect.on("propsChange",at=>{H.type==="text"?"w"in at&&H.w&&(H.textConfig.fontSize=at.w/H.w*H.textConfig.fontSize,H.w=at.w):o("updateClipProps",H.id,at)}))},j=async(H,G)=>{if(!H)return null;const at=H.displayWidth,vt=H.displayHeight,At=n.tracks.flatMap(Nt=>Nt.clips).filter(Nt=>Nt.type==="filter"&&n.currentTime>=Nt.startTime&&n.currentTime<Nt.startTime+Nt.duration);if(!At.length)return H;const kt=new rw({width:at,height:vt,backgroundAlpha:0}),ht=Ct.from(H),q=la.from(ht);kt.stage.addChild(q);const nt=[];for(const Nt of At){const Lt=Nt.intensity/100;switch(Nt.filterType){case"grayscale":{const ce=new qs;ce.grayscale(Lt,!1),nt.push(ce);break}case"sepia":{const ce=new qs;ce.sepia(!1),nt.push(ce);break}case"invert":{const ce=new qs;ce.negative(!1),nt.push(ce);break}case"brightness":{const ce=new qs;ce.brightness(1+Lt,!1),nt.push(ce);break}case"blur":{const ce=new tw;ce.blur=Lt*10,nt.push(ce);break}}}console.log(),q.filters=nt;const dt=H.timestamp,Xt=H.duration,Ot=kt.renderer.extract.canvas(kt.stage);return kt.destroy(!0),ht.destroy(!0),H.close(),new VideoFrame(Ot,{timestamp:dt,duration:Xt,displayWidth:at,displayHeight:vt})},Y=()=>{let H=0;n.tracks.forEach(G=>{G.clips.forEach(at=>{const vt=M.get(at.id);!vt||at.type==="text"||(vt.zIndex=H++)}),G.clips.forEach(at=>{const vt=M.get(at.id);!vt||at.type!=="text"||(vt.zIndex=H++)})})},ut=async(H,G="default")=>{if(g(!1),!M.has(H.id))return;const at=M.get(H.id);if(G==="delete"){H.type==="filter"&&n.tracks.forEach(vt=>{vt.clips.forEach(At=>{if(n.currentTime>=At.startTime&&n.currentTime<At.startTime+At.duration){const kt=M.get(At.id);kt.preFrame(n.currentTime*1e6-kt.time.offset)}})}),a==null||a.removeSprite(at),M.delete(H.id);return}if(G==="resize"&&(H.type==="video"||H.type==="audio")){a==null||a.removeSprite(at),M.delete(H.id),await k(H);return}if(at.time.offset=H.startTime*1e6,at.time.duration=Number(H.duration)*1e6,at.opacity=Number((H.opacity/100).toFixed(2)),Y(),H.type==="text"){const vt=at.getClip();vt.textConfig=H.textConfig,at.rect.w=H.w,at.rect.h=H.h,at.preFrame(n.currentTime*1e6)}else H.type==="filter"?n.tracks.forEach(vt=>{vt.clips.forEach(At=>{if((At.type==="video"||At.type==="image")&&At.startTime<=n.currentTime&&At.endTime>=n.currentTime){const kt=M.get(At.id);kt&&kt.preFrame(n.currentTime*1e6-kt.time.offset)}})}):H.type!=="audio"&&(at.rect.x=H.x,at.rect.y=H.y,at.rect.w=H.w,at.rect.h=H.h,at.rect.angle=H.angle);a==null||a.previewFrame(n.currentTime*1e6)},it=()=>{a==null||a.destroy(),M.clear(),r.value=0,Il(()=>{R()})},gt=async()=>{const H=await(a==null?void 0:a.createCombinator());try{const G={dangerouslyUseHTMLString:!0,showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!0,showConfirmButton:!1,cancelButtonText:"停止",customClass:"export-progress-dialog",beforeClose:(at,vt,At)=>{at==="cancel"&&(H==null||H.destroy(),At())}};uf.alert(`
            <div class="flex flex-col gap-2 w-full min-w-[300px]">
                <div class="text-center text-base">0%</div>
                <div class="w-full bg-[#2b2b2b] rounded-full h-2">
                    <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        `,"导出进度",G),await Il(),H.on("OutputProgress",at=>{const vt=Math.round(at*100),At=document.querySelector(".el-message-box__message");if(At&&(At.innerHTML=`
                    <div class="flex flex-col gap-2 w-full min-w-[300px]">
                        <div class="text-center text-base">${vt}%</div>
                        <div class="w-full bg-[#2b2b2b] rounded-full h-2">
                            <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: ${vt}%"></div>
                        </div>
                    </div>
                `,at===1)){const kt=document.querySelector(".el-message-box__cancel");kt&&(kt.style.display="none"),At.innerHTML=`
                        <div class="flex flex-col gap-2 w-full min-w-[300px]">
                            <div class="text-center text-green-500 text-base">导出完成！</div>
                            <div class="w-full bg-[#2b2b2b] rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 100%"></div>
                            </div>
                        </div>
                    `,setTimeout(()=>{uf.close()},3e3)}}),await(H==null?void 0:H.output().pipeTo(await rI()))}catch(G){uf.close(),Zs.error("导出失败："+G.message)}},Q=H=>{const G=Math.floor(H/60),at=Math.floor(H%60);return`${G}:${at.toString().padStart(2,"0")}`},rt=()=>{T.value&&new ResizeObserver(G=>{var at;for(let vt of G){const{width:At,height:kt}=vt.contentRect,ht=(at=document.querySelector(".control-bar"))==null?void 0:at.clientHeight,q=kt-ht;At/q>1.7777777777777777?h.setCanvasSize({width:q*16/9,height:q}):h.setCanvasSize({width:At,height:At*9/16})}}).observe(T.value)};So(()=>{Zt.setLogLevel(Zt.warn),R(),rt(),window.addEventListener("keydown",B)}),Nl(()=>{a==null||a.destroy(),M.clear(),a=null,r.value=0,window.removeEventListener("keydown",B);for(const H of M.keys())h.unsubscribeFromClipUpdates(H)}),ls(()=>r.value,H=>{if(f.value!==0&&(l.value=!0),H===f.value){l.value=!1,a==null||a.previewFrame(n.currentTime*1e6);for(const G of n.tracks.flatMap(at=>at.clips))Y();setTimeout(()=>{const G=a==null?void 0:a.captureImage();o("captureImage",G)},500)}},{immediate:!0}),ls(()=>n.currentTime,H=>{_.value||a.previewFrame(H*1e6)}),t({handleStopPlay:x,refreshPlayer:it,addClip:L,activeClip:W,handleExport:gt});const Z=document.createElement("style");return Z.textContent=`
.export-progress-dialog .el-message-box__content {
    padding: 20px;
}
.export-progress-dialog .el-message-box__message {
    padding: 0;
}
.export-progress-dialog .el-message-box__message p {
    margin: 0;
}
.export-progress-dialog .el-message-box__container {
    width: 100%;
}
`,document.head.appendChild(Z),(H,G)=>{const at=QU("loading");return JU((St(),Ft("div",{ref_key:"playerRef",ref:T,class:"player-container w-full h-full bg-[#1b1b1b] relative flex flex-col"},[$("div",Yk,[$("div",{ref_key:"avCanvas",ref:b,class:"",style:Er({width:Wt(u).width+"px",height:Wt(u).height+"px"})},null,4)]),$("div",jk,[$("div",qk,li(Q(H.currentTime)),1),G[2]||(G[2]=$("div",{class:"text-white text-base"},"/",-1)),$("div",Kk,li(Q(H.playerDuration)),1),$("div",Zk,[$("button",{class:"text-white hover:text-purple-500 transition-colors",onClick:S},[lt(Wt(ye),{icon:"fa-step-backward"})]),$("button",Jk,[Wt(_)?(St(),Pi(Wt(ye),{key:1,icon:"fa-pause",onClick:G[1]||(G[1]=vt=>g(!1))})):(St(),Pi(Wt(ye),{key:0,icon:"fa-play",onClick:G[0]||(G[0]=vt=>g(!0))}))]),$("button",{class:"text-white hover:text-purple-500 transition-colors",onClick:A},[lt(Wt(ye),{icon:"fa-step-forward"})])]),$("div",Qk,[$("button",{class:"text-white hover:text-purple-500 transition-colors",onClick:C},[lt(Wt(ye),{icon:Wt(w)?"fa-compress":"fa-expand"},null,8,["icon"])])])])])),[[at,Wt(l)]])}}}),eO=ar(tO,[["__scopeId","data-v-3f47bb4e"]]);let ou;const iO=new Uint8Array(16);function rO(){if(!ou&&(ou=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ou))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ou(iO)}const si=[];for(let s=0;s<256;++s)si.push((s+256).toString(16).slice(1));function nO(s,t=0){return si[s[t+0]]+si[s[t+1]]+si[s[t+2]]+si[s[t+3]]+"-"+si[s[t+4]]+si[s[t+5]]+"-"+si[s[t+6]]+si[s[t+7]]+"-"+si[s[t+8]]+si[s[t+9]]+"-"+si[s[t+10]]+si[s[t+11]]+si[s[t+12]]+si[s[t+13]]+si[s[t+14]]+si[s[t+15]]}const sO=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),z0={randomUUID:sO};function as(s,t,e){if(z0.randomUUID&&!s)return z0.randomUUID();s=s||{};const n=s.random||(s.rng||rO)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,nO(n)}const aO={class:"p-5"},oO={class:"flex items-center justify-center"},lO={class:"flex items-center justify-center"},hO={class:"h-[calc(100vh-7rem)] mt-2 overflow-y-auto"},uO={class:"w-full grid grid-cols-2 gap-3"},cO=["onContextmenu","onMouseover","onMouseleave","onDragstart"],dO={class:"relative w-full h-full bg-[#121212]"},fO=["src"],pO=["src"],_O={key:2,class:"w-full aspect-video flex items-center justify-center"},gO={key:3,class:"absolute w-[12%] h-[12%] right-[16%] bottom-[12%] flex items-center gap-1 rounded-full"},mO={class:"text-tiny truncate mt-1"},yO=hi({__name:"mediaLibrary",emits:["add-clip"],setup(s,{emit:t}){const e=sa(),n=Uc("addClip"),o=Tt([]),h=new Map,d=x=>S=>{h.set(x,S)};So(()=>{l()});const l=()=>{Ke.medias.toArray().then(async x=>{if(x){let S=[];for(const A of x){const C=await nI(A.path);S.push({...A,filePath:C})}o.value=S}})},_=async x=>{const S=await Ke.medias.where({name:x.name}).first();if(S&&S.size===x.size)return Zs.warning("文件已存在"),!1;const A=x.name.split(".").pop();let C="";switch(A){case"mp4":case"mov":case"avi":case"wmv":C="video";break;case"mp3":case"wav":case"m4a":case"m4s":case"m3u8":case"aac":case"ogg":case"flac":case"webm":case"opus":C="audio";break;case"png":case"jpg":case"jpeg":case"gif":case"bmp":case"tiff":case"ico":case"svg":case"webp":case"avif":C="image";break;default:return Zs.warning("请检查文件格式"),!1}let B="/"+C+"/"+x.name;const R=await Pl(B);let M=!1;if(R.exists()&&(await R.remove(),M=!0),await P_(B,x.stream()),await Pl(B).exists()){const N={name:x.name,size:x.size,type:C,path:B,isAnimateImg:!1};switch(C){case"video":const W=await new D_(x.stream()).ready;W&&(N.duration=W.duration);break;case"audio":const j=await new k_(await x.stream()).ready;j&&(N.duration=j.duration);break;case"image":try{N.duration=3e6;const Y=["gif","webp","avif","webp"],ut=x.name.split(".").pop();if(Y.includes(ut)){const it=new Ku({type:`image/${ut}`,stream:await x.stream()}),gt=await it.ready,{video:Q}=await it.tick(0),{video:rt}=await it.tick(1e6),H=new OffscreenCanvas(Q.codedWidth,Q.codedHeight).getContext("2d");H.drawImage(Q,0,0);const G=H.getImageData(0,0,Q.codedWidth,Q.codedHeight);H.clearRect(0,0,Q.codedWidth,Q.height),H.drawImage(rt,0,0);const at=H.getImageData(0,0,rt.codedWidth,rt.codedHeight),vt=m(G.data,at.data);N.isAnimateImg=!0}else N.isAnimateImg=!1}catch(Y){console.log(Y)}break}M&&S?(N.updateTime=new Date().getTime(),await Ke.medias.where({name:x.name}).modify(N)):(N.createTime=new Date().getTime(),await Ke.medias.add(N)),l()}else Zs.error("上传失败");return!1},m=(x,S)=>{if(x.length!==S.length)return!1;for(let A=0;A<x.length;A++)if(x[A]!==S[A])return!1;return!0},v=De(()=>e.getShowContextMenu),w=De(()=>e.getContextMenuPosition),b=Tt(""),T=(x,S)=>{b.value=S.id,e.setShowContextMenu(!0);const{offsetX:A,offsetY:C}=x;e.setContextMenuPosition({x:A,y:C})},r=(x,S)=>{x.hovered=!0;const A=h.get(S);A&&x.type==="video"&&A.play()},a=(x,S)=>{x.hovered=!1;const A=h.get(S);A&&x.type==="video"&&(A.currentTime=0,A.pause())},u=(x,S)=>{x.dataTransfer&&(x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("application/json",JSON.stringify(S)),x.dataTransfer.setData("text/plain",JSON.stringify(S)),e.setDragData(S))},f=x=>{const S={id:as(),type:x.type,isAnimateImg:x.isAnimateImg,name:x.name,path:x.path,duration:x.duration?Number(x.duration)/1e6:5,startTime:0,endTime:x.duration?Number(x.duration)/1e6:5,opacity:100,angle:0};x.type==="image"&&(S.duration=5,S.endTime=5),n==null||n(S,!0)},g=x=>{Ke.medias.where({id:x.id}).delete(),l()};return(x,S)=>{const A=le("upload-filled"),C=le("el-icon"),B=le("el-upload"),R=le("Headset"),M=le("CirclePlus"),N=le("DeleteFilled");return St(),Ft("div",aO,[$("div",oO,[lt(B,{class:"w-full",drag:"",action:"163",multiple:"","show-file-list":!1,"before-upload":_},{tip:he(()=>S[1]||(S[1]=[])),default:he(()=>[$("div",lO,[lt(C,{class:"mr-1",size:"30"},{default:he(()=>[lt(A)]),_:1}),S[0]||(S[0]=$("div",{class:"flex flex-col items-start"},[$("div",{class:"text-tiny"}," 拖拽或上传文件 "),$("div",{class:"flex items-center justify-center text-xs"}," 支持视频、音频、图片格式 ")],-1))])]),_:1})]),$("div",hO,[$("div",uO,[(St(!0),Ft($i,null,In(o.value,(L,W)=>(St(),Ft("div",{class:"relative flex flex-col justify-center w-full hover:bg-[#121212] p-1.5 rounded-md",onContextmenu:Ii(k=>T(k,L),["prevent"]),onMouseover:k=>r(L,W),onMouseleave:k=>a(L,W),onDragstart:k=>u(k,L),draggable:"true"},[$("div",dO,[L.type==="image"?(St(),Ft("img",{key:0,src:L.filePath,alt:"",class:"aspect-video object-contain rounded"},null,8,fO)):be("",!0),L.type==="video"?(St(),Ft("video",{key:1,ref_for:!0,ref:d(W),src:L.filePath,muted:"",loop:"",disablepictureinpicture:"",class:"aspect-video object-contain rounded"},null,8,pO)):be("",!0),L.type==="audio"?(St(),Ft("div",_O,[lt(C,null,{default:he(()=>[lt(R)]),_:1})])):be("",!0),L.hovered?(St(),Ft("div",gO,[lt(C,{class:"w-full h-full bg-[#333333] rounded-full cursor-pointer",onClick:Ii(k=>f(L),["stop"])},{default:he(()=>[lt(M)]),_:2},1032,["onClick"]),lt(C,{class:"w-full h-full bg-[#333333] rounded-full cursor-pointer",onClick:Ii(k=>g(L),["stop"])},{default:he(()=>[lt(N)]),_:2},1032,["onClick"])])):be("",!0),Wt(v)&&L.id===b.value?(St(),Ft("div",{key:4,class:"absolute flex flex-col justify-center bg-[#121212] py-1.5 rounded-md",style:Er({left:Wt(w).x+"px",top:Wt(w).y+"px"})},S[2]||(S[2]=[$("div",{class:"px-3 py-0.5 text-tiny hover:bg-gray cursor-pointer"},"裁剪",-1)]),4)):be("",!0)]),$("div",mO,li(L.name),1)],40,cO))),256))])])])}}}),vO=ar(yO,[["__scopeId","data-v-152a74d1"]]),xO=""+new URL("1-DX-6C8MT.png",import.meta.url).href,bO=""+new URL("2-Bbrfykah.png",import.meta.url).href,G0=s=>new URL(Object.assign({"../assets/image/text/1.png":xO,"../assets/image/text/2.png":bO})[`../assets/image/${s}`],import.meta.url).href,wO=[{preview:G0("text/1.png"),name:"描边标题",style:{content:"描边文字效果",fontSize:48,fontFamily:"Microsoft YaHei",bold:!0,italic:!1,color:"#FFFFFF",opacity:100,lineSpacing:0,letterSpacing:0,align:"center",showShadow:!1,shadowColor:"#000000",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,showStroke:!0,strokeColor:"red",strokeWidth:3}},{preview:G0("text/2.png"),name:"阴影标题",style:{content:"阴影文字效果",fontSize:52,fontFamily:"Microsoft YaHei",bold:!0,italic:!1,color:"#FFD93D",opacity:100,lineSpacing:0,letterSpacing:0,align:"center",showShadow:!0,shadowColor:"rgba(59, 59, 59, 1)",shadowBlur:10,shadowOffsetX:4,shadowOffsetY:4,showStroke:!1,strokeColor:"#000000",strokeWidth:0}}],SO={class:"p-4"},EO={class:"grid grid-cols-2 gap-4"},TO={class:"h-8 text-white text-xl mb-2"},AO={class:"text-[#666] text-sm"},CO={class:"absolute inset-0 bg-purple-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-lg"},UO=["onClick","onDragstart"],IO={class:"h-8 text-white text-xl mb-2"},PO=["src"],RO={class:"text-[#666] text-sm"},BO={class:"absolute inset-0 bg-purple-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-lg"},FO=hi({__name:"textLibrary",setup(s){const t=sa(),e=Uc("addClip"),n=Tt({preview:"Aa",name:"基础文字",style:{fontSize:72,fontFamily:"Microsoft YaHei",color:"#ffffff"}}),o=l=>{const _=d(l);t.setDragData(_)},h=l=>{const _=d(l);e==null||e(_,!0)},d=l=>({id:as(),type:"text",name:l.name,duration:5,startTime:0,endTime:5,opacity:100,angle:0,textConfig:{content:l.name||"基础文字",lineSpacing:0,letterSpacing:0,showStroke:!1,strokeColor:"#ffffff",strokeWidth:0,showShadow:!1,shadowColor:"#ffffff",shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,...l.style}});return(l,_)=>{const m=le("el-icon");return St(),Ft("div",SO,[$("div",EO,[$("div",{class:"relative group cursor-pointer bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded-lg p-4 flex flex-col items-center",onClick:_[0]||(_[0]=v=>h(Wt(n))),draggable:"true",onDragstart:_[1]||(_[1]=v=>o(Wt(n)))},[$("div",TO,li(Wt(n).preview),1),$("div",AO,li(Wt(n).name),1),$("div",CO,[lt(m,{class:"text-white text-2xl"},{default:he(()=>[lt(Wt(fp))]),_:1})])],32),(St(!0),Ft($i,null,In(Wt(wO),v=>(St(),Ft("div",{key:v.name,class:"relative group cursor-pointer bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded-lg p-4 flex flex-col items-center",onClick:w=>h(v),draggable:"true",onDragstart:w=>o(v)},[$("div",IO,[$("img",{src:v.preview,class:"w-full h-full object-contain"},null,8,PO)]),$("div",RO,li(Wt(n).name),1),$("div",BO,[lt(m,{class:"text-white text-2xl"},{default:he(()=>[lt(Wt(fp))]),_:1})])],40,UO))),128))])])}}}),MO={class:"p-4"},LO={class:"grid grid-cols-2 gap-4"},DO=["onClick","onDragstart"],kO={class:"preview-box h-8 mb-2"},OO={class:"text-[#666] text-sm"},NO={class:"absolute inset-0 bg-purple-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-lg"},zO="/preview.jpg",GO=hi({__name:"filterLibrary",setup(s){const t=sa(),e=Uc("addClip"),n=[{type:"grayscale",name:"黑白"},{type:"sepia",name:"复古"},{type:"invert",name:"反色"},{type:"brightness",name:"明亮"},{type:"blur",name:"模糊"}],o=l=>{switch(l){case"grayscale":return{filter:"grayscale(100%)"};case"sepia":return{filter:"sepia(100%)"};case"invert":return{filter:"invert(100%)"};case"brightness":return{filter:"brightness(150%)"};case"blur":return{filter:"blur(2px)"};default:return{}}},h=(l,_)=>{if(!l.dataTransfer)return;const m={id:as(),type:"filter",filterType:_.type,name:_.name,intensity:100,duration:5,startTime:0,endTime:5,originalDuration:5};l.dataTransfer.setData("application/json",JSON.stringify(m)),t.setDragData(m),l.dataTransfer.effectAllowed="copy"},d=l=>{const _={id:as(),type:"filter",filterType:l.type,name:l.name,intensity:100,duration:5,startTime:0,endTime:5,originalDuration:5};e==null||e(_,!0)};return(l,_)=>{const m=le("el-icon");return St(),Ft("div",MO,[$("div",LO,[(St(),Ft($i,null,In(n,v=>$("div",{key:v.type,class:"relative group cursor-pointer bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded-lg p-4 flex flex-col items-center",onClick:w=>d(v),draggable:"true",onDragstart:w=>h(w,v)},[$("div",kO,[$("img",{src:zO,class:"h-full object-contain",style:Er(o(v.type))},null,4)]),$("div",OO,li(v.name),1),$("div",NO,[lt(m,{class:"text-white text-2xl"},{default:he(()=>[lt(Wt(fp))]),_:1})])],40,DO)),64))])])}}}),HO=ar(GO,[["__scopeId","data-v-cee563d8"]]),$O={class:"h-screen"},VO={class:"flex flex-col items-center justify-center"},WO=hi({__name:"clipMenu",setup(s){const t=[{name:"媒体库",component:vO},{name:"文字",component:FO},{name:"滤镜",component:HO}];return(e,n)=>{const o=le("Files"),h=le("el-icon"),d=le("el-tab-pane"),l=le("el-tabs");return St(),Ft("div",$O,[lt(l,{type:"border-card",tabPosition:"left"},{default:he(()=>[(St(),Ft($i,null,In(t,_=>lt(d,{label:"User"},{label:he(()=>[$("div",VO,[lt(h,null,{default:he(()=>[lt(o)]),_:1}),$("div",null,li(_.name),1)])]),default:he(()=>[(St(),Pi(tI(_.component),{class:"w-full h-screen bg-[#303030]"}))]),_:2},1024)),64))]),_:1})])}}}),XO=ar(WO,[["__scopeId","data-v-946103cd"]]);var ir=typeof window<"u"?window:null,rg=ir===null,Ol=rg?void 0:ir.document,fr="addEventListener",pr="removeEventListener",hp="getBoundingClientRect",al="_a",_r="_b",pn="_c",lu="horizontal",gr=function(){return!1},YO=rg?"calc":["","-webkit-","-moz-","-o-"].filter(function(s){var t=Ol.createElement("div");return t.style.cssText="width:"+s+"calc(9px)",!!t.style.length}).shift()+"calc",Uw=function(s){return typeof s=="string"||s instanceof String},H0=function(s){if(Uw(s)){var t=Ol.querySelector(s);if(!t)throw new Error("Selector "+s+" did not match a DOM element");return t}return s},fi=function(s,t,e){var n=s[t];return n!==void 0?n:e},hu=function(s,t,e,n){if(t){if(n==="end")return 0;if(n==="center")return s/2}else if(e){if(n==="start")return 0;if(n==="center")return s/2}return s},jO=function(s,t){var e=Ol.createElement("div");return e.className="gutter gutter-"+t,e},qO=function(s,t,e){var n={};return Uw(t)?n[s]=t:n[s]=YO+"("+t+"% - "+e+"px)",n},KO=function(s,t){var e;return e={},e[s]=t+"px",e},$0=function(s,t){if(t===void 0&&(t={}),rg)return{};var e=s,n,o,h,d,l,_;Array.from&&(e=Array.from(e));var m=H0(e[0]),v=m.parentNode,w=getComputedStyle?getComputedStyle(v):null,b=w?w.flexDirection:null,T=fi(t,"sizes")||e.map(function(){return 100/e.length}),r=fi(t,"minSize",100),a=Array.isArray(r)?r:e.map(function(){return r}),u=fi(t,"maxSize",1/0),f=Array.isArray(u)?u:e.map(function(){return u}),g=fi(t,"expandToMin",!1),x=fi(t,"gutterSize",10),S=fi(t,"gutterAlign","center"),A=fi(t,"snapOffset",30),C=Array.isArray(A)?A:e.map(function(){return A}),B=fi(t,"dragInterval",1),R=fi(t,"direction",lu),M=fi(t,"cursor",R===lu?"col-resize":"row-resize"),N=fi(t,"gutter",jO),L=fi(t,"elementStyle",qO),W=fi(t,"gutterStyle",KO);R===lu?(n="width",o="clientX",h="left",d="right",l="clientWidth"):R==="vertical"&&(n="height",o="clientY",h="top",d="bottom",l="clientHeight");function k(ht,q,nt,dt){var Xt=L(n,q,nt,dt);Object.keys(Xt).forEach(function(Ot){ht.style[Ot]=Xt[Ot]})}function j(ht,q,nt){var dt=W(n,q,nt);Object.keys(dt).forEach(function(Xt){ht.style[Xt]=dt[Xt]})}function Y(){return _.map(function(ht){return ht.size})}function ut(ht){return"touches"in ht?ht.touches[0][o]:ht[o]}function it(ht){var q=_[this.a],nt=_[this.b],dt=q.size+nt.size;q.size=ht/this.size*dt,nt.size=dt-ht/this.size*dt,k(q.element,q.size,this[_r],q.i),k(nt.element,nt.size,this[pn],nt.i)}function gt(ht){var q,nt=_[this.a],dt=_[this.b];this.dragging&&(q=ut(ht)-this.start+(this[_r]-this.dragOffset),B>1&&(q=Math.round(q/B)*B),q<=nt.minSize+nt.snapOffset+this[_r]?q=nt.minSize+this[_r]:q>=this.size-(dt.minSize+dt.snapOffset+this[pn])&&(q=this.size-(dt.minSize+this[pn])),q>=nt.maxSize-nt.snapOffset+this[_r]?q=nt.maxSize+this[_r]:q<=this.size-(dt.maxSize-dt.snapOffset+this[pn])&&(q=this.size-(dt.maxSize+this[pn])),it.call(this,q),fi(t,"onDrag",gr)(Y()))}function Q(){var ht=_[this.a].element,q=_[this.b].element,nt=ht[hp](),dt=q[hp]();this.size=nt[n]+dt[n]+this[_r]+this[pn],this.start=nt[h],this.end=nt[d]}function rt(ht){if(!getComputedStyle)return null;var q=getComputedStyle(ht);if(!q)return null;var nt=ht[l];return nt===0?null:(R===lu?nt-=parseFloat(q.paddingLeft)+parseFloat(q.paddingRight):nt-=parseFloat(q.paddingTop)+parseFloat(q.paddingBottom),nt)}function Z(ht){var q=rt(v);if(q===null||a.reduce(function(Ot,Nt){return Ot+Nt},0)>q)return ht;var nt=0,dt=[],Xt=ht.map(function(Ot,Nt){var Lt=q*Ot/100,ce=hu(x,Nt===0,Nt===ht.length-1,S),Be=a[Nt]+ce;return Lt<Be?(nt+=Be-Lt,dt.push(0),Be):(dt.push(Lt-Be),Lt)});return nt===0?ht:Xt.map(function(Ot,Nt){var Lt=Ot;if(nt>0&&dt[Nt]-nt>0){var ce=Math.min(nt,dt[Nt]-nt);nt-=ce,Lt=Ot-ce}return Lt/q*100})}function H(){var ht=this,q=_[ht.a].element,nt=_[ht.b].element;ht.dragging&&fi(t,"onDragEnd",gr)(Y()),ht.dragging=!1,ir[pr]("mouseup",ht.stop),ir[pr]("touchend",ht.stop),ir[pr]("touchcancel",ht.stop),ir[pr]("mousemove",ht.move),ir[pr]("touchmove",ht.move),ht.stop=null,ht.move=null,q[pr]("selectstart",gr),q[pr]("dragstart",gr),nt[pr]("selectstart",gr),nt[pr]("dragstart",gr),q.style.userSelect="",q.style.webkitUserSelect="",q.style.MozUserSelect="",q.style.pointerEvents="",nt.style.userSelect="",nt.style.webkitUserSelect="",nt.style.MozUserSelect="",nt.style.pointerEvents="",ht.gutter.style.cursor="",ht.parent.style.cursor="",Ol.body.style.cursor=""}function G(ht){if(!("button"in ht&&ht.button!==0)){var q=this,nt=_[q.a].element,dt=_[q.b].element;q.dragging||fi(t,"onDragStart",gr)(Y()),ht.preventDefault(),q.dragging=!0,q.move=gt.bind(q),q.stop=H.bind(q),ir[fr]("mouseup",q.stop),ir[fr]("touchend",q.stop),ir[fr]("touchcancel",q.stop),ir[fr]("mousemove",q.move),ir[fr]("touchmove",q.move),nt[fr]("selectstart",gr),nt[fr]("dragstart",gr),dt[fr]("selectstart",gr),dt[fr]("dragstart",gr),nt.style.userSelect="none",nt.style.webkitUserSelect="none",nt.style.MozUserSelect="none",nt.style.pointerEvents="none",dt.style.userSelect="none",dt.style.webkitUserSelect="none",dt.style.MozUserSelect="none",dt.style.pointerEvents="none",q.gutter.style.cursor=M,q.parent.style.cursor=M,Ol.body.style.cursor=M,Q.call(q),q.dragOffset=ut(ht)-q.end}}T=Z(T);var at=[];_=e.map(function(ht,q){var nt={element:H0(ht),size:T[q],minSize:a[q],maxSize:f[q],snapOffset:C[q],i:q},dt;if(q>0&&(dt={a:q-1,b:q,dragging:!1,direction:R,parent:v},dt[_r]=hu(x,q-1===0,!1,S),dt[pn]=hu(x,!1,q===e.length-1,S),b==="row-reverse"||b==="column-reverse")){var Xt=dt.a;dt.a=dt.b,dt.b=Xt}if(q>0){var Ot=N(q,R,nt.element);j(Ot,x,q),dt[al]=G.bind(dt),Ot[fr]("mousedown",dt[al]),Ot[fr]("touchstart",dt[al]),v.insertBefore(Ot,nt.element),dt.gutter=Ot}return k(nt.element,nt.size,hu(x,q===0,q===e.length-1,S),q),q>0&&at.push(dt),nt});function vt(ht){var q=ht.i===at.length,nt=q?at[ht.i-1]:at[ht.i];Q.call(nt);var dt=q?nt.size-ht.minSize-nt[pn]:ht.minSize+nt[_r];it.call(nt,dt)}_.forEach(function(ht){var q=ht.element[hp]()[n];q<ht.minSize&&(g?vt(ht):ht.minSize=q)});function At(ht){var q=Z(ht);q.forEach(function(nt,dt){if(dt>0){var Xt=at[dt-1],Ot=_[Xt.a],Nt=_[Xt.b];Ot.size=q[dt-1],Nt.size=nt,k(Ot.element,Ot.size,Xt[_r],Ot.i),k(Nt.element,Nt.size,Xt[pn],Nt.i)}})}function kt(ht,q){at.forEach(function(nt){if(q!==!0?nt.parent.removeChild(nt.gutter):(nt.gutter[pr]("mousedown",nt[al]),nt.gutter[pr]("touchstart",nt[al])),ht!==!0){var dt=L(n,nt.a.size,nt[_r]);Object.keys(dt).forEach(function(Xt){_[nt.a].element.style[Xt]="",_[nt.b].element.style[Xt]=""})}})}return{setSizes:At,getSizes:Y,collapse:function(q){vt(_[q])},destroy:kt,parent:v,pairs:at}};const ZO={class:"ticks h-full"},JO={key:0,class:"tick-mark"},QO={key:1,class:"tick-mark-long"},tN={key:2,class:"tick-label"},Ra=3,V0=100,eN=15,iN=hi({__name:"timelineRuler",props:{duration:{type:Number,required:!0},zoom:{type:Number,default:1},currentTime:{type:Number,default:0},totalWidth:{type:Number,default:0}},emits:["timeUpdate","scroll"],setup(s,{emit:t}){const e=s,n=t,o=Tt(null),h=De(()=>Ra*e.zoom),d=De(()=>Math.ceil(e.duration*10)),l=De(()=>e.currentTime*Ra*e.zoom*10),_=Tt(!1),m=Tt(0),v=Tt(null);let w=null,b=Tt(0);const T=S=>{const A=Math.floor(S/10),C=Math.floor(A/60),B=A%60;return`${C}:${B.toString().padStart(2,"0")}`},r=S=>{if(!o.value)return;const A=o.value.getBoundingClientRect(),B=(S.clientX-A.left)/(Ra*e.zoom*10);n("timeUpdate",Math.max(0,Math.min(B,e.duration))),u(S)},a=S=>{if(S.stopPropagation(),!o.value)return;const A=o.value.getBoundingClientRect(),C=S.clientX-A.left,B=Math.max(0,Math.min(C/(Ra*e.zoom*10),e.duration));n("timeUpdate",B),u(S)},u=S=>{_.value=!0,m.value=S.clientX,b.value=S.clientX,document.addEventListener("mousemove",g),document.addEventListener("mouseup",x)},f=()=>{if(!(!_.value||!o.value||!o.value.parentElement)&&v.value){n("scroll",v.value==="right"?eN:-15);const A=o.value.getBoundingClientRect(),C=m.value-A.left,B=Math.max(0,Math.min(C/(Ra*e.zoom*10),e.duration));n("timeUpdate",B),w=requestAnimationFrame(f)}},g=S=>{if(!_.value||!o.value)return;const A=o.value.getBoundingClientRect(),C=o.value.parentElement;if(!C)return;const B=S.clientX-A.left,R=S.clientX-b.value;if(b.value=S.clientX,R!==0){const N=C.getBoundingClientRect();R>0?S.clientX>N.right-V0?v.value!=="right"&&(v.value="right",f()):v.value=null:S.clientX<N.left+V0?v.value!=="left"&&(v.value="left",f()):v.value=null}const M=Math.max(0,Math.min(B/(Ra*e.zoom*10),e.duration));n("timeUpdate",M),m.value=S.clientX},x=()=>{_.value=!1,v.value=null,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",x),w!==null&&(cancelAnimationFrame(w),w=null)};return Nl(()=>{w!==null&&cancelAnimationFrame(w)}),(S,A)=>(St(),Ft($i,null,[$("div",{class:"ticks-container h-10",ref_key:"rulerContainer",ref:o,style:Er({width:s.totalWidth+"px"}),onMousedown:r},[$("div",ZO,[(St(!0),Ft($i,null,In(Wt(d),C=>(St(),Ft("div",{key:C,class:"tick h-full",style:Er({left:C*Wt(h)+"px"})},[C%5===0?(St(),Ft("div",JO)):be("",!0),C%50===0?(St(),Ft("div",QO)):be("",!0),C%50===0?(St(),Ft("span",tN,li(T(C)),1)):be("",!0)],4))),128))])],36),$("div",{class:"playhead",style:Er({left:Wt(l)+"px"}),onMousedown:a},A[0]||(A[0]=[$("div",{class:"playhead-line"},null,-1),$("div",{class:"playhead-triangle"},null,-1)]),36)],64))}}),rN=ar(iN,[["__scopeId","data-v-9b78982e"]]),nN={class:"w-full h-full p-1 flex flex-col justify-center items-center pointer-events-none select-none"},sN={key:0,class:"flex flex-nowrap gap-0.5 items-center overflow-hidden px-1 h-full"},aN=["src"],oN={key:1,class:"flex flex-nowrap gap-0.5 items-center overflow-hidden px-1 h-full"},lN=["src"],hN={key:2,class:"w-full h-full flex flex-col relative rounded"},uN={class:"absolute inset-0"},cN={key:0,class:"absolute inset-0 w-auto h-full flex items-center bg-[#ffffff] bg-opacity-10 text-[#000000]"},dN={class:"text-base inline-block truncate px-5 z-10"},fN={key:3,class:"flex items-center text-bigger text-white whitespace-nowrap overflow-hidden text-ellipsis w-full"},pN={class:"pl-6.5"},_N={key:4,class:"flex items-center text-bigger text-white whitespace-nowrap overflow-hidden text-ellipsis w-full"},gN={class:"pl-6.5"},mN={key:0},yN=hi({__name:"trackItem",props:{clip:{type:Object,required:!0},zoom:{type:Number,default:1},frameLength:{type:Number,default:20},hovered:{type:Boolean,default:!1}},setup(s){const t=s,e=De(()=>70/t.frameLength),n=Tt([]),o=Tt(null),h=()=>{try{if(!t.clip.thumbnail||!Array.isArray(t.clip.thumbnail)){n.value=[];return}const _=Number(t.clip.duration);if(isNaN(_)||_<=0){console.warn("Invalid clip duration:",_);return}const m=Math.ceil(_/e.value),v=[];if(t.clip.type==="image"&&t.clip.thumbnail.length>0){const w=t.clip.thumbnail[0];for(let b=0;b<m;b++)v.push(w)}else if(t.clip.type==="video"&&t.clip.thumbnail.length>0){const w=t.clip.thumbnail;let b=w[0];for(let T=0;T<m;T++){const r=T*e.value,a=w.find(u=>u.timestamp/1e6>=r)||b||w[w.length-1];a&&(v.push(a),b=a)}}n.value=v}catch(_){console.error("Error updating thumbnails:",_),n.value=[]}},d=()=>{try{if(!o.value||!t.clip.volumeData)return;const _=o.value,m=_.getContext("2d");if(!m)return;const v=_.getBoundingClientRect();if(_.width=v.width*window.devicePixelRatio,_.height=v.height*window.devicePixelRatio,m.clearRect(0,0,_.width,_.height),!t.clip.originalDuration){console.warn("Missing originalDuration for audio clip");return}const w=t.clip.volumeData.slice(t.clip.sourceStartTime/t.clip.originalDuration*t.clip.volumeData.length,(t.clip.originalDuration-t.clip.sourceEndTime)/t.clip.originalDuration*t.clip.volumeData.length);if(!w.length){console.warn("No volume data available");return}const b=2,T=2,r=Math.floor(_.width/(b+T)),a=_.height*.8,u=w.length/r;m.fillStyle="#ffffff80";for(let f=0;f<r;f++){const g=Math.floor(f*u),S=(w[g]||0)*a,A=f*(b+T),C=(_.height-S)/2;m.fillRect(A,C,b,S)}}catch(_){console.error("Error drawing waveform:",_)}},l=_=>_?{grayscale:"灰度",invert:"反色",brightness:"亮度",sepia:"复古",blur:"模糊"}[_]:"未知滤镜";return ls([()=>t.frameLength,()=>t.zoom,()=>t.clip.duration,()=>t.clip.sourceStartTime,()=>t.clip.sourceEndTime,()=>t.clip.thumbnail],()=>{t.clip&&(t.clip.type==="video"||t.clip.type==="image")&&Il(()=>{h()})},{deep:!0,immediate:!0}),ls(()=>t.clip.thumbnail,()=>{t.clip&&(t.clip.type==="video"||t.clip.type==="image")&&Il(()=>{h()})},{deep:!0,immediate:!0}),So(()=>{if(t.clip.type==="audio"){const _=new ResizeObserver(()=>{d()});o.value&&(_.observe(o.value),d())}}),(_,m)=>(St(),Ft("div",nN,[s.clip.type==="video"?(St(),Ft("div",sN,[n.value.length>0?(St(!0),Ft($i,{key:0},In(n.value,v=>(St(),Ft("img",{key:v.timestamp,src:v.url,class:"h-[90%] shrink-0 grow-0 object-cover rounded",style:{width:"70px"}},null,8,aN))),128)):be("",!0)])):be("",!0),s.clip.type==="image"?(St(),Ft("div",oN,[n.value.length>0?(St(!0),Ft($i,{key:0},In(n.value,v=>(St(),Ft("img",{key:v.timestamp,src:v.url,class:"h-[90%] shrink-0 grow-0 object-cover rounded",style:{width:"70px"}},null,8,lN))),128)):be("",!0)])):s.clip.type==="audio"?(St(),Ft("div",hN,[$("div",uN,[$("canvas",{ref_key:"waveformCanvas",ref:o,class:"w-full h-full"},null,512)]),s.hovered?(St(),Ft("div",cN,[$("span",dN,li(s.clip.name),1)])):be("",!0)])):s.clip.type==="text"?(St(),Ft("div",fN,[lt(Wt(ye),{icon:"material-symbols-light:text-fields",class:"w-6 h-6 absolute left-1 text-white"}),$("div",pN,li(s.clip.textConfig.content),1)])):s.clip.type==="filter"?(St(),Ft("div",_N,[lt(Wt(ye),{icon:"material-symbols-light:magnify-fullscreen-outline-rounded",class:"w-6 h-6 absolute left-1 text-white"}),$("div",gN,[$("span",null,li(l(s.clip.filterType)),1),s.clip.intensity!==void 0?(St(),Ft("span",mN,li(Math.round(s.clip.intensity))+"% ",1)):be("",!0)])])):be("",!0)]))}}),vN=ar(yN,[["__scopeId","data-v-d31631bc"]]),xN=["data-track","onDragenter","onDragleave"],bN=["data-clip","onMousedown","onMouseover","onMouseleave"],wN={class:"flex items-center justify-center w-full h-full relative"},SN=["onMousedown"],EN=["onMousedown"],TN=hi({__name:"tracksList",props:{tracks:{type:Array,required:!0},hoveredTrack:{type:Number,default:-1},dragPreview:{type:Boolean,default:!1},dragPreviewPosition:{type:Number,default:0},dragPreviewWidth:{type:Number,default:0},zoom:{type:Number,default:1},frameLength:{type:Number,default:20},isReplaceMode:{type:Boolean,default:!1}},emits:["track-drag-enter","track-drag-leave","clip-mouse-down","background-click","save-history-state","clip-hover","start-resize","delete-clip"],setup(s,{expose:t,emit:e}){const n=s,o=e,h=Tt(void 0),d=Tt(void 0),l=()=>{n.tracks.forEach(A=>{A.clips.forEach(C=>{C.selected=!1})}),d.value=void 0},_=A=>{l(),A&&(A.selected=!0,d.value=A)},m=A=>{A.preventDefault()},v=A=>{A.preventDefault();const C=A.currentTarget.getBoundingClientRect();A.clientX-C.left;const B=A.clientY-C.top,R=C.height/n.tracks.length,M=Math.floor(B/R);M>=0&&M<n.tracks.length&&o("track-drag-enter",M)},w=A=>{A.preventDefault();const C=A.currentTarget.getBoundingClientRect(),B=A.clientX,R=A.clientY;(B<C.left||B>C.right||R<C.top||R>C.bottom)&&o("track-drag-leave",n.hoveredTrack)},b=A=>{o("track-drag-enter",A)},T=A=>{o("track-drag-leave",A)},r=(A,C,B)=>{A.stopPropagation(),A.preventDefault(),n.tracks.forEach(M=>{M.clips.forEach(N=>{N!==C&&(N.selected=!1)})}),C.selected=!0,d.value=C,h.value=void 0;const R=A.target;!R.classList.contains("resize-handle")&&!R.closest(".resize-handle")&&o("clip-mouse-down",C,B,A)},a=A=>{d.value||(h.value=A,A.selected=!0),o("clip-hover",A)},u=A=>{h.value===A&&!d.value&&(h.value=void 0,A.selected=!1)},f=(A,C,B)=>{o("start-resize",A,C,B)},g=A=>{l(),o("background-click"),h.value=void 0},x=A=>{const C=document.activeElement;(C==null?void 0:C.tagName)==="INPUT"||(C==null?void 0:C.tagName)==="TEXTAREA"||(C==null?void 0:C.getAttribute("contenteditable"))==="true"||C!=null&&C.classList.contains("el-input__inner")||C!=null&&C.classList.contains("el-textarea__inner")||(A.key==="Delete"||A.key==="Backspace")&&(n.tracks.forEach((R,M)=>{R.clips.filter(L=>L.selected||L===d.value).forEach(L=>{o("delete-clip",L,M)})}),S())},S=()=>{o("save-history-state")};return So(()=>{window.addEventListener("keydown",x);const A=document.querySelector(".tracks-list");A&&A.focus()}),Nl(()=>{window.removeEventListener("keydown",x)}),t({activeClip:_}),(A,C)=>(St(),Ft("div",{class:"w-full h-full bg-[#252525] tracks-list select-none",onDragenter:Ii(m,["prevent"]),onDragover:Ii(v,["prevent"]),onDragleave:Ii(w,["prevent"]),onMousedown:g,onKeydown:x,tabindex:"0"},[(St(!0),Ft($i,null,In(s.tracks,(B,R)=>(St(),Ft("div",{key:B.id,class:"relative h-12 my-3 bg-[#252525]","data-track":B.id,onDragenter:Ii(M=>b(R),["prevent"]),onDragleave:Ii(M=>T(R),["prevent"])},[(St(!0),Ft($i,null,In(B.clips,M=>(St(),Ft("div",{key:M.id,class:Qn(["absolute top-0 h-full flex items-center bg-[#444] rounded-xl cursor-pointer select-none min-w-[30px]",{"ring-2 ring-[#b534cf]":M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id,"bg-[#631975]":M.type==="video","bg-[#6ab7ff]":M.type==="audio","bg-[#722ed133]":M.type==="image","bg-[#a85201]":M.type==="text","bg-[#f827eec2]":M.type==="filter"}]),style:Er({left:`${M.startTime*s.frameLength}px`,width:`${M.duration*s.frameLength}px`}),"data-clip":M.id,onMousedown:Ii(N=>r(N,M,B.id),["stop"]),onMouseover:N=>a(M),onMouseleave:N=>u(M)},[$("div",wN,[lt(vN,{clip:M,zoom:s.zoom,frameLength:s.frameLength,hovered:M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id},null,8,["clip","zoom","frameLength","hovered"])]),M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id?(St(),Ft("div",{key:0,class:"absolute left-[1.25px] top-[0.2px] bottom-0 flex items-center justify-center w-3 h-[98%] bg-[#d4d4d4] rounded-l-[0.75rem] cursor-w-resize hover:bg-[#a0a0a0] z-10",onMousedown:Ii(N=>f(N,M,"left"),["stop"])},C[0]||(C[0]=[$("div",{class:"w-1 h-[80%] bg-[#646464]"},null,-1)]),40,SN)):be("",!0),M.selected||h.value&&h.value.id===M.id||d.value&&d.value.id===M.id?(St(),Ft("div",{key:1,class:"absolute right-[1.25px] top-[0.2px] bottom-0 flex items-center justify-center w-3 h-[98%] bg-[#d4d4d4] rounded-r-[0.75rem] cursor-w-resize hover:bg-[#a0a0a0] z-10",onMousedown:Ii(N=>f(N,M,"right"),["stop"])},C[1]||(C[1]=[$("div",{class:"w-1 h-[80%] bg-[#646464]"},null,-1)]),40,EN)):be("",!0)],46,bN))),128))],40,xN))),128))],32))}}),AN=ar(TN,[["__scopeId","data-v-8049a0ae"]]);function CN(s){let t=0;for(let n=0;n<s.length;n++)t+=s[n]*s[n];return Math.sqrt(t/s.length)}const U_=async s=>new Promise(async t=>{if(s.type==="image"){const e=await Pl(s.path),n=new Ku(await e.stream());if(await n.ready){const{video:h}=await n.tick(0);if(h instanceof ImageBitmap){const d=new OffscreenCanvas(h.width,h.height);d.getContext("2d").drawImage(h,0,0,h.width,h.height);const _=await d.convertToBlob();t({type:"image",data:_})}}}else if(s.type==="video"){const e=await Pl(s.path),n=new D_(e);if(await n.ready){let h=performance.now();n.thumbnails().then(d=>{let l=[];d.forEach(_=>{l.push({url:URL.createObjectURL(_.img),timestamp:_.ts})}),console.log("get video frame",(performance.now()-h)/1e3+"s"),t({type:"video",data:l})})}}}),I_=async s=>new Promise(async(t,e)=>{var _;const n=await Pl(s.path),o=new k_(await n.stream());await o.ready,performance.now();let h=!1,d=0,l=[];for(;!h;){const{audio:m,state:v}=await o.tick(d);if(v==="done"){h=!0;continue}if(d+=33333,m.length===0||((_=m[0])==null?void 0:_.length)===0){l.push(0);continue}else{const w=CN(m[0]);l.push(w)}}t({type:"audio",data:l})});var Ac={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ac.exports;(function(s,t){(function(){var e,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",l="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",m=500,v="__lodash_placeholder__",w=1,b=2,T=4,r=1,a=2,u=1,f=2,g=4,x=8,S=16,A=32,C=64,B=128,R=256,M=512,N=30,L="...",W=800,k=16,j=1,Y=2,ut=3,it=1/0,gt=9007199254740991,Q=17976931348623157e292,rt=NaN,Z=4294967295,H=Z-1,G=Z>>>1,at=[["ary",B],["bind",u],["bindKey",f],["curry",x],["curryRight",S],["flip",M],["partial",A],["partialRight",C],["rearg",R]],vt="[object Arguments]",At="[object Array]",kt="[object AsyncFunction]",ht="[object Boolean]",q="[object Date]",nt="[object DOMException]",dt="[object Error]",Xt="[object Function]",Ot="[object GeneratorFunction]",Nt="[object Map]",Lt="[object Number]",ce="[object Null]",Be="[object Object]",gi="[object Promise]",Wc="[object Proxy]",Vi="[object RegExp]",mi="[object Set]",en="[object String]",ha="[object Symbol]",Xc="[object Undefined]",pe="[object WeakMap]",Yc="[object WeakSet]",fs="[object ArrayBuffer]",Wi="[object DataView]",ua="[object Float32Array]",ps="[object Float64Array]",Bo="[object Int8Array]",Fo="[object Int16Array]",Mo="[object Int32Array]",Pr="[object Uint8Array]",Lo="[object Uint8ClampedArray]",Bn="[object Uint16Array]",Do="[object Uint32Array]",jc=/\b__p \+= '';/g,qc=/\b(__p \+=) '' \+/g,Kc=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Yl=/&(?:amp|lt|gt|quot|#39);/g,J=/[&<>"']/g,pt=RegExp(Yl.source),Dt=RegExp(J.source),Mt=/<%-([\s\S]+?)%>/g,It=/<%([\s\S]+?)%>/g,zt=/<%=([\s\S]+?)%>/g,Yt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ge=/^\w*$/,ze=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,He=/[\\^$.*+?()[\]{}|]/g,Te=RegExp(He.source),Ae=/^\s+/,ui=/\s/,Rr=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,jl=/\{\n\/\* \[wrapped with (.+)\] \*/,ag=/,? & /,Pw=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Rw=/[()=,{}\[\]\/\s]/,Bw=/\\(\\)?/g,Fw=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,og=/\w*$/,Mw=/^[-+]0x[0-9a-f]+$/i,Lw=/^0b[01]+$/i,Dw=/^\[object .+?Constructor\]$/,kw=/^0o[0-7]+$/i,Ow=/^(?:0|[1-9]\d*)$/,Nw=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ql=/($^)/,zw=/['\n\r\u2028\u2029\\]/g,Kl="\\ud800-\\udfff",Gw="\\u0300-\\u036f",Hw="\\ufe20-\\ufe2f",$w="\\u20d0-\\u20ff",lg=Gw+Hw+$w,hg="\\u2700-\\u27bf",ug="a-z\\xdf-\\xf6\\xf8-\\xff",Vw="\\xac\\xb1\\xd7\\xf7",Ww="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Xw="\\u2000-\\u206f",Yw=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",cg="A-Z\\xc0-\\xd6\\xd8-\\xde",dg="\\ufe0e\\ufe0f",fg=Vw+Ww+Xw+Yw,Zc="['’]",jw="["+Kl+"]",pg="["+fg+"]",Zl="["+lg+"]",_g="\\d+",qw="["+hg+"]",gg="["+ug+"]",mg="[^"+Kl+fg+_g+hg+ug+cg+"]",Jc="\\ud83c[\\udffb-\\udfff]",Kw="(?:"+Zl+"|"+Jc+")",yg="[^"+Kl+"]",Qc="(?:\\ud83c[\\udde6-\\uddff]){2}",td="[\\ud800-\\udbff][\\udc00-\\udfff]",ca="["+cg+"]",vg="\\u200d",xg="(?:"+gg+"|"+mg+")",Zw="(?:"+ca+"|"+mg+")",bg="(?:"+Zc+"(?:d|ll|m|re|s|t|ve))?",wg="(?:"+Zc+"(?:D|LL|M|RE|S|T|VE))?",Sg=Kw+"?",Eg="["+dg+"]?",Jw="(?:"+vg+"(?:"+[yg,Qc,td].join("|")+")"+Eg+Sg+")*",Qw="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",t1="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Tg=Eg+Sg+Jw,e1="(?:"+[qw,Qc,td].join("|")+")"+Tg,i1="(?:"+[yg+Zl+"?",Zl,Qc,td,jw].join("|")+")",r1=RegExp(Zc,"g"),n1=RegExp(Zl,"g"),ed=RegExp(Jc+"(?="+Jc+")|"+i1+Tg,"g"),s1=RegExp([ca+"?"+gg+"+"+bg+"(?="+[pg,ca,"$"].join("|")+")",Zw+"+"+wg+"(?="+[pg,ca+xg,"$"].join("|")+")",ca+"?"+xg+"+"+bg,ca+"+"+wg,t1,Qw,_g,e1].join("|"),"g"),a1=RegExp("["+vg+Kl+lg+dg+"]"),o1=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,l1=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],h1=-1,xe={};xe[ua]=xe[ps]=xe[Bo]=xe[Fo]=xe[Mo]=xe[Pr]=xe[Lo]=xe[Bn]=xe[Do]=!0,xe[vt]=xe[At]=xe[fs]=xe[ht]=xe[Wi]=xe[q]=xe[dt]=xe[Xt]=xe[Nt]=xe[Lt]=xe[Be]=xe[Vi]=xe[mi]=xe[en]=xe[pe]=!1;var ve={};ve[vt]=ve[At]=ve[fs]=ve[Wi]=ve[ht]=ve[q]=ve[ua]=ve[ps]=ve[Bo]=ve[Fo]=ve[Mo]=ve[Nt]=ve[Lt]=ve[Be]=ve[Vi]=ve[mi]=ve[en]=ve[ha]=ve[Pr]=ve[Lo]=ve[Bn]=ve[Do]=!0,ve[dt]=ve[Xt]=ve[pe]=!1;var u1={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},c1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},d1={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},f1={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},p1=parseFloat,_1=parseInt,Ag=typeof qr=="object"&&qr&&qr.Object===Object&&qr,g1=typeof self=="object"&&self&&self.Object===Object&&self,ii=Ag||g1||Function("return this")(),id=t&&!t.nodeType&&t,_s=id&&!0&&s&&!s.nodeType&&s,Cg=_s&&_s.exports===id,rd=Cg&&Ag.process,Xi=function(){try{var z=_s&&_s.require&&_s.require("util").types;return z||rd&&rd.binding&&rd.binding("util")}catch{}}(),Ug=Xi&&Xi.isArrayBuffer,Ig=Xi&&Xi.isDate,Pg=Xi&&Xi.isMap,Rg=Xi&&Xi.isRegExp,Bg=Xi&&Xi.isSet,Fg=Xi&&Xi.isTypedArray;function Bi(z,K,X){switch(X.length){case 0:return z.call(K);case 1:return z.call(K,X[0]);case 2:return z.call(K,X[0],X[1]);case 3:return z.call(K,X[0],X[1],X[2])}return z.apply(K,X)}function m1(z,K,X,Et){for(var jt=-1,de=z==null?0:z.length;++jt<de;){var $e=z[jt];K(Et,$e,X($e),z)}return Et}function Yi(z,K){for(var X=-1,Et=z==null?0:z.length;++X<Et&&K(z[X],X,z)!==!1;);return z}function y1(z,K){for(var X=z==null?0:z.length;X--&&K(z[X],X,z)!==!1;);return z}function Mg(z,K){for(var X=-1,Et=z==null?0:z.length;++X<Et;)if(!K(z[X],X,z))return!1;return!0}function Fn(z,K){for(var X=-1,Et=z==null?0:z.length,jt=0,de=[];++X<Et;){var $e=z[X];K($e,X,z)&&(de[jt++]=$e)}return de}function Jl(z,K){var X=z==null?0:z.length;return!!X&&da(z,K,0)>-1}function nd(z,K,X){for(var Et=-1,jt=z==null?0:z.length;++Et<jt;)if(X(K,z[Et]))return!0;return!1}function Ee(z,K){for(var X=-1,Et=z==null?0:z.length,jt=Array(Et);++X<Et;)jt[X]=K(z[X],X,z);return jt}function Mn(z,K){for(var X=-1,Et=K.length,jt=z.length;++X<Et;)z[jt+X]=K[X];return z}function sd(z,K,X,Et){var jt=-1,de=z==null?0:z.length;for(Et&&de&&(X=z[++jt]);++jt<de;)X=K(X,z[jt],jt,z);return X}function v1(z,K,X,Et){var jt=z==null?0:z.length;for(Et&&jt&&(X=z[--jt]);jt--;)X=K(X,z[jt],jt,z);return X}function ad(z,K){for(var X=-1,Et=z==null?0:z.length;++X<Et;)if(K(z[X],X,z))return!0;return!1}var x1=od("length");function b1(z){return z.split("")}function w1(z){return z.match(Pw)||[]}function Lg(z,K,X){var Et;return X(z,function(jt,de,$e){if(K(jt,de,$e))return Et=de,!1}),Et}function Ql(z,K,X,Et){for(var jt=z.length,de=X+(Et?1:-1);Et?de--:++de<jt;)if(K(z[de],de,z))return de;return-1}function da(z,K,X){return K===K?M1(z,K,X):Ql(z,Dg,X)}function S1(z,K,X,Et){for(var jt=X-1,de=z.length;++jt<de;)if(Et(z[jt],K))return jt;return-1}function Dg(z){return z!==z}function kg(z,K){var X=z==null?0:z.length;return X?hd(z,K)/X:rt}function od(z){return function(K){return K==null?e:K[z]}}function ld(z){return function(K){return z==null?e:z[K]}}function Og(z,K,X,Et,jt){return jt(z,function(de,$e,me){X=Et?(Et=!1,de):K(X,de,$e,me)}),X}function E1(z,K){var X=z.length;for(z.sort(K);X--;)z[X]=z[X].value;return z}function hd(z,K){for(var X,Et=-1,jt=z.length;++Et<jt;){var de=K(z[Et]);de!==e&&(X=X===e?de:X+de)}return X}function ud(z,K){for(var X=-1,Et=Array(z);++X<z;)Et[X]=K(X);return Et}function T1(z,K){return Ee(K,function(X){return[X,z[X]]})}function Ng(z){return z&&z.slice(0,$g(z)+1).replace(Ae,"")}function Fi(z){return function(K){return z(K)}}function cd(z,K){return Ee(K,function(X){return z[X]})}function ko(z,K){return z.has(K)}function zg(z,K){for(var X=-1,Et=z.length;++X<Et&&da(K,z[X],0)>-1;);return X}function Gg(z,K){for(var X=z.length;X--&&da(K,z[X],0)>-1;);return X}function A1(z,K){for(var X=z.length,Et=0;X--;)z[X]===K&&++Et;return Et}var C1=ld(u1),U1=ld(c1);function I1(z){return"\\"+f1[z]}function P1(z,K){return z==null?e:z[K]}function fa(z){return a1.test(z)}function R1(z){return o1.test(z)}function B1(z){for(var K,X=[];!(K=z.next()).done;)X.push(K.value);return X}function dd(z){var K=-1,X=Array(z.size);return z.forEach(function(Et,jt){X[++K]=[jt,Et]}),X}function Hg(z,K){return function(X){return z(K(X))}}function Ln(z,K){for(var X=-1,Et=z.length,jt=0,de=[];++X<Et;){var $e=z[X];($e===K||$e===v)&&(z[X]=v,de[jt++]=X)}return de}function th(z){var K=-1,X=Array(z.size);return z.forEach(function(Et){X[++K]=Et}),X}function F1(z){var K=-1,X=Array(z.size);return z.forEach(function(Et){X[++K]=[Et,Et]}),X}function M1(z,K,X){for(var Et=X-1,jt=z.length;++Et<jt;)if(z[Et]===K)return Et;return-1}function L1(z,K,X){for(var Et=X+1;Et--;)if(z[Et]===K)return Et;return Et}function pa(z){return fa(z)?k1(z):x1(z)}function or(z){return fa(z)?O1(z):b1(z)}function $g(z){for(var K=z.length;K--&&ui.test(z.charAt(K)););return K}var D1=ld(d1);function k1(z){for(var K=ed.lastIndex=0;ed.test(z);)++K;return K}function O1(z){return z.match(ed)||[]}function N1(z){return z.match(s1)||[]}var z1=function z(K){K=K==null?ii:_a.defaults(ii.Object(),K,_a.pick(ii,l1));var X=K.Array,Et=K.Date,jt=K.Error,de=K.Function,$e=K.Math,me=K.Object,fd=K.RegExp,G1=K.String,ji=K.TypeError,eh=X.prototype,H1=de.prototype,ga=me.prototype,ih=K["__core-js_shared__"],rh=H1.toString,_e=ga.hasOwnProperty,$1=0,Vg=function(){var c=/[^.]+$/.exec(ih&&ih.keys&&ih.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),nh=ga.toString,V1=rh.call(me),W1=ii._,X1=fd("^"+rh.call(_e).replace(He,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sh=Cg?K.Buffer:e,Dn=K.Symbol,ah=K.Uint8Array,Wg=sh?sh.allocUnsafe:e,oh=Hg(me.getPrototypeOf,me),Xg=me.create,Yg=ga.propertyIsEnumerable,lh=eh.splice,jg=Dn?Dn.isConcatSpreadable:e,Oo=Dn?Dn.iterator:e,gs=Dn?Dn.toStringTag:e,hh=function(){try{var c=bs(me,"defineProperty");return c({},"",{}),c}catch{}}(),Y1=K.clearTimeout!==ii.clearTimeout&&K.clearTimeout,j1=Et&&Et.now!==ii.Date.now&&Et.now,q1=K.setTimeout!==ii.setTimeout&&K.setTimeout,uh=$e.ceil,ch=$e.floor,pd=me.getOwnPropertySymbols,K1=sh?sh.isBuffer:e,qg=K.isFinite,Z1=eh.join,J1=Hg(me.keys,me),Ve=$e.max,ci=$e.min,Q1=Et.now,tS=K.parseInt,Kg=$e.random,eS=eh.reverse,_d=bs(K,"DataView"),No=bs(K,"Map"),gd=bs(K,"Promise"),ma=bs(K,"Set"),zo=bs(K,"WeakMap"),Go=bs(me,"create"),dh=zo&&new zo,ya={},iS=ws(_d),rS=ws(No),nS=ws(gd),sS=ws(ma),aS=ws(zo),fh=Dn?Dn.prototype:e,Ho=fh?fh.valueOf:e,Zg=fh?fh.toString:e;function I(c){if(Fe(c)&&!Kt(c)&&!(c instanceof se)){if(c instanceof qi)return c;if(_e.call(c,"__wrapped__"))return Jm(c)}return new qi(c)}var va=function(){function c(){}return function(p){if(!Ce(p))return{};if(Xg)return Xg(p);c.prototype=p;var y=new c;return c.prototype=e,y}}();function ph(){}function qi(c,p){this.__wrapped__=c,this.__actions__=[],this.__chain__=!!p,this.__index__=0,this.__values__=e}I.templateSettings={escape:Mt,evaluate:It,interpolate:zt,variable:"",imports:{_:I}},I.prototype=ph.prototype,I.prototype.constructor=I,qi.prototype=va(ph.prototype),qi.prototype.constructor=qi;function se(c){this.__wrapped__=c,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function oS(){var c=new se(this.__wrapped__);return c.__actions__=Ei(this.__actions__),c.__dir__=this.__dir__,c.__filtered__=this.__filtered__,c.__iteratees__=Ei(this.__iteratees__),c.__takeCount__=this.__takeCount__,c.__views__=Ei(this.__views__),c}function lS(){if(this.__filtered__){var c=new se(this);c.__dir__=-1,c.__filtered__=!0}else c=this.clone(),c.__dir__*=-1;return c}function hS(){var c=this.__wrapped__.value(),p=this.__dir__,y=Kt(c),E=p<0,U=y?c.length:0,P=bE(0,U,this.__views__),D=P.start,O=P.end,V=O-D,tt=E?O:D-1,et=this.__iteratees__,st=et.length,mt=0,Pt=ci(V,this.__takeCount__);if(!y||!E&&U==V&&Pt==V)return bm(c,this.__actions__);var Ht=[];t:for(;V--&&mt<Pt;){tt+=p;for(var te=-1,$t=c[tt];++te<st;){var re=et[te],ae=re.iteratee,Di=re.type,xi=ae($t);if(Di==Y)$t=xi;else if(!xi){if(Di==j)continue t;break t}}Ht[mt++]=$t}return Ht}se.prototype=va(ph.prototype),se.prototype.constructor=se;function ms(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var E=c[p];this.set(E[0],E[1])}}function uS(){this.__data__=Go?Go(null):{},this.size=0}function cS(c){var p=this.has(c)&&delete this.__data__[c];return this.size-=p?1:0,p}function dS(c){var p=this.__data__;if(Go){var y=p[c];return y===_?e:y}return _e.call(p,c)?p[c]:e}function fS(c){var p=this.__data__;return Go?p[c]!==e:_e.call(p,c)}function pS(c,p){var y=this.__data__;return this.size+=this.has(c)?0:1,y[c]=Go&&p===e?_:p,this}ms.prototype.clear=uS,ms.prototype.delete=cS,ms.prototype.get=dS,ms.prototype.has=fS,ms.prototype.set=pS;function rn(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var E=c[p];this.set(E[0],E[1])}}function _S(){this.__data__=[],this.size=0}function gS(c){var p=this.__data__,y=_h(p,c);if(y<0)return!1;var E=p.length-1;return y==E?p.pop():lh.call(p,y,1),--this.size,!0}function mS(c){var p=this.__data__,y=_h(p,c);return y<0?e:p[y][1]}function yS(c){return _h(this.__data__,c)>-1}function vS(c,p){var y=this.__data__,E=_h(y,c);return E<0?(++this.size,y.push([c,p])):y[E][1]=p,this}rn.prototype.clear=_S,rn.prototype.delete=gS,rn.prototype.get=mS,rn.prototype.has=yS,rn.prototype.set=vS;function nn(c){var p=-1,y=c==null?0:c.length;for(this.clear();++p<y;){var E=c[p];this.set(E[0],E[1])}}function xS(){this.size=0,this.__data__={hash:new ms,map:new(No||rn),string:new ms}}function bS(c){var p=Ch(this,c).delete(c);return this.size-=p?1:0,p}function wS(c){return Ch(this,c).get(c)}function SS(c){return Ch(this,c).has(c)}function ES(c,p){var y=Ch(this,c),E=y.size;return y.set(c,p),this.size+=y.size==E?0:1,this}nn.prototype.clear=xS,nn.prototype.delete=bS,nn.prototype.get=wS,nn.prototype.has=SS,nn.prototype.set=ES;function ys(c){var p=-1,y=c==null?0:c.length;for(this.__data__=new nn;++p<y;)this.add(c[p])}function TS(c){return this.__data__.set(c,_),this}function AS(c){return this.__data__.has(c)}ys.prototype.add=ys.prototype.push=TS,ys.prototype.has=AS;function lr(c){var p=this.__data__=new rn(c);this.size=p.size}function CS(){this.__data__=new rn,this.size=0}function US(c){var p=this.__data__,y=p.delete(c);return this.size=p.size,y}function IS(c){return this.__data__.get(c)}function PS(c){return this.__data__.has(c)}function RS(c,p){var y=this.__data__;if(y instanceof rn){var E=y.__data__;if(!No||E.length<o-1)return E.push([c,p]),this.size=++y.size,this;y=this.__data__=new nn(E)}return y.set(c,p),this.size=y.size,this}lr.prototype.clear=CS,lr.prototype.delete=US,lr.prototype.get=IS,lr.prototype.has=PS,lr.prototype.set=RS;function Jg(c,p){var y=Kt(c),E=!y&&Ss(c),U=!y&&!E&&Gn(c),P=!y&&!E&&!U&&Sa(c),D=y||E||U||P,O=D?ud(c.length,G1):[],V=O.length;for(var tt in c)(p||_e.call(c,tt))&&!(D&&(tt=="length"||U&&(tt=="offset"||tt=="parent")||P&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||ln(tt,V)))&&O.push(tt);return O}function Qg(c){var p=c.length;return p?c[Cd(0,p-1)]:e}function BS(c,p){return Uh(Ei(c),vs(p,0,c.length))}function FS(c){return Uh(Ei(c))}function md(c,p,y){(y!==e&&!hr(c[p],y)||y===e&&!(p in c))&&sn(c,p,y)}function $o(c,p,y){var E=c[p];(!(_e.call(c,p)&&hr(E,y))||y===e&&!(p in c))&&sn(c,p,y)}function _h(c,p){for(var y=c.length;y--;)if(hr(c[y][0],p))return y;return-1}function MS(c,p,y,E){return kn(c,function(U,P,D){p(E,U,y(U),D)}),E}function tm(c,p){return c&&Fr(p,Ze(p),c)}function LS(c,p){return c&&Fr(p,Ai(p),c)}function sn(c,p,y){p=="__proto__"&&hh?hh(c,p,{configurable:!0,enumerable:!0,value:y,writable:!0}):c[p]=y}function yd(c,p){for(var y=-1,E=p.length,U=X(E),P=c==null;++y<E;)U[y]=P?e:Jd(c,p[y]);return U}function vs(c,p,y){return c===c&&(y!==e&&(c=c<=y?c:y),p!==e&&(c=c>=p?c:p)),c}function Ki(c,p,y,E,U,P){var D,O=p&w,V=p&b,tt=p&T;if(y&&(D=U?y(c,E,U,P):y(c)),D!==e)return D;if(!Ce(c))return c;var et=Kt(c);if(et){if(D=SE(c),!O)return Ei(c,D)}else{var st=di(c),mt=st==Xt||st==Ot;if(Gn(c))return Em(c,O);if(st==Be||st==vt||mt&&!U){if(D=V||mt?{}:$m(c),!O)return V?dE(c,LS(D,c)):cE(c,tm(D,c))}else{if(!ve[st])return U?c:{};D=EE(c,st,O)}}P||(P=new lr);var Pt=P.get(c);if(Pt)return Pt;P.set(c,D),yy(c)?c.forEach(function($t){D.add(Ki($t,p,y,$t,c,P))}):gy(c)&&c.forEach(function($t,re){D.set(re,Ki($t,p,y,re,c,P))});var Ht=tt?V?Od:kd:V?Ai:Ze,te=et?e:Ht(c);return Yi(te||c,function($t,re){te&&(re=$t,$t=c[re]),$o(D,re,Ki($t,p,y,re,c,P))}),D}function DS(c){var p=Ze(c);return function(y){return em(y,c,p)}}function em(c,p,y){var E=y.length;if(c==null)return!E;for(c=me(c);E--;){var U=y[E],P=p[U],D=c[U];if(D===e&&!(U in c)||!P(D))return!1}return!0}function im(c,p,y){if(typeof c!="function")throw new ji(d);return Ko(function(){c.apply(e,y)},p)}function Vo(c,p,y,E){var U=-1,P=Jl,D=!0,O=c.length,V=[],tt=p.length;if(!O)return V;y&&(p=Ee(p,Fi(y))),E?(P=nd,D=!1):p.length>=o&&(P=ko,D=!1,p=new ys(p));t:for(;++U<O;){var et=c[U],st=y==null?et:y(et);if(et=E||et!==0?et:0,D&&st===st){for(var mt=tt;mt--;)if(p[mt]===st)continue t;V.push(et)}else P(p,st,E)||V.push(et)}return V}var kn=Im(Br),rm=Im(xd,!0);function kS(c,p){var y=!0;return kn(c,function(E,U,P){return y=!!p(E,U,P),y}),y}function gh(c,p,y){for(var E=-1,U=c.length;++E<U;){var P=c[E],D=p(P);if(D!=null&&(O===e?D===D&&!Li(D):y(D,O)))var O=D,V=P}return V}function OS(c,p,y,E){var U=c.length;for(y=Qt(y),y<0&&(y=-y>U?0:U+y),E=E===e||E>U?U:Qt(E),E<0&&(E+=U),E=y>E?0:xy(E);y<E;)c[y++]=p;return c}function nm(c,p){var y=[];return kn(c,function(E,U,P){p(E,U,P)&&y.push(E)}),y}function ri(c,p,y,E,U){var P=-1,D=c.length;for(y||(y=AE),U||(U=[]);++P<D;){var O=c[P];p>0&&y(O)?p>1?ri(O,p-1,y,E,U):Mn(U,O):E||(U[U.length]=O)}return U}var vd=Pm(),sm=Pm(!0);function Br(c,p){return c&&vd(c,p,Ze)}function xd(c,p){return c&&sm(c,p,Ze)}function mh(c,p){return Fn(p,function(y){return hn(c[y])})}function xs(c,p){p=Nn(p,c);for(var y=0,E=p.length;c!=null&&y<E;)c=c[Mr(p[y++])];return y&&y==E?c:e}function am(c,p,y){var E=p(c);return Kt(c)?E:Mn(E,y(c))}function yi(c){return c==null?c===e?Xc:ce:gs&&gs in me(c)?xE(c):FE(c)}function bd(c,p){return c>p}function NS(c,p){return c!=null&&_e.call(c,p)}function zS(c,p){return c!=null&&p in me(c)}function GS(c,p,y){return c>=ci(p,y)&&c<Ve(p,y)}function wd(c,p,y){for(var E=y?nd:Jl,U=c[0].length,P=c.length,D=P,O=X(P),V=1/0,tt=[];D--;){var et=c[D];D&&p&&(et=Ee(et,Fi(p))),V=ci(et.length,V),O[D]=!y&&(p||U>=120&&et.length>=120)?new ys(D&&et):e}et=c[0];var st=-1,mt=O[0];t:for(;++st<U&&tt.length<V;){var Pt=et[st],Ht=p?p(Pt):Pt;if(Pt=y||Pt!==0?Pt:0,!(mt?ko(mt,Ht):E(tt,Ht,y))){for(D=P;--D;){var te=O[D];if(!(te?ko(te,Ht):E(c[D],Ht,y)))continue t}mt&&mt.push(Ht),tt.push(Pt)}}return tt}function HS(c,p,y,E){return Br(c,function(U,P,D){p(E,y(U),P,D)}),E}function Wo(c,p,y){p=Nn(p,c),c=Ym(c,p);var E=c==null?c:c[Mr(Ji(p))];return E==null?e:Bi(E,c,y)}function om(c){return Fe(c)&&yi(c)==vt}function $S(c){return Fe(c)&&yi(c)==fs}function VS(c){return Fe(c)&&yi(c)==q}function Xo(c,p,y,E,U){return c===p?!0:c==null||p==null||!Fe(c)&&!Fe(p)?c!==c&&p!==p:WS(c,p,y,E,Xo,U)}function WS(c,p,y,E,U,P){var D=Kt(c),O=Kt(p),V=D?At:di(c),tt=O?At:di(p);V=V==vt?Be:V,tt=tt==vt?Be:tt;var et=V==Be,st=tt==Be,mt=V==tt;if(mt&&Gn(c)){if(!Gn(p))return!1;D=!0,et=!1}if(mt&&!et)return P||(P=new lr),D||Sa(c)?zm(c,p,y,E,U,P):yE(c,p,V,y,E,U,P);if(!(y&r)){var Pt=et&&_e.call(c,"__wrapped__"),Ht=st&&_e.call(p,"__wrapped__");if(Pt||Ht){var te=Pt?c.value():c,$t=Ht?p.value():p;return P||(P=new lr),U(te,$t,y,E,P)}}return mt?(P||(P=new lr),vE(c,p,y,E,U,P)):!1}function XS(c){return Fe(c)&&di(c)==Nt}function Sd(c,p,y,E){var U=y.length,P=U,D=!E;if(c==null)return!P;for(c=me(c);U--;){var O=y[U];if(D&&O[2]?O[1]!==c[O[0]]:!(O[0]in c))return!1}for(;++U<P;){O=y[U];var V=O[0],tt=c[V],et=O[1];if(D&&O[2]){if(tt===e&&!(V in c))return!1}else{var st=new lr;if(E)var mt=E(tt,et,V,c,p,st);if(!(mt===e?Xo(et,tt,r|a,E,st):mt))return!1}}return!0}function lm(c){if(!Ce(c)||UE(c))return!1;var p=hn(c)?X1:Dw;return p.test(ws(c))}function YS(c){return Fe(c)&&yi(c)==Vi}function jS(c){return Fe(c)&&di(c)==mi}function qS(c){return Fe(c)&&Mh(c.length)&&!!xe[yi(c)]}function hm(c){return typeof c=="function"?c:c==null?Ci:typeof c=="object"?Kt(c)?dm(c[0],c[1]):cm(c):Ry(c)}function Ed(c){if(!qo(c))return J1(c);var p=[];for(var y in me(c))_e.call(c,y)&&y!="constructor"&&p.push(y);return p}function KS(c){if(!Ce(c))return BE(c);var p=qo(c),y=[];for(var E in c)E=="constructor"&&(p||!_e.call(c,E))||y.push(E);return y}function Td(c,p){return c<p}function um(c,p){var y=-1,E=Ti(c)?X(c.length):[];return kn(c,function(U,P,D){E[++y]=p(U,P,D)}),E}function cm(c){var p=zd(c);return p.length==1&&p[0][2]?Wm(p[0][0],p[0][1]):function(y){return y===c||Sd(y,c,p)}}function dm(c,p){return Hd(c)&&Vm(p)?Wm(Mr(c),p):function(y){var E=Jd(y,c);return E===e&&E===p?Qd(y,c):Xo(p,E,r|a)}}function yh(c,p,y,E,U){c!==p&&vd(p,function(P,D){if(U||(U=new lr),Ce(P))ZS(c,p,D,y,yh,E,U);else{var O=E?E(Vd(c,D),P,D+"",c,p,U):e;O===e&&(O=P),md(c,D,O)}},Ai)}function ZS(c,p,y,E,U,P,D){var O=Vd(c,y),V=Vd(p,y),tt=D.get(V);if(tt){md(c,y,tt);return}var et=P?P(O,V,y+"",c,p,D):e,st=et===e;if(st){var mt=Kt(V),Pt=!mt&&Gn(V),Ht=!mt&&!Pt&&Sa(V);et=V,mt||Pt||Ht?Kt(O)?et=O:ke(O)?et=Ei(O):Pt?(st=!1,et=Em(V,!0)):Ht?(st=!1,et=Tm(V,!0)):et=[]:Zo(V)||Ss(V)?(et=O,Ss(O)?et=by(O):(!Ce(O)||hn(O))&&(et=$m(V))):st=!1}st&&(D.set(V,et),U(et,V,E,P,D),D.delete(V)),md(c,y,et)}function fm(c,p){var y=c.length;if(y)return p+=p<0?y:0,ln(p,y)?c[p]:e}function pm(c,p,y){p.length?p=Ee(p,function(P){return Kt(P)?function(D){return xs(D,P.length===1?P[0]:P)}:P}):p=[Ci];var E=-1;p=Ee(p,Fi(Gt()));var U=um(c,function(P,D,O){var V=Ee(p,function(tt){return tt(P)});return{criteria:V,index:++E,value:P}});return E1(U,function(P,D){return uE(P,D,y)})}function JS(c,p){return _m(c,p,function(y,E){return Qd(c,E)})}function _m(c,p,y){for(var E=-1,U=p.length,P={};++E<U;){var D=p[E],O=xs(c,D);y(O,D)&&Yo(P,Nn(D,c),O)}return P}function QS(c){return function(p){return xs(p,c)}}function Ad(c,p,y,E){var U=E?S1:da,P=-1,D=p.length,O=c;for(c===p&&(p=Ei(p)),y&&(O=Ee(c,Fi(y)));++P<D;)for(var V=0,tt=p[P],et=y?y(tt):tt;(V=U(O,et,V,E))>-1;)O!==c&&lh.call(O,V,1),lh.call(c,V,1);return c}function gm(c,p){for(var y=c?p.length:0,E=y-1;y--;){var U=p[y];if(y==E||U!==P){var P=U;ln(U)?lh.call(c,U,1):Pd(c,U)}}return c}function Cd(c,p){return c+ch(Kg()*(p-c+1))}function tE(c,p,y,E){for(var U=-1,P=Ve(uh((p-c)/(y||1)),0),D=X(P);P--;)D[E?P:++U]=c,c+=y;return D}function Ud(c,p){var y="";if(!c||p<1||p>gt)return y;do p%2&&(y+=c),p=ch(p/2),p&&(c+=c);while(p);return y}function ie(c,p){return Wd(Xm(c,p,Ci),c+"")}function eE(c){return Qg(Ea(c))}function iE(c,p){var y=Ea(c);return Uh(y,vs(p,0,y.length))}function Yo(c,p,y,E){if(!Ce(c))return c;p=Nn(p,c);for(var U=-1,P=p.length,D=P-1,O=c;O!=null&&++U<P;){var V=Mr(p[U]),tt=y;if(V==="__proto__"||V==="constructor"||V==="prototype")return c;if(U!=D){var et=O[V];tt=E?E(et,V,O):e,tt===e&&(tt=Ce(et)?et:ln(p[U+1])?[]:{})}$o(O,V,tt),O=O[V]}return c}var mm=dh?function(c,p){return dh.set(c,p),c}:Ci,rE=hh?function(c,p){return hh(c,"toString",{configurable:!0,enumerable:!1,value:ef(p),writable:!0})}:Ci;function nE(c){return Uh(Ea(c))}function Zi(c,p,y){var E=-1,U=c.length;p<0&&(p=-p>U?0:U+p),y=y>U?U:y,y<0&&(y+=U),U=p>y?0:y-p>>>0,p>>>=0;for(var P=X(U);++E<U;)P[E]=c[E+p];return P}function sE(c,p){var y;return kn(c,function(E,U,P){return y=p(E,U,P),!y}),!!y}function vh(c,p,y){var E=0,U=c==null?E:c.length;if(typeof p=="number"&&p===p&&U<=G){for(;E<U;){var P=E+U>>>1,D=c[P];D!==null&&!Li(D)&&(y?D<=p:D<p)?E=P+1:U=P}return U}return Id(c,p,Ci,y)}function Id(c,p,y,E){var U=0,P=c==null?0:c.length;if(P===0)return 0;p=y(p);for(var D=p!==p,O=p===null,V=Li(p),tt=p===e;U<P;){var et=ch((U+P)/2),st=y(c[et]),mt=st!==e,Pt=st===null,Ht=st===st,te=Li(st);if(D)var $t=E||Ht;else tt?$t=Ht&&(E||mt):O?$t=Ht&&mt&&(E||!Pt):V?$t=Ht&&mt&&!Pt&&(E||!te):Pt||te?$t=!1:$t=E?st<=p:st<p;$t?U=et+1:P=et}return ci(P,H)}function ym(c,p){for(var y=-1,E=c.length,U=0,P=[];++y<E;){var D=c[y],O=p?p(D):D;if(!y||!hr(O,V)){var V=O;P[U++]=D===0?0:D}}return P}function vm(c){return typeof c=="number"?c:Li(c)?rt:+c}function Mi(c){if(typeof c=="string")return c;if(Kt(c))return Ee(c,Mi)+"";if(Li(c))return Zg?Zg.call(c):"";var p=c+"";return p=="0"&&1/c==-1/0?"-0":p}function On(c,p,y){var E=-1,U=Jl,P=c.length,D=!0,O=[],V=O;if(y)D=!1,U=nd;else if(P>=o){var tt=p?null:gE(c);if(tt)return th(tt);D=!1,U=ko,V=new ys}else V=p?[]:O;t:for(;++E<P;){var et=c[E],st=p?p(et):et;if(et=y||et!==0?et:0,D&&st===st){for(var mt=V.length;mt--;)if(V[mt]===st)continue t;p&&V.push(st),O.push(et)}else U(V,st,y)||(V!==O&&V.push(st),O.push(et))}return O}function Pd(c,p){return p=Nn(p,c),c=Ym(c,p),c==null||delete c[Mr(Ji(p))]}function xm(c,p,y,E){return Yo(c,p,y(xs(c,p)),E)}function xh(c,p,y,E){for(var U=c.length,P=E?U:-1;(E?P--:++P<U)&&p(c[P],P,c););return y?Zi(c,E?0:P,E?P+1:U):Zi(c,E?P+1:0,E?U:P)}function bm(c,p){var y=c;return y instanceof se&&(y=y.value()),sd(p,function(E,U){return U.func.apply(U.thisArg,Mn([E],U.args))},y)}function Rd(c,p,y){var E=c.length;if(E<2)return E?On(c[0]):[];for(var U=-1,P=X(E);++U<E;)for(var D=c[U],O=-1;++O<E;)O!=U&&(P[U]=Vo(P[U]||D,c[O],p,y));return On(ri(P,1),p,y)}function wm(c,p,y){for(var E=-1,U=c.length,P=p.length,D={};++E<U;){var O=E<P?p[E]:e;y(D,c[E],O)}return D}function Bd(c){return ke(c)?c:[]}function Fd(c){return typeof c=="function"?c:Ci}function Nn(c,p){return Kt(c)?c:Hd(c,p)?[c]:Zm(fe(c))}var aE=ie;function zn(c,p,y){var E=c.length;return y=y===e?E:y,!p&&y>=E?c:Zi(c,p,y)}var Sm=Y1||function(c){return ii.clearTimeout(c)};function Em(c,p){if(p)return c.slice();var y=c.length,E=Wg?Wg(y):new c.constructor(y);return c.copy(E),E}function Md(c){var p=new c.constructor(c.byteLength);return new ah(p).set(new ah(c)),p}function oE(c,p){var y=p?Md(c.buffer):c.buffer;return new c.constructor(y,c.byteOffset,c.byteLength)}function lE(c){var p=new c.constructor(c.source,og.exec(c));return p.lastIndex=c.lastIndex,p}function hE(c){return Ho?me(Ho.call(c)):{}}function Tm(c,p){var y=p?Md(c.buffer):c.buffer;return new c.constructor(y,c.byteOffset,c.length)}function Am(c,p){if(c!==p){var y=c!==e,E=c===null,U=c===c,P=Li(c),D=p!==e,O=p===null,V=p===p,tt=Li(p);if(!O&&!tt&&!P&&c>p||P&&D&&V&&!O&&!tt||E&&D&&V||!y&&V||!U)return 1;if(!E&&!P&&!tt&&c<p||tt&&y&&U&&!E&&!P||O&&y&&U||!D&&U||!V)return-1}return 0}function uE(c,p,y){for(var E=-1,U=c.criteria,P=p.criteria,D=U.length,O=y.length;++E<D;){var V=Am(U[E],P[E]);if(V){if(E>=O)return V;var tt=y[E];return V*(tt=="desc"?-1:1)}}return c.index-p.index}function Cm(c,p,y,E){for(var U=-1,P=c.length,D=y.length,O=-1,V=p.length,tt=Ve(P-D,0),et=X(V+tt),st=!E;++O<V;)et[O]=p[O];for(;++U<D;)(st||U<P)&&(et[y[U]]=c[U]);for(;tt--;)et[O++]=c[U++];return et}function Um(c,p,y,E){for(var U=-1,P=c.length,D=-1,O=y.length,V=-1,tt=p.length,et=Ve(P-O,0),st=X(et+tt),mt=!E;++U<et;)st[U]=c[U];for(var Pt=U;++V<tt;)st[Pt+V]=p[V];for(;++D<O;)(mt||U<P)&&(st[Pt+y[D]]=c[U++]);return st}function Ei(c,p){var y=-1,E=c.length;for(p||(p=X(E));++y<E;)p[y]=c[y];return p}function Fr(c,p,y,E){var U=!y;y||(y={});for(var P=-1,D=p.length;++P<D;){var O=p[P],V=E?E(y[O],c[O],O,y,c):e;V===e&&(V=c[O]),U?sn(y,O,V):$o(y,O,V)}return y}function cE(c,p){return Fr(c,Gd(c),p)}function dE(c,p){return Fr(c,Gm(c),p)}function bh(c,p){return function(y,E){var U=Kt(y)?m1:MS,P=p?p():{};return U(y,c,Gt(E,2),P)}}function xa(c){return ie(function(p,y){var E=-1,U=y.length,P=U>1?y[U-1]:e,D=U>2?y[2]:e;for(P=c.length>3&&typeof P=="function"?(U--,P):e,D&&vi(y[0],y[1],D)&&(P=U<3?e:P,U=1),p=me(p);++E<U;){var O=y[E];O&&c(p,O,E,P)}return p})}function Im(c,p){return function(y,E){if(y==null)return y;if(!Ti(y))return c(y,E);for(var U=y.length,P=p?U:-1,D=me(y);(p?P--:++P<U)&&E(D[P],P,D)!==!1;);return y}}function Pm(c){return function(p,y,E){for(var U=-1,P=me(p),D=E(p),O=D.length;O--;){var V=D[c?O:++U];if(y(P[V],V,P)===!1)break}return p}}function fE(c,p,y){var E=p&u,U=jo(c);function P(){var D=this&&this!==ii&&this instanceof P?U:c;return D.apply(E?y:this,arguments)}return P}function Rm(c){return function(p){p=fe(p);var y=fa(p)?or(p):e,E=y?y[0]:p.charAt(0),U=y?zn(y,1).join(""):p.slice(1);return E[c]()+U}}function ba(c){return function(p){return sd(Iy(Uy(p).replace(r1,"")),c,"")}}function jo(c){return function(){var p=arguments;switch(p.length){case 0:return new c;case 1:return new c(p[0]);case 2:return new c(p[0],p[1]);case 3:return new c(p[0],p[1],p[2]);case 4:return new c(p[0],p[1],p[2],p[3]);case 5:return new c(p[0],p[1],p[2],p[3],p[4]);case 6:return new c(p[0],p[1],p[2],p[3],p[4],p[5]);case 7:return new c(p[0],p[1],p[2],p[3],p[4],p[5],p[6])}var y=va(c.prototype),E=c.apply(y,p);return Ce(E)?E:y}}function pE(c,p,y){var E=jo(c);function U(){for(var P=arguments.length,D=X(P),O=P,V=wa(U);O--;)D[O]=arguments[O];var tt=P<3&&D[0]!==V&&D[P-1]!==V?[]:Ln(D,V);if(P-=tt.length,P<y)return Dm(c,p,wh,U.placeholder,e,D,tt,e,e,y-P);var et=this&&this!==ii&&this instanceof U?E:c;return Bi(et,this,D)}return U}function Bm(c){return function(p,y,E){var U=me(p);if(!Ti(p)){var P=Gt(y,3);p=Ze(p),y=function(O){return P(U[O],O,U)}}var D=c(p,y,E);return D>-1?U[P?p[D]:D]:e}}function Fm(c){return on(function(p){var y=p.length,E=y,U=qi.prototype.thru;for(c&&p.reverse();E--;){var P=p[E];if(typeof P!="function")throw new ji(d);if(U&&!D&&Ah(P)=="wrapper")var D=new qi([],!0)}for(E=D?E:y;++E<y;){P=p[E];var O=Ah(P),V=O=="wrapper"?Nd(P):e;V&&$d(V[0])&&V[1]==(B|x|A|R)&&!V[4].length&&V[9]==1?D=D[Ah(V[0])].apply(D,V[3]):D=P.length==1&&$d(P)?D[O]():D.thru(P)}return function(){var tt=arguments,et=tt[0];if(D&&tt.length==1&&Kt(et))return D.plant(et).value();for(var st=0,mt=y?p[st].apply(this,tt):et;++st<y;)mt=p[st].call(this,mt);return mt}})}function wh(c,p,y,E,U,P,D,O,V,tt){var et=p&B,st=p&u,mt=p&f,Pt=p&(x|S),Ht=p&M,te=mt?e:jo(c);function $t(){for(var re=arguments.length,ae=X(re),Di=re;Di--;)ae[Di]=arguments[Di];if(Pt)var xi=wa($t),ki=A1(ae,xi);if(E&&(ae=Cm(ae,E,U,Pt)),P&&(ae=Um(ae,P,D,Pt)),re-=ki,Pt&&re<tt){var Oe=Ln(ae,xi);return Dm(c,p,wh,$t.placeholder,y,ae,Oe,O,V,tt-re)}var ur=st?y:this,cn=mt?ur[c]:c;return re=ae.length,O?ae=ME(ae,O):Ht&&re>1&&ae.reverse(),et&&V<re&&(ae.length=V),this&&this!==ii&&this instanceof $t&&(cn=te||jo(cn)),cn.apply(ur,ae)}return $t}function Mm(c,p){return function(y,E){return HS(y,c,p(E),{})}}function Sh(c,p){return function(y,E){var U;if(y===e&&E===e)return p;if(y!==e&&(U=y),E!==e){if(U===e)return E;typeof y=="string"||typeof E=="string"?(y=Mi(y),E=Mi(E)):(y=vm(y),E=vm(E)),U=c(y,E)}return U}}function Ld(c){return on(function(p){return p=Ee(p,Fi(Gt())),ie(function(y){var E=this;return c(p,function(U){return Bi(U,E,y)})})})}function Eh(c,p){p=p===e?" ":Mi(p);var y=p.length;if(y<2)return y?Ud(p,c):p;var E=Ud(p,uh(c/pa(p)));return fa(p)?zn(or(E),0,c).join(""):E.slice(0,c)}function _E(c,p,y,E){var U=p&u,P=jo(c);function D(){for(var O=-1,V=arguments.length,tt=-1,et=E.length,st=X(et+V),mt=this&&this!==ii&&this instanceof D?P:c;++tt<et;)st[tt]=E[tt];for(;V--;)st[tt++]=arguments[++O];return Bi(mt,U?y:this,st)}return D}function Lm(c){return function(p,y,E){return E&&typeof E!="number"&&vi(p,y,E)&&(y=E=e),p=un(p),y===e?(y=p,p=0):y=un(y),E=E===e?p<y?1:-1:un(E),tE(p,y,E,c)}}function Th(c){return function(p,y){return typeof p=="string"&&typeof y=="string"||(p=Qi(p),y=Qi(y)),c(p,y)}}function Dm(c,p,y,E,U,P,D,O,V,tt){var et=p&x,st=et?D:e,mt=et?e:D,Pt=et?P:e,Ht=et?e:P;p|=et?A:C,p&=~(et?C:A),p&g||(p&=-4);var te=[c,p,U,Pt,st,Ht,mt,O,V,tt],$t=y.apply(e,te);return $d(c)&&jm($t,te),$t.placeholder=E,qm($t,c,p)}function Dd(c){var p=$e[c];return function(y,E){if(y=Qi(y),E=E==null?0:ci(Qt(E),292),E&&qg(y)){var U=(fe(y)+"e").split("e"),P=p(U[0]+"e"+(+U[1]+E));return U=(fe(P)+"e").split("e"),+(U[0]+"e"+(+U[1]-E))}return p(y)}}var gE=ma&&1/th(new ma([,-0]))[1]==it?function(c){return new ma(c)}:sf;function km(c){return function(p){var y=di(p);return y==Nt?dd(p):y==mi?F1(p):T1(p,c(p))}}function an(c,p,y,E,U,P,D,O){var V=p&f;if(!V&&typeof c!="function")throw new ji(d);var tt=E?E.length:0;if(tt||(p&=-97,E=U=e),D=D===e?D:Ve(Qt(D),0),O=O===e?O:Qt(O),tt-=U?U.length:0,p&C){var et=E,st=U;E=U=e}var mt=V?e:Nd(c),Pt=[c,p,y,E,U,et,st,P,D,O];if(mt&&RE(Pt,mt),c=Pt[0],p=Pt[1],y=Pt[2],E=Pt[3],U=Pt[4],O=Pt[9]=Pt[9]===e?V?0:c.length:Ve(Pt[9]-tt,0),!O&&p&(x|S)&&(p&=-25),!p||p==u)var Ht=fE(c,p,y);else p==x||p==S?Ht=pE(c,p,O):(p==A||p==(u|A))&&!U.length?Ht=_E(c,p,y,E):Ht=wh.apply(e,Pt);var te=mt?mm:jm;return qm(te(Ht,Pt),c,p)}function Om(c,p,y,E){return c===e||hr(c,ga[y])&&!_e.call(E,y)?p:c}function Nm(c,p,y,E,U,P){return Ce(c)&&Ce(p)&&(P.set(p,c),yh(c,p,e,Nm,P),P.delete(p)),c}function mE(c){return Zo(c)?e:c}function zm(c,p,y,E,U,P){var D=y&r,O=c.length,V=p.length;if(O!=V&&!(D&&V>O))return!1;var tt=P.get(c),et=P.get(p);if(tt&&et)return tt==p&&et==c;var st=-1,mt=!0,Pt=y&a?new ys:e;for(P.set(c,p),P.set(p,c);++st<O;){var Ht=c[st],te=p[st];if(E)var $t=D?E(te,Ht,st,p,c,P):E(Ht,te,st,c,p,P);if($t!==e){if($t)continue;mt=!1;break}if(Pt){if(!ad(p,function(re,ae){if(!ko(Pt,ae)&&(Ht===re||U(Ht,re,y,E,P)))return Pt.push(ae)})){mt=!1;break}}else if(!(Ht===te||U(Ht,te,y,E,P))){mt=!1;break}}return P.delete(c),P.delete(p),mt}function yE(c,p,y,E,U,P,D){switch(y){case Wi:if(c.byteLength!=p.byteLength||c.byteOffset!=p.byteOffset)return!1;c=c.buffer,p=p.buffer;case fs:return!(c.byteLength!=p.byteLength||!P(new ah(c),new ah(p)));case ht:case q:case Lt:return hr(+c,+p);case dt:return c.name==p.name&&c.message==p.message;case Vi:case en:return c==p+"";case Nt:var O=dd;case mi:var V=E&r;if(O||(O=th),c.size!=p.size&&!V)return!1;var tt=D.get(c);if(tt)return tt==p;E|=a,D.set(c,p);var et=zm(O(c),O(p),E,U,P,D);return D.delete(c),et;case ha:if(Ho)return Ho.call(c)==Ho.call(p)}return!1}function vE(c,p,y,E,U,P){var D=y&r,O=kd(c),V=O.length,tt=kd(p),et=tt.length;if(V!=et&&!D)return!1;for(var st=V;st--;){var mt=O[st];if(!(D?mt in p:_e.call(p,mt)))return!1}var Pt=P.get(c),Ht=P.get(p);if(Pt&&Ht)return Pt==p&&Ht==c;var te=!0;P.set(c,p),P.set(p,c);for(var $t=D;++st<V;){mt=O[st];var re=c[mt],ae=p[mt];if(E)var Di=D?E(ae,re,mt,p,c,P):E(re,ae,mt,c,p,P);if(!(Di===e?re===ae||U(re,ae,y,E,P):Di)){te=!1;break}$t||($t=mt=="constructor")}if(te&&!$t){var xi=c.constructor,ki=p.constructor;xi!=ki&&"constructor"in c&&"constructor"in p&&!(typeof xi=="function"&&xi instanceof xi&&typeof ki=="function"&&ki instanceof ki)&&(te=!1)}return P.delete(c),P.delete(p),te}function on(c){return Wd(Xm(c,e,ey),c+"")}function kd(c){return am(c,Ze,Gd)}function Od(c){return am(c,Ai,Gm)}var Nd=dh?function(c){return dh.get(c)}:sf;function Ah(c){for(var p=c.name+"",y=ya[p],E=_e.call(ya,p)?y.length:0;E--;){var U=y[E],P=U.func;if(P==null||P==c)return U.name}return p}function wa(c){var p=_e.call(I,"placeholder")?I:c;return p.placeholder}function Gt(){var c=I.iteratee||rf;return c=c===rf?hm:c,arguments.length?c(arguments[0],arguments[1]):c}function Ch(c,p){var y=c.__data__;return CE(p)?y[typeof p=="string"?"string":"hash"]:y.map}function zd(c){for(var p=Ze(c),y=p.length;y--;){var E=p[y],U=c[E];p[y]=[E,U,Vm(U)]}return p}function bs(c,p){var y=P1(c,p);return lm(y)?y:e}function xE(c){var p=_e.call(c,gs),y=c[gs];try{c[gs]=e;var E=!0}catch{}var U=nh.call(c);return E&&(p?c[gs]=y:delete c[gs]),U}var Gd=pd?function(c){return c==null?[]:(c=me(c),Fn(pd(c),function(p){return Yg.call(c,p)}))}:af,Gm=pd?function(c){for(var p=[];c;)Mn(p,Gd(c)),c=oh(c);return p}:af,di=yi;(_d&&di(new _d(new ArrayBuffer(1)))!=Wi||No&&di(new No)!=Nt||gd&&di(gd.resolve())!=gi||ma&&di(new ma)!=mi||zo&&di(new zo)!=pe)&&(di=function(c){var p=yi(c),y=p==Be?c.constructor:e,E=y?ws(y):"";if(E)switch(E){case iS:return Wi;case rS:return Nt;case nS:return gi;case sS:return mi;case aS:return pe}return p});function bE(c,p,y){for(var E=-1,U=y.length;++E<U;){var P=y[E],D=P.size;switch(P.type){case"drop":c+=D;break;case"dropRight":p-=D;break;case"take":p=ci(p,c+D);break;case"takeRight":c=Ve(c,p-D);break}}return{start:c,end:p}}function wE(c){var p=c.match(jl);return p?p[1].split(ag):[]}function Hm(c,p,y){p=Nn(p,c);for(var E=-1,U=p.length,P=!1;++E<U;){var D=Mr(p[E]);if(!(P=c!=null&&y(c,D)))break;c=c[D]}return P||++E!=U?P:(U=c==null?0:c.length,!!U&&Mh(U)&&ln(D,U)&&(Kt(c)||Ss(c)))}function SE(c){var p=c.length,y=new c.constructor(p);return p&&typeof c[0]=="string"&&_e.call(c,"index")&&(y.index=c.index,y.input=c.input),y}function $m(c){return typeof c.constructor=="function"&&!qo(c)?va(oh(c)):{}}function EE(c,p,y){var E=c.constructor;switch(p){case fs:return Md(c);case ht:case q:return new E(+c);case Wi:return oE(c,y);case ua:case ps:case Bo:case Fo:case Mo:case Pr:case Lo:case Bn:case Do:return Tm(c,y);case Nt:return new E;case Lt:case en:return new E(c);case Vi:return lE(c);case mi:return new E;case ha:return hE(c)}}function TE(c,p){var y=p.length;if(!y)return c;var E=y-1;return p[E]=(y>1?"& ":"")+p[E],p=p.join(y>2?", ":" "),c.replace(Rr,`{
/* [wrapped with `+p+`] */
`)}function AE(c){return Kt(c)||Ss(c)||!!(jg&&c&&c[jg])}function ln(c,p){var y=typeof c;return p=p??gt,!!p&&(y=="number"||y!="symbol"&&Ow.test(c))&&c>-1&&c%1==0&&c<p}function vi(c,p,y){if(!Ce(y))return!1;var E=typeof p;return(E=="number"?Ti(y)&&ln(p,y.length):E=="string"&&p in y)?hr(y[p],c):!1}function Hd(c,p){if(Kt(c))return!1;var y=typeof c;return y=="number"||y=="symbol"||y=="boolean"||c==null||Li(c)?!0:ge.test(c)||!Yt.test(c)||p!=null&&c in me(p)}function CE(c){var p=typeof c;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?c!=="__proto__":c===null}function $d(c){var p=Ah(c),y=I[p];if(typeof y!="function"||!(p in se.prototype))return!1;if(c===y)return!0;var E=Nd(y);return!!E&&c===E[0]}function UE(c){return!!Vg&&Vg in c}var IE=ih?hn:of;function qo(c){var p=c&&c.constructor,y=typeof p=="function"&&p.prototype||ga;return c===y}function Vm(c){return c===c&&!Ce(c)}function Wm(c,p){return function(y){return y==null?!1:y[c]===p&&(p!==e||c in me(y))}}function PE(c){var p=Bh(c,function(E){return y.size===m&&y.clear(),E}),y=p.cache;return p}function RE(c,p){var y=c[1],E=p[1],U=y|E,P=U<(u|f|B),D=E==B&&y==x||E==B&&y==R&&c[7].length<=p[8]||E==(B|R)&&p[7].length<=p[8]&&y==x;if(!(P||D))return c;E&u&&(c[2]=p[2],U|=y&u?0:g);var O=p[3];if(O){var V=c[3];c[3]=V?Cm(V,O,p[4]):O,c[4]=V?Ln(c[3],v):p[4]}return O=p[5],O&&(V=c[5],c[5]=V?Um(V,O,p[6]):O,c[6]=V?Ln(c[5],v):p[6]),O=p[7],O&&(c[7]=O),E&B&&(c[8]=c[8]==null?p[8]:ci(c[8],p[8])),c[9]==null&&(c[9]=p[9]),c[0]=p[0],c[1]=U,c}function BE(c){var p=[];if(c!=null)for(var y in me(c))p.push(y);return p}function FE(c){return nh.call(c)}function Xm(c,p,y){return p=Ve(p===e?c.length-1:p,0),function(){for(var E=arguments,U=-1,P=Ve(E.length-p,0),D=X(P);++U<P;)D[U]=E[p+U];U=-1;for(var O=X(p+1);++U<p;)O[U]=E[U];return O[p]=y(D),Bi(c,this,O)}}function Ym(c,p){return p.length<2?c:xs(c,Zi(p,0,-1))}function ME(c,p){for(var y=c.length,E=ci(p.length,y),U=Ei(c);E--;){var P=p[E];c[E]=ln(P,y)?U[P]:e}return c}function Vd(c,p){if(!(p==="constructor"&&typeof c[p]=="function")&&p!="__proto__")return c[p]}var jm=Km(mm),Ko=q1||function(c,p){return ii.setTimeout(c,p)},Wd=Km(rE);function qm(c,p,y){var E=p+"";return Wd(c,TE(E,LE(wE(E),y)))}function Km(c){var p=0,y=0;return function(){var E=Q1(),U=k-(E-y);if(y=E,U>0){if(++p>=W)return arguments[0]}else p=0;return c.apply(e,arguments)}}function Uh(c,p){var y=-1,E=c.length,U=E-1;for(p=p===e?E:p;++y<p;){var P=Cd(y,U),D=c[P];c[P]=c[y],c[y]=D}return c.length=p,c}var Zm=PE(function(c){var p=[];return c.charCodeAt(0)===46&&p.push(""),c.replace(ze,function(y,E,U,P){p.push(U?P.replace(Bw,"$1"):E||y)}),p});function Mr(c){if(typeof c=="string"||Li(c))return c;var p=c+"";return p=="0"&&1/c==-1/0?"-0":p}function ws(c){if(c!=null){try{return rh.call(c)}catch{}try{return c+""}catch{}}return""}function LE(c,p){return Yi(at,function(y){var E="_."+y[0];p&y[1]&&!Jl(c,E)&&c.push(E)}),c.sort()}function Jm(c){if(c instanceof se)return c.clone();var p=new qi(c.__wrapped__,c.__chain__);return p.__actions__=Ei(c.__actions__),p.__index__=c.__index__,p.__values__=c.__values__,p}function DE(c,p,y){(y?vi(c,p,y):p===e)?p=1:p=Ve(Qt(p),0);var E=c==null?0:c.length;if(!E||p<1)return[];for(var U=0,P=0,D=X(uh(E/p));U<E;)D[P++]=Zi(c,U,U+=p);return D}function kE(c){for(var p=-1,y=c==null?0:c.length,E=0,U=[];++p<y;){var P=c[p];P&&(U[E++]=P)}return U}function OE(){var c=arguments.length;if(!c)return[];for(var p=X(c-1),y=arguments[0],E=c;E--;)p[E-1]=arguments[E];return Mn(Kt(y)?Ei(y):[y],ri(p,1))}var NE=ie(function(c,p){return ke(c)?Vo(c,ri(p,1,ke,!0)):[]}),zE=ie(function(c,p){var y=Ji(p);return ke(y)&&(y=e),ke(c)?Vo(c,ri(p,1,ke,!0),Gt(y,2)):[]}),GE=ie(function(c,p){var y=Ji(p);return ke(y)&&(y=e),ke(c)?Vo(c,ri(p,1,ke,!0),e,y):[]});function HE(c,p,y){var E=c==null?0:c.length;return E?(p=y||p===e?1:Qt(p),Zi(c,p<0?0:p,E)):[]}function $E(c,p,y){var E=c==null?0:c.length;return E?(p=y||p===e?1:Qt(p),p=E-p,Zi(c,0,p<0?0:p)):[]}function VE(c,p){return c&&c.length?xh(c,Gt(p,3),!0,!0):[]}function WE(c,p){return c&&c.length?xh(c,Gt(p,3),!0):[]}function XE(c,p,y,E){var U=c==null?0:c.length;return U?(y&&typeof y!="number"&&vi(c,p,y)&&(y=0,E=U),OS(c,p,y,E)):[]}function Qm(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=y==null?0:Qt(y);return U<0&&(U=Ve(E+U,0)),Ql(c,Gt(p,3),U)}function ty(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=E-1;return y!==e&&(U=Qt(y),U=y<0?Ve(E+U,0):ci(U,E-1)),Ql(c,Gt(p,3),U,!0)}function ey(c){var p=c==null?0:c.length;return p?ri(c,1):[]}function YE(c){var p=c==null?0:c.length;return p?ri(c,it):[]}function jE(c,p){var y=c==null?0:c.length;return y?(p=p===e?1:Qt(p),ri(c,p)):[]}function qE(c){for(var p=-1,y=c==null?0:c.length,E={};++p<y;){var U=c[p];E[U[0]]=U[1]}return E}function iy(c){return c&&c.length?c[0]:e}function KE(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=y==null?0:Qt(y);return U<0&&(U=Ve(E+U,0)),da(c,p,U)}function ZE(c){var p=c==null?0:c.length;return p?Zi(c,0,-1):[]}var JE=ie(function(c){var p=Ee(c,Bd);return p.length&&p[0]===c[0]?wd(p):[]}),QE=ie(function(c){var p=Ji(c),y=Ee(c,Bd);return p===Ji(y)?p=e:y.pop(),y.length&&y[0]===c[0]?wd(y,Gt(p,2)):[]}),tT=ie(function(c){var p=Ji(c),y=Ee(c,Bd);return p=typeof p=="function"?p:e,p&&y.pop(),y.length&&y[0]===c[0]?wd(y,e,p):[]});function eT(c,p){return c==null?"":Z1.call(c,p)}function Ji(c){var p=c==null?0:c.length;return p?c[p-1]:e}function iT(c,p,y){var E=c==null?0:c.length;if(!E)return-1;var U=E;return y!==e&&(U=Qt(y),U=U<0?Ve(E+U,0):ci(U,E-1)),p===p?L1(c,p,U):Ql(c,Dg,U,!0)}function rT(c,p){return c&&c.length?fm(c,Qt(p)):e}var nT=ie(ry);function ry(c,p){return c&&c.length&&p&&p.length?Ad(c,p):c}function sT(c,p,y){return c&&c.length&&p&&p.length?Ad(c,p,Gt(y,2)):c}function aT(c,p,y){return c&&c.length&&p&&p.length?Ad(c,p,e,y):c}var oT=on(function(c,p){var y=c==null?0:c.length,E=yd(c,p);return gm(c,Ee(p,function(U){return ln(U,y)?+U:U}).sort(Am)),E});function lT(c,p){var y=[];if(!(c&&c.length))return y;var E=-1,U=[],P=c.length;for(p=Gt(p,3);++E<P;){var D=c[E];p(D,E,c)&&(y.push(D),U.push(E))}return gm(c,U),y}function Xd(c){return c==null?c:eS.call(c)}function hT(c,p,y){var E=c==null?0:c.length;return E?(y&&typeof y!="number"&&vi(c,p,y)?(p=0,y=E):(p=p==null?0:Qt(p),y=y===e?E:Qt(y)),Zi(c,p,y)):[]}function uT(c,p){return vh(c,p)}function cT(c,p,y){return Id(c,p,Gt(y,2))}function dT(c,p){var y=c==null?0:c.length;if(y){var E=vh(c,p);if(E<y&&hr(c[E],p))return E}return-1}function fT(c,p){return vh(c,p,!0)}function pT(c,p,y){return Id(c,p,Gt(y,2),!0)}function _T(c,p){var y=c==null?0:c.length;if(y){var E=vh(c,p,!0)-1;if(hr(c[E],p))return E}return-1}function gT(c){return c&&c.length?ym(c):[]}function mT(c,p){return c&&c.length?ym(c,Gt(p,2)):[]}function yT(c){var p=c==null?0:c.length;return p?Zi(c,1,p):[]}function vT(c,p,y){return c&&c.length?(p=y||p===e?1:Qt(p),Zi(c,0,p<0?0:p)):[]}function xT(c,p,y){var E=c==null?0:c.length;return E?(p=y||p===e?1:Qt(p),p=E-p,Zi(c,p<0?0:p,E)):[]}function bT(c,p){return c&&c.length?xh(c,Gt(p,3),!1,!0):[]}function wT(c,p){return c&&c.length?xh(c,Gt(p,3)):[]}var ST=ie(function(c){return On(ri(c,1,ke,!0))}),ET=ie(function(c){var p=Ji(c);return ke(p)&&(p=e),On(ri(c,1,ke,!0),Gt(p,2))}),TT=ie(function(c){var p=Ji(c);return p=typeof p=="function"?p:e,On(ri(c,1,ke,!0),e,p)});function AT(c){return c&&c.length?On(c):[]}function CT(c,p){return c&&c.length?On(c,Gt(p,2)):[]}function UT(c,p){return p=typeof p=="function"?p:e,c&&c.length?On(c,e,p):[]}function Yd(c){if(!(c&&c.length))return[];var p=0;return c=Fn(c,function(y){if(ke(y))return p=Ve(y.length,p),!0}),ud(p,function(y){return Ee(c,od(y))})}function ny(c,p){if(!(c&&c.length))return[];var y=Yd(c);return p==null?y:Ee(y,function(E){return Bi(p,e,E)})}var IT=ie(function(c,p){return ke(c)?Vo(c,p):[]}),PT=ie(function(c){return Rd(Fn(c,ke))}),RT=ie(function(c){var p=Ji(c);return ke(p)&&(p=e),Rd(Fn(c,ke),Gt(p,2))}),BT=ie(function(c){var p=Ji(c);return p=typeof p=="function"?p:e,Rd(Fn(c,ke),e,p)}),FT=ie(Yd);function MT(c,p){return wm(c||[],p||[],$o)}function LT(c,p){return wm(c||[],p||[],Yo)}var DT=ie(function(c){var p=c.length,y=p>1?c[p-1]:e;return y=typeof y=="function"?(c.pop(),y):e,ny(c,y)});function sy(c){var p=I(c);return p.__chain__=!0,p}function kT(c,p){return p(c),c}function Ih(c,p){return p(c)}var OT=on(function(c){var p=c.length,y=p?c[0]:0,E=this.__wrapped__,U=function(P){return yd(P,c)};return p>1||this.__actions__.length||!(E instanceof se)||!ln(y)?this.thru(U):(E=E.slice(y,+y+(p?1:0)),E.__actions__.push({func:Ih,args:[U],thisArg:e}),new qi(E,this.__chain__).thru(function(P){return p&&!P.length&&P.push(e),P}))});function NT(){return sy(this)}function zT(){return new qi(this.value(),this.__chain__)}function GT(){this.__values__===e&&(this.__values__=vy(this.value()));var c=this.__index__>=this.__values__.length,p=c?e:this.__values__[this.__index__++];return{done:c,value:p}}function HT(){return this}function $T(c){for(var p,y=this;y instanceof ph;){var E=Jm(y);E.__index__=0,E.__values__=e,p?U.__wrapped__=E:p=E;var U=E;y=y.__wrapped__}return U.__wrapped__=c,p}function VT(){var c=this.__wrapped__;if(c instanceof se){var p=c;return this.__actions__.length&&(p=new se(this)),p=p.reverse(),p.__actions__.push({func:Ih,args:[Xd],thisArg:e}),new qi(p,this.__chain__)}return this.thru(Xd)}function WT(){return bm(this.__wrapped__,this.__actions__)}var XT=bh(function(c,p,y){_e.call(c,y)?++c[y]:sn(c,y,1)});function YT(c,p,y){var E=Kt(c)?Mg:kS;return y&&vi(c,p,y)&&(p=e),E(c,Gt(p,3))}function jT(c,p){var y=Kt(c)?Fn:nm;return y(c,Gt(p,3))}var qT=Bm(Qm),KT=Bm(ty);function ZT(c,p){return ri(Ph(c,p),1)}function JT(c,p){return ri(Ph(c,p),it)}function QT(c,p,y){return y=y===e?1:Qt(y),ri(Ph(c,p),y)}function ay(c,p){var y=Kt(c)?Yi:kn;return y(c,Gt(p,3))}function oy(c,p){var y=Kt(c)?y1:rm;return y(c,Gt(p,3))}var tA=bh(function(c,p,y){_e.call(c,y)?c[y].push(p):sn(c,y,[p])});function eA(c,p,y,E){c=Ti(c)?c:Ea(c),y=y&&!E?Qt(y):0;var U=c.length;return y<0&&(y=Ve(U+y,0)),Lh(c)?y<=U&&c.indexOf(p,y)>-1:!!U&&da(c,p,y)>-1}var iA=ie(function(c,p,y){var E=-1,U=typeof p=="function",P=Ti(c)?X(c.length):[];return kn(c,function(D){P[++E]=U?Bi(p,D,y):Wo(D,p,y)}),P}),rA=bh(function(c,p,y){sn(c,y,p)});function Ph(c,p){var y=Kt(c)?Ee:um;return y(c,Gt(p,3))}function nA(c,p,y,E){return c==null?[]:(Kt(p)||(p=p==null?[]:[p]),y=E?e:y,Kt(y)||(y=y==null?[]:[y]),pm(c,p,y))}var sA=bh(function(c,p,y){c[y?0:1].push(p)},function(){return[[],[]]});function aA(c,p,y){var E=Kt(c)?sd:Og,U=arguments.length<3;return E(c,Gt(p,4),y,U,kn)}function oA(c,p,y){var E=Kt(c)?v1:Og,U=arguments.length<3;return E(c,Gt(p,4),y,U,rm)}function lA(c,p){var y=Kt(c)?Fn:nm;return y(c,Fh(Gt(p,3)))}function hA(c){var p=Kt(c)?Qg:eE;return p(c)}function uA(c,p,y){(y?vi(c,p,y):p===e)?p=1:p=Qt(p);var E=Kt(c)?BS:iE;return E(c,p)}function cA(c){var p=Kt(c)?FS:nE;return p(c)}function dA(c){if(c==null)return 0;if(Ti(c))return Lh(c)?pa(c):c.length;var p=di(c);return p==Nt||p==mi?c.size:Ed(c).length}function fA(c,p,y){var E=Kt(c)?ad:sE;return y&&vi(c,p,y)&&(p=e),E(c,Gt(p,3))}var pA=ie(function(c,p){if(c==null)return[];var y=p.length;return y>1&&vi(c,p[0],p[1])?p=[]:y>2&&vi(p[0],p[1],p[2])&&(p=[p[0]]),pm(c,ri(p,1),[])}),Rh=j1||function(){return ii.Date.now()};function _A(c,p){if(typeof p!="function")throw new ji(d);return c=Qt(c),function(){if(--c<1)return p.apply(this,arguments)}}function ly(c,p,y){return p=y?e:p,p=c&&p==null?c.length:p,an(c,B,e,e,e,e,p)}function hy(c,p){var y;if(typeof p!="function")throw new ji(d);return c=Qt(c),function(){return--c>0&&(y=p.apply(this,arguments)),c<=1&&(p=e),y}}var jd=ie(function(c,p,y){var E=u;if(y.length){var U=Ln(y,wa(jd));E|=A}return an(c,E,p,y,U)}),uy=ie(function(c,p,y){var E=u|f;if(y.length){var U=Ln(y,wa(uy));E|=A}return an(p,E,c,y,U)});function cy(c,p,y){p=y?e:p;var E=an(c,x,e,e,e,e,e,p);return E.placeholder=cy.placeholder,E}function dy(c,p,y){p=y?e:p;var E=an(c,S,e,e,e,e,e,p);return E.placeholder=dy.placeholder,E}function fy(c,p,y){var E,U,P,D,O,V,tt=0,et=!1,st=!1,mt=!0;if(typeof c!="function")throw new ji(d);p=Qi(p)||0,Ce(y)&&(et=!!y.leading,st="maxWait"in y,P=st?Ve(Qi(y.maxWait)||0,p):P,mt="trailing"in y?!!y.trailing:mt);function Pt(Oe){var ur=E,cn=U;return E=U=e,tt=Oe,D=c.apply(cn,ur),D}function Ht(Oe){return tt=Oe,O=Ko(re,p),et?Pt(Oe):D}function te(Oe){var ur=Oe-V,cn=Oe-tt,By=p-ur;return st?ci(By,P-cn):By}function $t(Oe){var ur=Oe-V,cn=Oe-tt;return V===e||ur>=p||ur<0||st&&cn>=P}function re(){var Oe=Rh();if($t(Oe))return ae(Oe);O=Ko(re,te(Oe))}function ae(Oe){return O=e,mt&&E?Pt(Oe):(E=U=e,D)}function Di(){O!==e&&Sm(O),tt=0,E=V=U=O=e}function xi(){return O===e?D:ae(Rh())}function ki(){var Oe=Rh(),ur=$t(Oe);if(E=arguments,U=this,V=Oe,ur){if(O===e)return Ht(V);if(st)return Sm(O),O=Ko(re,p),Pt(V)}return O===e&&(O=Ko(re,p)),D}return ki.cancel=Di,ki.flush=xi,ki}var gA=ie(function(c,p){return im(c,1,p)}),mA=ie(function(c,p,y){return im(c,Qi(p)||0,y)});function yA(c){return an(c,M)}function Bh(c,p){if(typeof c!="function"||p!=null&&typeof p!="function")throw new ji(d);var y=function(){var E=arguments,U=p?p.apply(this,E):E[0],P=y.cache;if(P.has(U))return P.get(U);var D=c.apply(this,E);return y.cache=P.set(U,D)||P,D};return y.cache=new(Bh.Cache||nn),y}Bh.Cache=nn;function Fh(c){if(typeof c!="function")throw new ji(d);return function(){var p=arguments;switch(p.length){case 0:return!c.call(this);case 1:return!c.call(this,p[0]);case 2:return!c.call(this,p[0],p[1]);case 3:return!c.call(this,p[0],p[1],p[2])}return!c.apply(this,p)}}function vA(c){return hy(2,c)}var xA=aE(function(c,p){p=p.length==1&&Kt(p[0])?Ee(p[0],Fi(Gt())):Ee(ri(p,1),Fi(Gt()));var y=p.length;return ie(function(E){for(var U=-1,P=ci(E.length,y);++U<P;)E[U]=p[U].call(this,E[U]);return Bi(c,this,E)})}),qd=ie(function(c,p){var y=Ln(p,wa(qd));return an(c,A,e,p,y)}),py=ie(function(c,p){var y=Ln(p,wa(py));return an(c,C,e,p,y)}),bA=on(function(c,p){return an(c,R,e,e,e,p)});function wA(c,p){if(typeof c!="function")throw new ji(d);return p=p===e?p:Qt(p),ie(c,p)}function SA(c,p){if(typeof c!="function")throw new ji(d);return p=p==null?0:Ve(Qt(p),0),ie(function(y){var E=y[p],U=zn(y,0,p);return E&&Mn(U,E),Bi(c,this,U)})}function EA(c,p,y){var E=!0,U=!0;if(typeof c!="function")throw new ji(d);return Ce(y)&&(E="leading"in y?!!y.leading:E,U="trailing"in y?!!y.trailing:U),fy(c,p,{leading:E,maxWait:p,trailing:U})}function TA(c){return ly(c,1)}function AA(c,p){return qd(Fd(p),c)}function CA(){if(!arguments.length)return[];var c=arguments[0];return Kt(c)?c:[c]}function UA(c){return Ki(c,T)}function IA(c,p){return p=typeof p=="function"?p:e,Ki(c,T,p)}function PA(c){return Ki(c,w|T)}function RA(c,p){return p=typeof p=="function"?p:e,Ki(c,w|T,p)}function BA(c,p){return p==null||em(c,p,Ze(p))}function hr(c,p){return c===p||c!==c&&p!==p}var FA=Th(bd),MA=Th(function(c,p){return c>=p}),Ss=om(function(){return arguments}())?om:function(c){return Fe(c)&&_e.call(c,"callee")&&!Yg.call(c,"callee")},Kt=X.isArray,LA=Ug?Fi(Ug):$S;function Ti(c){return c!=null&&Mh(c.length)&&!hn(c)}function ke(c){return Fe(c)&&Ti(c)}function DA(c){return c===!0||c===!1||Fe(c)&&yi(c)==ht}var Gn=K1||of,kA=Ig?Fi(Ig):VS;function OA(c){return Fe(c)&&c.nodeType===1&&!Zo(c)}function NA(c){if(c==null)return!0;if(Ti(c)&&(Kt(c)||typeof c=="string"||typeof c.splice=="function"||Gn(c)||Sa(c)||Ss(c)))return!c.length;var p=di(c);if(p==Nt||p==mi)return!c.size;if(qo(c))return!Ed(c).length;for(var y in c)if(_e.call(c,y))return!1;return!0}function zA(c,p){return Xo(c,p)}function GA(c,p,y){y=typeof y=="function"?y:e;var E=y?y(c,p):e;return E===e?Xo(c,p,e,y):!!E}function Kd(c){if(!Fe(c))return!1;var p=yi(c);return p==dt||p==nt||typeof c.message=="string"&&typeof c.name=="string"&&!Zo(c)}function HA(c){return typeof c=="number"&&qg(c)}function hn(c){if(!Ce(c))return!1;var p=yi(c);return p==Xt||p==Ot||p==kt||p==Wc}function _y(c){return typeof c=="number"&&c==Qt(c)}function Mh(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=gt}function Ce(c){var p=typeof c;return c!=null&&(p=="object"||p=="function")}function Fe(c){return c!=null&&typeof c=="object"}var gy=Pg?Fi(Pg):XS;function $A(c,p){return c===p||Sd(c,p,zd(p))}function VA(c,p,y){return y=typeof y=="function"?y:e,Sd(c,p,zd(p),y)}function WA(c){return my(c)&&c!=+c}function XA(c){if(IE(c))throw new jt(h);return lm(c)}function YA(c){return c===null}function jA(c){return c==null}function my(c){return typeof c=="number"||Fe(c)&&yi(c)==Lt}function Zo(c){if(!Fe(c)||yi(c)!=Be)return!1;var p=oh(c);if(p===null)return!0;var y=_e.call(p,"constructor")&&p.constructor;return typeof y=="function"&&y instanceof y&&rh.call(y)==V1}var Zd=Rg?Fi(Rg):YS;function qA(c){return _y(c)&&c>=-9007199254740991&&c<=gt}var yy=Bg?Fi(Bg):jS;function Lh(c){return typeof c=="string"||!Kt(c)&&Fe(c)&&yi(c)==en}function Li(c){return typeof c=="symbol"||Fe(c)&&yi(c)==ha}var Sa=Fg?Fi(Fg):qS;function KA(c){return c===e}function ZA(c){return Fe(c)&&di(c)==pe}function JA(c){return Fe(c)&&yi(c)==Yc}var QA=Th(Td),tC=Th(function(c,p){return c<=p});function vy(c){if(!c)return[];if(Ti(c))return Lh(c)?or(c):Ei(c);if(Oo&&c[Oo])return B1(c[Oo]());var p=di(c),y=p==Nt?dd:p==mi?th:Ea;return y(c)}function un(c){if(!c)return c===0?c:0;if(c=Qi(c),c===it||c===-1/0){var p=c<0?-1:1;return p*Q}return c===c?c:0}function Qt(c){var p=un(c),y=p%1;return p===p?y?p-y:p:0}function xy(c){return c?vs(Qt(c),0,Z):0}function Qi(c){if(typeof c=="number")return c;if(Li(c))return rt;if(Ce(c)){var p=typeof c.valueOf=="function"?c.valueOf():c;c=Ce(p)?p+"":p}if(typeof c!="string")return c===0?c:+c;c=Ng(c);var y=Lw.test(c);return y||kw.test(c)?_1(c.slice(2),y?2:8):Mw.test(c)?rt:+c}function by(c){return Fr(c,Ai(c))}function eC(c){return c?vs(Qt(c),-9007199254740991,gt):c===0?c:0}function fe(c){return c==null?"":Mi(c)}var iC=xa(function(c,p){if(qo(p)||Ti(p)){Fr(p,Ze(p),c);return}for(var y in p)_e.call(p,y)&&$o(c,y,p[y])}),wy=xa(function(c,p){Fr(p,Ai(p),c)}),Dh=xa(function(c,p,y,E){Fr(p,Ai(p),c,E)}),rC=xa(function(c,p,y,E){Fr(p,Ze(p),c,E)}),nC=on(yd);function sC(c,p){var y=va(c);return p==null?y:tm(y,p)}var aC=ie(function(c,p){c=me(c);var y=-1,E=p.length,U=E>2?p[2]:e;for(U&&vi(p[0],p[1],U)&&(E=1);++y<E;)for(var P=p[y],D=Ai(P),O=-1,V=D.length;++O<V;){var tt=D[O],et=c[tt];(et===e||hr(et,ga[tt])&&!_e.call(c,tt))&&(c[tt]=P[tt])}return c}),oC=ie(function(c){return c.push(e,Nm),Bi(Sy,e,c)});function lC(c,p){return Lg(c,Gt(p,3),Br)}function hC(c,p){return Lg(c,Gt(p,3),xd)}function uC(c,p){return c==null?c:vd(c,Gt(p,3),Ai)}function cC(c,p){return c==null?c:sm(c,Gt(p,3),Ai)}function dC(c,p){return c&&Br(c,Gt(p,3))}function fC(c,p){return c&&xd(c,Gt(p,3))}function pC(c){return c==null?[]:mh(c,Ze(c))}function _C(c){return c==null?[]:mh(c,Ai(c))}function Jd(c,p,y){var E=c==null?e:xs(c,p);return E===e?y:E}function gC(c,p){return c!=null&&Hm(c,p,NS)}function Qd(c,p){return c!=null&&Hm(c,p,zS)}var mC=Mm(function(c,p,y){p!=null&&typeof p.toString!="function"&&(p=nh.call(p)),c[p]=y},ef(Ci)),yC=Mm(function(c,p,y){p!=null&&typeof p.toString!="function"&&(p=nh.call(p)),_e.call(c,p)?c[p].push(y):c[p]=[y]},Gt),vC=ie(Wo);function Ze(c){return Ti(c)?Jg(c):Ed(c)}function Ai(c){return Ti(c)?Jg(c,!0):KS(c)}function xC(c,p){var y={};return p=Gt(p,3),Br(c,function(E,U,P){sn(y,p(E,U,P),E)}),y}function bC(c,p){var y={};return p=Gt(p,3),Br(c,function(E,U,P){sn(y,U,p(E,U,P))}),y}var wC=xa(function(c,p,y){yh(c,p,y)}),Sy=xa(function(c,p,y,E){yh(c,p,y,E)}),SC=on(function(c,p){var y={};if(c==null)return y;var E=!1;p=Ee(p,function(P){return P=Nn(P,c),E||(E=P.length>1),P}),Fr(c,Od(c),y),E&&(y=Ki(y,w|b|T,mE));for(var U=p.length;U--;)Pd(y,p[U]);return y});function EC(c,p){return Ey(c,Fh(Gt(p)))}var TC=on(function(c,p){return c==null?{}:JS(c,p)});function Ey(c,p){if(c==null)return{};var y=Ee(Od(c),function(E){return[E]});return p=Gt(p),_m(c,y,function(E,U){return p(E,U[0])})}function AC(c,p,y){p=Nn(p,c);var E=-1,U=p.length;for(U||(U=1,c=e);++E<U;){var P=c==null?e:c[Mr(p[E])];P===e&&(E=U,P=y),c=hn(P)?P.call(c):P}return c}function CC(c,p,y){return c==null?c:Yo(c,p,y)}function UC(c,p,y,E){return E=typeof E=="function"?E:e,c==null?c:Yo(c,p,y,E)}var Ty=km(Ze),Ay=km(Ai);function IC(c,p,y){var E=Kt(c),U=E||Gn(c)||Sa(c);if(p=Gt(p,4),y==null){var P=c&&c.constructor;U?y=E?new P:[]:Ce(c)?y=hn(P)?va(oh(c)):{}:y={}}return(U?Yi:Br)(c,function(D,O,V){return p(y,D,O,V)}),y}function PC(c,p){return c==null?!0:Pd(c,p)}function RC(c,p,y){return c==null?c:xm(c,p,Fd(y))}function BC(c,p,y,E){return E=typeof E=="function"?E:e,c==null?c:xm(c,p,Fd(y),E)}function Ea(c){return c==null?[]:cd(c,Ze(c))}function FC(c){return c==null?[]:cd(c,Ai(c))}function MC(c,p,y){return y===e&&(y=p,p=e),y!==e&&(y=Qi(y),y=y===y?y:0),p!==e&&(p=Qi(p),p=p===p?p:0),vs(Qi(c),p,y)}function LC(c,p,y){return p=un(p),y===e?(y=p,p=0):y=un(y),c=Qi(c),GS(c,p,y)}function DC(c,p,y){if(y&&typeof y!="boolean"&&vi(c,p,y)&&(p=y=e),y===e&&(typeof p=="boolean"?(y=p,p=e):typeof c=="boolean"&&(y=c,c=e)),c===e&&p===e?(c=0,p=1):(c=un(c),p===e?(p=c,c=0):p=un(p)),c>p){var E=c;c=p,p=E}if(y||c%1||p%1){var U=Kg();return ci(c+U*(p-c+p1("1e-"+((U+"").length-1))),p)}return Cd(c,p)}var kC=ba(function(c,p,y){return p=p.toLowerCase(),c+(y?Cy(p):p)});function Cy(c){return tf(fe(c).toLowerCase())}function Uy(c){return c=fe(c),c&&c.replace(Nw,C1).replace(n1,"")}function OC(c,p,y){c=fe(c),p=Mi(p);var E=c.length;y=y===e?E:vs(Qt(y),0,E);var U=y;return y-=p.length,y>=0&&c.slice(y,U)==p}function NC(c){return c=fe(c),c&&Dt.test(c)?c.replace(J,U1):c}function zC(c){return c=fe(c),c&&Te.test(c)?c.replace(He,"\\$&"):c}var GC=ba(function(c,p,y){return c+(y?"-":"")+p.toLowerCase()}),HC=ba(function(c,p,y){return c+(y?" ":"")+p.toLowerCase()}),$C=Rm("toLowerCase");function VC(c,p,y){c=fe(c),p=Qt(p);var E=p?pa(c):0;if(!p||E>=p)return c;var U=(p-E)/2;return Eh(ch(U),y)+c+Eh(uh(U),y)}function WC(c,p,y){c=fe(c),p=Qt(p);var E=p?pa(c):0;return p&&E<p?c+Eh(p-E,y):c}function XC(c,p,y){c=fe(c),p=Qt(p);var E=p?pa(c):0;return p&&E<p?Eh(p-E,y)+c:c}function YC(c,p,y){return y||p==null?p=0:p&&(p=+p),tS(fe(c).replace(Ae,""),p||0)}function jC(c,p,y){return(y?vi(c,p,y):p===e)?p=1:p=Qt(p),Ud(fe(c),p)}function qC(){var c=arguments,p=fe(c[0]);return c.length<3?p:p.replace(c[1],c[2])}var KC=ba(function(c,p,y){return c+(y?"_":"")+p.toLowerCase()});function ZC(c,p,y){return y&&typeof y!="number"&&vi(c,p,y)&&(p=y=e),y=y===e?Z:y>>>0,y?(c=fe(c),c&&(typeof p=="string"||p!=null&&!Zd(p))&&(p=Mi(p),!p&&fa(c))?zn(or(c),0,y):c.split(p,y)):[]}var JC=ba(function(c,p,y){return c+(y?" ":"")+tf(p)});function QC(c,p,y){return c=fe(c),y=y==null?0:vs(Qt(y),0,c.length),p=Mi(p),c.slice(y,y+p.length)==p}function tU(c,p,y){var E=I.templateSettings;y&&vi(c,p,y)&&(p=e),c=fe(c),p=Dh({},p,E,Om);var U=Dh({},p.imports,E.imports,Om),P=Ze(U),D=cd(U,P),O,V,tt=0,et=p.interpolate||ql,st="__p += '",mt=fd((p.escape||ql).source+"|"+et.source+"|"+(et===zt?Fw:ql).source+"|"+(p.evaluate||ql).source+"|$","g"),Pt="//# sourceURL="+(_e.call(p,"sourceURL")?(p.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++h1+"]")+`
`;c.replace(mt,function($t,re,ae,Di,xi,ki){return ae||(ae=Di),st+=c.slice(tt,ki).replace(zw,I1),re&&(O=!0,st+=`' +
__e(`+re+`) +
'`),xi&&(V=!0,st+=`';
`+xi+`;
__p += '`),ae&&(st+=`' +
((__t = (`+ae+`)) == null ? '' : __t) +
'`),tt=ki+$t.length,$t}),st+=`';
`;var Ht=_e.call(p,"variable")&&p.variable;if(!Ht)st=`with (obj) {
`+st+`
}
`;else if(Rw.test(Ht))throw new jt(l);st=(V?st.replace(jc,""):st).replace(qc,"$1").replace(Kc,"$1;"),st="function("+(Ht||"obj")+`) {
`+(Ht?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(O?", __e = _.escape":"")+(V?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+st+`return __p
}`;var te=Py(function(){return de(P,Pt+"return "+st).apply(e,D)});if(te.source=st,Kd(te))throw te;return te}function eU(c){return fe(c).toLowerCase()}function iU(c){return fe(c).toUpperCase()}function rU(c,p,y){if(c=fe(c),c&&(y||p===e))return Ng(c);if(!c||!(p=Mi(p)))return c;var E=or(c),U=or(p),P=zg(E,U),D=Gg(E,U)+1;return zn(E,P,D).join("")}function nU(c,p,y){if(c=fe(c),c&&(y||p===e))return c.slice(0,$g(c)+1);if(!c||!(p=Mi(p)))return c;var E=or(c),U=Gg(E,or(p))+1;return zn(E,0,U).join("")}function sU(c,p,y){if(c=fe(c),c&&(y||p===e))return c.replace(Ae,"");if(!c||!(p=Mi(p)))return c;var E=or(c),U=zg(E,or(p));return zn(E,U).join("")}function aU(c,p){var y=N,E=L;if(Ce(p)){var U="separator"in p?p.separator:U;y="length"in p?Qt(p.length):y,E="omission"in p?Mi(p.omission):E}c=fe(c);var P=c.length;if(fa(c)){var D=or(c);P=D.length}if(y>=P)return c;var O=y-pa(E);if(O<1)return E;var V=D?zn(D,0,O).join(""):c.slice(0,O);if(U===e)return V+E;if(D&&(O+=V.length-O),Zd(U)){if(c.slice(O).search(U)){var tt,et=V;for(U.global||(U=fd(U.source,fe(og.exec(U))+"g")),U.lastIndex=0;tt=U.exec(et);)var st=tt.index;V=V.slice(0,st===e?O:st)}}else if(c.indexOf(Mi(U),O)!=O){var mt=V.lastIndexOf(U);mt>-1&&(V=V.slice(0,mt))}return V+E}function oU(c){return c=fe(c),c&&pt.test(c)?c.replace(Yl,D1):c}var lU=ba(function(c,p,y){return c+(y?" ":"")+p.toUpperCase()}),tf=Rm("toUpperCase");function Iy(c,p,y){return c=fe(c),p=y?e:p,p===e?R1(c)?N1(c):w1(c):c.match(p)||[]}var Py=ie(function(c,p){try{return Bi(c,e,p)}catch(y){return Kd(y)?y:new jt(y)}}),hU=on(function(c,p){return Yi(p,function(y){y=Mr(y),sn(c,y,jd(c[y],c))}),c});function uU(c){var p=c==null?0:c.length,y=Gt();return c=p?Ee(c,function(E){if(typeof E[1]!="function")throw new ji(d);return[y(E[0]),E[1]]}):[],ie(function(E){for(var U=-1;++U<p;){var P=c[U];if(Bi(P[0],this,E))return Bi(P[1],this,E)}})}function cU(c){return DS(Ki(c,w))}function ef(c){return function(){return c}}function dU(c,p){return c==null||c!==c?p:c}var fU=Fm(),pU=Fm(!0);function Ci(c){return c}function rf(c){return hm(typeof c=="function"?c:Ki(c,w))}function _U(c){return cm(Ki(c,w))}function gU(c,p){return dm(c,Ki(p,w))}var mU=ie(function(c,p){return function(y){return Wo(y,c,p)}}),yU=ie(function(c,p){return function(y){return Wo(c,y,p)}});function nf(c,p,y){var E=Ze(p),U=mh(p,E);y==null&&!(Ce(p)&&(U.length||!E.length))&&(y=p,p=c,c=this,U=mh(p,Ze(p)));var P=!(Ce(y)&&"chain"in y)||!!y.chain,D=hn(c);return Yi(U,function(O){var V=p[O];c[O]=V,D&&(c.prototype[O]=function(){var tt=this.__chain__;if(P||tt){var et=c(this.__wrapped__),st=et.__actions__=Ei(this.__actions__);return st.push({func:V,args:arguments,thisArg:c}),et.__chain__=tt,et}return V.apply(c,Mn([this.value()],arguments))})}),c}function vU(){return ii._===this&&(ii._=W1),this}function sf(){}function xU(c){return c=Qt(c),ie(function(p){return fm(p,c)})}var bU=Ld(Ee),wU=Ld(Mg),SU=Ld(ad);function Ry(c){return Hd(c)?od(Mr(c)):QS(c)}function EU(c){return function(p){return c==null?e:xs(c,p)}}var TU=Lm(),AU=Lm(!0);function af(){return[]}function of(){return!1}function CU(){return{}}function UU(){return""}function IU(){return!0}function PU(c,p){if(c=Qt(c),c<1||c>gt)return[];var y=Z,E=ci(c,Z);p=Gt(p),c-=Z;for(var U=ud(E,p);++y<c;)p(y);return U}function RU(c){return Kt(c)?Ee(c,Mr):Li(c)?[c]:Ei(Zm(fe(c)))}function BU(c){var p=++$1;return fe(c)+p}var FU=Sh(function(c,p){return c+p},0),MU=Dd("ceil"),LU=Sh(function(c,p){return c/p},1),DU=Dd("floor");function kU(c){return c&&c.length?gh(c,Ci,bd):e}function OU(c,p){return c&&c.length?gh(c,Gt(p,2),bd):e}function NU(c){return kg(c,Ci)}function zU(c,p){return kg(c,Gt(p,2))}function GU(c){return c&&c.length?gh(c,Ci,Td):e}function HU(c,p){return c&&c.length?gh(c,Gt(p,2),Td):e}var $U=Sh(function(c,p){return c*p},1),VU=Dd("round"),WU=Sh(function(c,p){return c-p},0);function XU(c){return c&&c.length?hd(c,Ci):0}function YU(c,p){return c&&c.length?hd(c,Gt(p,2)):0}return I.after=_A,I.ary=ly,I.assign=iC,I.assignIn=wy,I.assignInWith=Dh,I.assignWith=rC,I.at=nC,I.before=hy,I.bind=jd,I.bindAll=hU,I.bindKey=uy,I.castArray=CA,I.chain=sy,I.chunk=DE,I.compact=kE,I.concat=OE,I.cond=uU,I.conforms=cU,I.constant=ef,I.countBy=XT,I.create=sC,I.curry=cy,I.curryRight=dy,I.debounce=fy,I.defaults=aC,I.defaultsDeep=oC,I.defer=gA,I.delay=mA,I.difference=NE,I.differenceBy=zE,I.differenceWith=GE,I.drop=HE,I.dropRight=$E,I.dropRightWhile=VE,I.dropWhile=WE,I.fill=XE,I.filter=jT,I.flatMap=ZT,I.flatMapDeep=JT,I.flatMapDepth=QT,I.flatten=ey,I.flattenDeep=YE,I.flattenDepth=jE,I.flip=yA,I.flow=fU,I.flowRight=pU,I.fromPairs=qE,I.functions=pC,I.functionsIn=_C,I.groupBy=tA,I.initial=ZE,I.intersection=JE,I.intersectionBy=QE,I.intersectionWith=tT,I.invert=mC,I.invertBy=yC,I.invokeMap=iA,I.iteratee=rf,I.keyBy=rA,I.keys=Ze,I.keysIn=Ai,I.map=Ph,I.mapKeys=xC,I.mapValues=bC,I.matches=_U,I.matchesProperty=gU,I.memoize=Bh,I.merge=wC,I.mergeWith=Sy,I.method=mU,I.methodOf=yU,I.mixin=nf,I.negate=Fh,I.nthArg=xU,I.omit=SC,I.omitBy=EC,I.once=vA,I.orderBy=nA,I.over=bU,I.overArgs=xA,I.overEvery=wU,I.overSome=SU,I.partial=qd,I.partialRight=py,I.partition=sA,I.pick=TC,I.pickBy=Ey,I.property=Ry,I.propertyOf=EU,I.pull=nT,I.pullAll=ry,I.pullAllBy=sT,I.pullAllWith=aT,I.pullAt=oT,I.range=TU,I.rangeRight=AU,I.rearg=bA,I.reject=lA,I.remove=lT,I.rest=wA,I.reverse=Xd,I.sampleSize=uA,I.set=CC,I.setWith=UC,I.shuffle=cA,I.slice=hT,I.sortBy=pA,I.sortedUniq=gT,I.sortedUniqBy=mT,I.split=ZC,I.spread=SA,I.tail=yT,I.take=vT,I.takeRight=xT,I.takeRightWhile=bT,I.takeWhile=wT,I.tap=kT,I.throttle=EA,I.thru=Ih,I.toArray=vy,I.toPairs=Ty,I.toPairsIn=Ay,I.toPath=RU,I.toPlainObject=by,I.transform=IC,I.unary=TA,I.union=ST,I.unionBy=ET,I.unionWith=TT,I.uniq=AT,I.uniqBy=CT,I.uniqWith=UT,I.unset=PC,I.unzip=Yd,I.unzipWith=ny,I.update=RC,I.updateWith=BC,I.values=Ea,I.valuesIn=FC,I.without=IT,I.words=Iy,I.wrap=AA,I.xor=PT,I.xorBy=RT,I.xorWith=BT,I.zip=FT,I.zipObject=MT,I.zipObjectDeep=LT,I.zipWith=DT,I.entries=Ty,I.entriesIn=Ay,I.extend=wy,I.extendWith=Dh,nf(I,I),I.add=FU,I.attempt=Py,I.camelCase=kC,I.capitalize=Cy,I.ceil=MU,I.clamp=MC,I.clone=UA,I.cloneDeep=PA,I.cloneDeepWith=RA,I.cloneWith=IA,I.conformsTo=BA,I.deburr=Uy,I.defaultTo=dU,I.divide=LU,I.endsWith=OC,I.eq=hr,I.escape=NC,I.escapeRegExp=zC,I.every=YT,I.find=qT,I.findIndex=Qm,I.findKey=lC,I.findLast=KT,I.findLastIndex=ty,I.findLastKey=hC,I.floor=DU,I.forEach=ay,I.forEachRight=oy,I.forIn=uC,I.forInRight=cC,I.forOwn=dC,I.forOwnRight=fC,I.get=Jd,I.gt=FA,I.gte=MA,I.has=gC,I.hasIn=Qd,I.head=iy,I.identity=Ci,I.includes=eA,I.indexOf=KE,I.inRange=LC,I.invoke=vC,I.isArguments=Ss,I.isArray=Kt,I.isArrayBuffer=LA,I.isArrayLike=Ti,I.isArrayLikeObject=ke,I.isBoolean=DA,I.isBuffer=Gn,I.isDate=kA,I.isElement=OA,I.isEmpty=NA,I.isEqual=zA,I.isEqualWith=GA,I.isError=Kd,I.isFinite=HA,I.isFunction=hn,I.isInteger=_y,I.isLength=Mh,I.isMap=gy,I.isMatch=$A,I.isMatchWith=VA,I.isNaN=WA,I.isNative=XA,I.isNil=jA,I.isNull=YA,I.isNumber=my,I.isObject=Ce,I.isObjectLike=Fe,I.isPlainObject=Zo,I.isRegExp=Zd,I.isSafeInteger=qA,I.isSet=yy,I.isString=Lh,I.isSymbol=Li,I.isTypedArray=Sa,I.isUndefined=KA,I.isWeakMap=ZA,I.isWeakSet=JA,I.join=eT,I.kebabCase=GC,I.last=Ji,I.lastIndexOf=iT,I.lowerCase=HC,I.lowerFirst=$C,I.lt=QA,I.lte=tC,I.max=kU,I.maxBy=OU,I.mean=NU,I.meanBy=zU,I.min=GU,I.minBy=HU,I.stubArray=af,I.stubFalse=of,I.stubObject=CU,I.stubString=UU,I.stubTrue=IU,I.multiply=$U,I.nth=rT,I.noConflict=vU,I.noop=sf,I.now=Rh,I.pad=VC,I.padEnd=WC,I.padStart=XC,I.parseInt=YC,I.random=DC,I.reduce=aA,I.reduceRight=oA,I.repeat=jC,I.replace=qC,I.result=AC,I.round=VU,I.runInContext=z,I.sample=hA,I.size=dA,I.snakeCase=KC,I.some=fA,I.sortedIndex=uT,I.sortedIndexBy=cT,I.sortedIndexOf=dT,I.sortedLastIndex=fT,I.sortedLastIndexBy=pT,I.sortedLastIndexOf=_T,I.startCase=JC,I.startsWith=QC,I.subtract=WU,I.sum=XU,I.sumBy=YU,I.template=tU,I.times=PU,I.toFinite=un,I.toInteger=Qt,I.toLength=xy,I.toLower=eU,I.toNumber=Qi,I.toSafeInteger=eC,I.toString=fe,I.toUpper=iU,I.trim=rU,I.trimEnd=nU,I.trimStart=sU,I.truncate=aU,I.unescape=oU,I.uniqueId=BU,I.upperCase=lU,I.upperFirst=tf,I.each=ay,I.eachRight=oy,I.first=iy,nf(I,function(){var c={};return Br(I,function(p,y){_e.call(I.prototype,y)||(c[y]=p)}),c}(),{chain:!1}),I.VERSION=n,Yi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(c){I[c].placeholder=I}),Yi(["drop","take"],function(c,p){se.prototype[c]=function(y){y=y===e?1:Ve(Qt(y),0);var E=this.__filtered__&&!p?new se(this):this.clone();return E.__filtered__?E.__takeCount__=ci(y,E.__takeCount__):E.__views__.push({size:ci(y,Z),type:c+(E.__dir__<0?"Right":"")}),E},se.prototype[c+"Right"]=function(y){return this.reverse()[c](y).reverse()}}),Yi(["filter","map","takeWhile"],function(c,p){var y=p+1,E=y==j||y==ut;se.prototype[c]=function(U){var P=this.clone();return P.__iteratees__.push({iteratee:Gt(U,3),type:y}),P.__filtered__=P.__filtered__||E,P}}),Yi(["head","last"],function(c,p){var y="take"+(p?"Right":"");se.prototype[c]=function(){return this[y](1).value()[0]}}),Yi(["initial","tail"],function(c,p){var y="drop"+(p?"":"Right");se.prototype[c]=function(){return this.__filtered__?new se(this):this[y](1)}}),se.prototype.compact=function(){return this.filter(Ci)},se.prototype.find=function(c){return this.filter(c).head()},se.prototype.findLast=function(c){return this.reverse().find(c)},se.prototype.invokeMap=ie(function(c,p){return typeof c=="function"?new se(this):this.map(function(y){return Wo(y,c,p)})}),se.prototype.reject=function(c){return this.filter(Fh(Gt(c)))},se.prototype.slice=function(c,p){c=Qt(c);var y=this;return y.__filtered__&&(c>0||p<0)?new se(y):(c<0?y=y.takeRight(-c):c&&(y=y.drop(c)),p!==e&&(p=Qt(p),y=p<0?y.dropRight(-p):y.take(p-c)),y)},se.prototype.takeRightWhile=function(c){return this.reverse().takeWhile(c).reverse()},se.prototype.toArray=function(){return this.take(Z)},Br(se.prototype,function(c,p){var y=/^(?:filter|find|map|reject)|While$/.test(p),E=/^(?:head|last)$/.test(p),U=I[E?"take"+(p=="last"?"Right":""):p],P=E||/^find/.test(p);U&&(I.prototype[p]=function(){var D=this.__wrapped__,O=E?[1]:arguments,V=D instanceof se,tt=O[0],et=V||Kt(D),st=function(re){var ae=U.apply(I,Mn([re],O));return E&&mt?ae[0]:ae};et&&y&&typeof tt=="function"&&tt.length!=1&&(V=et=!1);var mt=this.__chain__,Pt=!!this.__actions__.length,Ht=P&&!mt,te=V&&!Pt;if(!P&&et){D=te?D:new se(this);var $t=c.apply(D,O);return $t.__actions__.push({func:Ih,args:[st],thisArg:e}),new qi($t,mt)}return Ht&&te?c.apply(this,O):($t=this.thru(st),Ht?E?$t.value()[0]:$t.value():$t)})}),Yi(["pop","push","shift","sort","splice","unshift"],function(c){var p=eh[c],y=/^(?:push|sort|unshift)$/.test(c)?"tap":"thru",E=/^(?:pop|shift)$/.test(c);I.prototype[c]=function(){var U=arguments;if(E&&!this.__chain__){var P=this.value();return p.apply(Kt(P)?P:[],U)}return this[y](function(D){return p.apply(Kt(D)?D:[],U)})}}),Br(se.prototype,function(c,p){var y=I[p];if(y){var E=y.name+"";_e.call(ya,E)||(ya[E]=[]),ya[E].push({name:p,func:y})}}),ya[wh(e,f).name]=[{name:"wrapper",func:e}],se.prototype.clone=oS,se.prototype.reverse=lS,se.prototype.value=hS,I.prototype.at=OT,I.prototype.chain=NT,I.prototype.commit=zT,I.prototype.next=GT,I.prototype.plant=$T,I.prototype.reverse=VT,I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=WT,I.prototype.first=I.prototype.head,Oo&&(I.prototype[Oo]=HT),I},_a=z1();_s?((_s.exports=_a)._=_a,id._=_a):ii._=_a}).call(qr)})(Ac,Ac.exports);var Iw=Ac.exports;const UN={class:"w-full h-full bg-[#201f20] relative overflow-hidden select-none"},IN={class:"flex justify-between items-center px-4 py-2"},PN={class:"flex items-center gap-4"},RN={class:"text-white hover:text-purple-500 transition-colors"},BN={class:"flex items-center gap-2"},FN={class:"text-white min-w-[50px] text-center"},MN={class:"flex items-center gap-2"},LN={key:0,class:"absolute w-[10%] left-0 top-0 inset-0 flex flex-col items-center justify-center"},up="track-zoom-value",W0=3,Wn=150,DN=30,X0=5,cp=15,kN=hi({__name:"clipTrack",props:{tracks:{},maxTracksNum:{},currentTime:{},timelineDuration:{}},emits:["resetTrack","stopPlay","timeUpdate","refreshPlayer","add-clip","activeClip","delete-empty-track","handleExport","update:tracks"],setup(s,{expose:t,emit:e}){const n=s,o=e,h=De(()=>W0*d.value*10),d=Tt(parseFloat(localStorage.getItem(up)||"1")),l=()=>{d.value<5&&(d.value<1?d.value=Math.min(5,Math.round((d.value+.1)*10)/10):d.value=Math.min(5,Math.floor(d.value+1)),localStorage.setItem(up,d.value.toString()))},_=()=>{d.value>.3&&(d.value<=1?d.value=Math.max(.3,Math.round((d.value-.1)*10)/10):d.value=Math.max(1,Math.floor(d.value-1)),localStorage.setItem(up,d.value.toString()))},m=De(()=>n.timelineDuration*h.value),v=Tt(null),w=Tt(-1),b=Tt(!1),T=Tt(0),r=Tt(0),a=Tt(null),u=Tt(0),f=Tt(0),g=Tt(null),x=Tt(15),S=Tt(null),A=Tt([]),C=Tt(!1),B=Tt(null),R=Tt(null),M=sa(),N=J=>{J.preventDefault();const pt=J.currentTarget.getBoundingClientRect(),Dt=J.clientX-pt.left,It=J.target.closest("[data-track]"),zt=It==null?void 0:It.getAttribute("data-track");if(!M.getDragData)return;const ge=Dt/h.value;try{if(zt){const ze=n.tracks.find(He=>He.id===zt);if(ze){const He=n.tracks.indexOf(ze),Te=ze.clips.find(Ae=>ge>=Ae.startTime&&ge<=Ae.endTime);Te?(C.value=!0,R.value=Te,T.value=Te.startTime*h.value,w.value=He):(R.value=null,T.value=ge*h.value,w.value=He)}}else R.value=null,T.value=ge*h.value,w.value=-1}catch(ze){console.error("DragOver error:",ze)}},L=J=>{const pt=J.currentTarget.getBoundingClientRect(),Dt=J.clientX,Mt=J.clientY;(Dt<pt.left||Dt>pt.right||Mt<pt.top||Mt>pt.bottom)&&(W(),b.value=!1,w.value=-1)},W=()=>{S.value&&w.value>=0&&(n.tracks[w.value].clips.forEach(pt=>{const Dt=S.value.find(Mt=>Mt.id===pt.id);Dt&&(pt.startTime=Dt.startTime)}),S.value=null,A.value=[])},k=async J=>{J.preventDefault();const pt=J.currentTarget.getBoundingClientRect(),Mt=(J.clientX-pt.left)/h.value,It=M.getDragData;if(!It)return;const zt={...It,id:as(),rect:null,opacity:100,volume:100,startTime:C.value&&R.value?Number(R.value.startTime):Mt,duration:Number((It.duration||5*1e6)/1e6),selected:!1,sourceStartTime:0,sourceEndTime:0,originalDuration:Number((It.duration||5*1e6)/1e6)};if(zt.endTime=zt.startTime+zt.duration,zt.type==="video"||zt.type==="image"){const Yt=await U_(zt);Yt.type==="video"?zt.thumbnail=Yt.data:Yt.type==="image"&&(zt.thumbnail=[{timestamp:0,url:URL.createObjectURL(Yt.data)}])}else if(zt.type==="audio"){const Yt=await I_(zt);Yt.type==="audio"&&(zt.volumeData=Yt.data)}else zt.type==="text"&&(zt.textConfig={content:"Hello, World!",fontSize:24,fontFamily:"Arial",color:"#000000",x:10,y:10,width:100,height:100});if(w.value>=0){const Yt=n.tracks[w.value];Yt.clips.push(zt),Yt.clips.sort((ge,ze)=>ge.startTime-ze.startTime)}else if(n.tracks.length<n.maxTracksNum)n.tracks.push({id:as(),clips:[zt]});else{Zs.warning("轨道数量已达到最大限制("+n.maxTracksNum+")");return}j(n.tracks[w.value],zt),o("add-clip",zt),ut(),Pr(),M.clearDragData()},j=(J,pt)=>{if(!J||(J==null?void 0:J.clips.length)===0)return;const Dt=J.clips.filter(It=>It.endTime>pt.startTime&&It.startTime<pt.startTime);if(Dt.length!==0&&Nt.value==="other")pt.startTime=Dt[0].endTime,pt.endTime=pt.startTime+pt.duration;else if(Dt.length!==0&&Nt.value==="same")if(n.tracks.length<n.maxTracksNum){const It={id:as(),clips:[pt]},zt=n.tracks.findIndex(Yt=>Yt.id===J.id);n.tracks.splice(zt+1,0,It),J.clips=J.clips.filter(Yt=>Yt.id!==pt.id)}else return pt.startTime=Dt[0].endTime,pt.endTime=pt.startTime+pt.duration,Zs.warning(`轨道数量已达到最大限制(${n.maxTracksNum})`);const Mt=J.clips.filter(It=>It.id!==pt.id&&It.startTime>=pt.startTime).sort((It,zt)=>It.startTime-zt.startTime);if(Mt.length!==0&&Mt[0].startTime<pt.endTime){let It=pt.endTime;Mt.forEach(zt=>{const Yt=zt.endTime-zt.startTime;zt.startTime=It,zt.endTime=zt.startTime+Yt,It=zt.endTime})}},Y=J=>{var pt;(pt=v.value)==null||pt.activeClip(J),Q.value=J},ut=()=>{C.value=!1,B.value=null,R.value=null,b.value=!1,w.value=-1,T.value=0},it=J=>{w.value=J},gt=J=>{w.value===J&&(w.value=-1)},Q=Tt(null),rt=Tt(!1),Z=Tt(null),H=Tt(0),G=Tt(0),at=Tt(0),vt=J=>{Q.value||(Q.value=J)},At=(J,pt,Dt)=>{J.stopPropagation(),rt.value=!0,Z.value=Dt,Q.value=pt,H.value=J.clientX,G.value=Number(pt.startTime),at.value=Number(pt.endTime),pt.originalDuration||(pt.originalDuration=pt.duration),document.addEventListener("mousemove",ht),document.addEventListener("mouseup",q)},kt=De(()=>DN/h.value),ht=J=>{if(!rt.value||!Q.value)return;J.preventDefault(),J.stopPropagation();const pt=pe.value.getBoundingClientRect(),Mt=(J.clientX-pt.left+pe.value.scrollLeft)/h.value;if(Q.value.type==="video"||Q.value.type==="audio"){const It=Number(Q.value.originalDuration);if(Z.value==="left"){const zt=Number(Q.value.endTime),Yt=Number(Q.value.sourceEndTime),ge=zt-kt.value,ze=Math.min(Math.max(0,Mt),ge),He=zt-ze,Te=It-(Yt+He);Te>=0&&Te+Yt<=It&&(Q.value.startTime=ze,Q.value.duration=He,Q.value.sourceStartTime=Te)}else if(Z.value==="right"){const zt=Number(Q.value.startTime),Yt=Number(Q.value.sourceStartTime),ge=zt+kt.value,ze=zt+(It-Yt),He=Math.min(Math.max(ge,Mt),ze),Te=He-zt,Ae=It-(Yt+Te);Ae>=0&&Yt+Te<=It&&(Q.value.endTime=He,Q.value.duration=Te,Q.value.sourceEndTime=Ae)}}else if(Z.value==="left"){const It=Number(Q.value.endTime),zt=It-kt.value,Yt=Math.min(Math.max(0,Mt),zt),ge=It-Yt;Q.value.startTime=Yt,Q.value.duration=ge}else if(Z.value==="right"){const It=Number(Q.value.startTime),zt=It+kt.value,Yt=Math.max(zt,Mt),ge=Yt-It;Q.value.endTime=Yt,Q.value.duration=ge}},q=()=>{if(rt.value&&Q.value){const J=Number(Q.value.startTime),pt=Number(Q.value.duration);Q.value.endTime=J+pt,Q.value.startTime=J,Q.value.duration=pt,Q.value.sourceStartTime=Number(Q.value.sourceStartTime),Q.value.sourceEndTime=Number(Q.value.sourceEndTime),Q.value.originalDuration=Number(Q.value.originalDuration),M.publishClipUpdate(Q.value,"resize")}rt.value=!1,Z.value=null,Pr(),document.removeEventListener("mousemove",ht),document.removeEventListener("mouseup",q)},nt=Tt({x:0,y:0}),dt=Tt(""),Xt=(J,pt,Dt)=>{if(rt.value)return;Dt.preventDefault(),Dt.stopPropagation(),Q.value=J;const Mt=pe.value.getBoundingClientRect(),zt=(Dt.clientX-Mt.left+pe.value.scrollLeft)/h.value;nt.value={x:Dt.clientX,y:Dt.clientY},dt.value=pt;const Yt=ze=>{const He=Math.abs(ze.clientX-nt.value.x),Te=Math.abs(ze.clientY-nt.value.y);(He>X0||Te>X0)&&(document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",ge),Wc(J,Dt))},ge=()=>{document.removeEventListener("mousemove",Yt),document.removeEventListener("mouseup",ge),console.log("handleClipMouseDown",J),o("activeClip",J),o("timeUpdate",zt)};document.addEventListener("mousemove",Yt),document.addEventListener("mouseup",ge)},Ot=Tt(!1),Nt=Tt(null),Lt=Tt(null),ce=Tt(0),Be=Tt(!1),gi=Tt(null),Wc=(J,pt)=>{if(!pe.value)return;Ot.value=!0,Lt.value=J,Q.value=J,J.selected=!0;const Dt=pe.value.getBoundingClientRect(),Mt=Number(J.startTime)*h.value+Dt.left-pe.value.scrollLeft;ce.value=pt.clientX-Mt,u.value=pt.clientX,window.addEventListener("mousemove",mi,{capture:!0,passive:!1}),window.addEventListener("mouseup",en,{capture:!0}),Vi()},Vi=()=>{if(!Ot.value||!Lt.value||!pe.value)return;const J=pe.value.getBoundingClientRect();let pt=0,Dt=!1;if(a.value==="right"){const It=1-(J.right-u.value)/Wn;pt=Math.max(1,Math.round(x.value*It)),pe.value.scrollLeft+=pt,Dt=!0}else if(a.value==="left"){const It=1-(u.value-J.left)/Wn;pt=Math.max(1,Math.round(x.value*It)),pe.value.scrollLeft-=pt,Dt=!0}else if(a.value==="up"){const It=1-(f.value-J.top)/Wn;pt=Math.max(1,Math.round(x.value*It)),pe.value.scrollTop-=pt,Dt=!0}else if(a.value==="down"){const It=1-(J.bottom-f.value)/Wn;pt=Math.max(1,Math.round(x.value*It)),pe.value.scrollTop+=pt,Dt=!0}if(Dt){const It=u.value-J.left+pe.value.scrollLeft-ce.value,zt=Math.max(0,It/h.value),Yt=Number(Lt.value.duration);Lt.value.startTime=zt,Lt.value.endTime=zt+Yt}if(a.value){const Mt=requestAnimationFrame(Vi);g.value=Mt}},mi=J=>{var He;if(!Ot.value||!Lt.value||!pe.value)return;J.preventDefault(),J.stopPropagation(),u.value=J.clientX,f.value=J.clientY;const pt=document.elementFromPoint(J.clientX,J.clientY),Dt=pt==null?void 0:pt.getAttribute("data-clip");let Mt=null;Dt?Mt=(He=pt==null?void 0:pt.parentElement)==null?void 0:He.getAttribute("data-track"):Mt=pt==null?void 0:pt.getAttribute("data-track");const It=pe.value.getBoundingClientRect(),Yt=J.clientX-It.left+pe.value.scrollLeft-ce.value,ge=Number(Lt.value.duration),ze=Mt?n.tracks.find(Te=>Te.id===Mt):null;if(ze){const Te=ze.clips.filter(Ae=>Ae.id!==Lt.value.id).sort((Ae,ui)=>Number(Ae.startTime)-Number(ui.startTime));if(Be.value&&gi.value!==null)if(Math.abs(Yt-gi.value)>cp/2)Be.value=!1,gi.value=null;else{const ui=gi.value/h.value;Lt.value.startTime=ui,Lt.value.endTime=ui+ge;return}for(const Ae of Te){const ui=Number(Ae.startTime)*h.value,Rr=Number(Ae.endTime)*h.value;if(Math.abs(Yt-Rr)<=cp){Be.value=!0,gi.value=Rr,Lt.value.startTime=Rr/h.value,Lt.value.endTime=Rr/h.value+ge;return}if(Math.abs(Yt+ge*h.value-ui)<=cp){Be.value=!0,gi.value=ui-ge*h.value,Lt.value.startTime=ui/h.value-ge,Lt.value.endTime=ui/h.value;return}}}if(Lt.value.startTime=Math.max(0,Yt/h.value),Lt.value.endTime=Math.max(ge,Yt/h.value+ge),Mt&&Mt!==dt.value){const Te=n.tracks.findIndex(Ae=>Ae.id===Mt);if(Te!==-1){const Ae=n.tracks.find(ui=>ui.id===dt.value);if(Ae){const ui=Ae.clips.findIndex(Rr=>Rr.id===Lt.value.id);ui!==-1&&(Ae.clips.splice(ui,1),n.tracks[Te].clips.push(Lt.value),n.tracks[Te].clips.sort((Rr,jl)=>Number(Rr.startTime)-Number(jl.startTime)),dt.value=Mt)}}Nt.value="other"}else Nt.value="same";J.clientX>It.right-Wn?a.value!=="right"&&(a.value="right",Vi()):J.clientX<It.left+Wn?a.value!=="left"&&(a.value="left",Vi()):J.clientY<It.top+Wn?a.value!=="up"&&(a.value="up",Vi()):J.clientY>It.bottom-Wn?a.value!=="down"&&(a.value="down",Vi()):a.value!==null&&(a.value=null)},en=J=>{if(!Ot.value||!Lt.value)return;J&&(J.preventDefault(),J.stopPropagation()),Be.value=!1,gi.value=null,g.value!==null&&(cancelAnimationFrame(g.value),g.value=null),Lt.value.selected=!0,Q.value=Lt.value;const pt=n.tracks.find(Dt=>Dt.id===dt.value);j(pt,Lt.value),M.publishClipUpdate(Lt.value),Ot.value=!1,a.value=null,Lt.value=null,dt.value="",ce.value=0,Pr(),window.removeEventListener("mousemove",mi,{capture:!0}),window.removeEventListener("mouseup",en,{capture:!0})};Nl(()=>{g.value!==null&&cancelAnimationFrame(g.value),window.removeEventListener("mousemove",mi,{capture:!0}),window.removeEventListener("mouseup",en,{capture:!0})});const ha=J=>{o("stopPlay"),o("timeUpdate",J)},Xc=(J,pt)=>{const Dt=n.tracks[pt],Mt=Dt.clips.findIndex(It=>It.id===J.id);Mt!==-1&&(Dt.clips.splice(Mt,1),M.publishClipUpdate(J,"delete"),Dt.clips.length===0&&n.tracks.splice(pt,1))},pe=Tt(null),Yc=J=>{if(pe.value){const pt=pe.value.scrollWidth-pe.value.clientWidth,Dt=Math.max(0,Math.min(pe.value.scrollLeft+J,pt));pe.value.scrollLeft=Dt}},fs=Y0(),Wi=Number(fs.params.id),ua=De(()=>M.canUndo),ps=Tt(!1);ls(()=>n.tracks,async()=>{ps.value=await M.getCanRedo(Wi)});const Bo=async()=>{if(!ua.value)return;const J=await M.undo(Wi);J&&(o("update:tracks",J),o("refreshPlayer"))},Fo=async()=>{if(!ps.value)return;const J=await M.redo(Wi);J&&(o("update:tracks",J),o("refreshPlayer"))},Mo=async()=>{o("update:tracks",[]),await M.clearHistory(Wi),o("refreshPlayer")},Pr=async()=>{M.saveHistoryState&&(Lo(),await M.saveHistoryState(Wi,JSON.parse(JSON.stringify(n.tracks))))},Lo=()=>{o("delete-empty-track")},Bn=Tt(!1),Do=()=>{Bn.value=!1,o("activeClip",null)};ls([()=>Q.value,()=>n.currentTime],()=>{if(!Q.value){Bn.value=!1;return}const pt=["video","audio","image"].includes(Q.value.type),Dt=n.currentTime>Number(Q.value.startTime)&&n.currentTime<Number(Q.value.endTime);Bn.value=pt&&Dt});const jc=async()=>{const J=Iw.cloneDeep(Q.value);J.id=as(),J.startTime=n.currentTime,J.endTime=Number(J.endTime),J.type==="text"?(J.duration=Number(Q.value.duration)-(n.currentTime-Number(Q.value.startTime)),Q.value.endTime=n.currentTime,Q.value.duration=n.currentTime-Number(Q.value.startTime)):(J.sourceStartTime=n.currentTime-Number(Q.value.startTime)+Number(J.sourceStartTime),J.duration=Number(Q.value.duration)-J.startTime+Q.value.startTime,Q.value.endTime=n.currentTime,Q.value.duration=n.currentTime-Number(Q.value.startTime),Q.value.sourceEndTime=Number(Q.value.sourceEndTime)-(n.currentTime-Number(Q.value.startTime))),qc(Q.value).clips.push(J),M.publishClipUpdate(Q.value),o("add-clip",J),Pr()},qc=J=>n.tracks.find(pt=>pt.clips.some(Dt=>Dt.id===J.id)),Kc=()=>{var pt,Dt;const J=Q.value;J&&(M.publishClipUpdate(J,"delete"),(Dt=n.tracks.find(Mt=>Mt.clips.some(It=>It.id===J.id)))==null||Dt.clips.splice((pt=n.tracks.find(Mt=>Mt.clips.some(It=>It.id===J.id)))==null?void 0:pt.clips.findIndex(Mt=>Mt.id===J.id),1),Pr())},Yl=()=>{o("handleExport")};return t({activeClip:Y}),(J,pt)=>{const Dt=le("el-popconfirm"),Mt=le("el-tooltip"),It=le("el-button");return St(),Ft("div",UN,[$("div",IN,[$("div",PN,[lt(Dt,{id:"reset-button",title:"确定要重置轨道吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:Mo},{reference:he(()=>[$("button",RN,[lt(Wt(ye),{icon:"mdi:restore",width:"20"})])]),_:1}),lt(Mt,{content:"撤销",placement:"top"},{default:he(()=>[$("button",{id:"undo-button",class:Qn(["text-white hover:text-purple-500 transition-colors",{"opacity-50 cursor-not-allowed":!ua.value}]),onClick:Bo},[lt(Wt(ye),{icon:"mdi:undo",width:"20"})],2)]),_:1}),lt(Mt,{content:"恢复",placement:"top"},{default:he(()=>[$("button",{id:"redo-button",class:Qn(["text-white hover:text-purple-500 transition-colors",{"opacity-50 cursor-not-allowed":!ps.value}]),onClick:Fo},[lt(Wt(ye),{icon:"mdi:redo",width:"20"})],2)]),_:1}),lt(Mt,{content:"分割",placement:"top"},{default:he(()=>[$("button",{id:"split-button",class:Qn(["text-white hover:text-purple-500 transition-colors",{"opacity-50 cursor-not-allowed":!Bn.value}]),onClick:jc},[lt(Wt(ye),{icon:"material-symbols-light:split-scene-outline",width:"20"})],2)]),_:1}),lt(Mt,{content:"删除",placement:"top"},{default:he(()=>[$("button",{id:"delete-button",class:"text-white hover:text-purple-500 transition-colors",onClick:Kc},[lt(Wt(ye),{icon:"mdi:delete",width:"20"})])]),_:1})]),$("div",BN,[lt(Mt,{content:"缩小",placement:"top"},{default:he(()=>[$("button",{id:"zoom-out-button",class:Qn(["text-white hover:text-purple-500 transition-colors p-1 rounded",{"opacity-50 cursor-not-allowed":d.value<=.3}]),onClick:_},[lt(Wt(ye),{icon:"mdi:minus",width:"20"})],2)]),_:1}),$("span",FN,li(Math.round(d.value*100))+"%",1),lt(Mt,{content:"放大",placement:"top"},{default:he(()=>[$("button",{id:"zoom-in-button",class:Qn(["text-white hover:text-purple-500 transition-colors p-1 rounded",{"opacity-50 cursor-not-allowed":d.value>=5}]),onClick:l},[lt(Wt(ye),{icon:"mdi:plus",width:"20"})],2)]),_:1}),lt(It,{id:"export-button",class:"text-white",type:"primary",size:"small",onClick:Yl},{default:he(()=>[$("div",MN,[lt(Wt(ye),{icon:"mdi:export",width:"20"}),pt[0]||(pt[0]=eI(" 导出 "))])]),_:1})])]),$("div",{class:"h-[calc(100%-36px)] relative overflow-x-scroll",ref_key:"trackContainer",ref:pe},[lt(rN,{duration:J.timelineDuration,zoom:d.value,"current-time":J.currentTime,"total-width":m.value,onScroll:Yc,onTimeUpdate:ha},null,8,["duration","zoom","current-time","total-width"]),$("div",{class:"relative h-[calc(100%-36px)] overflow-x-hidden overflow-y-auto",style:Er({width:m.value+"px"}),onDragover:Ii(N,["prevent"]),onDragleave:Ii(L,["prevent"]),onDrop:Ii(k,["prevent"])},[J.tracks.length?be("",!0):(St(),Ft("div",LN,pt[1]||(pt[1]=[$("div",{class:"text-[#666] text-lg mb-4"},"拖拽素材到此处",-1),$("div",{class:"w-[200px] h-[40px] bg-purple-500/20 border-2 border-dashed border-purple-500 rounded"},null,-1)]))),lt(AN,{ref_key:"tracksListRef",ref:v,tracks:J.tracks,hoveredTrack:w.value,dragPreview:b.value,dragPreviewPosition:T.value,dragPreviewWidth:r.value,zoom:d.value,frameLength:W0*d.value*10,onStartResize:At,onTrackDragEnter:it,onTrackDragLeave:gt,onClipMouseDown:Xt,onClipHover:vt,onDeleteClip:Xc,onBackgroundClick:Do,onSaveHistoryState:Pr},null,8,["tracks","hoveredTrack","dragPreview","dragPreviewPosition","dragPreviewWidth","zoom","frameLength"])],36)],512)])}}}),ON={class:"mb-6"},NN={class:"grid grid-cols-2 gap-3 mb-4"},zN={class:"mb-4"},GN={class:"flex items-center gap-4"},HN={class:"w-full"},$N={class:"w-8 h-8 rounded-full border border-[#af24ff] relative"},VN={class:"flex gap-3 mb-3"},WN={class:"flex-1"},XN={class:"flex-1"},YN={class:"flex items-center gap-3 mb-3"},jN={class:"flex-1"},qN={class:"flex items-center gap-3"},KN={class:"flex items-center gap-3"},ZN={class:"flex-1"},JN={class:"flex items-center gap-3"},QN={class:"w-12 text-right"},tz=hi({__name:"VideoProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,o=Tt(!1),h=r=>{let a=r*(180/Math.PI);return a=a%360,a<0&&(a+=360),Math.round(a)},d=r=>r*(Math.PI/180),l=De(()=>{var a;if(((a=e.clip)==null?void 0:a.angle)===void 0)return 0;let r=h(e.clip.angle);return r=(r+180)%360,r}),_=De({get:()=>{var r;return((r=e.clip)==null?void 0:r.angle)===void 0?0:h(e.clip.angle)},set:r=>{e.clip&&(e.clip.angle=d(r))}}),m=r=>{if(!e.clip)return;if(r===null||isNaN(r)){e.clip.angle=0;return}let a=r%360;a<0&&(a+=360),e.clip.angle=d(a)},v=r=>{o.value=!0},w=r=>{if(!o.value||!e.clip)return;const a=r.currentTarget.getBoundingClientRect(),u=a.left+a.width/2,f=a.top+a.height/2;let g=Math.atan2(r.clientY-f,r.clientX-u);g=g+Math.PI/2,g<0&&(g+=Math.PI*2),e.clip.angle=g,n("update",e.clip)},b=()=>{o.value=!1},T=(r,a)=>{e.clip&&((r===null||isNaN(r))&&(e.clip[a]=0),n("update",e.clip))};return(r,a)=>{const u=le("el-input-number"),f=le("el-slider");return St(),Ft("div",ON,[a[22]||(a[22]=$("div",{class:"text-base font-medium text-white mb-4"},"视频属性",-1)),$("div",NN,[$("div",null,[a[14]||(a[14]=$("div",{class:"text-base text-[#999] mb-1"},"X 坐标",-1)),lt(u,{class:"w-30",modelValue:r.clip.x,"onUpdate:modelValue":a[0]||(a[0]=g=>r.clip.x=g),size:"small",placeholder:"X",precision:0,onChange:a[1]||(a[1]=g=>T(g,"x"))},null,8,["modelValue"])]),$("div",null,[a[15]||(a[15]=$("div",{class:"text-base text-[#999] mb-1"},"Y 坐标",-1)),lt(u,{class:"w-30",modelValue:r.clip.y,"onUpdate:modelValue":a[2]||(a[2]=g=>r.clip.y=g),size:"small",placeholder:"Y",precision:0,onChange:a[3]||(a[3]=g=>T(g,"y"))},null,8,["modelValue"])])]),$("div",zN,[a[17]||(a[17]=$("div",{class:"text-base text-[#999] mb-2"},"旋转角度",-1)),$("div",GN,[$("div",HN,[lt(u,{class:"w-full",modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=g=>_.value=g),min:0,max:360,step:1,size:"small","controls-position":"right",onChange:m},null,8,["modelValue"])]),$("div",{class:"relative flex items-center justify-center",onMousedown:v,onMousemove:w,onMouseup:b,onMouseleave:b},[$("div",$N,[$("div",{class:"absolute w-[1px] h-[13px] bg-[#af24ff]",style:Er({transform:`rotate(${l.value}deg)`,left:"calc(50% - 0.5px)",top:"50%",transformOrigin:"top"})},a[16]||(a[16]=[$("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 rounded-full bg-[#af24ff]"},null,-1)]),4)])],32)])]),$("div",VN,[$("div",WN,[a[18]||(a[18]=$("div",{class:"text-base text-[#999] mb-1"},"去片头",-1)),lt(u,{class:"w-30",modelValue:r.clip.sourceStartTime,"onUpdate:modelValue":a[5]||(a[5]=g=>r.clip.sourceStartTime=g),size:"small",min:0,step:.1,placeholder:"去片头时间",onChange:a[6]||(a[6]=g=>T(g,"sourceStartTime"))},null,8,["modelValue"])]),$("div",XN,[a[19]||(a[19]=$("div",{class:"text-base text-[#999] mb-1"},"去片尾",-1)),lt(u,{class:"w-30",modelValue:r.clip.sourceEndTime,"onUpdate:modelValue":a[7]||(a[7]=g=>r.clip.sourceEndTime=g),size:"small",min:0,step:.1,placeholder:"去片尾时间",onChange:a[8]||(a[8]=g=>T(g,"sourceEndTime"))},null,8,["modelValue"])])]),$("div",YN,[$("div",jN,[a[20]||(a[20]=$("div",{class:"text-base text-[#999] mb-1"},"音量",-1)),$("div",qN,[lt(f,{modelValue:r.clip.volume,"onUpdate:modelValue":a[9]||(a[9]=g=>r.clip.volume=g),min:0,max:100,step:1},null,8,["modelValue"]),r.clip.volume===100?(St(),Pi(Wt(ye),{key:0,icon:"material-symbols:volume-up",onClick:a[10]||(a[10]=g=>r.clip.volume=0)})):r.clip.volume!==0?(St(),Pi(Wt(ye),{key:1,icon:"material-symbols:volume-down",onClick:a[11]||(a[11]=g=>r.clip.volume=0)})):(St(),Pi(Wt(ye),{key:2,icon:"material-symbols:volume-off",onClick:a[12]||(a[12]=g=>r.clip.volume=100)}))])])]),$("div",KN,[$("div",ZN,[a[21]||(a[21]=$("div",{class:"text-base text-[#999] mb-1"},"不透明度",-1)),$("div",JN,[lt(f,{modelValue:r.clip.opacity,"onUpdate:modelValue":a[13]||(a[13]=g=>r.clip.opacity=g),min:0,max:100,step:1},null,8,["modelValue"]),$("div",QN,li(Math.round(r.clip.opacity))+"%",1)])])])])}}}),ez=ar(tz,[["__scopeId","data-v-a203910b"]]),iz={class:"mb-6"},rz={class:"flex gap-3 mb-3"},nz={class:"flex-1"},sz={class:"flex-1"},az={class:"flex items-center gap-3"},oz={class:"flex-1"},lz={class:"flex items-center gap-3"},hz=hi({__name:"AudioProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,o=(h,d)=>{e.clip&&((h===null||isNaN(h))&&(e.clip[d]=0),n("update",e.clip))};return(h,d)=>{const l=le("el-input-number"),_=le("el-slider");return St(),Ft("div",iz,[d[11]||(d[11]=$("div",{class:"text-base font-medium text-white mb-4"},"音频属性",-1)),$("div",rz,[$("div",nz,[d[8]||(d[8]=$("div",{class:"text-base text-[#999] mb-1"},"去片头",-1)),lt(l,{class:"w-30",modelValue:h.clip.sourceStartTime,"onUpdate:modelValue":d[0]||(d[0]=m=>h.clip.sourceStartTime=m),size:"small",min:0,step:.1,placeholder:"去片头时间",onChange:d[1]||(d[1]=m=>o(m,"sourceStartTime"))},null,8,["modelValue"])]),$("div",sz,[d[9]||(d[9]=$("div",{class:"text-base text-[#999] mb-1"},"去片尾",-1)),lt(l,{class:"w-30",modelValue:h.clip.sourceEndTime,"onUpdate:modelValue":d[2]||(d[2]=m=>h.clip.sourceEndTime=m),size:"small",min:0,step:.1,placeholder:"去片尾时间",onChange:d[3]||(d[3]=m=>o(m,"sourceEndTime"))},null,8,["modelValue"])])]),$("div",az,[$("div",oz,[d[10]||(d[10]=$("div",{class:"text-base text-[#999] mb-1"},"音量",-1)),$("div",lz,[lt(_,{modelValue:h.clip.volume,"onUpdate:modelValue":d[4]||(d[4]=m=>h.clip.volume=m),min:0,max:100,step:1},null,8,["modelValue"]),h.clip.volume===100?(St(),Pi(Wt(ye),{key:0,icon:"material-symbols:volume-up",onClick:d[5]||(d[5]=m=>h.clip.volume=0)})):h.clip.volume!==0?(St(),Pi(Wt(ye),{key:1,icon:"material-symbols:volume-down",onClick:d[6]||(d[6]=m=>h.clip.volume=0)})):(St(),Pi(Wt(ye),{key:2,icon:"material-symbols:volume-off",onClick:d[7]||(d[7]=m=>h.clip.volume=100)}))])])])])}}}),uz=ar(hz,[["__scopeId","data-v-8cf099bb"]]),cz={class:"mb-6"},dz={class:"grid grid-cols-2 gap-3 mb-4"},fz={class:"mb-4"},pz={class:"flex items-center gap-4"},_z={class:"w-full"},gz={class:"w-8 h-8 rounded-full border border-[#af24ff] relative"},mz={class:"flex items-center gap-3"},yz={class:"flex-1"},vz={class:"flex items-center gap-3"},xz={class:"w-12 text-right"},bz=hi({__name:"ImageProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,o=Tt(!1),h=r=>{let a=r*(180/Math.PI);return a=a%360,a<0&&(a+=360),Math.round(a)},d=r=>r*(Math.PI/180),l=De(()=>{var a;if(((a=e.clip)==null?void 0:a.angle)===void 0)return 0;let r=h(e.clip.angle);return r=(r+180)%360,r}),_=De({get:()=>{var r;return((r=e.clip)==null?void 0:r.angle)===void 0?0:h(e.clip.angle)},set:r=>{e.clip&&(e.clip.angle=d(r))}}),m=r=>{if(!e.clip)return;if(r===null||isNaN(r)){e.clip.angle=0;return}let a=r%360;a<0&&(a+=360),e.clip.angle=d(a)},v=r=>{o.value=!0},w=r=>{if(!o.value||!e.clip)return;const a=r.currentTarget.getBoundingClientRect(),u=a.left+a.width/2,f=a.top+a.height/2;let g=Math.atan2(r.clientY-f,r.clientX-u);g=g+Math.PI/2,g<0&&(g+=Math.PI*2),e.clip.angle=g,n("update",e.clip)},b=()=>{o.value=!1},T=(r,a)=>{e.clip&&((r===null||isNaN(r))&&(e.clip[a]=0),n("update",e.clip))};return(r,a)=>{const u=le("el-input-number"),f=le("el-slider");return St(),Ft("div",cz,[a[11]||(a[11]=$("div",{class:"text-base font-medium text-white mb-4"},"图片属性",-1)),$("div",dz,[$("div",null,[a[6]||(a[6]=$("div",{class:"text-base text-[#999] mb-1"},"X 坐标",-1)),lt(u,{class:"w-30",modelValue:r.clip.x,"onUpdate:modelValue":a[0]||(a[0]=g=>r.clip.x=g),size:"small",placeholder:"X",precision:0,onChange:a[1]||(a[1]=g=>T(g,"x"))},null,8,["modelValue"])]),$("div",null,[a[7]||(a[7]=$("div",{class:"text-base text-[#999] mb-1"},"Y 坐标",-1)),lt(u,{class:"w-30",modelValue:r.clip.y,"onUpdate:modelValue":a[2]||(a[2]=g=>r.clip.y=g),size:"small",placeholder:"Y",precision:0,onChange:a[3]||(a[3]=g=>T(g,"y"))},null,8,["modelValue"])])]),$("div",fz,[a[9]||(a[9]=$("div",{class:"text-base text-[#999] mb-2"},"旋转角度",-1)),$("div",pz,[$("div",_z,[lt(u,{class:"w-full",modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=g=>_.value=g),min:0,max:360,step:1,size:"small","controls-position":"right",onChange:m},null,8,["modelValue"])]),$("div",{class:"relative flex items-center justify-center",onMousedown:v,onMousemove:w,onMouseup:b,onMouseleave:b},[$("div",gz,[$("div",{class:"absolute w-[1px] h-[13px] bg-[#af24ff]",style:Er({transform:`rotate(${l.value}deg)`,left:"calc(50% - 0.5px)",top:"50%",transformOrigin:"top"})},a[8]||(a[8]=[$("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 rounded-full bg-[#af24ff]"},null,-1)]),4)])],32)])]),$("div",mz,[$("div",yz,[a[10]||(a[10]=$("div",{class:"text-base text-[#999] mb-1"},"不透明度",-1)),$("div",vz,[lt(f,{modelValue:r.clip.opacity,"onUpdate:modelValue":a[5]||(a[5]=g=>r.clip.opacity=g),min:0,max:100,step:1},null,8,["modelValue"]),$("div",xz,li(Math.round(r.clip.opacity))+"%",1)])])])])}}}),wz=ar(bz,[["__scopeId","data-v-6d7357c9"]]),Sz={class:"mb-6"},Ez={class:"mb-2"},Tz={class:"mb-4"},Az={class:"flex items-center gap-4 mb-3"},Cz={class:"w-full"},Uz={class:"w-8 h-8 rounded-full border border-[#af24ff] relative"},Iz={class:"flex justify-start items-center gap-1"},Pz={class:"py-2"},Rz={class:"flex justify-between items-center mb-2"},Bz={class:"flex-1 mx-4"},Fz={class:"flex justify-between items-center mb-2"},Mz={class:"flex justify-between items-center mb-2"},Lz={class:"flex justify-between items-center mb-2"},Dz={class:"flex justify-between items-center mb-2 pl-4"},kz={class:"flex justify-between items-center mb-2 pl-4"},Oz={class:"flex justify-between items-center mb-2"},Nz={class:"flex justify-between items-center mb-2 pl-4"},zz={class:"flex justify-between items-center mb-2 pl-4"},Gz={class:"flex justify-between items-center mb-2 pl-4"},Hz={class:"flex justify-between items-center mb-2 pl-4"},$z=hi({__name:"TextProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,o=Tt(!1),h=Tt([]),d=u=>{let f=u*(180/Math.PI);return f=f%360,f<0&&(f+=360),Math.round(f)},l=u=>u*(Math.PI/180),_=De(()=>{var f;if(((f=e.clip)==null?void 0:f.angle)===void 0)return 0;let u=d(e.clip.angle);return u=(u+180)%360,u}),m=De({get:()=>{var u;return((u=e.clip)==null?void 0:u.angle)===void 0?0:d(e.clip.angle)},set:u=>{e.clip&&(e.clip.angle=l(u))}}),v=De(()=>{var u,f;switch((f=(u=e.clip)==null?void 0:u.textConfig)==null?void 0:f.align){case"center":return"material-symbols:format-align-center";case"right":return"material-symbols:format-align-right";default:return"material-symbols:format-align-left"}}),w=u=>{e.clip&&(e.clip.textConfig.align=u,n("update",e.clip))},b=u=>{if(!e.clip)return;if(u===null||isNaN(u)){e.clip.angle=0;return}let f=u%360;f<0&&(f+=360),e.clip.angle=l(f),n("update",e.clip)},T=u=>{o.value=!0},r=u=>{if(!o.value||!e.clip)return;const f=u.currentTarget.getBoundingClientRect(),g=f.left+f.width/2,x=f.top+f.height/2;let S=Math.atan2(u.clientY-x,u.clientX-g);S=S+Math.PI/2,S<0&&(S+=Math.PI*2),e.clip.angle=S,n("update",e.clip)},a=()=>{o.value=!1};return(u,f)=>{const g=le("el-input"),x=le("el-option"),S=le("el-select"),A=le("el-input-number"),C=le("el-button"),B=le("el-dropdown-item"),R=le("el-dropdown-menu"),M=le("el-dropdown"),N=le("el-color-picker"),L=le("el-slider"),W=le("el-switch"),k=le("el-collapse-item"),j=le("el-collapse");return St(),Ft("div",Sz,[f[36]||(f[36]=$("div",{class:"text-base font-medium text-white mb-4"},"文字属性",-1)),$("div",Ez,[lt(g,{modelValue:u.clip.textConfig.content,"onUpdate:modelValue":f[0]||(f[0]=Y=>u.clip.textConfig.content=Y),type:"textarea",rows:3,placeholder:"请输入文字内容"},null,8,["modelValue"])]),$("div",Tz,[f[22]||(f[22]=$("div",{class:"text-base text-white mb-2"},"字体",-1)),lt(S,{modelValue:u.clip.textConfig.fontFamily,"onUpdate:modelValue":f[1]||(f[1]=Y=>u.clip.textConfig.fontFamily=Y),class:"w-full mb-2"},{default:he(()=>[lt(x,{label:"DM Sans",value:"DM Sans"}),lt(x,{label:"微软雅黑",value:"Microsoft YaHei"}),lt(x,{label:"宋体",value:"SimSun"}),lt(x,{label:"黑体",value:"SimHei"})]),_:1},8,["modelValue"]),f[23]||(f[23]=$("div",{class:"text-base text-white mb-2"},"旋转角度",-1)),$("div",Az,[$("div",Cz,[lt(A,{class:"w-full",modelValue:m.value,"onUpdate:modelValue":f[2]||(f[2]=Y=>m.value=Y),min:0,max:360,step:1,size:"small","controls-position":"right",onChange:b},null,8,["modelValue"])]),$("div",{class:"relative flex items-center justify-center",onMousedown:T,onMousemove:r,onMouseup:a,onMouseleave:a},[$("div",Uz,[$("div",{class:"absolute w-[1px] h-[13px] bg-[#af24ff]",style:Er({transform:`rotate(${_.value}deg)`,left:"calc(50% - 0.5px)",top:"50%",transformOrigin:"top"})},f[18]||(f[18]=[$("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 rounded-full bg-[#af24ff]"},null,-1)]),4)])],32)]),$("div",Iz,[lt(C,{class:Qn({"text-purple-500":u.clip.textConfig.bold}),size:"small",onClick:f[3]||(f[3]=Y=>u.clip.textConfig.bold=!u.clip.textConfig.bold)},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-bold"})]),_:1},8,["class"]),lt(C,{class:Qn(["!ml-0",{"text-purple-500":u.clip.textConfig.italic}]),size:"small",onClick:f[4]||(f[4]=Y=>u.clip.textConfig.italic=!u.clip.textConfig.italic)},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-italic"})]),_:1},8,["class"]),lt(M,{trigger:"click",onCommand:w},{dropdown:he(()=>[lt(R,null,{default:he(()=>[lt(B,{command:"left"},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-align-left"}),f[19]||(f[19]=$("span",{class:"text-sm text-white ml-2"},"左对齐",-1))]),_:1}),lt(B,{command:"center"},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-align-center"}),f[20]||(f[20]=$("span",{class:"text-sm text-white ml-2"},"居中",-1))]),_:1}),lt(B,{command:"right"},{default:he(()=>[lt(Wt(ye),{icon:"material-symbols:format-align-right"}),f[21]||(f[21]=$("span",{class:"text-sm text-white ml-2"},"右对齐",-1))]),_:1})]),_:1})]),default:he(()=>[lt(C,{size:"small"},{default:he(()=>[lt(Wt(ye),{icon:v.value},null,8,["icon"])]),_:1})]),_:1}),lt(N,{modelValue:u.clip.textConfig.color,"onUpdate:modelValue":f[5]||(f[5]=Y=>u.clip.textConfig.color=Y),size:"small","show-alpha":""},null,8,["modelValue"])])]),lt(j,{modelValue:h.value,"onUpdate:modelValue":f[17]||(f[17]=Y=>h.value=Y)},{default:he(()=>[lt(k,{name:"advanced"},{title:he(()=>f[24]||(f[24]=[$("span",{class:"text-base text-white"},"高级",-1)])),default:he(()=>[$("div",Pz,[$("div",Rz,[f[25]||(f[25]=$("span",{class:"text-base text-white"},"透明度",-1)),$("div",Bz,[lt(L,{modelValue:u.clip.opacity,"onUpdate:modelValue":f[6]||(f[6]=Y=>u.clip.opacity=Y),min:0,max:100,step:1},null,8,["modelValue"])])]),$("div",Fz,[f[26]||(f[26]=$("span",{class:"text-base text-white"},"行高",-1)),lt(A,{modelValue:u.clip.textConfig.lineSpacing,"onUpdate:modelValue":f[7]||(f[7]=Y=>u.clip.textConfig.lineSpacing=Y),min:0,step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Mz,[f[27]||(f[27]=$("span",{class:"text-base text-white"},"字间距",-1)),lt(A,{modelValue:u.clip.textConfig.letterSpacing,"onUpdate:modelValue":f[8]||(f[8]=Y=>u.clip.textConfig.letterSpacing=Y),step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Lz,[f[28]||(f[28]=$("span",{class:"text-base text-white"},"边框",-1)),lt(W,{modelValue:u.clip.textConfig.showStroke,"onUpdate:modelValue":f[9]||(f[9]=Y=>u.clip.textConfig.showStroke=Y)},null,8,["modelValue"])]),u.clip.textConfig.showStroke?(St(),Ft($i,{key:0},[$("div",Dz,[f[29]||(f[29]=$("span",{class:"text-base text-white"},"边框颜色",-1)),lt(N,{modelValue:u.clip.textConfig.strokeColor,"onUpdate:modelValue":f[10]||(f[10]=Y=>u.clip.textConfig.strokeColor=Y),"show-alpha":"",size:"small"},null,8,["modelValue"])]),$("div",kz,[f[30]||(f[30]=$("span",{class:"text-base text-white"},"边框宽度",-1)),lt(A,{modelValue:u.clip.textConfig.strokeWidth,"onUpdate:modelValue":f[11]||(f[11]=Y=>u.clip.textConfig.strokeWidth=Y),min:0,step:.5,"controls-position":"right",class:"w-30"},null,8,["modelValue"])])],64)):be("",!0),$("div",Oz,[f[31]||(f[31]=$("span",{class:"text-base text-white"},"阴影",-1)),lt(W,{modelValue:u.clip.textConfig.showShadow,"onUpdate:modelValue":f[12]||(f[12]=Y=>u.clip.textConfig.showShadow=Y)},null,8,["modelValue"])]),u.clip.textConfig.showShadow?(St(),Ft($i,{key:1},[$("div",Nz,[f[32]||(f[32]=$("span",{class:"text-base text-white"},"阴影颜色",-1)),lt(N,{modelValue:u.clip.textConfig.shadowColor,"onUpdate:modelValue":f[13]||(f[13]=Y=>u.clip.textConfig.shadowColor=Y),"show-alpha":"",size:"small"},null,8,["modelValue"])]),$("div",zz,[f[33]||(f[33]=$("span",{class:"text-base text-white"},"阴影模糊",-1)),lt(A,{modelValue:u.clip.textConfig.shadowBlur,"onUpdate:modelValue":f[14]||(f[14]=Y=>u.clip.textConfig.shadowBlur=Y),min:0,step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Gz,[f[34]||(f[34]=$("span",{class:"text-base text-white"},"水平偏移",-1)),lt(A,{modelValue:u.clip.textConfig.shadowOffsetX,"onUpdate:modelValue":f[15]||(f[15]=Y=>u.clip.textConfig.shadowOffsetX=Y),step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])]),$("div",Hz,[f[35]||(f[35]=$("span",{class:"text-base text-white"},"垂直偏移",-1)),lt(A,{modelValue:u.clip.textConfig.shadowOffsetY,"onUpdate:modelValue":f[16]||(f[16]=Y=>u.clip.textConfig.shadowOffsetY=Y),step:1,"controls-position":"right",class:"w-30"},null,8,["modelValue"])])],64)):be("",!0)])]),_:1})]),_:1},8,["modelValue"])])}}}),Vz=ar($z,[["__scopeId","data-v-fcc51af5"]]),Wz={class:"text-white"},Xz={key:0,class:"mb-6"},Yz={class:"mb-4"},jz={class:"text-base text-white"},qz={class:"mb-4"},Kz=hi({__name:"FilterProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=h=>{e.clip.intensity=h},o=h=>h?{grayscale:"灰度",invert:"反色",brightness:"亮度",sepia:"复古",blur:"模糊"}[h]:"未知滤镜";return(h,d)=>{const l=le("el-slider");return St(),Ft("div",Wz,[h.clip?(St(),Ft("div",Xz,[d[3]||(d[3]=$("div",{class:"text-base font-medium text-white mb-4"},"滤镜属性",-1)),$("div",Yz,[d[1]||(d[1]=$("div",{class:"text-base text-[#999] mb-1"},"名称",-1)),$("div",jz,li(o(h.clip.filterType)),1)]),$("div",qz,[d[2]||(d[2]=$("div",{class:"text-base text-[#999] mb-1"},"强度",-1)),lt(l,{modelValue:h.clip.intensity,"onUpdate:modelValue":d[0]||(d[0]=_=>h.clip.intensity=_),min:0,max:100,step:1,onChange:n,class:"filter-slider"},null,8,["modelValue"])])])):be("",!0)])}}}),Zz=ar(Kz,[["__scopeId","data-v-18c52553"]]),Jz={class:"p-6 text-white"},Qz={key:1,class:"text-center text-[#999] text-base"},t4=hi({__name:"ClipProperties",props:{clip:{}},emits:["update"],setup(s,{emit:t}){const e=s,n=t,o=sa(),h=d=>{n("update",d)};return ls(()=>e.clip,d=>{d&&o.publishClipUpdate(d)},{deep:!0}),(d,l)=>(St(),Ft("div",Jz,[d.clip?(St(),Ft($i,{key:0},[d.clip.type==="video"?(St(),Pi(ez,{key:0,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="audio"?(St(),Pi(uz,{key:1,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="image"?(St(),Pi(wz,{key:2,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="text"?(St(),Pi(Vz,{key:3,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0),d.clip.type==="filter"?(St(),Pi(Zz,{key:4,clip:d.clip,onUpdate:h},null,8,["clip"])):be("",!0)],64)):(St(),Ft("div",Qz," 请选择一个片段 "))]))}}),e4={id:"left",class:"h-screen"},i4={id:"right",class:"h-screen overflow-hidden"},r4={id:"top",class:"flex justify-between"},n4={id:"topLeft",class:"w-4/5"},s4={id:"topRight",class:"w-1/5 bg-[#303030]"},a4={id:"bottom",class:"bg-[#201f20]"},dp=10,o4=300,l4=5,ol="split-sizes",p4=hi({__name:"index",setup(s){const t=L=>{L.ctrlKey&&L.preventDefault()};So(()=>{window.addEventListener("wheel",t,{passive:!1})}),Nl(()=>{window.removeEventListener("wheel",t)});const e=Y0(),n=sa(),o=Number(e.params.id),h=[25,75],d=[65,35],l=Tt([]),_=Tt(0),m=De(()=>Math.max(v.value+l4,o4)),v=De(()=>{let L=0;return l.value.forEach(W=>{W.clips.forEach(k=>{const j=Number(k.endTime);j>L&&(L=j)})}),L}),w=Tt(null),b=Tt(null),T=L=>{_.value=L},r=async L=>{const W=sI(L);await P_("/capture/"+o+".png",W,{overwrite:!0});const k=await Ke.projects.where({id:o}).first();k&&Ke.projects.update(k,{thumbnail:"/capture/"+o+".png"})},a=()=>{_.value-=30/1e3/1e3},u=()=>{_.value+=30/1e3/1e3};Ly("addClip",async(L,W)=>{if(L.startTime=_.value,L.endTime=_.value+L.duration,L.type==="video"&&(L.sourceStartTime=0,L.sourceEndTime=0,L.originalDuration=L.duration),L.type==="video"||L.type==="image"){const k=await U_(L);k.type==="video"?L.thumbnail=k.data:k.type==="image"&&(L.thumbnail=[{timestamp:0,url:URL.createObjectURL(k.data)}])}if(L.type==="audio"){const k=await I_(L);k.type==="audio"&&(L.volumeData=k.data)}if(W){if(l.value.length>=dp){Zs.warning(`轨道数量已达到最大限制(${dp})`);return}const k={id:String(l.value.length),clips:[L]};l.value.push(k)}else l.value.length===0&&l.value.push({id:"0",clips:[]}),l.value[l.value.length-1].clips.push(L);Il(()=>{var k;(k=w.value)==null||k.refreshPlayer()})}),Ly("activeClip",L=>{var W,k,j;if(L){const Y=(W=l.value.find(ut=>ut.clips.some(it=>it.id===L)))==null?void 0:W.clips.find(ut=>ut.id===L);Y&&((k=b.value)==null||k.activeClip(Y),S.value=Y)}else(j=b.value)==null||j.activeClip(null),S.value=null}),Tt(0),Tt(0),So(async()=>{const L=localStorage.getItem(ol),{horizontalSizes:W,verticalSizes:k}=L?JSON.parse(L):{horizontalSizes:h,verticalSizes:d};$0(["#left","#right"],{sizes:W,minSize:[250,500],snapOffset:0,onDragEnd:Y=>{const ut=localStorage.getItem(ol),it=ut?JSON.parse(ut):{};localStorage.setItem(ol,JSON.stringify({...it,horizontalSizes:Y}))}}),$0(["#top","#bottom"],{direction:"vertical",sizes:k,minSize:[250,150],snapOffset:0,onDragEnd:Y=>{const ut=localStorage.getItem(ol),it=ut?JSON.parse(ut):{};localStorage.setItem(ol,JSON.stringify({...it,verticalSizes:Y}))}});const j=await Ke.projects.where({id:o}).first();j&&(l.value=j.tracks,B(),l.value.forEach(Y=>{Y.clips.forEach(ut=>{ut.type==="audio"?I_(ut).then(it=>{it.type==="audio"&&(ut.volumeData=it.data)}):(ut.type==="video"||ut.type==="image")&&U_(ut).then(it=>{it.type==="video"?ut.thumbnail=it.data:it.type==="image"&&(ut.thumbnail=[{timestamp:0,url:URL.createObjectURL(it.data)}])})})}),n.clearHistory(o),n.saveHistoryState(o,l.value),M())});const f=()=>{n.setShowContextMenu(!1)},g=(L,W)=>{for(const k of l.value)for(const j of k.clips)if(j.id===L){Object.assign(j,W);break}};ls(()=>l.value,async L=>{await x()},{deep:!0});const x=async()=>{const L=await Ke.projects.where({id:o}).first();if(L){const W=Iw.cloneDeep(l.value);W.forEach(k=>{k.clips.forEach(j=>{j.thumbnail=null})}),await Ke.projects.update(L,{tracks:W})}},S=Tt(null),A=L=>{var W;S.value=L,(W=w.value)==null||W.activeClip(L)},C=L=>{var W;(W=w.value)==null||W.addClip(L)},B=()=>{l.value=l.value.filter(L=>L.clips.length>0)},R=()=>{var L;(L=w.value)==null||L.handleStopPlay()},M=()=>{var L;(L=w.value)==null||L.refreshPlayer()},N=()=>{var L;(L=w.value)==null||L.handleExport()};return(L,W)=>(St(),Ft("div",{class:"w-full h-full flex bg-[#1b1b1d] overflow-hidden",onClick:f},[$("div",e4,[lt(XO)]),$("div",i4,[$("div",r4,[$("div",n4,[lt(eO,{ref_key:"playerRef",ref:w,currentTime:_.value,tracks:l.value,timelineDuration:Wt(m),playerDuration:Wt(v),onPrevFrame:a,onNextFrame:u,onTimeUpdate:T,onCaptureImage:r,onUpdateClipProps:g},null,8,["currentTime","tracks","timelineDuration","playerDuration"])]),$("div",s4,[lt(t4,{clip:S.value,onUpdate:g},null,8,["clip"])])]),$("div",a4,[lt(kN,{ref_key:"clipTrackRef",ref:b,tracks:l.value,"onUpdate:tracks":W[0]||(W[0]=k=>l.value=k),maxTracksNum:dp,currentTime:_.value,timelineDuration:Wt(m),onStopPlay:R,onTimeUpdate:T,onAddClip:C,onRefreshPlayer:M,onDeleteEmptyTrack:B,onActiveClip:A,onHandleExport:N},null,8,["tracks","currentTime","timelineDuration"])])])]))}});export{p4 as default};
